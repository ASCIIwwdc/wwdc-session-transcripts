WEBVTT

00:00:07.107 --> 00:00:16.350 align:start position:43% line:-1
（音楽）

00:00:22.189 --> 00:00:26.093 align:start position:23% line:-2
“MapKit JSキーの取得
及び使用”へようこそ

00:00:26.326 --> 00:00:28.629 align:start position:30% line:-1
エリック･ジェリナです

00:00:29.096 --> 00:00:33.233 align:start position:27% line:-2
このビデオでは
MapKit JSの認証と

00:00:33.667 --> 00:00:37.905 align:start position:25% line:-2
MapKit JSキー及び
認証トークンの作成方法を学び

00:00:38.005 --> 00:00:39.540 align:start position:34% line:-1
マップを作成します

00:00:40.807 --> 00:00:44.478 align:start position:21% line:-2
MapKit JSにおける認証を
見ていきましょう

00:00:45.879 --> 00:00:49.550 align:start position:27% line:-2
ウェブ上でホストするものは
全てプレーンテキストです

00:00:49.850 --> 00:00:55.022 align:start position:23% line:-2
ありがたいことに
ソースを表示して技術を学べます

00:00:56.190 --> 00:00:58.859 align:start position:32% line:-2
ウェブインスペクタを
開いてみましょう

00:00:59.193 --> 00:01:04.298 align:start position:27% line:-2
気に入ったマップがあったら
ソースを表示して確認します

00:00:59.193 --> 00:01:04.298 align:start position:27% line:-2
気に入ったマップがあったら
ソースを表示して確認します

00:01:05.799 --> 00:01:09.670 align:start position:27% line:-2
時にはあなたの許可なく
API認証クレデンシャルが

00:01:09.770 --> 00:01:12.940 align:start position:36% line:-2
誤ってコピーされ
使用される場合も

00:01:13.640 --> 00:01:17.477 align:start position:29% line:-2
不正でも使用限度に対して
カウントされます

00:01:18.178 --> 00:01:22.683 align:start position:27% line:-2
限度に達すると
サイトはマップが表示不能に

00:01:23.150 --> 00:01:28.655 align:start position:20% line:-2
MapKit JS認証システムなら
クレデンシャル管理を強化できます

00:01:29.056 --> 00:01:32.726 align:start position:25% line:-1
アクセスの有効期限を設定して

00:01:33.627 --> 00:01:36.530 align:start position:27% line:-2
特定ドメインへのアクセスを
制限します

00:01:36.663 --> 00:01:41.168 align:start position:25% line:-2
他者はウェブインスペクタ内で
閲覧できますが

00:01:41.502 --> 00:01:46.306 align:start position:21% line:-2
他者がクレデンシャルを取得すれば
使用法が制限されます

00:01:47.608 --> 00:01:52.012 align:start position:18% line:-2
高レベルでのMapKit JS認証を
見てみましょう

00:01:52.880 --> 00:01:57.251 align:start position:20% line:-2
MapKit JSキーを入手したら
安全な場所に保存します

00:01:57.551 --> 00:02:00.287 align:start position:23% line:-1
ウェブ上で共有されることはなく

00:01:57.551 --> 00:02:00.287 align:start position:23% line:-1
ウェブ上で共有されることはなく

00:02:00.387 --> 00:02:04.324 align:start position:23% line:-2
あなたのキーが署名された
制限付きトークンが作成されます

00:02:04.558 --> 00:02:09.930 align:start position:12% line:-2
このトークンはMapKit JS APIの
認証に使用します

00:02:10.830 --> 00:02:14.368 align:start position:29% line:-2
MapKit JSキーの
作成方法を説明しましょう

00:02:15.602 --> 00:02:20.207 align:start position:16% line:-2
このキーはMapKit JS APIで
使用するクレデンシャルです

00:02:20.507 --> 00:02:22.743 align:start position:27% line:-1
ワンタイムセットアップです

00:02:23.243 --> 00:02:24.878 align:start position:32% line:-1
まずマップIDを作成

00:02:25.479 --> 00:02:29.550 align:start position:23% line:-2
MapKit JSキーを作成し
そのIDと関連付けます

00:02:30.350 --> 00:02:33.353 align:start position:30% line:-2
キーをダウンロードし
安全な場所へ保存します

00:02:34.621 --> 00:02:39.660 align:start position:0% line:-2
developer.apple.com/accountへ
始める前にログインします

00:02:40.427 --> 00:02:45.032 align:start position:21% line:-2
左のメニューから“証明書･ID･
プロファイル”をクリックします

00:02:47.067 --> 00:02:50.037 align:start position:27% line:-1
まずはマップIDの作成です

00:02:50.370 --> 00:02:54.074 align:start position:11% line:-2
Apple Developerウェブサイトの
プロジェクト特定に使用しますが

00:02:54.274 --> 00:02:57.010 align:start position:30% line:-1
使用限度も追跡されます

00:02:58.946 --> 00:03:03.851 align:start position:30% line:-2
開発環境においては
別IDを作成しましょう

00:02:58.946 --> 00:03:03.851 align:start position:30% line:-2
開発環境においては
別IDを作成しましょう

00:03:04.318 --> 00:03:09.389 align:start position:25% line:-2
メニューから“マップID”を
選択して

00:03:10.357 --> 00:03:12.726 align:start position:36% line:-2
右上の“+”を
クリックした後―

00:03:13.994 --> 00:03:15.929 align:start position:32% line:-1
IDに説明を加えます

00:03:16.263 --> 00:03:20.167 align:start position:27% line:-2
ユーザーに表示される
ウェブサイト名を入力したら

00:03:21.335 --> 00:03:23.537 align:start position:29% line:-1
固有のIDをあてがいます

00:03:23.871 --> 00:03:27.441 align:start position:29% line:-2
このIDには
逆ドメインスタイルを推奨

00:03:27.541 --> 00:03:30.110 align:start position:29% line:-1
文字列マップで開始します

00:03:32.045 --> 00:03:38.151 align:start position:18% line:-2
例えば“maps.com.
あなたのドメイン名.yourapp”

00:03:40.420 --> 00:03:42.489 align:start position:25% line:-2
次はMapKit JSキーの
作成です

00:03:42.689 --> 00:03:45.626 align:start position:29% line:-2
このキーはあなたと
Apple間の秘密なので

00:03:45.759 --> 00:03:49.463 align:start position:25% line:-2
フロントエンドコード格納や
ソースコントロールチェックは

00:03:49.563 --> 00:03:50.931 align:start position:38% line:-1
控えてください

00:03:52.065 --> 00:03:57.037 align:start position:25% line:-2
まず左メニューの“キー”下の
“すべて”をクリックします

00:03:58.338 --> 00:04:01.408 align:start position:32% line:-2
次にヘッダの“+”を
クリックします

00:03:58.338 --> 00:04:01.408 align:start position:32% line:-2
次にヘッダの“+”を
クリックします

00:04:02.776 --> 00:04:05.045 align:start position:25% line:-1
この新規キーに名前を付けたら

00:04:06.880 --> 00:04:10.017 align:start position:29% line:-2
“MapKit JS”を
チェックします

00:04:11.318 --> 00:04:13.420 align:start position:30% line:-1
次に“設定”をクリック

00:04:14.188 --> 00:04:16.023 align:start position:34% line:-1
新規キーが作成され

00:04:16.857 --> 00:04:20.293 align:start position:27% line:-2
前に作成したマップIDとの
関連付けを―

00:04:20.394 --> 00:04:23.230 align:start position:27% line:-2
ドロップダウンメニューから
行います

00:04:23.997 --> 00:04:27.768 align:start position:29% line:-2
マップIDへの関連付けは
１つのキーと一度のみです

00:04:28.936 --> 00:04:32.472 align:start position:30% line:-2
マップIDを選択したら
“続行”をクリック

00:04:33.874 --> 00:04:38.879 align:start position:23% line:-2
変更内容に目を通したら
最後に“確認”をクリックします

00:04:40.814 --> 00:04:42.916 align:start position:34% line:-2
これでキーが
ダウンロード可能に

00:04:43.050 --> 00:04:46.920 align:start position:29% line:-2
“ダウンロード”ボタンを
クリックして保存します

00:04:47.120 --> 00:04:50.991 align:start position:23% line:-2
１回しかダウンロードできません
安全な場所に保管を

00:04:51.091 --> 00:04:55.796 align:start position:23% line:-2
損失した場合 新規キーを作成し
古いキーを無効にします

00:04:57.130 --> 00:05:01.034 align:start position:27% line:-2
ダウンロードした認証キーは
このようになります

00:04:57.130 --> 00:05:01.034 align:start position:27% line:-2
ダウンロードした認証キーは
このようになります

00:05:01.235 --> 00:05:06.340 align:start position:23% line:-2
お伝えしたようにこのキーは
あなたとApple間の秘密です

00:05:07.074 --> 00:05:10.611 align:start position:21% line:-2
認証キーをダウンロードできるのは
今回のみです

00:05:10.844 --> 00:05:13.313 align:start position:30% line:-1
すぐ安全な場所に保存を

00:05:14.481 --> 00:05:17.551 align:start position:32% line:-2
キーを損失 または
不正侵入された場合は

00:05:17.651 --> 00:05:22.623 align:start position:9% line:-2
常時 Apple Developerのサイトで
無効にして新規キーを作成できます

00:05:25.192 --> 00:05:27.461 align:start position:29% line:-2
MapKit JSキーが
作成されました

00:05:27.928 --> 00:05:33.467 align:start position:20% line:-2
次にMapKit JSの認証に使う
認証トークンを作成します

00:05:36.170 --> 00:05:39.740 align:start position:27% line:-2
デベロッパクレデンシャルを
含めて作成され

00:05:39.840 --> 00:05:42.242 align:start position:29% line:-2
認証キーファイルとともに
署名されます

00:05:42.876 --> 00:05:48.615 align:start position:23% line:-2
トークンに追加されるクレームは
クライアント認証に使用されます

00:05:49.816 --> 00:05:53.654 align:start position:30% line:-2
作成方法を
詳しく見ていきましょう

00:05:55.255 --> 00:05:58.559 align:start position:21% line:-1
MapKit JS認証トークンは

00:05:58.725 --> 00:06:04.498 align:start position:7% line:-2
JSON Web Tokens RFC 7519
略してJWTに基づいています

00:05:58.725 --> 00:06:04.498 align:start position:7% line:-2
JSON Web Tokens RFC 7519
略してJWTに基づいています

00:06:04.865 --> 00:06:08.969 align:start position:25% line:-2
これはウェブ上の
認証クレーム送信に特化した―

00:06:09.069 --> 00:06:11.238 align:start position:30% line:-1
業界標準になっています

00:06:12.072 --> 00:06:16.476 align:start position:20% line:-1
詳細は jwt.ioをご覧ください

00:06:17.778 --> 00:06:23.717 align:start position:20% line:-2
大半のプログラム言語を網羅する
JWTトークン署名用のライブラリも

00:06:25.085 --> 00:06:28.889 align:start position:29% line:-2
全てのJWTトークンは
以下の３部分からなります

00:06:29.356 --> 00:06:34.127 align:start position:34% line:-2
ヘッダ ペイロード
そして署名です

00:06:34.928 --> 00:06:38.999 align:start position:21% line:-2
ピリオドで区切られ
Base64 URLでエンコード

00:06:39.099 --> 00:06:43.337 align:start position:27% line:-2
要求ヘッダに容易にパスされ
トークンを作成します

00:06:44.738 --> 00:06:49.376 align:start position:23% line:-2
認証トークンの推奨JWT構成が
２つあります

00:06:49.476 --> 00:06:52.579 align:start position:23% line:-1
短期トークンと長期トークンです

00:06:54.648 --> 00:06:56.717 align:start position:25% line:-1
短期トークンから始めましょう

00:06:56.950 --> 00:07:01.021 align:start position:30% line:-2
このタイプは不正に対し
最大の保護を提供し

00:06:56.950 --> 00:07:01.021 align:start position:30% line:-2
このタイプは不正に対し
最大の保護を提供し

00:07:01.221 --> 00:07:06.894 align:start position:25% line:-2
ソースコードがコピーされても
長期の使用を防ぎます

00:07:07.794 --> 00:07:11.532 align:start position:25% line:-2
このアプローチではサーバーに
エンドポイントを提供し

00:07:11.632 --> 00:07:15.302 align:start position:27% line:-2
MapKit JSの要求に
応える必要があります

00:07:15.602 --> 00:07:18.672 align:start position:30% line:-2
ユーザーセッション中に
認証する際には

00:07:18.772 --> 00:07:21.909 align:start position:29% line:-2
このエンドポイントからの
再読込が必要です

00:07:23.310 --> 00:07:27.848 align:start position:7% line:-2
まずペイロードは Apple
Developer Program IDである―

00:07:27.981 --> 00:07:30.951 align:start position:34% line:-2
ISSクレームを
含む必要があります

00:07:31.385 --> 00:07:36.890 align:start position:11% line:-2
チームIDはApple Developerの
サイトのアカウントセクションに

00:07:37.658 --> 00:07:43.630 align:start position:29% line:-2
認証トークン発行時を
秒表示したIATクレーム

00:07:44.398 --> 00:07:50.370 align:start position:25% line:-2
そして認証トークン有効期限を
秒表示したEXPクレーム

00:07:50.971 --> 00:07:54.007 align:start position:32% line:-2
短期トークンの場合は
30分を推奨します

00:07:54.441 --> 00:07:56.844 align:start position:29% line:-1
最後に起源のクレームです

00:07:57.010 --> 00:08:02.382 align:start position:21% line:-2
元のヘッダ文字列を一致させて
ブラウザへのアクセスを制限します

00:07:57.010 --> 00:08:02.382 align:start position:21% line:-2
元のヘッダ文字列を一致させて
ブラウザへのアクセスを制限します

00:08:02.983 --> 00:08:04.518 align:start position:36% line:-1
オプションですが

00:08:04.618 --> 00:08:09.156 align:start position:23% line:-2
特に制作中は 全ての
認証トークンでの使用を勧めます

00:08:10.390 --> 00:08:15.295 align:start position:25% line:-2
次は 前にダウンロードした
認証キーファイルのコンテンツ

00:08:15.629 --> 00:08:19.800 align:start position:27% line:-2
余白 ヘッダ フッタを含む
このフルファイルは

00:08:19.900 --> 00:08:22.135 align:start position:34% line:-2
トークンへの署名に
使われます

00:08:22.269 --> 00:08:26.173 align:start position:29% line:-2
プログラミング言語固有の
指示については

00:08:26.273 --> 00:08:29.443 align:start position:29% line:-2
JWT署名ライブラリの
マニュアルをご覧ください

00:08:30.043 --> 00:08:34.481 align:start position:29% line:-2
最後に JWTトークンの
ヘッダセクションには

00:08:34.581 --> 00:08:39.119 align:start position:21% line:-2
MapKit JSキーIDである
KIDクレームが含まれます

00:08:39.486 --> 00:08:42.422 align:start position:25% line:-1
これはマップIDとは違います

00:08:43.222 --> 00:08:46.493 align:start position:36% line:-2
TYPクレームは
文字列JWTで

00:08:46.593 --> 00:08:50.430 align:start position:27% line:-2
JWTスタイルのトークンを
識別します

00:08:50.797 --> 00:08:55.102 align:start position:30% line:-2
ALGクレームは
ハッシングアルゴリズム

00:08:55.502 --> 00:08:58.605 align:start position:32% line:-2
これは ES256に
設定する必要があり

00:09:00.040 --> 00:09:03.544 align:start position:30% line:-2
JWT署名ライブラリに
パスされると

00:09:03.644 --> 00:09:08.382 align:start position:23% line:-2
MapKit JSが使用可能な
JWTトークンが出力されます

00:09:08.515 --> 00:09:12.619 align:start position:29% line:-2
短期トークンの有効期限が
セッション中に切れた時は

00:09:12.719 --> 00:09:18.492 align:start position:21% line:-2
サーバーはMapKit JSへの
エンドポイントの提供が必要です

00:09:18.826 --> 00:09:23.230 align:start position:29% line:-2
エンドポイント認識方法は
後ほど示すとして

00:09:23.330 --> 00:09:28.101 align:start position:23% line:-2
エクスプレスJSルートの
エンドポイント例をお見せします

00:09:28.502 --> 00:09:32.239 align:start position:34% line:-2
このルートは
呼び出されるたびに

00:09:32.339 --> 00:09:36.677 align:start position:25% line:-2
30分後に期限が切れる新しい
アクセストークンを返します

00:09:36.844 --> 00:09:41.248 align:start position:25% line:-2
トークンの期限にかかわらず
セッション中に認証が必要なら

00:09:41.348 --> 00:09:45.252 align:start position:25% line:-2
MapKit JSが この
エンドポイントを呼び出します

00:09:46.687 --> 00:09:50.657 align:start position:30% line:-2
呼び出されるたびに
新規トークンを返すため

00:09:50.757 --> 00:09:53.594 align:start position:30% line:-2
ブラウザのキャッシュを
止めましょう

00:09:53.760 --> 00:09:57.130 align:start position:23% line:-2
キャッシュコントロールヘッダで
設定できます

00:09:57.698 --> 00:10:03.337 align:start position:27% line:-2
サーバー上に このような
トークンのルートが現れます

00:09:57.698 --> 00:10:03.337 align:start position:27% line:-2
サーバー上に このような
トークンのルートが現れます

00:10:05.439 --> 00:10:09.543 align:start position:32% line:-2
一方 長期トークンは
有効期限がずっと長く

00:10:09.776 --> 00:10:14.181 align:start position:25% line:-2
多くの要求に対して
同じトークンが長期間使えます

00:10:14.348 --> 00:10:17.117 align:start position:34% line:-2
このタイプは
サーバーが不要です

00:10:17.217 --> 00:10:20.988 align:start position:29% line:-2
セッション中にトークンの
期限が切れにくいため―

00:10:21.922 --> 00:10:27.361 align:start position:25% line:-2
静的ウェブサイトや
開発環境で簡単に使用できます

00:10:27.895 --> 00:10:33.000 align:start position:23% line:-2
また有効期限や更新が
リリースサイクルと同期可能です

00:10:33.200 --> 00:10:37.437 align:start position:30% line:-2
起源のクレームの添付を
強く推奨します

00:10:37.604 --> 00:10:38.939 align:start position:41% line:-1
次の方法で

00:10:40.274 --> 00:10:44.912 align:start position:29% line:-2
この例では長期トークンの
有効期限を６か月に設定

00:10:45.245 --> 00:10:49.082 align:start position:25% line:-2
前に説明したように
ニーズに応じた調整が可能です

00:10:49.249 --> 00:10:52.753 align:start position:27% line:-2
チームのリリースサイクルが
２週間の場合は

00:10:52.853 --> 00:10:58.258 align:start position:27% line:-2
それに同期させるか
数週間の猶予を追加できます

00:10:59.526 --> 00:11:06.033 align:start position:25% line:-2
特に長期トークンの場合は
起源のクレームが推奨されます

00:10:59.526 --> 00:11:06.033 align:start position:25% line:-2
特に長期トークンの場合は
起源のクレームが推奨されます

00:11:06.133 --> 00:11:09.636 align:start position:27% line:-2
クレデンシャル悪用に対する
最大の防御です

00:11:11.171 --> 00:11:14.341 align:start position:29% line:-2
トークンが用意できたので
マップの作成を

00:11:15.475 --> 00:11:18.879 align:start position:29% line:-2
最も簡単なのは
HTMLページの作成です

00:11:19.112 --> 00:11:24.818 align:start position:23% line:-2
MapKit JSへリンクする
スクリプトタグを含めます

00:11:26.019 --> 00:11:31.124 align:start position:25% line:-2
トークンエンドポイントを
認識させると言いましたよね？

00:11:31.925 --> 00:11:37.130 align:start position:23% line:-2
初期化の際にコールバック関数を
指定する時に起こります

00:11:37.464 --> 00:11:43.770 align:start position:23% line:-2
短期トークンではセッション中に
新しいトークンをフェッチします

00:11:46.206 --> 00:11:50.277 align:start position:25% line:-2
MapKit JSが
コールバック関数を呼び出す時

00:11:50.377 --> 00:11:54.414 align:start position:30% line:-2
done関数を呼び出す
関数をパスします

00:11:55.048 --> 00:11:57.584 align:start position:30% line:-2
この関数を
新規トークンで呼び出し

00:11:57.684 --> 00:12:01.955 align:start position:20% line:-2
MapKit JSが認証プロセスを
進められるようにします

00:11:57.684 --> 00:12:01.955 align:start position:20% line:-2
MapKit JSが認証プロセスを
進められるようにします

00:12:03.223 --> 00:12:07.528 align:start position:25% line:-2
長期トークンでは
認証コールバック関数の本文で

00:12:07.661 --> 00:12:10.564 align:start position:32% line:-2
直ちにdone関数を
呼び出します

00:12:11.031 --> 00:12:14.034 align:start position:32% line:-2
MapKit JSは
同じ長期トークンを―

00:12:14.134 --> 00:12:17.738 align:start position:32% line:-2
認証を再読込する際に
使用します

00:12:19.473 --> 00:12:23.544 align:start position:29% line:-2
最後に マップコンテナと
マップの中心の設定です

00:12:25.779 --> 00:12:29.049 align:start position:32% line:-2
サーバーを起動して
実際に見てみましょう

00:12:31.051 --> 00:12:35.189 align:start position:23% line:-2
設定が正しければ
ブラウザにマップが表示されます

00:12:36.490 --> 00:12:39.893 align:start position:32% line:-2
ウェブインスペクタで
短期トークン使用なら

00:12:39.993 --> 00:12:43.630 align:start position:27% line:-2
サーバーのエンドポイントが
呼び出され

00:12:43.697 --> 00:12:45.999 align:start position:29% line:-1
認証トークンが返されます

00:12:46.767 --> 00:12:50.838 align:start position:20% line:-2
MapKit JSに認証が付与され
残りの作業へ

00:12:51.004 --> 00:12:56.143 align:start position:18% line:-2
MapKit JSは 随時ルートから
新規トークンを要求します

00:12:57.778 --> 00:13:01.281 align:start position:27% line:-2
以上がMapKit JSの
認証方法です

00:12:57.778 --> 00:13:01.281 align:start position:27% line:-2
以上がMapKit JSの
認証方法です

00:13:02.015 --> 00:13:04.618 align:start position:21% line:-1
MapKit JSキーの作成方法

00:13:05.252 --> 00:13:07.688 align:start position:29% line:-1
認証トークンの作成方法と

00:13:07.788 --> 00:13:12.526 align:start position:27% line:-2
新規トークンを用いた
マップの初期化を学びました

00:13:14.228 --> 00:13:18.899 align:start position:20% line:-2
MapKit JSキーを取得したら
安全な場所に保管しましょう

00:13:19.032 --> 00:13:22.269 align:start position:32% line:-2
認証トークンの送信は
ウェブ上だけにします

00:13:22.736 --> 00:13:27.341 align:start position:29% line:-2
不正使用された場合は
ウェブサイトを差し替えて

00:13:27.441 --> 00:13:31.278 align:start position:14% line:-2
キーは Apple Developerの
サイトで無効にします

00:13:32.746 --> 00:13:34.348 align:start position:38% line:-1
詳細の確認は―

00:13:34.481 --> 00:13:42.089 align:start position:14% line:-2
developer.apple.com/
wwdc18/508で

00:13:43.490 --> 00:13:46.326 align:start position:25% line:-2
MapKit JSを紹介する
セッションは

00:13:46.426 --> 00:13:50.264 align:start position:27% line:-2
エグゼクティブボールルーム
火曜日の午後５時です

00:13:50.797 --> 00:13:51.765 align:start position:45% line:-1
どうも
