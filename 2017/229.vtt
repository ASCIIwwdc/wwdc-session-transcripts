WEBVTT

00:00:20.516 --> 00:00:23.546 A:middle
[ Applause ]

00:00:24.046 --> 00:00:25.186 A:middle
&gt;&gt; Hello, everyone.

00:00:26.306 --> 00:00:27.856 A:middle
I hope you're having a great

00:00:27.856 --> 00:00:28.206 A:middle
WWDC.

00:00:28.206 --> 00:00:31.156 A:middle
Welcome to Building Great

00:00:31.216 --> 00:00:32.936 A:middle
Document-based Apps.

00:00:33.946 --> 00:00:35.736 A:middle
Today we are going to talk about

00:00:35.736 --> 00:00:37.406 A:middle
all the new features of the

00:00:37.406 --> 00:00:38.756 A:middle
Files app and how to integrate

00:00:38.756 --> 00:00:40.196 A:middle
them in your app.

00:00:40.576 --> 00:00:41.936 A:middle
First, let's talk about the

00:00:41.936 --> 00:00:43.336 A:middle
Files app.

00:00:43.866 --> 00:00:45.336 A:middle
One of the biggest features of

00:00:45.336 --> 00:00:47.246 A:middle
this app is that it gathers all

00:00:47.246 --> 00:00:48.636 A:middle
the cloud vendors in one place.

00:00:49.306 --> 00:00:50.806 A:middle
This is done thanks to the new

00:00:50.806 --> 00:00:51.826 A:middle
file provider extension.

00:00:52.416 --> 00:00:54.116 A:middle
All the cloud vendors that use

00:00:54.116 --> 00:00:55.546 A:middle
this file provider extension

00:00:55.606 --> 00:00:58.506 A:middle
will appear next to the iCloud

00:00:58.506 --> 00:00:59.896 A:middle
drive on my iPad in the sidebar.

00:01:00.436 --> 00:01:02.216 A:middle
If you want to know more about

00:01:02.216 --> 00:01:04.316 A:middle
this extension, we invite you to

00:01:04.316 --> 00:01:05.256 A:middle
check out the File Provider

00:01:05.256 --> 00:01:06.766 A:middle
Enhancements session tomorrow at

00:01:06.766 --> 00:01:10.706 A:middle
11:00 a.m. There are two file

00:01:11.156 --> 00:01:12.426 A:middle
providers by default in the

00:01:12.426 --> 00:01:12.796 A:middle
system.

00:01:13.266 --> 00:01:14.106 A:middle
The first one is the iCloud

00:01:14.106 --> 00:01:15.226 A:middle
Drive provider.

00:01:15.806 --> 00:01:16.996 A:middle
It will show all the files

00:01:16.996 --> 00:01:18.256 A:middle
inside the iCloud drive folder

00:01:18.256 --> 00:01:20.116 A:middle
of the user as well as all the

00:01:20.176 --> 00:01:21.766 A:middle
files in the Cloud container of

00:01:21.766 --> 00:01:23.076 A:middle
all the applications in the

00:01:23.076 --> 00:01:23.456 A:middle
system.

00:01:24.016 --> 00:01:27.366 A:middle
The second provider is the on my

00:01:27.366 --> 00:01:28.066 A:middle
iPad provider.

00:01:28.726 --> 00:01:30.386 A:middle
It will let the user leverage

00:01:30.386 --> 00:01:31.656 A:middle
the storage of their devices.

00:01:31.656 --> 00:01:34.196 A:middle
It will show the content inside

00:01:34.196 --> 00:01:35.866 A:middle
the Documents folder of the app

00:01:35.866 --> 00:01:36.326 A:middle
container.

00:01:36.406 --> 00:01:38.606 A:middle
If you want your app to be part

00:01:38.606 --> 00:01:40.836 A:middle
of this local storage provider,

00:01:41.196 --> 00:01:42.046 A:middle
your app needs to be a

00:01:42.046 --> 00:01:44.596 A:middle
document-based app or support

00:01:44.766 --> 00:01:46.596 A:middle
File Sharing and Opening

00:01:46.596 --> 00:01:47.266 A:middle
Documents In Place.

00:01:48.116 --> 00:01:49.756 A:middle
As I said before, we are going

00:01:49.756 --> 00:01:51.106 A:middle
to be showing the documents

00:01:51.106 --> 00:01:52.526 A:middle
inside the, the files inside the

00:01:52.526 --> 00:01:53.186 A:middle
Documents folder.

00:01:53.666 --> 00:01:55.716 A:middle
So please keep the content of

00:01:55.716 --> 00:01:56.666 A:middle
this folder clean.

00:01:57.146 --> 00:01:58.676 A:middle
You should only have the files

00:01:58.676 --> 00:01:59.556 A:middle
that matter to the user.

00:02:00.536 --> 00:02:01.916 A:middle
Also, you have to keep in mind

00:02:02.276 --> 00:02:03.546 A:middle
that these files won't be synced

00:02:03.546 --> 00:02:05.166 A:middle
across multiple devices but

00:02:05.276 --> 00:02:07.246 A:middle
still will be part of the iCloud

00:02:07.246 --> 00:02:08.126 A:middle
backup.

00:02:09.406 --> 00:02:11.166 A:middle
Now I would like to talk about

00:02:11.266 --> 00:02:12.296 A:middle
the new Recents view.

00:02:13.286 --> 00:02:14.466 A:middle
This view will show all the

00:02:14.466 --> 00:02:15.606 A:middle
documents that have been

00:02:15.606 --> 00:02:17.426 A:middle
recently opened, imported, and

00:02:17.426 --> 00:02:17.896 A:middle
modified.

00:02:18.686 --> 00:02:20.166 A:middle
Also, it will show all the

00:02:20.166 --> 00:02:22.656 A:middle
documents organized by tags and

00:02:22.756 --> 00:02:23.786 A:middle
all the documents that are

00:02:23.786 --> 00:02:24.696 A:middle
shared with other people.

00:02:27.076 --> 00:02:29.466 A:middle
Tags are a great means to

00:02:29.466 --> 00:02:30.046 A:middle
organize files.

00:02:30.046 --> 00:02:32.236 A:middle
And in iOS 11, there's new

00:02:32.236 --> 00:02:33.736 A:middle
tagging UI that will let the

00:02:33.736 --> 00:02:35.916 A:middle
user create new tag and manage

00:02:35.956 --> 00:02:36.556 A:middle
their tags.

00:02:37.436 --> 00:02:38.666 A:middle
Tags will be synced across

00:02:38.666 --> 00:02:41.086 A:middle
multiple providers and they will

00:02:41.086 --> 00:02:42.576 A:middle
be also synced across all your

00:02:42.576 --> 00:02:43.046 A:middle
devices.

00:02:45.576 --> 00:02:46.946 A:middle
The last thing -- The last

00:02:46.946 --> 00:02:48.726 A:middle
feature I would like to talk

00:02:48.726 --> 00:02:50.316 A:middle
about in the Files App is the

00:02:50.316 --> 00:02:51.016 A:middle
Recents Popover.

00:02:51.836 --> 00:02:53.526 A:middle
The user will be able to present

00:02:53.526 --> 00:02:55.226 A:middle
this popover when performing a

00:02:55.226 --> 00:02:57.466 A:middle
long press on the Files App.

00:02:57.686 --> 00:02:59.206 A:middle
This [inaudible] will show all

00:02:59.206 --> 00:03:00.656 A:middle
the recent documents and the

00:03:00.656 --> 00:03:02.276 A:middle
user will be able to open them

00:03:02.276 --> 00:03:03.456 A:middle
with just one tap.

00:03:03.946 --> 00:03:06.196 A:middle
It will also let the user import

00:03:06.196 --> 00:03:07.396 A:middle
the document into any

00:03:07.396 --> 00:03:09.756 A:middle
application using the new Drag

00:03:10.336 --> 00:03:13.366 A:middle
and Drop gesture.

00:03:13.416 --> 00:03:15.176 A:middle
I'm sure now you want to have

00:03:15.176 --> 00:03:16.556 A:middle
all these great features in your

00:03:17.246 --> 00:03:17.506 A:middle
app.

00:03:19.176 --> 00:03:21.036 A:middle
Throughout the last release

00:03:21.036 --> 00:03:22.546 A:middle
cycles, we've received very many

00:03:22.546 --> 00:03:23.156 A:middle
requests from you.

00:03:24.376 --> 00:03:26.076 A:middle
You want to have a unified UI

00:03:26.436 --> 00:03:27.196 A:middle
for file browsing.

00:03:28.426 --> 00:03:29.746 A:middle
You want your app to be able to

00:03:29.746 --> 00:03:31.876 A:middle
access any file from other apps

00:03:31.956 --> 00:03:32.546 A:middle
in the system.

00:03:33.176 --> 00:03:36.236 A:middle
You don't want to write more

00:03:36.236 --> 00:03:38.266 A:middle
code in order to adopt all the

00:03:38.266 --> 00:03:39.586 A:middle
cloud vendors that are already

00:03:39.586 --> 00:03:40.386 A:middle
part of the system.

00:03:41.656 --> 00:03:42.816 A:middle
And you want to have deeper

00:03:42.816 --> 00:03:46.096 A:middle
integration of your custom

00:03:46.096 --> 00:03:47.996 A:middle
content types throughout system.

00:03:48.986 --> 00:03:51.016 A:middle
Well today we are going to view

00:03:51.016 --> 00:03:51.886 A:middle
some new API.

00:03:51.946 --> 00:03:54.636 A:middle
I will tell later how we've done

00:03:54.726 --> 00:03:56.416 A:middle
so far with those requests.

00:03:57.166 --> 00:03:59.936 A:middle
First, I would like to talk

00:03:59.936 --> 00:04:05.696 A:middle
about the new document browser

00:04:05.696 --> 00:04:06.186 A:middle
API.

00:04:06.296 --> 00:04:07.606 A:middle
This year there's a new class,

00:04:07.686 --> 00:04:09.046 A:middle
the UI Document Browser View

00:04:09.046 --> 00:04:09.446 A:middle
Controller.

00:04:09.566 --> 00:04:11.396 A:middle
I know it's a mouthful, so from

00:04:11.396 --> 00:04:12.396 A:middle
now on I will call it the

00:04:12.396 --> 00:04:13.746 A:middle
Browser VC.

00:04:14.556 --> 00:04:15.796 A:middle
Together with this, there's a

00:04:15.796 --> 00:04:17.766 A:middle
new Xcode template that will let

00:04:17.766 --> 00:04:19.776 A:middle
you create a new document-based

00:04:19.776 --> 00:04:20.886 A:middle
application from scratch.

00:04:22.146 --> 00:04:24.316 A:middle
And also the UI Document Picker

00:04:24.486 --> 00:04:25.926 A:middle
will get some of the features of

00:04:25.926 --> 00:04:27.386 A:middle
the Browser VC.

00:04:28.756 --> 00:04:30.356 A:middle
So now let's first talk about

00:04:30.356 --> 00:04:31.286 A:middle
the Browser View Controller.

00:04:32.356 --> 00:04:33.256 A:middle
This view controller will

00:04:33.256 --> 00:04:34.466 A:middle
provide your app the same

00:04:34.606 --> 00:04:36.786 A:middle
feature set as Files app.

00:04:36.786 --> 00:04:38.316 A:middle
In fact, Files is just a very

00:04:38.316 --> 00:04:39.616 A:middle
thin layer on top of this

00:04:39.616 --> 00:04:40.456 A:middle
Browser View Controller.

00:04:43.426 --> 00:04:44.796 A:middle
With this view controller, you

00:04:45.006 --> 00:04:47.096 A:middle
won't have to write more code in

00:04:47.096 --> 00:04:48.586 A:middle
order to integrate any cloud

00:04:48.586 --> 00:04:50.266 A:middle
storage provider that supports

00:04:50.266 --> 00:04:52.506 A:middle
File Provider.

00:04:53.976 --> 00:04:55.466 A:middle
Also it will support appearance

00:04:55.466 --> 00:04:57.236 A:middle
customization to make it look

00:04:57.236 --> 00:04:58.076 A:middle
like your app.

00:04:59.286 --> 00:05:01.036 A:middle
And by using this view

00:05:01.036 --> 00:05:02.986 A:middle
controller, your app will get

00:05:02.986 --> 00:05:04.536 A:middle
the Recents Popover that we saw

00:05:04.816 --> 00:05:05.176 A:middle
before.

00:05:05.846 --> 00:05:09.966 A:middle
Spotlight plays a key role in

00:05:09.966 --> 00:05:10.616 A:middle
this Browser VC.

00:05:11.536 --> 00:05:12.726 A:middle
By using this view controller,

00:05:13.556 --> 00:05:14.536 A:middle
all the metadata of your

00:05:14.536 --> 00:05:15.876 A:middle
document will automatically be

00:05:15.876 --> 00:05:16.666 A:middle
indexed in Spotlight.

00:05:16.666 --> 00:05:18.436 A:middle
If you need to have further

00:05:18.436 --> 00:05:19.826 A:middle
integration, you will have to

00:05:19.826 --> 00:05:21.626 A:middle
register your own CS Searchable

00:05:21.706 --> 00:05:21.976 A:middle
Items.

00:05:22.116 --> 00:05:24.426 A:middle
Now there will be two CS

00:05:24.426 --> 00:05:26.586 A:middle
Searchable Item in the system as

00:05:26.586 --> 00:05:28.266 A:middle
in order to duplicate them, the

00:05:28.266 --> 00:05:30.306 A:middle
Browser VC will use a content

00:05:30.356 --> 00:05:32.336 A:middle
URL of this CS Searchable Items.

00:05:32.676 --> 00:05:33.836 A:middle
So you have to set it properly.

00:05:34.256 --> 00:05:35.566 A:middle
If you want to know more about

00:05:35.566 --> 00:05:36.926 A:middle
Core Spotlight, there's a

00:05:36.926 --> 00:05:38.816 A:middle
session at 4:10 p.m. today.

00:05:42.736 --> 00:05:45.156 A:middle
At Apple, we deeply care about

00:05:45.156 --> 00:05:46.146 A:middle
our user's privacy.

00:05:46.616 --> 00:05:48.516 A:middle
Because of that, we built the

00:05:48.516 --> 00:05:50.156 A:middle
Browser View Controller with

00:05:50.286 --> 00:05:52.106 A:middle
privacy in mind since the very

00:05:52.106 --> 00:05:52.936 A:middle
beginning.

00:05:53.806 --> 00:05:55.856 A:middle
When the user installs your app,

00:05:55.856 --> 00:05:57.146 A:middle
you will only have access to all

00:05:57.146 --> 00:05:59.586 A:middle
the documents inside the app

00:06:00.176 --> 00:06:00.406 A:middle
container.

00:06:00.506 --> 00:06:02.106 A:middle
You will be able to import and

00:06:02.106 --> 00:06:03.876 A:middle
create new documents but only

00:06:03.876 --> 00:06:05.816 A:middle
the default safe location which

00:06:05.816 --> 00:06:06.846 A:middle
will be a [inaudible] for you.

00:06:08.436 --> 00:06:10.486 A:middle
So how are you going to access

00:06:10.486 --> 00:06:12.796 A:middle
to a file in any other place in

00:06:12.796 --> 00:06:13.236 A:middle
the system?

00:06:13.876 --> 00:06:15.436 A:middle
Well, you will do it via user

00:06:15.436 --> 00:06:16.126 A:middle
interaction.

00:06:16.646 --> 00:06:18.166 A:middle
The Browser VC is running in a

00:06:18.166 --> 00:06:18.976 A:middle
different process.

00:06:18.976 --> 00:06:20.766 A:middle
And once the user taps on a

00:06:20.766 --> 00:06:22.736 A:middle
document, the Browser VC will

00:06:22.826 --> 00:06:24.706 A:middle
forward to your app the access

00:06:24.706 --> 00:06:25.396 A:middle
of that document.

00:06:25.396 --> 00:06:28.396 A:middle
And now, let's take a look at

00:06:28.396 --> 00:06:29.926 A:middle
the UI Document Picker View

00:06:29.926 --> 00:06:30.326 A:middle
Controller.

00:06:30.406 --> 00:06:32.546 A:middle
As I said before, we'll get some

00:06:32.546 --> 00:06:34.366 A:middle
of the features of the Browser

00:06:34.366 --> 00:06:34.646 A:middle
VC.

00:06:34.876 --> 00:06:36.916 A:middle
For example, the Browse View and

00:06:36.966 --> 00:06:38.736 A:middle
the Recents View.

00:06:38.946 --> 00:06:40.676 A:middle
Also, it will support opening

00:06:40.676 --> 00:06:42.166 A:middle
and importing multiple documents

00:06:42.166 --> 00:06:42.746 A:middle
at the same time.

00:06:43.526 --> 00:06:44.666 A:middle
If you want to support it, you

00:06:44.666 --> 00:06:46.256 A:middle
need to set the allows Multiple

00:06:46.256 --> 00:06:47.026 A:middle
Selection to true.

00:06:48.106 --> 00:06:49.166 A:middle
In order to support multiple

00:06:49.166 --> 00:06:50.846 A:middle
documents, we are deprecating

00:06:51.126 --> 00:06:53.546 A:middle
the document picker with Pick

00:06:53.546 --> 00:06:55.136 A:middle
Document At URL delegate method

00:06:55.436 --> 00:06:56.766 A:middle
in favor of a delegate method

00:06:56.766 --> 00:06:58.556 A:middle
that support multiple URLs at

00:06:58.556 --> 00:07:00.066 A:middle
the same time.

00:07:01.276 --> 00:07:02.286 A:middle
Also this year, we are

00:07:02.286 --> 00:07:03.856 A:middle
deprecating the UI Document Menu

00:07:03.856 --> 00:07:05.616 A:middle
View Controller in favor of the

00:07:05.616 --> 00:07:06.796 A:middle
UI Document Browser View

00:07:06.796 --> 00:07:07.196 A:middle
Controller.

00:07:07.196 --> 00:07:12.206 A:middle
And now, we've seen an overview

00:07:12.206 --> 00:07:13.456 A:middle
of the browser APIs.

00:07:13.456 --> 00:07:14.986 A:middle
Let's take a look at how to make

00:07:14.986 --> 00:07:16.986 A:middle
use of this UI Document Browser

00:07:16.986 --> 00:07:18.596 A:middle
View Controller in your app.

00:07:19.766 --> 00:07:20.726 A:middle
So first things first.

00:07:21.486 --> 00:07:22.676 A:middle
You will have to configure the

00:07:22.676 --> 00:07:23.236 A:middle
Info.plist.

00:07:23.856 --> 00:07:25.686 A:middle
Here, you need to set the UI

00:07:25.686 --> 00:07:27.806 A:middle
Supports Document Browser key to

00:07:27.806 --> 00:07:28.066 A:middle
yes.

00:07:28.936 --> 00:07:30.656 A:middle
This will tell the system that

00:07:30.736 --> 00:07:32.326 A:middle
your app is a UI Document Brower

00:07:32.326 --> 00:07:33.076 A:middle
based application.

00:07:34.316 --> 00:07:35.936 A:middle
Then you will need to declare

00:07:36.076 --> 00:07:37.176 A:middle
the content types that are

00:07:37.176 --> 00:07:38.846 A:middle
supported by your app.

00:07:38.846 --> 00:07:39.986 A:middle
And this is important because

00:07:39.986 --> 00:07:42.196 A:middle
the Browser VC will use this

00:07:42.196 --> 00:07:43.686 A:middle
content type in order to know

00:07:43.686 --> 00:07:45.046 A:middle
what files to display in your

00:07:45.046 --> 00:07:45.536 A:middle
application.

00:07:46.176 --> 00:07:49.276 A:middle
It's important to note that the

00:07:49.276 --> 00:07:50.246 A:middle
UI Document Browser View

00:07:50.246 --> 00:07:52.176 A:middle
Controller needs to be the root

00:07:52.176 --> 00:07:53.906 A:middle
View Controller of your app.

00:07:53.906 --> 00:07:54.936 A:middle
It won't work otherwise.

00:07:55.756 --> 00:07:59.236 A:middle
As I said before, the Browser VC

00:07:59.236 --> 00:08:00.046 A:middle
supports appearance

00:08:00.046 --> 00:08:00.746 A:middle
customization.

00:08:01.246 --> 00:08:02.576 A:middle
By default, it will look like

00:08:02.576 --> 00:08:04.376 A:middle
this with a white background and

00:08:04.376 --> 00:08:05.016 A:middle
a blue tint color.

00:08:06.176 --> 00:08:07.756 A:middle
There are two properties that

00:08:07.756 --> 00:08:08.806 A:middle
you can use in order to

00:08:08.876 --> 00:08:09.746 A:middle
customize it further.

00:08:10.476 --> 00:08:12.076 A:middle
The browser Interface Style

00:08:12.076 --> 00:08:14.106 A:middle
which has three modes, dark,

00:08:14.106 --> 00:08:15.976 A:middle
white, and light, and tint

00:08:15.976 --> 00:08:16.266 A:middle
color.

00:08:16.326 --> 00:08:19.326 A:middle
If you use a dark style and an

00:08:19.326 --> 00:08:21.086 A:middle
orange tint color, your app will

00:08:21.086 --> 00:08:24.246 A:middle
look like this.

00:08:24.496 --> 00:08:26.176 A:middle
So now that we configured the

00:08:26.176 --> 00:08:28.266 A:middle
Browser VC, the first thing your

00:08:28.266 --> 00:08:29.676 A:middle
app will have to support is

00:08:29.676 --> 00:08:30.476 A:middle
Opening Documents.

00:08:31.686 --> 00:08:32.636 A:middle
So let's take a look at how it

00:08:32.636 --> 00:08:32.966 A:middle
works.

00:08:33.926 --> 00:08:36.486 A:middle
First, the user will tap on one

00:08:36.486 --> 00:08:37.196 A:middle
of these documents.

00:08:38.606 --> 00:08:40.686 A:middle
Here, the Browser VC will fetch

00:08:40.686 --> 00:08:42.136 A:middle
and download the information of

00:08:42.136 --> 00:08:42.676 A:middle
the document.

00:08:42.676 --> 00:08:44.606 A:middle
And once the document is ready,

00:08:44.676 --> 00:08:46.996 A:middle
it will forward the access to

00:08:46.996 --> 00:08:48.716 A:middle
your application and call the

00:08:48.716 --> 00:08:50.046 A:middle
did Pick Delegate method.

00:08:50.756 --> 00:08:53.066 A:middle
Here, you just need to load and

00:08:53.066 --> 00:08:56.416 A:middle
present the document.

00:08:56.416 --> 00:08:57.606 A:middle
When opening documents, the

00:08:57.606 --> 00:09:00.176 A:middle
Browser VC will give your app

00:09:00.176 --> 00:09:01.626 A:middle
persistent access to that URL.

00:09:02.996 --> 00:09:04.776 A:middle
Now, if you want to restore it,

00:09:04.776 --> 00:09:06.646 A:middle
it's not enough to store the

00:09:06.646 --> 00:09:06.716 A:middle
URL.

00:09:06.956 --> 00:09:08.256 A:middle
You need to store the bookmark

00:09:08.256 --> 00:09:10.176 A:middle
data associated to this URL

00:09:10.176 --> 00:09:11.596 A:middle
because this is the piece of

00:09:11.646 --> 00:09:13.866 A:middle
information that keeps track of

00:09:14.146 --> 00:09:15.126 A:middle
the URL access.

00:09:15.696 --> 00:09:18.856 A:middle
The code to Opening Document

00:09:18.986 --> 00:09:19.466 A:middle
looks like this.

00:09:19.606 --> 00:09:20.946 A:middle
You just need to implement the

00:09:20.946 --> 00:09:22.366 A:middle
document Browser did Pick

00:09:22.366 --> 00:09:24.936 A:middle
Document URLs and present the

00:09:24.936 --> 00:09:25.856 A:middle
view controller for the

00:09:25.856 --> 00:09:26.266 A:middle
document.

00:09:26.826 --> 00:09:30.156 A:middle
Like the UI Document Picker, the

00:09:30.156 --> 00:09:31.726 A:middle
Browser VC supports opening

00:09:31.726 --> 00:09:32.896 A:middle
multiple documents at the same

00:09:32.896 --> 00:09:33.096 A:middle
time.

00:09:33.856 --> 00:09:35.466 A:middle
If you want your app to support

00:09:35.466 --> 00:09:36.956 A:middle
this, you need to set the allows

00:09:36.956 --> 00:09:41.396 A:middle
Picking Multiple Items to true.

00:09:41.616 --> 00:09:42.886 A:middle
Now that your app is able to

00:09:42.886 --> 00:09:45.626 A:middle
open any file in the system, the

00:09:45.626 --> 00:09:46.866 A:middle
next thing is to be able to

00:09:46.866 --> 00:09:47.846 A:middle
create new documents.

00:09:48.466 --> 00:09:49.816 A:middle
There are two places where you

00:09:49.816 --> 00:09:50.926 A:middle
can create new documents.

00:09:51.616 --> 00:09:52.686 A:middle
The first one is the Recents

00:09:52.686 --> 00:09:52.846 A:middle
View.

00:09:53.566 --> 00:09:54.726 A:middle
If the user taps the Create

00:09:54.726 --> 00:09:56.926 A:middle
button here, it will create a

00:09:57.146 --> 00:09:59.186 A:middle
new document in the default safe

00:09:59.186 --> 00:10:01.386 A:middle
location of your app.

00:10:01.386 --> 00:10:02.676 A:middle
If you tap the Create button in

00:10:02.676 --> 00:10:04.216 A:middle
the Browse View, it will create

00:10:04.216 --> 00:10:05.106 A:middle
a new document in the current

00:10:05.106 --> 00:10:05.966 A:middle
location of the Browse View.

00:10:06.056 --> 00:10:08.836 A:middle
Now let's take a look at the

00:10:08.836 --> 00:10:09.256 A:middle
workflow.

00:10:10.246 --> 00:10:11.666 A:middle
Once the user taps on one of

00:10:11.666 --> 00:10:13.346 A:middle
these Create buttons, your app

00:10:13.896 --> 00:10:15.646 A:middle
will receive an import handler.

00:10:16.346 --> 00:10:17.446 A:middle
Now if you already have the

00:10:17.446 --> 00:10:18.996 A:middle
source URL, you can call the

00:10:18.996 --> 00:10:19.606 A:middle
import handler.

00:10:20.496 --> 00:10:22.476 A:middle
If not, if your app needs to

00:10:22.476 --> 00:10:24.076 A:middle
show some template chooser in

00:10:24.076 --> 00:10:26.136 A:middle
order to know what source URL to

00:10:26.136 --> 00:10:27.816 A:middle
choose, now is the moment.

00:10:28.376 --> 00:10:29.506 A:middle
You present a template chooser

00:10:29.656 --> 00:10:30.966 A:middle
and call the import handler.

00:10:31.586 --> 00:10:34.066 A:middle
The import handler will move

00:10:34.066 --> 00:10:35.186 A:middle
that file to the provider.

00:10:35.256 --> 00:10:37.036 A:middle
And once the file is in the

00:10:37.036 --> 00:10:38.706 A:middle
provider, it will call you back

00:10:38.876 --> 00:10:40.366 A:middle
with a succeed delegate method.

00:10:41.086 --> 00:10:43.306 A:middle
Here, as for the open case, you

00:10:43.306 --> 00:10:44.646 A:middle
just need to load and present

00:10:44.776 --> 00:10:45.306 A:middle
the document.

00:10:46.066 --> 00:10:48.876 A:middle
Now the import operation can

00:10:48.936 --> 00:10:50.616 A:middle
fail for many reasons.

00:10:50.886 --> 00:10:51.936 A:middle
And if that is the case, you

00:10:52.126 --> 00:10:53.566 A:middle
need to handle the error and

00:10:53.566 --> 00:10:54.716 A:middle
present some UI to the user.

00:10:55.836 --> 00:10:58.246 A:middle
Now let's take a look at how to

00:10:58.356 --> 00:10:58.806 A:middle
code this.

00:10:59.566 --> 00:11:01.046 A:middle
First you need to implement the

00:11:01.046 --> 00:11:02.456 A:middle
document Browser did Request

00:11:02.456 --> 00:11:03.246 A:middle
Document Creation.

00:11:03.976 --> 00:11:05.686 A:middle
Here, as I said before, you can

00:11:05.686 --> 00:11:06.906 A:middle
optionally present a Template

00:11:06.906 --> 00:11:07.416 A:middle
Chooser.

00:11:08.056 --> 00:11:09.676 A:middle
Now in this example, the present

00:11:09.676 --> 00:11:11.396 A:middle
Template Chooser will call us

00:11:11.396 --> 00:11:14.516 A:middle
back with the URL that the user

00:11:14.896 --> 00:11:15.866 A:middle
picked for the template.

00:11:15.866 --> 00:11:17.746 A:middle
And it will tell us if the user

00:11:17.746 --> 00:11:19.356 A:middle
canceled the document creation.

00:11:20.016 --> 00:11:22.266 A:middle
Once we get the URL, we just

00:11:22.266 --> 00:11:24.426 A:middle
need to call the import handler

00:11:24.426 --> 00:11:25.096 A:middle
with a mode.

00:11:25.446 --> 00:11:26.566 A:middle
There are two different modes:

00:11:26.866 --> 00:11:27.956 A:middle
copy and move.

00:11:28.436 --> 00:11:29.776 A:middle
If the user canceled the

00:11:29.776 --> 00:11:31.396 A:middle
document creation, we still need

00:11:31.396 --> 00:11:33.176 A:middle
to call the import handler with

00:11:33.176 --> 00:11:34.676 A:middle
nil as the URL and none as the

00:11:34.676 --> 00:11:34.936 A:middle
mode.

00:11:35.616 --> 00:11:36.386 A:middle
This is important.

00:11:36.816 --> 00:11:38.146 A:middle
This will tell the Browser VC

00:11:38.766 --> 00:11:40.156 A:middle
that the creation operation is

00:11:40.156 --> 00:11:40.486 A:middle
over.

00:11:41.176 --> 00:11:44.716 A:middle
Once the document is fully

00:11:44.716 --> 00:11:46.326 A:middle
imported, the document Browser

00:11:46.326 --> 00:11:47.946 A:middle
did Import Document At source

00:11:47.946 --> 00:11:49.876 A:middle
URL to Destination URL will be

00:11:49.876 --> 00:11:50.116 A:middle
called.

00:11:50.696 --> 00:11:52.606 A:middle
Here, you just need to load and

00:11:52.606 --> 00:11:54.466 A:middle
present the UI for the document.

00:11:54.886 --> 00:11:56.576 A:middle
As I said before, the import

00:11:56.576 --> 00:11:57.376 A:middle
operation can fail.

00:11:57.436 --> 00:12:00.036 A:middle
And if that is the case, the

00:12:00.036 --> 00:12:01.306 A:middle
Document Browser failed To

00:12:01.306 --> 00:12:03.196 A:middle
Import Document URL will be

00:12:03.196 --> 00:12:03.426 A:middle
called.

00:12:03.746 --> 00:12:04.936 A:middle
Here, you need to handle the

00:12:04.936 --> 00:12:06.296 A:middle
error and present some UI to the

00:12:06.296 --> 00:12:06.566 A:middle
user.

00:12:09.186 --> 00:12:10.976 A:middle
Now we are dealing with

00:12:10.976 --> 00:12:12.556 A:middle
documents that are operated by

00:12:12.556 --> 00:12:14.516 A:middle
different processes, different

00:12:14.516 --> 00:12:16.456 A:middle
apps, and different devices at

00:12:16.456 --> 00:12:16.976 A:middle
the same time.

00:12:18.376 --> 00:12:19.206 A:middle
And because of that, it's

00:12:19.206 --> 00:12:20.516 A:middle
important to use NS File

00:12:20.516 --> 00:12:22.026 A:middle
Coordination and NS File

00:12:22.026 --> 00:12:24.976 A:middle
Presenter in order to avoid risk

00:12:24.976 --> 00:12:25.946 A:middle
conditions between these

00:12:25.976 --> 00:12:26.406 A:middle
processes.

00:12:27.616 --> 00:12:29.746 A:middle
Now because the document is

00:12:29.746 --> 00:12:31.846 A:middle
outside your app container, the

00:12:31.846 --> 00:12:32.896 A:middle
Browser VC is using

00:12:32.896 --> 00:12:34.786 A:middle
Security-scoped URLs, which

00:12:34.786 --> 00:12:36.506 A:middle
means you have to start and stop

00:12:36.506 --> 00:12:38.456 A:middle
accessing that URL in order to

00:12:38.456 --> 00:12:40.656 A:middle
have the right to write and read

00:12:40.696 --> 00:12:41.146 A:middle
the URL.

00:12:42.126 --> 00:12:43.316 A:middle
We highly encourage you to use

00:12:43.316 --> 00:12:43.856 A:middle
UI Document.

00:12:44.706 --> 00:12:46.796 A:middle
By using it, you will get File

00:12:46.796 --> 00:12:48.416 A:middle
Coordination, File Presenter,

00:12:48.416 --> 00:12:50.216 A:middle
and Security-scoped URL support

00:12:50.286 --> 00:12:51.796 A:middle
for free, as well as other

00:12:51.796 --> 00:12:52.846 A:middle
features like Autosave.

00:12:53.536 --> 00:12:55.326 A:middle
If you want to know more about

00:12:55.326 --> 00:12:57.206 A:middle
UI Document, please take a look

00:12:57.206 --> 00:12:58.456 A:middle
at the Building Document-Based

00:12:58.456 --> 00:13:01.406 A:middle
Apps session from WWDC 2015.

00:13:02.626 --> 00:13:03.596 A:middle
And now I would like to

00:13:03.596 --> 00:13:04.776 A:middle
introduce my colleague Raffeal

00:13:05.126 --> 00:13:06.606 A:middle
to give you a demo on how to use

00:13:06.736 --> 00:13:07.836 A:middle
the UI Document Browser View

00:13:07.836 --> 00:13:09.156 A:middle
Controller in your app.

00:13:09.676 --> 00:13:09.946 A:middle
Raffael

00:13:10.016 --> 00:13:11.816 A:middle
[ Applause ]

00:13:11.816 --> 00:13:13.616 A:middle
.

00:13:13.616 --> 00:13:14.136 A:middle
&gt;&gt; Thanks, Pau.

00:13:15.266 --> 00:13:16.026 A:middle
Good morning, everyone.

00:13:17.456 --> 00:13:18.646 A:middle
So now that you've got to know

00:13:18.646 --> 00:13:20.386 A:middle
the API of the new UI Document

00:13:20.386 --> 00:13:21.786 A:middle
Browser View Controller, I would

00:13:21.786 --> 00:13:22.766 A:middle
like to walk you through and

00:13:22.766 --> 00:13:24.756 A:middle
show a demo of how easy it is to

00:13:24.756 --> 00:13:26.366 A:middle
build a great document-based app

00:13:26.626 --> 00:13:27.486 A:middle
for iOS 11.

00:13:28.056 --> 00:13:30.466 A:middle
We're going to build a very

00:13:30.466 --> 00:13:32.066 A:middle
simple particle editor with a

00:13:32.066 --> 00:13:34.096 A:middle
particle system on the left and

00:13:34.096 --> 00:13:35.346 A:middle
an inspect on the right side

00:13:35.346 --> 00:13:36.486 A:middle
that allows you to customize

00:13:36.486 --> 00:13:37.636 A:middle
some properties of the particle

00:13:37.636 --> 00:13:38.016 A:middle
system.

00:13:38.966 --> 00:13:40.706 A:middle
Now each particle system comes

00:13:40.706 --> 00:13:42.176 A:middle
within one document and,

00:13:42.176 --> 00:13:43.806 A:middle
therefore, using the UI Document

00:13:43.806 --> 00:13:45.156 A:middle
Browser View Controller is a

00:13:45.156 --> 00:13:46.406 A:middle
perfect choice for our

00:13:46.406 --> 00:13:46.936 A:middle
applications.

00:13:47.686 --> 00:13:48.746 A:middle
So now let's just switch to

00:13:48.746 --> 00:13:48.976 A:middle
Xcode.

00:13:59.016 --> 00:14:00.796 A:middle
Xcode 11 comes with a new

00:14:00.796 --> 00:14:02.216 A:middle
template for document-based

00:14:02.216 --> 00:14:02.886 A:middle
applications.

00:14:03.296 --> 00:14:03.936 A:middle
Let's try it out.

00:14:09.156 --> 00:14:11.096 A:middle
Going to call it particles and

00:14:11.096 --> 00:14:12.616 A:middle
create the new application.

00:14:14.236 --> 00:14:16.596 A:middle
Now once instantiated, this

00:14:16.636 --> 00:14:17.946 A:middle
template comes with everything

00:14:17.946 --> 00:14:18.886 A:middle
you need to build a

00:14:18.886 --> 00:14:20.326 A:middle
document-based application from

00:14:20.326 --> 00:14:20.816 A:middle
scratch.

00:14:21.656 --> 00:14:23.356 A:middle
First of all, the Info.plist of

00:14:23.356 --> 00:14:25.256 A:middle
our target is already set up the

00:14:25.256 --> 00:14:26.626 A:middle
way Pau mentioned it earlier

00:14:26.626 --> 00:14:27.516 A:middle
with the right key.

00:14:28.216 --> 00:14:30.336 A:middle
Next, we have a Document Browser

00:14:30.336 --> 00:14:32.066 A:middle
View Controller subclass that

00:14:32.066 --> 00:14:33.486 A:middle
has all the code already in

00:14:33.486 --> 00:14:34.756 A:middle
place that you might want to

00:14:34.756 --> 00:14:35.556 A:middle
customize later.

00:14:36.626 --> 00:14:38.306 A:middle
It also comes with a view

00:14:38.306 --> 00:14:39.716 A:middle
controller subclass, the

00:14:39.716 --> 00:14:41.396 A:middle
Document View Controller which

00:14:41.396 --> 00:14:42.786 A:middle
will be in charge of presenting

00:14:42.786 --> 00:14:46.386 A:middle
the contents of our files.

00:14:46.576 --> 00:14:48.686 A:middle
Next, as Pau mentioned also

00:14:48.686 --> 00:14:50.546 A:middle
earlier, we have the subclass of

00:14:50.546 --> 00:14:52.256 A:middle
UI Document that acts as the

00:14:52.256 --> 00:14:53.786 A:middle
model of our documents at

00:14:53.786 --> 00:14:54.106 A:middle
runtime.

00:14:55.506 --> 00:14:56.786 A:middle
And last but not least, our

00:14:56.786 --> 00:14:58.666 A:middle
storyboard is set up to have the

00:14:58.666 --> 00:15:00.246 A:middle
Document Browser View Controller

00:15:00.306 --> 00:15:01.396 A:middle
as the root View Controller

00:15:01.396 --> 00:15:03.546 A:middle
already set up and the Document

00:15:03.546 --> 00:15:04.826 A:middle
View Controller ready to be

00:15:04.826 --> 00:15:06.556 A:middle
instantiated when we create new

00:15:06.556 --> 00:15:08.296 A:middle
files or open existing files.

00:15:09.446 --> 00:15:10.536 A:middle
So let's just take a look at

00:15:10.536 --> 00:15:11.826 A:middle
what we get just by launching

00:15:11.826 --> 00:15:12.976 A:middle
this template in our simulator.

00:15:24.026 --> 00:15:26.506 A:middle
Now once started, we see the new

00:15:26.506 --> 00:15:28.566 A:middle
Recents view with your recent

00:15:28.566 --> 00:15:29.826 A:middle
documents that you might have

00:15:29.856 --> 00:15:30.616 A:middle
created before.

00:15:30.976 --> 00:15:32.056 A:middle
Of course, we haven't created

00:15:32.056 --> 00:15:33.616 A:middle
any files yet, so let's switch

00:15:33.616 --> 00:15:34.336 A:middle
to the Browse view.

00:15:34.876 --> 00:15:39.896 A:middle
We see our Cloud storage vendors

00:15:39.896 --> 00:15:41.106 A:middle
on the left side in the slide

00:15:41.166 --> 00:15:42.876 A:middle
bar next to the new On My iPad

00:15:42.876 --> 00:15:43.566 A:middle
storage.

00:15:44.226 --> 00:15:46.266 A:middle
We also see the Favorites and

00:15:46.336 --> 00:15:48.686 A:middle
our Tags that are synchronized

00:15:48.976 --> 00:15:50.356 A:middle
across all your devices.

00:15:51.236 --> 00:15:52.306 A:middle
In the middle of the screen, we

00:15:52.306 --> 00:15:53.796 A:middle
see a large Create Document

00:15:53.796 --> 00:15:55.766 A:middle
button that allows you to create

00:15:55.766 --> 00:15:56.556 A:middle
new documents.

00:15:56.596 --> 00:15:57.296 A:middle
So let's click it.

00:15:58.776 --> 00:16:00.316 A:middle
Well, nothing really happens yet

00:16:00.396 --> 00:16:01.346 A:middle
and that's expected.

00:16:01.426 --> 00:16:02.536 A:middle
That's because we haven't told

00:16:02.536 --> 00:16:03.746 A:middle
the UI Document Browser View

00:16:03.746 --> 00:16:05.626 A:middle
Controller yet what it means to

00:16:05.626 --> 00:16:06.946 A:middle
create new files in our

00:16:06.946 --> 00:16:07.516 A:middle
application.

00:16:08.126 --> 00:16:09.506 A:middle
So let's fix this.

00:16:10.356 --> 00:16:12.046 A:middle
Therefore, we switch back to our

00:16:12.046 --> 00:16:13.166 A:middle
UI Document Browser View

00:16:13.166 --> 00:16:14.266 A:middle
Controller subclass.

00:16:15.236 --> 00:16:16.436 A:middle
And as Pau mentioned earlier,

00:16:16.436 --> 00:16:18.186 A:middle
when the user tapes the Create

00:16:18.186 --> 00:16:19.776 A:middle
Document button, we'll get a

00:16:19.776 --> 00:16:21.326 A:middle
call back to the Document

00:16:21.326 --> 00:16:22.776 A:middle
Browser View Controller Delegate

00:16:22.776 --> 00:16:25.516 A:middle
function did Request Document

00:16:25.726 --> 00:16:26.726 A:middle
Creation With Handler.

00:16:27.816 --> 00:16:29.406 A:middle
Now what we have to do here is

00:16:30.006 --> 00:16:32.326 A:middle
we have to give back a URL of

00:16:32.366 --> 00:16:33.936 A:middle
the newly created file to the

00:16:33.936 --> 00:16:34.836 A:middle
Document Browser View

00:16:34.836 --> 00:16:35.296 A:middle
Controller.

00:16:36.846 --> 00:16:39.126 A:middle
Now in our situation, let me add

00:16:39.486 --> 00:16:41.936 A:middle
a new particles file to our

00:16:42.446 --> 00:16:42.666 A:middle
target.

00:16:43.556 --> 00:16:45.136 A:middle
We make sure that it's added to

00:16:45.136 --> 00:16:47.486 A:middle
our target and finish.

00:16:48.086 --> 00:16:53.126 A:middle
Now at runtime, we just go ahead

00:16:53.236 --> 00:16:55.736 A:middle
and obtain the URL of this added

00:16:55.846 --> 00:16:58.436 A:middle
document via our NS main bundle.

00:16:59.346 --> 00:17:01.576 A:middle
Once we get the URL, we pass it

00:17:01.576 --> 00:17:03.036 A:middle
to the input handler that we get

00:17:03.036 --> 00:17:04.636 A:middle
from our delegate function.

00:17:05.176 --> 00:17:07.106 A:middle
And we perform a copy operation

00:17:07.146 --> 00:17:07.576 A:middle
on the URL.

00:17:07.576 --> 00:17:11.016 A:middle
Now the UI Document Browser View

00:17:11.016 --> 00:17:13.166 A:middle
Controller will get this URL and

00:17:13.166 --> 00:17:14.376 A:middle
will do all the heavy lifting

00:17:14.376 --> 00:17:16.286 A:middle
for you in the background like

00:17:16.396 --> 00:17:17.466 A:middle
moving the file to the right

00:17:17.466 --> 00:17:19.316 A:middle
location and processing the URL.

00:17:20.326 --> 00:17:21.806 A:middle
Once it's done, it will give us

00:17:21.806 --> 00:17:25.266 A:middle
a call back to either did Import

00:17:25.266 --> 00:17:28.216 A:middle
Document At source URL or failed

00:17:28.216 --> 00:17:29.886 A:middle
To Import Document At URL.

00:17:30.666 --> 00:17:32.196 A:middle
Now if we fail to import the

00:17:32.196 --> 00:17:34.086 A:middle
newly created file, since we

00:17:34.086 --> 00:17:35.686 A:middle
want to be a good developer we

00:17:35.686 --> 00:17:37.136 A:middle
should go ahead and implement

00:17:37.216 --> 00:17:38.286 A:middle
proper error handling, for

00:17:38.286 --> 00:17:39.866 A:middle
example, by presenting an error

00:17:39.866 --> 00:17:40.646 A:middle
to the user.

00:17:41.706 --> 00:17:43.386 A:middle
However, if we succeeded, we can

00:17:43.386 --> 00:17:44.726 A:middle
go ahead and present the

00:17:44.726 --> 00:17:45.826 A:middle
document that we've just

00:17:45.826 --> 00:17:46.226 A:middle
created.

00:17:48.686 --> 00:17:50.436 A:middle
Now let's say the user has

00:17:50.486 --> 00:17:52.386 A:middle
picked an existing file, in that

00:17:52.386 --> 00:17:53.756 A:middle
situation, we're going to get a

00:17:53.756 --> 00:17:55.546 A:middle
call back to the did Pick

00:17:55.626 --> 00:17:57.056 A:middle
Document URLs function.

00:17:58.396 --> 00:18:00.546 A:middle
Same here, we just go ahead take

00:18:00.546 --> 00:18:02.086 A:middle
for example the first of our

00:18:02.086 --> 00:18:04.236 A:middle
document URLs that we get and

00:18:04.236 --> 00:18:04.766 A:middle
present it.

00:18:05.646 --> 00:18:07.586 A:middle
Now presenting a document in our

00:18:07.586 --> 00:18:10.036 A:middle
app means instantiating one of

00:18:10.066 --> 00:18:11.726 A:middle
these Document View Controllers

00:18:12.516 --> 00:18:15.136 A:middle
giving it a document that we

00:18:15.136 --> 00:18:16.726 A:middle
initialize with document URL

00:18:16.726 --> 00:18:18.596 A:middle
that we want to open and then we

00:18:18.596 --> 00:18:19.896 A:middle
just go ahead and present the

00:18:19.896 --> 00:18:20.866 A:middle
Document View Controller.

00:18:21.266 --> 00:18:22.276 A:middle
Now let's take a look at the

00:18:22.276 --> 00:18:22.976 A:middle
simulator again.

00:18:31.276 --> 00:18:32.956 A:middle
The app launches again.

00:18:33.016 --> 00:18:34.836 A:middle
We're in the Browse view and we

00:18:34.836 --> 00:18:36.086 A:middle
can tap the Create Document

00:18:36.086 --> 00:18:36.476 A:middle
button.

00:18:36.846 --> 00:18:38.046 A:middle
And the Document View Controller

00:18:38.046 --> 00:18:39.976 A:middle
appears with details about the

00:18:39.976 --> 00:18:41.156 A:middle
file that we've just created.

00:18:42.026 --> 00:18:43.296 A:middle
Once we are done, we can close

00:18:43.296 --> 00:18:44.356 A:middle
the Document View Controller

00:18:44.356 --> 00:18:46.396 A:middle
again to return to the root View

00:18:46.396 --> 00:18:48.226 A:middle
Controller or Document Browser

00:18:48.226 --> 00:18:48.846 A:middle
View Controller.

00:18:50.456 --> 00:18:52.416 A:middle
Now let me switch to a more

00:18:52.416 --> 00:18:54.126 A:middle
advanced version of this project

00:18:54.306 --> 00:18:55.656 A:middle
which has already all the code

00:18:55.696 --> 00:18:57.646 A:middle
pieces in place to render a

00:18:57.646 --> 00:18:59.546 A:middle
particle system on the left and

00:18:59.546 --> 00:19:01.216 A:middle
an editor on the right side so

00:19:01.216 --> 00:19:02.166 A:middle
that we can focus on the

00:19:02.166 --> 00:19:03.446 A:middle
Document Browser View Controller

00:19:03.446 --> 00:19:03.966 A:middle
related code parts.

00:19:11.586 --> 00:19:12.736 A:middle
Before I'm going to remove the

00:19:12.736 --> 00:19:14.646 A:middle
app that we've just created to

00:19:14.646 --> 00:19:15.976 A:middle
avoid any further conflicts.

00:19:25.056 --> 00:19:27.426 A:middle
Now this is still the same, it's

00:19:27.426 --> 00:19:28.306 A:middle
still the same project.

00:19:28.306 --> 00:19:30.326 A:middle
It's based on the template that

00:19:30.326 --> 00:19:31.986 A:middle
we've instantiated in the

00:19:31.986 --> 00:19:32.456 A:middle
beginning.

00:19:33.046 --> 00:19:34.206 A:middle
Let me show you some additions

00:19:34.206 --> 00:19:37.016 A:middle
that we made to our Particle app

00:19:37.216 --> 00:19:38.026 A:middle
Info.plist.

00:19:38.776 --> 00:19:41.746 A:middle
First, again, the key to

00:19:41.746 --> 00:19:42.976 A:middle
Document Browser View Controller

00:19:42.976 --> 00:19:44.646 A:middle
is still set to yes, just the

00:19:44.646 --> 00:19:45.886 A:middle
way Pau explained earlier.

00:19:47.116 --> 00:19:48.326 A:middle
But more than that, in the

00:19:48.326 --> 00:19:51.116 A:middle
Exported UTIs section, we are

00:19:51.116 --> 00:19:53.336 A:middle
creating a new UTI type for our

00:19:53.336 --> 00:19:54.456 A:middle
Particles files.

00:19:55.336 --> 00:19:56.286 A:middle
We're going to give it a

00:19:56.286 --> 00:19:57.406 A:middle
description particles.

00:19:58.356 --> 00:20:00.636 A:middle
We give it an identifier and we

00:20:00.636 --> 00:20:02.566 A:middle
let it conform to the UTI types

00:20:02.626 --> 00:20:04.746 A:middle
public data and public content.

00:20:06.166 --> 00:20:08.046 A:middle
That means our Particle files

00:20:08.176 --> 00:20:10.636 A:middle
are a stream of data and they

00:20:10.636 --> 00:20:12.536 A:middle
have a semantic of document

00:20:12.536 --> 00:20:12.846 A:middle
files.

00:20:14.476 --> 00:20:15.826 A:middle
Now in the additional exported

00:20:15.826 --> 00:20:18.956 A:middle
UTI properties, we defined that

00:20:18.956 --> 00:20:21.686 A:middle
our files should have, whoops,

00:20:23.076 --> 00:20:28.426 A:middle
sorry, should have the particles

00:20:28.426 --> 00:20:28.956 A:middle
extension.

00:20:29.086 --> 00:20:30.716 A:middle
That means that any file in the

00:20:30.716 --> 00:20:32.736 A:middle
system that has the .particles

00:20:32.736 --> 00:20:35.066 A:middle
extension will be recognized as

00:20:35.066 --> 00:20:36.896 A:middle
a file of our newly created UTI

00:20:36.896 --> 00:20:37.076 A:middle
type.

00:20:37.076 --> 00:20:40.466 A:middle
So now that the UTI type is

00:20:40.466 --> 00:20:41.976 A:middle
done, we can go ahead and tell

00:20:41.976 --> 00:20:43.276 A:middle
our application that we're

00:20:43.276 --> 00:20:44.176 A:middle
actually supported.

00:20:44.686 --> 00:20:46.526 A:middle
So in the Document Types, we

00:20:46.526 --> 00:20:47.756 A:middle
just mentioned our particles

00:20:47.756 --> 00:20:48.726 A:middle
file format again.

00:20:49.066 --> 00:20:52.606 A:middle
We identified the identifier and

00:20:52.606 --> 00:20:53.966 A:middle
any additional document type

00:20:53.966 --> 00:20:54.716 A:middle
properties.

00:20:55.326 --> 00:20:57.326 A:middle
We define our CF Bundle Type

00:20:57.326 --> 00:20:59.756 A:middle
Role to be editor and the LS

00:20:59.756 --> 00:21:01.166 A:middle
Handler Rank to be owner.

00:21:01.936 --> 00:21:02.966 A:middle
If you want to learn more about

00:21:02.966 --> 00:21:04.546 A:middle
this, check the documentation.

00:21:05.106 --> 00:21:08.546 A:middle
So now the UTI types are

00:21:08.546 --> 00:21:10.946 A:middle
properly set and that means that

00:21:10.946 --> 00:21:12.016 A:middle
the Document Browser View

00:21:12.016 --> 00:21:13.246 A:middle
Controller will make sure that

00:21:13.336 --> 00:21:15.056 A:middle
users are only allowed to pick

00:21:15.056 --> 00:21:16.766 A:middle
documents of our new file type.

00:21:17.646 --> 00:21:18.886 A:middle
It also makes sure that when you

00:21:18.886 --> 00:21:20.546 A:middle
search inside the Document

00:21:20.546 --> 00:21:22.076 A:middle
Browser View Controller, you

00:21:22.076 --> 00:21:23.626 A:middle
will only see search results

00:21:23.706 --> 00:21:24.936 A:middle
that make this UI type.

00:21:24.936 --> 00:21:27.976 A:middle
And last but not least, in any

00:21:27.976 --> 00:21:29.676 A:middle
kind of UI document interaction

00:21:29.676 --> 00:21:30.976 A:middle
control in a different

00:21:30.976 --> 00:21:32.986 A:middle
application for Particle files,

00:21:33.226 --> 00:21:34.606 A:middle
you'll see the action to open

00:21:34.606 --> 00:21:36.406 A:middle
the file in our app.

00:21:37.636 --> 00:21:39.406 A:middle
So now let's take a look at our

00:21:39.406 --> 00:21:40.406 A:middle
actual documents.

00:21:40.526 --> 00:21:41.886 A:middle
We switch to our UI Document

00:21:41.886 --> 00:21:42.556 A:middle
subclass.

00:21:43.366 --> 00:21:44.676 A:middle
Now UI Document is quite

00:21:44.676 --> 00:21:46.426 A:middle
powerful and we highly encourage

00:21:46.426 --> 00:21:47.306 A:middle
you to make user of it.

00:21:47.996 --> 00:21:49.216 A:middle
As Pau mentioned earlier, it

00:21:49.216 --> 00:21:50.216 A:middle
comes with a lot of great

00:21:50.216 --> 00:21:52.136 A:middle
benefits such as autosaving,

00:21:52.136 --> 00:21:54.056 A:middle
file coordination and NS File

00:21:54.056 --> 00:21:56.326 A:middle
Presenter, Versioning, and much

00:21:56.326 --> 00:21:58.356 A:middle
more and, therefore, the UI

00:21:58.356 --> 00:21:59.766 A:middle
Document and the UI Document

00:21:59.766 --> 00:22:00.916 A:middle
Browser View Controller are

00:22:00.916 --> 00:22:02.136 A:middle
literally made for each other.

00:22:02.606 --> 00:22:04.016 A:middle
So let's take a look at what we

00:22:04.016 --> 00:22:04.376 A:middle
are doing here.

00:22:04.976 --> 00:22:09.146 A:middle
Now the document represents the

00:22:09.146 --> 00:22:10.316 A:middle
document at runtime.

00:22:10.656 --> 00:22:12.406 A:middle
So obviously since we are

00:22:12.406 --> 00:22:13.956 A:middle
talking about Particle systems,

00:22:14.196 --> 00:22:15.736 A:middle
it should have a reference to

00:22:15.736 --> 00:22:17.076 A:middle
SCN Particle System.

00:22:17.666 --> 00:22:20.916 A:middle
Now the next thing we are doing

00:22:20.916 --> 00:22:23.276 A:middle
is we're implementing saving and

00:22:23.276 --> 00:22:24.096 A:middle
loading files.

00:22:24.666 --> 00:22:26.126 A:middle
Therefore, we have to overwrite

00:22:26.126 --> 00:22:28.246 A:middle
the function's content for type

00:22:29.396 --> 00:22:30.716 A:middle
and load from contents.

00:22:31.166 --> 00:22:32.706 A:middle
Now all we really have to do

00:22:32.706 --> 00:22:35.396 A:middle
here is archiving [inaudible] an

00:22:35.506 --> 00:22:37.706 A:middle
existing Particle system and

00:22:37.706 --> 00:22:39.086 A:middle
that works because our SCN

00:22:39.086 --> 00:22:40.376 A:middle
Particle System already

00:22:40.376 --> 00:22:41.716 A:middle
conformed to NS coding.

00:22:42.456 --> 00:22:43.486 A:middle
So we don't really have to do a

00:22:43.486 --> 00:22:43.926 A:middle
lot here.

00:22:44.106 --> 00:22:45.586 A:middle
We use a Keyed Archiver to

00:22:45.586 --> 00:22:47.986 A:middle
archive the data or we use NS

00:22:48.296 --> 00:22:50.836 A:middle
Keyed Unarchiver to unarchive an

00:22:50.836 --> 00:22:51.766 A:middle
existing one again.

00:22:52.406 --> 00:22:54.976 A:middle
Now that's all you have to do

00:22:54.976 --> 00:22:55.826 A:middle
about the document.

00:22:56.006 --> 00:22:56.786 A:middle
Let's take a look at the

00:22:56.786 --> 00:22:57.886 A:middle
Document View Controller.

00:22:59.036 --> 00:23:00.256 A:middle
Again, that's the one that is in

00:23:00.256 --> 00:23:01.536 A:middle
charge of presenting the

00:23:01.536 --> 00:23:03.376 A:middle
contents of a document.

00:23:03.856 --> 00:23:05.316 A:middle
So obviously, before we present

00:23:05.316 --> 00:23:06.866 A:middle
a Document View Controller, we

00:23:06.866 --> 00:23:08.656 A:middle
should [inaudible] reference to

00:23:08.656 --> 00:23:09.206 A:middle
a document.

00:23:13.296 --> 00:23:15.656 A:middle
Now to set document function in

00:23:15.656 --> 00:23:17.416 A:middle
our case is asynchronous and

00:23:17.416 --> 00:23:19.136 A:middle
that's because loading a

00:23:19.136 --> 00:23:21.066 A:middle
document should be asynchronous

00:23:21.126 --> 00:23:22.206 A:middle
because file [inaudible] is

00:23:22.206 --> 00:23:22.606 A:middle
involved.

00:23:23.166 --> 00:23:24.376 A:middle
We're reading from the disk and

00:23:24.376 --> 00:23:25.306 A:middle
you shouldn't do this on the

00:23:25.306 --> 00:23:25.786 A:middle
main thread.

00:23:26.836 --> 00:23:27.836 A:middle
So let's take a look at how we

00:23:27.836 --> 00:23:31.996 A:middle
should implement this.

00:23:32.196 --> 00:23:33.386 A:middle
First, we simply keep a

00:23:33.386 --> 00:23:34.686 A:middle
reference to our document.

00:23:35.476 --> 00:23:36.776 A:middle
We then go ahead and load our

00:23:36.776 --> 00:23:39.166 A:middle
view controller and then we call

00:23:39.166 --> 00:23:40.516 A:middle
the open function on our

00:23:40.516 --> 00:23:41.046 A:middle
document.

00:23:41.736 --> 00:23:43.256 A:middle
Now this will do all the work in

00:23:43.256 --> 00:23:44.676 A:middle
the background and will give us

00:23:44.676 --> 00:23:48.296 A:middle
a call back once it's back.

00:23:48.466 --> 00:23:49.776 A:middle
Now if anything went wrong

00:23:49.776 --> 00:23:50.646 A:middle
during the loading of the

00:23:50.646 --> 00:23:52.196 A:middle
document, we're going to get a

00:23:52.196 --> 00:23:54.006 A:middle
call to handle error user

00:23:54.006 --> 00:23:55.636 A:middle
interaction permitted on the UI

00:23:55.636 --> 00:23:56.726 A:middle
document subclass.

00:23:57.136 --> 00:23:57.896 A:middle
Since we want to be good

00:23:57.896 --> 00:24:00.086 A:middle
developers, we have to implement

00:24:00.086 --> 00:24:00.616 A:middle
this function.

00:24:01.336 --> 00:24:03.296 A:middle
If we succeeded, we can go ahead

00:24:03.366 --> 00:24:04.736 A:middle
and take the document and pass

00:24:04.736 --> 00:24:05.706 A:middle
it to our particle View

00:24:05.706 --> 00:24:07.496 A:middle
Controller and our editor View

00:24:07.496 --> 00:24:07.956 A:middle
Controller.

00:24:07.956 --> 00:24:10.156 A:middle
Now the Document View Controller

00:24:10.156 --> 00:24:11.606 A:middle
really is just a container view

00:24:11.606 --> 00:24:12.636 A:middle
controller with a particle

00:24:12.636 --> 00:24:14.076 A:middle
system on the left and the

00:24:14.076 --> 00:24:14.676 A:middle
editor on the right.

00:24:15.936 --> 00:24:17.766 A:middle
Now in any case, we have to call

00:24:17.766 --> 00:24:19.526 A:middle
the completion handler to

00:24:19.526 --> 00:24:20.736 A:middle
indicate that we're done with

00:24:20.926 --> 00:24:21.796 A:middle
setting the document.

00:24:22.316 --> 00:24:25.166 A:middle
Now that's about opening a

00:24:25.166 --> 00:24:25.636 A:middle
document.

00:24:25.636 --> 00:24:27.056 A:middle
But of course we also want to

00:24:27.056 --> 00:24:28.386 A:middle
dismiss our Document View

00:24:28.386 --> 00:24:29.386 A:middle
Controller at some point.

00:24:29.886 --> 00:24:32.336 A:middle
Same thing.

00:24:32.396 --> 00:24:34.036 A:middle
Instead of calling the open

00:24:34.036 --> 00:24:35.676 A:middle
function, this time we call

00:24:35.676 --> 00:24:37.116 A:middle
obviously the close function.

00:24:37.916 --> 00:24:39.196 A:middle
This is asynchronous again

00:24:39.196 --> 00:24:40.446 A:middle
because we are saving the

00:24:40.446 --> 00:24:41.596 A:middle
document if required.

00:24:41.596 --> 00:24:44.296 A:middle
And the completion Handler, we

00:24:44.296 --> 00:24:45.596 A:middle
just dismiss the Document View

00:24:45.596 --> 00:24:46.036 A:middle
Controller.

00:24:47.046 --> 00:24:48.486 A:middle
Now the Document View Controller

00:24:48.486 --> 00:24:49.426 A:middle
is pretty much done at this

00:24:49.426 --> 00:24:49.736 A:middle
point.

00:24:50.186 --> 00:24:51.236 A:middle
So we can go ahead and take a

00:24:51.236 --> 00:24:52.946 A:middle
look again at the Document

00:24:52.946 --> 00:24:53.866 A:middle
Browser View Controller.

00:24:54.806 --> 00:24:55.726 A:middle
This is the one that is in

00:24:55.726 --> 00:24:56.816 A:middle
charge of presenting our

00:24:56.816 --> 00:24:58.066 A:middle
document view controllers,

00:24:58.296 --> 00:24:59.696 A:middle
either when we create a new file

00:24:59.996 --> 00:25:01.506 A:middle
or when we open an existing

00:25:01.506 --> 00:25:01.816 A:middle
file.

00:25:02.366 --> 00:25:04.586 A:middle
Let's take a look at this again.

00:25:05.186 --> 00:25:08.586 A:middle
So when we create a new file, we

00:25:08.586 --> 00:25:09.996 A:middle
get a call back to did Request

00:25:09.996 --> 00:25:11.236 A:middle
Document Creation With Handler.

00:25:11.806 --> 00:25:13.386 A:middle
We obtained the URL from our NS

00:25:13.386 --> 00:25:15.266 A:middle
main Bundle and passed it back

00:25:15.266 --> 00:25:16.706 A:middle
via the import handler and a

00:25:16.706 --> 00:25:17.516 A:middle
copy operation.

00:25:18.626 --> 00:25:20.186 A:middle
We'll either get a call back to

00:25:20.306 --> 00:25:22.146 A:middle
did Import Document At URL or

00:25:22.146 --> 00:25:23.566 A:middle
failed To Import Document at

00:25:23.566 --> 00:25:23.766 A:middle
URL.

00:25:25.316 --> 00:25:26.846 A:middle
If we succeeded, we go ahead and

00:25:26.846 --> 00:25:28.256 A:middle
present the document, which is

00:25:28.256 --> 00:25:30.076 A:middle
just the same as when we open a

00:25:30.076 --> 00:25:31.556 A:middle
file that already existed

00:25:31.556 --> 00:25:31.926 A:middle
before.

00:25:33.586 --> 00:25:34.526 A:middle
Now when we want to present a

00:25:34.526 --> 00:25:35.876 A:middle
document, we instantiate the

00:25:35.876 --> 00:25:37.046 A:middle
Document View Controller from

00:25:37.046 --> 00:25:38.996 A:middle
the storyboard and we pass the

00:25:39.316 --> 00:25:41.176 A:middle
document via our function that

00:25:41.176 --> 00:25:42.536 A:middle
we've just completed, set

00:25:42.566 --> 00:25:44.506 A:middle
Document with a reference to a

00:25:44.506 --> 00:25:46.126 A:middle
newly created document instance.

00:25:47.066 --> 00:25:48.506 A:middle
Once that is done, we just go

00:25:48.506 --> 00:25:49.696 A:middle
ahead and present the Document

00:25:49.696 --> 00:25:50.276 A:middle
View Controller.

00:25:50.966 --> 00:25:52.486 A:middle
Let's take a look at this in the

00:25:52.486 --> 00:25:52.936 A:middle
simulator.

00:26:06.596 --> 00:26:08.056 A:middle
Switch back to the Browse view

00:26:08.826 --> 00:26:09.886 A:middle
and hit the Create Document

00:26:09.886 --> 00:26:10.226 A:middle
button.

00:26:10.926 --> 00:26:11.946 A:middle
A new file is created.

00:26:12.516 --> 00:26:13.246 A:middle
And there we go.

00:26:13.246 --> 00:26:16.226 A:middle
Our beautiful particles with an

00:26:16.256 --> 00:26:17.386 A:middle
inspector on the right side.

00:26:17.976 --> 00:26:19.186 A:middle
We can change the values a bit,

00:26:19.996 --> 00:26:21.706 A:middle
change the size, change the

00:26:21.706 --> 00:26:22.016 A:middle
color.

00:26:23.116 --> 00:26:24.496 A:middle
And once we are done with it, we

00:26:24.496 --> 00:26:25.996 A:middle
just close the document again by

00:26:25.996 --> 00:26:29.376 A:middle
pressing the Done button.

00:26:29.536 --> 00:26:31.516 A:middle
Great. So creating documents and

00:26:31.516 --> 00:26:33.056 A:middle
opening documents works like a

00:26:33.056 --> 00:26:33.496 A:middle
charm.

00:26:33.766 --> 00:26:35.006 A:middle
But there is one thing that I

00:26:35.006 --> 00:26:36.486 A:middle
don't really like yet, which is

00:26:37.066 --> 00:26:38.016 A:middle
the Document Browser View

00:26:38.016 --> 00:26:39.886 A:middle
Controller here has this white

00:26:39.886 --> 00:26:41.646 A:middle
appearance whereas the particle

00:26:41.646 --> 00:26:42.846 A:middle
View Controller has a really

00:26:42.846 --> 00:26:43.816 A:middle
dark appearance.

00:26:44.386 --> 00:26:45.256 A:middle
So let's fix this.

00:26:46.176 --> 00:26:47.536 A:middle
As Pau mentioned earlier, there

00:26:47.536 --> 00:26:48.936 A:middle
are three browser use interface

00:26:48.936 --> 00:26:50.226 A:middle
styles that you can choose from.

00:26:50.866 --> 00:26:53.736 A:middle
First, dark, light, and white.

00:26:54.356 --> 00:26:56.026 A:middle
Now obviously, dark seems like a

00:26:56.026 --> 00:26:57.976 A:middle
great choice for our situation

00:26:57.976 --> 00:26:58.136 A:middle
here.

00:26:59.316 --> 00:27:00.636 A:middle
So let's switch back to the

00:27:00.636 --> 00:27:01.886 A:middle
Document Browser View Controller

00:27:01.886 --> 00:27:02.596 A:middle
subclass.

00:27:03.126 --> 00:27:05.926 A:middle
Now the view Did Load method of

00:27:05.926 --> 00:27:08.066 A:middle
the subclass is a great moment

00:27:08.066 --> 00:27:09.146 A:middle
to configure the document

00:27:09.146 --> 00:27:09.486 A:middle
browser.

00:27:10.556 --> 00:27:12.536 A:middle
In this situation, what we can

00:27:12.536 --> 00:27:16.006 A:middle
do is set the browser User

00:27:16.006 --> 00:27:18.376 A:middle
Interface Style to dark and we

00:27:18.376 --> 00:27:21.186 A:middle
can also modify the tint Color

00:27:21.186 --> 00:27:22.306 A:middle
of the view of the Document

00:27:22.306 --> 00:27:23.146 A:middle
Browser View Controller.

00:27:23.656 --> 00:27:25.816 A:middle
Now in this situation, using a

00:27:25.816 --> 00:27:27.476 A:middle
bright orange probably will look

00:27:27.476 --> 00:27:29.036 A:middle
great with our fire particles.

00:27:29.796 --> 00:27:30.476 A:middle
So let's take a look.

00:27:39.016 --> 00:27:39.786 A:middle
There we go.

00:27:40.056 --> 00:27:41.526 A:middle
This is the same Document

00:27:41.526 --> 00:27:43.336 A:middle
Browser View Controller but in a

00:27:43.336 --> 00:27:44.706 A:middle
dark appearance which should

00:27:44.706 --> 00:27:46.276 A:middle
look much better than the one

00:27:46.276 --> 00:27:49.386 A:middle
before once we open the Document

00:27:49.386 --> 00:27:50.036 A:middle
View Controller.

00:27:50.876 --> 00:27:53.086 A:middle
Even the control URI now has the

00:27:53.086 --> 00:27:54.076 A:middle
updated appearance.

00:27:55.016 --> 00:27:59.516 A:middle
Let's create a new folder, call

00:27:59.516 --> 00:27:59.976 A:middle
it fire,

00:28:04.516 --> 00:28:05.866 A:middle
and open a new document.

00:28:06.296 --> 00:28:08.506 A:middle
Now the transition between the

00:28:08.506 --> 00:28:10.126 A:middle
two view controllers is much

00:28:10.126 --> 00:28:11.646 A:middle
smoother and looks much better.

00:28:12.596 --> 00:28:13.926 A:middle
So that's pretty much all I have

00:28:13.926 --> 00:28:15.506 A:middle
to tell you about the first

00:28:15.506 --> 00:28:15.836 A:middle
demo.

00:28:16.716 --> 00:28:18.666 A:middle
And to get an overview of what

00:28:18.666 --> 00:28:20.206 A:middle
we learned so far, I would like

00:28:20.206 --> 00:28:21.156 A:middle
to hand it back to Pau

00:28:22.516 --> 00:28:25.500 A:middle
[ Applause ]

00:28:34.856 --> 00:28:36.656 A:middle
&gt;&gt; So let's take a look at what

00:28:36.656 --> 00:28:37.696 A:middle
we've seen in the demo.

00:28:38.956 --> 00:28:40.806 A:middle
First, we saw how to create a

00:28:40.806 --> 00:28:42.216 A:middle
new document-based application

00:28:42.516 --> 00:28:43.426 A:middle
from the Xcode template.

00:28:44.276 --> 00:28:46.216 A:middle
Then, we saw how to create new

00:28:46.216 --> 00:28:48.026 A:middle
documents and how to open them.

00:28:48.656 --> 00:28:50.886 A:middle
And finally, we saw how to

00:28:50.886 --> 00:28:52.436 A:middle
customize the appearance of the

00:28:52.436 --> 00:28:54.386 A:middle
Browser VC to make it look like

00:28:54.386 --> 00:28:55.596 A:middle
the rest of our app.

00:28:56.646 --> 00:28:59.246 A:middle
And now that we have the basics

00:28:59.286 --> 00:29:01.586 A:middle
of this Browser VC, let's take a

00:29:01.646 --> 00:29:04.176 A:middle
look at how to get and provide a

00:29:04.176 --> 00:29:06.556 A:middle
great experience for our users.

00:29:07.956 --> 00:29:09.316 A:middle
In this section, I would like to

00:29:09.316 --> 00:29:10.906 A:middle
talk about three different

00:29:10.906 --> 00:29:13.086 A:middle
topics: open-in-place, how to

00:29:13.086 --> 00:29:15.166 A:middle
provide custom actions in the

00:29:15.166 --> 00:29:17.106 A:middle
Browser VC, and how to create a

00:29:17.106 --> 00:29:18.706 A:middle
great opening experience.

00:29:18.706 --> 00:29:21.606 A:middle
So first, let's talk about

00:29:21.606 --> 00:29:22.416 A:middle
open-in-place.

00:29:23.016 --> 00:29:24.536 A:middle
Open-in-place is a great feature

00:29:24.846 --> 00:29:26.056 A:middle
that came with iOS 9.

00:29:26.826 --> 00:29:28.516 A:middle
It allows apps to share files

00:29:28.516 --> 00:29:29.786 A:middle
between them without the need of

00:29:29.846 --> 00:29:32.106 A:middle
copying them.

00:29:32.306 --> 00:29:33.786 A:middle
Also because of this, you have

00:29:33.826 --> 00:29:35.856 A:middle
to be careful when accessing

00:29:35.856 --> 00:29:37.766 A:middle
those documents because other

00:29:37.766 --> 00:29:38.976 A:middle
apps might be already accessing

00:29:38.976 --> 00:29:39.176 A:middle
them.

00:29:40.686 --> 00:29:42.406 A:middle
Now the Browser VC makes use of

00:29:42.406 --> 00:29:44.606 A:middle
this feature in order to open

00:29:44.606 --> 00:29:45.526 A:middle
the files from the Recents

00:29:45.526 --> 00:29:48.506 A:middle
Popover, so if you're using the

00:29:48.506 --> 00:29:49.796 A:middle
Browser VC in your app, you

00:29:49.796 --> 00:29:51.236 A:middle
really need to make use of

00:29:51.236 --> 00:29:51.846 A:middle
open-in-place.

00:29:51.976 --> 00:29:53.366 A:middle
If you're starting from the

00:29:53.366 --> 00:29:54.756 A:middle
Xcode template, it's real easy.

00:29:54.946 --> 00:29:55.916 A:middle
You don't have to do anything.

00:29:56.346 --> 00:29:57.846 A:middle
If not, you will have to

00:29:57.846 --> 00:29:59.496 A:middle
implement support open-in-place.

00:30:00.086 --> 00:30:02.126 A:middle
So let's take a look at the

00:30:02.126 --> 00:30:02.306 A:middle
code.

00:30:02.306 --> 00:30:03.406 A:middle
First, we have to implement the

00:30:03.406 --> 00:30:05.086 A:middle
application open input URL

00:30:05.086 --> 00:30:05.686 A:middle
delegate method.

00:30:06.726 --> 00:30:08.556 A:middle
Here, first thing is to check if

00:30:08.556 --> 00:30:10.136 A:middle
the input URL is a file URL.

00:30:10.246 --> 00:30:12.226 A:middle
And if so, we can call the

00:30:12.226 --> 00:30:14.026 A:middle
Reveal Document method from the

00:30:14.026 --> 00:30:14.476 A:middle
Browser VC.

00:30:14.476 --> 00:30:16.706 A:middle
This method will reveal the

00:30:16.706 --> 00:30:18.066 A:middle
document in the Recents View and

00:30:18.066 --> 00:30:18.916 A:middle
call us back when it's ready.

00:30:19.046 --> 00:30:22.406 A:middle
Now we can load and present the

00:30:22.406 --> 00:30:24.176 A:middle
document as we did for open and

00:30:24.176 --> 00:30:24.546 A:middle
creation.

00:30:25.176 --> 00:30:26.436 A:middle
If it fails, we need to handle

00:30:26.436 --> 00:30:28.756 A:middle
the error and present some UI to

00:30:30.336 --> 00:30:31.006 A:middle
the user.

00:30:31.006 --> 00:30:32.266 A:middle
Now let's take a look at how to

00:30:32.266 --> 00:30:33.766 A:middle
add custom actions into this

00:30:33.766 --> 00:30:34.326 A:middle
Browser VC.

00:30:35.596 --> 00:30:36.756 A:middle
There are three different ways

00:30:36.756 --> 00:30:37.826 A:middle
of add custom actions.

00:30:38.116 --> 00:30:39.686 A:middle
The first one is the UI Document

00:30:39.686 --> 00:30:40.366 A:middle
Browser Action.

00:30:40.926 --> 00:30:42.336 A:middle
You can add these actions when

00:30:42.336 --> 00:30:43.866 A:middle
the user performs long press on

00:30:43.866 --> 00:30:45.606 A:middle
a document and when the user

00:30:45.656 --> 00:30:46.646 A:middle
enters selection mode.

00:30:48.296 --> 00:30:49.396 A:middle
In order to create them, you

00:30:49.396 --> 00:30:51.646 A:middle
need to give an identifier

00:30:51.646 --> 00:30:54.546 A:middle
localized Title and availability

00:30:54.646 --> 00:30:55.306 A:middle
in the handler.

00:30:55.576 --> 00:30:57.256 A:middle
The availability has two values:

00:30:57.416 --> 00:30:58.546 A:middle
menu and navigation bar.

00:30:59.076 --> 00:31:01.246 A:middle
Menu will make the action appear

00:31:01.246 --> 00:31:02.426 A:middle
when the user performs a long

00:31:02.426 --> 00:31:03.996 A:middle
press and the navigation bar

00:31:03.996 --> 00:31:05.756 A:middle
will make the action appear when

00:31:05.756 --> 00:31:07.506 A:middle
the user enters selection mode.

00:31:08.336 --> 00:31:09.876 A:middle
The handler will give you the

00:31:09.876 --> 00:31:11.976 A:middle
array of URLs that the user

00:31:11.976 --> 00:31:13.316 A:middle
wants to use for the action.

00:31:14.346 --> 00:31:16.686 A:middle
Now unlike the Open URL, this

00:31:16.686 --> 00:31:19.206 A:middle
method you will only have access

00:31:19.206 --> 00:31:20.646 A:middle
to these URLs until your

00:31:20.646 --> 00:31:21.906 A:middle
application gets killed.

00:31:22.646 --> 00:31:24.216 A:middle
Now that we have our action, you

00:31:24.216 --> 00:31:25.276 A:middle
need to set the supported

00:31:25.276 --> 00:31:26.116 A:middle
content types.

00:31:26.116 --> 00:31:27.536 A:middle
The Browser VC will use the

00:31:27.536 --> 00:31:29.296 A:middle
content types to know when to

00:31:29.296 --> 00:31:30.046 A:middle
display your action.

00:31:30.926 --> 00:31:32.206 A:middle
Then, you need to set the

00:31:32.206 --> 00:31:34.206 A:middle
supports multiple items to

00:31:34.206 --> 00:31:35.726 A:middle
specify if you can support

00:31:35.726 --> 00:31:37.136 A:middle
multiple items at once.

00:31:37.536 --> 00:31:38.856 A:middle
And you just need to set the

00:31:38.916 --> 00:31:40.186 A:middle
custom actions that you created

00:31:40.296 --> 00:31:41.926 A:middle
into the custom action array of

00:31:41.926 --> 00:31:43.286 A:middle
the Browser VC.

00:31:44.196 --> 00:31:46.136 A:middle
The second type of actions are

00:31:46.136 --> 00:31:47.656 A:middle
the UI Bar Button Items.

00:31:48.346 --> 00:31:49.796 A:middle
You can add these actions in the

00:31:49.796 --> 00:31:52.096 A:middle
navigation bar of the Recents VC

00:31:52.326 --> 00:31:54.106 A:middle
and the browse, sorry, the

00:31:54.106 --> 00:31:55.206 A:middle
Recents View and the Browser

00:31:55.206 --> 00:31:56.726 A:middle
View and you can add them in the

00:31:56.726 --> 00:31:58.446 A:middle
trailing or leading sides of the

00:31:58.446 --> 00:31:59.036 A:middle
navigation bar.

00:32:01.816 --> 00:32:03.796 A:middle
The third type of actions are

00:32:03.796 --> 00:32:05.536 A:middle
the ones that you can add in the

00:32:05.536 --> 00:32:06.906 A:middle
UI Activity View Controller.

00:32:08.006 --> 00:32:09.886 A:middle
The Browser VC will show this

00:32:09.886 --> 00:32:11.656 A:middle
view controller when the user

00:32:11.716 --> 00:32:13.786 A:middle
performs the share action.

00:32:14.376 --> 00:32:16.226 A:middle
The Browser VC will let you have

00:32:16.226 --> 00:32:17.666 A:middle
control of this activity view

00:32:17.666 --> 00:32:18.786 A:middle
controller before it gets

00:32:18.826 --> 00:32:19.306 A:middle
presented.

00:32:19.526 --> 00:32:21.186 A:middle
And also, it will let you add

00:32:21.186 --> 00:32:22.446 A:middle
custom actions when it's

00:32:22.446 --> 00:32:24.096 A:middle
creating this UI Activity View

00:32:24.096 --> 00:32:24.466 A:middle
Controller.

00:32:24.556 --> 00:32:26.046 A:middle
So let's take a look at the

00:32:26.046 --> 00:32:26.276 A:middle
code.

00:32:26.436 --> 00:32:28.796 A:middle
If you want to add additional

00:32:28.796 --> 00:32:30.496 A:middle
actions, you need to implement

00:32:30.496 --> 00:32:31.916 A:middle
the document Brower application

00:32:31.916 --> 00:32:33.236 A:middle
activities for document URL

00:32:33.296 --> 00:32:34.126 A:middle
delegate method.

00:32:35.406 --> 00:32:36.986 A:middle
If you want to have access to

00:32:36.986 --> 00:32:38.576 A:middle
this Activity View Controller,

00:32:38.856 --> 00:32:40.506 A:middle
you need to implement the

00:32:40.506 --> 00:32:42.026 A:middle
Document Browser will Present

00:32:42.636 --> 00:32:43.736 A:middle
activity View Controller.

00:32:45.466 --> 00:32:47.126 A:middle
And that's all for the actions.

00:32:47.916 --> 00:32:49.996 A:middle
Now as you've seen already in

00:32:49.996 --> 00:32:51.976 A:middle
Files, there's a great opening

00:32:51.976 --> 00:32:53.386 A:middle
transition that goes from the

00:32:53.386 --> 00:32:54.826 A:middle
thumbnail to the full screen.

00:32:56.126 --> 00:32:58.566 A:middle
And Files app is able to do this

00:32:58.776 --> 00:33:00.276 A:middle
thanks to the new UI Document

00:33:00.276 --> 00:33:01.476 A:middle
Browser Transition Controller.

00:33:02.206 --> 00:33:04.936 A:middle
This class will let you set

00:33:05.506 --> 00:33:07.806 A:middle
display loading progress on top

00:33:07.806 --> 00:33:09.536 A:middle
of the thumbnail while you are

00:33:09.536 --> 00:33:11.246 A:middle
loading the document.

00:33:11.346 --> 00:33:14.036 A:middle
And it will also let you animate

00:33:14.036 --> 00:33:15.766 A:middle
with Zoom transition when you're

00:33:15.766 --> 00:33:17.446 A:middle
presenting the Document View

00:33:17.746 --> 00:33:19.926 A:middle
Controller for the document.

00:33:20.486 --> 00:33:21.986 A:middle
So now, let's take a look at the

00:33:21.986 --> 00:33:22.486 A:middle
workflow.

00:33:23.246 --> 00:33:26.106 A:middle
First, you will have to get the

00:33:26.106 --> 00:33:27.466 A:middle
URL that the user just picked.

00:33:28.486 --> 00:33:29.986 A:middle
Here, you will start loading the

00:33:29.986 --> 00:33:30.906 A:middle
content of the document.

00:33:30.906 --> 00:33:32.976 A:middle
And while loading it, you will

00:33:32.976 --> 00:33:34.216 A:middle
have to update the Transition

00:33:34.216 --> 00:33:34.626 A:middle
Controller.

00:33:35.316 --> 00:33:37.526 A:middle
Once the document is fully

00:33:37.526 --> 00:33:39.326 A:middle
loaded, you just need to present

00:33:39.326 --> 00:33:40.856 A:middle
the document and use the

00:33:40.856 --> 00:33:42.636 A:middle
Transition Controller to drive

00:33:42.636 --> 00:33:44.016 A:middle
the animation for the

00:33:44.016 --> 00:33:44.596 A:middle
presentation.

00:33:44.786 --> 00:33:48.346 A:middle
So now, let's take a look at how

00:33:48.346 --> 00:33:48.816 A:middle
it works.

00:33:49.606 --> 00:33:51.796 A:middle
First, once you have the URL

00:33:51.916 --> 00:33:54.596 A:middle
that the user picked, you need

00:33:54.596 --> 00:33:55.736 A:middle
to create the progress object

00:33:55.736 --> 00:33:57.606 A:middle
that will track the loading of

00:33:57.606 --> 00:33:58.156 A:middle
the document.

00:33:59.046 --> 00:34:00.466 A:middle
Here, you create also the

00:34:00.466 --> 00:34:02.736 A:middle
transition Controller that will

00:34:02.736 --> 00:34:04.306 A:middle
track the loading and that will

00:34:04.306 --> 00:34:05.806 A:middle
drive the animation from the

00:34:05.806 --> 00:34:06.906 A:middle
thumbnail to the full screen.

00:34:07.406 --> 00:34:08.696 A:middle
Now you just need to set the

00:34:08.696 --> 00:34:09.966 A:middle
progress onto the transition

00:34:09.966 --> 00:34:10.336 A:middle
Controller.

00:34:11.196 --> 00:34:12.816 A:middle
Here, we are ready to load the

00:34:12.816 --> 00:34:13.196 A:middle
document.

00:34:13.736 --> 00:34:14.706 A:middle
In our example, the load

00:34:14.706 --> 00:34:16.156 A:middle
Document method will load the

00:34:16.156 --> 00:34:17.826 A:middle
document while updating the

00:34:17.826 --> 00:34:19.036 A:middle
progress that we created before.

00:34:19.036 --> 00:34:21.346 A:middle
And when the document is fully

00:34:21.346 --> 00:34:23.266 A:middle
loaded, it will call us back.

00:34:23.266 --> 00:34:24.416 A:middle
Here, we just need to present

00:34:24.496 --> 00:34:25.586 A:middle
the Document View Controller.

00:34:26.386 --> 00:34:27.956 A:middle
Now, if we stop here, we will

00:34:27.956 --> 00:34:29.286 A:middle
get the [inaudible] from UIKit

00:34:29.406 --> 00:34:30.666 A:middle
which is a slide from the bottom

00:34:30.666 --> 00:34:32.786 A:middle
but we want to have this nice

00:34:32.786 --> 00:34:33.676 A:middle
zoom transition.

00:34:34.096 --> 00:34:35.236 A:middle
And for that, we need to

00:34:35.236 --> 00:34:36.476 A:middle
implement the transitioning

00:34:36.476 --> 00:34:37.736 A:middle
delegate of the presented View

00:34:37.736 --> 00:34:38.186 A:middle
Controller.

00:34:38.266 --> 00:34:40.876 A:middle
The transitioning delegate needs

00:34:40.906 --> 00:34:42.026 A:middle
to implement the UI View

00:34:42.026 --> 00:34:43.166 A:middle
Controller Transitioning

00:34:43.166 --> 00:34:43.926 A:middle
Delegate protocol.

00:34:44.086 --> 00:34:46.106 A:middle
In this protocol, you need to

00:34:46.106 --> 00:34:47.876 A:middle
implement two main methods: the

00:34:47.876 --> 00:34:48.866 A:middle
animation controller for

00:34:48.866 --> 00:34:49.906 A:middle
presented view controller and

00:34:49.906 --> 00:34:51.806 A:middle
the animation controller for the

00:34:51.806 --> 00:34:52.606 A:middle
dismissed view controller.

00:34:52.706 --> 00:34:54.836 A:middle
Here, you just need to return

00:34:54.906 --> 00:34:56.296 A:middle
the transition controller that

00:34:56.296 --> 00:34:57.236 A:middle
we created before.

00:34:58.546 --> 00:35:00.236 A:middle
And now I will like to hand back

00:35:00.236 --> 00:35:01.406 A:middle
to Raffael to show you how to

00:35:01.406 --> 00:35:02.446 A:middle
implement all these advanced

00:35:02.446 --> 00:35:02.776 A:middle
features.

00:35:03.256 --> 00:35:03.506 A:middle
Raffael

00:35:04.016 --> 00:35:05.531 A:middle
[ Applause ]

00:35:05.531 --> 00:35:07.046 A:middle
.

00:35:07.046 --> 00:35:07.516 A:middle
&gt;&gt; Thanks, Pau.

00:35:08.756 --> 00:35:10.206 A:middle
So in this second demo, I'd like

00:35:10.206 --> 00:35:11.736 A:middle
to show you three cool things.

00:35:12.106 --> 00:35:13.846 A:middle
First, we're going to take a

00:35:13.846 --> 00:35:15.736 A:middle
look at open-in-place and how

00:35:15.736 --> 00:35:18.236 A:middle
easy it is to adopt it with your

00:35:18.236 --> 00:35:19.516 A:middle
Document Browser View Controller

00:35:19.516 --> 00:35:20.096 A:middle
application.

00:35:20.876 --> 00:35:22.036 A:middle
Next, we're going to take a look

00:35:22.036 --> 00:35:23.246 A:middle
at custom actions.

00:35:23.716 --> 00:35:24.866 A:middle
We're going to add a new action

00:35:24.866 --> 00:35:26.286 A:middle
that shows up in the long press

00:35:26.286 --> 00:35:28.016 A:middle
menu when you tap and hold a

00:35:28.016 --> 00:35:28.546 A:middle
document.

00:35:29.066 --> 00:35:30.366 A:middle
And last but not least, we're

00:35:30.366 --> 00:35:31.756 A:middle
going to implement a custom view

00:35:31.756 --> 00:35:33.546 A:middle
controller transition to improve

00:35:33.546 --> 00:35:35.356 A:middle
the user experience when we open

00:35:35.356 --> 00:35:37.126 A:middle
an existing file or create a new

00:35:37.126 --> 00:35:37.356 A:middle
one.

00:35:37.866 --> 00:35:39.076 A:middle
So let's just jump back right

00:35:39.076 --> 00:35:39.956 A:middle
into our project.

00:35:48.746 --> 00:35:49.596 A:middle
Now let's talk about

00:35:49.596 --> 00:35:50.396 A:middle
open-in-place.

00:35:50.936 --> 00:35:53.556 A:middle
Open-in-place is a great feature

00:35:53.556 --> 00:35:55.196 A:middle
that has been introduced with

00:35:55.296 --> 00:35:57.096 A:middle
iOS 9 and it allows you to work

00:35:57.096 --> 00:35:58.426 A:middle
on the file that the user has

00:35:58.426 --> 00:36:00.106 A:middle
chosen instead of on a copy of

00:36:00.106 --> 00:36:00.256 A:middle
it.

00:36:01.376 --> 00:36:03.516 A:middle
Now adopting it is super easy.

00:36:03.626 --> 00:36:05.116 A:middle
And, in fact, if you come from

00:36:05.116 --> 00:36:06.316 A:middle
the document based apps

00:36:06.316 --> 00:36:07.856 A:middle
template, you have literally

00:36:07.856 --> 00:36:09.136 A:middle
nothing to do.

00:36:09.626 --> 00:36:11.876 A:middle
The way it works is when the

00:36:11.876 --> 00:36:13.636 A:middle
user taps the document outside

00:36:13.636 --> 00:36:15.556 A:middle
of your app, iOS will make a

00:36:15.556 --> 00:36:17.056 A:middle
call to your app delegate to

00:36:17.466 --> 00:36:18.466 A:middle
open the URL with options.

00:36:18.466 --> 00:36:19.606 A:middle
So let's take a look.

00:36:25.696 --> 00:36:28.066 A:middle
Now in this function, what we do

00:36:28.066 --> 00:36:30.006 A:middle
is first we make sure that the

00:36:30.006 --> 00:36:31.296 A:middle
URL that we get from iOS

00:36:31.396 --> 00:36:33.106 A:middle
actually is a file URL.

00:36:33.556 --> 00:36:35.286 A:middle
If it's not, we should probably

00:36:35.286 --> 00:36:36.486 A:middle
return because we are not in the

00:36:36.486 --> 00:36:37.656 A:middle
situation that we expect.

00:36:38.746 --> 00:36:41.076 A:middle
Once we pass that test, we get

00:36:41.076 --> 00:36:42.196 A:middle
our document Browser View

00:36:42.196 --> 00:36:43.766 A:middle
Controller which is the root

00:36:43.766 --> 00:36:44.616 A:middle
View Controller of our

00:36:44.616 --> 00:36:45.256 A:middle
application.

00:36:45.926 --> 00:36:48.006 A:middle
And we take the URL and pass it

00:36:48.006 --> 00:36:49.486 A:middle
to the reveal Document function.

00:36:50.106 --> 00:36:52.896 A:middle
Now the Document Browser View

00:36:52.896 --> 00:36:54.476 A:middle
Controller again will do all the

00:36:54.476 --> 00:36:55.596 A:middle
heavy lifting for you in the

00:36:55.596 --> 00:36:56.126 A:middle
background.

00:36:56.756 --> 00:36:59.036 A:middle
It will process the URL, move it

00:36:59.036 --> 00:37:01.066 A:middle
if required, and once it's done,

00:37:01.646 --> 00:37:02.866 A:middle
we're going to get a call back

00:37:02.976 --> 00:37:04.416 A:middle
with our completion handler.

00:37:05.296 --> 00:37:06.466 A:middle
Now again, if we get an error,

00:37:06.706 --> 00:37:07.586 A:middle
since we want to be good

00:37:07.626 --> 00:37:09.016 A:middle
developers, we're going to

00:37:09.146 --> 00:37:10.626 A:middle
handle the error appropriately

00:37:10.676 --> 00:37:12.286 A:middle
for example by showing an alert

00:37:12.356 --> 00:37:13.206 A:middle
view to the user.

00:37:14.656 --> 00:37:17.366 A:middle
If everything went right, we

00:37:17.366 --> 00:37:18.706 A:middle
just go ahead and present the

00:37:18.706 --> 00:37:20.976 A:middle
document with that new reveal

00:37:20.976 --> 00:37:21.936 A:middle
Document URL.

00:37:23.006 --> 00:37:24.416 A:middle
That's literally all you have to

00:37:24.416 --> 00:37:26.436 A:middle
do to support open-in-place in

00:37:26.436 --> 00:37:27.836 A:middle
your document-based application.

00:37:29.906 --> 00:37:31.446 A:middle
Now let's take a look at custom

00:37:31.446 --> 00:37:32.036 A:middle
actions.

00:37:33.226 --> 00:37:34.796 A:middle
So our particle systems are

00:37:34.796 --> 00:37:36.146 A:middle
really beautiful, right, and we

00:37:36.146 --> 00:37:37.326 A:middle
might want to share them with

00:37:37.326 --> 00:37:37.856 A:middle
our friends.

00:37:38.916 --> 00:37:40.476 A:middle
So I'm going to add a new action

00:37:40.476 --> 00:37:41.496 A:middle
that shows up when you long

00:37:41.496 --> 00:37:43.606 A:middle
press a document to export this

00:37:43.606 --> 00:37:46.266 A:middle
particle system as a GIF file or

00:37:46.266 --> 00:37:46.766 A:middle
a GIF file.

00:37:48.006 --> 00:37:49.016 A:middle
Now let's take a look at the

00:37:49.016 --> 00:37:50.336 A:middle
Document Browser View Controller

00:37:51.116 --> 00:37:51.236 A:middle
again.

00:37:51.996 --> 00:37:53.876 A:middle
The view did load method is a

00:37:53.876 --> 00:37:55.426 A:middle
great moment to configure these

00:37:55.426 --> 00:37:55.866 A:middle
actions.

00:38:02.976 --> 00:38:05.216 A:middle
So, therefore, I'm instantiating

00:38:05.216 --> 00:38:06.566 A:middle
a new UI Document Browser

00:38:06.566 --> 00:38:07.026 A:middle
Action.

00:38:07.506 --> 00:38:09.376 A:middle
I give it an identifier that is

00:38:09.376 --> 00:38:11.376 A:middle
unique throughout the app, a

00:38:11.376 --> 00:38:13.646 A:middle
localized Title, and I set the

00:38:13.646 --> 00:38:15.526 A:middle
availability to menu only.

00:38:15.986 --> 00:38:17.836 A:middle
So this will make sure that this

00:38:17.836 --> 00:38:19.436 A:middle
action only shows up when you

00:38:19.436 --> 00:38:21.316 A:middle
long press a document inside

00:38:21.316 --> 00:38:22.236 A:middle
your Document Browser View

00:38:22.236 --> 00:38:22.916 A:middle
Controller grid.

00:38:24.556 --> 00:38:25.846 A:middle
We also have to give it a

00:38:25.846 --> 00:38:27.176 A:middle
handler which is the one that

00:38:27.176 --> 00:38:28.766 A:middle
will be executed whenever the

00:38:28.766 --> 00:38:30.066 A:middle
user taps our action.

00:38:30.696 --> 00:38:32.366 A:middle
In this situation, we just go

00:38:32.366 --> 00:38:34.986 A:middle
ahead and log [inaudible]to the

00:38:34.986 --> 00:38:35.436 A:middle
consol.

00:38:35.906 --> 00:38:39.306 A:middle
Next, we define the action

00:38:39.886 --> 00:38:41.646 A:middle
supported Content Types to be

00:38:41.816 --> 00:38:43.816 A:middle
com.example.particles with just

00:38:43.816 --> 00:38:45.656 A:middle
the UTI type we defined earlier.

00:38:46.336 --> 00:38:47.816 A:middle
So just make sure that only our

00:38:47.816 --> 00:38:50.126 A:middle
own files will get this action

00:38:50.266 --> 00:38:50.876 A:middle
in the menu.

00:38:51.296 --> 00:38:53.446 A:middle
And last but not least, all we

00:38:53.446 --> 00:38:55.996 A:middle
have to do is define the custom

00:38:55.996 --> 00:38:57.526 A:middle
actions of our Document Browser

00:38:57.526 --> 00:38:59.226 A:middle
View Controller to be array

00:38:59.396 --> 00:39:00.726 A:middle
containing this newly created

00:39:00.726 --> 00:39:01.056 A:middle
action.

00:39:02.356 --> 00:39:03.316 A:middle
Let's try it out in the

00:39:03.316 --> 00:39:03.736 A:middle
simulator.

00:39:10.866 --> 00:39:12.966 A:middle
Now on our existing file, we

00:39:12.966 --> 00:39:15.106 A:middle
perform a long press and we see

00:39:15.106 --> 00:39:15.996 A:middle
that there's a new action

00:39:15.996 --> 00:39:17.706 A:middle
showing up here, export as GIF.

00:39:18.866 --> 00:39:20.456 A:middle
Once tapped, we see that in the

00:39:20.456 --> 00:39:22.266 A:middle
console the handler of the

00:39:22.266 --> 00:39:23.926 A:middle
action has been executed.

00:39:25.776 --> 00:39:26.746 A:middle
That was pretty easy.

00:39:27.156 --> 00:39:28.746 A:middle
Now let's move to the third and

00:39:28.746 --> 00:39:30.566 A:middle
the coolest things, the coolest

00:39:30.566 --> 00:39:31.666 A:middle
thing that I wanted to show you,

00:39:31.666 --> 00:39:33.036 A:middle
which is custom view controller

00:39:33.036 --> 00:39:33.586 A:middle
transitions.

00:39:34.936 --> 00:39:36.246 A:middle
Right now when we present our

00:39:36.246 --> 00:39:37.856 A:middle
Document View Controller, we get

00:39:37.856 --> 00:39:39.926 A:middle
a simple slide up amination that

00:39:39.926 --> 00:39:42.396 A:middle
is provided by UIKit and that's

00:39:42.396 --> 00:39:44.166 A:middle
already pretty cool but it's not

00:39:44.166 --> 00:39:45.136 A:middle
really the way it should look

00:39:45.136 --> 00:39:45.406 A:middle
like.

00:39:45.936 --> 00:39:47.426 A:middle
Instead, the way it really

00:39:47.426 --> 00:39:49.136 A:middle
should look like is the user

00:39:49.136 --> 00:39:51.156 A:middle
taps the document thumbnail and

00:39:51.156 --> 00:39:52.476 A:middle
the thumbnail grows into the

00:39:52.476 --> 00:39:54.376 A:middle
particle system on the left side

00:39:54.376 --> 00:39:55.686 A:middle
of our Document View Controller.

00:39:56.576 --> 00:39:57.546 A:middle
So let's take a look at how we

00:39:57.546 --> 00:39:57.976 A:middle
can make this work.

00:40:02.196 --> 00:40:04.746 A:middle
Therefore, we switch back to the

00:40:04.746 --> 00:40:08.116 A:middle
present document function that

00:40:08.116 --> 00:40:09.006 A:middle
we created earlier.

00:40:09.936 --> 00:40:11.016 A:middle
Now the way custom View

00:40:11.016 --> 00:40:12.826 A:middle
Controller transitions work is

00:40:13.086 --> 00:40:14.426 A:middle
you register yourself as the

00:40:14.426 --> 00:40:15.926 A:middle
transitioning delegate of the

00:40:15.926 --> 00:40:17.196 A:middle
view controller that is about to

00:40:17.196 --> 00:40:17.906 A:middle
be presented.

00:40:19.036 --> 00:40:20.896 A:middle
Before it is presented, UIKit

00:40:20.896 --> 00:40:22.506 A:middle
will call us and ask for the

00:40:22.506 --> 00:40:23.756 A:middle
transitioning controller.

00:40:24.646 --> 00:40:25.846 A:middle
We give back the transitioning

00:40:25.846 --> 00:40:27.646 A:middle
controller and that object will

00:40:27.646 --> 00:40:28.936 A:middle
be in charge of driving the

00:40:28.936 --> 00:40:30.396 A:middle
animation from view controller A

00:40:30.396 --> 00:40:31.926 A:middle
to view controller B.

00:40:32.976 --> 00:40:34.316 A:middle
View controller A in our

00:40:34.316 --> 00:40:35.516 A:middle
situation is the Document

00:40:35.516 --> 00:40:36.496 A:middle
Browser View Controller.

00:40:37.066 --> 00:40:38.216 A:middle
View controller B is the

00:40:38.216 --> 00:40:39.216 A:middle
Document View Controller.

00:40:40.606 --> 00:40:41.786 A:middle
Now Pau mentioned that earlier

00:40:41.786 --> 00:40:43.196 A:middle
the Document Browser View

00:40:43.196 --> 00:40:44.866 A:middle
Controller already gives us this

00:40:44.866 --> 00:40:46.666 A:middle
transitioning controller for us.

00:40:47.026 --> 00:40:48.816 A:middle
We just have to keep a reference

00:40:49.036 --> 00:40:50.446 A:middle
and pass it back to the function

00:40:50.446 --> 00:40:50.896 A:middle
that UIKit will call.

00:40:57.306 --> 00:40:59.366 A:middle
So first, we register ourselves

00:40:59.576 --> 00:41:01.076 A:middle
as the transitioning delegate of

00:41:01.116 --> 00:41:02.186 A:middle
the document View Controller

00:41:02.186 --> 00:41:03.506 A:middle
that is about to be presented.

00:41:03.936 --> 00:41:09.156 A:middle
Next, we obtain a new

00:41:09.156 --> 00:41:10.676 A:middle
transitioning Controller by

00:41:10.676 --> 00:41:12.136 A:middle
calling the transition

00:41:12.136 --> 00:41:14.426 A:middle
Controller for Document URL on

00:41:14.426 --> 00:41:15.726 A:middle
our UI Document Browser View

00:41:15.726 --> 00:41:16.206 A:middle
Controller.

00:41:17.286 --> 00:41:19.006 A:middle
Now this object doesn't really

00:41:19.006 --> 00:41:20.656 A:middle
need a lot of configuration.

00:41:21.046 --> 00:41:22.246 A:middle
The only thing it really needs

00:41:22.386 --> 00:41:23.276 A:middle
is the target View.

00:41:24.196 --> 00:41:25.376 A:middle
The target View is the one that

00:41:25.376 --> 00:41:26.616 A:middle
we're going to animate to.

00:41:26.786 --> 00:41:28.326 A:middle
And in our situation, that's the

00:41:28.326 --> 00:41:29.596 A:middle
particle system on the left.

00:41:31.586 --> 00:41:33.256 A:middle
We keep a reference to the

00:41:33.256 --> 00:41:34.436 A:middle
transitioning controller that

00:41:34.436 --> 00:41:36.336 A:middle
we've just obtained via our

00:41:36.336 --> 00:41:36.866 A:middle
variable.

00:41:37.446 --> 00:41:40.246 A:middle
Now the last thing we really

00:41:40.246 --> 00:41:42.756 A:middle
have to do is implementing the

00:41:42.756 --> 00:41:44.276 A:middle
UI View Controller Transitioning

00:41:44.276 --> 00:41:45.246 A:middle
Delegate protocol.

00:41:53.436 --> 00:41:54.816 A:middle
Now, therefore, we implement the

00:41:54.816 --> 00:41:56.186 A:middle
two functions: animation

00:41:56.186 --> 00:41:57.566 A:middle
Controller for Presented View

00:41:57.566 --> 00:41:59.796 A:middle
Controller and also, because we

00:41:59.796 --> 00:42:00.686 A:middle
want to support closing

00:42:00.686 --> 00:42:02.356 A:middle
documents, animation Controller

00:42:02.356 --> 00:42:03.746 A:middle
for dismissed view controller.

00:42:04.736 --> 00:42:06.026 A:middle
In both functions, all we have

00:42:06.076 --> 00:42:06.966 A:middle
to do is return the

00:42:06.966 --> 00:42:08.156 A:middle
transitioning controller that

00:42:08.156 --> 00:42:08.986 A:middle
we've just obtained.

00:42:10.016 --> 00:42:10.696 A:middle
Let's try it out in the

00:42:10.696 --> 00:42:10.966 A:middle
simulator.

00:42:23.146 --> 00:42:24.036 A:middle
Beautiful, isn't it?

00:42:24.106 --> 00:42:25.606 A:middle
We get a nice transition from

00:42:25.606 --> 00:42:27.126 A:middle
the thumbnail to our particle

00:42:27.126 --> 00:42:27.606 A:middle
system.

00:42:28.166 --> 00:42:29.566 A:middle
And when we're done with the

00:42:29.566 --> 00:42:31.396 A:middle
file modifications, we tap the

00:42:31.396 --> 00:42:33.216 A:middle
Done button to close the file

00:42:33.216 --> 00:42:34.366 A:middle
again and we transition

00:42:34.366 --> 00:42:35.746 A:middle
beautifully back to our UI

00:42:35.746 --> 00:42:36.596 A:middle
Document Browser View

00:42:36.596 --> 00:42:37.056 A:middle
Controller.

00:42:37.616 --> 00:42:40.156 A:middle
So that's pretty much it for the

00:42:40.156 --> 00:42:40.846 A:middle
second demo.

00:42:41.166 --> 00:42:42.246 A:middle
Let's take a look at what we've

00:42:42.246 --> 00:42:42.926 A:middle
learned so far.

00:42:47.616 --> 00:42:49.726 A:middle
First, we've taken a look at how

00:42:49.726 --> 00:42:50.956 A:middle
easy it is to support

00:42:50.956 --> 00:42:52.126 A:middle
open-in-place in your

00:42:52.126 --> 00:42:52.756 A:middle
application.

00:42:53.166 --> 00:42:54.326 A:middle
The UI Document Browser View

00:42:54.326 --> 00:42:55.706 A:middle
Controller really does all the

00:42:55.706 --> 00:42:56.716 A:middle
heavy lifting for you.

00:42:58.516 --> 00:43:00.516 A:middle
Next, we've implemented a custom

00:43:00.516 --> 00:43:02.436 A:middle
action that shows up only when

00:43:02.436 --> 00:43:04.026 A:middle
you long press a document in the

00:43:04.026 --> 00:43:04.916 A:middle
Document Browser View

00:43:04.916 --> 00:43:05.416 A:middle
Controller.

00:43:05.986 --> 00:43:09.366 A:middle
And last but not least, we've

00:43:09.566 --> 00:43:11.016 A:middle
improved the user experience a

00:43:11.016 --> 00:43:12.686 A:middle
lot when opening and closing

00:43:12.686 --> 00:43:14.256 A:middle
documents by implementing a

00:43:14.256 --> 00:43:15.196 A:middle
custom view controller

00:43:15.196 --> 00:43:17.096 A:middle
transition using the UI Document

00:43:17.096 --> 00:43:18.276 A:middle
Browser Transition Controller.

00:43:18.276 --> 00:43:21.086 A:middle
Now that's pretty much it for

00:43:21.086 --> 00:43:21.886 A:middle
the second demo.

00:43:22.296 --> 00:43:24.346 A:middle
And to tell us what's new on the

00:43:24.346 --> 00:43:25.736 A:middle
Quick Look side, I would like to

00:43:25.736 --> 00:43:27.216 A:middle
hand it over to my colleague and

00:43:27.216 --> 00:43:28.046 A:middle
friend Maxime.

00:43:28.686 --> 00:43:28.906 A:middle
Maxime

00:43:29.016 --> 00:43:29.083 A:middle
[ Applause ]

00:43:29.083 --> 00:43:29.150 A:middle
.

00:43:29.150 --> 00:43:32.666 A:middle
&gt;&gt; Thank you, Raffael.

00:43:34.296 --> 00:43:34.976 A:middle
Good afternoon, everyone.

00:43:39.956 --> 00:43:41.346 A:middle
I'm sure you have all seen the

00:43:41.346 --> 00:43:42.836 A:middle
great thumbnails of the files

00:43:42.836 --> 00:43:46.286 A:middle
app and I'm sure you wish your

00:43:46.286 --> 00:43:47.916 A:middle
own thumbnails could show up in

00:43:47.996 --> 00:43:51.046 A:middle
any document browser based app.

00:43:51.046 --> 00:43:52.376 A:middle
You are now going to see how

00:43:52.486 --> 00:43:56.326 A:middle
this is possible thanks to the

00:43:56.326 --> 00:43:57.526 A:middle
new thumbnail extension.

00:43:57.526 --> 00:43:58.256 A:middle
Currently, [inaudible] particles

00:43:58.296 --> 00:43:59.436 A:middle
app that we're building

00:43:59.436 --> 00:44:01.336 A:middle
throughout this session, all we

00:44:01.336 --> 00:44:02.606 A:middle
can are generic icons.

00:44:03.796 --> 00:44:05.216 A:middle
We could highly improve the user

00:44:05.216 --> 00:44:07.286 A:middle
experience by displaying instead

00:44:07.706 --> 00:44:09.186 A:middle
representative thumbnails that

00:44:09.386 --> 00:44:11.336 A:middle
indicate to the user the content

00:44:11.496 --> 00:44:13.326 A:middle
of the files.

00:44:13.486 --> 00:44:14.276 A:middle
So how can you provide

00:44:14.316 --> 00:44:15.696 A:middle
thumbnails of files that have

00:44:15.696 --> 00:44:16.826 A:middle
been downloaded and are

00:44:16.826 --> 00:44:20.706 A:middle
available on the device?

00:44:21.886 --> 00:44:23.226 A:middle
This was already possible before

00:44:23.226 --> 00:44:25.096 A:middle
iOS 11 through UI Document.

00:44:25.746 --> 00:44:28.536 A:middle
What you have to do is create a

00:44:28.536 --> 00:44:30.006 A:middle
subclass of UI Document and

00:44:30.216 --> 00:44:31.476 A:middle
return the thumbnail from your

00:44:31.516 --> 00:44:32.686 A:middle
subclass.

00:44:33.376 --> 00:44:35.016 A:middle
This only works for files

00:44:35.056 --> 00:44:36.526 A:middle
created by your application and

00:44:37.276 --> 00:44:38.366 A:middle
this has good performance

00:44:38.366 --> 00:44:39.986 A:middle
because when iOS will ask your

00:44:39.986 --> 00:44:42.576 A:middle
subclass of the thumbnails, the

00:44:42.576 --> 00:44:43.876 A:middle
file will be already loaded.

00:44:44.686 --> 00:44:45.906 A:middle
Let's take a quick look at the

00:44:45.906 --> 00:44:46.076 A:middle
code.

00:44:47.186 --> 00:44:50.126 A:middle
What we have to do is implement

00:44:50.126 --> 00:44:52.356 A:middle
the file Attributes To Write to

00:44:52.356 --> 00:44:55.306 A:middle
URL for save Operation method in

00:44:55.306 --> 00:44:57.136 A:middle
your UI document subclass and

00:44:57.136 --> 00:44:59.446 A:middle
return a dictionary of

00:44:59.696 --> 00:45:03.186 A:middle
thumbnails from this function.

00:45:03.286 --> 00:45:05.596 A:middle
So this is nice but this again

00:45:05.596 --> 00:45:07.166 A:middle
works only for files created by

00:45:07.166 --> 00:45:07.976 A:middle
your application.

00:45:08.356 --> 00:45:09.266 A:middle
So how can you provide

00:45:09.266 --> 00:45:10.926 A:middle
thumbnails for files created by

00:45:10.926 --> 00:45:12.386 A:middle
[inaudible] applications and by

00:45:12.386 --> 00:45:13.416 A:middle
other applications?

00:45:13.986 --> 00:45:16.896 A:middle
For this we are providing you

00:45:16.896 --> 00:45:18.196 A:middle
with a new thumbnail extension

00:45:18.336 --> 00:45:19.286 A:middle
which is system wide.

00:45:19.286 --> 00:45:23.616 A:middle
It means that this extension,

00:45:24.476 --> 00:45:26.146 A:middle
means that any thumbnails

00:45:26.146 --> 00:45:27.326 A:middle
generated by [inaudible]

00:45:27.326 --> 00:45:30.866 A:middle
extension will be displayed in

00:45:30.866 --> 00:45:32.556 A:middle
any document files based app

00:45:32.556 --> 00:45:35.276 A:middle
that displays files that your

00:45:35.276 --> 00:45:36.446 A:middle
extension can provide thumbnails

00:45:36.446 --> 00:45:36.686 A:middle
for.

00:45:38.546 --> 00:45:39.746 A:middle
This extension works with all

00:45:39.746 --> 00:45:42.476 A:middle
cloud vendors and is part of the

00:45:42.476 --> 00:45:43.186 A:middle
Quick Look framework.

00:45:43.666 --> 00:45:46.186 A:middle
Let's see how this works.

00:45:46.936 --> 00:45:48.856 A:middle
First, your document

00:45:48.856 --> 00:45:51.096 A:middle
browser-based app is displaying

00:45:51.096 --> 00:45:52.416 A:middle
-- Let's say that the document

00:45:52.416 --> 00:45:53.866 A:middle
browser based app is displaying

00:45:53.866 --> 00:45:54.496 A:middle
a set of files.

00:45:54.596 --> 00:45:56.116 A:middle
And if we want to display

00:45:56.116 --> 00:45:57.236 A:middle
thumbnails for these files to

00:45:57.236 --> 00:45:58.276 A:middle
have a good user experience,

00:45:58.886 --> 00:46:00.396 A:middle
it's going to Quick Look for

00:46:00.396 --> 00:46:00.816 A:middle
thumbnails.

00:46:01.956 --> 00:46:03.966 A:middle
Quick Look, we notice that for

00:46:04.046 --> 00:46:05.326 A:middle
some of these files, [inaudible]

00:46:05.326 --> 00:46:06.836 A:middle
extension is the one that can

00:46:07.066 --> 00:46:07.976 A:middle
provide thumbnails, so it's

00:46:07.976 --> 00:46:10.076 A:middle
going to forward the request to

00:46:10.076 --> 00:46:10.706 A:middle
your extension.

00:46:11.306 --> 00:46:13.776 A:middle
Your extension will generate

00:46:13.776 --> 00:46:16.676 A:middle
thumbnails, return them back to

00:46:16.676 --> 00:46:18.816 A:middle
Quick Look which will finally

00:46:18.816 --> 00:46:20.476 A:middle
forward them back to the app

00:46:20.476 --> 00:46:21.886 A:middle
that asked for the thumbnails,

00:46:22.606 --> 00:46:24.746 A:middle
which will be able to display

00:46:25.336 --> 00:46:25.436 A:middle
them.

00:46:25.646 --> 00:46:26.416 A:middle
Let's see how you can get

00:46:26.456 --> 00:46:26.856 A:middle
started.

00:46:27.466 --> 00:46:30.826 A:middle
This is actually pretty simple

00:46:30.996 --> 00:46:32.776 A:middle
because we added a new template

00:46:32.776 --> 00:46:34.496 A:middle
in Xcode that contains some

00:46:34.496 --> 00:46:35.886 A:middle
sample code for you as well as

00:46:35.886 --> 00:46:36.666 A:middle
an Info.plist.

00:46:38.086 --> 00:46:39.906 A:middle
After creating your extension,

00:46:40.356 --> 00:46:41.186 A:middle
you will want to head to the

00:46:41.186 --> 00:46:42.586 A:middle
Info.plist file and edit it.

00:46:42.586 --> 00:46:44.476 A:middle
So first thing you will have to

00:46:44.476 --> 00:46:46.536 A:middle
do is add all the UTIs you can

00:46:46.536 --> 00:46:47.386 A:middle
[inaudible] to QL Supported

00:46:47.466 --> 00:46:48.796 A:middle
Content Types array.

00:46:48.796 --> 00:46:51.786 A:middle
Please note that you can only

00:46:51.786 --> 00:46:54.016 A:middle
provide thumbnails for UTIs you

00:46:54.016 --> 00:46:56.856 A:middle
own and export and that iOS will

00:46:56.856 --> 00:46:58.466 A:middle
check for UTI equality and not

00:46:58.466 --> 00:46:59.306 A:middle
UTI conformance.

00:46:59.396 --> 00:47:00.496 A:middle
So we'll have to make sure to

00:47:01.016 --> 00:47:03.916 A:middle
list all the UTIs inside

00:47:03.916 --> 00:47:06.156 A:middle
[inaudible] of the plist.

00:47:06.316 --> 00:47:07.746 A:middle
Now how can you actually provide

00:47:07.746 --> 00:47:08.826 A:middle
thumbnails for files?

00:47:09.056 --> 00:47:09.716 A:middle
There are two ways.

00:47:10.576 --> 00:47:11.456 A:middle
You can either draw the

00:47:11.456 --> 00:47:13.486 A:middle
thumbnail or return the image

00:47:13.486 --> 00:47:13.996 A:middle
file URL.

00:47:14.486 --> 00:47:15.916 A:middle
So the most preferred one is of

00:47:15.916 --> 00:47:17.376 A:middle
course the first one, drawing

00:47:17.376 --> 00:47:18.536 A:middle
the thumbnail, because it's the

00:47:18.536 --> 00:47:19.356 A:middle
most flexible one.

00:47:19.926 --> 00:47:23.806 A:middle
Let's see how it works.

00:47:24.016 --> 00:47:25.266 A:middle
So any method you will have to

00:47:25.266 --> 00:47:27.286 A:middle
implement in this extension will

00:47:27.286 --> 00:47:30.326 A:middle
receive a parameter of class QL

00:47:30.326 --> 00:47:32.166 A:middle
File Thumbnail Request which

00:47:32.166 --> 00:47:32.966 A:middle
contains three [inaudible].

00:47:32.966 --> 00:47:36.346 A:middle
The file URL, the URL of the

00:47:36.346 --> 00:47:38.296 A:middle
file we want to send a file, the

00:47:38.296 --> 00:47:40.176 A:middle
maximum size of the thumbnail

00:47:40.176 --> 00:47:41.816 A:middle
which is requested, as well as

00:47:41.816 --> 00:47:42.236 A:middle
the scale.

00:47:43.036 --> 00:47:46.456 A:middle
What do we have to return is a

00:47:46.456 --> 00:47:48.066 A:middle
QL Thumbnail Reply object

00:47:48.106 --> 00:47:50.566 A:middle
containing the Drawing Block and

00:47:50.566 --> 00:47:51.206 A:middle
context Size.

00:47:51.206 --> 00:47:53.146 A:middle
Let's see why you need to return

00:47:53.146 --> 00:47:55.006 A:middle
the context Size.

00:47:55.596 --> 00:47:57.856 A:middle
The maximum size parameter of

00:47:57.856 --> 00:48:00.176 A:middle
the request indicates to you the

00:48:00.176 --> 00:48:02.186 A:middle
maximum size of the CG Context

00:48:02.186 --> 00:48:03.496 A:middle
you can draw your thumbnail

00:48:03.496 --> 00:48:03.846 A:middle
into.

00:48:05.316 --> 00:48:06.896 A:middle
Now let's say that we want to

00:48:06.896 --> 00:48:09.106 A:middle
draw this image into our

00:48:09.106 --> 00:48:09.526 A:middle
context.

00:48:09.576 --> 00:48:11.016 A:middle
As you can see at full scale,

00:48:11.016 --> 00:48:12.616 A:middle
it's bigger than the maximum

00:48:12.666 --> 00:48:13.526 A:middle
size of the Context.

00:48:13.636 --> 00:48:16.456 A:middle
So what we'll have to do is

00:48:16.456 --> 00:48:19.046 A:middle
downscale it to make sure that

00:48:19.046 --> 00:48:20.786 A:middle
it can fit within the CG

00:48:20.786 --> 00:48:21.206 A:middle
Context.

00:48:21.206 --> 00:48:23.146 A:middle
But if we load this image into

00:48:23.146 --> 00:48:26.656 A:middle
the context we have on the left,

00:48:26.976 --> 00:48:28.906 A:middle
we'll end up returning a

00:48:28.906 --> 00:48:31.296 A:middle
thumbnail with unused

00:48:31.526 --> 00:48:32.296 A:middle
[inaudible], meaning a floating

00:48:32.346 --> 00:48:33.656 A:middle
thumbnail, which is not what we

00:48:33.656 --> 00:48:33.786 A:middle
want.

00:48:33.786 --> 00:48:36.316 A:middle
So we'll have to determine the

00:48:36.316 --> 00:48:37.706 A:middle
correct context size in which we

00:48:37.706 --> 00:48:40.136 A:middle
want to draw and pass it to the

00:48:40.136 --> 00:48:41.046 A:middle
QL Thumbnail Reply.

00:48:42.066 --> 00:48:44.136 A:middle
Thanks to that, our Drawing

00:48:44.136 --> 00:48:46.696 A:middle
Block will receive CG Context

00:48:47.826 --> 00:48:49.536 A:middle
correctly set with the requested

00:48:49.616 --> 00:48:52.236 A:middle
size, the context Size, and

00:48:52.236 --> 00:48:55.346 A:middle
we'll be able to draw the

00:48:56.476 --> 00:48:56.716 A:middle
thumbnail [inaudible].

00:48:57.076 --> 00:48:58.496 A:middle
Now if you don't want to draw a

00:48:58.496 --> 00:49:00.436 A:middle
thumbnail and you prefer

00:49:00.436 --> 00:49:03.006 A:middle
returning an image file URL

00:49:03.006 --> 00:49:04.976 A:middle
instead, this is quite simple.

00:49:05.306 --> 00:49:07.976 A:middle
You will receive the same QL

00:49:07.976 --> 00:49:10.386 A:middle
File Thumbnail Request and all

00:49:10.386 --> 00:49:11.886 A:middle
you have to return is a QL

00:49:11.886 --> 00:49:12.996 A:middle
Thumbnail Reply containing an

00:49:12.996 --> 00:49:13.796 A:middle
image file URL.

00:49:14.346 --> 00:49:16.626 A:middle
In this case, Quick Look will be

00:49:16.626 --> 00:49:18.606 A:middle
the one that will take care of

00:49:18.606 --> 00:49:19.986 A:middle
downscaling or upscaling of

00:49:19.986 --> 00:49:20.756 A:middle
thumbnail.

00:49:20.896 --> 00:49:22.176 A:middle
It will keep the aspect ratio of

00:49:22.176 --> 00:49:24.566 A:middle
your file so that the thumbnail

00:49:24.566 --> 00:49:24.926 A:middle
will [inaudible].

00:49:25.666 --> 00:49:29.296 A:middle
Let's now take a look at how

00:49:29.296 --> 00:49:30.076 A:middle
this works in code.

00:49:31.076 --> 00:49:32.026 A:middle
The only method you have to

00:49:32.026 --> 00:49:34.476 A:middle
implement is called provide

00:49:34.516 --> 00:49:37.156 A:middle
Thumbnail for request handler.

00:49:37.226 --> 00:49:42.186 A:middle
The first thing we do in this

00:49:42.186 --> 00:49:44.136 A:middle
example is extracting all the

00:49:44.136 --> 00:49:45.186 A:middle
parameters of the QL File

00:49:45.486 --> 00:49:46.936 A:middle
Thumbnail Request.

00:49:47.396 --> 00:49:49.156 A:middle
This means the file URL, the

00:49:49.156 --> 00:49:51.746 A:middle
maximum size, and the scale.

00:49:52.726 --> 00:49:55.296 A:middle
Out of these parameters, we

00:49:55.296 --> 00:49:57.106 A:middle
determine the context Size in

00:49:57.106 --> 00:49:58.056 A:middle
which we want to do our

00:49:58.056 --> 00:49:59.066 A:middle
thumbnail, just like in the

00:49:59.066 --> 00:50:00.696 A:middle
example we saw before.

00:50:02.986 --> 00:50:06.466 A:middle
After that, as we said, we need

00:50:06.466 --> 00:50:08.266 A:middle
to provide a drawing Block.

00:50:09.136 --> 00:50:11.236 A:middle
So here we create it and this is

00:50:11.236 --> 00:50:12.276 A:middle
[inaudible] that we'll have to

00:50:12.946 --> 00:50:13.786 A:middle
draw a thumbnail.

00:50:14.236 --> 00:50:16.456 A:middle
So drawing Block has to return a

00:50:16.456 --> 00:50:18.446 A:middle
success value to indicate Quick

00:50:18.446 --> 00:50:20.816 A:middle
Look [inaudible] it was actually

00:50:20.816 --> 00:50:21.776 A:middle
able to provide a thumbnail.

00:50:23.226 --> 00:50:24.356 A:middle
Finally, we create the QL

00:50:24.356 --> 00:50:25.466 A:middle
Thumbnail Reply out of the

00:50:25.466 --> 00:50:27.466 A:middle
context Size and the drawing

00:50:27.466 --> 00:50:31.176 A:middle
Block and we call the completion

00:50:31.176 --> 00:50:34.506 A:middle
handler with our reply as well

00:50:34.506 --> 00:50:34.676 A:middle
as [inaudible].

00:50:35.366 --> 00:50:36.386 A:middle
Here we [inaudible] nil because

00:50:36.386 --> 00:50:37.396 A:middle
we always want to provide a

00:50:37.396 --> 00:50:39.556 A:middle
thumbnail but if for some reason

00:50:39.746 --> 00:50:41.746 A:middle
you don't want to always return

00:50:41.746 --> 00:50:42.466 A:middle
a thumbnail for all the

00:50:42.466 --> 00:50:46.126 A:middle
requests, you will have to

00:50:46.126 --> 00:50:46.676 A:middle
provide an [inaudible] to

00:50:46.726 --> 00:50:48.256 A:middle
indicate quickly that you don't

00:50:48.286 --> 00:50:51.706 A:middle
want to provide a thumbnail for

00:50:51.736 --> 00:50:52.586 A:middle
this request.

00:50:52.586 --> 00:50:54.486 A:middle
If you'd like to return an image

00:50:54.546 --> 00:50:56.736 A:middle
file URL instead of drawing a

00:50:56.796 --> 00:50:58.946 A:middle
thumbnail file request, you

00:50:58.946 --> 00:51:00.276 A:middle
implement the same method but

00:51:00.276 --> 00:51:02.006 A:middle
you call the completion handler

00:51:02.006 --> 00:51:03.116 A:middle
with a QL Thumbnail Reply

00:51:03.246 --> 00:51:05.146 A:middle
containing the image file URL.

00:51:05.656 --> 00:51:07.116 A:middle
In this simple example, we just

00:51:07.116 --> 00:51:09.016 A:middle
return an image from our main

00:51:09.766 --> 00:51:09.916 A:middle
vendor.

00:51:10.386 --> 00:51:14.456 A:middle
After creating your extension,

00:51:14.826 --> 00:51:16.746 A:middle
you will of course want to see

00:51:16.876 --> 00:51:18.026 A:middle
your beautiful new thumbnails.

00:51:18.926 --> 00:51:20.746 A:middle
You can see them in any document

00:51:20.746 --> 00:51:22.736 A:middle
browser based app that displays

00:51:22.736 --> 00:51:23.626 A:middle
your files.

00:51:23.846 --> 00:51:25.796 A:middle
So here, what we can see on the

00:51:25.796 --> 00:51:27.546 A:middle
screenshot are thumbnails that

00:51:27.546 --> 00:51:29.956 A:middle
come from the extension of

00:51:30.116 --> 00:51:35.346 A:middle
Particles app but we are inside

00:51:35.416 --> 00:51:37.056 A:middle
the Recents [inaudible] Files

00:51:37.056 --> 00:51:40.626 A:middle
app but still we see them.

00:51:42.146 --> 00:51:44.836 A:middle
You now know how to build great

00:51:44.836 --> 00:51:46.286 A:middle
document-based applications

00:51:46.286 --> 00:51:47.846 A:middle
thanks to the UI Document

00:51:47.846 --> 00:51:49.666 A:middle
Browser View Controller and the

00:51:49.666 --> 00:51:50.486 A:middle
thumbnail extension.

00:51:51.166 --> 00:51:55.256 A:middle
So how can you improve the user

00:51:55.346 --> 00:51:56.686 A:middle
experience even further?

00:51:57.176 --> 00:51:58.056 A:middle
[Inaudible] UTIs, you will

00:51:58.056 --> 00:51:59.086 A:middle
likely want to be able to

00:51:59.086 --> 00:52:00.856 A:middle
provide previews that iOS can

00:52:00.856 --> 00:52:04.086 A:middle
display in any application.

00:52:04.326 --> 00:52:06.836 A:middle
We are now going to see how this

00:52:06.866 --> 00:52:09.036 A:middle
is possible thanks to the new

00:52:09.036 --> 00:52:14.486 A:middle
Quick Look Preview extension.

00:52:15.116 --> 00:52:16.736 A:middle
By default, Quick Look

00:52:17.116 --> 00:52:17.896 A:middle
[inaudible] set of file types.

00:52:18.536 --> 00:52:19.586 A:middle
This means that Quick Look by

00:52:19.586 --> 00:52:22.186 A:middle
default cannot preview your

00:52:22.426 --> 00:52:23.196 A:middle
custom file types.

00:52:24.096 --> 00:52:27.296 A:middle
But I have good news because

00:52:27.496 --> 00:52:30.656 A:middle
starting with iOS 11, you will

00:52:30.656 --> 00:52:31.796 A:middle
be able to provide previews to

00:52:31.796 --> 00:52:34.866 A:middle
Quick Look and extend the

00:52:34.866 --> 00:52:36.066 A:middle
capabilities of Quick Look

00:52:36.866 --> 00:52:38.106 A:middle
because we are opening Quick

00:52:38.106 --> 00:52:39.336 A:middle
Look to [inaudible].

00:52:40.436 --> 00:52:42.306 A:middle
We are opening QuickLook

00:52:42.916 --> 00:52:45.206 A:middle
[inaudible] so when you preview

00:52:45.206 --> 00:52:47.416 A:middle
extension which is system-wide,

00:52:47.796 --> 00:52:49.926 A:middle
this means that again any

00:52:49.926 --> 00:52:51.206 A:middle
application that uses Quick Look

00:52:51.206 --> 00:52:52.556 A:middle
will be able to display your

00:52:52.556 --> 00:52:55.066 A:middle
previews and you can also decide

00:52:55.066 --> 00:52:56.566 A:middle
to provide previews for

00:52:56.566 --> 00:52:58.036 A:middle
Spotlight items [inaudible] by

00:52:58.036 --> 00:52:58.736 A:middle
your application.

00:52:59.246 --> 00:53:00.426 A:middle
These previews will be visible

00:53:01.226 --> 00:53:03.156 A:middle
when peeking on Spotlight

00:53:03.156 --> 00:53:03.223 A:middle
[inaudible].

00:53:03.223 --> 00:53:04.486 A:middle
On the iPhone, that's

00:53:04.486 --> 00:53:04.553 A:middle
[inaudible].

00:53:04.553 --> 00:53:06.736 A:middle
Your previews will be

00:53:07.076 --> 00:53:08.036 A:middle
[inaudible] in Quick Look.

00:53:08.036 --> 00:53:11.186 A:middle
They will benefit from the full

00:53:11.856 --> 00:53:14.976 A:middle
Quick Look experience and the

00:53:14.976 --> 00:53:17.026 A:middle
previewed as part of QL Preview

00:53:17.026 --> 00:53:19.036 A:middle
Controller just like any other

00:53:19.076 --> 00:53:19.396 A:middle
[inaudible] preview.

00:53:20.566 --> 00:53:21.626 A:middle
Quick Look will take care of

00:53:21.626 --> 00:53:22.616 A:middle
displaying a loading spinner

00:53:22.616 --> 00:53:24.336 A:middle
while waiting for your extension

00:53:24.336 --> 00:53:25.146 A:middle
to return the preview.

00:53:25.776 --> 00:53:26.776 A:middle
Let's see the flow.

00:53:27.386 --> 00:53:29.826 A:middle
First, Quick Look notices that

00:53:29.826 --> 00:53:33.596 A:middle
it can't preview file by itself

00:53:33.596 --> 00:53:34.746 A:middle
but will ask for extension for

00:53:34.746 --> 00:53:35.126 A:middle
preview.

00:53:35.956 --> 00:53:37.326 A:middle
Your extension will take some

00:53:37.326 --> 00:53:38.366 A:middle
time to generate a preview.

00:53:39.786 --> 00:53:41.176 A:middle
Meanwhile, Quick Look displays a

00:53:41.176 --> 00:53:41.756 A:middle
loading spinner.

00:53:42.446 --> 00:53:43.526 A:middle
You don't have to take care of

00:53:43.526 --> 00:53:43.716 A:middle
this.

00:53:44.866 --> 00:53:47.386 A:middle
And when your extension is ready

00:53:47.386 --> 00:53:48.626 A:middle
to display the preview, you will

00:53:48.626 --> 00:53:49.586 A:middle
have to call the completion

00:53:49.586 --> 00:53:51.286 A:middle
handler in your code to notify

00:53:51.286 --> 00:53:53.706 A:middle
Quick Look that it can actually

00:53:53.706 --> 00:53:54.836 A:middle
display your preview.

00:53:55.396 --> 00:53:57.196 A:middle
Just like [inaudible] extension,

00:53:57.196 --> 00:53:59.166 A:middle
you can get started pretty

00:53:59.166 --> 00:54:01.046 A:middle
easily because, again, we have a

00:54:01.046 --> 00:54:02.336 A:middle
new template ready for you that

00:54:02.336 --> 00:54:04.036 A:middle
contains some sample code, a

00:54:04.036 --> 00:54:05.826 A:middle
storybook, and an Info.plist.

00:54:08.216 --> 00:54:09.516 A:middle
After creating your extension,

00:54:09.516 --> 00:54:11.286 A:middle
again you will want to head to

00:54:11.286 --> 00:54:13.106 A:middle
this Info.plist and edit it, add

00:54:13.696 --> 00:54:14.936 A:middle
edit it, add all the UTIs

00:54:14.936 --> 00:54:17.486 A:middle
[inaudible], sorry, all the UTIs

00:54:17.486 --> 00:54:18.786 A:middle
[inaudible] to the QL Supported

00:54:18.786 --> 00:54:19.366 A:middle
Content Types array.

00:54:19.366 --> 00:54:22.736 A:middle
Just like for the thumbnail

00:54:22.736 --> 00:54:24.376 A:middle
extension that you can only

00:54:24.376 --> 00:54:25.936 A:middle
provide previews for images you

00:54:25.936 --> 00:54:28.936 A:middle
own and export and that again,

00:54:28.936 --> 00:54:30.466 A:middle
iOS will check for UTI equality

00:54:30.466 --> 00:54:31.526 A:middle
and not UTI conformance.

00:54:32.716 --> 00:54:35.816 A:middle
If you wish to provide previews

00:54:35.946 --> 00:54:37.756 A:middle
for Spotlight items indicated by

00:54:37.756 --> 00:54:39.136 A:middle
your application, you will have

00:54:39.186 --> 00:54:40.206 A:middle
to set the QL Supports

00:54:40.206 --> 00:54:42.206 A:middle
Searchable Items key to yes.

00:54:42.376 --> 00:54:45.836 A:middle
Now let's take a quick look at

00:54:46.656 --> 00:54:48.046 A:middle
how we can [inaudible].

00:54:48.316 --> 00:54:49.346 A:middle
If you want to provide previews

00:54:49.346 --> 00:54:51.416 A:middle
for file, you will have to

00:54:51.516 --> 00:54:53.656 A:middle
implement the prepare Preview of

00:54:53.706 --> 00:54:55.806 A:middle
File at URL completion handle

00:54:55.806 --> 00:54:57.416 A:middle
[inaudible].

00:54:57.416 --> 00:54:59.366 A:middle
And all you have to do here is

00:54:59.366 --> 00:55:00.596 A:middle
load the file and call the

00:55:00.596 --> 00:55:02.566 A:middle
completion handler so that Quick

00:55:02.596 --> 00:55:03.956 A:middle
Look displays your preview.

00:55:04.996 --> 00:55:05.986 A:middle
You can call the completion

00:55:05.986 --> 00:55:07.546 A:middle
handler asynchronously which is

00:55:07.726 --> 00:55:09.566 A:middle
the case in this example.

00:55:10.396 --> 00:55:12.076 A:middle
If you wish to provide Spotlight

00:55:12.076 --> 00:55:14.196 A:middle
previews, you will have to

00:55:14.196 --> 00:55:15.866 A:middle
implement the prepare Preview of

00:55:15.866 --> 00:55:17.806 A:middle
Searchable Items identifier

00:55:17.866 --> 00:55:19.486 A:middle
query String, completion Handler

00:55:19.486 --> 00:55:19.746 A:middle
method.

00:55:20.546 --> 00:55:22.306 A:middle
The query String parameter can

00:55:22.306 --> 00:55:24.236 A:middle
be used to highlight any part of

00:55:24.236 --> 00:55:25.296 A:middle
the preview for the user.

00:55:25.886 --> 00:55:27.706 A:middle
This is the query String that

00:55:27.706 --> 00:55:28.446 A:middle
the user [inaudible] in

00:55:28.446 --> 00:55:30.396 A:middle
Spotlight before interacting

00:55:30.506 --> 00:55:32.666 A:middle
[inaudible] that you index with

00:55:32.666 --> 00:55:33.846 A:middle
your application.

00:55:35.246 --> 00:55:39.976 A:middle
Just like with file example, all

00:55:39.976 --> 00:55:41.756 A:middle
you have to do is prepare your

00:55:41.756 --> 00:55:42.636 A:middle
controller and call the

00:55:42.636 --> 00:55:43.336 A:middle
completion handler.

00:55:44.076 --> 00:55:48.356 A:middle
You can test your preview in any

00:55:48.356 --> 00:55:49.756 A:middle
application that uses Quick

00:55:49.756 --> 00:55:51.966 A:middle
Look, for example mail or

00:55:51.966 --> 00:55:55.016 A:middle
messages or in Spotlight if

00:55:55.626 --> 00:55:56.376 A:middle
[inaudible] which is the case in

00:55:56.376 --> 00:55:57.286 A:middle
this example.

00:55:57.536 --> 00:55:58.426 A:middle
We are here peeking on the

00:55:58.426 --> 00:55:59.806 A:middle
result index by the particles

00:55:59.806 --> 00:55:59.976 A:middle
app.

00:56:05.706 --> 00:56:07.046 A:middle
I'd like to finish this

00:56:07.046 --> 00:56:08.186 A:middle
extension tour with a few

00:56:08.186 --> 00:56:09.306 A:middle
performance recommendations.

00:56:09.946 --> 00:56:11.276 A:middle
When dealing with extension, you

00:56:11.276 --> 00:56:12.296 A:middle
always have to make sure to be

00:56:12.296 --> 00:56:14.086 A:middle
fast and in this case it's very

00:56:14.086 --> 00:56:14.576 A:middle
important.

00:56:14.576 --> 00:56:16.836 A:middle
You will have to load the

00:56:16.836 --> 00:56:18.016 A:middle
thumbnail quickly especially

00:56:18.016 --> 00:56:21.446 A:middle
think of a case for instance of

00:56:21.446 --> 00:56:25.836 A:middle
the user calling in the document

00:56:25.836 --> 00:56:27.686 A:middle
browser you want your thumbnails

00:56:27.686 --> 00:56:29.096 A:middle
to be there as fast as possible

00:56:29.096 --> 00:56:29.926 A:middle
for a good user experience.

00:56:31.026 --> 00:56:32.736 A:middle
For the Quick Look previews, you

00:56:32.736 --> 00:56:34.646 A:middle
will also have to make sure to

00:56:34.646 --> 00:56:36.256 A:middle
load your previews fast because

00:56:36.256 --> 00:56:37.456 A:middle
Quick Look is expected to be

00:56:37.796 --> 00:56:38.036 A:middle
quick.

00:56:39.846 --> 00:56:42.036 A:middle
Also not that you shouldn't have

00:56:42.036 --> 00:56:43.626 A:middle
any background job after calling

00:56:43.626 --> 00:56:44.446 A:middle
the completion handler.

00:56:45.146 --> 00:56:47.936 A:middle
Keep in mind that with extension

00:56:47.936 --> 00:56:51.216 A:middle
memory is very limited, so avoid

00:56:51.216 --> 00:56:52.186 A:middle
linking against two large

00:56:52.186 --> 00:56:54.256 A:middle
libraries and check for leaks.

00:56:55.656 --> 00:56:56.886 A:middle
Let's now recap quickly

00:56:56.886 --> 00:56:57.996 A:middle
everything we talked about

00:56:57.996 --> 00:56:58.346 A:middle
today.

00:56:59.776 --> 00:57:02.576 A:middle
First, we talked about some

00:57:02.576 --> 00:57:04.606 A:middle
document browser APIs.

00:57:04.606 --> 00:57:06.796 A:middle
We mainly talked about UI

00:57:06.796 --> 00:57:08.246 A:middle
Document Browser View Controller

00:57:08.246 --> 00:57:09.466 A:middle
and how you can make use of it

00:57:10.486 --> 00:57:12.826 A:middle
to create a great document-based

00:57:12.826 --> 00:57:13.406 A:middle
application.

00:57:13.976 --> 00:57:15.646 A:middle
You learned about its basic and

00:57:15.646 --> 00:57:16.296 A:middle
advanced features.

00:57:17.526 --> 00:57:19.216 A:middle
We then saw how you could make

00:57:19.866 --> 00:57:21.556 A:middle
your custom file tags

00:57:21.626 --> 00:57:24.306 A:middle
[inaudible] on iOS 11 thanks to

00:57:24.306 --> 00:57:26.016 A:middle
the new thumbnail and Quick Look

00:57:26.016 --> 00:57:27.016 A:middle
preview extensions.

00:57:27.016 --> 00:57:30.696 A:middle
Now let's take another look at

00:57:30.696 --> 00:57:33.376 A:middle
the requests we have received

00:57:33.596 --> 00:57:34.616 A:middle
from you in the past two years

00:57:34.616 --> 00:57:36.446 A:middle
and see how we addressed them,

00:57:37.106 --> 00:57:38.346 A:middle
so everything we talked about

00:57:38.346 --> 00:57:38.576 A:middle
today.

00:57:40.716 --> 00:57:41.666 A:middle
UI Document Browser View

00:57:41.666 --> 00:57:43.426 A:middle
Controller provides you with a

00:57:43.426 --> 00:57:44.786 A:middle
unified UI for file browsing.

00:57:46.056 --> 00:57:48.466 A:middle
The new local storage and other

00:57:48.466 --> 00:57:50.176 A:middle
cloud providers give you access

00:57:50.216 --> 00:57:52.866 A:middle
to files from other applications

00:57:52.866 --> 00:57:53.236 A:middle
in [inaudible].

00:57:55.856 --> 00:57:57.296 A:middle
The new file provider extension

00:57:57.406 --> 00:57:58.526 A:middle
allows you to have seamless

00:57:58.526 --> 00:58:01.986 A:middle
access to other Cloud Providers.

00:58:01.986 --> 00:58:03.376 A:middle
And iOS now has a deep

00:58:03.376 --> 00:58:06.036 A:middle
integration of custom file

00:58:07.876 --> 00:58:08.016 A:middle
types.

00:58:08.206 --> 00:58:09.986 A:middle
As usual, if you wish to have

00:58:09.986 --> 00:58:11.046 A:middle
more information about our

00:58:11.076 --> 00:58:13.316 A:middle
session, you can visit Apple's

00:58:13.316 --> 00:58:14.156 A:middle
website.

00:58:15.466 --> 00:58:16.736 A:middle
We invite you to check out these

00:58:16.736 --> 00:58:18.466 A:middle
related sessions, the Drag and

00:58:18.466 --> 00:58:21.346 A:middle
Drop session that was earlier

00:58:21.346 --> 00:58:23.326 A:middle
this week and the upcoming

00:58:23.696 --> 00:58:24.926 A:middle
What's new in Core Spotlight for

00:58:24.926 --> 00:58:26.816 A:middle
iOS and macOS and File Provider

00:58:26.816 --> 00:58:27.736 A:middle
Enhancement sessions.

00:58:27.736 --> 00:58:30.516 A:middle
You can also check out previews

00:58:30.816 --> 00:58:33.276 A:middle
Building Document-Based Apps

00:58:33.276 --> 00:58:34.386 A:middle
from 2017.

00:58:35.696 --> 00:58:36.606 A:middle
Thank you all for your

00:58:36.696 --> 00:58:39.016 A:middle
attention.

00:58:39.016 --> 00:58:39.456 A:middle
[Inaudible].

00:58:39.456 --> 00:58:39.686 A:middle
Bye.

00:58:40.516 --> 00:58:43.500 A:middle
[ Applause ]