WEBVTT

00:00:01.516 --> 00:00:04.500 A:middle
[ Music ]

00:00:10.646 --> 00:00:13.176 A:middle
&gt;&gt; Multi-camera capture or as we

00:00:13.176 --> 00:00:14.506 A:middle
like to call it internally,

00:00:15.106 --> 00:00:16.886 A:middle
MultiCam.

00:00:17.896 --> 00:00:20.356 A:middle
MultiCam is our single most

00:00:20.396 --> 00:00:21.976 A:middle
requested third-party feature.

00:00:21.976 --> 00:00:23.766 A:middle
We hear it year after year in

00:00:23.766 --> 00:00:24.246 A:middle
the labs.

00:00:24.246 --> 00:00:25.876 A:middle
So what we're talking about here

00:00:25.876 --> 00:00:27.846 A:middle
is the ability to simultaneously

00:00:27.846 --> 00:00:31.536 A:middle
capture video, audio, metadata,

00:00:31.816 --> 00:00:34.666 A:middle
depth and photos from multiple

00:00:34.666 --> 00:00:35.786 A:middle
cameras and microphones

00:00:35.786 --> 00:00:36.686 A:middle
simultaneously.

00:00:37.236 --> 00:00:40.186 A:middle
Third parties aren't the only

00:00:40.186 --> 00:00:41.306 A:middle
ones who benefit from this

00:00:41.306 --> 00:00:41.556 A:middle
though.

00:00:42.166 --> 00:00:44.416 A:middle
We've had many and repeated

00:00:44.416 --> 00:00:45.566 A:middle
requests from first-party

00:00:45.596 --> 00:00:47.426 A:middle
clients as well for MultiCam

00:00:47.466 --> 00:00:47.916 A:middle
capture.

00:00:48.416 --> 00:00:50.096 A:middle
Chief among them is ARKit.

00:00:50.456 --> 00:00:51.966 A:middle
And if you heard the keynote,

00:00:52.516 --> 00:00:53.736 A:middle
you heard about the introduction

00:00:53.736 --> 00:00:54.936 A:middle
of ARKit 3.

00:00:55.576 --> 00:00:57.876 A:middle
These APIs use front camera for

00:00:57.966 --> 00:01:00.166 A:middle
face and pose tracking while

00:00:57.966 --> 00:01:00.166 A:middle
face and pose tracking while

00:01:00.166 --> 00:01:01.656 A:middle
also using the back camera for

00:01:01.656 --> 00:01:03.416 A:middle
world tracking which helps them

00:01:03.416 --> 00:01:04.686 A:middle
know where to place virtual

00:01:04.686 --> 00:01:06.266 A:middle
characters in the scene by

00:01:06.266 --> 00:01:07.296 A:middle
knowing what you're gazing at.

00:01:08.876 --> 00:01:10.776 A:middle
So we've supported MultiCam on

00:01:10.776 --> 00:01:12.936 A:middle
the Mac since the very first

00:01:12.936 --> 00:01:15.166 A:middle
appearance of AVFoundation way

00:01:15.166 --> 00:01:16.276 A:middle
the heck back in Lion.

00:01:17.126 --> 00:01:19.446 A:middle
But on iOS, AVFoundation still

00:01:19.446 --> 00:01:21.226 A:middle
limits clients to one active

00:01:21.286 --> 00:01:22.286 A:middle
camera at a time.

00:01:22.906 --> 00:01:24.716 A:middle
And it's not because we're mean.

00:01:24.916 --> 00:01:26.356 A:middle
There were good reasons for it.

00:01:26.756 --> 00:01:27.996 A:middle
The first reason is hardware

00:01:27.996 --> 00:01:28.796 A:middle
limitations.

00:01:29.346 --> 00:01:30.796 A:middle
I'm talking about cameras

00:01:30.846 --> 00:01:33.296 A:middle
sharing power rails and not

00:01:33.566 --> 00:01:34.896 A:middle
physically being able to provide

00:01:34.896 --> 00:01:36.256 A:middle
enough power to power two

00:01:36.296 --> 00:01:37.726 A:middle
cameras simultaneously full

00:01:37.726 --> 00:01:38.096 A:middle
bore.

00:01:38.816 --> 00:01:41.016 A:middle
And the second reason was our

00:01:41.016 --> 00:01:42.766 A:middle
desire to ship a responsible

00:01:42.766 --> 00:01:44.896 A:middle
API, one that would help you not

00:01:45.016 --> 00:01:47.516 A:middle
burn the phone down when doing

00:01:47.516 --> 00:01:49.126 A:middle
all of this processing power

00:01:49.126 --> 00:01:50.186 A:middle
with multiple cameras

00:01:50.186 --> 00:01:51.076 A:middle
simultaneously.

00:01:51.076 --> 00:01:52.146 A:middle
So we wanted to make sure that

00:01:52.146 --> 00:01:53.226 A:middle
we delivered something to you

00:01:53.226 --> 00:01:55.056 A:middle
that would help you deal with

00:01:55.056 --> 00:01:56.606 A:middle
the hardware, thermal and

00:01:56.606 --> 00:01:58.336 A:middle
bandwidth constraints that are a

00:01:58.336 --> 00:01:59.356 A:middle
reality in our world.

00:02:00.406 --> 00:02:02.136 A:middle
All right, so great news in iOS

00:02:02.176 --> 00:02:03.686 A:middle
13, we do finally support

00:02:03.686 --> 00:02:05.696 A:middle
MultiCam capture, and we do it

00:02:05.696 --> 00:02:07.596 A:middle
on all recent hardware, iPhone

00:02:07.666 --> 00:02:12.166 A:middle
XS, XS Max, XR and the new iPad

00:02:12.236 --> 00:02:12.656 A:middle
Pro.

00:02:13.116 --> 00:02:14.936 A:middle
On all of these platforms, the

00:02:14.936 --> 00:02:15.796 A:middle
aforementioned hardware

00:02:15.796 --> 00:02:17.156 A:middle
limitations have been solved

00:02:17.356 --> 00:02:17.786 A:middle
thankfully.

00:02:19.176 --> 00:02:20.616 A:middle
So let's dive right in to the

00:02:20.726 --> 00:02:21.416 A:middle
fun stuff.

00:02:21.566 --> 00:02:23.716 A:middle
We've got a new set of APIs for

00:02:23.716 --> 00:02:25.586 A:middle
building MultiCam sessions.

00:02:26.926 --> 00:02:28.516 A:middle
Now, if you've used AVFoundation

00:02:28.516 --> 00:02:29.856 A:middle
before for camera capture, you

00:02:29.856 --> 00:02:31.336 A:middle
know that we have four main

00:02:31.336 --> 00:02:33.196 A:middle
groups of classes: inputs,

00:02:33.646 --> 00:02:36.346 A:middle
outputs, the session and

00:02:36.346 --> 00:02:37.046 A:middle
connections.

00:02:37.576 --> 00:02:40.456 A:middle
The AVCaptureSession is the

00:02:40.456 --> 00:02:41.516 A:middle
center of our world.

00:02:41.666 --> 00:02:43.046 A:middle
It's the thing that marshals

00:02:43.046 --> 00:02:43.296 A:middle
data.

00:02:43.846 --> 00:02:44.916 A:middle
It's the thing that you tell to

00:02:44.916 --> 00:02:46.016 A:middle
start or stop running.

00:02:47.556 --> 00:02:49.146 A:middle
You add to it one or more

00:02:49.146 --> 00:02:50.936 A:middle
inputs, AVCapture inputs.

00:02:51.326 --> 00:02:52.076 A:middle
One such is the

00:02:52.076 --> 00:02:54.236 A:middle
AVCaptureDeviceInput which is a

00:02:54.236 --> 00:02:56.356 A:middle
wrapper for either a camera or a

00:02:56.356 --> 00:02:56.916 A:middle
microphone.

00:02:58.416 --> 00:02:59.646 A:middle
You also need to add one or more

00:02:59.646 --> 00:03:01.846 A:middle
AVCapture outputs to receive the

00:02:59.646 --> 00:03:01.846 A:middle
AVCapture outputs to receive the

00:03:01.846 --> 00:03:02.146 A:middle
data.

00:03:02.566 --> 00:03:03.956 A:middle
Otherwise, those producers have

00:03:03.956 --> 00:03:04.616 A:middle
nowhere to put it.

00:03:05.686 --> 00:03:06.396 A:middle
And then the session

00:03:06.396 --> 00:03:07.386 A:middle
automatically creates

00:03:07.386 --> 00:03:08.666 A:middle
connections on your behalf

00:03:08.906 --> 00:03:10.626 A:middle
between inputs and outputs that

00:03:10.626 --> 00:03:12.066 A:middle
have compatible media types.

00:03:12.846 --> 00:03:13.796 A:middle
So note what I'm showing you

00:03:13.796 --> 00:03:14.946 A:middle
here is the traditional

00:03:14.946 --> 00:03:17.296 A:middle
AVCaptureSession, which on iOS

00:03:17.296 --> 00:03:19.686 A:middle
only allows one camera input per

00:03:19.686 --> 00:03:20.096 A:middle
session.

00:03:21.796 --> 00:03:24.116 A:middle
New in iOS 13, we're introducing

00:03:24.116 --> 00:03:25.906 A:middle
a subclass of AVCaptureSession

00:03:25.906 --> 00:03:28.476 A:middle
called AVCaptureMultiCamSession.

00:03:28.856 --> 00:03:31.276 A:middle
So this lets you do multiple ins

00:03:31.336 --> 00:03:32.106 A:middle
and outs.

00:03:32.996 --> 00:03:36.076 A:middle
AVCaptureSession is not

00:03:36.266 --> 00:03:36.946 A:middle
deprecated.

00:03:36.946 --> 00:03:38.306 A:middle
It's not going away.

00:03:38.596 --> 00:03:40.226 A:middle
In fact, the existing

00:03:40.226 --> 00:03:41.586 A:middle
AVCaptureSession is still the

00:03:41.586 --> 00:03:42.656 A:middle
preferred class when you're

00:03:42.656 --> 00:03:44.216 A:middle
doing single-cam capture.

00:03:44.686 --> 00:03:45.826 A:middle
The reason for that is that

00:03:45.936 --> 00:03:48.066 A:middle
MultiCamSession, while being a

00:03:48.066 --> 00:03:50.436 A:middle
power tool has some limitations,

00:03:50.606 --> 00:03:51.896 A:middle
and I'll address those later.

00:03:53.366 --> 00:03:54.926 A:middle
All right, so let me give you an

00:03:54.926 --> 00:03:56.256 A:middle
example of a bread-and-butter

00:03:56.256 --> 00:03:58.036 A:middle
use case for our new

00:03:58.036 --> 00:03:59.346 A:middle
AVCaptureMultiCamSession.

00:03:59.866 --> 00:04:01.206 A:middle
Let's say you want to add two

00:03:59.866 --> 00:04:01.206 A:middle
Let's say you want to add two

00:04:01.206 --> 00:04:02.456 A:middle
devices, one for the front and

00:04:02.456 --> 00:04:04.546 A:middle
one for the back camera to a

00:04:04.546 --> 00:04:07.056 A:middle
MultiCamSession and do two video

00:04:07.056 --> 00:04:09.296 A:middle
data outputs simultaneously, one

00:04:09.296 --> 00:04:10.516 A:middle
receiving frames from the back

00:04:10.576 --> 00:04:11.646 A:middle
camera, one from the front.

00:04:12.886 --> 00:04:14.666 A:middle
And then let's say if you want

00:04:14.776 --> 00:04:16.106 A:middle
to do a real-time preview, you

00:04:16.106 --> 00:04:17.136 A:middle
can add separate

00:04:17.136 --> 00:04:18.456 A:middle
VideoPreviewLayers, one for the

00:04:18.505 --> 00:04:19.636 A:middle
front, one for the back.

00:04:20.866 --> 00:04:21.956 A:middle
You needn't stop there though.

00:04:22.896 --> 00:04:27.116 A:middle
You can do simultaneous metadata

00:04:27.116 --> 00:04:28.616 A:middle
outputs if you want to do

00:04:28.616 --> 00:04:30.766 A:middle
simultaneous barcode scanning or

00:04:30.766 --> 00:04:31.586 A:middle
face detection.

00:04:32.576 --> 00:04:34.516 A:middle
You could do multiple movie file

00:04:34.516 --> 00:04:35.736 A:middle
outputs if you want to record

00:04:35.736 --> 00:04:36.756 A:middle
one for the front and one for

00:04:36.756 --> 00:04:37.016 A:middle
the back.

00:04:37.526 --> 00:04:39.286 A:middle
You could add multiple photo

00:04:39.286 --> 00:04:40.886 A:middle
outputs if you want to do

00:04:41.096 --> 00:04:42.706 A:middle
real-time capture of photos from

00:04:42.706 --> 00:04:43.516 A:middle
different cameras.

00:04:43.926 --> 00:04:45.226 A:middle
So as you can see, these graphs

00:04:45.226 --> 00:04:46.216 A:middle
are starting to look pretty

00:04:46.216 --> 00:04:48.196 A:middle
complicated with a lot of arrows

00:04:48.196 --> 00:04:49.596 A:middle
going from a lot inputs to a lot

00:04:49.596 --> 00:04:50.186 A:middle
of outputs.

00:04:51.176 --> 00:04:52.916 A:middle
Those little arrows are called

00:04:52.916 --> 00:04:54.556 A:middle
AVCaptureConnections, and they

00:04:54.556 --> 00:04:56.046 A:middle
define the flow of data from an

00:04:56.046 --> 00:04:57.136 A:middle
input to an output.

00:04:57.756 --> 00:04:59.036 A:middle
Let me zoom in for a moment on

00:04:59.036 --> 00:05:01.016 A:middle
the device input to illustrate

00:04:59.036 --> 00:05:01.016 A:middle
the device input to illustrate

00:05:01.016 --> 00:05:02.136 A:middle
the anatomy of a connection.

00:05:03.616 --> 00:05:06.746 A:middle
Capture inputs have AVCapture

00:05:06.746 --> 00:05:09.116 A:middle
input ports, which I like to

00:05:09.116 --> 00:05:10.916 A:middle
think of as little electrical

00:05:10.916 --> 00:05:11.476 A:middle
outlets.

00:05:12.196 --> 00:05:14.546 A:middle
You have one outlet per media

00:05:14.546 --> 00:05:16.296 A:middle
type that the input can produce.

00:05:17.226 --> 00:05:18.536 A:middle
If nothing is plugged into the

00:05:18.536 --> 00:05:20.446 A:middle
port, no data flows from that

00:05:20.506 --> 00:05:21.776 A:middle
port, just like an electrical

00:05:21.776 --> 00:05:22.136 A:middle
outlet.

00:05:22.226 --> 00:05:23.276 A:middle
You have to plug something in to

00:05:23.276 --> 00:05:24.096 A:middle
get the electricity.

00:05:24.606 --> 00:05:26.056 A:middle
Now, to find out what ports are

00:05:26.056 --> 00:05:27.446 A:middle
available for our particular

00:05:27.446 --> 00:05:29.776 A:middle
input, you can query that input

00:05:30.086 --> 00:05:31.786 A:middle
ports property, and it will tell

00:05:31.786 --> 00:05:33.626 A:middle
you "I have this array of

00:05:33.626 --> 00:05:34.856 A:middle
AVCapture input ports."

00:05:35.196 --> 00:05:36.986 A:middle
So for the dual camera, these

00:05:36.986 --> 00:05:37.916 A:middle
are the ports that you would

00:05:37.916 --> 00:05:39.766 A:middle
find, one for video, one for

00:05:39.766 --> 00:05:42.096 A:middle
depth, one for metadata objects

00:05:42.146 --> 00:05:43.436 A:middle
such as barcode scanning and

00:05:43.436 --> 00:05:46.016 A:middle
faces and one for metadata items

00:05:46.106 --> 00:05:47.156 A:middle
which can be hooked up to a

00:05:47.156 --> 00:05:48.016 A:middle
movie file output.

00:05:49.596 --> 00:05:50.506 A:middle
Now, whenever you use

00:05:50.506 --> 00:05:52.096 A:middle
AVCaptureSession's add input

00:05:52.096 --> 00:05:53.816 A:middle
method to add an input to the

00:05:53.816 --> 00:05:57.076 A:middle
session or add output to add an

00:05:57.076 --> 00:05:59.076 A:middle
output to the session, the

00:05:59.076 --> 00:06:00.976 A:middle
session will look for compatible

00:05:59.076 --> 00:06:00.976 A:middle
session will look for compatible

00:06:00.976 --> 00:06:02.786 A:middle
media types and implicitly form

00:06:02.786 --> 00:06:03.936 A:middle
connections if it can.

00:06:04.646 --> 00:06:05.546 A:middle
So here we had a

00:06:05.546 --> 00:06:06.666 A:middle
VideoDataOutput.

00:06:06.916 --> 00:06:08.976 A:middle
VideoDataOutputs receive video,

00:06:08.976 --> 00:06:10.836 A:middle
accept video, and we had an

00:06:10.836 --> 00:06:12.586 A:middle
electrical plug that can produce

00:06:12.586 --> 00:06:14.186 A:middle
video, and so the connection was

00:06:14.186 --> 00:06:15.226 A:middle
made automatically.

00:06:15.866 --> 00:06:17.836 A:middle
That is how most of you are

00:06:18.246 --> 00:06:19.476 A:middle
accustomed to working with

00:06:19.476 --> 00:06:20.626 A:middle
AVCaptureSession if you've

00:06:20.626 --> 00:06:21.906 A:middle
worked with our classes before.

00:06:22.586 --> 00:06:24.306 A:middle
MultiCamSession is a different

00:06:24.306 --> 00:06:24.716 A:middle
beast.

00:06:25.496 --> 00:06:27.466 A:middle
That is because inputs and

00:06:27.466 --> 00:06:29.476 A:middle
outputs, you have multiple

00:06:29.476 --> 00:06:30.656 A:middle
inputs out now with multiple

00:06:30.656 --> 00:06:31.076 A:middle
outputs.

00:06:31.076 --> 00:06:32.106 A:middle
You probably want to make sure

00:06:32.106 --> 00:06:33.146 A:middle
that the connections are

00:06:33.146 --> 00:06:35.736 A:middle
happening from A to A and B to B

00:06:35.736 --> 00:06:36.976 A:middle
and not crossing where you

00:06:36.976 --> 00:06:38.006 A:middle
didn't intend them to.

00:06:38.486 --> 00:06:40.136 A:middle
So when building a

00:06:40.136 --> 00:06:42.246 A:middle
MultiCamSession, we urge you not

00:06:42.246 --> 00:06:43.996 A:middle
to use implicit connection

00:06:44.146 --> 00:06:46.806 A:middle
forming but instead use these

00:06:46.806 --> 00:06:48.866 A:middle
special purpose adders,

00:06:48.866 --> 00:06:51.546 A:middle
addInputWithNoConnections or

00:06:51.546 --> 00:06:53.286 A:middle
addOutputWithNoConnections.

00:06:53.886 --> 00:06:57.966 A:middle
And there are likewise ones that

00:06:57.966 --> 00:06:59.376 A:middle
you can use for video preview

00:06:59.376 --> 00:07:00.616 A:middle
layer, which are

00:06:59.376 --> 00:07:00.616 A:middle
layer, which are

00:07:00.936 --> 00:07:02.716 A:middle
setSessionWithNoConnections.

00:07:03.116 --> 00:07:05.056 A:middle
When you use these, it basically

00:07:05.056 --> 00:07:06.926 A:middle
just tells the session "Here are

00:07:06.926 --> 00:07:08.016 A:middle
these inputs, here are these

00:07:08.016 --> 00:07:08.526 A:middle
outputs.

00:07:08.596 --> 00:07:10.296 A:middle
You now know about them, but

00:07:10.296 --> 00:07:11.256 A:middle
keep your hands off them.

00:07:11.466 --> 00:07:13.096 A:middle
I'm going to add connections as

00:07:13.096 --> 00:07:14.676 A:middle
I want to later on manually."

00:07:15.506 --> 00:07:16.926 A:middle
The way you do that is you

00:07:16.926 --> 00:07:18.586 A:middle
create the AVCaptureConnection

00:07:18.586 --> 00:07:20.486 A:middle
yourself by telling it "I want

00:07:20.486 --> 00:07:22.126 A:middle
you to connect this port or

00:07:22.126 --> 00:07:24.356 A:middle
ports to this output," and then

00:07:24.356 --> 00:07:25.636 A:middle
you tell the session, "Please

00:07:25.636 --> 00:07:27.096 A:middle
add this connection," and now

00:07:27.096 --> 00:07:27.666 A:middle
you're ready to go.

00:07:27.666 --> 00:07:30.116 A:middle
That was very wordy.

00:07:30.426 --> 00:07:32.266 A:middle
It's better shown than talked

00:07:32.266 --> 00:07:33.396 A:middle
about, so I'd like to bring up

00:07:33.426 --> 00:07:35.466 A:middle
Nik Gelo, also from the Camera

00:07:35.466 --> 00:07:37.396 A:middle
Software group to demonstrate

00:07:37.396 --> 00:07:38.256 A:middle
AVMultiCamPIP.

00:07:38.806 --> 00:07:38.976 A:middle
Nick?

00:07:40.896 --> 00:07:41.386 A:middle
&gt;&gt; Thanks, Brad.

00:07:42.426 --> 00:07:43.896 A:middle
AVMultiCamPIP is an app that

00:07:43.896 --> 00:07:44.916 A:middle
demonstrates streaming from the

00:07:44.976 --> 00:07:45.826 A:middle
front and back camera

00:07:45.826 --> 00:07:46.656 A:middle
simultaneously.

00:07:46.936 --> 00:07:48.786 A:middle
Here we have two video previews,

00:07:48.786 --> 00:07:49.916 A:middle
one displaying the front camera

00:07:50.186 --> 00:07:51.056 A:middle
and one displaying the back

00:07:51.056 --> 00:07:51.376 A:middle
camera.

00:07:51.376 --> 00:07:52.496 A:middle
And when I double-tap the

00:07:52.496 --> 00:07:54.146 A:middle
screen, I can swap which camera

00:07:54.146 --> 00:07:55.726 A:middle
appears full-screen and which

00:07:55.726 --> 00:07:56.716 A:middle
camera appears PIP.

00:08:03.516 --> 00:08:07.326 A:middle
[ Applause ]

00:08:07.826 --> 00:08:10.186 A:middle
Now, we can see here that Brad

00:08:10.186 --> 00:08:11.586 A:middle
is live at Apple Park.

00:08:11.586 --> 00:08:13.866 A:middle
And before I ask him a few

00:08:13.866 --> 00:08:15.566 A:middle
questions, I will press the

00:08:15.566 --> 00:08:16.846 A:middle
Record button here at the bottom

00:08:17.146 --> 00:08:18.426 A:middle
to watch his conversation later.

00:08:19.436 --> 00:08:19.866 A:middle
Hey, Brad.

00:08:20.406 --> 00:08:21.576 A:middle
So tell me, how's it going over

00:08:21.576 --> 00:08:22.086 A:middle
at Apple Park?

00:08:22.686 --> 00:08:24.416 A:middle
&gt;&gt; Nik, it's pandemonium here at

00:08:24.416 --> 00:08:24.946 A:middle
Apple Park.

00:08:25.036 --> 00:08:26.196 A:middle
As you can see in front of the

00:08:26.196 --> 00:08:27.486 A:middle
reflecting pool, there's all

00:08:27.486 --> 00:08:28.886 A:middle
kinds of activity happening.

00:08:29.266 --> 00:08:30.516 A:middle
I hear a rushing of water.

00:08:30.896 --> 00:08:31.826 A:middle
Sounds like I'm about to be

00:08:31.826 --> 00:08:32.946 A:middle
drenched at any moment.

00:08:33.476 --> 00:08:35.256 A:middle
I hear wild animals behind me

00:08:35.376 --> 00:08:36.616 A:middle
like ducks or something.

00:08:37.056 --> 00:08:38.726 A:middle
I honestly fear for my life

00:08:38.726 --> 00:08:38.895 A:middle
here.

00:08:39.256 --> 00:08:40.106 A:middle
&gt;&gt; Well, Brad, that seems

00:08:40.106 --> 00:08:40.956 A:middle
absolutely terrifying.

00:08:40.956 --> 00:08:41.866 A:middle
Hope you stay safe out there.

00:08:42.096 --> 00:08:42.895 A:middle
&gt;&gt; Okay, thanks.

00:08:43.285 --> 00:08:43.576 A:middle
&gt;&gt; Got it.

00:08:44.646 --> 00:08:45.666 A:middle
&gt;&gt; So now that we finished

00:08:45.666 --> 00:08:47.076 A:middle
recording the movie, let's take

00:08:47.076 --> 00:08:48.266 A:middle
a look at what we just recorded.

00:08:48.266 --> 00:08:51.646 A:middle
Here we have the movie.

00:08:51.646 --> 00:08:54.516 A:middle
As you can see, when I swap

00:08:54.516 --> 00:08:56.996 A:middle
between the two cameras, it

00:08:57.206 --> 00:08:59.156 A:middle
swaps just like we did when

00:08:59.376 --> 00:08:59.996 A:middle
using the app.

00:08:59.996 --> 00:09:02.196 A:middle
And that's AVMultiCamPIP.

00:08:59.996 --> 00:09:02.196 A:middle
And that's AVMultiCamPIP.

00:09:02.566 --> 00:09:02.976 A:middle
Back to Brad.

00:09:03.516 --> 00:09:07.536 A:middle
[ Applause ]

00:09:08.036 --> 00:09:08.516 A:middle
&gt;&gt; Thanks, Nik.

00:09:08.836 --> 00:09:09.366 A:middle
Awesome demo.

00:09:09.366 --> 00:09:12.216 A:middle
All right, so let's look at

00:09:12.216 --> 00:09:13.536 A:middle
what's happening under the hood

00:09:13.606 --> 00:09:14.856 A:middle
in AVMultiCamPIP.

00:09:15.476 --> 00:09:17.056 A:middle
So we have two device inputs,

00:09:17.056 --> 00:09:18.646 A:middle
one for the front camera, one

00:09:18.646 --> 00:09:21.486 A:middle
for the back camera added with

00:09:21.486 --> 00:09:23.276 A:middle
no connections as I mentioned

00:09:23.276 --> 00:09:23.666 A:middle
before.

00:09:23.906 --> 00:09:25.076 A:middle
We also have two video data

00:09:25.076 --> 00:09:27.246 A:middle
outputs, one for each and two

00:09:27.246 --> 00:09:28.306 A:middle
VideoPreviewLayers.

00:09:28.786 --> 00:09:30.236 A:middle
Now, to place them onscreen,

00:09:30.466 --> 00:09:31.726 A:middle
it's just a matter of taking

00:09:31.726 --> 00:09:34.416 A:middle
those VideoPreviewLayers and

00:09:34.416 --> 00:09:35.896 A:middle
ordering them so that one is top

00:09:35.896 --> 00:09:37.296 A:middle
of the other and one is sized

00:09:37.296 --> 00:09:37.846 A:middle
smaller.

00:09:37.846 --> 00:09:39.796 A:middle
And when Nik double-tapped them,

00:09:40.056 --> 00:09:42.166 A:middle
we simply reposition them and

00:09:42.166 --> 00:09:43.226 A:middle
reverse the Z ordering.

00:09:43.696 --> 00:09:44.626 A:middle
Now, there is some magic

00:09:44.626 --> 00:09:45.976 A:middle
happening in the Metal Shader

00:09:46.176 --> 00:09:47.216 A:middle
Compositor code.

00:09:47.596 --> 00:09:48.906 A:middle
There it's taking those two

00:09:48.906 --> 00:09:51.306 A:middle
VideoDataOutputs and compositing

00:09:51.306 --> 00:09:53.556 A:middle
them so that the smaller PIP is

00:09:53.556 --> 00:09:55.516 A:middle
arranged within one frame, so

00:09:55.516 --> 00:09:56.526 A:middle
it's compositing them to a

00:09:56.526 --> 00:09:58.186 A:middle
single video buffer and then

00:09:58.186 --> 00:09:59.916 A:middle
sending them to an AVAssetWriter

00:10:00.166 --> 00:10:01.966 A:middle
where they are recorded to one

00:10:01.966 --> 00:10:02.956 A:middle
video track in a movie.

00:10:03.686 --> 00:10:05.296 A:middle
This sample code is available

00:10:05.546 --> 00:10:06.086 A:middle
right now.

00:10:06.476 --> 00:10:07.416 A:middle
It's associated with the

00:10:07.416 --> 00:10:07.796 A:middle
session.

00:10:07.796 --> 00:10:08.806 A:middle
You can take a look and start

00:10:08.806 --> 00:10:10.366 A:middle
doing your own MultiCam

00:10:10.366 --> 00:10:10.976 A:middle
captures.

00:10:11.426 --> 00:10:14.276 A:middle
All right, time to talk about

00:10:14.276 --> 00:10:15.036 A:middle
limitations.

00:10:15.166 --> 00:10:17.646 A:middle
While AVMultiCamSession is a

00:10:17.646 --> 00:10:19.356 A:middle
power tool, it doesn't do

00:10:19.356 --> 00:10:21.166 A:middle
everything, and let me tell you

00:10:21.546 --> 00:10:22.666 A:middle
what it does not do.

00:10:24.116 --> 00:10:25.806 A:middle
First up, you cannot pretend

00:10:25.916 --> 00:10:28.046 A:middle
that one camera is two cameras.

00:10:28.666 --> 00:10:31.356 A:middle
AVCaptureDeviceInput API will

00:10:31.356 --> 00:10:33.016 A:middle
let you create multiple

00:10:33.016 --> 00:10:34.876 A:middle
instances for, say, the back

00:10:34.876 --> 00:10:35.276 A:middle
camera.

00:10:35.586 --> 00:10:36.656 A:middle
You could make 10 of them if you

00:10:36.656 --> 00:10:36.926 A:middle
want.

00:10:37.326 --> 00:10:38.926 A:middle
But if you try to add all those

00:10:38.926 --> 00:10:39.846 A:middle
instances to one

00:10:39.846 --> 00:10:41.126 A:middle
MultiCamSession, it'll say

00:10:41.156 --> 00:10:43.216 A:middle
"Uh-uh," and it will throw an

00:10:43.216 --> 00:10:43.706 A:middle
exception.

00:10:44.586 --> 00:10:46.516 A:middle
Please, only one input per

00:10:46.516 --> 00:10:47.826 A:middle
camera in a session.

00:10:48.956 --> 00:10:50.126 A:middle
Also, you're not allowed to

00:10:50.196 --> 00:10:52.716 A:middle
clone a camera to two outputs of

00:10:52.716 --> 00:10:55.716 A:middle
the same type such as taking one

00:10:55.926 --> 00:10:57.786 A:middle
camera and splitting its signal

00:10:57.786 --> 00:10:59.106 A:middle
to two video data outputs.

00:10:59.646 --> 00:11:01.446 A:middle
You can, of course, add multiple

00:10:59.646 --> 00:11:01.446 A:middle
You can, of course, add multiple

00:11:01.446 --> 00:11:03.346 A:middle
cameras and connect them to a

00:11:03.346 --> 00:11:05.136 A:middle
VideoDataOutput each, but you

00:11:05.136 --> 00:11:06.976 A:middle
cannot fan out from one to many.

00:11:10.566 --> 00:11:12.016 A:middle
You're also not allowed -- the

00:11:12.016 --> 00:11:13.946 A:middle
opposite holds true as well.

00:11:14.016 --> 00:11:16.826 A:middle
AVCapture outputs on iOS do not

00:11:16.826 --> 00:11:18.086 A:middle
support media mixing.

00:11:18.576 --> 00:11:20.706 A:middle
So all the data outputs only can

00:11:20.706 --> 00:11:21.696 A:middle
take a single input.

00:11:22.346 --> 00:11:23.586 A:middle
You can't, for instance, try to

00:11:23.586 --> 00:11:25.236 A:middle
jam two camera sources into a

00:11:25.236 --> 00:11:27.726 A:middle
single data output.

00:11:27.726 --> 00:11:28.786 A:middle
It wouldn't know what to do with

00:11:28.786 --> 00:11:29.796 A:middle
the second video since it

00:11:29.796 --> 00:11:31.206 A:middle
doesn't know how to mix them.

00:11:31.866 --> 00:11:33.706 A:middle
You can, of course, use separate

00:11:33.706 --> 00:11:35.726 A:middle
video data outputs and then

00:11:35.816 --> 00:11:37.236 A:middle
composite those buffers in your

00:11:37.236 --> 00:11:38.696 A:middle
own code, such as the Metal

00:11:38.696 --> 00:11:40.086 A:middle
Shader Compositer that we used

00:11:40.086 --> 00:11:40.976 A:middle
in MultiCamPIP.

00:11:41.656 --> 00:11:42.646 A:middle
You can do that however you

00:11:42.646 --> 00:11:44.156 A:middle
like, but as far as session

00:11:44.156 --> 00:11:45.636 A:middle
building is concerned, do not

00:11:45.636 --> 00:11:47.356 A:middle
try to jam multiple cameras into

00:11:47.356 --> 00:11:48.036 A:middle
a single output.

00:11:49.526 --> 00:11:51.286 A:middle
All right, a word about presets.

00:11:52.466 --> 00:11:54.026 A:middle
The traditional AVCaptureSession

00:11:54.096 --> 00:11:55.706 A:middle
has this concept of a session

00:11:55.706 --> 00:11:58.246 A:middle
preset, which dictates a common

00:11:58.246 --> 00:11:59.846 A:middle
quality of service for the whole

00:11:59.846 --> 00:12:00.256 A:middle
session.

00:11:59.846 --> 00:12:00.256 A:middle
session.

00:12:00.526 --> 00:12:02.886 A:middle
And it applies to all inputs and

00:12:02.886 --> 00:12:04.166 A:middle
outputs within that session.

00:12:04.456 --> 00:12:06.006 A:middle
For instance, when you set the

00:12:06.006 --> 00:12:08.946 A:middle
sessionPreset to high, the

00:12:08.946 --> 00:12:10.496 A:middle
session configures the device's

00:12:10.496 --> 00:12:12.986 A:middle
resolution and frame rate and

00:12:13.066 --> 00:12:14.486 A:middle
all of the outputs so that they

00:12:14.486 --> 00:12:16.186 A:middle
are delivering a high-quality

00:12:16.396 --> 00:12:17.666 A:middle
video experience such as

00:12:17.666 --> 00:12:18.726 A:middle
1080p30.

00:12:21.496 --> 00:12:23.126 A:middle
Presets are a problem for

00:12:23.126 --> 00:12:24.096 A:middle
MultiCamSession.

00:12:24.916 --> 00:12:26.556 A:middle
Think again about something that

00:12:26.556 --> 00:12:27.376 A:middle
looks like this.

00:12:28.106 --> 00:12:30.696 A:middle
MultiCamSession configurations

00:12:30.696 --> 00:12:32.226 A:middle
are hybrid; they're

00:12:32.226 --> 00:12:33.096 A:middle
heterogeneous.

00:12:33.426 --> 00:12:34.646 A:middle
What does it mean to have high

00:12:34.646 --> 00:12:35.936 A:middle
quality for the whole thing?

00:12:36.286 --> 00:12:37.416 A:middle
You might want to do different

00:12:37.416 --> 00:12:38.986 A:middle
qualities of service on

00:12:38.986 --> 00:12:40.466 A:middle
different branches of the graph.

00:12:40.886 --> 00:12:42.406 A:middle
For instance, on the front

00:12:42.406 --> 00:12:43.736 A:middle
camera you might want to just do

00:12:43.976 --> 00:12:45.366 A:middle
a low-resolution preview such as

00:12:45.366 --> 00:12:48.096 A:middle
640 by 480, while also

00:12:48.096 --> 00:12:49.646 A:middle
simultaneously doing something

00:12:49.896 --> 00:12:51.786 A:middle
really high-quality, 1080p60,

00:12:51.786 --> 00:12:52.986 A:middle
for instance, on the back.

00:12:53.426 --> 00:12:54.676 A:middle
Well, obviously, we don't have

00:12:54.776 --> 00:12:56.236 A:middle
presets for all of these hybrid

00:12:56.236 --> 00:12:56.946 A:middle
situations.

00:12:57.936 --> 00:12:59.036 A:middle
We've decided to keep things

00:12:59.036 --> 00:13:00.956 A:middle
simple in MultiCamSession.

00:12:59.036 --> 00:13:00.956 A:middle
simple in MultiCamSession.

00:13:01.426 --> 00:13:02.956 A:middle
It does not support presets.

00:13:03.076 --> 00:13:05.516 A:middle
It supports one and one preset

00:13:05.516 --> 00:13:07.486 A:middle
only which is input priority.

00:13:07.486 --> 00:13:09.116 A:middle
So that means it leaves the

00:13:09.116 --> 00:13:11.206 A:middle
inputs and outputs alone when

00:13:11.206 --> 00:13:12.406 A:middle
you add them.

00:13:12.436 --> 00:13:13.826 A:middle
You must configure the active

00:13:13.886 --> 00:13:14.926 A:middle
format yourself.

00:13:17.576 --> 00:13:18.246 A:middle
All right.

00:13:18.846 --> 00:13:20.206 A:middle
On to the cost functions.

00:13:20.936 --> 00:13:21.926 A:middle
I mentioned at the beginning

00:13:21.926 --> 00:13:23.306 A:middle
that we took our time with this

00:13:23.376 --> 00:13:24.886 A:middle
MultiCam support, because we

00:13:24.886 --> 00:13:26.106 A:middle
wanted to deliver a very

00:13:26.106 --> 00:13:28.396 A:middle
responsible API, one that could

00:13:28.396 --> 00:13:30.106 A:middle
help you account for the various

00:13:30.146 --> 00:13:31.936 A:middle
costs that you incur when

00:13:31.936 --> 00:13:33.246 A:middle
running multiple cameras and

00:13:33.246 --> 00:13:34.946 A:middle
lighting up virtually every

00:13:34.946 --> 00:13:35.756 A:middle
block on the phone.

00:13:39.256 --> 00:13:41.236 A:middle
So this is trite but true.

00:13:42.076 --> 00:13:43.396 A:middle
There is no such thing as a free

00:13:43.396 --> 00:13:43.806 A:middle
lunch.

00:13:44.046 --> 00:13:46.016 A:middle
And so this is the part of the

00:13:46.016 --> 00:13:47.166 A:middle
session where I become your

00:13:47.166 --> 00:13:48.836 A:middle
father, and I'm going to give

00:13:48.836 --> 00:13:49.716 A:middle
you the dad talk.

00:13:50.956 --> 00:13:52.536 A:middle
In the dad talk, I will explain

00:13:52.536 --> 00:13:54.656 A:middle
how credit cards work and how

00:13:54.656 --> 00:13:55.756 A:middle
you need to be responsible with

00:13:55.756 --> 00:13:57.186 A:middle
your money and live within your

00:13:57.186 --> 00:14:00.426 A:middle
means and, like, such things.

00:13:57.186 --> 00:14:00.426 A:middle
means and, like, such things.

00:14:01.566 --> 00:14:02.826 A:middle
So it's a fact of life that we

00:14:02.826 --> 00:14:04.676 A:middle
have limited hardware bandwidth

00:14:04.676 --> 00:14:05.496 A:middle
on iOS.

00:14:06.176 --> 00:14:07.486 A:middle
And though we have multiple

00:14:07.486 --> 00:14:08.776 A:middle
cameras, so we have multiple

00:14:08.776 --> 00:14:12.446 A:middle
sensors, we only have one ISP or

00:14:12.446 --> 00:14:13.636 A:middle
image signal processor.

00:14:14.446 --> 00:14:18.626 A:middle
So all the pixels going through

00:14:18.626 --> 00:14:20.166 A:middle
those sensors need to be

00:14:20.166 --> 00:14:22.086 A:middle
processed by a single ISP, and

00:14:22.516 --> 00:14:24.986 A:middle
it is limited by how many pixels

00:14:25.036 --> 00:14:26.686 A:middle
it can run per clock at a given

00:14:26.686 --> 00:14:27.206 A:middle
frequency.

00:14:28.136 --> 00:14:30.746 A:middle
So there are limiters to the

00:14:30.836 --> 00:14:32.076 A:middle
number of pixels that you can

00:14:32.076 --> 00:14:32.706 A:middle
run at a time.

00:14:33.556 --> 00:14:34.756 A:middle
The contributors to the hardware

00:14:34.756 --> 00:14:36.576 A:middle
cost are, as you would expect,

00:14:36.756 --> 00:14:37.836 A:middle
video resolution.

00:14:38.366 --> 00:14:39.626 A:middle
Higher resolution means more

00:14:39.626 --> 00:14:40.926 A:middle
pixels to cram through there.

00:14:41.696 --> 00:14:42.886 A:middle
The max frame rate.

00:14:43.296 --> 00:14:44.366 A:middle
If you're delivering those

00:14:44.366 --> 00:14:46.176 A:middle
pixels faster, it's got to do

00:14:46.176 --> 00:14:47.636 A:middle
more pixels per clock as well.

00:14:47.676 --> 00:14:50.136 A:middle
And then a third one which you

00:14:50.136 --> 00:14:51.336 A:middle
may or may not have heard of is

00:14:51.336 --> 00:14:52.386 A:middle
called sensor binning.

00:14:53.516 --> 00:14:55.666 A:middle
Sensor binning refers to a way

00:14:55.666 --> 00:14:57.246 A:middle
to combine information in

00:14:57.246 --> 00:14:58.726 A:middle
adjacent pixels to reduce

00:14:58.726 --> 00:14:59.226 A:middle
bandwidth.

00:14:59.796 --> 00:15:00.736 A:middle
So, for instance, if we have an

00:14:59.796 --> 00:15:00.736 A:middle
So, for instance, if we have an

00:15:00.736 --> 00:15:02.986 A:middle
image here, and we do a 2 by 2

00:15:02.986 --> 00:15:04.866 A:middle
binning, it's going to take 4

00:15:04.866 --> 00:15:06.976 A:middle
pixels in squares and sum them

00:15:07.016 --> 00:15:09.206 A:middle
into one so that we get a

00:15:09.206 --> 00:15:11.306 A:middle
reduction in size by 4x.

00:15:11.836 --> 00:15:13.056 A:middle
It gives you a reduction in

00:15:13.056 --> 00:15:13.586 A:middle
noise.

00:15:14.166 --> 00:15:15.436 A:middle
It gives you a reduction in

00:15:15.436 --> 00:15:15.916 A:middle
bandwidth.

00:15:16.396 --> 00:15:18.586 A:middle
It gives you 4x intensity per

00:15:18.586 --> 00:15:19.076 A:middle
pixel.

00:15:19.566 --> 00:15:20.376 A:middle
So there are a lot of great

00:15:20.416 --> 00:15:21.506 A:middle
things about sensor binning.

00:15:21.936 --> 00:15:23.476 A:middle
The downside is that you get a

00:15:23.476 --> 00:15:25.056 A:middle
little reduction in image

00:15:25.056 --> 00:15:25.586 A:middle
quality.

00:15:25.906 --> 00:15:27.366 A:middle
So diagonal lines might look a

00:15:27.366 --> 00:15:28.346 A:middle
little stair-stepped.

00:15:28.986 --> 00:15:31.466 A:middle
But their most redeeming quality

00:15:31.466 --> 00:15:33.036 A:middle
is that bin formats are super

00:15:33.036 --> 00:15:33.706 A:middle
low power.

00:15:34.596 --> 00:15:36.496 A:middle
In fact, whenever you use ARKit

00:15:36.496 --> 00:15:38.046 A:middle
with a camera, you are using a

00:15:38.046 --> 00:15:39.736 A:middle
binned format, because ARKIT

00:15:39.736 --> 00:15:41.466 A:middle
uses binned formats exclusively

00:15:41.466 --> 00:15:42.976 A:middle
to save on that power for all

00:15:42.976 --> 00:15:44.416 A:middle
the interesting AR things that

00:15:44.416 --> 00:15:44.946 A:middle
you'd like to do.

00:15:46.326 --> 00:15:46.656 A:middle
All right.

00:15:47.026 --> 00:15:48.616 A:middle
How do we account for cost, or

00:15:48.616 --> 00:15:50.226 A:middle
how do we report those costs?

00:15:50.786 --> 00:15:52.286 A:middle
MultiCamSession tallies up your

00:15:52.286 --> 00:15:53.996 A:middle
hardware cost as you configure

00:15:53.996 --> 00:15:54.526 A:middle
your session.

00:15:55.046 --> 00:15:56.096 A:middle
So each time you change

00:15:56.096 --> 00:15:58.046 A:middle
something, it keeps track of it

00:15:58.316 --> 00:15:59.906 A:middle
just like filling up a shopping

00:15:59.906 --> 00:16:02.376 A:middle
cart or going to an online store

00:15:59.906 --> 00:16:02.376 A:middle
cart or going to an online store

00:16:02.376 --> 00:16:03.776 A:middle
and putting things into the cart

00:16:03.776 --> 00:16:04.716 A:middle
before you pay for them.

00:16:05.086 --> 00:16:05.786 A:middle
You know when you're getting

00:16:05.786 --> 00:16:07.296 A:middle
close to your limit on your

00:16:07.296 --> 00:16:08.886 A:middle
budget, and you can kind of try

00:16:08.886 --> 00:16:10.546 A:middle
things out and then put new

00:16:10.546 --> 00:16:11.876 A:middle
things in or move old things

00:16:11.876 --> 00:16:12.136 A:middle
out.

00:16:12.386 --> 00:16:13.756 A:middle
You see the cost before you have

00:16:13.796 --> 00:16:14.216 A:middle
to pay.

00:16:14.766 --> 00:16:15.776 A:middle
It's the same with

00:16:15.776 --> 00:16:16.666 A:middle
MultiCamSession.

00:16:17.236 --> 00:16:19.126 A:middle
We have a new property called

00:16:19.776 --> 00:16:20.656 A:middle
hardwareCost.

00:16:21.326 --> 00:16:22.726 A:middle
And this hardwareCost starts at

00:16:22.766 --> 00:16:23.986 A:middle
zero when you make a brand-new

00:16:23.986 --> 00:16:24.466 A:middle
session.

00:16:25.536 --> 00:16:27.456 A:middle
And it increments as you add

00:16:27.456 --> 00:16:29.076 A:middle
more features, more inputs, more

00:16:29.076 --> 00:16:29.586 A:middle
outputs.

00:16:30.446 --> 00:16:31.676 A:middle
And you're fine as long as you

00:16:31.676 --> 00:16:32.816 A:middle
stay under 1.0.

00:16:33.326 --> 00:16:35.326 A:middle
Anything under 1.0 is runnable.

00:16:36.566 --> 00:16:38.356 A:middle
The minute you hit 1.0 or

00:16:38.356 --> 00:16:39.706 A:middle
greater, you're in trouble.

00:16:39.706 --> 00:16:41.376 A:middle
And that's because the ISP

00:16:41.376 --> 00:16:43.066 A:middle
bandwidth limit is hard.

00:16:43.486 --> 00:16:45.766 A:middle
It's not like you can, you know,

00:16:45.886 --> 00:16:47.316 A:middle
deliver every other frame.

00:16:47.896 --> 00:16:49.346 A:middle
No, this is an all or nothing

00:16:49.346 --> 00:16:49.786 A:middle
proposal.

00:16:50.076 --> 00:16:51.466 A:middle
You have to either make it or

00:16:51.466 --> 00:16:51.816 A:middle
you don't.

00:16:52.226 --> 00:16:53.816 A:middle
So if you're over 1.0 and you

00:16:53.816 --> 00:16:55.156 A:middle
try to run the

00:16:55.156 --> 00:16:57.046 A:middle
AVCaptureMultiCamSession, it'll

00:16:57.046 --> 00:16:57.666 A:middle
say "Uh-uh."

00:16:58.126 --> 00:17:00.256 A:middle
It'll give you a notification of

00:16:58.126 --> 00:17:00.256 A:middle
It'll give you a notification of

00:17:00.256 --> 00:17:02.356 A:middle
a runtime error indicating that

00:17:02.356 --> 00:17:03.726 A:middle
the reason it had to stop is

00:17:03.726 --> 00:17:04.806 A:middle
because of a hardware cost

00:17:04.806 --> 00:17:04.955 A:middle
overage.

00:17:08.356 --> 00:17:09.556 A:middle
Now you're probably wondering,

00:17:09.556 --> 00:17:11.046 A:middle
"How do I reduce that cost?"

00:17:11.796 --> 00:17:13.006 A:middle
The most obvious way you can do

00:17:13.006 --> 00:17:14.376 A:middle
it is to pick a lower

00:17:14.376 --> 00:17:14.955 A:middle
resolution.

00:17:15.665 --> 00:17:17.256 A:middle
Another way you can do it is if

00:17:17.256 --> 00:17:18.046 A:middle
you want to keep the same

00:17:18.046 --> 00:17:20.455 A:middle
resolution, if there is a binned

00:17:20.496 --> 00:17:21.965 A:middle
format at the same resolution,

00:17:21.965 --> 00:17:22.925 A:middle
pick that one instead.

00:17:23.276 --> 00:17:24.656 A:middle
It's a little bit lower quality

00:17:24.736 --> 00:17:26.205 A:middle
but way lower in power.

00:17:26.675 --> 00:17:29.376 A:middle
Next, you would think that

00:17:29.376 --> 00:17:30.596 A:middle
lowering the frame rate would

00:17:30.596 --> 00:17:32.736 A:middle
help, but it doesn't.

00:17:33.806 --> 00:17:34.746 A:middle
The reason is that

00:17:34.746 --> 00:17:37.096 A:middle
AVCaptureDevice allows you and

00:17:37.096 --> 00:17:38.646 A:middle
has allowed you since, I think,

00:17:38.646 --> 00:17:41.466 A:middle
iOS 4 to change the frame rate

00:17:41.466 --> 00:17:41.996 A:middle
on the fly.

00:17:42.626 --> 00:17:44.906 A:middle
So if you have a 120 FPS format

00:17:45.626 --> 00:17:47.916 A:middle
and you say, "Set the active

00:17:47.916 --> 00:17:50.436 A:middle
format to 60," you still have to

00:17:50.436 --> 00:17:52.656 A:middle
pay the cost for a 120, not 60,

00:17:52.866 --> 00:17:53.936 A:middle
because at any point while

00:17:53.936 --> 00:17:54.886 A:middle
you're running, you could

00:17:54.886 --> 00:17:55.956 A:middle
increase the frame rate up to

00:17:55.956 --> 00:17:56.806 A:middle
120.

00:17:57.066 --> 00:17:58.616 A:middle
We must assume the worst case.

00:17:59.666 --> 00:18:01.306 A:middle
But good news.

00:17:59.666 --> 00:18:01.306 A:middle
But good news.

00:18:01.416 --> 00:18:02.856 A:middle
We're now offering an override

00:18:02.946 --> 00:18:04.036 A:middle
property on the

00:18:04.036 --> 00:18:05.306 A:middle
AVCaptureDeviceInput.

00:18:06.116 --> 00:18:09.216 A:middle
By setting it, you can turn a

00:18:09.216 --> 00:18:10.966 A:middle
high frame-rate format into a

00:18:10.966 --> 00:18:13.036 A:middle
lower frame-rate format by

00:18:13.146 --> 00:18:14.896 A:middle
promising that you will go no

00:18:14.896 --> 00:18:16.516 A:middle
higher than a particular frame

00:18:16.736 --> 00:18:16.926 A:middle
rate.

00:18:19.966 --> 00:18:21.836 A:middle
Now, this is a point of

00:18:21.836 --> 00:18:23.596 A:middle
confusion in our APIs.

00:18:23.646 --> 00:18:24.956 A:middle
We don't talk about frame rates

00:18:24.956 --> 00:18:25.596 A:middle
as rates.

00:18:25.626 --> 00:18:27.086 A:middle
We talk about them as durations.

00:18:27.386 --> 00:18:30.116 A:middle
So to set a frame rate, you set

00:18:30.116 --> 00:18:31.376 A:middle
1 over the duration.

00:18:31.536 --> 00:18:32.546 A:middle
That's the same as the frame

00:18:32.546 --> 00:18:32.786 A:middle
rate.

00:18:33.186 --> 00:18:34.706 A:middle
So if you want to take a 60 FPS

00:18:34.706 --> 00:18:36.536 A:middle
format and make it into a 30 FPS

00:18:36.536 --> 00:18:39.106 A:middle
format, you do that by making a

00:18:39.186 --> 00:18:41.256 A:middle
CMTime with 1 over 30, which is

00:18:41.256 --> 00:18:43.096 A:middle
the duration and then set that

00:18:43.096 --> 00:18:43.996 A:middle
deviceInput.

00:18:44.296 --> 00:18:47.126 A:middle
videoMinFramDurationOverride to

00:18:47.216 --> 00:18:47.886 A:middle
thirtyFPS.

00:18:48.256 --> 00:18:49.566 A:middle
Congratulations, you've just

00:18:49.566 --> 00:18:51.436 A:middle
turned a 60 FPS format into a 30

00:18:51.436 --> 00:18:52.816 A:middle
FPS format, and you only pay the

00:18:52.816 --> 00:18:56.216 A:middle
hardware cost for 30.

00:18:56.396 --> 00:18:58.016 A:middle
I should also mention that there

00:18:58.016 --> 00:19:00.396 A:middle
is a great function in the

00:18:58.016 --> 00:19:00.396 A:middle
is a great function in the

00:19:00.396 --> 00:19:02.476 A:middle
AVMultiCamPIP app that shows how

00:19:02.476 --> 00:19:04.296 A:middle
to iteratively reduce your cost.

00:19:04.616 --> 00:19:05.846 A:middle
It's a recursive function that

00:19:05.986 --> 00:19:07.036 A:middle
kind of picks things that are

00:19:07.036 --> 00:19:08.736 A:middle
most important to it, and it

00:19:08.976 --> 00:19:10.536 A:middle
throttles down things that are

00:19:10.536 --> 00:19:11.886 A:middle
less important until it gets

00:19:11.886 --> 00:19:12.846 A:middle
under the hardware cost.

00:19:13.806 --> 00:19:15.546 A:middle
Now, next up is system pressure

00:19:15.546 --> 00:19:15.846 A:middle
cost.

00:19:15.846 --> 00:19:17.666 A:middle
This is the second big

00:19:17.666 --> 00:19:18.986 A:middle
contributor that we report.

00:19:19.376 --> 00:19:22.266 A:middle
As you're well aware, phones are

00:19:22.266 --> 00:19:24.126 A:middle
extremely powerful computers in

00:19:24.366 --> 00:19:25.636 A:middle
little bitty thermally

00:19:25.636 --> 00:19:27.036 A:middle
challenged packages.

00:19:27.736 --> 00:19:30.336 A:middle
And in iOS 11, we introduced

00:19:30.536 --> 00:19:32.716 A:middle
camera system pressure states.

00:19:33.366 --> 00:19:34.396 A:middle
These help you monitor the

00:19:34.396 --> 00:19:35.826 A:middle
camera's current situation.

00:19:37.046 --> 00:19:38.636 A:middle
Camera system pressure consists

00:19:38.726 --> 00:19:41.566 A:middle
of system temperature, that is

00:19:41.666 --> 00:19:45.046 A:middle
overall OS thermals, peak power

00:19:45.046 --> 00:19:46.576 A:middle
demands, and that has to do with

00:19:46.576 --> 00:19:47.206 A:middle
the battery.

00:19:47.586 --> 00:19:48.636 A:middle
How much charge does it

00:19:48.636 --> 00:19:49.386 A:middle
currently have?

00:19:49.996 --> 00:19:51.736 A:middle
Is it able to ramp up its

00:19:51.736 --> 00:19:53.206 A:middle
voltage fast enough to meet the

00:19:53.206 --> 00:19:55.016 A:middle
demands of running whatever you

00:19:55.016 --> 00:19:56.036 A:middle
want to do right now?

00:19:57.026 --> 00:19:58.786 A:middle
And the infrared projector

00:19:58.786 --> 00:19:59.296 A:middle
temperature.

00:19:59.996 --> 00:20:01.376 A:middle
On devices that support

00:19:59.996 --> 00:20:01.376 A:middle
On devices that support

00:20:01.376 --> 00:20:02.856 A:middle
TrueDepth camera, we have an

00:20:02.856 --> 00:20:04.136 A:middle
infrared camera as well as an

00:20:04.136 --> 00:20:04.936 A:middle
RGB camera.

00:20:05.126 --> 00:20:06.386 A:middle
Well, that generates its own

00:20:06.456 --> 00:20:07.686 A:middle
heat, and so that's part of the

00:20:07.686 --> 00:20:09.166 A:middle
contribution to system pressure

00:20:09.166 --> 00:20:09.676 A:middle
states.

00:20:10.216 --> 00:20:14.586 A:middle
We have five of them, nominal

00:20:14.586 --> 00:20:15.686 A:middle
all the way up to shutdown.

00:20:16.316 --> 00:20:17.396 A:middle
When the system pressure state

00:20:17.396 --> 00:20:19.106 A:middle
is nominal, you're in great

00:20:19.106 --> 00:20:19.386 A:middle
shape.

00:20:19.586 --> 00:20:20.476 A:middle
You can do whatever you want.

00:20:20.976 --> 00:20:22.546 A:middle
When it's fair, you can still

00:20:22.546 --> 00:20:23.886 A:middle
almost do whatever you want.

00:20:24.336 --> 00:20:25.776 A:middle
But at serious, you start

00:20:25.776 --> 00:20:26.896 A:middle
getting into a situation where

00:20:26.896 --> 00:20:28.136 A:middle
the system's going to throttle

00:20:28.886 --> 00:20:29.916 A:middle
back, meaning you have fewer

00:20:29.916 --> 00:20:31.776 A:middle
cycles for the GPU.

00:20:31.996 --> 00:20:34.316 A:middle
Your quality might be

00:20:34.316 --> 00:20:35.036 A:middle
compromised.

00:20:35.546 --> 00:20:36.986 A:middle
And at critical, you are getting

00:20:36.986 --> 00:20:38.126 A:middle
a whole lot of throttling.

00:20:38.386 --> 00:20:41.816 A:middle
At shutdown, we cannot run the

00:20:41.816 --> 00:20:44.066 A:middle
camera any longer for fear of

00:20:44.066 --> 00:20:44.846 A:middle
hurting the hardware.

00:20:45.156 --> 00:20:47.026 A:middle
So at shutdown, we automatically

00:20:47.026 --> 00:20:48.516 A:middle
interrupt your session, stop it,

00:20:48.966 --> 00:20:50.086 A:middle
tell you that you're interrupted

00:20:50.156 --> 00:20:51.736 A:middle
because of a system pressure

00:20:51.736 --> 00:20:53.786 A:middle
state, and then we wait for the

00:20:53.786 --> 00:20:55.096 A:middle
device to go all the way back to

00:20:55.096 --> 00:20:56.596 A:middle
nominal before we'll let you run

00:20:56.596 --> 00:20:57.346 A:middle
the camera again.

00:20:58.756 --> 00:21:01.176 A:middle
That was all iOS 11.

00:20:58.756 --> 00:21:01.176 A:middle
That was all iOS 11.

00:21:01.666 --> 00:21:04.076 A:middle
Now, in iOS 13, we're offering

00:21:04.076 --> 00:21:05.426 A:middle
you a way to account for the

00:21:05.426 --> 00:21:07.366 A:middle
system pressure cost upfront,

00:21:07.766 --> 00:21:08.196 A:middle
okay?

00:21:08.646 --> 00:21:09.906 A:middle
Instead of just telling you

00:21:09.906 --> 00:21:11.056 A:middle
what's happening right now,

00:21:11.586 --> 00:21:12.866 A:middle
which may be influenced by the

00:21:12.866 --> 00:21:14.386 A:middle
fact that you played Clash of

00:21:14.416 --> 00:21:16.266 A:middle
Clans before you restarted the

00:21:17.086 --> 00:21:18.246 A:middle
camera, we now have a way to

00:21:18.246 --> 00:21:20.226 A:middle
tell you what the camera cost as

00:21:20.226 --> 00:21:21.416 A:middle
far as system pressure is,

00:21:21.736 --> 00:21:22.786 A:middle
independent of all other

00:21:22.786 --> 00:21:23.376 A:middle
factors.

00:21:23.686 --> 00:21:26.076 A:middle
So the contributors to this cost

00:21:26.076 --> 00:21:27.316 A:middle
are the same as the ones for

00:21:27.316 --> 00:21:28.896 A:middle
hardware along with a lot of

00:21:28.896 --> 00:21:31.616 A:middle
other ones, such as video image

00:21:31.616 --> 00:21:34.056 A:middle
stabilization or optical image

00:21:34.056 --> 00:21:34.756 A:middle
stabilization.

00:21:34.756 --> 00:21:36.356 A:middle
All of those cost power.

00:21:36.756 --> 00:21:38.246 A:middle
We have a Smart HDR feature,

00:21:38.246 --> 00:21:40.316 A:middle
etc. All of those things listed

00:21:40.316 --> 00:21:42.046 A:middle
here are contributors to overall

00:21:42.046 --> 00:21:43.286 A:middle
system pressure cost.

00:21:45.016 --> 00:21:46.986 A:middle
MultiCamSession can tally that

00:21:46.986 --> 00:21:48.476 A:middle
score upfront just like it does

00:21:48.476 --> 00:21:51.186 A:middle
for hardware, and it will only

00:21:51.186 --> 00:21:52.406 A:middle
account for the factors that it

00:21:52.406 --> 00:21:53.076 A:middle
knows about.

00:21:53.336 --> 00:21:54.586 A:middle
So if you're going to be doing

00:21:54.586 --> 00:21:56.276 A:middle
some wild GPU processing at the

00:21:56.276 --> 00:21:58.056 A:middle
same time, the score won't

00:21:58.056 --> 00:21:58.756 A:middle
include that.

00:21:58.886 --> 00:22:00.086 A:middle
It'll just include what you're

00:21:58.886 --> 00:22:00.086 A:middle
It'll just include what you're

00:22:00.086 --> 00:22:03.036 A:middle
doing with the camera.

00:22:03.036 --> 00:22:03.876 A:middle
Here's how you use it.

00:22:05.146 --> 00:22:06.746 A:middle
By querying the system pressure

00:22:06.746 --> 00:22:09.386 A:middle
cost, you can find out how long

00:22:09.386 --> 00:22:11.546 A:middle
you would be runnable in an

00:22:11.546 --> 00:22:13.446 A:middle
otherwise quiescent system.

00:22:13.906 --> 00:22:16.006 A:middle
So if it's less than 1.0, you

00:22:16.006 --> 00:22:17.106 A:middle
can run indefinitely.

00:22:17.236 --> 00:22:18.086 A:middle
You're a cool customer.

00:22:18.886 --> 00:22:20.636 A:middle
If it's between 1 and 2, you

00:22:20.636 --> 00:22:22.096 A:middle
should be runnable for up to 15

00:22:22.096 --> 00:22:24.526 A:middle
minutes, 2 to 3 up to 10

00:22:24.526 --> 00:22:27.216 A:middle
minutes, and higher than 3, you

00:22:27.216 --> 00:22:28.586 A:middle
may be able to run for a short

00:22:28.586 --> 00:22:29.116 A:middle
little bit.

00:22:29.116 --> 00:22:31.236 A:middle
And, in fact, we will let you

00:22:31.236 --> 00:22:32.576 A:middle
run the camera, even if you're

00:22:32.576 --> 00:22:34.216 A:middle
over 3, but you have to

00:22:34.216 --> 00:22:35.396 A:middle
understand that it's not going

00:22:35.396 --> 00:22:36.806 A:middle
to stay cool very long.

00:22:37.166 --> 00:22:38.266 A:middle
And once it gets up to a

00:22:38.266 --> 00:22:40.066 A:middle
critical or shutdown level, your

00:22:40.066 --> 00:22:41.516 A:middle
session will become interrupted.

00:22:41.786 --> 00:22:43.246 A:middle
So we'll save the hardware even

00:22:43.246 --> 00:22:43.896 A:middle
if you don't want to.

00:22:43.896 --> 00:22:44.966 A:middle
But, hey, it's great.

00:22:44.966 --> 00:22:46.716 A:middle
If you can get what you need to

00:22:47.146 --> 00:22:48.816 A:middle
get done in 30 seconds of

00:22:48.816 --> 00:22:50.146 A:middle
running at a very, very high

00:22:50.366 --> 00:22:51.896 A:middle
system pressure cost, by all

00:22:51.896 --> 00:22:53.286 A:middle
means, do that.

00:22:54.876 --> 00:22:56.076 A:middle
Now, how do you reduce your

00:22:56.076 --> 00:22:57.696 A:middle
system pressure while running?

00:22:57.826 --> 00:22:58.966 A:middle
I'm not talking about while

00:22:58.966 --> 00:22:59.996 A:middle
you're configuring your session.

00:22:59.996 --> 00:23:01.476 A:middle
I'm talking about once you're

00:22:59.996 --> 00:23:01.476 A:middle
I'm talking about once you're

00:23:01.786 --> 00:23:03.466 A:middle
already running and you notice

00:23:03.466 --> 00:23:04.656 A:middle
that you're starting to elevate

00:23:04.656 --> 00:23:05.546 A:middle
in system pressure.

00:23:05.776 --> 00:23:06.976 A:middle
The quickest and easiest way to

00:23:06.976 --> 00:23:08.036 A:middle
do it is to lower the frame

00:23:08.036 --> 00:23:08.226 A:middle
rate.

00:23:08.666 --> 00:23:10.536 A:middle
Immediately, that will relive

00:23:10.536 --> 00:23:11.266 A:middle
system pressure.

00:23:11.756 --> 00:23:12.856 A:middle
Also, if you're doing things

00:23:12.856 --> 00:23:14.126 A:middle
that we don't know about, such

00:23:14.126 --> 00:23:16.506 A:middle
as heavy GPU or CPU work, you

00:23:16.506 --> 00:23:17.486 A:middle
can throttle that back.

00:23:18.136 --> 00:23:21.746 A:middle
As a last resort, you might try

00:23:21.986 --> 00:23:23.056 A:middle
disabling one or more of the

00:23:23.056 --> 00:23:24.126 A:middle
cameras that you're using.

00:23:25.026 --> 00:23:27.296 A:middle
AVMultiCamSession has a neat

00:23:27.676 --> 00:23:29.956 A:middle
little feature that, while

00:23:29.956 --> 00:23:31.986 A:middle
running, you can disable one of

00:23:31.986 --> 00:23:33.476 A:middle
the cameras without affecting

00:23:33.476 --> 00:23:34.506 A:middle
preview on the other.

00:23:34.586 --> 00:23:35.966 A:middle
We don't shut everything down.

00:23:36.356 --> 00:23:37.256 A:middle
So if, for instance, you're

00:23:37.256 --> 00:23:38.036 A:middle
running with the front and the

00:23:38.036 --> 00:23:39.436 A:middle
back, you notice that you're way

00:23:39.436 --> 00:23:40.916 A:middle
over budget, and you're soon

00:23:40.916 --> 00:23:42.816 A:middle
going to go critical, you could

00:23:42.816 --> 00:23:44.006 A:middle
choose to shut down the front

00:23:44.006 --> 00:23:44.446 A:middle
camera.

00:23:44.606 --> 00:23:45.646 A:middle
The back camera will keep

00:23:45.646 --> 00:23:46.106 A:middle
previewing.

00:23:46.106 --> 00:23:47.146 A:middle
It won't lose its focus,

00:23:47.146 --> 00:23:48.436 A:middle
exposure, white balance.

00:23:48.976 --> 00:23:51.336 A:middle
And when you shut down the last

00:23:51.436 --> 00:23:54.556 A:middle
active input port on the camera

00:23:54.556 --> 00:23:55.986 A:middle
that you want to disable by

00:23:55.986 --> 00:23:58.296 A:middle
setting its input port's enabled

00:23:58.296 --> 00:24:00.676 A:middle
property to false, we will stop

00:23:58.296 --> 00:24:00.676 A:middle
property to false, we will stop

00:24:00.676 --> 00:24:02.136 A:middle
that camera streaming and save a

00:24:02.136 --> 00:24:03.596 A:middle
ton of power and give that

00:24:03.596 --> 00:24:04.896 A:middle
system a chance to cool off.

00:24:05.216 --> 00:24:07.876 A:middle
All right, so I've just talked

00:24:07.876 --> 00:24:10.066 A:middle
about two very important costs,

00:24:10.066 --> 00:24:11.416 A:middle
hardware and system pressure.

00:24:12.176 --> 00:24:13.506 A:middle
There are other costs that we

00:24:13.506 --> 00:24:14.316 A:middle
are not reporting.

00:24:14.316 --> 00:24:15.996 A:middle
I didn't want to trick you into

00:24:15.996 --> 00:24:16.786 A:middle
believing that there aren't

00:24:16.786 --> 00:24:18.106 A:middle
other things at work here.

00:24:18.136 --> 00:24:19.046 A:middle
There are, of course, other

00:24:19.046 --> 00:24:20.626 A:middle
costs such as memory.

00:24:21.096 --> 00:24:22.706 A:middle
But in iOS 13, we are

00:24:22.706 --> 00:24:24.766 A:middle
artificially limiting the device

00:24:24.766 --> 00:24:26.386 A:middle
combinations that we will allow

00:24:26.386 --> 00:24:28.656 A:middle
you to run, the ones that we are

00:24:28.656 --> 00:24:30.586 A:middle
confident will run and that will

00:24:30.586 --> 00:24:31.556 A:middle
not get you into trouble.

00:24:32.936 --> 00:24:35.126 A:middle
So we have a limited number of

00:24:35.126 --> 00:24:36.856 A:middle
supported device combinations.

00:24:37.166 --> 00:24:38.186 A:middle
Here I'm listing the ones that

00:24:38.186 --> 00:24:40.146 A:middle
are supported on iPhone XS.

00:24:40.576 --> 00:24:41.646 A:middle
This is kind of an eye chart.

00:24:41.646 --> 00:24:42.766 A:middle
I don't expect you to remember

00:24:42.766 --> 00:24:42.956 A:middle
this.

00:24:42.956 --> 00:24:44.136 A:middle
You can pause the video later.

00:24:44.456 --> 00:24:45.596 A:middle
But there are six supported

00:24:45.596 --> 00:24:47.096 A:middle
configs, and the simple rule to

00:24:47.096 --> 00:24:48.696 A:middle
remember is that you're allowed

00:24:48.696 --> 00:24:50.386 A:middle
to run two physical cameras at a

00:24:50.386 --> 00:24:50.776 A:middle
time.

00:24:51.316 --> 00:24:52.256 A:middle
You might be questioning, like,

00:24:52.506 --> 00:24:54.356 A:middle
Brad, what about config number

00:24:54.356 --> 00:24:54.746 A:middle
one there?

00:24:54.746 --> 00:24:56.146 A:middle
There's only one checkbox.

00:24:56.556 --> 00:24:57.546 A:middle
That's because it's the dual

00:24:57.546 --> 00:24:59.356 A:middle
camera, and the dual camera is a

00:24:59.356 --> 00:25:00.936 A:middle
software camera that's actually

00:24:59.356 --> 00:25:00.936 A:middle
software camera that's actually

00:25:00.936 --> 00:25:02.306 A:middle
comprised of the wide and the

00:25:02.306 --> 00:25:03.916 A:middle
telephoto, so it is two physical

00:25:03.916 --> 00:25:04.376 A:middle
cameras.

00:25:05.766 --> 00:25:07.096 A:middle
How do you find out if MultiCam

00:25:07.096 --> 00:25:07.736 A:middle
is supported?

00:25:08.076 --> 00:25:09.416 A:middle
Like I said, it's only supported

00:25:09.416 --> 00:25:11.786 A:middle
on newer hardware, so you need

00:25:11.786 --> 00:25:13.266 A:middle
to check if MultiCamSession will

00:25:13.266 --> 00:25:14.966 A:middle
let you run multiple cameras or

00:25:14.966 --> 00:25:16.446 A:middle
not on the device that you have.

00:25:17.006 --> 00:25:18.106 A:middle
There's a class method called

00:25:18.106 --> 00:25:19.826 A:middle
isMultiCamSupported, which you

00:25:19.826 --> 00:25:21.886 A:middle
can right away decide yes or no.

00:25:22.056 --> 00:25:23.906 A:middle
And then further when you want

00:25:23.906 --> 00:25:25.216 A:middle
to decide am I allowed to run

00:25:25.216 --> 00:25:26.556 A:middle
this combination of devices

00:25:26.556 --> 00:25:28.206 A:middle
together, you can create an

00:25:28.206 --> 00:25:30.056 A:middle
AVCaptureDevice.DiscoverySession

00:25:30.396 --> 00:25:31.426 A:middle
with the devices that you're

00:25:31.426 --> 00:25:32.796 A:middle
interested in and then ask it

00:25:32.856 --> 00:25:33.866 A:middle
for its new property

00:25:34.236 --> 00:25:36.466 A:middle
supportedMultiCamDeviceSets.

00:25:36.686 --> 00:25:38.256 A:middle
And this will produce an array

00:25:38.256 --> 00:25:40.506 A:middle
of unordered sets that tell you

00:25:40.506 --> 00:25:41.646 A:middle
which ones you're allowed to use

00:25:41.646 --> 00:25:41.986 A:middle
together.

00:25:43.036 --> 00:25:45.016 A:middle
Next up is a way that we are

00:25:45.016 --> 00:25:47.136 A:middle
artificially limiting the

00:25:47.286 --> 00:25:48.376 A:middle
formats that you're allowed to

00:25:48.376 --> 00:25:48.646 A:middle
run.

00:25:49.346 --> 00:25:51.216 A:middle
The supported formats last I

00:25:51.336 --> 00:25:52.796 A:middle
checked on in iPhone XS, there

00:25:53.366 --> 00:25:55.176 A:middle
were more than 40 formats on the

00:25:55.176 --> 00:25:55.806 A:middle
back camera.

00:25:55.806 --> 00:25:57.016 A:middle
So there are tons to choose

00:25:57.016 --> 00:25:57.256 A:middle
from.

00:25:57.416 --> 00:25:58.816 A:middle
But we are limiting the actual

00:25:58.816 --> 00:26:00.076 A:middle
video formats allowed to run

00:25:58.816 --> 00:26:00.076 A:middle
video formats allowed to run

00:26:00.076 --> 00:26:01.756 A:middle
with MultiCamSession, because

00:26:01.756 --> 00:26:02.886 A:middle
these are the ones that we can

00:26:02.886 --> 00:26:05.026 A:middle
comfortable run simultaneously

00:26:05.326 --> 00:26:06.506 A:middle
on end devices.

00:26:06.986 --> 00:26:07.896 A:middle
So again, this is a bit of an

00:26:07.896 --> 00:26:08.856 A:middle
eye chart, but I'm going to draw

00:26:08.856 --> 00:26:10.146 A:middle
your attention to groups.

00:26:10.766 --> 00:26:12.296 A:middle
First group is the binned

00:26:12.356 --> 00:26:12.936 A:middle
formats.

00:26:13.146 --> 00:26:14.186 A:middle
Remember? Low power.

00:26:14.186 --> 00:26:15.466 A:middle
Yay, these are our friends.

00:26:15.726 --> 00:26:16.836 A:middle
At the sensor, you're getting

00:26:17.186 --> 00:26:18.596 A:middle
that 2 by 2 binning, so you're

00:26:18.596 --> 00:26:19.986 A:middle
getting very low power.

00:26:20.816 --> 00:26:22.146 A:middle
All of these are available up to

00:26:22.146 --> 00:26:22.966 A:middle
60 FPS.

00:26:23.096 --> 00:26:24.656 A:middle
You've got choices from 640 by

00:26:24.656 --> 00:26:27.026 A:middle
480 all the way up to 1920 by

00:26:27.026 --> 00:26:27.696 A:middle
1440.

00:26:27.806 --> 00:26:31.536 A:middle
Next group is the 1920 by 1080

00:26:31.536 --> 00:26:32.096 A:middle
at 30.

00:26:32.096 --> 00:26:34.366 A:middle
This an unbinned format, and

00:26:34.366 --> 00:26:35.636 A:middle
this is the same as the one you

00:26:35.636 --> 00:26:36.876 A:middle
would get if you chose the high

00:26:36.876 --> 00:26:38.806 A:middle
preset on a regular traditional

00:26:38.806 --> 00:26:39.186 A:middle
session.

00:26:39.786 --> 00:26:40.976 A:middle
This one is available for

00:26:40.976 --> 00:26:41.856 A:middle
MultiCam use.

00:26:42.206 --> 00:26:45.416 A:middle
The final one is 1920 by 1440

00:26:45.416 --> 00:26:46.556 A:middle
unbinned at 30 FPS.

00:26:47.046 --> 00:26:48.416 A:middle
This is kind of a good stand-in

00:26:48.416 --> 00:26:49.466 A:middle
for the photo format.

00:26:49.996 --> 00:26:52.526 A:middle
We do not support 12 megapixel

00:26:52.526 --> 00:26:53.686 A:middle
on N cameras.

00:26:54.006 --> 00:26:55.506 A:middle
That would certainly do bad

00:26:55.556 --> 00:26:57.576 A:middle
things to the phone, but we do

00:26:57.576 --> 00:27:00.076 A:middle
allow you to do 1920 by 1440 at

00:26:57.576 --> 00:27:00.076 A:middle
allow you to do 1920 by 1440 at

00:27:00.076 --> 00:27:00.496 A:middle
30 FPS.

00:27:00.556 --> 00:27:02.116 A:middle
And notice, it still allows you

00:27:02.116 --> 00:27:03.446 A:middle
to do 12 megapixel

00:27:03.446 --> 00:27:04.756 A:middle
high-resolution stills.

00:27:04.756 --> 00:27:07.216 A:middle
So this is a very good proxy for

00:27:07.676 --> 00:27:09.026 A:middle
when you want to do photography

00:27:09.226 --> 00:27:10.266 A:middle
with multiple cameras

00:27:10.266 --> 00:27:11.046 A:middle
simultaneously.

00:27:11.626 --> 00:27:14.826 A:middle
Now, how do you find out if a

00:27:14.826 --> 00:27:16.246 A:middle
format supports MultiCam?

00:27:16.426 --> 00:27:17.246 A:middle
You just ask it.

00:27:17.636 --> 00:27:18.626 A:middle
So while iterating through the

00:27:18.626 --> 00:27:19.866 A:middle
formats, you can say, "Is

00:27:19.866 --> 00:27:20.906 A:middle
MultiCam supported?"

00:27:20.906 --> 00:27:22.426 A:middle
And if it is, you're allowed to

00:27:22.426 --> 00:27:22.856 A:middle
use it.

00:27:23.406 --> 00:27:25.116 A:middle
In this code here, I'm iterating

00:27:25.116 --> 00:27:26.536 A:middle
through the formats on a device

00:27:26.816 --> 00:27:28.706 A:middle
and picking the next lowest one

00:27:28.706 --> 00:27:30.796 A:middle
in resolution that supports

00:27:30.796 --> 00:27:32.456 A:middle
MultiCam and then setting it as

00:27:32.456 --> 00:27:33.866 A:middle
my active format.

00:27:34.916 --> 00:27:35.926 A:middle
The last way that we're

00:27:35.926 --> 00:27:37.296 A:middle
artificially limiting is,

00:27:37.906 --> 00:27:40.696 A:middle
because we need to report costs,

00:27:40.956 --> 00:27:42.476 A:middle
and those costs are reported by

00:27:42.556 --> 00:27:44.466 A:middle
the MultiCamSession, we're

00:27:44.466 --> 00:27:46.176 A:middle
specifically not supporting on

00:27:46.336 --> 00:27:48.766 A:middle
iOS multiple sessions with

00:27:48.766 --> 00:27:50.726 A:middle
multiple cameras in an app, and

00:27:50.726 --> 00:27:51.796 A:middle
we're also not supporting

00:27:52.046 --> 00:27:53.586 A:middle
multiple cameras in multiple

00:27:53.586 --> 00:27:54.986 A:middle
apps simultaneously.

00:27:55.276 --> 00:27:57.286 A:middle
Just be aware that the support

00:27:57.286 --> 00:27:58.736 A:middle
on iOS is still limited to one

00:27:58.736 --> 00:28:00.536 A:middle
session at a time, but of course

00:27:58.736 --> 00:28:00.536 A:middle
session at a time, but of course

00:28:00.536 --> 00:28:02.786 A:middle
you can run multiple cameras at

00:28:03.716 --> 00:28:04.086 A:middle
a time.

00:28:04.086 --> 00:28:05.886 A:middle
Thus concludes the dad talk.

00:28:06.606 --> 00:28:07.636 A:middle
Okay, write good code.

00:28:08.296 --> 00:28:09.286 A:middle
Be home by 11.

00:28:09.626 --> 00:28:11.046 A:middle
If your plans change, call me.

00:28:11.426 --> 00:28:12.346 A:middle
All right.

00:28:12.746 --> 00:28:14.776 A:middle
All right, now back to the fun

00:28:14.776 --> 00:28:15.176 A:middle
stuff.

00:28:16.456 --> 00:28:17.396 A:middle
Synchronized streaming.

00:28:17.926 --> 00:28:20.866 A:middle
I talked a little bit about

00:28:20.866 --> 00:28:21.956 A:middle
software cameras.

00:28:22.836 --> 00:28:24.186 A:middle
Dual camera for one was

00:28:24.186 --> 00:28:26.506 A:middle
introduced on iPhone 7 Plus, and

00:28:26.506 --> 00:28:27.676 A:middle
it's now present on the iPhone

00:28:27.676 --> 00:28:29.416 A:middle
XS and XS Max as well.

00:28:29.416 --> 00:28:31.406 A:middle
And the TrueDepth camera is also

00:28:31.406 --> 00:28:32.636 A:middle
another kind of software camera,

00:28:32.636 --> 00:28:34.346 A:middle
because it's comprised of an

00:28:34.346 --> 00:28:36.066 A:middle
infrared camera and an RGB

00:28:36.066 --> 00:28:38.896 A:middle
camera that is able to do depth

00:28:38.976 --> 00:28:40.316 A:middle
by taking the disparity between

00:28:40.316 --> 00:28:40.846 A:middle
those two.

00:28:42.096 --> 00:28:44.126 A:middle
Now, we've never given these

00:28:44.346 --> 00:28:46.226 A:middle
special types of cameras a name,

00:28:46.676 --> 00:28:47.696 A:middle
but we're doing that now.

00:28:47.806 --> 00:28:49.286 A:middle
In iOS 13, we're calling them

00:28:49.286 --> 00:28:50.356 A:middle
virtual cameras.

00:28:50.916 --> 00:28:53.366 A:middle
DualCam is one of them.

00:28:53.366 --> 00:28:54.996 A:middle
It presents one video stream at

00:28:55.206 --> 00:28:57.486 A:middle
a time, and it switches between

00:28:57.486 --> 00:29:00.026 A:middle
them based on your zoom factor.

00:28:57.486 --> 00:29:00.026 A:middle
them based on your zoom factor.

00:29:00.206 --> 00:29:02.376 A:middle
So as you get closer to 2x, it

00:29:02.376 --> 00:29:03.946 A:middle
switches over to the telephoto

00:29:03.946 --> 00:29:04.986 A:middle
camera instead of the wide

00:29:04.986 --> 00:29:05.376 A:middle
camera.

00:29:05.836 --> 00:29:07.426 A:middle
It also can do neat tricks with

00:29:07.776 --> 00:29:09.576 A:middle
depth, because it has two images

00:29:09.616 --> 00:29:10.836 A:middle
that it can use to generate

00:29:10.836 --> 00:29:11.826 A:middle
disparity between them.

00:29:12.366 --> 00:29:13.096 A:middle
But still, from your

00:29:13.096 --> 00:29:14.066 A:middle
perspective, you've only been

00:29:14.066 --> 00:29:16.706 A:middle
able to get one stream at a

00:29:17.516 --> 00:29:17.636 A:middle
time.

00:29:17.836 --> 00:29:19.566 A:middle
Because we have a name now, they

00:29:19.566 --> 00:29:21.336 A:middle
are also a property in the API

00:29:21.336 --> 00:29:22.206 A:middle
which you can query.

00:29:22.286 --> 00:29:23.316 A:middle
So as you're looking at your

00:29:23.316 --> 00:29:24.596 A:middle
camera devices, you can find

00:29:24.596 --> 00:29:26.576 A:middle
out, programmatically, is this

00:29:26.576 --> 00:29:27.646 A:middle
one a virtual device?

00:29:28.026 --> 00:29:29.676 A:middle
And if it is, you can ask it,

00:29:29.726 --> 00:29:30.866 A:middle
"Well, what are your physical

00:29:30.866 --> 00:29:31.466 A:middle
devices?"

00:29:31.936 --> 00:29:33.896 A:middle
And in the API, we call this its

00:29:34.056 --> 00:29:35.426 A:middle
constituentDevices.

00:29:37.356 --> 00:29:39.046 A:middle
Synchronized streaming is all

00:29:39.046 --> 00:29:40.346 A:middle
about taking those

00:29:40.346 --> 00:29:43.196 A:middle
constituentDevices of a virtual

00:29:43.196 --> 00:29:44.466 A:middle
device and running them

00:29:44.966 --> 00:29:45.796 A:middle
synchronized.

00:29:46.126 --> 00:29:47.236 A:middle
In other words, for the first

00:29:47.236 --> 00:29:48.716 A:middle
time, we're allowing you to

00:29:48.716 --> 00:29:50.646 A:middle
stream synchronized video from

00:29:50.646 --> 00:29:52.126 A:middle
the wide and the tele at the

00:29:52.126 --> 00:29:54.256 A:middle
same time.

00:29:54.416 --> 00:29:55.306 A:middle
You continue to set the

00:29:55.306 --> 00:29:56.526 A:middle
properties on the virtual

00:29:56.526 --> 00:29:57.336 A:middle
device, not on the

00:29:57.336 --> 00:29:58.596 A:middle
constituentDevices.

00:30:00.296 --> 00:30:01.926 A:middle
And there are some rules in

00:30:01.926 --> 00:30:02.426 A:middle
place.

00:30:03.226 --> 00:30:04.626 A:middle
When you run the virtual device,

00:30:04.986 --> 00:30:06.916 A:middle
the constituentDevices aren't

00:30:06.916 --> 00:30:08.046 A:middle
allowed to run willy-nilly.

00:30:08.906 --> 00:30:10.236 A:middle
They have the same active

00:30:10.236 --> 00:30:10.986 A:middle
resolution.

00:30:10.986 --> 00:30:12.276 A:middle
They have the same frame rate.

00:30:12.866 --> 00:30:14.636 A:middle
And at a hardware level, they

00:30:14.636 --> 00:30:15.666 A:middle
are synchronized.

00:30:15.996 --> 00:30:19.156 A:middle
That means the sensor's reading

00:30:19.156 --> 00:30:21.536 A:middle
out those frames in a

00:30:21.536 --> 00:30:23.276 A:middle
synchronized fashion so that the

00:30:23.276 --> 00:30:26.686 A:middle
middle line of the readout is

00:30:26.746 --> 00:30:28.556 A:middle
exactly at the same clock time.

00:30:29.496 --> 00:30:31.276 A:middle
So that means that they match at

00:30:31.276 --> 00:30:32.106 A:middle
the frame centers.

00:30:32.396 --> 00:30:34.276 A:middle
It also means that the exposure,

00:30:34.506 --> 00:30:36.326 A:middle
white balance and focus happen

00:30:36.326 --> 00:30:37.846 A:middle
in tandem, which is really nice.

00:30:37.846 --> 00:30:39.146 A:middle
It makes it look like virtually

00:30:39.146 --> 00:30:40.676 A:middle
it is the same camera, just

00:30:40.676 --> 00:30:41.846 A:middle
happens to be at two different

00:30:42.246 --> 00:30:42.926 A:middle
fields of view.

00:30:45.636 --> 00:30:47.786 A:middle
This is best shown rather than

00:30:47.786 --> 00:30:49.306 A:middle
talked about, so let's do a

00:30:49.306 --> 00:30:49.586 A:middle
demo.

00:30:49.796 --> 00:30:51.786 A:middle
This one's called AVDualCam.

00:30:52.346 --> 00:30:53.626 A:middle
There we are.

00:30:55.076 --> 00:30:57.456 A:middle
Okay, AVDualCam lets you see

00:30:57.876 --> 00:31:00.096 A:middle
what a virtual camera sees by

00:30:57.876 --> 00:31:00.096 A:middle
what a virtual camera sees by

00:31:00.096 --> 00:31:01.716 A:middle
showing you a display of the two

00:31:01.716 --> 00:31:03.236 A:middle
cameras running synchronized.

00:31:03.546 --> 00:31:05.906 A:middle
And it does this by showing you

00:31:05.906 --> 00:31:07.316 A:middle
several different views of those

00:31:07.316 --> 00:31:07.896 A:middle
cameras.

00:31:08.716 --> 00:31:11.136 A:middle
Okay, here I've got the wide and

00:31:11.136 --> 00:31:13.066 A:middle
the tele constituent streams of

00:31:13.066 --> 00:31:14.606 A:middle
the dual camera running

00:31:14.606 --> 00:31:15.296 A:middle
synchronized.

00:31:15.656 --> 00:31:17.556 A:middle
On the left is the wide, and on

00:31:17.556 --> 00:31:18.676 A:middle
the right is the tele.

00:31:19.456 --> 00:31:20.206 A:middle
Don't believe me?

00:31:20.206 --> 00:31:21.836 A:middle
Here, I'm going to put my finger

00:31:21.836 --> 00:31:22.476 A:middle
over one side.

00:31:23.076 --> 00:31:24.966 A:middle
I'm going to put my finger over

00:31:24.966 --> 00:31:25.396 A:middle
the other side.

00:31:25.396 --> 00:31:26.926 A:middle
See? They're different cameras.

00:31:29.596 --> 00:31:31.526 A:middle
All I've done with the wide is

00:31:31.526 --> 00:31:32.766 A:middle
zoom it so it's at the same

00:31:32.766 --> 00:31:33.756 A:middle
field of view as the tele.

00:31:34.436 --> 00:31:36.316 A:middle
But you can notice that they're

00:31:36.316 --> 00:31:37.766 A:middle
running perfectly synchronized.

00:31:37.766 --> 00:31:39.306 A:middle
There's no tearing.

00:31:39.306 --> 00:31:40.466 A:middle
There's no weirdness in the

00:31:40.466 --> 00:31:41.316 A:middle
vertical blanking.

00:31:41.946 --> 00:31:43.996 A:middle
Their exposures and focuses

00:31:43.996 --> 00:31:45.176 A:middle
change at the same time.

00:31:46.356 --> 00:31:47.196 A:middle
Now we can have a little bit

00:31:47.196 --> 00:31:48.306 A:middle
more fun if we change from the

00:31:48.306 --> 00:31:51.266 A:middle
side-by-side view to the Split

00:31:51.266 --> 00:31:51.506 A:middle
View.

00:31:52.036 --> 00:31:53.296 A:middle
Now, this a little bit hard to

00:31:53.296 --> 00:31:56.836 A:middle
see, but I'm showing the wide on

00:31:56.836 --> 00:31:59.066 A:middle
the left and the tele on the

00:31:59.066 --> 00:31:59.296 A:middle
right.

00:31:59.476 --> 00:32:00.666 A:middle
So I'm only showing you half of

00:31:59.476 --> 00:32:00.666 A:middle
So I'm only showing you half of

00:32:00.666 --> 00:32:01.176 A:middle
each frame.

00:32:02.306 --> 00:32:04.476 A:middle
Now, if I triple-tap, I bring up

00:32:04.476 --> 00:32:05.506 A:middle
a distanceometer [phonetic]

00:32:06.266 --> 00:32:08.686 A:middle
which lets me change the plane

00:32:09.176 --> 00:32:10.796 A:middle
of depth convergence for the two

00:32:10.796 --> 00:32:11.406 A:middle
images.

00:32:12.046 --> 00:32:14.216 A:middle
This app knows how to register

00:32:14.216 --> 00:32:15.736 A:middle
the two images relative to one

00:32:15.736 --> 00:32:18.146 A:middle
another, so it lets me play with

00:32:18.146 --> 00:32:19.526 A:middle
the plane at which the depth

00:32:19.526 --> 00:32:20.586 A:middle
converges, kind of like with

00:32:20.586 --> 00:32:22.666 A:middle
your eyes when you focus on

00:32:22.666 --> 00:32:24.316 A:middle
something up close or far away,

00:32:24.606 --> 00:32:25.586 A:middle
you're kind of changing that

00:32:25.626 --> 00:32:26.916 A:middle
depth plane of convergence.

00:32:27.316 --> 00:32:28.916 A:middle
So, for instance, up close with

00:32:28.916 --> 00:32:31.506 A:middle
my hand, I can find the place

00:32:31.506 --> 00:32:33.686 A:middle
where the depth converges

00:32:33.686 --> 00:32:34.276 A:middle
nicely.

00:32:34.476 --> 00:32:34.956 A:middle
There we go.

00:32:34.956 --> 00:32:36.476 A:middle
Now I've got one hand.

00:32:37.066 --> 00:32:38.786 A:middle
But that's not right for the car

00:32:38.786 --> 00:32:40.266 A:middle
behind me so I can keep going

00:32:40.926 --> 00:32:42.536 A:middle
further away.

00:32:43.846 --> 00:32:44.356 A:middle
There we go.

00:32:44.356 --> 00:32:45.776 A:middle
And that's not right for the car

00:32:45.776 --> 00:32:46.566 A:middle
behind it.

00:32:47.336 --> 00:32:49.706 A:middle
So now I can pull that guy back

00:32:49.706 --> 00:32:49.916 A:middle
too.

00:32:49.996 --> 00:32:52.966 A:middle
And that's dual camera streaming

00:32:52.966 --> 00:32:54.146 A:middle
synchronized from the dual

00:32:54.146 --> 00:32:54.676 A:middle
cameras.

00:32:55.516 --> 00:33:00.500 A:middle
[ Applause ]

00:32:55.516 --> 00:33:00.500 A:middle
[ Applause ]

00:33:03.046 --> 00:33:04.336 A:middle
Here's a diagram showing

00:33:04.426 --> 00:33:05.966 A:middle
AVDualCam's graph.

00:33:07.096 --> 00:33:08.736 A:middle
Instead of using separate device

00:33:08.736 --> 00:33:10.016 A:middle
inputs, it just has one.

00:33:10.586 --> 00:33:11.646 A:middle
So it's using a single device

00:33:11.646 --> 00:33:13.266 A:middle
input for the dual camera, but

00:33:13.266 --> 00:33:14.876 A:middle
it's sourcing wide and tele

00:33:14.876 --> 00:33:17.256 A:middle
frames in a synchronized fashion

00:33:17.706 --> 00:33:19.226 A:middle
to two VideoDataOutputs.

00:33:20.076 --> 00:33:21.316 A:middle
You'll notice that there is a

00:33:21.316 --> 00:33:23.226 A:middle
little object, little pill at

00:33:23.226 --> 00:33:23.966 A:middle
the bottom called the

00:33:23.966 --> 00:33:25.836 A:middle
AVCaptureOutputSynchronizer.

00:33:26.086 --> 00:33:27.066 A:middle
I don't want to confuse you.

00:33:27.426 --> 00:33:28.606 A:middle
That thing is not doing the

00:33:28.606 --> 00:33:29.836 A:middle
hardware synchronization that I

00:33:29.836 --> 00:33:30.386 A:middle
talked about.

00:33:30.676 --> 00:33:32.596 A:middle
It's just an object that sits at

00:33:32.636 --> 00:33:34.266 A:middle
the bottom of a session, if you

00:33:34.266 --> 00:33:36.226 A:middle
desire, which lets you get

00:33:36.456 --> 00:33:38.136 A:middle
multiple callbacks for the same

00:33:38.186 --> 00:33:40.066 A:middle
time in a single callback.

00:33:40.066 --> 00:33:41.826 A:middle
So instead of getting a separate

00:33:41.826 --> 00:33:43.196 A:middle
VideoDataOutput callback for the

00:33:43.196 --> 00:33:44.946 A:middle
wide and the tele, you can slap

00:33:44.946 --> 00:33:46.436 A:middle
a DataOutputSynchronizer at the

00:33:46.436 --> 00:33:48.016 A:middle
bottom and get both frames for

00:33:48.016 --> 00:33:49.586 A:middle
the same time through a single

00:33:49.586 --> 00:33:50.076 A:middle
callback.

00:33:50.076 --> 00:33:51.546 A:middle
So it's very handy that way.

00:33:52.166 --> 00:33:54.346 A:middle
Now, below it, there's a Metal

00:33:54.346 --> 00:33:56.006 A:middle
Shader Filter Compositor that's

00:33:56.006 --> 00:33:56.826 A:middle
doing some magic.

00:33:57.366 --> 00:33:58.706 A:middle
Like I said, it's knowing how to

00:33:58.706 --> 00:34:00.696 A:middle
blend those frames together, and

00:33:58.706 --> 00:34:00.696 A:middle
blend those frames together, and

00:34:00.696 --> 00:34:02.066 A:middle
it decides where to render those

00:34:02.066 --> 00:34:03.346 A:middle
frames to the correct places in

00:34:03.346 --> 00:34:04.986 A:middle
the preview, and it also can

00:34:04.986 --> 00:34:06.366 A:middle
send them off to an

00:34:06.366 --> 00:34:07.836 A:middle
AVAssetWriter to record into a

00:34:07.836 --> 00:34:08.985 A:middle
video track.

00:34:10.016 --> 00:34:12.136 A:middle
Now, recall my earlier diagram.

00:34:14.085 --> 00:34:15.485 A:middle
I showed you a close-up view of

00:34:15.516 --> 00:34:16.966 A:middle
the AVCaptureDeviceInput,

00:34:17.226 --> 00:34:18.536 A:middle
specifically the dual camera

00:34:18.536 --> 00:34:18.746 A:middle
one.

00:34:19.606 --> 00:34:20.835 A:middle
The ports property of the dual

00:34:20.835 --> 00:34:23.735 A:middle
camera input exposes which ports

00:34:23.735 --> 00:34:24.266 A:middle
you see there.

00:34:25.326 --> 00:34:26.815 A:middle
Anybody see two video ports

00:34:26.815 --> 00:34:27.036 A:middle
there?

00:34:28.686 --> 00:34:29.906 A:middle
I don't see two video ports.

00:34:29.906 --> 00:34:31.436 A:middle
So how do we get both wide and

00:34:31.436 --> 00:34:34.235 A:middle
tele out of those input ports

00:34:34.235 --> 00:34:35.016 A:middle
that we see here?

00:34:35.326 --> 00:34:36.956 A:middle
Is that one video port somehow

00:34:36.956 --> 00:34:37.716 A:middle
giving us two?

00:34:38.196 --> 00:34:39.806 A:middle
No, it's not giving us wide or

00:34:39.806 --> 00:34:40.146 A:middle
tele.

00:34:40.146 --> 00:34:42.025 A:middle
It's giving us whatever the dual

00:34:42.025 --> 00:34:43.735 A:middle
camera decides is right for the

00:34:43.735 --> 00:34:45.846 A:middle
given zoom factor.

00:34:45.846 --> 00:34:48.426 A:middle
That's not going to help us get

00:34:48.426 --> 00:34:49.716 A:middle
both constituent streams at the

00:34:49.716 --> 00:34:51.746 A:middle
same time, so how do we do that?

00:34:52.456 --> 00:34:54.466 A:middle
Well, I'll tell you, but it's a

00:34:54.466 --> 00:34:55.795 A:middle
secret, so you have to promise

00:34:55.795 --> 00:34:57.546 A:middle
not to tell anybody, okay?

00:34:58.316 --> 00:35:00.696 A:middle
Virtual devices have secret

00:34:58.316 --> 00:35:00.696 A:middle
Virtual devices have secret

00:35:00.766 --> 00:35:02.086 A:middle
ports, okay?

00:35:03.366 --> 00:35:06.396 A:middle
The secret ports, previously

00:35:06.426 --> 00:35:07.926 A:middle
unbeknownst to you, are now

00:35:07.926 --> 00:35:09.006 A:middle
available, but you don't get

00:35:09.006 --> 00:35:10.516 A:middle
them out of the port's array,

00:35:10.926 --> 00:35:13.586 A:middle
you get them by knowing what to

00:35:13.586 --> 00:35:14.216 A:middle
ask for.

00:35:14.906 --> 00:35:16.886 A:middle
So instead of just getting an

00:35:16.886 --> 00:35:18.636 A:middle
array of every conceivable type

00:35:18.636 --> 00:35:20.106 A:middle
of port, including ports that

00:35:20.106 --> 00:35:21.926 A:middle
are not allowed to be used with

00:35:21.926 --> 00:35:24.176 A:middle
single-cam session, you can ask

00:35:24.176 --> 00:35:25.086 A:middle
for them by name.

00:35:25.586 --> 00:35:26.396 A:middle
So here we have the

00:35:26.396 --> 00:35:28.376 A:middle
dualCameraInput, and I'm asking

00:35:28.416 --> 00:35:30.046 A:middle
for its ports with

00:35:30.246 --> 00:35:32.576 A:middle
sourceDeviceType WideAngleCamera

00:35:33.056 --> 00:35:34.096 A:middle
and source device type

00:35:34.396 --> 00:35:35.336 A:middle
TelephotoCamera.

00:35:36.026 --> 00:35:37.176 A:middle
It goes "Aha, those are the

00:35:37.176 --> 00:35:38.336 A:middle
secret ports that I know about.

00:35:38.336 --> 00:35:39.086 A:middle
I'll give them to you now."

00:35:39.506 --> 00:35:40.766 A:middle
Once you've got those input

00:35:40.766 --> 00:35:42.636 A:middle
ports, you can hook them up to a

00:35:42.636 --> 00:35:44.216 A:middle
connection the same way that you

00:35:44.216 --> 00:35:46.206 A:middle
would when doing your own manual

00:35:46.236 --> 00:35:47.186 A:middle
connection creation.

00:35:47.806 --> 00:35:49.376 A:middle
Then you're streaming from

00:35:49.376 --> 00:35:51.066 A:middle
either the wide or the tele or

00:35:51.066 --> 00:35:51.326 A:middle
both.

00:35:52.906 --> 00:35:54.626 A:middle
Now, in the AVDualCam demo, I

00:35:54.626 --> 00:35:55.946 A:middle
was able to change the depth

00:35:55.996 --> 00:35:58.316 A:middle
convergence plane of the wide

00:35:58.316 --> 00:35:59.906 A:middle
and tele cameras with the

00:35:59.906 --> 00:36:00.856 A:middle
correct perspective.

00:35:59.906 --> 00:36:00.856 A:middle
correct perspective.

00:36:00.856 --> 00:36:02.676 A:middle
And you saw that it wasn't kind

00:36:02.676 --> 00:36:04.066 A:middle
of moving and shaking all over.

00:36:04.066 --> 00:36:05.356 A:middle
It was just moving along the

00:36:05.446 --> 00:36:06.826 A:middle
plane that I wanted it to, was

00:36:06.826 --> 00:36:08.366 A:middle
just along the plane of the

00:36:08.366 --> 00:36:08.916 A:middle
baseline.

00:36:09.576 --> 00:36:10.476 A:middle
And I was able to do that

00:36:10.476 --> 00:36:12.136 A:middle
because AVFoundation offers us

00:36:12.726 --> 00:36:14.016 A:middle
some homography aids.

00:36:14.486 --> 00:36:15.416 A:middle
Homography is, if you're

00:36:15.416 --> 00:36:16.346 A:middle
unfamiliar with the term, it

00:36:16.346 --> 00:36:18.266 A:middle
just relates two images on the

00:36:18.266 --> 00:36:18.926 A:middle
same plane.

00:36:19.676 --> 00:36:20.956 A:middle
They are the basis for computer

00:36:20.956 --> 00:36:21.286 A:middle
vision.

00:36:21.606 --> 00:36:23.796 A:middle
They are common for such tasks

00:36:23.796 --> 00:36:26.076 A:middle
as image rectification, image

00:36:26.076 --> 00:36:26.736 A:middle
registration.

00:36:27.346 --> 00:36:29.696 A:middle
Now, camera intrinsics are not

00:36:29.696 --> 00:36:30.676 A:middle
new to iOS.

00:36:30.676 --> 00:36:32.406 A:middle
We introduced those in iOS 11.

00:36:33.236 --> 00:36:34.676 A:middle
They're presented as a 3 by 3

00:36:34.676 --> 00:36:36.286 A:middle
matrix that describes the

00:36:36.286 --> 00:36:37.956 A:middle
geometric properties of a

00:36:37.956 --> 00:36:40.416 A:middle
camera, namely its focal length

00:36:40.786 --> 00:36:43.186 A:middle
and its optical center seen here

00:36:43.996 --> 00:36:46.506 A:middle
using the pinhole camera where

00:36:46.506 --> 00:36:47.956 A:middle
you can see where it enters

00:36:47.956 --> 00:36:49.536 A:middle
through the pinhole and hits the

00:36:49.536 --> 00:36:50.936 A:middle
sensor and that being the

00:36:50.936 --> 00:36:52.536 A:middle
optical sensor and the distance

00:36:52.536 --> 00:36:53.766 A:middle
between the two being the focal

00:36:53.766 --> 00:36:54.066 A:middle
length.

00:36:55.486 --> 00:36:56.996 A:middle
Now, you can opt in to receive

00:36:56.996 --> 00:36:59.096 A:middle
per-frame intrinsics by

00:36:59.646 --> 00:37:00.276 A:middle
messaging the

00:36:59.646 --> 00:37:00.276 A:middle
messaging the

00:37:00.276 --> 00:37:01.946 A:middle
AVCaptureConnection and saying

00:37:02.196 --> 00:37:03.626 A:middle
you want to opt in for intrinsic

00:37:03.666 --> 00:37:04.146 A:middle
delivery.

00:37:04.576 --> 00:37:06.096 A:middle
Once you've done that, then

00:37:06.156 --> 00:37:07.676 A:middle
every video data output buffer

00:37:07.676 --> 00:37:09.336 A:middle
that you receive has this

00:37:09.336 --> 00:37:10.126 A:middle
attachment on it,

00:37:10.546 --> 00:37:12.346 A:middle
CameraIntrinsicMatrix, which

00:37:12.346 --> 00:37:14.486 A:middle
again is an NSData wrapping a

00:37:14.816 --> 00:37:17.426 A:middle
matrix float 3 by 3 which is a

00:37:17.426 --> 00:37:18.086 A:middle
simd type.

00:37:18.726 --> 00:37:20.126 A:middle
You'll get when you get the wide

00:37:20.126 --> 00:37:22.136 A:middle
frame, it has the matrix for the

00:37:22.136 --> 00:37:22.866 A:middle
wide camera.

00:37:23.176 --> 00:37:24.846 A:middle
When you get the tele frame, it

00:37:24.846 --> 00:37:26.416 A:middle
has the matrix for the tele

00:37:28.416 --> 00:37:28.756 A:middle
camera.

00:37:28.756 --> 00:37:30.436 A:middle
Now, new in iOS 13, we offer

00:37:30.436 --> 00:37:32.826 A:middle
camera extrinsics at the device

00:37:32.826 --> 00:37:33.156 A:middle
level.

00:37:33.576 --> 00:37:36.356 A:middle
Extrinsics are a rotation matrix

00:37:36.436 --> 00:37:37.946 A:middle
and a translation vector that

00:37:38.086 --> 00:37:41.386 A:middle
are kind of crammed into one

00:37:41.386 --> 00:37:42.226 A:middle
matrix together.

00:37:42.666 --> 00:37:43.956 A:middle
And those describe the camera's

00:37:43.986 --> 00:37:46.156 A:middle
pose compared to a reference

00:37:47.196 --> 00:37:47.456 A:middle
camera.

00:37:47.486 --> 00:37:48.476 A:middle
This helps you if you want to

00:37:48.476 --> 00:37:49.556 A:middle
kind of relate where the two

00:37:49.556 --> 00:37:52.316 A:middle
cameras are, both their tilt and

00:37:52.316 --> 00:37:53.236 A:middle
how far away they are.

00:37:53.686 --> 00:37:56.706 A:middle
So AVDualCam uses the extrinsics

00:37:57.016 --> 00:37:58.686 A:middle
to know how to align the wide

00:37:58.686 --> 00:38:00.786 A:middle
and the tele camera frames with

00:37:58.686 --> 00:38:00.786 A:middle
and the tele camera frames with

00:38:00.786 --> 00:38:01.916 A:middle
respect to one another so it's

00:38:01.916 --> 00:38:02.796 A:middle
able to do those neat

00:38:02.796 --> 00:38:03.816 A:middle
perspective shifts.

00:38:04.066 --> 00:38:07.216 A:middle
That was a very, very brief

00:38:07.246 --> 00:38:08.956 A:middle
refresher on intrinsics and

00:38:09.096 --> 00:38:09.926 A:middle
extrinsics.

00:38:10.216 --> 00:38:11.436 A:middle
So I've described them in

00:38:11.696 --> 00:38:13.486 A:middle
absolutely excruciating detail

00:38:13.486 --> 00:38:16.196 A:middle
two years ago in Session 507, so

00:38:16.196 --> 00:38:17.206 A:middle
I'd invite you to review that

00:38:17.206 --> 00:38:18.226 A:middle
session if you have a very

00:38:18.226 --> 00:38:19.726 A:middle
strong stomach for puns.

00:38:21.916 --> 00:38:24.496 A:middle
Okay, the last topic of MultiCam

00:38:24.496 --> 00:38:27.166 A:middle
capture is multi-mic capture.

00:38:27.716 --> 00:38:30.176 A:middle
All right, let's review the

00:38:30.176 --> 00:38:33.086 A:middle
default behaviors of microphone

00:38:33.086 --> 00:38:34.746 A:middle
capture when using a traditional

00:38:34.746 --> 00:38:35.536 A:middle
AVCaptureSession.

00:38:37.496 --> 00:38:39.836 A:middle
The mic follows the camera.

00:38:40.256 --> 00:38:41.326 A:middle
That's as simple as I can put

00:38:41.326 --> 00:38:41.426 A:middle
it.

00:38:41.696 --> 00:38:43.486 A:middle
So if you have a front-facing

00:38:43.486 --> 00:38:45.046 A:middle
camera attached to your session

00:38:45.286 --> 00:38:48.256 A:middle
and a mic, it will automatically

00:38:48.296 --> 00:38:49.816 A:middle
choose the mic that's pointed in

00:38:49.816 --> 00:38:50.936 A:middle
the same direction as the front

00:38:50.936 --> 00:38:51.306 A:middle
camera.

00:38:51.836 --> 00:38:52.636 A:middle
Same goes for the back.

00:38:52.866 --> 00:38:54.556 A:middle
And it'll make a nice cardioid

00:38:54.556 --> 00:38:56.636 A:middle
pattern so that it rejects audio

00:38:56.636 --> 00:38:57.686 A:middle
out the side that you don't

00:38:57.686 --> 00:38:58.006 A:middle
want.

00:38:58.556 --> 00:38:59.736 A:middle
That way you're able to follow

00:38:59.816 --> 00:39:01.056 A:middle
your subject, be it back or

00:38:59.816 --> 00:39:01.056 A:middle
your subject, be it back or

00:39:01.056 --> 00:39:01.366 A:middle
front.

00:39:01.666 --> 00:39:02.996 A:middle
If you have an audio-only

00:39:02.996 --> 00:39:04.056 A:middle
session, we're not really sure

00:39:04.056 --> 00:39:05.256 A:middle
what direction to direct the

00:39:05.256 --> 00:39:06.456 A:middle
audio, so we just give you an

00:39:06.456 --> 00:39:07.686 A:middle
omnidirectional field.

00:39:08.076 --> 00:39:10.216 A:middle
And as a power feature, you can

00:39:10.216 --> 00:39:11.666 A:middle
disable all of that by saying,

00:39:11.986 --> 00:39:13.656 A:middle
"Hands off AVCaptureSession, I

00:39:13.656 --> 00:39:14.666 A:middle
want to use my own

00:39:14.666 --> 00:39:16.546 A:middle
AVAudioSession and configure my

00:39:16.546 --> 00:39:18.306 A:middle
audio on my own," and we'll

00:39:18.306 --> 00:39:19.326 A:middle
honor that.

00:39:20.696 --> 00:39:22.326 A:middle
So now comes the time for

00:39:22.326 --> 00:39:23.566 A:middle
another dirty little secret.

00:39:26.436 --> 00:39:27.876 A:middle
There is no such thing as a

00:39:27.876 --> 00:39:28.186 A:middle
front mic.

00:39:28.186 --> 00:39:30.176 A:middle
I totally just lied to you.

00:39:31.176 --> 00:39:33.896 A:middle
In actuality, iPhones contain

00:39:33.896 --> 00:39:35.786 A:middle
arrays of microphones, and there

00:39:35.786 --> 00:39:36.886 A:middle
are different numbers depending

00:39:36.886 --> 00:39:37.706 A:middle
on the devices.

00:39:38.106 --> 00:39:39.186 A:middle
Recent iPhones happen to have

00:39:39.266 --> 00:39:39.816 A:middle
four.

00:39:39.816 --> 00:39:41.736 A:middle
iPads have five, and they are

00:39:41.736 --> 00:39:42.576 A:middle
positioned at different

00:39:42.626 --> 00:39:43.846 A:middle
strategic locations.

00:39:44.286 --> 00:39:45.676 A:middle
On recent iPhones, you happen to

00:39:45.676 --> 00:39:46.966 A:middle
have two that point straight out

00:39:46.966 --> 00:39:47.476 A:middle
the bottom.

00:39:47.746 --> 00:39:48.916 A:middle
And at the top, you have one

00:39:48.916 --> 00:39:50.026 A:middle
pointing out each side.

00:39:50.516 --> 00:39:51.916 A:middle
All of them are omnidirectional

00:39:51.916 --> 00:39:52.236 A:middle
mics.

00:39:52.776 --> 00:39:53.956 A:middle
Now, the top ones do get some

00:39:53.956 --> 00:39:55.386 A:middle
acoustic separation because

00:39:55.386 --> 00:39:56.856 A:middle
they've got the body of the

00:39:56.856 --> 00:39:58.066 A:middle
device in between them which

00:39:58.066 --> 00:39:59.766 A:middle
acts as a baffle, but it's still

00:39:59.766 --> 00:40:00.896 A:middle
not giving you a nice

00:39:59.766 --> 00:40:00.896 A:middle
not giving you a nice

00:40:00.896 --> 00:40:02.066 A:middle
directional pattern like you

00:40:02.066 --> 00:40:02.536 A:middle
would want.

00:40:03.336 --> 00:40:05.626 A:middle
So what do you do to actually

00:40:05.626 --> 00:40:07.116 A:middle
get something approximating a

00:40:07.116 --> 00:40:08.216 A:middle
front or back mic?

00:40:09.396 --> 00:40:10.906 A:middle
What you do is called microphone

00:40:11.066 --> 00:40:11.866 A:middle
beam forming.

00:40:12.356 --> 00:40:14.336 A:middle
And this is a way of processing

00:40:14.336 --> 00:40:16.176 A:middle
the raw audio signals to get

00:40:16.176 --> 00:40:17.326 A:middle
them to be directional.

00:40:17.646 --> 00:40:18.666 A:middle
And this is something that Core

00:40:18.666 --> 00:40:19.946 A:middle
Audio does on our behalf.

00:40:20.546 --> 00:40:22.686 A:middle
Here we've got two blue dots

00:40:22.686 --> 00:40:24.126 A:middle
which represent two microphones

00:40:24.126 --> 00:40:26.536 A:middle
on either side of an iPhone, and

00:40:26.536 --> 00:40:28.406 A:middle
the circles are roughly the

00:40:28.406 --> 00:40:29.586 A:middle
pattern of audio that they are

00:40:29.586 --> 00:40:29.966 A:middle
hearing.

00:40:29.966 --> 00:40:31.216 A:middle
Remember, they are both

00:40:31.216 --> 00:40:32.306 A:middle
omnidirectional mics.

00:40:32.546 --> 00:40:34.076 A:middle
If we take those two signals and

00:40:34.076 --> 00:40:35.806 A:middle
we just simply subtract them, we

00:40:35.806 --> 00:40:36.896 A:middle
wind up with a figure-eight

00:40:36.896 --> 00:40:38.296 A:middle
pattern, which is cool.

00:40:38.296 --> 00:40:39.556 A:middle
It's not what we want, but it's

00:40:39.556 --> 00:40:39.916 A:middle
cool.

00:40:41.046 --> 00:40:42.256 A:middle
If we want to further shape

00:40:42.256 --> 00:40:44.556 A:middle
that, we can add some gain to

00:40:44.556 --> 00:40:46.086 A:middle
the one that we want to keep

00:40:46.086 --> 00:40:47.666 A:middle
before subtracting them, and now

00:40:47.666 --> 00:40:49.046 A:middle
we wind up with a little Pac-Man

00:40:49.046 --> 00:40:50.496 A:middle
ghost, and that's good.

00:40:50.496 --> 00:40:51.626 A:middle
Now we've got rejection out the

00:40:51.626 --> 00:40:53.276 A:middle
side that we don't want, but

00:40:53.276 --> 00:40:54.416 A:middle
unfortunately, we've also

00:40:54.416 --> 00:40:55.706 A:middle
attenuated the signal, so it's

00:40:55.706 --> 00:40:57.396 A:middle
much quieter than we want.

00:40:58.676 --> 00:41:01.726 A:middle
But if after doing all that, we

00:40:58.676 --> 00:41:01.726 A:middle
But if after doing all that, we

00:41:01.726 --> 00:41:03.316 A:middle
apply some gain to that signal.

00:41:03.576 --> 00:41:04.816 A:middle
We get a nice, big Pac-Man

00:41:04.816 --> 00:41:06.036 A:middle
ghost, and now we've got that

00:41:06.066 --> 00:41:07.386 A:middle
beautiful cardioid pattern that

00:41:07.386 --> 00:41:09.546 A:middle
we want, which rejects out of

00:41:09.796 --> 00:41:11.136 A:middle
the side of the camera that we

00:41:11.136 --> 00:41:11.586 A:middle
don't want.

00:41:12.356 --> 00:41:14.136 A:middle
Now, this is extremely

00:41:14.136 --> 00:41:14.916 A:middle
oversimplified.

00:41:15.196 --> 00:41:16.306 A:middle
There's a lot of filtering going

00:41:16.306 --> 00:41:17.626 A:middle
on to ensure that white noise

00:41:17.626 --> 00:41:19.646 A:middle
isn't gained up, but essentially

00:41:19.646 --> 00:41:20.636 A:middle
that is what's happening.

00:41:20.996 --> 00:41:22.476 A:middle
And up to now, only one

00:41:22.476 --> 00:41:23.806 A:middle
microphone beam form has been

00:41:23.806 --> 00:41:24.776 A:middle
supported at a time.

00:41:25.176 --> 00:41:26.746 A:middle
But the good folks over in Core

00:41:26.746 --> 00:41:28.196 A:middle
Audio land did some great work

00:41:28.196 --> 00:41:30.536 A:middle
for this MultiCam feature, and

00:41:31.106 --> 00:41:33.296 A:middle
as of iOS 13, we now support

00:41:33.526 --> 00:41:35.436 A:middle
multiple simultaneous beam

00:41:35.436 --> 00:41:35.796 A:middle
forming.

00:41:36.516 --> 00:41:40.916 A:middle
[ Applause ]

00:41:41.416 --> 00:41:42.696 A:middle
So going back to the old

00:41:42.696 --> 00:41:43.716 A:middle
AVCaptureSession.

00:41:44.326 --> 00:41:46.146 A:middle
When you get a microphone device

00:41:46.146 --> 00:41:47.826 A:middle
input and you find its audio

00:41:47.906 --> 00:41:51.306 A:middle
port, that port lives many

00:41:51.306 --> 00:41:51.806 A:middle
lives.

00:41:51.806 --> 00:41:53.296 A:middle
It can be the front, back or

00:41:53.296 --> 00:41:54.776 A:middle
omni depending on what cameras

00:41:54.776 --> 00:41:55.726 A:middle
the session finds.

00:41:56.526 --> 00:41:57.246 A:middle
But when you're using the

00:41:57.246 --> 00:42:00.326 A:middle
MultiCamSession, the behavior is

00:41:57.246 --> 00:42:00.326 A:middle
MultiCamSession, the behavior is

00:42:00.746 --> 00:42:01.206 A:middle
rigid.

00:42:01.966 --> 00:42:04.506 A:middle
The first audio port you find is

00:42:04.506 --> 00:42:06.796 A:middle
always for omni, and then you

00:42:06.796 --> 00:42:08.596 A:middle
can find those secret ports that

00:42:08.596 --> 00:42:10.336 A:middle
I was talking about to get a

00:42:10.336 --> 00:42:12.416 A:middle
dedicated back beam or dedicated

00:42:12.416 --> 00:42:12.986 A:middle
front beam.

00:42:13.886 --> 00:42:16.826 A:middle
The way you do that is by using

00:42:17.286 --> 00:42:20.776 A:middle
those same device input port

00:42:20.776 --> 00:42:22.876 A:middle
getters, this time by specifying

00:42:22.876 --> 00:42:24.136 A:middle
which position you're interested

00:42:24.136 --> 00:42:24.286 A:middle
in.

00:42:24.816 --> 00:42:26.456 A:middle
So you can ask for the front

00:42:26.536 --> 00:42:27.936 A:middle
position or the back position,

00:42:28.106 --> 00:42:29.156 A:middle
and that will give you the ports

00:42:29.156 --> 00:42:30.336 A:middle
that you're interested in, and

00:42:30.336 --> 00:42:31.666 A:middle
you'll get a nice back or front

00:42:31.696 --> 00:42:32.136 A:middle
beam form.

00:42:34.216 --> 00:42:36.876 A:middle
Here is for the front, and here

00:42:36.876 --> 00:42:39.536 A:middle
is for the back.

00:42:39.536 --> 00:42:40.216 A:middle
Now, going back to the

00:42:40.216 --> 00:42:42.336 A:middle
MultiCamPIP demonstration we had

00:42:42.336 --> 00:42:44.556 A:middle
with Nik, we stuck to the video

00:42:44.556 --> 00:42:46.306 A:middle
side while we were showing you

00:42:46.556 --> 00:42:47.896 A:middle
the whizzy part of the graph.

00:42:47.896 --> 00:42:49.456 A:middle
Now I'm going to go back and

00:42:49.456 --> 00:42:50.226 A:middle
tell you what we were doing on

00:42:50.226 --> 00:42:50.986 A:middle
the audio side.

00:42:51.966 --> 00:42:55.446 A:middle
We were running all the time a

00:42:55.446 --> 00:42:57.526 A:middle
single device input with two

00:42:57.986 --> 00:42:59.256 A:middle
beam forms, one for the back and

00:42:59.256 --> 00:43:00.766 A:middle
one for the front, and we were

00:42:59.256 --> 00:43:00.766 A:middle
one for the front, and we were

00:43:00.766 --> 00:43:01.936 A:middle
running those to two different

00:43:02.026 --> 00:43:03.116 A:middle
audio data outputs.

00:43:03.456 --> 00:43:04.476 A:middle
This slide should say

00:43:04.476 --> 00:43:05.356 A:middle
AudioDataOutputs.

00:43:05.866 --> 00:43:07.416 A:middle
And then choosing between them

00:43:07.806 --> 00:43:08.606 A:middle
at runtime.

00:43:08.676 --> 00:43:10.656 A:middle
So depending on which is the

00:43:10.656 --> 00:43:12.296 A:middle
larger of the two, we would

00:43:12.296 --> 00:43:14.626 A:middle
switch to back or front and give

00:43:14.626 --> 00:43:15.906 A:middle
you the beam form that we

00:43:15.906 --> 00:43:16.326 A:middle
desired.

00:43:18.096 --> 00:43:19.466 A:middle
There are a couple rules to know

00:43:19.466 --> 00:43:21.396 A:middle
about multi-mic capture.

00:43:21.846 --> 00:43:23.186 A:middle
Beam-forming only works with

00:43:23.186 --> 00:43:23.956 A:middle
built-in mics.

00:43:23.956 --> 00:43:24.856 A:middle
If you've got something

00:43:24.856 --> 00:43:26.666 A:middle
external, USB, we don't know

00:43:26.666 --> 00:43:27.206 A:middle
what that is.

00:43:27.206 --> 00:43:28.316 A:middle
We don't know how to beam form

00:43:28.316 --> 00:43:29.206 A:middle
with it.

00:43:29.816 --> 00:43:31.426 A:middle
If you do happen to plug in

00:43:31.426 --> 00:43:32.696 A:middle
something else, including

00:43:32.696 --> 00:43:36.246 A:middle
AirPods, we will capture audio

00:43:36.246 --> 00:43:37.836 A:middle
of course, but we don't know how

00:43:37.836 --> 00:43:39.336 A:middle
to beam form, so we'll just pipe

00:43:39.336 --> 00:43:41.076 A:middle
that microphone through all of

00:43:41.076 --> 00:43:41.976 A:middle
the inputs that you have

00:43:42.026 --> 00:43:43.456 A:middle
connected, thus ensuring that

00:43:43.456 --> 00:43:43.976 A:middle
you don't lose the signal.

00:43:47.596 --> 00:43:48.716 A:middle
And that's the end of the

00:43:48.716 --> 00:43:50.786 A:middle
multi-camera capture part of

00:43:50.786 --> 00:43:52.196 A:middle
today's talk.

00:43:52.256 --> 00:43:53.386 A:middle
Let's do a quick summary.

00:43:54.956 --> 00:43:57.466 A:middle
MultiCam capture session is the

00:43:57.466 --> 00:43:59.966 A:middle
new way to do multiple cameras

00:43:59.966 --> 00:44:01.446 A:middle
simultaneously on iOS.

00:43:59.966 --> 00:44:01.446 A:middle
simultaneously on iOS.

00:44:02.516 --> 00:44:03.906 A:middle
It is a power tool, but it has

00:44:03.906 --> 00:44:04.786 A:middle
some limitations.

00:44:04.786 --> 00:44:05.256 A:middle
Know them.

00:44:06.716 --> 00:44:08.276 A:middle
And thoughtfully handle hardware

00:44:08.276 --> 00:44:10.376 A:middle
and system pressure costs as

00:44:10.376 --> 00:44:11.436 A:middle
you're doing your programming.

00:44:11.786 --> 00:44:14.116 A:middle
And if you want to do

00:44:14.116 --> 00:44:15.526 A:middle
synchronized streaming, use

00:44:15.526 --> 00:44:16.756 A:middle
those virtual devices with

00:44:16.756 --> 00:44:18.106 A:middle
constituent device ports.

00:44:19.006 --> 00:44:20.236 A:middle
And lastly, if you want to do

00:44:20.236 --> 00:44:21.896 A:middle
multi-mic capture, be aware that

00:44:21.896 --> 00:44:23.296 A:middle
you can use front or back beam

00:44:23.296 --> 00:44:24.156 A:middle
form or omni.

00:44:24.496 --> 00:44:24.976 A:middle
Thank you.

00:44:25.516 --> 00:44:28.500 A:middle
[ Applause ]
