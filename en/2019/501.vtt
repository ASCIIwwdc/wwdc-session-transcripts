WEBVTT

00:00:00.506 --> 00:00:03.500 A:middle
[ Music ]

00:00:08.596 --> 00:00:09.426 A:middle
&gt;&gt; All right.

00:00:10.026 --> 00:00:10.826 A:middle
Good morning, everyone.

00:00:12.896 --> 00:00:14.496 A:middle
My name is Jonathan Bennett and

00:00:14.496 --> 00:00:16.166 A:middle
I work with the Connected Media

00:00:16.166 --> 00:00:16.966 A:middle
team at Apple.

00:00:18.066 --> 00:00:19.416 A:middle
And I'm happy to be here today

00:00:19.416 --> 00:00:20.706 A:middle
helping kick off the conference,

00:00:20.706 --> 00:00:22.116 A:middle
talking with you about AirPlay.

00:00:22.956 --> 00:00:25.036 A:middle
So to start, let's talk about

00:00:25.466 --> 00:00:26.646 A:middle
what you can do with AirPlay.

00:00:28.636 --> 00:00:30.326 A:middle
You can use AirPlay to

00:00:30.326 --> 00:00:32.946 A:middle
wirelessly send a video to watch

00:00:32.946 --> 00:00:35.916 A:middle
on your TV or listen to music

00:00:35.916 --> 00:00:36.626 A:middle
throughout your home.

00:00:37.606 --> 00:00:41.086 A:middle
And you can also share pretty

00:00:41.176 --> 00:00:44.916 A:middle
much anything from your iOS or

00:00:44.916 --> 00:00:46.556 A:middle
macOS screen using AirPlay

00:00:46.666 --> 00:00:47.146 A:middle
Mirroring.

00:00:48.436 --> 00:00:49.766 A:middle
And so for today's talk, we're

00:00:49.766 --> 00:00:51.686 A:middle
going to focus on video and

00:00:51.966 --> 00:00:52.796 A:middle
we'll go over some of the

00:00:52.796 --> 00:00:55.756 A:middle
enhancements we've made to make

00:00:55.756 --> 00:00:58.106 A:middle
sure that you can find out about

00:00:58.106 --> 00:01:00.556 A:middle
all the great TV destinations

00:00:58.106 --> 00:01:00.556 A:middle
all the great TV destinations

00:01:00.636 --> 00:01:03.556 A:middle
and AirPlay experiences on

00:01:04.256 --> 00:01:05.866 A:middle
AirPlay sending devices.

00:01:09.536 --> 00:01:10.136 A:middle
So when it comes to

00:01:10.136 --> 00:01:13.166 A:middle
destinations, Apple TV used to

00:01:13.166 --> 00:01:14.086 A:middle
be the only way that you could

00:01:14.086 --> 00:01:15.836 A:middle
AirPlay a video to a TV, and

00:01:16.086 --> 00:01:17.336 A:middle
it's still a great choice for

00:01:17.336 --> 00:01:18.426 A:middle
many people.

00:01:18.886 --> 00:01:20.376 A:middle
And as you heard earlier this

00:01:20.376 --> 00:01:23.556 A:middle
year, we've been working with

00:01:23.666 --> 00:01:25.106 A:middle
some of the largest TV

00:01:25.106 --> 00:01:29.106 A:middle
manufacturers to build AirPlay

00:01:29.106 --> 00:01:31.856 A:middle
support directly into the TVs.

00:01:32.226 --> 00:01:33.956 A:middle
This dramatically increases the

00:01:33.956 --> 00:01:36.936 A:middle
choices people have on where

00:01:36.936 --> 00:01:38.396 A:middle
they can AirPlay their video to,

00:01:39.026 --> 00:01:41.126 A:middle
and it adds a huge number of TVs

00:01:41.586 --> 00:01:44.266 A:middle
that you can now take advantage

00:01:44.266 --> 00:01:44.466 A:middle
of.

00:01:47.496 --> 00:01:49.436 A:middle
So just look for this label on

00:01:49.436 --> 00:01:50.636 A:middle
the box and you'll know that it

00:01:50.636 --> 00:01:52.776 A:middle
supports AirPlay Mirroring,

00:01:53.186 --> 00:01:55.156 A:middle
multi-room music and, of course,

00:01:55.156 --> 00:01:55.576 A:middle
video.

00:01:56.146 --> 00:02:00.836 A:middle
And this is a high-quality video

00:01:56.146 --> 00:02:00.836 A:middle
And this is a high-quality video

00:02:00.836 --> 00:02:06.156 A:middle
experience with both Apple TV

00:02:06.156 --> 00:02:08.156 A:middle
and AirPlay capable TVs able to

00:02:08.156 --> 00:02:11.426 A:middle
support up to 4K HDR video with

00:02:11.426 --> 00:02:12.236 A:middle
a surround sound.

00:02:12.906 --> 00:02:15.976 A:middle
So those are some of the great

00:02:15.976 --> 00:02:17.796 A:middle
new additions that we've made to

00:02:17.796 --> 00:02:17.886 A:middle
TVs.

00:02:18.456 --> 00:02:20.296 A:middle
And when it comes to AirPlay

00:02:20.296 --> 00:02:22.726 A:middle
sending devices, I'd like to go

00:02:22.726 --> 00:02:23.656 A:middle
over some of the enhancements

00:02:23.656 --> 00:02:25.206 A:middle
we've made to iOS to make it

00:02:25.206 --> 00:02:26.456 A:middle
easier than ever for people to

00:02:26.456 --> 00:02:28.276 A:middle
get the content they love from

00:02:28.276 --> 00:02:31.806 A:middle
your app to the TV.

00:02:31.996 --> 00:02:34.426 A:middle
So first, your video app can now

00:02:34.426 --> 00:02:36.486 A:middle
sort TV destinations to the top

00:02:36.486 --> 00:02:38.266 A:middle
of the AirPlay list, making it

00:02:38.266 --> 00:02:41.166 A:middle
easier than ever to find the TV

00:02:41.166 --> 00:02:42.266 A:middle
you want to play a video on.

00:02:43.706 --> 00:02:45.966 A:middle
We've also made enhancements and

00:02:45.966 --> 00:02:47.286 A:middle
enriched the remote controls

00:02:47.286 --> 00:02:50.976 A:middle
available to allow people to

00:02:50.976 --> 00:02:53.316 A:middle
interact with your video quickly

00:02:53.316 --> 00:02:53.996 A:middle
and easily.

00:02:54.616 --> 00:02:57.246 A:middle
And we've also made improvements

00:02:57.246 --> 00:02:58.076 A:middle
to allow people to better

00:02:58.076 --> 00:02:59.816 A:middle
multitask on their iOS devices

00:02:59.816 --> 00:03:02.046 A:middle
so they can receive a phone call

00:02:59.816 --> 00:03:02.046 A:middle
so they can receive a phone call

00:03:02.046 --> 00:03:04.556 A:middle
or check out that cute video

00:03:04.556 --> 00:03:05.796 A:middle
that they just got from an

00:03:05.796 --> 00:03:07.786 A:middle
iMessage while your video

00:03:07.786 --> 00:03:09.066 A:middle
continues playing on the TV.

00:03:11.086 --> 00:03:13.566 A:middle
And lastly, iOS can now

00:03:13.566 --> 00:03:16.076 A:middle
intelligently suggest to TV to

00:03:16.076 --> 00:03:17.666 A:middle
AirPlay to using on-device

00:03:17.666 --> 00:03:18.006 A:middle
learning.

00:03:18.386 --> 00:03:19.806 A:middle
So I can just sit back on the

00:03:19.806 --> 00:03:21.566 A:middle
couch, launch your video app,

00:03:22.186 --> 00:03:23.436 A:middle
and just tap on my favorite show

00:03:23.436 --> 00:03:25.256 A:middle
and have it automatically show

00:03:25.256 --> 00:03:25.906 A:middle
on the TV.

00:03:26.566 --> 00:03:30.266 A:middle
With great new TV destinations

00:03:30.266 --> 00:03:31.316 A:middle
and all of these experience

00:03:31.316 --> 00:03:32.786 A:middle
improvements, now is the time to

00:03:32.786 --> 00:03:34.346 A:middle
make sure that your video apps

00:03:34.386 --> 00:03:35.536 A:middle
fully support AirPlay.

00:03:36.446 --> 00:03:37.896 A:middle
So I'd like to take the rest of

00:03:37.896 --> 00:03:40.486 A:middle
this talk to go over five key

00:03:40.486 --> 00:03:43.296 A:middle
areas that you can add this

00:03:43.296 --> 00:03:44.246 A:middle
great experience.

00:03:45.256 --> 00:03:47.156 A:middle
First, we'll make sure that you

00:03:47.156 --> 00:03:48.376 A:middle
have high-quality video

00:03:48.376 --> 00:03:49.696 A:middle
available for the TV.

00:03:51.376 --> 00:03:52.816 A:middle
Then we'll provide a way for

00:03:52.816 --> 00:03:54.096 A:middle
people to get that video onto

00:03:54.096 --> 00:03:55.716 A:middle
the TV using an in-app picker.

00:03:56.326 --> 00:03:59.676 A:middle
And once it's on the TV, we'll

00:03:59.676 --> 00:04:00.606 A:middle
make sure that people can

00:03:59.676 --> 00:04:00.606 A:middle
make sure that people can

00:04:00.606 --> 00:04:04.536 A:middle
control it and we'll make sure

00:04:04.536 --> 00:04:05.986 A:middle
that that video keeps on playing

00:04:06.936 --> 00:04:08.796 A:middle
while they use their iOS device

00:04:08.796 --> 00:04:09.476 A:middle
for other things.

00:04:10.096 --> 00:04:13.256 A:middle
And lastly, if you have an app

00:04:13.306 --> 00:04:15.836 A:middle
that plays primarily long-form

00:04:15.836 --> 00:04:18.786 A:middle
video like movies or TV, there

00:04:18.786 --> 00:04:19.805 A:middle
are some additional steps that

00:04:19.805 --> 00:04:20.796 A:middle
you should take to make sure

00:04:20.796 --> 00:04:22.966 A:middle
that your users benefit from

00:04:23.426 --> 00:04:25.356 A:middle
intelligent AirPlay Suggestions.

00:04:25.946 --> 00:04:29.986 A:middle
So let's start by talking about

00:04:30.256 --> 00:04:31.256 A:middle
high-quality video.

00:04:33.126 --> 00:04:35.466 A:middle
HTTP Live Streaming is a fast

00:04:35.466 --> 00:04:36.666 A:middle
and adaptive way to stream

00:04:36.726 --> 00:04:37.916 A:middle
high-quality video to any

00:04:37.916 --> 00:04:38.506 A:middle
device.

00:04:38.686 --> 00:04:40.926 A:middle
And you're likely already using

00:04:40.956 --> 00:04:43.476 A:middle
HLS to deliver video to your iOS

00:04:43.476 --> 00:04:43.886 A:middle
apps.

00:04:44.916 --> 00:04:46.256 A:middle
Now, some of you might be

00:04:46.256 --> 00:04:48.286 A:middle
curating your playlist to focus

00:04:48.286 --> 00:04:49.536 A:middle
on those type of devices.

00:04:50.266 --> 00:04:52.096 A:middle
So, an iPhone screen or an iPad

00:04:52.096 --> 00:04:52.576 A:middle
screen.

00:04:53.996 --> 00:04:55.796 A:middle
But remember at any time, a user

00:04:55.796 --> 00:04:57.656 A:middle
could take that video and want

00:04:57.656 --> 00:04:59.036 A:middle
to send it and AirPlay it to a

00:04:59.036 --> 00:04:59.656 A:middle
TV.

00:04:59.656 --> 00:05:00.696 A:middle
So it's important that you have

00:04:59.656 --> 00:05:00.696 A:middle
So it's important that you have

00:05:00.696 --> 00:05:02.376 A:middle
a full range of variants in your

00:05:02.376 --> 00:05:04.876 A:middle
playlist that are appropriate

00:05:05.246 --> 00:05:07.036 A:middle
for a TV, including variants

00:05:07.036 --> 00:05:10.196 A:middle
that support 4K, HDR and

00:05:10.196 --> 00:05:10.946 A:middle
surround sound.

00:05:12.656 --> 00:05:14.266 A:middle
Now, if in your playlist you

00:05:14.266 --> 00:05:15.966 A:middle
have multiple video codecs that

00:05:15.966 --> 00:05:17.626 A:middle
you use to encode your content,

00:05:18.226 --> 00:05:19.766 A:middle
be sure to also provide a full

00:05:19.766 --> 00:05:21.276 A:middle
range of variants for each video

00:05:21.276 --> 00:05:21.696 A:middle
codec.

00:05:22.426 --> 00:05:23.506 A:middle
This makes sure that your video

00:05:23.506 --> 00:05:25.386 A:middle
is fully supported on any device

00:05:25.386 --> 00:05:27.646 A:middle
it plays back on and it also

00:05:27.646 --> 00:05:29.166 A:middle
makes sure that the player can

00:05:29.246 --> 00:05:31.876 A:middle
transition smoothly between

00:05:31.876 --> 00:05:33.576 A:middle
variants using the same video

00:05:34.246 --> 00:05:34.406 A:middle
codec.

00:05:36.386 --> 00:05:37.856 A:middle
Now, one thing that I find

00:05:37.856 --> 00:05:40.536 A:middle
myself doing frequently is fast

00:05:40.536 --> 00:05:41.696 A:middle
forwarding or seeking through

00:05:41.696 --> 00:05:42.186 A:middle
video.

00:05:42.426 --> 00:05:46.656 A:middle
And whether that's to skip a

00:05:46.966 --> 00:05:48.676 A:middle
scary part of a movie with--

00:05:48.676 --> 00:05:49.986 A:middle
that I'm watching with my kids

00:05:49.986 --> 00:05:51.716 A:middle
or to find that interesting

00:05:51.716 --> 00:05:53.306 A:middle
topic in the middle of a WWDC

00:05:53.306 --> 00:05:57.386 A:middle
video having fast, rapid, frame

00:05:57.386 --> 00:05:59.716 A:middle
previews while seeking allows me

00:05:59.716 --> 00:06:01.886 A:middle
to find what I want quickly and

00:05:59.716 --> 00:06:01.886 A:middle
to find what I want quickly and

00:06:01.886 --> 00:06:02.476 A:middle
confidently.

00:06:03.296 --> 00:06:04.896 A:middle
So you can add the support in

00:06:04.896 --> 00:06:06.366 A:middle
your videos by including an

00:06:06.426 --> 00:06:09.446 A:middle
I-frame variant to your HLS

00:06:10.776 --> 00:06:11.046 A:middle
playlist.

00:06:11.606 --> 00:06:13.946 A:middle
And lastly, if you have

00:06:13.946 --> 00:06:15.426 A:middle
high-value content that you need

00:06:15.426 --> 00:06:16.566 A:middle
to protect and manage, you're

00:06:16.566 --> 00:06:18.196 A:middle
likely using FairPlay Streaming

00:06:18.196 --> 00:06:18.726 A:middle
to do that.

00:06:19.516 --> 00:06:21.106 A:middle
And FairPlay Streaming is fully

00:06:21.106 --> 00:06:22.866 A:middle
supported whenever and wherever

00:06:22.866 --> 00:06:24.626 A:middle
you AirPlay, that includes

00:06:24.626 --> 00:06:25.926 A:middle
AirPlaying to an Apple TV.

00:06:26.156 --> 00:06:28.296 A:middle
And I'm also happy to say that

00:06:28.296 --> 00:06:29.526 A:middle
FairPlay Streaming is supported

00:06:29.526 --> 00:06:31.506 A:middle
on every smart TV with built-in

00:06:31.506 --> 00:06:32.276 A:middle
AirPlay support.

00:06:32.806 --> 00:06:35.786 A:middle
Now, there are more details

00:06:35.786 --> 00:06:37.496 A:middle
about validating your HL streams

00:06:37.496 --> 00:06:38.706 A:middle
for AirPlay than we can cover

00:06:38.706 --> 00:06:40.336 A:middle
here today, so we've made a

00:06:40.336 --> 00:06:41.826 A:middle
separate video associated with

00:06:41.826 --> 00:06:43.196 A:middle
this session and I encourage you

00:06:43.196 --> 00:06:46.206 A:middle
to check that out.

00:06:46.806 --> 00:06:48.826 A:middle
So, having high-quality content

00:06:48.826 --> 00:06:50.266 A:middle
is great but we also want to

00:06:50.266 --> 00:06:51.606 A:middle
make sure that we have smooth

00:06:51.606 --> 00:06:52.296 A:middle
playback.

00:06:53.376 --> 00:06:56.366 A:middle
Now, if you have pre, mid or

00:06:56.366 --> 00:06:57.846 A:middle
post-roll content that you need

00:06:57.846 --> 00:07:00.686 A:middle
to insert into your video, use

00:06:57.846 --> 00:07:00.686 A:middle
to insert into your video, use

00:07:00.686 --> 00:07:02.256 A:middle
HLS's discontinuity tag to do

00:07:02.256 --> 00:07:02.896 A:middle
that.

00:07:03.226 --> 00:07:05.126 A:middle
This allows the player to remain

00:07:05.126 --> 00:07:06.486 A:middle
intact and the estimated

00:07:06.486 --> 00:07:07.816 A:middle
bandwidths to remain intact so

00:07:07.816 --> 00:07:09.086 A:middle
both your interstitial video

00:07:09.086 --> 00:07:10.086 A:middle
plays in high quality.

00:07:10.486 --> 00:07:11.646 A:middle
And when it ends and you resume

00:07:11.646 --> 00:07:13.176 A:middle
the main content, that content

00:07:13.176 --> 00:07:15.196 A:middle
can immediately begin in high

00:07:15.196 --> 00:07:15.736 A:middle
quality.

00:07:16.356 --> 00:07:19.406 A:middle
It's, again, important to make

00:07:19.406 --> 00:07:20.536 A:middle
sure that these interstitial

00:07:20.536 --> 00:07:21.656 A:middle
videos have the same video

00:07:21.656 --> 00:07:23.366 A:middle
formatting as the main content,

00:07:23.846 --> 00:07:25.316 A:middle
such as the same video codec and

00:07:25.316 --> 00:07:26.556 A:middle
this allows these transitions to

00:07:26.556 --> 00:07:30.026 A:middle
happen quickly and smoothly.

00:07:30.166 --> 00:07:32.146 A:middle
Now, if you can't use HLS

00:07:32.146 --> 00:07:33.286 A:middle
discontinuity tag for some

00:07:33.286 --> 00:07:34.766 A:middle
reason or you have multiple

00:07:34.766 --> 00:07:36.056 A:middle
pieces of content that you want

00:07:36.056 --> 00:07:38.436 A:middle
to play serially, we encourage

00:07:38.436 --> 00:07:39.816 A:middle
you to use AVQueuePlayer when

00:07:39.816 --> 00:07:40.366 A:middle
AirPlaying.

00:07:43.006 --> 00:07:45.276 A:middle
And if you can't use

00:07:45.276 --> 00:07:47.286 A:middle
AVQueuePlayer when AirPlaying,

00:07:47.286 --> 00:07:49.166 A:middle
please use the same AVPlayer

00:07:49.166 --> 00:07:51.316 A:middle
instance and just replace the

00:07:51.316 --> 00:07:52.326 A:middle
current item with your new

00:07:52.326 --> 00:07:52.856 A:middle
content.

00:07:53.216 --> 00:07:55.286 A:middle
You don't want to destroy an

00:07:55.286 --> 00:07:56.756 A:middle
AVPlayer and create a new one

00:07:57.066 --> 00:07:58.976 A:middle
for every piece of video or swap

00:07:58.976 --> 00:08:01.026 A:middle
between instances, because when

00:07:58.976 --> 00:08:01.026 A:middle
between instances, because when

00:08:01.026 --> 00:08:02.536 A:middle
AirPlaying, the system doesn't

00:08:02.536 --> 00:08:03.966 A:middle
know that a new piece of video

00:08:03.966 --> 00:08:04.916 A:middle
is going to be arriving.

00:08:05.206 --> 00:08:06.876 A:middle
And so it might start tearing

00:08:06.876 --> 00:08:07.976 A:middle
down the engine and you don't

00:08:08.516 --> 00:08:09.746 A:middle
want to introduce this type of

00:08:09.746 --> 00:08:10.846 A:middle
delay just because you're

00:08:10.846 --> 00:08:12.346 A:middle
transitioning between videos.

00:08:14.896 --> 00:08:17.036 A:middle
All right, we've got

00:08:17.226 --> 00:08:18.296 A:middle
high-quality content.

00:08:18.386 --> 00:08:20.176 A:middle
Now, let's give a way for people

00:08:20.176 --> 00:08:21.426 A:middle
to get that to the TV.

00:08:22.676 --> 00:08:24.056 A:middle
And you can do that by adding an

00:08:24.056 --> 00:08:25.446 A:middle
AirPlay picker into your app.

00:08:26.506 --> 00:08:28.076 A:middle
And new in iOS 13, you can

00:08:28.076 --> 00:08:29.586 A:middle
decide how you want to order

00:08:29.736 --> 00:08:30.856 A:middle
those destinations.

00:08:31.446 --> 00:08:35.366 A:middle
To add an AirPlay picker, use

00:08:35.366 --> 00:08:36.385 A:middle
AVRoutePickerView.

00:08:36.576 --> 00:08:38.256 A:middle
It's been available since iOS 11

00:08:38.785 --> 00:08:40.836 A:middle
and it's now available on macOS.

00:08:42.306 --> 00:08:43.566 A:middle
Now, some of you might be using

00:08:43.635 --> 00:08:45.286 A:middle
MPVolumeView's route button

00:08:45.286 --> 00:08:47.176 A:middle
properties to get a picker in

00:08:47.176 --> 00:08:47.476 A:middle
your app.

00:08:47.926 --> 00:08:50.906 A:middle
And in iOS 13, the route button

00:08:50.906 --> 00:08:52.546 A:middle
properties are now deprecated.

00:08:54.196 --> 00:08:55.346 A:middle
Now, don't worry, you can still

00:08:55.346 --> 00:08:58.266 A:middle
use MPVolumeView for putting

00:08:58.266 --> 00:08:59.796 A:middle
volume UI into your app.

00:08:59.956 --> 00:09:00.736 A:middle
But when it comes to route

00:08:59.956 --> 00:09:00.736 A:middle
But when it comes to route

00:09:00.736 --> 00:09:02.766 A:middle
buttons, use RoutePickerView.

00:09:08.496 --> 00:09:11.976 A:middle
So let's see how you can add

00:09:11.976 --> 00:09:13.816 A:middle
that, and it's really simple.

00:09:14.436 --> 00:09:16.566 A:middle
All I have to do is create a

00:09:16.566 --> 00:09:17.876 A:middle
AVRoutePickerView and add it to

00:09:17.876 --> 00:09:18.686 A:middle
my view hierarchy.

00:09:20.376 --> 00:09:23.236 A:middle
And in iOS 13, I can set

00:09:23.236 --> 00:09:25.166 A:middle
prioritizesVideoDevices to true

00:09:25.646 --> 00:09:28.996 A:middle
and that will give me a route

00:09:28.996 --> 00:09:31.516 A:middle
button icon that is focused on

00:09:31.516 --> 00:09:33.176 A:middle
video with the AirPlay video

00:09:33.176 --> 00:09:36.056 A:middle
logo, and it also sorts those TV

00:09:36.056 --> 00:09:37.296 A:middle
destinations to the top making

00:09:37.296 --> 00:09:39.366 A:middle
it super easy to find that TV I

00:09:39.366 --> 00:09:40.756 A:middle
want to play to.

00:09:44.436 --> 00:09:46.536 A:middle
So now that I have video playing

00:09:46.536 --> 00:09:48.636 A:middle
on the TV, let's make sure that

00:09:48.676 --> 00:09:49.836 A:middle
people have a way to control it

00:09:49.836 --> 00:09:51.036 A:middle
and this is really important.

00:09:51.036 --> 00:09:52.166 A:middle
And so we've made sure that

00:09:52.166 --> 00:09:53.626 A:middle
remote controls are more

00:09:53.626 --> 00:09:55.426 A:middle
convenient and capable than ever

00:09:55.616 --> 00:09:56.526 A:middle
throughout the system.

00:09:57.716 --> 00:09:59.556 A:middle
For example, I can control my

00:09:59.556 --> 00:10:02.236 A:middle
video with lock screen controls

00:09:59.556 --> 00:10:02.236 A:middle
video with lock screen controls

00:10:02.236 --> 00:10:03.426 A:middle
and we've added additional

00:10:03.426 --> 00:10:04.346 A:middle
capabilities when you've

00:10:04.346 --> 00:10:06.876 A:middle
targeted a TV.

00:10:07.046 --> 00:10:09.186 A:middle
I can also use Siri and issue

00:10:09.186 --> 00:10:10.906 A:middle
play commands and say, you know,

00:10:10.906 --> 00:10:12.276 A:middle
play this on my TV.

00:10:16.666 --> 00:10:18.816 A:middle
And it's not just about

00:10:18.816 --> 00:10:20.746 A:middle
controlling what's on your iOS

00:10:20.746 --> 00:10:22.306 A:middle
device but also the devices

00:10:22.306 --> 00:10:22.886 A:middle
around you.

00:10:23.536 --> 00:10:24.576 A:middle
For example, you can pull down

00:10:24.576 --> 00:10:25.846 A:middle
Control Center and you can

00:10:25.846 --> 00:10:27.296 A:middle
target HomePods that are playing

00:10:27.296 --> 00:10:29.086 A:middle
music throughout your home or

00:10:29.086 --> 00:10:30.806 A:middle
even a tvOS app that is playing

00:10:30.806 --> 00:10:32.136 A:middle
a video and I can see what's

00:10:32.136 --> 00:10:33.606 A:middle
playing and control it from

00:10:33.606 --> 00:10:34.686 A:middle
almost any device.

00:10:39.136 --> 00:10:41.216 A:middle
So, what happens if your app

00:10:41.216 --> 00:10:42.896 A:middle
doesn't support remote controls?

00:10:42.896 --> 00:10:44.216 A:middle
Well, here I have my app and

00:10:44.216 --> 00:10:45.566 A:middle
it's AirPlaying to the TV.

00:10:46.006 --> 00:10:48.276 A:middle
But if I were to lock the

00:10:48.276 --> 00:10:49.826 A:middle
screen, I wouldn't know that the

00:10:49.826 --> 00:10:51.066 A:middle
video is playing and, more

00:10:51.066 --> 00:10:52.306 A:middle
importantly, I would have no way

00:10:52.306 --> 00:10:53.546 A:middle
to interact with that video.

00:10:55.846 --> 00:10:56.866 A:middle
So by supporting remote

00:10:56.866 --> 00:10:59.616 A:middle
controls, you can know what's

00:10:59.616 --> 00:11:02.816 A:middle
playing, how far along I am in

00:10:59.616 --> 00:11:02.816 A:middle
playing, how far along I am in

00:11:02.816 --> 00:11:05.476 A:middle
that video, a great way to

00:11:05.476 --> 00:11:07.646 A:middle
interact with it quickly, and

00:11:07.996 --> 00:11:09.336 A:middle
then there's even a way to get

00:11:09.336 --> 00:11:10.616 A:middle
back to the app that's currently

00:11:10.616 --> 00:11:12.096 A:middle
playing that video by just

00:11:12.096 --> 00:11:14.546 A:middle
tapping the artwork or the

00:11:15.116 --> 00:11:15.316 A:middle
title.

00:11:15.416 --> 00:11:18.246 A:middle
So, let's go through how you can

00:11:18.246 --> 00:11:19.416 A:middle
add these remote controls in

00:11:19.416 --> 00:11:20.836 A:middle
your app and it starts with

00:11:20.836 --> 00:11:24.076 A:middle
becoming the Now Playing app.

00:11:24.336 --> 00:11:25.716 A:middle
You become the Now Playing app

00:11:25.716 --> 00:11:27.306 A:middle
by doing two things, one is to

00:11:27.306 --> 00:11:28.886 A:middle
at least support one remote

00:11:28.886 --> 00:11:30.736 A:middle
control command and the other is

00:11:30.736 --> 00:11:32.046 A:middle
to initiate playback with

00:11:32.046 --> 00:11:33.316 A:middle
immediate configuration.

00:11:34.696 --> 00:11:36.356 A:middle
And on iOS, that means

00:11:36.356 --> 00:11:38.056 A:middle
activating your audio session

00:11:38.056 --> 00:11:40.066 A:middle
with a non-mixable category.

00:11:40.246 --> 00:11:41.506 A:middle
And for most video apps, that's

00:11:41.506 --> 00:11:42.286 A:middle
going to be the playback

00:11:42.286 --> 00:11:42.856 A:middle
category.

00:11:43.476 --> 00:11:47.006 A:middle
On macOS and iOS code running on

00:11:47.006 --> 00:11:48.656 A:middle
macOS, you'll do something

00:11:48.656 --> 00:11:49.896 A:middle
slightly different.

00:11:49.896 --> 00:11:51.476 A:middle
You're going to grab the

00:11:51.476 --> 00:11:53.856 A:middle
MPNowPlayingInfoCenter and

00:11:54.486 --> 00:11:55.606 A:middle
change the playback state

00:11:55.606 --> 00:11:57.956 A:middle
whenever you start or end your

00:11:57.956 --> 00:11:59.086 A:middle
video experience.

00:11:59.606 --> 00:12:03.286 A:middle
When it comes to supporting

00:11:59.606 --> 00:12:03.286 A:middle
When it comes to supporting

00:12:03.286 --> 00:12:04.986 A:middle
remote controls, if you're using

00:12:04.986 --> 00:12:06.896 A:middle
AVKit's AVPlayerViewController

00:12:06.896 --> 00:12:08.096 A:middle
to present your video, it

00:12:08.406 --> 00:12:09.956 A:middle
handles remote controls for you

00:12:10.016 --> 00:12:11.706 A:middle
so you're all set.

00:12:13.256 --> 00:12:15.336 A:middle
If you're using AVFoundation and

00:12:15.336 --> 00:12:16.736 A:middle
a custom UI to present your

00:12:16.736 --> 00:12:18.766 A:middle
video, you'll need to use

00:12:18.766 --> 00:12:19.846 A:middle
MPRemoteCommandCenter and

00:12:19.926 --> 00:12:21.756 A:middle
MPNowPlayingInfoCenter in order

00:12:21.756 --> 00:12:23.146 A:middle
to get equivalent functionality.

00:12:23.596 --> 00:12:24.906 A:middle
And so I'd like to spend some

00:12:24.976 --> 00:12:26.296 A:middle
time going through step by step

00:12:26.296 --> 00:12:27.816 A:middle
about how you use this media

00:12:27.816 --> 00:12:30.256 A:middle
player APIs and build out this

00:12:30.256 --> 00:12:31.006 A:middle
functionality.

00:12:31.616 --> 00:12:34.416 A:middle
So here I am back at my lonely

00:12:34.416 --> 00:12:37.216 A:middle
lock screen, and let's just add

00:12:37.216 --> 00:12:39.156 A:middle
some basic support by supporting

00:12:39.156 --> 00:12:39.896 A:middle
the play command.

00:12:40.526 --> 00:12:43.856 A:middle
I can do that by creating a

00:12:43.856 --> 00:12:45.396 A:middle
setup method for supporting

00:12:45.396 --> 00:12:46.286 A:middle
remote controls.

00:12:46.906 --> 00:12:48.166 A:middle
And we'll be coming back to this

00:12:48.166 --> 00:12:49.316 A:middle
method again and again as we

00:12:49.316 --> 00:12:50.196 A:middle
continue to build out our

00:12:50.196 --> 00:12:50.816 A:middle
support.

00:12:51.346 --> 00:12:54.256 A:middle
I first grab the shared instance

00:12:54.256 --> 00:12:55.256 A:middle
of the remote command center.

00:12:55.916 --> 00:12:58.596 A:middle
And the remote command center

00:12:58.896 --> 00:13:00.456 A:middle
supports many different types of

00:12:58.896 --> 00:13:00.456 A:middle
supports many different types of

00:13:00.676 --> 00:13:01.516 A:middle
media commands.

00:13:02.096 --> 00:13:03.346 A:middle
Here, we're supporting the play

00:13:03.346 --> 00:13:03.826 A:middle
command.

00:13:03.996 --> 00:13:05.596 A:middle
And to that, we'll add a target

00:13:05.596 --> 00:13:07.606 A:middle
handler to receive that command

00:13:07.606 --> 00:13:08.686 A:middle
and do something with it.

00:13:09.306 --> 00:13:10.616 A:middle
So here, we'll start our

00:13:10.616 --> 00:13:10.936 A:middle
playback.

00:13:10.936 --> 00:13:14.096 A:middle
And once I've done that, I'll

00:13:14.096 --> 00:13:15.966 A:middle
return a status on whether that

00:13:15.966 --> 00:13:17.346 A:middle
command succeeded or failed.

00:13:18.266 --> 00:13:19.966 A:middle
And this is the basic structure

00:13:19.966 --> 00:13:20.976 A:middle
you're going to use for any

00:13:20.976 --> 00:13:22.276 A:middle
remote command that you support.

00:13:22.846 --> 00:13:25.936 A:middle
So to flash out our playback

00:13:25.936 --> 00:13:28.106 A:middle
command handling, we'll support

00:13:28.106 --> 00:13:29.446 A:middle
the pause command and the

00:13:29.446 --> 00:13:31.176 A:middle
togglePlayPauseCommand by adding

00:13:31.176 --> 00:13:32.216 A:middle
handlers for those.

00:13:32.786 --> 00:13:36.496 A:middle
So this got me a platter with a

00:13:36.496 --> 00:13:38.926 A:middle
play/pause button and I at least

00:13:38.926 --> 00:13:40.236 A:middle
know what app is playing, but

00:13:40.236 --> 00:13:41.916 A:middle
it'd be really great to know

00:13:42.176 --> 00:13:43.236 A:middle
what video is playing.

00:13:43.856 --> 00:13:46.656 A:middle
And you can do that by providing

00:13:46.656 --> 00:13:47.846 A:middle
Now Playing info.

00:13:49.026 --> 00:13:50.296 A:middle
And Now Playing info comes in

00:13:50.296 --> 00:13:53.266 A:middle
two parts, one is the item

00:13:53.266 --> 00:13:54.616 A:middle
metadata such as the artwork or

00:13:54.616 --> 00:13:56.896 A:middle
title and then the playback

00:13:56.896 --> 00:13:58.326 A:middle
state such as the duration and

00:13:58.326 --> 00:13:59.926 A:middle
the current elapsed time.

00:14:00.366 --> 00:14:02.056 A:middle
So in my code, there are two

00:14:02.056 --> 00:14:03.706 A:middle
major events where I'll want to

00:14:03.706 --> 00:14:04.576 A:middle
update this information.

00:14:05.196 --> 00:14:07.486 A:middle
One is when a item changes, so

00:14:07.486 --> 00:14:09.336 A:middle
going from episode one to

00:14:09.336 --> 00:14:10.936 A:middle
episode two.

00:14:12.296 --> 00:14:14.016 A:middle
The other is when I have a

00:14:14.016 --> 00:14:15.736 A:middle
current item and the playback

00:14:15.736 --> 00:14:17.346 A:middle
state changes so I-- my rate

00:14:17.346 --> 00:14:20.166 A:middle
changes or I seek to a new

00:14:20.166 --> 00:14:21.256 A:middle
position in the video.

00:14:21.886 --> 00:14:26.686 A:middle
So when an item changes, I'm

00:14:26.686 --> 00:14:28.466 A:middle
going to take a metadata that

00:14:28.466 --> 00:14:30.336 A:middle
I've packaged up in my app with

00:14:30.336 --> 00:14:31.906 A:middle
a structure just to pass it

00:14:31.906 --> 00:14:33.776 A:middle
around through my app, I'm going

00:14:33.776 --> 00:14:34.986 A:middle
to update that static Now

00:14:34.986 --> 00:14:36.686 A:middle
Playing info such as the title

00:14:36.686 --> 00:14:37.366 A:middle
and the artwork.

00:14:38.206 --> 00:14:41.436 A:middle
And if I have it, I'm going to

00:14:41.646 --> 00:14:43.696 A:middle
update the playback info at this

00:14:43.696 --> 00:14:44.616 A:middle
time as well.

00:14:45.926 --> 00:14:47.056 A:middle
Now, when a playback state

00:14:47.056 --> 00:14:50.416 A:middle
change happens, all I need to do

00:14:50.416 --> 00:14:51.846 A:middle
is update that playback info.

00:14:51.846 --> 00:14:54.496 A:middle
I don't need to update artwork

00:14:54.496 --> 00:14:56.446 A:middle
and spend time doing all of

00:14:57.216 --> 00:14:57.326 A:middle
that.

00:14:57.446 --> 00:14:58.846 A:middle
So let's see how you can update

00:14:58.846 --> 00:14:59.806 A:middle
some of this information.

00:15:00.366 --> 00:15:02.806 A:middle
And the first thing I'm going to

00:15:02.806 --> 00:15:04.296 A:middle
do is grab the Now Playing info

00:15:04.296 --> 00:15:06.496 A:middle
dictionary from the shared info

00:15:06.496 --> 00:15:06.956 A:middle
center.

00:15:07.546 --> 00:15:11.036 A:middle
And to this dictionary, I'm

00:15:11.036 --> 00:15:12.296 A:middle
going to update my metadata.

00:15:12.296 --> 00:15:13.866 A:middle
So here, I'm updating title and

00:15:13.866 --> 00:15:14.396 A:middle
artwork.

00:15:14.676 --> 00:15:16.016 A:middle
And there are many other types

00:15:16.016 --> 00:15:17.276 A:middle
of metadata that are supported

00:15:17.276 --> 00:15:18.576 A:middle
and that I might support in my

00:15:18.576 --> 00:15:18.826 A:middle
app.

00:15:19.756 --> 00:15:21.266 A:middle
Regardless of what I support,

00:15:21.266 --> 00:15:23.426 A:middle
it's important to update this

00:15:23.426 --> 00:15:25.216 A:middle
metadata or clear it out, nil it

00:15:25.216 --> 00:15:28.206 A:middle
out if a particular item doesn't

00:15:28.206 --> 00:15:29.826 A:middle
have that type of property.

00:15:30.636 --> 00:15:32.866 A:middle
You don't want a mix of old and

00:15:32.866 --> 00:15:35.206 A:middle
new metadata in the dictionary.

00:15:35.766 --> 00:15:38.606 A:middle
Once I've updated it, though, I

00:15:38.606 --> 00:15:39.996 A:middle
just pass it back to the info

00:15:39.996 --> 00:15:41.126 A:middle
center for presentation.

00:15:41.746 --> 00:15:46.816 A:middle
So, it's really simple to update

00:15:47.106 --> 00:15:48.276 A:middle
Now Playing information.

00:15:48.446 --> 00:15:49.936 A:middle
And now, let's see how we update

00:15:49.936 --> 00:15:50.896 A:middle
the playback info.

00:15:51.956 --> 00:15:53.496 A:middle
And it's done very similarly.

00:15:53.496 --> 00:15:54.836 A:middle
I grab the Now Playing

00:15:54.836 --> 00:15:56.466 A:middle
information, the info

00:15:56.466 --> 00:15:58.366 A:middle
dictionary, and to that, I'm

00:15:58.366 --> 00:15:59.906 A:middle
going to update the duration,

00:15:59.906 --> 00:16:01.376 A:middle
the elapse playback time, and

00:15:59.906 --> 00:16:01.376 A:middle
the elapse playback time, and

00:16:01.376 --> 00:16:02.076 A:middle
the playback rate.

00:16:03.256 --> 00:16:05.846 A:middle
And now, I only need to update

00:16:05.846 --> 00:16:07.106 A:middle
this on significant change

00:16:07.106 --> 00:16:07.356 A:middle
events.

00:16:07.356 --> 00:16:08.326 A:middle
I don't need to update this

00:16:08.326 --> 00:16:10.006 A:middle
every second to see progress

00:16:10.136 --> 00:16:10.886 A:middle
through the remote UIs.

00:16:10.886 --> 00:16:12.906 A:middle
As long as I update these three

00:16:12.966 --> 00:16:15.216 A:middle
items when a rate changes or I

00:16:15.216 --> 00:16:16.776 A:middle
have a significant jump, then

00:16:16.776 --> 00:16:18.816 A:middle
the system can infer where you

00:16:18.816 --> 00:16:20.206 A:middle
are in your video at any given

00:16:20.206 --> 00:16:22.236 A:middle
moment and update the remote UIs

00:16:22.236 --> 00:16:22.816 A:middle
accordingly.

00:16:23.406 --> 00:16:25.836 A:middle
And again, once I've updated

00:16:25.836 --> 00:16:26.916 A:middle
this, I'll just pass it back to

00:16:26.916 --> 00:16:29.206 A:middle
the info center to get

00:16:30.276 --> 00:16:30.586 A:middle
presented.

00:16:31.006 --> 00:16:32.686 A:middle
So I know what video is playing

00:16:32.686 --> 00:16:34.216 A:middle
and it's really nice to be able

00:16:34.216 --> 00:16:36.506 A:middle
to navigate through that video.

00:16:37.156 --> 00:16:39.096 A:middle
So you can add the support for a

00:16:39.096 --> 00:16:41.406 A:middle
seeking with a playhead scrubber

00:16:42.726 --> 00:16:44.206 A:middle
or skipping forward and backward

00:16:44.706 --> 00:16:45.386 A:middle
in your video.

00:16:45.446 --> 00:16:47.666 A:middle
So let's see how we do this.

00:16:48.976 --> 00:16:50.606 A:middle
So we're back in our method for

00:16:50.606 --> 00:16:51.786 A:middle
setting up remote control

00:16:51.786 --> 00:16:52.326 A:middle
commands.

00:16:52.616 --> 00:16:55.046 A:middle
And I'm going to add support for

00:16:55.046 --> 00:16:56.186 A:middle
the skip forward command.

00:16:56.816 --> 00:16:58.386 A:middle
And this is one of the commands

00:16:58.386 --> 00:16:59.206 A:middle
that supports additional

00:16:59.206 --> 00:17:01.016 A:middle
configuration, and here, I'm

00:16:59.206 --> 00:17:01.016 A:middle
configuration, and here, I'm

00:17:01.016 --> 00:17:02.026 A:middle
setting the preferred skip

00:17:02.026 --> 00:17:03.746 A:middle
interval to 15 seconds.

00:17:04.526 --> 00:17:07.576 A:middle
I then add a handler for that

00:17:07.576 --> 00:17:08.046 A:middle
command.

00:17:09.506 --> 00:17:10.796 A:middle
And it's important to note here

00:17:10.796 --> 00:17:12.646 A:middle
that I'm using the interval

00:17:12.646 --> 00:17:13.556 A:middle
that's passed to me through the

00:17:13.556 --> 00:17:14.396 A:middle
commands event.

00:17:15.195 --> 00:17:16.366 A:middle
Just because I set a preferred

00:17:16.366 --> 00:17:17.226 A:middle
interval doesn't mean that's

00:17:17.226 --> 00:17:18.455 A:middle
going to be used every time.

00:17:18.786 --> 00:17:20.816 A:middle
For example, I could ask Siri to

00:17:20.816 --> 00:17:23.036 A:middle
jump forward by 42 seconds.

00:17:23.106 --> 00:17:24.175 A:middle
And that's the value that's

00:17:24.175 --> 00:17:25.326 A:middle
going to get passed to me and

00:17:25.326 --> 00:17:26.356 A:middle
the one that I should honor.

00:17:26.976 --> 00:17:30.446 A:middle
I'll then round out my support

00:17:30.626 --> 00:17:32.576 A:middle
by supporting the skip backward

00:17:32.576 --> 00:17:34.576 A:middle
command and the change playback

00:17:34.576 --> 00:17:35.966 A:middle
position command which is used

00:17:35.966 --> 00:17:36.616 A:middle
when seeking.

00:17:37.206 --> 00:17:41.266 A:middle
Now, for some apps and some

00:17:41.266 --> 00:17:42.396 A:middle
types of video, you might need

00:17:42.396 --> 00:17:43.586 A:middle
to temporarily disable

00:17:43.586 --> 00:17:45.636 A:middle
navigation and you can easily do

00:17:45.636 --> 00:17:47.076 A:middle
that by setting the isEnabled

00:17:47.076 --> 00:17:48.646 A:middle
property on the commands that

00:17:48.646 --> 00:17:49.526 A:middle
you need to disable.

00:17:49.966 --> 00:17:50.856 A:middle
You don't need to remove the

00:17:50.856 --> 00:17:55.286 A:middle
target handler and add it back.

00:17:56.066 --> 00:17:58.046 A:middle
So one thing new this year that

00:17:58.046 --> 00:17:59.406 A:middle
we've added to remote control

00:17:59.406 --> 00:18:01.866 A:middle
UIs is the ability to select and

00:17:59.406 --> 00:18:01.866 A:middle
UIs is the ability to select and

00:18:01.866 --> 00:18:03.496 A:middle
change audio languages and

00:18:03.496 --> 00:18:04.246 A:middle
subtitles.

00:18:04.446 --> 00:18:06.456 A:middle
So if you have video with these

00:18:06.456 --> 00:18:08.326 A:middle
types of options, you're going

00:18:08.326 --> 00:18:09.316 A:middle
to want to add this type of

00:18:09.316 --> 00:18:11.866 A:middle
support for remote controlling.

00:18:12.296 --> 00:18:14.746 A:middle
This allows people to watch the

00:18:14.746 --> 00:18:19.636 A:middle
video the way they want and need

00:18:19.636 --> 00:18:20.236 A:middle
easily.

00:18:20.836 --> 00:18:22.766 A:middle
So you can add this support by

00:18:22.766 --> 00:18:25.096 A:middle
providing a list of audible and

00:18:25.096 --> 00:18:28.206 A:middle
legible language options that

00:18:28.206 --> 00:18:29.406 A:middle
represent the audio languages

00:18:29.406 --> 00:18:30.196 A:middle
and subtitles.

00:18:30.746 --> 00:18:32.366 A:middle
And you can also then identify

00:18:32.366 --> 00:18:33.376 A:middle
the current selections in each

00:18:33.376 --> 00:18:34.176 A:middle
of those groups.

00:18:34.736 --> 00:18:35.986 A:middle
And lastly, you're going to want

00:18:35.986 --> 00:18:37.316 A:middle
to handle changes to those

00:18:37.316 --> 00:18:39.156 A:middle
selections via the remote UIs.

00:18:39.466 --> 00:18:42.706 A:middle
So let's see how we provide this

00:18:42.706 --> 00:18:43.236 A:middle
information.

00:18:43.836 --> 00:18:46.396 A:middle
And it starts by creating a

00:18:46.396 --> 00:18:46.886 A:middle
mapping.

00:18:47.076 --> 00:18:49.466 A:middle
So I'm going to load the audible

00:18:49.466 --> 00:18:52.876 A:middle
and legible language groups from

00:18:52.986 --> 00:18:54.006 A:middle
my AVAsset.

00:18:54.006 --> 00:18:55.696 A:middle
And I'm going to create a

00:18:55.696 --> 00:18:57.906 A:middle
mapping of these by translating

00:18:57.906 --> 00:18:59.406 A:middle
them into the media player

00:18:59.856 --> 00:19:02.466 A:middle
objects that represent these

00:18:59.856 --> 00:19:02.466 A:middle
objects that represent these

00:19:02.466 --> 00:19:03.186 A:middle
options.

00:19:03.286 --> 00:19:04.296 A:middle
And I can use convenience

00:19:04.296 --> 00:19:05.196 A:middle
functions to do that.

00:19:05.196 --> 00:19:07.406 A:middle
And I'll maintain this mapping

00:19:07.776 --> 00:19:10.286 A:middle
in my app so that when I receive

00:19:10.286 --> 00:19:11.466 A:middle
a language option from a remote

00:19:11.466 --> 00:19:12.476 A:middle
command, I can eventually

00:19:12.476 --> 00:19:13.636 A:middle
translate it into the

00:19:13.636 --> 00:19:15.656 A:middle
AVFoundation object and set it

00:19:15.656 --> 00:19:17.446 A:middle
on my AVPlayer item to change

00:19:17.446 --> 00:19:18.166 A:middle
the selection.

00:19:19.596 --> 00:19:22.056 A:middle
So once I have this mapping, I

00:19:22.056 --> 00:19:23.246 A:middle
can update that info.

00:19:23.746 --> 00:19:25.626 A:middle
And here, I'm doing that in the

00:19:25.626 --> 00:19:26.886 A:middle
update method for my playback

00:19:26.886 --> 00:19:28.666 A:middle
info, where I've already added

00:19:28.666 --> 00:19:31.116 A:middle
the playback duration and elapse

00:19:31.226 --> 00:19:31.586 A:middle
time.

00:19:32.536 --> 00:19:34.466 A:middle
And to that, I'm going to add

00:19:34.466 --> 00:19:36.186 A:middle
the list of available option

00:19:36.186 --> 00:19:38.876 A:middle
groups and their current

00:19:38.876 --> 00:19:39.436 A:middle
selections.

00:19:39.436 --> 00:19:43.026 A:middle
So now, we have to handle

00:19:43.256 --> 00:19:44.696 A:middle
changes to those selections.

00:19:45.336 --> 00:19:48.456 A:middle
And I can do that in my setup

00:19:48.456 --> 00:19:50.466 A:middle
method for remote controls or

00:19:50.466 --> 00:19:51.626 A:middle
I'll add support for the

00:19:51.626 --> 00:19:54.016 A:middle
enableLanguageOptionCommand.

00:19:54.946 --> 00:19:56.626 A:middle
And this handler is going to

00:19:56.626 --> 00:19:58.036 A:middle
first get the current playback

00:19:58.036 --> 00:19:58.306 A:middle
item.

00:19:59.946 --> 00:20:01.406 A:middle
And then use my mapping to take

00:19:59.946 --> 00:20:01.406 A:middle
And then use my mapping to take

00:20:01.406 --> 00:20:02.226 A:middle
the language option that I

00:20:02.226 --> 00:20:05.186 A:middle
received and translate it to the

00:20:05.186 --> 00:20:06.376 A:middle
AVFoundation objects.

00:20:08.636 --> 00:20:10.646 A:middle
I'll then use AVPlayer items,

00:20:11.136 --> 00:20:12.886 A:middle
select option and group method

00:20:13.696 --> 00:20:16.256 A:middle
to select the new option on the

00:20:16.256 --> 00:20:16.896 A:middle
current item.

00:20:17.476 --> 00:20:19.166 A:middle
And I'll want to update my Now

00:20:19.166 --> 00:20:20.536 A:middle
Playing info and other internal

00:20:20.536 --> 00:20:22.216 A:middle
state and handle that playback

00:20:22.216 --> 00:20:22.696 A:middle
change.

00:20:23.266 --> 00:20:27.126 A:middle
Now, there are some types of

00:20:27.126 --> 00:20:28.356 A:middle
option groups that could have

00:20:28.356 --> 00:20:29.166 A:middle
nothing selected.

00:20:29.166 --> 00:20:30.426 A:middle
For example, turning off

00:20:30.426 --> 00:20:31.996 A:middle
subtitles and closed captions.

00:20:32.136 --> 00:20:33.416 A:middle
And this comes through with the

00:20:33.416 --> 00:20:35.176 A:middle
disableLanguageOptionCommand.

00:20:35.176 --> 00:20:35.956 A:middle
So you want to make sure to

00:20:35.956 --> 00:20:37.676 A:middle
support both the enable and

00:20:37.676 --> 00:20:38.796 A:middle
disable commands.

00:20:39.646 --> 00:20:41.036 A:middle
And the handler is very similar,

00:20:41.966 --> 00:20:43.216 A:middle
first, getting the current item

00:20:44.456 --> 00:20:46.326 A:middle
and using my mapping to find the

00:20:46.326 --> 00:20:46.716 A:middle
group.

00:20:47.816 --> 00:20:49.856 A:middle
But now, I'm going to check if

00:20:49.856 --> 00:20:51.086 A:middle
that group allows empty

00:20:51.086 --> 00:20:53.016 A:middle
selection and make sure that it

00:20:53.016 --> 00:20:53.406 A:middle
can.

00:20:53.976 --> 00:20:57.676 A:middle
And if it does, I'm going to use

00:20:57.676 --> 00:20:58.786 A:middle
the same select method but

00:20:58.786 --> 00:21:00.226 A:middle
passing nil as the option and

00:20:58.786 --> 00:21:00.226 A:middle
passing nil as the option and

00:21:00.226 --> 00:21:01.316 A:middle
this will deselect all the

00:21:01.316 --> 00:21:02.326 A:middle
options in that group.

00:21:06.346 --> 00:21:07.676 A:middle
So I've got a full set of remote

00:21:07.676 --> 00:21:09.296 A:middle
controls that I can support.

00:21:09.456 --> 00:21:10.836 A:middle
When do I register and

00:21:10.836 --> 00:21:11.986 A:middle
deregister for these?

00:21:12.286 --> 00:21:13.766 A:middle
For most video apps, you're

00:21:13.766 --> 00:21:15.046 A:middle
going to register when you have

00:21:15.046 --> 00:21:16.746 A:middle
content to play and that's when

00:21:16.746 --> 00:21:19.886 A:middle
a user selects a video in your

00:21:19.886 --> 00:21:20.036 A:middle
app.

00:21:21.136 --> 00:21:22.726 A:middle
And you also want to deregister

00:21:22.726 --> 00:21:23.916 A:middle
when you have nothing to play.

00:21:24.196 --> 00:21:27.116 A:middle
So, a user exits your video.

00:21:27.756 --> 00:21:29.146 A:middle
And you'll use that opportunity

00:21:29.146 --> 00:21:30.226 A:middle
to also clear out the Now

00:21:30.226 --> 00:21:31.506 A:middle
Playing info dictionary to make

00:21:31.506 --> 00:21:33.086 A:middle
sure that there's no still data

00:21:33.086 --> 00:21:33.796 A:middle
hanging around.

00:21:34.426 --> 00:21:37.986 A:middle
Now, I mentioned that it's not

00:21:37.986 --> 00:21:38.986 A:middle
just about controlling what's

00:21:39.236 --> 00:21:40.476 A:middle
playing from your device but the

00:21:40.476 --> 00:21:41.536 A:middle
devices around you.

00:21:42.036 --> 00:21:44.216 A:middle
So if you have a tvOS app that

00:21:44.216 --> 00:21:46.426 A:middle
you make, try playing some

00:21:46.626 --> 00:21:49.076 A:middle
content on Apple TV and pulling

00:21:49.076 --> 00:21:50.976 A:middle
down Control Center on an iPhone

00:21:51.466 --> 00:21:53.146 A:middle
and target that Apple TV.

00:21:53.566 --> 00:21:56.236 A:middle
See that you're seeing the video

00:21:56.236 --> 00:21:57.456 A:middle
information that you expect and

00:21:57.456 --> 00:21:58.556 A:middle
you're able to control it as you

00:21:58.556 --> 00:21:58.976 A:middle
expect.

00:21:59.276 --> 00:22:00.826 A:middle
The same goes for using Siri to

00:21:59.276 --> 00:22:00.826 A:middle
The same goes for using Siri to

00:22:00.826 --> 00:22:01.646 A:middle
control your TV.

00:22:05.336 --> 00:22:07.006 A:middle
So the examples that I went

00:22:07.006 --> 00:22:08.656 A:middle
through just now are all part of

00:22:08.656 --> 00:22:09.816 A:middle
a sample project that we've made

00:22:09.816 --> 00:22:11.156 A:middle
available associated with this

00:22:11.156 --> 00:22:11.496 A:middle
session.

00:22:11.496 --> 00:22:12.656 A:middle
And I encourage you to check

00:22:12.696 --> 00:22:13.706 A:middle
that out.

00:22:16.196 --> 00:22:17.286 A:middle
All right.

00:22:17.286 --> 00:22:18.626 A:middle
We got high-quality content that

00:22:18.626 --> 00:22:19.856 A:middle
we can get on the TV and we can

00:22:19.856 --> 00:22:20.806 A:middle
control it.

00:22:21.136 --> 00:22:22.376 A:middle
When it's playing on the TV,

00:22:22.376 --> 00:22:23.516 A:middle
it's really nice to be able to

00:22:23.516 --> 00:22:25.366 A:middle
use my phone or my iPad for

00:22:25.366 --> 00:22:26.226 A:middle
other things.

00:22:27.086 --> 00:22:29.166 A:middle
And there are two parts to

00:22:29.166 --> 00:22:30.736 A:middle
supporting a great multitasking

00:22:30.736 --> 00:22:31.386 A:middle
experience.

00:22:31.956 --> 00:22:33.026 A:middle
One is to make sure that your

00:22:33.026 --> 00:22:35.256 A:middle
video keeps on playing while the

00:22:35.256 --> 00:22:36.366 A:middle
user multitasks.

00:22:36.796 --> 00:22:38.356 A:middle
And the other is to make sure

00:22:38.356 --> 00:22:40.526 A:middle
that if there's already video

00:22:40.526 --> 00:22:42.396 A:middle
playing on the TV that your app

00:22:42.396 --> 00:22:43.336 A:middle
and navigating through its UI

00:22:43.336 --> 00:22:46.086 A:middle
doesn't accidentally interrupt

00:22:46.186 --> 00:22:47.126 A:middle
that experience.

00:22:48.796 --> 00:22:51.556 A:middle
So, when I'm watching a video on

00:22:51.556 --> 00:22:53.876 A:middle
my phone, my video app is

00:22:53.876 --> 00:22:54.506 A:middle
usually staying in the

00:22:54.506 --> 00:22:56.006 A:middle
foreground because I need to

00:22:56.006 --> 00:22:57.226 A:middle
look at it on the screen.

00:22:57.936 --> 00:23:00.896 A:middle
But when I'm AirPlaying on the

00:22:57.936 --> 00:23:00.896 A:middle
But when I'm AirPlaying on the

00:23:00.996 --> 00:23:02.746 A:middle
TV, I'm now free to use my

00:23:02.746 --> 00:23:04.236 A:middle
iPhone for other things like

00:23:04.236 --> 00:23:06.066 A:middle
check my messages or mail, or

00:23:06.066 --> 00:23:06.766 A:middle
social media.

00:23:10.056 --> 00:23:11.506 A:middle
If I'm using a video app that

00:23:11.506 --> 00:23:13.406 A:middle
doesn't support background

00:23:14.216 --> 00:23:16.346 A:middle
media, the video is going to

00:23:16.346 --> 00:23:17.526 A:middle
stop the moment I leave that

00:23:17.526 --> 00:23:17.806 A:middle
app.

00:23:18.456 --> 00:23:19.686 A:middle
And so we want to make sure that

00:23:19.686 --> 00:23:21.516 A:middle
your video can continue playing.

00:23:22.136 --> 00:23:24.306 A:middle
And you can do this by

00:23:24.306 --> 00:23:26.166 A:middle
supporting the audio background

00:23:26.166 --> 00:23:27.836 A:middle
mode in your app's Info.plist.

00:23:29.376 --> 00:23:30.946 A:middle
And you'll also configure your

00:23:30.946 --> 00:23:32.456 A:middle
AVAudioSession for background

00:23:32.456 --> 00:23:32.966 A:middle
playback.

00:23:33.666 --> 00:23:35.556 A:middle
For most video apps, that means

00:23:35.556 --> 00:23:36.906 A:middle
using the playback category.

00:23:37.106 --> 00:23:38.776 A:middle
And this provides media

00:23:38.926 --> 00:23:41.386 A:middle
appropriate behaviors in your

00:23:41.386 --> 00:23:44.696 A:middle
app, including playing in the

00:23:46.056 --> 00:23:46.416 A:middle
background.

00:23:46.416 --> 00:23:47.786 A:middle
Another thing about the playback

00:23:47.786 --> 00:23:48.786 A:middle
category devices, it'll

00:23:48.786 --> 00:23:49.866 A:middle
interrupt the other media.

00:23:49.996 --> 00:23:51.496 A:middle
So it's really important to make

00:23:51.496 --> 00:23:53.286 A:middle
sure that you only activate your

00:23:53.286 --> 00:23:54.656 A:middle
audio session when a user

00:23:54.886 --> 00:23:56.596 A:middle
presses play and begins playback

00:23:56.776 --> 00:23:58.816 A:middle
on a primary piece of content in

00:23:58.816 --> 00:24:00.676 A:middle
your app.

00:23:58.816 --> 00:24:00.676 A:middle
your app.

00:24:01.046 --> 00:24:02.496 A:middle
Now, once you go active, you can

00:24:02.496 --> 00:24:04.126 A:middle
stay active.

00:24:05.116 --> 00:24:06.976 A:middle
There's no need to deactivate

00:24:06.976 --> 00:24:08.256 A:middle
your audio session just because

00:24:08.256 --> 00:24:12.826 A:middle
the user paused the video.

00:24:13.226 --> 00:24:14.696 A:middle
Now, media interruptions can

00:24:14.696 --> 00:24:16.666 A:middle
happen at any time.

00:24:17.016 --> 00:24:18.916 A:middle
And so, it's important to listen

00:24:18.916 --> 00:24:20.346 A:middle
to those notifications on

00:24:20.346 --> 00:24:21.156 A:middle
AVAudioSession.

00:24:22.046 --> 00:24:23.746 A:middle
And when an interruption begins,

00:24:23.746 --> 00:24:25.466 A:middle
you update your UI and internal

00:24:25.466 --> 00:24:26.056 A:middle
state.

00:24:26.596 --> 00:24:28.426 A:middle
And when it ends, check the

00:24:28.426 --> 00:24:30.456 A:middle
notifications payload and make

00:24:30.456 --> 00:24:32.736 A:middle
sure that you check the

00:24:32.736 --> 00:24:35.566 A:middle
shouldResume key and honor that

00:24:35.566 --> 00:24:36.086 A:middle
value.

00:24:36.576 --> 00:24:38.486 A:middle
So, only automatically resume

00:24:38.486 --> 00:24:40.386 A:middle
your video if it returns true.

00:24:41.006 --> 00:24:43.776 A:middle
When you have video already

00:24:43.826 --> 00:24:45.046 A:middle
playing on the TV, it's

00:24:45.046 --> 00:24:46.986 A:middle
important to test your app and

00:24:46.986 --> 00:24:48.386 A:middle
launching it, navigating to the

00:24:48.386 --> 00:24:49.976 A:middle
UI and make sure that there's

00:24:49.976 --> 00:24:51.156 A:middle
nothing that accidentally

00:24:51.156 --> 00:24:52.606 A:middle
AirPlays that you didn't expect,

00:24:53.086 --> 00:24:54.796 A:middle
or that it interrupts that

00:24:54.796 --> 00:24:56.146 A:middle
current video experience.

00:24:57.216 --> 00:24:59.566 A:middle
And I like to go over a couple

00:24:59.566 --> 00:25:01.106 A:middle
examples that you might run

00:24:59.566 --> 00:25:01.106 A:middle
examples that you might run

00:25:01.666 --> 00:25:01.796 A:middle
into.

00:25:02.436 --> 00:25:04.896 A:middle
For one, there's sometimes video

00:25:04.896 --> 00:25:05.926 A:middle
that should never AirPlay.

00:25:06.186 --> 00:25:09.396 A:middle
So if I have an animation on app

00:25:09.396 --> 00:25:11.406 A:middle
launch that I achieved using a

00:25:11.406 --> 00:25:14.986 A:middle
video asset, you don't want that

00:25:14.986 --> 00:25:16.056 A:middle
interrupting the current

00:25:16.056 --> 00:25:16.906 A:middle
experience.

00:25:17.306 --> 00:25:18.886 A:middle
The same goes if I have video

00:25:18.886 --> 00:25:20.326 A:middle
assets I use for other types of

00:25:20.326 --> 00:25:22.236 A:middle
visual flourish or to promote

00:25:22.236 --> 00:25:24.176 A:middle
content within my app.

00:25:24.526 --> 00:25:25.976 A:middle
You can make sure that those

00:25:25.976 --> 00:25:26.916 A:middle
videos don't interrupt the

00:25:26.916 --> 00:25:27.946 A:middle
current experience and stay

00:25:27.946 --> 00:25:31.386 A:middle
local on the device by setting

00:25:31.386 --> 00:25:33.456 A:middle
allowsExternalPlayback to false.

00:25:33.986 --> 00:25:37.276 A:middle
Your app should only AirPlay a

00:25:37.276 --> 00:25:38.896 A:middle
video when a user has directly

00:25:38.896 --> 00:25:40.416 A:middle
interacted with that video.

00:25:41.016 --> 00:25:46.326 A:middle
And to that end, you should not

00:25:46.786 --> 00:25:48.746 A:middle
auto-play primary content just

00:25:48.746 --> 00:25:50.156 A:middle
because your app launched or

00:25:50.156 --> 00:25:51.266 A:middle
came into the foreground.

00:25:51.866 --> 00:25:54.856 A:middle
When it comes to media, people

00:25:54.856 --> 00:25:56.376 A:middle
should always be in control of

00:25:56.376 --> 00:25:57.606 A:middle
when playback begins.

00:25:58.866 --> 00:25:59.846 A:middle
And this is really important,

00:25:59.846 --> 00:26:01.006 A:middle
and I want to go over a couple

00:25:59.846 --> 00:26:01.006 A:middle
and I want to go over a couple

00:26:01.006 --> 00:26:02.486 A:middle
examples of why.

00:26:03.146 --> 00:26:06.136 A:middle
So here, I am listening to music

00:26:06.136 --> 00:26:08.176 A:middle
on my iPhone and I have a video

00:26:08.176 --> 00:26:10.126 A:middle
app that supports on-demand

00:26:10.126 --> 00:26:11.766 A:middle
video that I can watch but also

00:26:11.766 --> 00:26:13.666 A:middle
auto-plays a live TV channel

00:26:14.356 --> 00:26:15.226 A:middle
when the app comes to the

00:26:15.226 --> 00:26:15.856 A:middle
foreground.

00:26:17.426 --> 00:26:18.566 A:middle
So if I'm listening to music, I

00:26:18.566 --> 00:26:20.346 A:middle
launch that app, that music is

00:26:20.346 --> 00:26:21.956 A:middle
going to stop and I had no

00:26:21.956 --> 00:26:23.426 A:middle
control over it.

00:26:24.216 --> 00:26:25.566 A:middle
And I might have launched that

00:26:25.566 --> 00:26:27.136 A:middle
app for a purpose other than

00:26:27.136 --> 00:26:28.366 A:middle
watching that live video.

00:26:28.996 --> 00:26:32.076 A:middle
You want to make sure that

00:26:32.076 --> 00:26:33.686 A:middle
people can launch your app

00:26:33.686 --> 00:26:36.106 A:middle
confidently knowing that their

00:26:36.106 --> 00:26:37.286 A:middle
current experience won't get

00:26:37.286 --> 00:26:37.956 A:middle
interrupted.

00:26:38.526 --> 00:26:41.046 A:middle
And I like to call out one more

00:26:41.046 --> 00:26:42.306 A:middle
important example that is new

00:26:42.306 --> 00:26:42.846 A:middle
this year.

00:26:45.106 --> 00:26:47.106 A:middle
For long-form video apps, iOS

00:26:47.106 --> 00:26:48.956 A:middle
can suggest a TV to

00:26:48.956 --> 00:26:52.416 A:middle
automatically play to when the

00:26:52.416 --> 00:26:53.316 A:middle
video begins.

00:26:53.816 --> 00:26:55.326 A:middle
And when this happens, the

00:26:55.326 --> 00:26:56.996 A:middle
system provides a notification

00:26:56.996 --> 00:26:59.006 A:middle
telling the user that the video

00:26:59.006 --> 00:27:00.096 A:middle
will automatically play on the

00:26:59.006 --> 00:27:00.096 A:middle
will automatically play on the

00:27:00.096 --> 00:27:00.596 A:middle
TV.

00:27:01.376 --> 00:27:02.726 A:middle
And people can tap that

00:27:02.726 --> 00:27:04.406 A:middle
notification or the status bar

00:27:04.406 --> 00:27:05.966 A:middle
icon to change that suggested

00:27:05.966 --> 00:27:06.746 A:middle
destination.

00:27:07.326 --> 00:27:10.876 A:middle
Now, if I have an app that

00:27:11.246 --> 00:27:13.626 A:middle
auto-plays its content, it's

00:27:13.626 --> 00:27:15.116 A:middle
possible that that video starts

00:27:15.116 --> 00:27:16.786 A:middle
playing on the TV before I've

00:27:16.786 --> 00:27:18.256 A:middle
had a chance to really see and

00:27:18.256 --> 00:27:20.106 A:middle
interact with that notification.

00:27:21.336 --> 00:27:22.446 A:middle
By requiring to use the action

00:27:22.446 --> 00:27:24.896 A:middle
to begin playback, you can

00:27:24.896 --> 00:27:26.726 A:middle
provide people the power to

00:27:26.726 --> 00:27:28.756 A:middle
decide both when and where they

00:27:28.756 --> 00:27:30.376 A:middle
play their video, and that

00:27:30.376 --> 00:27:31.386 A:middle
creates a great media

00:27:31.386 --> 00:27:32.166 A:middle
experience.

00:27:32.236 --> 00:27:34.316 A:middle
And so, to talk with you more

00:27:34.316 --> 00:27:37.116 A:middle
about long-form video apps and

00:27:37.386 --> 00:27:38.596 A:middle
their integration with

00:27:38.596 --> 00:27:39.946 A:middle
intelligent AirPlay Suggestions,

00:27:40.436 --> 00:27:41.496 A:middle
I'd like to invite up on to the

00:27:41.496 --> 00:27:42.746 A:middle
stage Marty Pye.

00:27:43.516 --> 00:27:49.606 A:middle
[ Applause ]

00:27:50.106 --> 00:27:52.496 A:middle
&gt;&gt; Thank you, Jonathan.

00:27:52.696 --> 00:27:53.446 A:middle
Hello, everyone.

00:27:53.486 --> 00:27:54.416 A:middle
My name is Marty Pye.

00:27:54.416 --> 00:27:55.916 A:middle
I'm an AVKit engineer here at

00:27:55.916 --> 00:27:56.196 A:middle
Apple.

00:27:56.816 --> 00:27:58.526 A:middle
And I'm here today to tell you a

00:27:58.526 --> 00:27:59.356 A:middle
little bit more about the

00:27:59.356 --> 00:28:00.536 A:middle
advanced routing features we

00:27:59.356 --> 00:28:00.536 A:middle
advanced routing features we

00:28:00.536 --> 00:28:03.246 A:middle
built into iOS 13 and how your

00:28:03.246 --> 00:28:04.416 A:middle
long-form video apps can take

00:28:04.416 --> 00:28:05.606 A:middle
advantage of these features.

00:28:06.386 --> 00:28:08.376 A:middle
So first, we'll talk about what

00:28:08.376 --> 00:28:10.086 A:middle
a long-form video app actually

00:28:10.186 --> 00:28:10.296 A:middle
is.

00:28:10.956 --> 00:28:12.666 A:middle
Then I'll talk a bit more about

00:28:12.666 --> 00:28:14.396 A:middle
what these specific routing

00:28:14.396 --> 00:28:15.606 A:middle
behaviors are that we've built

00:28:15.606 --> 00:28:16.476 A:middle
for long-form video apps.

00:28:17.066 --> 00:28:18.456 A:middle
And finally, I'll show you how

00:28:18.456 --> 00:28:20.416 A:middle
to integrate these features into

00:28:20.416 --> 00:28:20.906 A:middle
your code.

00:28:22.166 --> 00:28:24.746 A:middle
So what is a long-form video

00:28:25.356 --> 00:28:25.436 A:middle
app?

00:28:25.436 --> 00:28:27.106 A:middle
As the name suggests, any app

00:28:27.156 --> 00:28:28.626 A:middle
that primarily plays long-form

00:28:28.626 --> 00:28:30.306 A:middle
video content is considered a

00:28:30.306 --> 00:28:31.226 A:middle
long-form video app.

00:28:31.336 --> 00:28:32.826 A:middle
This content includes things

00:28:32.826 --> 00:28:35.456 A:middle
such as movies or the TV type

00:28:35.496 --> 00:28:37.806 A:middle
content like TV shows, sports,

00:28:37.806 --> 00:28:38.566 A:middle
et cetera.

00:28:38.936 --> 00:28:41.206 A:middle
If your app primarily plays

00:28:41.586 --> 00:28:44.036 A:middle
content from social media or

00:28:44.036 --> 00:28:45.446 A:middle
other types of short news clips,

00:28:45.666 --> 00:28:47.256 A:middle
then it would not qualify as

00:28:47.256 --> 00:28:48.036 A:middle
long-form video.

00:28:48.596 --> 00:28:51.876 A:middle
We encourage you to assess your

00:28:51.876 --> 00:28:53.456 A:middle
app holistically to decide in

00:28:53.456 --> 00:28:54.996 A:middle
which category of movie it

00:28:54.996 --> 00:28:55.466 A:middle
belongs.

00:28:56.526 --> 00:28:57.916 A:middle
So once you've decided that your

00:28:57.916 --> 00:28:59.956 A:middle
app is long-form video, how will

00:28:59.956 --> 00:29:01.136 A:middle
the AirPlay routing behavior

00:28:59.956 --> 00:29:01.136 A:middle
the AirPlay routing behavior

00:29:01.136 --> 00:29:02.486 A:middle
differ for such apps?

00:29:03.456 --> 00:29:05.106 A:middle
Let's take a look at an example.

00:29:06.996 --> 00:29:09.076 A:middle
If-- Imagine you're watching a

00:29:09.076 --> 00:29:11.006 A:middle
documentary on banana slugs and

00:29:11.006 --> 00:29:12.666 A:middle
you're AirPlaying this content

00:29:12.666 --> 00:29:14.346 A:middle
from your iPhone to an Apple TV.

00:29:15.286 --> 00:29:18.096 A:middle
New in iOS 13, when your friend

00:29:18.096 --> 00:29:20.276 A:middle
sends you his latest sweet dirt

00:29:20.276 --> 00:29:22.026 A:middle
biking video, you can go ahead

00:29:22.026 --> 00:29:23.456 A:middle
and watch this short content

00:29:23.456 --> 00:29:25.366 A:middle
locally on your device without

00:29:25.366 --> 00:29:26.896 A:middle
interrupting the banana slug

00:29:26.896 --> 00:29:28.466 A:middle
documentary that's playing on

00:29:29.036 --> 00:29:31.216 A:middle
the TV.

00:29:31.366 --> 00:29:32.596 A:middle
Another feature we've built into

00:29:32.596 --> 00:29:35.036 A:middle
iOS 13 is AirPlay Suggestions.

00:29:35.956 --> 00:29:38.066 A:middle
If the user goes to play some

00:29:38.066 --> 00:29:39.806 A:middle
content and the AirPlay routing

00:29:39.806 --> 00:29:42.186 A:middle
system detects a nearby likely

00:29:42.186 --> 00:29:44.816 A:middle
AirPlay device, then the system

00:29:44.816 --> 00:29:47.266 A:middle
may prompt the user and suggest

00:29:47.586 --> 00:29:48.886 A:middle
to AirPlay to this device.

00:29:48.886 --> 00:29:50.726 A:middle
Or, depending on the confidence,

00:29:50.866 --> 00:29:52.016 A:middle
the system might also

00:29:52.016 --> 00:29:53.756 A:middle
automatically route playback to

00:29:53.756 --> 00:29:54.436 A:middle
that device.

00:29:55.816 --> 00:29:57.006 A:middle
So now that you know about these

00:29:57.006 --> 00:29:58.856 A:middle
features, how to take advantage

00:29:58.856 --> 00:29:59.976 A:middle
of them in your app?

00:30:00.846 --> 00:30:01.986 A:middle
Well, there's two things you

00:30:01.986 --> 00:30:02.526 A:middle
need to do.

00:30:02.696 --> 00:30:04.206 A:middle
And the first thing is

00:30:04.256 --> 00:30:05.496 A:middle
registering your app as a

00:30:05.496 --> 00:30:06.616 A:middle
long-form video app.

00:30:07.616 --> 00:30:08.596 A:middle
So how do we do this?

00:30:09.456 --> 00:30:10.566 A:middle
It's really very simple.

00:30:11.536 --> 00:30:12.876 A:middle
All you need to do is add the

00:30:12.876 --> 00:30:14.836 A:middle
AVInitialRouteSharingPolicy key

00:30:14.836 --> 00:30:16.796 A:middle
to your app's Info.plist and set

00:30:16.796 --> 00:30:17.956 A:middle
it to a long-form video.

00:30:19.256 --> 00:30:21.046 A:middle
By setting this on the plist, we

00:30:21.046 --> 00:30:22.496 A:middle
can ensure that your app behaves

00:30:22.496 --> 00:30:24.146 A:middle
like every other long-form video

00:30:24.146 --> 00:30:25.846 A:middle
app on the system before you

00:30:25.846 --> 00:30:27.176 A:middle
create any of your playback

00:30:27.176 --> 00:30:28.876 A:middle
objects and the moment it gets

00:30:28.876 --> 00:30:29.366 A:middle
launched.

00:30:33.056 --> 00:30:34.756 A:middle
Now, the second thing you need

00:30:34.756 --> 00:30:36.936 A:middle
to do in order to leverage the

00:30:36.936 --> 00:30:38.656 A:middle
AirPlay Suggestions is prepare

00:30:38.656 --> 00:30:39.916 A:middle
the routing system prior to

00:30:39.916 --> 00:30:40.486 A:middle
playback.

00:30:40.486 --> 00:30:43.016 A:middle
I'm first going to give you a

00:30:43.016 --> 00:30:44.576 A:middle
little conceptual overview of

00:30:44.776 --> 00:30:46.326 A:middle
how that works, and then we'll

00:30:46.326 --> 00:30:48.726 A:middle
dive into how to achieve it in

00:30:51.476 --> 00:30:51.606 A:middle
code.

00:30:51.806 --> 00:30:53.416 A:middle
So in your app, you most likely

00:30:53.416 --> 00:30:54.666 A:middle
have some sort of browsing UI

00:30:54.996 --> 00:30:57.016 A:middle
where users can scroll through

00:30:57.016 --> 00:30:58.266 A:middle
different pieces of content,

00:30:58.806 --> 00:31:00.246 A:middle
select the piece of content they

00:30:58.806 --> 00:31:00.246 A:middle
select the piece of content they

00:31:00.246 --> 00:31:01.646 A:middle
would like to play, and hit

00:31:01.646 --> 00:31:01.876 A:middle
Play.

00:31:02.736 --> 00:31:04.256 A:middle
Well, it's at this transition

00:31:04.256 --> 00:31:06.316 A:middle
from browsing to actual playback

00:31:06.516 --> 00:31:07.996 A:middle
where you should prepare the

00:31:07.996 --> 00:31:09.156 A:middle
AirPlay routing system.

00:31:09.686 --> 00:31:11.316 A:middle
And what happens when you

00:31:11.316 --> 00:31:12.436 A:middle
prepare the routing system?

00:31:13.466 --> 00:31:15.756 A:middle
Well, it may decide to

00:31:16.106 --> 00:31:17.556 A:middle
automatically play the content

00:31:17.556 --> 00:31:19.996 A:middle
locally on the device or route

00:31:19.996 --> 00:31:21.926 A:middle
it to an external screen, be it

00:31:21.926 --> 00:31:23.876 A:middle
via a likely nearby AirPlay

00:31:23.876 --> 00:31:25.446 A:middle
device, or if you have an

00:31:25.446 --> 00:31:28.046 A:middle
external screen wired into the

00:31:29.076 --> 00:31:29.236 A:middle
device.

00:31:29.306 --> 00:31:30.646 A:middle
However, depending on the level

00:31:30.646 --> 00:31:32.256 A:middle
of confidence, the system may

00:31:32.256 --> 00:31:34.246 A:middle
also prompt the user asking

00:31:34.246 --> 00:31:36.506 A:middle
whether they would like to play

00:31:36.506 --> 00:31:38.006 A:middle
to a nearby AirPlay device.

00:31:38.936 --> 00:31:41.086 A:middle
And then depending on the user's

00:31:41.086 --> 00:31:42.416 A:middle
choice, control will then be

00:31:42.416 --> 00:31:43.826 A:middle
handed back to your app with

00:31:43.826 --> 00:31:45.196 A:middle
information about where the

00:31:45.196 --> 00:31:47.916 A:middle
content is going to play.

00:31:48.936 --> 00:31:50.156 A:middle
So let's take a look at how to

00:31:50.156 --> 00:31:51.026 A:middle
do this in code.

00:31:52.346 --> 00:31:55.036 A:middle
When the user decides to hit

00:31:55.036 --> 00:31:56.696 A:middle
Play, you should call

00:31:56.696 --> 00:31:58.546 A:middle
prepareRouteSelectionForPlayback

00:31:58.696 --> 00:32:00.016 A:middle
on the AVAudioSession.

00:31:58.696 --> 00:32:00.016 A:middle
on the AVAudioSession.

00:32:00.626 --> 00:32:01.866 A:middle
And this method takes a

00:32:01.866 --> 00:32:02.706 A:middle
completion handler.

00:32:04.106 --> 00:32:05.286 A:middle
Now, this completion handler

00:32:05.286 --> 00:32:06.836 A:middle
will be called right away if the

00:32:06.836 --> 00:32:08.146 A:middle
AirPlay can-- if the AirPlay

00:32:08.146 --> 00:32:09.596 A:middle
routing system can make an

00:32:09.596 --> 00:32:10.646 A:middle
automatic decision.

00:32:11.636 --> 00:32:13.796 A:middle
However, there may also be a

00:32:13.796 --> 00:32:15.566 A:middle
prompt shown asking the user

00:32:16.296 --> 00:32:17.286 A:middle
whether they would like to play

00:32:17.286 --> 00:32:18.756 A:middle
to this nearby AirPlay device.

00:32:19.436 --> 00:32:20.776 A:middle
If the user decides they would

00:32:20.776 --> 00:32:22.416 A:middle
like to play the content

00:32:22.416 --> 00:32:24.756 A:middle
locally, then your completion

00:32:24.756 --> 00:32:26.296 A:middle
handler will be called with

00:32:26.296 --> 00:32:27.796 A:middle
route selection type local.

00:32:27.796 --> 00:32:30.656 A:middle
Now, you can go ahead and

00:32:30.656 --> 00:32:31.676 A:middle
present your playback UI.

00:32:31.676 --> 00:32:32.936 A:middle
For example,

00:32:32.936 --> 00:32:35.226 A:middle
AVPlayerViewController, or you

00:32:35.226 --> 00:32:36.736 A:middle
can present your own custom

00:32:36.736 --> 00:32:37.276 A:middle
playback UI.

00:32:38.836 --> 00:32:40.736 A:middle
If the user instead decides they

00:32:40.736 --> 00:32:41.696 A:middle
would like to AirPlay the

00:32:41.696 --> 00:32:43.456 A:middle
content and they select the

00:32:43.456 --> 00:32:45.106 A:middle
living room, then your

00:32:45.106 --> 00:32:46.026 A:middle
completion handler will be

00:32:46.026 --> 00:32:47.656 A:middle
called with route selection type

00:32:47.656 --> 00:32:48.256 A:middle
external.

00:32:49.506 --> 00:32:50.786 A:middle
And here, you have the

00:32:50.786 --> 00:32:52.536 A:middle
opportunity to present some sort

00:32:52.536 --> 00:32:54.826 A:middle
of custom remote playback UI

00:32:55.146 --> 00:32:57.596 A:middle
with controls dedicated to

00:32:57.596 --> 00:32:58.706 A:middle
controlling something that's

00:32:58.706 --> 00:33:00.216 A:middle
playing on an external screen.

00:32:58.706 --> 00:33:00.216 A:middle
playing on an external screen.

00:33:00.826 --> 00:33:02.176 A:middle
Lastly, don't forget to handle

00:33:02.176 --> 00:33:03.566 A:middle
the case that the user decides

00:33:03.906 --> 00:33:05.386 A:middle
to cancel playback.

00:33:06.296 --> 00:33:08.246 A:middle
Now, in order to test your app

00:33:08.246 --> 00:33:09.826 A:middle
and how it behaves in the

00:33:09.826 --> 00:33:12.316 A:middle
various different scenarios with

00:33:12.316 --> 00:33:14.116 A:middle
AirPlay Suggestions, we've built

00:33:14.326 --> 00:33:15.786 A:middle
some toggles into the developer

00:33:15.786 --> 00:33:16.256 A:middle
settings.

00:33:17.016 --> 00:33:18.736 A:middle
If you drill down to settings

00:33:18.736 --> 00:33:20.396 A:middle
developer, you'll find this new

00:33:20.396 --> 00:33:21.846 A:middle
entry, AirPlay Suggestions.

00:33:23.136 --> 00:33:25.426 A:middle
And in here, you have the choice

00:33:25.426 --> 00:33:26.716 A:middle
of three distinct modes.

00:33:28.236 --> 00:33:30.096 A:middle
The Default mode is just the

00:33:30.096 --> 00:33:31.376 A:middle
default system behavior.

00:33:32.176 --> 00:33:34.616 A:middle
You can also select between a

00:33:34.616 --> 00:33:36.926 A:middle
mode where the system will

00:33:36.926 --> 00:33:38.556 A:middle
always prompt the user and ask

00:33:39.056 --> 00:33:41.246 A:middle
whether a content should AirPlay

00:33:41.246 --> 00:33:42.476 A:middle
to a specific device.

00:33:43.286 --> 00:33:44.716 A:middle
Or you can force the system into

00:33:44.716 --> 00:33:46.086 A:middle
a mode where it will always

00:33:46.086 --> 00:33:47.936 A:middle
automatically route to a

00:33:47.936 --> 00:33:48.756 A:middle
specific device.

00:33:49.386 --> 00:33:50.946 A:middle
And you can select which device

00:33:50.946 --> 00:33:53.456 A:middle
this applies to in the nearby

00:33:53.456 --> 00:33:55.406 A:middle
list of routes below.

00:33:56.056 --> 00:33:57.716 A:middle
Once you've forced the system

00:33:57.716 --> 00:33:59.756 A:middle
into a specific mode, make sure

00:33:59.756 --> 00:34:00.866 A:middle
that you reset the media

00:33:59.756 --> 00:34:00.866 A:middle
that you reset the media

00:34:00.866 --> 00:34:01.436 A:middle
services.

00:34:02.956 --> 00:34:04.166 A:middle
If you're concerned about

00:34:04.166 --> 00:34:06.026 A:middle
whether AirPlay Suggestions will

00:34:06.026 --> 00:34:07.806 A:middle
handle every possible use case

00:34:07.806 --> 00:34:08.906 A:middle
where your users might want to

00:34:08.906 --> 00:34:11.016 A:middle
AirPlay, then don't worry.

00:34:11.326 --> 00:34:13.136 A:middle
At the end of the day, you're

00:34:13.136 --> 00:34:15.085 A:middle
still fully in control when and

00:34:15.085 --> 00:34:16.786 A:middle
where things will AirPlay.

00:34:17.406 --> 00:34:20.356 A:middle
You can always select to change

00:34:20.356 --> 00:34:21.886 A:middle
which device you're AirPlaying

00:34:21.886 --> 00:34:23.886 A:middle
to via AVRoutePickerView inside

00:34:23.886 --> 00:34:26.106 A:middle
of your app via the controls

00:34:26.106 --> 00:34:27.676 A:middle
inside of AVPlayerViewController

00:34:27.976 --> 00:34:29.386 A:middle
or via control center.

00:34:31.346 --> 00:34:32.536 A:middle
These new features just make it

00:34:32.536 --> 00:34:34.835 A:middle
even easier for your users to

00:34:35.216 --> 00:34:36.795 A:middle
get your content onto the device

00:34:36.795 --> 00:34:37.556 A:middle
of their choosing.

00:34:38.416 --> 00:34:39.706 A:middle
We encourage you to check out

00:34:39.706 --> 00:34:41.755 A:middle
the associated sample code where

00:34:41.755 --> 00:34:43.456 A:middle
we demonstrate in a simple test

00:34:43.456 --> 00:34:45.235 A:middle
app how to integrate the

00:34:45.466 --> 00:34:46.835 A:middle
behaviors we've described today.

00:34:47.916 --> 00:34:49.036 A:middle
So what have we learned today?

00:34:49.746 --> 00:34:51.206 A:middle
We've learned how to integrate

00:34:51.206 --> 00:34:52.396 A:middle
an AirPlay picker into our app

00:34:52.646 --> 00:34:53.936 A:middle
via AVRoutePickerView.

00:34:54.906 --> 00:34:57.036 A:middle
We've learned how to handle and

00:34:57.226 --> 00:34:58.656 A:middle
register for remote controls

00:34:58.656 --> 00:34:59.526 A:middle
commands via

00:34:59.526 --> 00:35:01.576 A:middle
MPRemoteCommandCenter, and how

00:34:59.526 --> 00:35:01.576 A:middle
MPRemoteCommandCenter, and how

00:35:01.576 --> 00:35:03.606 A:middle
to populate system UI with

00:35:03.606 --> 00:35:04.416 A:middle
relevant Now Playing

00:35:04.416 --> 00:35:05.016 A:middle
information.

00:35:06.736 --> 00:35:07.706 A:middle
We've learned how to take

00:35:07.706 --> 00:35:08.576 A:middle
advantage of AirPlay

00:35:08.576 --> 00:35:10.636 A:middle
multitasking and how to register

00:35:10.636 --> 00:35:11.936 A:middle
your app as a long-form video

00:35:12.776 --> 00:35:12.846 A:middle
app.

00:35:13.796 --> 00:35:15.546 A:middle
And lastly, we've learned how to

00:35:15.546 --> 00:35:17.056 A:middle
prepare the routing system prior

00:35:17.056 --> 00:35:18.556 A:middle
to playback in order to fully

00:35:18.556 --> 00:35:19.956 A:middle
leverage AirPlay Suggestions.

00:35:21.196 --> 00:35:23.246 A:middle
With that, I would like to thank

00:35:23.246 --> 00:35:24.406 A:middle
you all for joining us on

00:35:24.406 --> 00:35:25.516 A:middle
today's session.

00:35:26.136 --> 00:35:28.136 A:middle
We can't wait to see these new

00:35:28.136 --> 00:35:29.876 A:middle
AirPlay features integrated into

00:35:29.876 --> 00:35:30.466 A:middle
your apps.

00:35:31.296 --> 00:35:32.046 A:middle
Enjoy the rest of the

00:35:32.046 --> 00:35:32.616 A:middle
conference.

00:35:33.516 --> 00:35:38.500 A:middle
[ Applause ]
