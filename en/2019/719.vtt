WEBVTT

00:00:00.506 --> 00:00:06.436 A:middle
[ Music ]

00:00:06.936 --> 00:00:08.616 A:middle
&gt;&gt; Welcome to What's New in File

00:00:08.616 --> 00:00:09.616 A:middle
Management and Quick Look.

00:00:09.956 --> 00:00:11.286 A:middle
We have a lot of great new API

00:00:11.446 --> 00:00:12.946 A:middle
for managing documents and file

00:00:12.946 --> 00:00:13.856 A:middle
previews to share with you

00:00:13.856 --> 00:00:13.976 A:middle
today.

00:00:16.046 --> 00:00:16.996 A:middle
Here are the areas that we're

00:00:16.996 --> 00:00:18.166 A:middle
going to cover in this session.

00:00:19.076 --> 00:00:21.126 A:middle
First, we'll show how your app

00:00:21.126 --> 00:00:22.366 A:middle
can use the document picker to

00:00:22.366 --> 00:00:23.756 A:middle
access a directory and its

00:00:23.756 --> 00:00:24.256 A:middle
content.

00:00:24.676 --> 00:00:27.056 A:middle
We'll also show how your app can

00:00:27.056 --> 00:00:28.836 A:middle
properly support files stored on

00:00:28.836 --> 00:00:30.596 A:middle
external USB drives or SMB

00:00:30.596 --> 00:00:31.246 A:middle
servers.

00:00:32.586 --> 00:00:34.176 A:middle
Then also, see how your app can

00:00:34.176 --> 00:00:35.426 A:middle
fetch and display rich

00:00:35.426 --> 00:00:36.086 A:middle
thumbnails.

00:00:37.796 --> 00:00:39.356 A:middle
And you'll see how your app can

00:00:39.356 --> 00:00:40.616 A:middle
provide quick editing support

00:00:40.616 --> 00:00:42.676 A:middle
for images, PDFs, and videos via

00:00:42.676 --> 00:00:43.146 A:middle
Quick Look.

00:00:43.146 --> 00:00:46.586 A:middle
We've made it easy to port your

00:00:46.706 --> 00:00:48.746 A:middle
iOS app to macOS as the Quick

00:00:48.746 --> 00:00:50.306 A:middle
Look Extension APIs are now

00:00:50.306 --> 00:00:51.306 A:middle
cross platform.

00:00:51.736 --> 00:00:54.246 A:middle
And finally, we'll talk about

00:00:54.246 --> 00:00:56.656 A:middle
supporting iPad apps on Mac.

00:00:58.426 --> 00:00:59.986 A:middle
So who is this session for?

00:01:00.256 --> 00:01:02.246 A:middle
If you are writing a new app or

00:01:02.246 --> 00:01:03.216 A:middle
already have an app that

00:01:03.216 --> 00:01:04.616 A:middle
presents documents or performs

00:01:04.616 --> 00:01:06.056 A:middle
file operations, you're in the

00:01:06.056 --> 00:01:06.706 A:middle
right session.

00:01:06.846 --> 00:01:08.726 A:middle
You want to learn the best

00:01:08.726 --> 00:01:10.226 A:middle
practices to support files

00:01:10.226 --> 00:01:11.886 A:middle
stored on removable drives, such

00:01:11.886 --> 00:01:13.416 A:middle
as USB and SMB.

00:01:14.086 --> 00:01:15.446 A:middle
You may also need your app to

00:01:15.446 --> 00:01:16.886 A:middle
recursively access multiple

00:01:16.886 --> 00:01:18.286 A:middle
documents within a folder and

00:01:18.286 --> 00:01:20.156 A:middle
perform batch file operations.

00:01:21.546 --> 00:01:22.726 A:middle
Stick around if you want to

00:01:22.726 --> 00:01:24.096 A:middle
learn more about displaying file

00:01:24.096 --> 00:01:25.496 A:middle
thumbnails or if you want to

00:01:25.496 --> 00:01:26.946 A:middle
provide simple image and video

00:01:26.946 --> 00:01:28.566 A:middle
editing in your app.

00:01:29.766 --> 00:01:31.126 A:middle
By the way, if you haven't

00:01:31.126 --> 00:01:32.236 A:middle
checked it out yet, you should

00:01:32.236 --> 00:01:33.076 A:middle
definitely take a look at

00:01:33.076 --> 00:01:34.846 A:middle
Managing Documents in Your iOS

00:01:34.846 --> 00:01:38.296 A:middle
Apps session from WWDC 2018 in

00:01:38.296 --> 00:01:39.816 A:middle
which we detailed step-by-step

00:01:40.176 --> 00:01:40.676 A:middle
how to use the

00:01:40.676 --> 00:01:42.336 A:middle
UIDocumentBrowserViewController

00:01:42.416 --> 00:01:42.626 A:middle
and the

00:01:42.626 --> 00:01:44.086 A:middle
UIDocumentPickerViewController.

00:01:45.216 --> 00:01:46.746 A:middle
There's also a session, Quick

00:01:46.746 --> 00:01:48.296 A:middle
Look Previews from the Ground Up

00:01:48.456 --> 00:01:50.866 A:middle
from WWDC 2018, which we highly

00:01:50.866 --> 00:01:51.896 A:middle
encourage you to watch if you're

00:01:52.206 --> 00:01:54.006 A:middle
interested in presenting file

00:01:54.006 --> 00:01:56.286 A:middle
previews on iOS and now macOS.

00:01:56.786 --> 00:02:00.526 A:middle
One of the most requested

00:01:56.786 --> 00:02:00.526 A:middle
One of the most requested

00:02:00.526 --> 00:02:01.906 A:middle
features has been to access an

00:02:01.906 --> 00:02:03.046 A:middle
entire directory and its

00:02:03.046 --> 00:02:03.716 A:middle
contents.

00:02:04.126 --> 00:02:05.616 A:middle
We're really excited that an iOS

00:02:05.616 --> 00:02:06.906 A:middle
13 you now can.

00:02:07.846 --> 00:02:09.485 A:middle
Features of your app may need to

00:02:09.485 --> 00:02:11.306 A:middle
access content of a directory

00:02:11.306 --> 00:02:12.626 A:middle
for reading, writing, or

00:02:12.626 --> 00:02:13.636 A:middle
creating documents.

00:02:14.286 --> 00:02:15.626 A:middle
For instance, an image editor

00:02:15.696 --> 00:02:16.836 A:middle
that needs to apply the same

00:02:16.836 --> 00:02:18.396 A:middle
change on a batch of images

00:02:18.396 --> 00:02:20.216 A:middle
would read every image, apply

00:02:20.216 --> 00:02:21.926 A:middle
modifications, and save a new

00:02:21.926 --> 00:02:23.016 A:middle
image right next to the

00:02:23.016 --> 00:02:23.386 A:middle
original.

00:02:23.826 --> 00:02:27.396 A:middle
Prior to iOS 13, an app could

00:02:27.396 --> 00:02:28.736 A:middle
access files outside of its

00:02:28.736 --> 00:02:30.216 A:middle
application container via the

00:02:30.216 --> 00:02:31.886 A:middle
UIDocumentPickerViewController

00:02:32.126 --> 00:02:33.396 A:middle
but the user had to pick one

00:02:33.396 --> 00:02:34.166 A:middle
file at a time.

00:02:34.956 --> 00:02:37.066 A:middle
New in iOS 13, your app can

00:02:37.066 --> 00:02:37.426 A:middle
present a

00:02:37.426 --> 00:02:38.976 A:middle
UIDocumentPickerViewController

00:02:38.976 --> 00:02:40.386 A:middle
to let the user pick a folder.

00:02:40.606 --> 00:02:42.836 A:middle
After validation, your app will

00:02:42.836 --> 00:02:44.336 A:middle
be granted recursive access to

00:02:44.336 --> 00:02:45.806 A:middle
the directory as well as all of

00:02:45.806 --> 00:02:46.566 A:middle
its contents.

00:02:47.376 --> 00:02:48.846 A:middle
Additionally, you can now set

00:02:48.846 --> 00:02:50.196 A:middle
the default directory that is

00:02:50.196 --> 00:02:51.236 A:middle
shown on the document picker

00:02:51.236 --> 00:02:51.976 A:middle
when presented.

00:02:55.176 --> 00:02:56.526 A:middle
Now let's take a look at how you

00:02:56.526 --> 00:02:57.976 A:middle
can do that now using a few

00:02:57.976 --> 00:02:59.236 A:middle
examples of how to configure the

00:02:59.236 --> 00:03:00.836 A:middle
UIDocumentPickerViewController.

00:02:59.236 --> 00:03:00.836 A:middle
UIDocumentPickerViewController.

00:03:01.496 --> 00:03:03.296 A:middle
To allow folder selection,

00:03:03.596 --> 00:03:05.136 A:middle
creating instance initialized

00:03:05.136 --> 00:03:07.126 A:middle
with an array containing only

00:03:07.126 --> 00:03:09.076 A:middle
the kUTTypeFolder type and then

00:03:09.076 --> 00:03:10.176 A:middle
present it.

00:03:11.586 --> 00:03:13.316 A:middle
To set the default directory of

00:03:13.316 --> 00:03:14.676 A:middle
UIDocumentPickerViewController

00:03:14.676 --> 00:03:16.396 A:middle
instance, set its directoryURL

00:03:16.396 --> 00:03:18.246 A:middle
property and then present.

00:03:18.286 --> 00:03:21.596 A:middle
Now let's take a look at this

00:03:21.596 --> 00:03:22.046 A:middle
example.

00:03:22.326 --> 00:03:23.406 A:middle
We show you how to enumerate the

00:03:23.406 --> 00:03:25.326 A:middle
contents of a folder, but you

00:03:25.326 --> 00:03:26.586 A:middle
can use the same example to

00:03:26.586 --> 00:03:28.036 A:middle
write a file here using standard

00:03:28.036 --> 00:03:29.006 A:middle
File Manager API.

00:03:30.466 --> 00:03:33.096 A:middle
Also, make sure to use URL start

00:03:33.096 --> 00:03:34.126 A:middle
and stopAccessing

00:03:34.126 --> 00:03:36.806 A:middle
SecurityScopedResource calls and

00:03:36.996 --> 00:03:39.066 A:middle
use NSFileCoordinator API for

00:03:39.066 --> 00:03:40.466 A:middle
reading and writing operations

00:03:40.536 --> 00:03:41.786 A:middle
as you can see in the example.

00:03:45.986 --> 00:03:48.526 A:middle
In iOS 13, users are in control

00:03:48.526 --> 00:03:49.546 A:middle
of which applications have

00:03:49.546 --> 00:03:50.676 A:middle
access to folders.

00:03:51.276 --> 00:03:53.136 A:middle
This access is listed and can be

00:03:53.136 --> 00:03:54.596 A:middle
revoked in the privacy pane

00:03:54.596 --> 00:03:55.806 A:middle
under the Files and Folder

00:03:55.806 --> 00:03:56.336 A:middle
section.

00:03:57.306 --> 00:03:58.946 A:middle
Be aware that because users can

00:03:58.946 --> 00:04:00.916 A:middle
revoke access at any time, you

00:03:58.946 --> 00:04:00.916 A:middle
revoke access at any time, you

00:04:00.916 --> 00:04:01.976 A:middle
need to make sure that your code

00:04:01.976 --> 00:04:03.466 A:middle
gracefully handles errors when

00:04:03.466 --> 00:04:04.926 A:middle
attempting to open documents or

00:04:04.926 --> 00:04:06.166 A:middle
when enumerating folders.

00:04:06.606 --> 00:04:10.636 A:middle
In this example, you can see how

00:04:10.636 --> 00:04:11.756 A:middle
you can maintain persistent

00:04:11.756 --> 00:04:13.036 A:middle
access to a folder across

00:04:13.036 --> 00:04:14.916 A:middle
application launches by storing

00:04:15.456 --> 00:04:17.016 A:middle
bookmark data and then

00:04:17.016 --> 00:04:19.755 A:middle
recreating the URL using the URL

00:04:19.926 --> 00:04:21.776 A:middle
resolvingBookmarkData options

00:04:21.776 --> 00:04:22.176 A:middle
call.

00:04:26.676 --> 00:04:29.166 A:middle
New in iOS 13, we've added

00:04:29.166 --> 00:04:30.936 A:middle
support for external USB drives,

00:04:31.056 --> 00:04:33.016 A:middle
thumb drives, and SMB servers.

00:04:34.756 --> 00:04:37.936 A:middle
Drives formatted as APFS, HFS+,

00:04:38.006 --> 00:04:40.046 A:middle
FAT and ExFAT are supported.

00:04:42.516 --> 00:04:44.306 A:middle
Drives can be plugged in either

00:04:44.306 --> 00:04:45.686 A:middle
on the USBC connector on the

00:04:45.736 --> 00:04:47.956 A:middle
iPad Pro or via the SD card

00:04:47.956 --> 00:04:48.716 A:middle
reader attachment.

00:04:49.976 --> 00:04:51.526 A:middle
They are automatically listed in

00:04:51.526 --> 00:04:53.286 A:middle
the sidebar of the files app or

00:04:53.436 --> 00:04:54.416 A:middle
in your app with the

00:04:54.416 --> 00:04:55.996 A:middle
UIDocumentPickerViewController

00:04:56.126 --> 00:04:57.256 A:middle
or document browser.

00:05:00.046 --> 00:05:01.886 A:middle
Users can also connect to SMB

00:05:01.886 --> 00:05:03.376 A:middle
servers using the Connect to

00:05:03.376 --> 00:05:05.296 A:middle
Server action using the same

00:05:05.296 --> 00:05:06.996 A:middle
keyboard shortcut as finder or

00:05:07.046 --> 00:05:08.076 A:middle
using the sidebar menu.

00:05:12.126 --> 00:05:13.206 A:middle
Any client of

00:05:13.206 --> 00:05:14.716 A:middle
UIDocumentBrowserViewController

00:05:14.716 --> 00:05:15.776 A:middle
API or

00:05:15.836 --> 00:05:17.286 A:middle
UIDocumentPickerViewController

00:05:17.286 --> 00:05:18.786 A:middle
API get the same support for

00:05:18.786 --> 00:05:20.876 A:middle
free as long as the app was

00:05:20.876 --> 00:05:23.166 A:middle
built using the iOS 13 SDK or

00:05:23.166 --> 00:05:23.586 A:middle
later.

00:05:24.586 --> 00:05:26.066 A:middle
However, there are few things

00:05:26.066 --> 00:05:27.286 A:middle
you need to check to make sure

00:05:27.286 --> 00:05:29.536 A:middle
your app has great support for

00:05:29.536 --> 00:05:30.716 A:middle
USB and SMB.

00:05:32.346 --> 00:05:33.796 A:middle
There are few assumptions that

00:05:33.796 --> 00:05:34.616 A:middle
are no longer true.

00:05:35.386 --> 00:05:36.996 A:middle
File access is no longer on a

00:05:36.996 --> 00:05:38.386 A:middle
single volume because they can

00:05:38.386 --> 00:05:39.466 A:middle
now be stored on external

00:05:39.466 --> 00:05:41.466 A:middle
volumes, such as USB drives or

00:05:41.466 --> 00:05:42.346 A:middle
SMB servers.

00:05:43.396 --> 00:05:45.096 A:middle
Volumes can disappear if the USB

00:05:45.096 --> 00:05:47.266 A:middle
drive is unplugged or if the

00:05:47.266 --> 00:05:48.516 A:middle
network connection to an SMB

00:05:48.516 --> 00:05:50.006 A:middle
server volume is lost.

00:05:51.276 --> 00:05:52.826 A:middle
Disk access can be slower than

00:05:52.826 --> 00:05:54.146 A:middle
what you expected in the past.

00:05:55.136 --> 00:05:56.186 A:middle
An operation that you would

00:05:56.186 --> 00:05:57.706 A:middle
assume is instant can now take

00:05:57.706 --> 00:05:59.396 A:middle
several seconds or even minutes

00:05:59.396 --> 00:06:00.296 A:middle
depending on the network

00:05:59.396 --> 00:06:00.296 A:middle
depending on the network

00:06:00.296 --> 00:06:01.766 A:middle
conditions or the speed of the

00:06:01.766 --> 00:06:02.546 A:middle
USB device.

00:06:03.556 --> 00:06:05.356 A:middle
Also, don't assume the

00:06:05.356 --> 00:06:07.176 A:middle
underlying file system is always

00:06:07.176 --> 00:06:08.926 A:middle
APFS or HFS+.

00:06:10.186 --> 00:06:11.386 A:middle
So how does this affect your

00:06:12.096 --> 00:06:12.163 A:middle
app?

00:06:14.456 --> 00:06:16.246 A:middle
If you need to move a file from

00:06:16.246 --> 00:06:18.106 A:middle
one location to another, use the

00:06:18.106 --> 00:06:20.866 A:middle
FileManager.moveItem at API and

00:06:21.066 --> 00:06:22.256 A:middle
this will take care of moving

00:06:22.256 --> 00:06:23.826 A:middle
files across volumes for you.

00:06:25.026 --> 00:06:26.546 A:middle
In the past, move and clone

00:06:26.546 --> 00:06:28.036 A:middle
operations were always fast.

00:06:28.876 --> 00:06:30.336 A:middle
When moving across volumes, the

00:06:30.336 --> 00:06:32.326 A:middle
operation can become slower copy

00:06:32.326 --> 00:06:32.836 A:middle
and delete.

00:06:33.296 --> 00:06:36.176 A:middle
If you use NSTemporaryDirectory

00:06:36.346 --> 00:06:37.866 A:middle
to save a temporary version of a

00:06:37.866 --> 00:06:39.906 A:middle
file, you should update your

00:06:39.906 --> 00:06:41.626 A:middle
code to choose the location of

00:06:41.626 --> 00:06:42.906 A:middle
the temporary folder based on

00:06:42.906 --> 00:06:44.166 A:middle
the ultimate destination of the

00:06:44.166 --> 00:06:45.136 A:middle
files written in it.

00:06:46.446 --> 00:06:47.276 A:middle
You can do this with the

00:06:47.276 --> 00:06:48.776 A:middle
following File Manager call,

00:06:50.176 --> 00:06:52.156 A:middle
File Manager URL for

00:06:52.156 --> 00:06:54.336 A:middle
itemReplacementDirectory in

00:06:54.476 --> 00:06:56.816 A:middle
userDomainMask appropriateFor

00:06:56.946 --> 00:06:57.456 A:middle
URL.

00:06:58.426 --> 00:06:59.316 A:middle
This will always give you the

00:06:59.316 --> 00:07:00.656 A:middle
right temporary directory to

00:06:59.316 --> 00:07:00.656 A:middle
right temporary directory to

00:07:00.656 --> 00:07:01.516 A:middle
write files, to.

00:07:02.076 --> 00:07:05.136 A:middle
In the past, your app may have

00:07:05.136 --> 00:07:06.756 A:middle
assumed that a file may never

00:07:06.756 --> 00:07:08.936 A:middle
disappear while it is open and

00:07:08.936 --> 00:07:10.356 A:middle
this is no longer true because

00:07:10.356 --> 00:07:12.106 A:middle
USB drives can be unplugged and

00:07:12.106 --> 00:07:13.686 A:middle
SMB server connections can be

00:07:13.686 --> 00:07:14.296 A:middle
interrupted.

00:07:15.126 --> 00:07:16.516 A:middle
This may cause your app to fail

00:07:16.516 --> 00:07:17.656 A:middle
while reading or writing file

00:07:17.656 --> 00:07:18.276 A:middle
contents.

00:07:19.216 --> 00:07:20.926 A:middle
Your app should check for errors

00:07:20.926 --> 00:07:21.876 A:middle
and fail gracefully.

00:07:22.876 --> 00:07:24.446 A:middle
One suggestion is if your app

00:07:24.446 --> 00:07:26.096 A:middle
fails to write a file, it could

00:07:26.096 --> 00:07:26.556 A:middle
present a

00:07:26.556 --> 00:07:28.126 A:middle
UIDocumentPickerViewController

00:07:28.256 --> 00:07:29.296 A:middle
to let the user choose an

00:07:29.296 --> 00:07:31.596 A:middle
alternate location to save the

00:07:32.406 --> 00:07:32.516 A:middle
file.

00:07:32.726 --> 00:07:34.186 A:middle
Reading or writing a file stored

00:07:34.186 --> 00:07:35.986 A:middle
on a USB drive or on a distant

00:07:35.986 --> 00:07:38.496 A:middle
SMB server can be slow so you

00:07:38.496 --> 00:07:39.546 A:middle
need to make sure your app

00:07:39.546 --> 00:07:40.846 A:middle
doesn't hang while performing a

00:07:40.846 --> 00:07:41.736 A:middle
file operation.

00:07:42.196 --> 00:07:43.956 A:middle
Always perform file system

00:07:43.956 --> 00:07:45.286 A:middle
operations on a background

00:07:45.286 --> 00:07:45.526 A:middle
queue.

00:07:46.736 --> 00:07:47.946 A:middle
We also recommend that you add

00:07:47.946 --> 00:07:50.076 A:middle
UI like an activity indicator to

00:07:50.076 --> 00:07:51.236 A:middle
let the user know something is

00:07:51.236 --> 00:07:53.966 A:middle
happening, and offering a way

00:07:54.046 --> 00:07:55.456 A:middle
for your user to cancel the

00:07:55.456 --> 00:07:56.756 A:middle
operation is a great idea.

00:07:57.876 --> 00:07:59.326 A:middle
Otherwise the user might feel

00:07:59.326 --> 00:08:00.366 A:middle
like the application is

00:07:59.326 --> 00:08:00.366 A:middle
like the application is

00:08:00.366 --> 00:08:00.976 A:middle
unresponsive.

00:08:01.426 --> 00:08:05.186 A:middle
When a document is stored on a

00:08:05.186 --> 00:08:07.216 A:middle
USB drive or remote SMB server,

00:08:07.616 --> 00:08:09.686 A:middle
LIFS is reported instead of the

00:08:09.686 --> 00:08:10.936 A:middle
file system the media is

00:08:10.936 --> 00:08:11.736 A:middle
formatted as.

00:08:12.546 --> 00:08:13.606 A:middle
It's likely that your app should

00:08:13.606 --> 00:08:14.696 A:middle
not worry about the underlying

00:08:14.696 --> 00:08:15.406 A:middle
file system.

00:08:16.046 --> 00:08:17.236 A:middle
Instead you should check the

00:08:17.236 --> 00:08:18.766 A:middle
file system capabilities to know

00:08:18.766 --> 00:08:20.396 A:middle
which file system operations are

00:08:20.396 --> 00:08:20.906 A:middle
supported.

00:08:21.916 --> 00:08:23.676 A:middle
LIFS is a file system

00:08:23.676 --> 00:08:24.986 A:middle
abstraction and it do not look

00:08:24.986 --> 00:08:26.196 A:middle
for its presence directly.

00:08:27.076 --> 00:08:28.786 A:middle
To know more about LIFS, we

00:08:28.786 --> 00:08:30.076 A:middle
recommend that you look at the

00:08:30.076 --> 00:08:31.276 A:middle
What's New in File Systems

00:08:31.276 --> 00:08:31.756 A:middle
session.

00:08:36.116 --> 00:08:38.176 A:middle
New in iOS 13, there's

00:08:38.176 --> 00:08:39.756 A:middle
additional customization support

00:08:39.756 --> 00:08:39.823 A:middle
in

00:08:39.823 --> 00:08:41.395 A:middle
UIDocumentBrowserViewController.

00:08:41.556 --> 00:08:45.536 A:middle
Let's take a look at this now.

00:08:45.536 --> 00:08:47.016 A:middle
Now, you can choose to always

00:08:47.016 --> 00:08:48.486 A:middle
show file extensions by setting

00:08:48.486 --> 00:08:49.896 A:middle
the shouldShowFileExtensions

00:08:49.896 --> 00:08:50.716 A:middle
property to true.

00:08:51.296 --> 00:08:54.066 A:middle
The Create Document button can

00:08:54.066 --> 00:08:55.876 A:middle
now also be customized to adjust

00:08:55.876 --> 00:08:57.146 A:middle
the aspect ratio of the button

00:08:57.146 --> 00:08:58.356 A:middle
icon by setting the

00:08:58.356 --> 00:09:00.126 A:middle
defaultDocumentAspectRatio

00:08:58.356 --> 00:09:00.126 A:middle
defaultDocumentAspectRatio

00:09:00.126 --> 00:09:00.646 A:middle
property.

00:09:01.626 --> 00:09:03.536 A:middle
And the button titled Text can

00:09:03.536 --> 00:09:04.906 A:middle
now be changed by setting the

00:09:04.906 --> 00:09:05.826 A:middle
localizedCreate

00:09:05.826 --> 00:09:07.466 A:middle
DocumentActionTitle property.

00:09:07.916 --> 00:09:10.206 A:middle
And now Lyn will talk about

00:09:10.206 --> 00:09:11.786 A:middle
What's New in Quick Look.

00:09:14.476 --> 00:09:16.076 A:middle
&gt;&gt; Fetching File Thumbnails in

00:09:16.076 --> 00:09:17.116 A:middle
Your App.

00:09:17.386 --> 00:09:18.626 A:middle
This is for those of you who

00:09:18.626 --> 00:09:19.976 A:middle
want to enhance the appearance

00:09:19.976 --> 00:09:21.166 A:middle
of your application by

00:09:21.166 --> 00:09:22.886 A:middle
displaying rich file thumbnails.

00:09:24.476 --> 00:09:26.186 A:middle
So instead of something like

00:09:26.186 --> 00:09:29.106 A:middle
this, you could have something

00:09:29.106 --> 00:09:29.786 A:middle
like this.

00:09:31.556 --> 00:09:33.306 A:middle
Quick Look thumbnailing is a new

00:09:33.306 --> 00:09:34.956 A:middle
cross platform framework for

00:09:34.956 --> 00:09:36.666 A:middle
retrieving thumbnail images for

00:09:36.666 --> 00:09:37.606 A:middle
file URLs.

00:09:38.276 --> 00:09:40.196 A:middle
This is new functionality on iOS

00:09:40.196 --> 00:09:42.106 A:middle
and replaces the C API for

00:09:42.106 --> 00:09:43.856 A:middle
QLThumbnail on macOS.

00:09:44.656 --> 00:09:45.766 A:middle
It also replaces

00:09:45.766 --> 00:09:47.936 A:middle
NSURLThumbnailDictionaryKey.

00:09:49.216 --> 00:09:51.326 A:middle
iOS and macOS provide built-in

00:09:51.326 --> 00:09:52.846 A:middle
support for several file types,

00:09:52.986 --> 00:09:54.986 A:middle
such as images, PDFs, text

00:09:54.986 --> 00:09:56.486 A:middle
files, videos, et cetera.

00:09:56.806 --> 00:09:59.246 A:middle
You can also provide support for

00:09:59.246 --> 00:10:00.486 A:middle
your own file types with

00:09:59.246 --> 00:10:00.486 A:middle
your own file types with

00:10:00.486 --> 00:10:01.626 A:middle
thumbnail extensions.

00:10:04.356 --> 00:10:05.696 A:middle
Quick Look thumbnailing is

00:10:05.696 --> 00:10:06.936 A:middle
non-UI framework.

00:10:07.576 --> 00:10:09.526 A:middle
We don't import UIKit or AppKit

00:10:09.526 --> 00:10:10.086 A:middle
by default.

00:10:10.796 --> 00:10:12.526 A:middle
We can get CGImages of your

00:10:12.526 --> 00:10:14.176 A:middle
thumbnail without either but you

00:10:14.176 --> 00:10:16.476 A:middle
can also obtain UIImages on iOS

00:10:16.476 --> 00:10:18.836 A:middle
or NSImages on macOS by

00:10:18.836 --> 00:10:20.746 A:middle
explicitly linking UIKit or

00:10:20.746 --> 00:10:22.016 A:middle
AppKit respectively.

00:10:23.226 --> 00:10:25.286 A:middle
It is asynchronous so it won't

00:10:25.286 --> 00:10:26.206 A:middle
block while retrieving the

00:10:26.206 --> 00:10:28.706 A:middle
thumbnail and it supports

00:10:28.706 --> 00:10:30.366 A:middle
cancellation in case you decide

00:10:30.366 --> 00:10:31.366 A:middle
you don't want that thumbnail

00:10:31.366 --> 00:10:31.896 A:middle
after all.

00:10:34.996 --> 00:10:36.556 A:middle
Let's start with a big picture

00:10:36.556 --> 00:10:37.086 A:middle
overview.

00:10:37.536 --> 00:10:39.336 A:middle
To get a thumbnail, you start by

00:10:39.336 --> 00:10:40.266 A:middle
creating a

00:10:40.266 --> 00:10:42.626 A:middle
QLThumbnailGenerator.Request and

00:10:42.626 --> 00:10:43.566 A:middle
then pass it to a

00:10:43.566 --> 00:10:46.316 A:middle
QLThumbnailGenerator specifying

00:10:46.316 --> 00:10:47.736 A:middle
if you would like to be notified

00:10:47.736 --> 00:10:49.406 A:middle
every time a new representation

00:10:49.406 --> 00:10:51.336 A:middle
of the thumbnail is available or

00:10:51.336 --> 00:10:52.156 A:middle
only when the best

00:10:52.156 --> 00:10:53.796 A:middle
representation you requested is

00:10:53.796 --> 00:10:54.376 A:middle
complete.

00:10:54.416 --> 00:10:58.366 A:middle
You can request different

00:10:58.366 --> 00:10:59.806 A:middle
representations of thumbnails

00:10:59.926 --> 00:11:01.066 A:middle
which will have different

00:10:59.926 --> 00:11:01.066 A:middle
which will have different

00:11:01.066 --> 00:11:02.636 A:middle
quality and performance costs.

00:11:04.066 --> 00:11:05.506 A:middle
Icon is the generic image

00:11:05.506 --> 00:11:06.986 A:middle
associated with that file type.

00:11:07.586 --> 00:11:08.716 A:middle
This will be the same for all

00:11:08.716 --> 00:11:10.016 A:middle
files of a given type.

00:11:10.436 --> 00:11:13.306 A:middle
Low quality thumbnail is a

00:11:13.306 --> 00:11:14.556 A:middle
faster thumbnail that we were

00:11:14.556 --> 00:11:16.456 A:middle
able to provide that may not be

00:11:16.456 --> 00:11:18.066 A:middle
exactly the size you specified.

00:11:19.026 --> 00:11:20.166 A:middle
This typically comes from a

00:11:20.166 --> 00:11:21.886 A:middle
cached version of the thumbnail

00:11:21.956 --> 00:11:23.636 A:middle
or possibly thumbnails embedded

00:11:23.636 --> 00:11:24.776 A:middle
in the file itself.

00:11:26.176 --> 00:11:27.956 A:middle
The last representation type

00:11:28.216 --> 00:11:29.796 A:middle
thumbnail is a full quality

00:11:29.796 --> 00:11:30.836 A:middle
version of the thumbnail,

00:11:31.316 --> 00:11:32.886 A:middle
matching the request exactly.

00:11:33.436 --> 00:11:35.196 A:middle
This will take the longest to

00:11:35.196 --> 00:11:35.676 A:middle
generate.

00:11:37.426 --> 00:11:38.986 A:middle
For convenience, you can also

00:11:38.986 --> 00:11:41.196 A:middle
specify all to get any type of

00:11:41.196 --> 00:11:42.166 A:middle
available thumbnail.

00:11:42.596 --> 00:11:46.426 A:middle
When you create a QLThumbnail

00:11:46.426 --> 00:11:48.296 A:middle
generation request, you specify

00:11:48.296 --> 00:11:50.486 A:middle
size, scale and representation

00:11:50.486 --> 00:11:51.376 A:middle
types you would like.

00:11:51.866 --> 00:11:53.926 A:middle
You may only care about the full

00:11:53.926 --> 00:11:55.986 A:middle
quality thumbnail or you may be

00:11:55.986 --> 00:11:58.176 A:middle
OK with an icon or lower quality

00:11:58.176 --> 00:11:58.726 A:middle
version.

00:11:58.986 --> 00:12:00.886 A:middle
It's best to specify all

00:11:58.986 --> 00:12:00.886 A:middle
It's best to specify all

00:12:00.916 --> 00:12:02.476 A:middle
representation types that will

00:12:02.476 --> 00:12:04.496 A:middle
work for you as not all three

00:12:04.586 --> 00:12:06.086 A:middle
types may be available for a

00:12:06.086 --> 00:12:06.876 A:middle
given thumbnail.

00:12:09.786 --> 00:12:10.576 A:middle
You will get a

00:12:10.576 --> 00:12:12.386 A:middle
QLThumbnailRepresentation back

00:12:13.096 --> 00:12:14.386 A:middle
which will specify the type of

00:12:14.386 --> 00:12:16.346 A:middle
thumbnail it is, icon, low

00:12:16.346 --> 00:12:18.546 A:middle
quality or thumbnail and an

00:12:18.546 --> 00:12:20.296 A:middle
image which can either be

00:12:20.296 --> 00:12:22.716 A:middle
accessed as a CGImage, or if

00:12:22.716 --> 00:12:24.096 A:middle
you've linked UIKit on iOS or

00:12:24.096 --> 00:12:26.876 A:middle
AppKit on macOS, you can get a

00:12:26.876 --> 00:12:28.466 A:middle
UIImage or NS Image

00:12:28.566 --> 00:12:29.186 A:middle
respectively.

00:12:29.546 --> 00:12:32.246 A:middle
To get that

00:12:32.246 --> 00:12:34.396 A:middle
QLThumbnailRepresentation, you

00:12:34.396 --> 00:12:35.926 A:middle
pass your thumbnail request to a

00:12:35.926 --> 00:12:37.326 A:middle
QLThumbnailGenerator.

00:12:37.676 --> 00:12:39.646 A:middle
If you just want the best

00:12:39.646 --> 00:12:41.696 A:middle
quality thumbnail available, use

00:12:41.696 --> 00:12:43.296 A:middle
generateBestRepresentation.

00:12:43.916 --> 00:12:45.116 A:middle
This will call your completion

00:12:45.116 --> 00:12:46.626 A:middle
handler with the best version of

00:12:46.626 --> 00:12:47.716 A:middle
your thumbnail request that

00:12:47.716 --> 00:12:50.796 A:middle
could be created.

00:12:50.796 --> 00:12:52.296 A:middle
Or you may prefer to get

00:12:52.296 --> 00:12:54.336 A:middle
incremental updates by providing

00:12:54.336 --> 00:12:55.896 A:middle
an updateHandler to generate

00:12:55.896 --> 00:12:57.396 A:middle
representations that will be

00:12:57.396 --> 00:12:59.326 A:middle
called as each representation

00:12:59.326 --> 00:13:00.206 A:middle
becomes available.

00:12:59.326 --> 00:13:00.206 A:middle
becomes available.

00:13:00.676 --> 00:13:02.566 A:middle
You can use this, for example,

00:13:02.566 --> 00:13:04.436 A:middle
to update your UI quickly and

00:13:04.506 --> 00:13:05.946 A:middle
then improve the quality of what

00:13:05.946 --> 00:13:07.636 A:middle
is shown as better thumbnails

00:13:07.916 --> 00:13:08.256 A:middle
arrive.

00:13:08.826 --> 00:13:12.446 A:middle
So that's enough about thumbnail

00:13:12.446 --> 00:13:13.026 A:middle
retrieval.

00:13:13.146 --> 00:13:14.486 A:middle
Let's talk about using Quick

00:13:14.486 --> 00:13:16.496 A:middle
Look to edit images, PDFs and

00:13:16.496 --> 00:13:17.136 A:middle
videos.

00:13:20.146 --> 00:13:21.886 A:middle
Quick Look provides API to

00:13:21.886 --> 00:13:23.336 A:middle
preview documents of various

00:13:23.336 --> 00:13:24.606 A:middle
types of files on iOS.

00:13:25.406 --> 00:13:26.616 A:middle
It also allows you to provide

00:13:26.616 --> 00:13:28.156 A:middle
custom previews for your own

00:13:28.156 --> 00:13:29.646 A:middle
documents via extensions.

00:13:31.116 --> 00:13:33.386 A:middle
Now in iOS 13, we've also added

00:13:33.386 --> 00:13:35.186 A:middle
support to quickly edit images,

00:13:35.346 --> 00:13:36.906 A:middle
PDFs and videos with the

00:13:36.906 --> 00:13:38.236 A:middle
QLPreviewController.

00:13:38.616 --> 00:13:42.516 A:middle
The QLPreviewController is what

00:13:42.516 --> 00:13:43.956 A:middle
you use to preview a file.

00:13:44.316 --> 00:13:46.366 A:middle
To make use if it simply

00:13:46.366 --> 00:13:47.526 A:middle
allocate an instance of

00:13:47.526 --> 00:13:49.246 A:middle
QLPreviewController and set a

00:13:49.246 --> 00:13:50.846 A:middle
data source and delegate before

00:13:50.846 --> 00:13:51.486 A:middle
presenting it.

00:13:52.416 --> 00:13:53.686 A:middle
To learn more about Quick Look

00:13:53.686 --> 00:13:55.386 A:middle
and the QLPreviewController, we

00:13:55.386 --> 00:13:56.586 A:middle
highly encourage you to check

00:13:56.586 --> 00:13:59.036 A:middle
out our WWDC presentation from

00:13:59.036 --> 00:14:01.296 A:middle
2018 Quick Look Previews from

00:13:59.036 --> 00:14:01.296 A:middle
2018 Quick Look Previews from

00:14:01.296 --> 00:14:01.906 A:middle
the Ground Up.

00:14:02.486 --> 00:14:05.886 A:middle
New to iOS 13, the

00:14:05.886 --> 00:14:07.376 A:middle
QLPreviewController also

00:14:07.376 --> 00:14:09.016 A:middle
provides access to Markup, the

00:14:09.426 --> 00:14:11.046 A:middle
editing tools available when you

00:14:11.046 --> 00:14:13.376 A:middle
preview a document and files or

00:14:13.666 --> 00:14:14.916 A:middle
edit an attachment in mail.

00:14:15.426 --> 00:14:18.416 A:middle
This is available for images and

00:14:21.016 --> 00:14:21.146 A:middle
PDFs.

00:14:21.336 --> 00:14:22.746 A:middle
QLPreviewController also

00:14:22.746 --> 00:14:24.146 A:middle
provides support for trimming

00:14:24.146 --> 00:14:25.186 A:middle
and rotating videos.

00:14:25.596 --> 00:14:28.086 A:middle
To use these features, you just

00:14:28.086 --> 00:14:29.406 A:middle
have to enable editing mode.

00:14:29.806 --> 00:14:33.836 A:middle
All you have to do is implement

00:14:33.836 --> 00:14:35.216 A:middle
an optional delegate method

00:14:35.686 --> 00:14:37.416 A:middle
editing mode for preview item.

00:14:37.866 --> 00:14:40.336 A:middle
By default, editing is disabled

00:14:40.716 --> 00:14:43.046 A:middle
but it is possible to enable it

00:14:43.046 --> 00:14:44.646 A:middle
on a per item basis.

00:14:45.166 --> 00:14:46.536 A:middle
This delegate method allows you

00:14:46.536 --> 00:14:48.516 A:middle
to specify both if you want

00:14:48.516 --> 00:14:50.556 A:middle
editing capabilities and how you

00:14:50.556 --> 00:14:51.776 A:middle
want to handle the resulting

00:14:51.776 --> 00:14:52.286 A:middle
file.

00:14:52.816 --> 00:14:56.146 A:middle
You can have the

00:14:56.146 --> 00:14:57.886 A:middle
QLPreviewController overwrite

00:14:57.886 --> 00:14:59.036 A:middle
the original file with the

00:14:59.036 --> 00:15:00.486 A:middle
user's edited version.

00:14:59.036 --> 00:15:00.486 A:middle
user's edited version.

00:15:00.706 --> 00:15:03.426 A:middle
To do so, return updateContents

00:15:03.426 --> 00:15:05.206 A:middle
from editing mode for preview

00:15:05.206 --> 00:15:05.666 A:middle
item.

00:15:07.556 --> 00:15:09.246 A:middle
If you need to react to edits

00:15:09.246 --> 00:15:11.156 A:middle
being successfully saved, you

00:15:11.156 --> 00:15:12.796 A:middle
can also implement the optional

00:15:12.796 --> 00:15:15.266 A:middle
didUpdateContentsof previewItem

00:15:17.806 --> 00:15:18.026 A:middle
method.

00:15:18.116 --> 00:15:19.816 A:middle
Or you may prefer to use

00:15:19.816 --> 00:15:21.556 A:middle
QLPreviewController to create

00:15:21.556 --> 00:15:23.336 A:middle
edited copies of the files being

00:15:23.336 --> 00:15:24.716 A:middle
previewed and manage them

00:15:24.716 --> 00:15:25.226 A:middle
yourself.

00:15:25.826 --> 00:15:28.526 A:middle
To do so return createCopy from

00:15:28.526 --> 00:15:30.306 A:middle
editing mode for preview item

00:15:30.846 --> 00:15:32.796 A:middle
and implement the delegate

00:15:32.796 --> 00:15:35.226 A:middle
method that saved edited copy of

00:15:35.316 --> 00:15:36.786 A:middle
preview item at modified

00:15:36.786 --> 00:15:37.906 A:middle
contents URL.

00:15:42.316 --> 00:15:44.456 A:middle
Quick Look Extension APIs on

00:15:44.456 --> 00:15:45.056 A:middle
macOS.

00:15:46.556 --> 00:15:47.716 A:middle
So we've just talked about

00:15:47.716 --> 00:15:49.476 A:middle
getting and using thumbnails and

00:15:49.476 --> 00:15:50.476 A:middle
previews for files.

00:15:51.476 --> 00:15:52.466 A:middle
Now let's talk about how to

00:15:52.466 --> 00:15:54.046 A:middle
provide thumbnails and previews

00:15:54.046 --> 00:15:55.316 A:middle
for your own file types.

00:15:55.646 --> 00:15:58.406 A:middle
Already on iOS, an app can

00:15:58.406 --> 00:15:59.936 A:middle
implement a Quick Look thumbnail

00:15:59.936 --> 00:16:01.626 A:middle
and preview extension to provide

00:15:59.936 --> 00:16:01.626 A:middle
and preview extension to provide

00:16:01.626 --> 00:16:03.416 A:middle
systemwide thumbnail and preview

00:16:03.416 --> 00:16:05.086 A:middle
support for its own documents.

00:16:05.716 --> 00:16:06.626 A:middle
Now the same Quick Look

00:16:06.626 --> 00:16:08.536 A:middle
extension API is available on

00:16:08.536 --> 00:16:09.286 A:middle
macOS.

00:16:11.116 --> 00:16:12.806 A:middle
Thumbnails are used throughout

00:16:12.806 --> 00:16:14.946 A:middle
macOS and iOS to allow users to

00:16:14.946 --> 00:16:16.356 A:middle
identify files quickly.

00:16:17.176 --> 00:16:18.626 A:middle
For instance, you can see on the

00:16:18.626 --> 00:16:20.306 A:middle
screenshot how macOS makes use

00:16:20.306 --> 00:16:21.246 A:middle
of them in Finder.

00:16:21.506 --> 00:16:23.686 A:middle
MacOS can generate thumbnails

00:16:23.686 --> 00:16:26.176 A:middle
for many common file types, but

00:16:26.176 --> 00:16:27.276 A:middle
implementing a thumbnail

00:16:27.276 --> 00:16:28.766 A:middle
extension allows you to also

00:16:28.766 --> 00:16:30.126 A:middle
provide thumbnails for your own

00:16:30.126 --> 00:16:31.996 A:middle
file types so that they can have

00:16:31.996 --> 00:16:33.826 A:middle
a rich representation in Finder

00:16:33.826 --> 00:16:35.026 A:middle
and elsewhere a thumbnail might

00:16:35.026 --> 00:16:35.386 A:middle
show.

00:16:35.946 --> 00:16:38.546 A:middle
The extension API replaces the

00:16:38.546 --> 00:16:40.446 A:middle
old CF plug-in based generator

00:16:40.446 --> 00:16:40.976 A:middle
system.

00:16:41.116 --> 00:16:42.566 A:middle
If you have a Quick Look

00:16:42.566 --> 00:16:44.506 A:middle
generator, consider migrating

00:16:44.506 --> 00:16:44.876 A:middle
soon.

00:16:45.206 --> 00:16:47.866 A:middle
I say Quick Look extension in a

00:16:47.866 --> 00:16:49.176 A:middle
general sense here as the

00:16:49.176 --> 00:16:50.756 A:middle
thumbnail extension point comes

00:16:50.756 --> 00:16:51.936 A:middle
from Quick Look thumbnailing.

00:16:52.566 --> 00:16:53.996 A:middle
This was previously vended from

00:16:53.996 --> 00:16:55.466 A:middle
the Quick Look framework on iOS

00:16:56.276 --> 00:16:57.516 A:middle
but you might want to consider

00:16:57.516 --> 00:16:58.896 A:middle
importing it from the Quick Look

00:16:58.896 --> 00:17:00.126 A:middle
thumbnailing instead if you do

00:16:58.896 --> 00:17:00.126 A:middle
thumbnailing instead if you do

00:17:00.126 --> 00:17:02.406 A:middle
not need UIKit as this will make

00:17:02.406 --> 00:17:03.626 A:middle
your extension leaner.

00:17:06.116 --> 00:17:07.915 A:middle
To create a thumbnail extension,

00:17:07.996 --> 00:17:09.816 A:middle
add a new target in your Xcode

00:17:09.816 --> 00:17:11.156 A:middle
project using the thumbnail

00:17:11.156 --> 00:17:12.246 A:middle
extension template.

00:17:13.976 --> 00:17:15.586 A:middle
After setting up your extension

00:17:15.586 --> 00:17:17.146 A:middle
target, you will be able to

00:17:17.146 --> 00:17:18.516 A:middle
start implementing your

00:17:18.516 --> 00:17:21.026 A:middle
QLThumbnailProvider subclass.

00:17:21.126 --> 00:17:22.316 A:middle
You can draw your thumbnail

00:17:22.316 --> 00:17:24.316 A:middle
using either a CG context, an

00:17:24.316 --> 00:17:26.106 A:middle
AppKit context, or you can

00:17:26.106 --> 00:17:28.415 A:middle
provide a file URL to an image.

00:17:31.116 --> 00:17:32.846 A:middle
Here's a quick example where we

00:17:32.846 --> 00:17:34.316 A:middle
overwrite the provide thumbnail

00:17:34.316 --> 00:17:35.776 A:middle
for request handler method.

00:17:36.206 --> 00:17:37.986 A:middle
We extensively cover this part

00:17:37.986 --> 00:17:39.466 A:middle
of the Quick Look API in our

00:17:39.466 --> 00:17:43.016 A:middle
session from WWDC 2017 "Building

00:17:43.016 --> 00:17:44.996 A:middle
Great Document-based Apps in iOS

00:17:44.996 --> 00:17:45.496 A:middle
11".

00:17:46.016 --> 00:17:47.336 A:middle
We highly encourage you to check

00:17:47.336 --> 00:17:47.666 A:middle
it out.

00:17:47.996 --> 00:17:50.106 A:middle
In a nutshell, you will get a

00:17:50.106 --> 00:17:52.006 A:middle
QLFileThumbnailRequest which

00:17:52.006 --> 00:17:54.146 A:middle
will have the URL of the file,

00:17:54.356 --> 00:17:56.596 A:middle
the maximum and minimum sizes of

00:17:56.596 --> 00:17:58.226 A:middle
the thumbnail, and its scale.

00:17:58.766 --> 00:18:00.896 A:middle
Use these to create a thumbnail

00:17:58.766 --> 00:18:00.896 A:middle
Use these to create a thumbnail

00:18:00.896 --> 00:18:02.466 A:middle
matching those specifications.

00:18:04.306 --> 00:18:06.216 A:middle
For each thumbnail request, the

00:18:06.216 --> 00:18:07.846 A:middle
API expects you to create a

00:18:07.846 --> 00:18:10.006 A:middle
QLThumbnailReply which will be

00:18:10.006 --> 00:18:11.286 A:middle
used to generate the thumbnail.

00:18:11.526 --> 00:18:13.476 A:middle
Pass the QLThumbnailReply to the

00:18:13.476 --> 00:18:14.716 A:middle
completion handler above.

00:18:18.346 --> 00:18:19.536 A:middle
To debug your thumbnail

00:18:19.536 --> 00:18:21.616 A:middle
extension on macOS, you can use

00:18:21.616 --> 00:18:22.436 A:middle
QLManage.

00:18:22.466 --> 00:18:24.506 A:middle
If you have written Quick Look

00:18:24.506 --> 00:18:26.096 A:middle
generators in the past, you may

00:18:26.096 --> 00:18:27.036 A:middle
recognize this tool.

00:18:27.036 --> 00:18:29.066 A:middle
Build and run your extension

00:18:29.066 --> 00:18:30.746 A:middle
target in Xcode to register your

00:18:30.746 --> 00:18:32.106 A:middle
extension with the system.

00:18:32.856 --> 00:18:34.606 A:middle
Then use QLManage to generate a

00:18:34.606 --> 00:18:36.176 A:middle
thumbnail of your file type and

00:18:36.176 --> 00:18:37.536 A:middle
attach to your extension in

00:18:37.566 --> 00:18:37.976 A:middle
Xcode.

00:18:40.096 --> 00:18:41.866 A:middle
Preview Extensions for Files.

00:18:42.196 --> 00:18:44.266 A:middle
New this year, Quick Look on

00:18:44.266 --> 00:18:46.286 A:middle
macOS also allows you to provide

00:18:46.286 --> 00:18:48.276 A:middle
previews for your own file types

00:18:48.276 --> 00:18:49.896 A:middle
by implementing a preview

00:18:49.896 --> 00:18:50.646 A:middle
extension.

00:18:51.956 --> 00:18:53.406 A:middle
Quick Look preview extensions

00:18:53.406 --> 00:18:54.946 A:middle
already existed to support Core

00:18:54.946 --> 00:18:55.966 A:middle
Spotlight previews.

00:18:56.326 --> 00:18:59.306 A:middle
See WWDC 2017's What's New in

00:18:59.306 --> 00:19:00.846 A:middle
Core Spotlight for iOS and

00:18:59.306 --> 00:19:00.846 A:middle
Core Spotlight for iOS and

00:19:00.846 --> 00:19:01.456 A:middle
macOS.

00:19:02.406 --> 00:19:03.596 A:middle
This year we've also added

00:19:03.596 --> 00:19:04.826 A:middle
support for file previews.

00:19:05.236 --> 00:19:07.906 A:middle
With the extension, you can now

00:19:07.906 --> 00:19:09.136 A:middle
directly provide a view to

00:19:09.136 --> 00:19:10.196 A:middle
display your preview.

00:19:11.146 --> 00:19:12.236 A:middle
This is different from the old

00:19:12.236 --> 00:19:13.686 A:middle
Quick Look generators in which

00:19:13.686 --> 00:19:15.596 A:middle
you provided data or a URL for

00:19:15.596 --> 00:19:16.766 A:middle
the system to present.

00:19:17.146 --> 00:19:19.436 A:middle
The new extension API allows you

00:19:19.436 --> 00:19:20.556 A:middle
greater control over the

00:19:20.556 --> 00:19:21.846 A:middle
appearance of your preview.

00:19:22.546 --> 00:19:23.966 A:middle
We recommend you migrate off the

00:19:23.966 --> 00:19:25.336 A:middle
old Quick Look generators as

00:19:25.336 --> 00:19:26.776 A:middle
they will be deprecated in a

00:19:26.776 --> 00:19:27.606 A:middle
future release.

00:19:30.436 --> 00:19:32.206 A:middle
To create a Preview Extension,

00:19:32.206 --> 00:19:33.826 A:middle
add a new target in your project

00:19:33.826 --> 00:19:35.636 A:middle
and select the Preview Extension

00:19:35.636 --> 00:19:36.186 A:middle
template.

00:19:38.756 --> 00:19:41.066 A:middle
The API is identical to iOS

00:19:41.066 --> 00:19:41.996 A:middle
Preview extensions.

00:19:41.996 --> 00:19:44.886 A:middle
See WWDC 2018's Quick Look

00:19:44.886 --> 00:19:46.036 A:middle
Previews from the Ground Up.

00:19:46.436 --> 00:19:48.646 A:middle
As a quick summary, you will

00:19:48.646 --> 00:19:49.766 A:middle
want to declare the list of

00:19:49.766 --> 00:19:51.006 A:middle
supported UTIs in

00:19:51.006 --> 00:19:53.036 A:middle
QLSupportedContentTypes in your

00:19:53.036 --> 00:19:53.826 A:middle
Info.plist.

00:19:54.966 --> 00:19:57.026 A:middle
This must exactly match the UTIs

00:19:57.026 --> 00:19:58.706 A:middle
of the files you want previewed.

00:19:59.216 --> 00:20:01.186 A:middle
Matching by parent UTI is not

00:19:59.216 --> 00:20:01.186 A:middle
Matching by parent UTI is not

00:20:01.186 --> 00:20:01.726 A:middle
supported.

00:20:02.136 --> 00:20:03.986 A:middle
The template will provide a view

00:20:03.986 --> 00:20:05.246 A:middle
controller which will be what

00:20:05.246 --> 00:20:06.756 A:middle
you prepare your preview in.

00:20:07.216 --> 00:20:10.366 A:middle
Here's a quick example of the

00:20:10.366 --> 00:20:11.466 A:middle
view controller template.

00:20:12.176 --> 00:20:14.156 A:middle
Implement, preparePreviewofFile

00:20:14.156 --> 00:20:16.126 A:middle
at URL to prepare your view

00:20:16.126 --> 00:20:16.696 A:middle
controller.

00:20:16.996 --> 00:20:18.356 A:middle
And once you're ready, call the

00:20:18.356 --> 00:20:19.256 A:middle
completion handler.

00:20:20.026 --> 00:20:21.556 A:middle
The QLPreviewView presenting you

00:20:21.556 --> 00:20:23.096 A:middle
preview will show a spinning

00:20:23.096 --> 00:20:24.476 A:middle
wheel until this completion

00:20:24.476 --> 00:20:25.406 A:middle
handler is called.

00:20:25.816 --> 00:20:27.046 A:middle
So get your preview ready as

00:20:27.046 --> 00:20:28.166 A:middle
quickly as possible.

00:20:30.276 --> 00:20:32.176 A:middle
Keep in mind, your preview can

00:20:32.176 --> 00:20:34.036 A:middle
be shown in any QLPreviewView

00:20:34.726 --> 00:20:36.166 A:middle
which may be the Preview panel,

00:20:36.336 --> 00:20:37.636 A:middle
the Column View sidebar,

00:20:37.876 --> 00:20:39.556 A:middle
Spotlight or any client of the

00:20:39.556 --> 00:20:41.236 A:middle
QLPreviewView at all.

00:20:45.716 --> 00:20:47.546 A:middle
To debug, launch your extension

00:20:47.546 --> 00:20:48.486 A:middle
target with Xcode.

00:20:48.756 --> 00:20:51.146 A:middle
Note that Xcode will lunch the

00:20:51.146 --> 00:20:52.616 A:middle
Quick Look simulator by default.

00:20:53.076 --> 00:20:54.586 A:middle
This is to aid in debugging Core

00:20:54.586 --> 00:20:55.966 A:middle
Spotlight previews which are

00:20:55.966 --> 00:20:57.386 A:middle
extension can also provide

00:20:57.386 --> 00:20:57.966 A:middle
support for.

00:20:58.516 --> 00:21:00.796 A:middle
To debug regular file previews,

00:20:58.516 --> 00:21:00.796 A:middle
To debug regular file previews,

00:21:00.796 --> 00:21:02.136 A:middle
you can ignore the simulator and

00:21:02.136 --> 00:21:03.616 A:middle
invoke your preview with finder

00:21:03.616 --> 00:21:04.496 A:middle
or QLManage.

00:21:04.746 --> 00:21:05.976 A:middle
As long as your preview

00:21:05.976 --> 00:21:07.066 A:middle
extension is launched through

00:21:07.066 --> 00:21:09.016 A:middle
Xcode, Xcode will automatically

00:21:09.016 --> 00:21:10.306 A:middle
attach to it.

00:21:14.416 --> 00:21:16.036 A:middle
Let's talk about supporting iPad

00:21:16.176 --> 00:21:17.936 A:middle
apps on Mac.

00:21:17.936 --> 00:21:19.586 A:middle
Our document handling APIs are

00:21:19.586 --> 00:21:22.066 A:middle
supported in iPad apps on Mac so

00:21:22.066 --> 00:21:22.646 A:middle
you can bring your

00:21:22.646 --> 00:21:24.616 A:middle
document-based iOS apps to

00:21:24.616 --> 00:21:25.236 A:middle
macOS.

00:21:28.036 --> 00:21:28.486 A:middle
For

00:21:28.486 --> 00:21:30.316 A:middle
UIDocumentPickerViewController

00:21:30.456 --> 00:21:32.216 A:middle
use it as you would on iOS and

00:21:32.216 --> 00:21:33.946 A:middle
users will automatically get and

00:21:33.946 --> 00:21:35.846 A:middle
experience that feels native to

00:21:36.266 --> 00:21:37.196 A:middle
macOS.

00:21:37.196 --> 00:21:38.786 A:middle
Specifically, the .import and

00:21:38.786 --> 00:21:41.066 A:middle
.open modes show an NSOpenPanel

00:21:41.326 --> 00:21:43.736 A:middle
and the .exportToService and

00:21:43.736 --> 00:21:45.306 A:middle
.moveToService modes show an

00:21:45.306 --> 00:21:46.426 A:middle
NSSavePanel.

00:21:48.296 --> 00:21:49.816 A:middle
Similarly, for

00:21:49.816 --> 00:21:51.676 A:middle
UIDocumentBrowserViewController,

00:21:52.176 --> 00:21:53.706 A:middle
users will get an experience

00:21:53.706 --> 00:21:54.656 A:middle
that feels native for a

00:21:54.656 --> 00:21:56.456 A:middle
document-based app on macOS.

00:21:56.826 --> 00:21:59.336 A:middle
The user will get an NSOpenPanel

00:21:59.336 --> 00:22:00.716 A:middle
in a separate window just like

00:21:59.336 --> 00:22:00.716 A:middle
in a separate window just like

00:22:00.716 --> 00:22:01.666 A:middle
they do in TextEdit.

00:22:02.176 --> 00:22:04.406 A:middle
There are a few minor runtime

00:22:04.406 --> 00:22:06.456 A:middle
differences due to differences

00:22:06.456 --> 00:22:08.146 A:middle
between the interfaces on iOS

00:22:08.146 --> 00:22:08.926 A:middle
and macOS.

00:22:09.606 --> 00:22:11.016 A:middle
A good example of this is the

00:22:11.016 --> 00:22:12.916 A:middle
UIDocumentBrowserViewControllers

00:22:12.916 --> 00:22:14.876 A:middle
navigation bar which doesn't

00:22:14.876 --> 00:22:15.996 A:middle
exist on macOS.

00:22:16.596 --> 00:22:17.776 A:middle
Check the documentation for

00:22:17.776 --> 00:22:19.286 A:middle
details on what to do for these

00:22:19.286 --> 00:22:20.376 A:middle
particular cases.

00:22:21.296 --> 00:22:23.106 A:middle
In some cases, you can use new

00:22:23.106 --> 00:22:25.206 A:middle
APIs, such as the menu bar API,

00:22:25.356 --> 00:22:26.736 A:middle
to help you address these UI

00:22:26.806 --> 00:22:27.576 A:middle
differences.

00:22:30.196 --> 00:22:32.226 A:middle
Quick Look is also available on

00:22:32.226 --> 00:22:34.186 A:middle
iPad apps on Mac.

00:22:34.356 --> 00:22:36.186 A:middle
Presenting a QLPreviewController

00:22:36.186 --> 00:22:38.216 A:middle
will launch a QLPreviewPanel on

00:22:38.216 --> 00:22:40.476 A:middle
macOS to provide a more native

00:22:40.476 --> 00:22:41.466 A:middle
Mac experience.

00:22:42.436 --> 00:22:44.316 A:middle
Since the QLPreviewPanel is a

00:22:44.316 --> 00:22:45.306 A:middle
separate window, you're

00:22:45.306 --> 00:22:46.536 A:middle
presenting view controllers

00:22:46.536 --> 00:22:48.656 A:middle
content will be visible but it

00:22:48.656 --> 00:22:49.696 A:middle
will be great out and

00:22:49.696 --> 00:22:50.596 A:middle
non-interactive.

00:22:52.436 --> 00:22:54.376 A:middle
Test your iPad apps on Mac to

00:22:54.376 --> 00:22:55.406 A:middle
make sure it looks great.

00:22:58.096 --> 00:22:59.716 A:middle
One limitation to note of

00:22:59.716 --> 00:23:01.946 A:middle
QLPreviewController in iPad apps

00:22:59.716 --> 00:23:01.946 A:middle
QLPreviewController in iPad apps

00:23:01.946 --> 00:23:03.706 A:middle
on Mac is that embedding the

00:23:03.706 --> 00:23:05.326 A:middle
QLPreviewController's view is

00:23:05.326 --> 00:23:07.336 A:middle
not fully supported and we will

00:23:07.336 --> 00:23:08.896 A:middle
provide a thumbnail instead of a

00:23:08.896 --> 00:23:09.976 A:middle
live preview in this case.

00:23:13.046 --> 00:23:14.076 A:middle
So what have we learned today?

00:23:14.926 --> 00:23:16.046 A:middle
First, we've shown you how to

00:23:16.046 --> 00:23:18.076 A:middle
leverage new features of iOS 13

00:23:18.076 --> 00:23:20.066 A:middle
in your app, such as accessing

00:23:20.066 --> 00:23:21.826 A:middle
multiple files in a directory,

00:23:22.116 --> 00:23:24.356 A:middle
supporting USB drives and SMB

00:23:24.356 --> 00:23:24.866 A:middle
servers.

00:23:25.806 --> 00:23:27.526 A:middle
Then we've taken a look at using

00:23:27.526 --> 00:23:29.136 A:middle
Quick Look to display the same

00:23:29.136 --> 00:23:31.196 A:middle
rich thumbnails as in the files

00:23:31.196 --> 00:23:33.116 A:middle
app, provide Quick Look editing

00:23:33.116 --> 00:23:34.866 A:middle
support for images and videos,

00:23:34.906 --> 00:23:36.396 A:middle
and provide previews and

00:23:36.396 --> 00:23:37.856 A:middle
thumbnails with modern extension

00:23:37.856 --> 00:23:40.266 A:middle
API on the Mac.

00:23:40.456 --> 00:23:41.386 A:middle
Thank you for watching.
