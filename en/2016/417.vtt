WEBVTT

00:00:07.516 --> 00:00:17.500 A:middle
[ Music ]

00:00:21.516 --> 00:00:28.466 A:middle
[ Applause ]

00:00:28.966 --> 00:00:31.946 A:middle
&gt;&gt; Good afternoon and welcome
to debugging tips and tricks.

00:00:32.665 --> 00:00:34.926 A:middle
It warms my heart to see
this many people turn

00:00:34.926 --> 00:00:36.416 A:middle
out for this topic.

00:00:36.726 --> 00:00:37.966 A:middle
It's near and dear to my heart.

00:00:38.526 --> 00:00:39.446 A:middle
My name is Kate Stone

00:00:39.446 --> 00:00:41.386 A:middle
and I manage the core
team that's responsible

00:00:41.386 --> 00:00:43.266 A:middle
for debugging technology
here at Apple.

00:00:43.796 --> 00:00:45.236 A:middle
So again it's really exciting.

00:00:45.476 --> 00:00:47.876 A:middle
I hope we'll be able to bring
up a number of engineers

00:00:47.876 --> 00:00:51.176 A:middle
from my team to tell you
things that might be novel

00:00:51.176 --> 00:00:54.596 A:middle
if you're just starting but
also tips that might be new

00:00:54.596 --> 00:00:56.846 A:middle
to you even if you've been
debugging on our platforms

00:00:56.846 --> 00:00:58.406 A:middle
for the last ten years.

00:00:58.736 --> 00:01:02.126 A:middle
It really is a deep area and
we've got a lot of great content

00:00:58.736 --> 00:01:02.126 A:middle
It really is a deep area and
we've got a lot of great content

00:01:02.126 --> 00:01:03.256 A:middle
for you so let's get started.

00:01:05.006 --> 00:01:08.406 A:middle
Specifically we should note
that LLDB is the technology

00:01:08.406 --> 00:01:09.296 A:middle
that I'm talking about.

00:01:09.536 --> 00:01:11.616 A:middle
If you've used Xcode for
debugging, you may not be aware

00:01:11.616 --> 00:01:14.966 A:middle
that behind the scenes there's
this technology called LLDB,

00:01:14.966 --> 00:01:16.876 A:middle
the low level debugger,
providing all

00:01:16.876 --> 00:01:19.476 A:middle
of the core technology,
and it's not just

00:01:19.476 --> 00:01:21.466 A:middle
in Xcode it's everywhere
you need it.

00:01:21.786 --> 00:01:24.346 A:middle
But of course one of the more
common places you'll encounter

00:01:24.686 --> 00:01:27.126 A:middle
it is in Xcode in
the debug console.

00:01:27.916 --> 00:01:30.846 A:middle
Xcode hosts that console as
part of your debugging area,

00:01:32.006 --> 00:01:33.636 A:middle
and you'll see of course
the variables viewed

00:01:33.636 --> 00:01:37.186 A:middle
but also this LLDB console and
that's a lot of what we're going

00:01:37.186 --> 00:01:38.466 A:middle
to be talking about here today.

00:01:38.976 --> 00:01:40.746 A:middle
That prompted and
the wonderful things

00:01:40.746 --> 00:01:42.276 A:middle
that you can do from
that prompt.

00:01:44.966 --> 00:01:48.786 A:middle
Of course that area contains
normally not just LLDB's prompt

00:01:48.786 --> 00:01:50.436 A:middle
and allow to interact
with the debugger

00:01:50.756 --> 00:01:52.786 A:middle
but it also contains
your application's output

00:01:52.926 --> 00:01:54.336 A:middle
and allows you to
type input to it

00:01:54.616 --> 00:01:56.076 A:middle
for console based applications.

00:01:56.906 --> 00:01:58.726 A:middle
That may not be the
most convenient way

00:01:58.726 --> 00:02:00.396 A:middle
in case your application
takes advantage

00:01:58.726 --> 00:02:00.396 A:middle
in case your application
takes advantage

00:02:00.396 --> 00:02:03.816 A:middle
of other console features like
moving the cursor or colors,

00:02:03.816 --> 00:02:05.846 A:middle
other ANSI cursor
manipulation features.

00:02:05.846 --> 00:02:09.346 A:middle
So there's a new option
in Xcode 8 that allows you

00:02:09.346 --> 00:02:10.996 A:middle
to use a standalone terminal

00:02:11.156 --> 00:02:13.856 A:middle
for your application
while LLDB remains

00:02:14.016 --> 00:02:15.416 A:middle
in Xcode and it's simple.

00:02:16.036 --> 00:02:18.976 A:middle
Bring up the scheme options
and in the options tab

00:02:18.976 --> 00:02:21.666 A:middle
at the very bottom you'll see
this new console that allows you

00:02:21.666 --> 00:02:23.906 A:middle
to switch from the
default to use Xcode

00:02:24.676 --> 00:02:25.866 A:middle
to use terminal instead.

00:02:25.866 --> 00:02:28.476 A:middle
And then when you run you'll
get a separate terminal

00:02:28.536 --> 00:02:30.906 A:middle
for your application's input
and output separate from Xcode.

00:02:31.516 --> 00:02:37.546 A:middle
[ Applause ]

00:02:38.046 --> 00:02:40.536 A:middle
For the remainder of the talk
we'll be really focused on LLDB.

00:02:40.586 --> 00:02:43.196 A:middle
So if you're interested in
other Xcode specific features,

00:02:43.596 --> 00:02:45.416 A:middle
definitely check out the
two talks noted here.

00:02:45.576 --> 00:02:46.866 A:middle
Of course they've past by now

00:02:47.136 --> 00:02:48.916 A:middle
but the videos are there
and waiting for you.

00:02:50.786 --> 00:02:53.456 A:middle
You should also note that
LLDB is not just part of Xcode

00:02:53.746 --> 00:02:57.126 A:middle
but the Swift REPL
is in fact LLDB.

00:02:57.566 --> 00:03:00.006 A:middle
When you bring up the Swift REPL
and start interacting with it,

00:02:57.566 --> 00:03:00.006 A:middle
When you bring up the Swift REPL
and start interacting with it,

00:03:00.246 --> 00:03:02.756 A:middle
you're interacting inside a
debugging environment already

00:03:02.986 --> 00:03:03.646 A:middle
so that the power

00:03:03.646 --> 00:03:05.726 A:middle
of the debugger is there
any time you need it.

00:03:06.076 --> 00:03:07.796 A:middle
In fact every command
that we tell you

00:03:07.796 --> 00:03:10.416 A:middle
about here you can use directly
from within the REPL just

00:03:10.416 --> 00:03:12.766 A:middle
by prefixing it with a
colon from the REPL prompt.

00:03:13.226 --> 00:03:16.016 A:middle
So colon followed by command
will issue the command directly

00:03:16.046 --> 00:03:16.926 A:middle
to LLDB.

00:03:17.766 --> 00:03:19.686 A:middle
So let's say I'm at
the Swift REPL prompt.

00:03:20.216 --> 00:03:22.866 A:middle
At this point I'm interested
in looking up some information

00:03:22.866 --> 00:03:25.656 A:middle
on a type and of course I
could bring up Xcode and look

00:03:25.656 --> 00:03:28.766 A:middle
at the help, but right from the
prompt here I could go ahead

00:03:28.766 --> 00:03:31.416 A:middle
and simply say colon
type lookup comparable.

00:03:31.556 --> 00:03:33.966 A:middle
And I'll have looked up this
protocol and found out that

00:03:33.966 --> 00:03:35.976 A:middle
in fact it derives
from another protocol

00:03:35.976 --> 00:03:37.546 A:middle
and adds the following
four functions.

00:03:38.366 --> 00:03:39.826 A:middle
If you're familiar
with type lookup,

00:03:39.826 --> 00:03:42.086 A:middle
it's a great feature
you use it all the time

00:03:42.086 --> 00:03:43.896 A:middle
but you may not be
aware of the fact

00:03:43.946 --> 00:03:46.416 A:middle
that despite the name type
lookup it can actually be used

00:03:46.416 --> 00:03:48.016 A:middle
to lookup a wider
range of things.

00:03:48.046 --> 00:03:50.846 A:middle
I can actually lookup functions
to get the complete signature

00:03:51.356 --> 00:03:55.166 A:middle
or even lookup entire modules,
and of course this a lot

00:03:55.166 --> 00:03:57.246 A:middle
of content as it will
be the full declaration

00:03:57.246 --> 00:03:58.876 A:middle
of every type in that module.

00:03:59.166 --> 00:04:00.216 A:middle
We've abbreviated it here.

00:03:59.166 --> 00:04:00.216 A:middle
We've abbreviated it here.

00:04:02.136 --> 00:04:04.386 A:middle
So the REPL is fantastic
for these kinds

00:04:04.386 --> 00:04:08.896 A:middle
of additional commands but
it's also useful if you want

00:04:08.896 --> 00:04:11.546 A:middle
to interact with the code
you're writing in the REPL.

00:04:11.906 --> 00:04:13.426 A:middle
Let's say I write a
simple function here.

00:04:14.296 --> 00:04:16.786 A:middle
I've written a function,
I'd like to stop when I'm

00:04:16.826 --> 00:04:19.375 A:middle
in the function and find out
what's going on at a given line,

00:04:19.646 --> 00:04:22.416 A:middle
so I can issue the breakpoint
command by prefixing it

00:04:22.416 --> 00:04:25.406 A:middle
with a colon, colon b 2, I
set a breakpoint at line two

00:04:25.406 --> 00:04:28.606 A:middle
and when I call this function,
execution stops as I'd expect.

00:04:29.226 --> 00:04:32.376 A:middle
And because execution has
stopped it switches immediately

00:04:32.376 --> 00:04:35.506 A:middle
to the LLDB prompt and from the
LLDB prompt I can issue other

00:04:35.576 --> 00:04:39.156 A:middle
LLDB commands to interact with
and explore my application.

00:04:39.456 --> 00:04:42.116 A:middle
And the REPL will also do
this automatically if you run

00:04:42.116 --> 00:04:43.776 A:middle
into an overflow
condition or other things

00:04:43.776 --> 00:04:45.476 A:middle
that would normally
terminate your application

00:04:45.586 --> 00:04:47.226 A:middle
so that you can take
advantage of the full power

00:04:47.226 --> 00:04:49.146 A:middle
of the debugger directly
from the Swift REPL.

00:04:49.546 --> 00:04:51.816 A:middle
You should also note
that you can switch

00:04:51.866 --> 00:04:53.526 A:middle
between the two prompts
at any time.

00:04:53.836 --> 00:04:57.056 A:middle
If you're at the REPL prompt
a colon on its own followed

00:04:57.056 --> 00:04:59.536 A:middle
by enter will bring
up the LLDB prompt,

00:04:59.996 --> 00:05:02.566 A:middle
and the command REPL will
switch back to the REPL prompt

00:04:59.996 --> 00:05:02.566 A:middle
and the command REPL will
switch back to the REPL prompt

00:05:02.786 --> 00:05:05.016 A:middle
so you can use the two
interchangeably at any time.

00:05:05.546 --> 00:05:07.226 A:middle
The REPL has slightly
different characteristics

00:05:07.316 --> 00:05:09.506 A:middle
and may even be desirable
within a debugging session

00:05:09.506 --> 00:05:10.726 A:middle
where you're debugging
Swift code.

00:05:12.636 --> 00:05:13.536 A:middle
So that's great.

00:05:14.086 --> 00:05:17.156 A:middle
It's a couple of the key ways a
lot of people interact with LLDB

00:05:17.216 --> 00:05:20.206 A:middle
but LLDB is also a
standalone command line tool

00:05:20.606 --> 00:05:23.716 A:middle
and that's fantastic if I'm a
remote shell into a machine,

00:05:23.716 --> 00:05:25.856 A:middle
I have a very slow
connection, I really want

00:05:25.906 --> 00:05:28.736 A:middle
to use typical benefits
of a command line tool.

00:05:29.086 --> 00:05:31.196 A:middle
But it's also useful
under other circumstances.

00:05:31.286 --> 00:05:33.306 A:middle
You might want to use it
for example if you're going

00:05:33.306 --> 00:05:34.826 A:middle
to automate debugging tasks.

00:05:35.146 --> 00:05:38.276 A:middle
I want to setup my debugger the
same way every time I start it,

00:05:38.616 --> 00:05:42.516 A:middle
so I might go ahead and provide
a file containing a whole bunch

00:05:42.546 --> 00:05:44.216 A:middle
of LLDB commands to
configure things.

00:05:44.536 --> 00:05:49.606 A:middle
LLDB -- source followed by
a file name will invoke LLDB

00:05:49.746 --> 00:05:51.276 A:middle
and source all of those commands

00:05:51.276 --> 00:05:53.336 A:middle
to setup my debug session
just the way I want it.

00:05:53.336 --> 00:05:56.246 A:middle
If you don't want to go
through the trouble of setting

00:05:56.246 --> 00:05:59.846 A:middle
up a file, you can invoke LLDB
and provide commands directly

00:05:59.846 --> 00:06:04.566 A:middle
on the command line; -- one-line
will be followed by command

00:05:59.846 --> 00:06:04.566 A:middle
on the command line; -- one-line
will be followed by command

00:06:04.566 --> 00:06:06.656 A:middle
and that will be issued
as soon as I start LLDB,

00:06:06.656 --> 00:06:09.166 A:middle
and if I want additional
commands,

00:06:09.436 --> 00:06:11.076 A:middle
I can just repeat
the option here

00:06:11.076 --> 00:06:14.106 A:middle
in its abbreviated form -o
followed by another command

00:06:14.346 --> 00:06:15.406 A:middle
as many times as I like.

00:06:16.116 --> 00:06:17.266 A:middle
So it can be really trivial

00:06:17.266 --> 00:06:20.476 A:middle
to setup LLDB just the way I
want it in an automated script.

00:06:20.986 --> 00:06:24.056 A:middle
And of course this is especially
valuable in a situation

00:06:24.326 --> 00:06:27.406 A:middle
where I have an application
that fails only one

00:06:27.406 --> 00:06:28.636 A:middle
out of a hundred times.

00:06:28.636 --> 00:06:30.226 A:middle
It's a race condition, I'd

00:06:30.226 --> 00:06:32.906 A:middle
like to run the same debugging
sequence over and over again

00:06:33.146 --> 00:06:34.706 A:middle
and we have a special
option for that as well.

00:06:35.756 --> 00:06:38.836 A:middle
LLDB -- batch starts
a batch mode.

00:06:39.086 --> 00:06:41.676 A:middle
It will execute the instructions
that I provided either

00:06:41.676 --> 00:06:43.806 A:middle
from one line or
sourced from file

00:06:44.446 --> 00:06:47.286 A:middle
and presuming my application
completes normally it will

00:06:47.286 --> 00:06:48.036 A:middle
then exit.

00:06:49.026 --> 00:06:51.436 A:middle
If my application
crashes, it will stop right

00:06:51.436 --> 00:06:53.836 A:middle
at the LLDB prompt where I
can investigate the problem.

00:06:54.616 --> 00:06:56.366 A:middle
And of course just
by wrapping this

00:06:56.726 --> 00:06:59.376 A:middle
with a few other shell commands
I can repeat that series

00:06:59.376 --> 00:07:01.706 A:middle
of actions ad infinitum
or at least

00:06:59.376 --> 00:07:01.706 A:middle
of actions ad infinitum
or at least

00:07:01.856 --> 00:07:03.756 A:middle
until my application
crashes and I'm ready

00:07:03.756 --> 00:07:04.926 A:middle
to investigate the problem.

00:07:07.146 --> 00:07:09.376 A:middle
LLDB has a wide range
of options.

00:07:09.656 --> 00:07:10.706 A:middle
If you haven't looked at LLDB --

00:07:10.706 --> 00:07:13.106 A:middle
help before, I'd encourage
you to have a look.

00:07:13.156 --> 00:07:15.036 A:middle
It describes these
options and many more.

00:07:16.956 --> 00:07:20.686 A:middle
I'm going to introduce one
really interesting concept here

00:07:20.686 --> 00:07:24.276 A:middle
for us as a team that's actually
probably the least important

00:07:24.276 --> 00:07:25.536 A:middle
thing in this entire talk.

00:07:25.536 --> 00:07:27.786 A:middle
So if you've going to forget
one slide, please start

00:07:27.786 --> 00:07:31.326 A:middle
with this one because
it's largely transparent.

00:07:31.516 --> 00:07:32.986 A:middle
You shouldn't really
notice the effects

00:07:33.046 --> 00:07:34.736 A:middle
but there are some
subtle aspects of it

00:07:34.736 --> 00:07:35.866 A:middle
that I want to introduce.

00:07:36.156 --> 00:07:38.496 A:middle
Starting with Xcode 8, LLDB runs

00:07:38.496 --> 00:07:40.916 A:middle
in a completely separate
process from Xcode.

00:07:41.226 --> 00:07:42.516 A:middle
It's totally transparent to you.

00:07:42.616 --> 00:07:45.406 A:middle
You start debugging the way
you normally did and what

00:07:45.406 --> 00:07:48.346 A:middle
that allows us to do is support
multiple different versions

00:07:48.696 --> 00:07:49.416 A:middle
of the debugger.

00:07:50.316 --> 00:07:51.746 A:middle
It's selected for
you automatically,

00:07:52.066 --> 00:07:55.566 A:middle
so if I go to debug Swift 3
I get the latest debugger,

00:07:55.566 --> 00:07:56.906 A:middle
I get all of the
features that we're going

00:07:56.906 --> 00:07:58.166 A:middle
to introduce in this session.

00:07:58.416 --> 00:08:01.736 A:middle
And in fact if I'm using
pure C++ or Objective C,

00:07:58.416 --> 00:08:01.736 A:middle
And in fact if I'm using
pure C++ or Objective C,

00:08:02.036 --> 00:08:03.036 A:middle
the same thing is true.

00:08:03.036 --> 00:08:04.916 A:middle
I get the latest
debugger with all

00:08:04.916 --> 00:08:06.196 A:middle
of the features we'll
talk about here.

00:08:07.276 --> 00:08:09.516 A:middle
On the other hand, if
I'm debugging Swift 2.3,

00:08:09.716 --> 00:08:12.326 A:middle
I'm going to wind up with the
debugger that's essentially what

00:08:12.326 --> 00:08:16.276 A:middle
we shipped earlier this
year with Xcode 7.3.1.

00:08:16.786 --> 00:08:18.706 A:middle
That means some of the newer
commands won't be available,

00:08:18.916 --> 00:08:22.056 A:middle
but we have the full support
of the debugger from the era

00:08:22.056 --> 00:08:23.866 A:middle
of the Swift compiler.

00:08:24.916 --> 00:08:27.876 A:middle
But most importantly
perhaps if you're part

00:08:27.876 --> 00:08:30.136 A:middle
of our open source
community, you'll be able

00:08:30.136 --> 00:08:32.456 A:middle
to debug using the
version of the debugger

00:08:32.456 --> 00:08:35.246 A:middle
that matches the open source
Swift that you're using.

00:08:35.525 --> 00:08:38.566 A:middle
So if you download a snapshot of
our work in progress or indeed

00:08:38.566 --> 00:08:40.186 A:middle
if your start adding
to it yourself,

00:08:40.596 --> 00:08:42.706 A:middle
you will have a debugger
that's immediately available

00:08:42.916 --> 00:08:44.496 A:middle
and you can actually
use that concurrently

00:08:44.606 --> 00:08:48.516 A:middle
with debugging other programs
written in Swift 3 or Swift 2.3

00:08:48.796 --> 00:08:50.636 A:middle
and everything is
completely transparent.

00:08:52.156 --> 00:08:55.886 A:middle
There is one additional benefit
here which is that if LLDB gets

00:08:55.886 --> 00:08:58.906 A:middle
into a situation where it cannot
proceed and it needs to shut

00:08:58.906 --> 00:09:00.036 A:middle
down the debugging session,

00:08:58.906 --> 00:09:00.036 A:middle
down the debugging session,

00:09:00.306 --> 00:09:01.686 A:middle
the debug session
will be terminated,

00:09:01.886 --> 00:09:05.086 A:middle
LLDB can exit gracefully,
and Xcode will stay running.

00:09:09.166 --> 00:09:12.726 A:middle
To talk about what you can
do with LLDB a powerful tool

00:09:12.726 --> 00:09:15.406 A:middle
that it is and how you can
customize your experience,

00:09:15.406 --> 00:09:18.266 A:middle
I'm going to invite up one of
my engineers Enrico Granata.

00:09:19.516 --> 00:09:24.866 A:middle
[ Applause ]

00:09:25.366 --> 00:09:26.046 A:middle
&gt;&gt; Thank you, Kate.

00:09:26.046 --> 00:09:26.586 A:middle
Hi, everyone.

00:09:27.366 --> 00:09:28.576 A:middle
One of my favorite things

00:09:28.576 --> 00:09:32.146 A:middle
about LLDB is how customizable
of a debugger it is.

00:09:32.666 --> 00:09:35.486 A:middle
It's not only great fun
to work in the technology

00:09:35.486 --> 00:09:38.836 A:middle
that enables this, but it's
also an amazing way for you

00:09:38.836 --> 00:09:41.356 A:middle
to be more productive in
debugging your applications,

00:09:41.716 --> 00:09:45.366 A:middle
and LLDB offers a
great many entry points

00:09:45.366 --> 00:09:46.246 A:middle
for you to customize it.

00:09:46.876 --> 00:09:49.776 A:middle
You can start with command
aliases and then work your way

00:09:49.776 --> 00:09:52.976 A:middle
to custom commands or
custom data formatters

00:09:53.296 --> 00:09:56.226 A:middle
and in Xcode 8 we have
one new extension point

00:09:56.226 --> 00:09:58.486 A:middle
for you; stepping actions.

00:09:59.106 --> 00:10:02.676 A:middle
The way to think about
stepping actions is do you

00:09:59.106 --> 00:10:02.676 A:middle
The way to think about
stepping actions is do you

00:10:02.676 --> 00:10:04.366 A:middle
like what the next command does?

00:10:04.516 --> 00:10:06.106 A:middle
Do you like what the
step command does?

00:10:06.356 --> 00:10:09.376 A:middle
But do you find yourself
wanting to tweak its behavior

00:10:09.376 --> 00:10:11.566 A:middle
in just one or two little
ways here and there?

00:10:11.996 --> 00:10:14.566 A:middle
With stepping actions
you can actually do that.

00:10:15.756 --> 00:10:20.016 A:middle
But the simplest way to
get LLDB, to customize LLDB

00:10:20.016 --> 00:10:23.876 A:middle
to suit your needs is to create
a command alias which is a way

00:10:24.096 --> 00:10:26.026 A:middle
to take a piece of
debugger syntax

00:10:26.066 --> 00:10:27.606 A:middle
for something you frequently do

00:10:27.836 --> 00:10:30.536 A:middle
and attach a shorter
piece of syntax to it.

00:10:31.086 --> 00:10:36.386 A:middle
And now in Xcode 8 we also
let you attach help text to it

00:10:36.716 --> 00:10:38.956 A:middle
so that for your own purposes

00:10:39.136 --> 00:10:41.566 A:middle
or for whoever you
share those aliases

00:10:41.566 --> 00:10:44.096 A:middle
with you can remember
what the alias is up to.

00:10:44.776 --> 00:10:45.706 A:middle
Let's see an example.

00:10:46.576 --> 00:10:48.846 A:middle
First of all, to create
an alias you start

00:10:48.846 --> 00:10:50.376 A:middle
with the command alias command.

00:10:50.906 --> 00:10:55.456 A:middle
Then as I said you can pass
help text to it, you provide us

00:10:55.496 --> 00:10:59.376 A:middle
with a short syntax, and then
you give us the full debugger

00:10:59.376 --> 00:11:00.676 A:middle
command you want to replace.

00:10:59.376 --> 00:11:00.676 A:middle
command you want to replace.

00:11:01.176 --> 00:11:05.646 A:middle
And now shell is just as normal
a debugger command as any

00:11:05.646 --> 00:11:07.326 A:middle
of the ones we built into it.

00:11:07.626 --> 00:11:10.196 A:middle
You can for instance say
help shell and it will

00:11:10.196 --> 00:11:13.596 A:middle
so you help text including
that which you provided to us.

00:11:14.316 --> 00:11:16.356 A:middle
And for those situations

00:11:16.356 --> 00:11:20.396 A:middle
where debugging becomes a little
gnarly and you tend to forget

00:11:20.436 --> 00:11:23.816 A:middle
who you are as you pursue your
bugs, you can ask the debugger

00:11:23.816 --> 00:11:26.806 A:middle
to remind you your identity
and it will tell you

00:11:26.806 --> 00:11:28.656 A:middle
that it looks like I'm Enrico.

00:11:28.916 --> 00:11:33.146 A:middle
And that's great but if you want
to do something more advanced

00:11:33.206 --> 00:11:35.486 A:middle
than simply attach a new
name to an existing command,

00:11:35.926 --> 00:11:37.966 A:middle
we also vend you a Python API.

00:11:38.596 --> 00:11:40.436 A:middle
It's a fairly extensive
option model

00:11:40.436 --> 00:11:43.006 A:middle
that lets you band the
debugger to your will.

00:11:43.946 --> 00:11:46.346 A:middle
Getting started is
easier than ever.

00:11:46.766 --> 00:11:50.266 A:middle
We've talked about this at great
length in previous WWDC sessions

00:11:50.336 --> 00:11:51.686 A:middle
which you can find online.

00:11:52.296 --> 00:11:54.826 A:middle
We have a website with
documentation and examples

00:11:54.826 --> 00:11:59.366 A:middle
to look at and if you
just search for it online,

00:11:59.646 --> 00:12:01.746 A:middle
there's a community that's
doing wonderful things

00:11:59.646 --> 00:12:01.746 A:middle
there's a community that's
doing wonderful things

00:12:01.746 --> 00:12:03.056 A:middle
around scripting LLDB.

00:12:03.266 --> 00:12:05.406 A:middle
Let me give you a quick example.

00:12:06.086 --> 00:12:07.766 A:middle
Let's say that I want a command

00:12:07.896 --> 00:12:11.676 A:middle
that lets me retrieve the return
value for the last function

00:12:11.676 --> 00:12:13.676 A:middle
that I exited out
of while debugging.

00:12:14.616 --> 00:12:15.746 A:middle
Couple caveats here.

00:12:16.286 --> 00:12:19.526 A:middle
This command will work
only if you finish your way

00:12:19.526 --> 00:12:23.196 A:middle
out of a function and don't
execute any stepping actions

00:12:23.196 --> 00:12:23.876 A:middle
right after.

00:12:24.176 --> 00:12:26.386 A:middle
You can type expressions,
you can look at variables,

00:12:26.826 --> 00:12:28.656 A:middle
just don't step around
and this will work.

00:12:29.016 --> 00:12:30.416 A:middle
Let's look at an
example real quick.

00:12:31.076 --> 00:12:34.776 A:middle
First of all, you import a
file that contains that command

00:12:35.266 --> 00:12:37.766 A:middle
and then as I said
finish out of the function

00:12:38.066 --> 00:12:40.456 A:middle
and the return values is
right there for you to see.

00:12:40.716 --> 00:12:41.836 A:middle
Okay, that's great.

00:12:41.836 --> 00:12:44.446 A:middle
That happens by default, no
need for customization here.

00:12:44.776 --> 00:12:48.196 A:middle
But what if I type
backtrace for example

00:12:48.556 --> 00:12:51.226 A:middle
and that's quite a
verbose backtrace

00:12:51.366 --> 00:12:53.696 A:middle
and now I don't remember
where the return value is.

00:12:54.056 --> 00:12:56.616 A:middle
Okay, I could go up in the
terminal and try to dig it up

00:12:56.996 --> 00:13:01.046 A:middle
but luckily enough we actually
made a command that will tell us

00:12:56.996 --> 00:13:01.046 A:middle
but luckily enough we actually
made a command that will tell us

00:13:01.046 --> 00:13:05.486 A:middle
about it, and here that return
value is again for us to see.

00:13:06.816 --> 00:13:09.616 A:middle
This is all it takes
to make that happen.

00:13:09.926 --> 00:13:12.126 A:middle
And by the way don't
really worry about reading

00:13:12.126 --> 00:13:15.146 A:middle
that slide now, it will just be
online waiting for you later.

00:13:16.266 --> 00:13:19.576 A:middle
On the other hand, you see
that it is slide of text

00:13:19.916 --> 00:13:23.376 A:middle
and now you can type your shell
alias, you can type the text,

00:13:23.756 --> 00:13:25.676 A:middle
and you'll find yourself
typing this

00:13:25.676 --> 00:13:27.746 A:middle
because they're awesome every
time you start debugging

00:13:27.926 --> 00:13:29.746 A:middle
and you'll type them
again and again and again

00:13:29.946 --> 00:13:31.366 A:middle
until you're a literal
typing monkey

00:13:31.366 --> 00:13:32.936 A:middle
and all you're actually
doing is typing these

00:13:32.936 --> 00:13:34.286 A:middle
debugger customizations.

00:13:34.956 --> 00:13:36.886 A:middle
Nope. I say no to that.

00:13:37.226 --> 00:13:40.446 A:middle
I say save yourselves
from repetitive typing.

00:13:41.006 --> 00:13:41.976 A:middle
There's no need to do that.

00:13:42.146 --> 00:13:44.166 A:middle
LLDB has an initialization file.

00:13:44.646 --> 00:13:48.526 A:middle
It's called .llbdinit and
it sits in your home folder.

00:13:49.476 --> 00:13:50.496 A:middle
And if you need LLDB

00:13:50.496 --> 00:13:53.236 A:middle
to do something special
something different

00:13:53.236 --> 00:13:56.506 A:middle
when launched under Xcode
versus under the terminal,

00:13:57.736 --> 00:14:01.776 A:middle
there's a .llbdinit -Xcode
file that will be preferred

00:13:57.736 --> 00:14:01.776 A:middle
there's a .llbdinit -Xcode
file that will be preferred

00:14:02.126 --> 00:14:04.516 A:middle
when launched in the
debugger under Xcode.

00:14:05.356 --> 00:14:06.156 A:middle
One more trick.

00:14:06.756 --> 00:14:09.736 A:middle
If you have Python commands that
you need at debugger start up,

00:14:10.096 --> 00:14:12.856 A:middle
don't try to type
them in .llbdinit.

00:14:13.196 --> 00:14:17.206 A:middle
Put them in a .py file and
then source the .py file

00:14:17.576 --> 00:14:21.106 A:middle
that in LLDB init with
command script import.

00:14:23.276 --> 00:14:26.176 A:middle
Those of you that have used LLDB

00:14:26.176 --> 00:14:28.926 A:middle
for a while are probably
fairly familiar

00:14:28.926 --> 00:14:30.616 A:middle
with the p and po commands.

00:14:31.316 --> 00:14:34.396 A:middle
These are great commands,
they're great ways to look

00:14:34.396 --> 00:14:37.626 A:middle
at data because they
are full expressions.

00:14:38.156 --> 00:14:39.626 A:middle
They have the entire power

00:14:39.626 --> 00:14:42.556 A:middle
of the language you're writing
your application in available

00:14:42.556 --> 00:14:44.056 A:middle
for you at the debugger console.

00:14:44.146 --> 00:14:47.146 A:middle
On the other hand,
with great power comes

00:14:47.176 --> 00:14:48.296 A:middle
great responsibility.

00:14:49.236 --> 00:14:52.576 A:middle
These commands run coding
your target process.

00:14:52.796 --> 00:14:55.336 A:middle
They have potential
to cause side effects

00:14:55.746 --> 00:14:59.006 A:middle
and also sometimes
it's just not possible

00:14:59.006 --> 00:15:00.566 A:middle
to run the code you
want at the point

00:14:59.006 --> 00:15:00.566 A:middle
to run the code you
want at the point

00:15:00.566 --> 00:15:01.756 A:middle
where you're currently stopped.

00:15:01.986 --> 00:15:07.536 A:middle
And if p runs code once, po
will actually run code twice

00:15:07.966 --> 00:15:10.606 A:middle
because not only does it
evaluate the expression you

00:15:10.606 --> 00:15:14.506 A:middle
provide it also uses
it also evaluates code

00:15:14.626 --> 00:15:17.256 A:middle
to print the customization
to show your type

00:15:17.546 --> 00:15:21.746 A:middle
in a way that's customizable
by type authors which is great

00:15:22.206 --> 00:15:25.206 A:middle
if the type author customized
the display for their type

00:15:25.506 --> 00:15:27.076 A:middle
in exactly the way you want it.

00:15:27.746 --> 00:15:28.996 A:middle
If you're not that lucky,

00:15:29.336 --> 00:15:31.526 A:middle
the p command provides
an alternative viewpoint

00:15:31.526 --> 00:15:33.776 A:middle
of variables that may be
closer to what you want.

00:15:34.516 --> 00:15:36.706 A:middle
And also po is also a command

00:15:36.706 --> 00:15:39.486 A:middle
that runs again twice
coding your target process

00:15:39.666 --> 00:15:41.606 A:middle
with all the potential
for side effects.

00:15:42.716 --> 00:15:45.716 A:middle
If that scares you, we have
another command to look

00:15:45.716 --> 00:15:48.086 A:middle
at variables; frame variable.

00:15:48.566 --> 00:15:50.376 A:middle
This is a very predictable
command,

00:15:50.586 --> 00:15:52.366 A:middle
it will not run any code.

00:15:53.016 --> 00:15:55.176 A:middle
On the other hand,
because it doesn't have

00:15:55.176 --> 00:15:56.416 A:middle
that code running ability,

00:15:56.786 --> 00:15:59.856 A:middle
the syntax it offers is
also extremely limited.

00:16:00.526 --> 00:16:04.026 A:middle
And that's quite a few ways
to look at data already

00:16:04.516 --> 00:16:08.886 A:middle
but spoiler alert, in
Xcode 8 we have more.

00:16:09.586 --> 00:16:15.876 A:middle
Two new ones parray and
poarray, and yes you're right.

00:16:16.016 --> 00:16:17.656 A:middle
They sound a lot like p and po

00:16:17.956 --> 00:16:20.336 A:middle
but they do something
special for arrays.

00:16:21.496 --> 00:16:23.286 A:middle
What do they do especially
for arrays?

00:16:24.056 --> 00:16:29.316 A:middle
Well, if you have used
NS array in Objective C

00:16:29.586 --> 00:16:33.196 A:middle
or Swift arrays you're
used to the safe container

00:16:33.196 --> 00:16:35.766 A:middle
that knows how many
things it contains.

00:16:36.366 --> 00:16:38.076 A:middle
C pointers don't do that.

00:16:38.376 --> 00:16:40.856 A:middle
C pointers don't come with a
kind of batteries included.

00:16:41.086 --> 00:16:44.426 A:middle
They don't know how many
elements they point to and so

00:16:44.606 --> 00:16:49.326 A:middle
when we print a C pointer like
this example in the debugger all

00:16:49.326 --> 00:16:51.596 A:middle
that we're told is
the pointer value.

00:16:52.526 --> 00:16:54.576 A:middle
But now we know that this
points to a bunch of elements

00:16:54.776 --> 00:16:56.726 A:middle
so we can start printing
the first one,

00:16:57.196 --> 00:17:00.446 A:middle
printing the second one and we
keep going and now we're back

00:16:57.196 --> 00:17:00.446 A:middle
printing the second one and we
keep going and now we're back

00:17:00.446 --> 00:17:03.236 A:middle
to the little typing monkey
situation which we don't like.

00:17:04.925 --> 00:17:10.296 A:middle
Well, in Xcode 8 you can say
parray, number of elements,

00:17:10.586 --> 00:17:13.846 A:middle
pointer and it will
expand for you that pointer

00:17:13.886 --> 00:17:16.976 A:middle
as if it was an array of the
element count you specified.

00:17:17.516 --> 00:17:19.675 A:middle
[ Applause ]

00:17:20.175 --> 00:17:20.506 A:middle
Thank you.

00:17:20.506 --> 00:17:21.056 A:middle
Thank you.

00:17:22.465 --> 00:17:25.175 A:middle
That's already nice
but why do I have

00:17:25.226 --> 00:17:26.796 A:middle
to guess at the element count?

00:17:27.566 --> 00:17:28.616 A:middle
It's right there.

00:17:28.766 --> 00:17:29.966 A:middle
We have the count right there.

00:17:30.296 --> 00:17:35.066 A:middle
What I really want is being able
to type parray count dataset.

00:17:36.546 --> 00:17:37.716 A:middle
I almost can.

00:17:37.716 --> 00:17:40.906 A:middle
All I have to do is
put count in backticks.

00:17:41.506 --> 00:17:45.186 A:middle
That backtick is a general
LLDB syntax facility

00:17:45.516 --> 00:17:48.106 A:middle
which lets you take an
expression, evaluate it

00:17:48.336 --> 00:17:50.086 A:middle
and replace the value
of that expression

00:17:50.086 --> 00:17:52.006 A:middle
in the command before
executing it.

00:17:52.736 --> 00:17:55.316 A:middle
And now I've got my
full array shown.

00:17:57.516 --> 00:18:01.226 A:middle
[ Applause ]

00:17:57.516 --> 00:18:01.226 A:middle
[ Applause ]

00:18:01.726 --> 00:18:02.206 A:middle
Thank you.

00:18:02.236 --> 00:18:04.556 A:middle
Pretty much the same
thing works for po.

00:18:04.556 --> 00:18:08.016 A:middle
poarray, number of
elements, pointer

00:18:08.016 --> 00:18:10.876 A:middle
and I get po style
descriptions of objects.

00:18:11.926 --> 00:18:15.356 A:middle
On that same topic of po,
I'm sure that those of you

00:18:15.356 --> 00:18:19.066 A:middle
that could write Objective C
code, quite a few I'm sure,

00:18:19.066 --> 00:18:22.266 A:middle
have actually done something
just like that probably

00:18:22.266 --> 00:18:24.006 A:middle
without even thinking about it.

00:18:24.346 --> 00:18:27.646 A:middle
You take po, you say po followed
by a number that you happen

00:18:27.646 --> 00:18:29.046 A:middle
to know is a pointer value

00:18:29.266 --> 00:18:30.956 A:middle
and you get a pretty
description back.

00:18:31.816 --> 00:18:34.146 A:middle
And you try doing the
same thing in Swift

00:18:34.696 --> 00:18:35.906 A:middle
and all you get back
is a number.

00:18:36.256 --> 00:18:37.796 A:middle
Why? What's going on?

00:18:38.786 --> 00:18:42.176 A:middle
Well, I'm sure you've heard
this quite a few times

00:18:42.176 --> 00:18:43.836 A:middle
but I'll say it one more time.

00:18:44.186 --> 00:18:46.826 A:middle
Swift is a type safer
language than Objective C.

00:18:47.266 --> 00:18:50.236 A:middle
We can't assume that numbers
are arbitrarily objects

00:18:50.236 --> 00:18:53.306 A:middle
because not all Swift objects
have a pointer value connected

00:18:53.306 --> 00:18:53.646 A:middle
to them.

00:18:54.056 --> 00:18:57.456 A:middle
So when we say po a number
we'll show you the number.

00:18:58.506 --> 00:19:00.226 A:middle
Okay, that's great but come

00:18:58.506 --> 00:19:00.226 A:middle
Okay, that's great but come

00:19:00.226 --> 00:19:02.146 A:middle
on I know there's an
object there just show it

00:19:02.146 --> 00:19:02.876 A:middle
to me already.

00:19:03.406 --> 00:19:04.806 A:middle
There's a way to do that.

00:19:06.686 --> 00:19:07.956 A:middle
There it is.

00:19:08.156 --> 00:19:10.456 A:middle
It looks like a lot of words,
I know it looks like a lot

00:19:10.456 --> 00:19:13.026 A:middle
of words but it's actually
just follow me for a second.

00:19:13.356 --> 00:19:15.296 A:middle
Expr -O just means po.

00:19:15.586 --> 00:19:20.156 A:middle
If you're at the LLDB
console and you say help po,

00:19:20.156 --> 00:19:24.486 A:middle
what it will tell you is that
it's an alias for expr -O.

00:19:25.166 --> 00:19:28.826 A:middle
So all we're actually
saying here is po this thing

00:19:28.916 --> 00:19:31.876 A:middle
as if we were in
Objective C code and with

00:19:31.876 --> 00:19:35.076 A:middle
that we actually get the
pretty description we wanted.

00:19:35.576 --> 00:19:37.436 A:middle
And that's great.

00:19:38.406 --> 00:19:42.486 A:middle
On a topic related to actually
inspecting memory addresses

00:19:42.486 --> 00:19:46.506 A:middle
and trying to make sense of
them, low level debugging.

00:19:47.576 --> 00:19:50.186 A:middle
If you remember one
thing and only one thing

00:19:50.186 --> 00:19:54.396 A:middle
about low level debugging is
to stay very far away from it.

00:19:54.546 --> 00:19:54.976 A:middle
Don't do it.

00:19:55.516 --> 00:19:58.996 A:middle
[ Laughter ]

00:19:59.496 --> 00:20:03.166 A:middle
Unfortunately, sometimes
you just really have to.

00:19:59.496 --> 00:20:03.166 A:middle
Unfortunately, sometimes
you just really have to.

00:20:03.996 --> 00:20:06.216 A:middle
Maybe you're debugging
something that only happens

00:20:06.336 --> 00:20:08.816 A:middle
in optimized code in the
release build of your app.

00:20:08.996 --> 00:20:10.286 A:middle
That happens to me sometimes.

00:20:11.346 --> 00:20:13.846 A:middle
Or you're debugging
third party code

00:20:13.846 --> 00:20:15.706 A:middle
for which you have
no debug information.

00:20:16.656 --> 00:20:18.126 A:middle
If any of that applies to you,

00:20:18.936 --> 00:20:21.226 A:middle
follow me as we sail
past the Pillars

00:20:21.226 --> 00:20:23.006 A:middle
of Hercules on this journey.

00:20:24.176 --> 00:20:27.956 A:middle
But please know that on
this journey you proceed

00:20:27.956 --> 00:20:28.966 A:middle
at your own risk.

00:20:30.196 --> 00:20:36.086 A:middle
It starts just like this; I
had a gentleman last year walk

00:20:36.086 --> 00:20:39.486 A:middle
up to me in the lab with his
laptop showing me Xcode just

00:20:39.486 --> 00:20:43.206 A:middle
in that state, crashed in
Objc msgSend of all places.

00:20:43.876 --> 00:20:45.096 A:middle
And he tells me a story.

00:20:45.486 --> 00:20:48.906 A:middle
I have my app and it's
under store and it's great

00:20:49.326 --> 00:20:52.036 A:middle
but then my framework vendor
says, hey I have a new version

00:20:52.036 --> 00:20:54.576 A:middle
of my frame, just
update, it will be okay.

00:20:54.916 --> 00:20:56.746 A:middle
And I did update,
I listened to him,

00:20:56.746 --> 00:20:58.236 A:middle
and now my app crashes
on launch.

00:20:58.296 --> 00:20:59.786 A:middle
What do I do, please help me.

00:21:00.486 --> 00:21:02.956 A:middle
And so we sat down
and I told him well,

00:21:03.146 --> 00:21:04.896 A:middle
we know pretty much nothing here

00:21:04.896 --> 00:21:07.736 A:middle
but one thing we can
do is let's start

00:21:07.736 --> 00:21:09.676 A:middle
by reading machine registers.

00:21:10.686 --> 00:21:14.116 A:middle
LLDB offers a facility to
do that and it lets you look

00:21:14.116 --> 00:21:16.826 A:middle
at all the registers, only
a few of the registers

00:21:17.176 --> 00:21:19.296 A:middle
and it even lets you
play custom formatting.

00:21:20.026 --> 00:21:20.886 A:middle
What does it look like?

00:21:21.886 --> 00:21:25.536 A:middle
You say register read and
you get your register values,

00:21:26.236 --> 00:21:28.056 A:middle
and that's a lot of registers.

00:21:28.056 --> 00:21:30.166 A:middle
And why do I even care about
all those weird numbers

00:21:30.166 --> 00:21:32.236 A:middle
and the words on the screen?

00:21:32.686 --> 00:21:36.756 A:middle
Well, you do care because
often arguments are passed

00:21:37.026 --> 00:21:37.946 A:middle
in registers.

00:21:38.896 --> 00:21:41.386 A:middle
Okay, that's fun, but that
was a lot of registers.

00:21:41.456 --> 00:21:43.646 A:middle
How do I know which ones
actually matter to me?

00:21:44.266 --> 00:21:48.006 A:middle
That is a question for your
platform's application binary

00:21:48.006 --> 00:21:51.066 A:middle
interface ABI, the colon
convention gives you

00:21:51.066 --> 00:21:51.696 A:middle
those rules.

00:21:52.556 --> 00:21:54.186 A:middle
But LLDB also exposes

00:21:54.186 --> 00:21:58.816 A:middle
to you convenient pseudo
registers named $arg1, $arg2,

00:21:58.816 --> 00:22:01.356 A:middle
and so on which in the case

00:21:58.816 --> 00:22:01.356 A:middle
and so on which in the case

00:22:01.356 --> 00:22:03.946 A:middle
in which your arguments are
actually of simple scaler

00:22:04.196 --> 00:22:07.306 A:middle
or pointer types
actually mapped one to one

00:22:07.306 --> 00:22:09.256 A:middle
between the registers
and the arguments.

00:22:10.096 --> 00:22:13.706 A:middle
Similar convenience is available
in the C family expression.

00:22:14.476 --> 00:22:17.406 A:middle
So for example, if
I have a function

00:22:17.406 --> 00:22:20.196 A:middle
that takes these three
arguments and I call it,

00:22:20.906 --> 00:22:23.576 A:middle
those arguments will
actually map one to one

00:22:23.846 --> 00:22:26.326 A:middle
to $arg1, $arg2, and $arg3.

00:22:27.716 --> 00:22:30.206 A:middle
Okay, so that applies
to our example.

00:22:30.346 --> 00:22:33.996 A:middle
We're in Objc msgSend, we
start by reading arguments.

00:22:34.606 --> 00:22:37.636 A:middle
The first argument is
the pointer 0 X 4 D 2,

00:22:37.786 --> 00:22:39.766 A:middle
the second argument
is the selector string

00:22:39.766 --> 00:22:40.716 A:middle
by appending string.

00:22:41.446 --> 00:22:45.036 A:middle
We happen to know that Objc
msgSends first argument is the

00:22:45.036 --> 00:22:46.506 A:middle
object we're trying to message

00:22:46.756 --> 00:22:49.176 A:middle
and the second argument is the
selector we're trying to send,

00:22:50.206 --> 00:22:53.466 A:middle
and we can also use the memory
read command to check what's

00:22:53.466 --> 00:22:55.386 A:middle
up with the object
that we're messaging.

00:22:55.836 --> 00:22:57.696 A:middle
It turns out that's
a bad object.

00:22:58.826 --> 00:23:04.396 A:middle
What is happening is that
we're calling this selector

00:22:58.826 --> 00:23:04.396 A:middle
What is happening is that
we're calling this selector

00:23:04.466 --> 00:23:05.396 A:middle
on a bad object.

00:23:06.156 --> 00:23:09.046 A:middle
How did we get there?

00:23:09.266 --> 00:23:12.526 A:middle
Well, we're in Objc
msgSend, we're crashed,

00:23:13.056 --> 00:23:16.246 A:middle
something called Objc msgSend,
something called the thing

00:23:16.246 --> 00:23:19.986 A:middle
that called it and so on and so
forth until we get all the way

00:23:19.986 --> 00:23:21.776 A:middle
to the entry point
of our application.

00:23:22.666 --> 00:23:28.106 A:middle
In LLDB we call the frames from
frame 0 the youngest all the way

00:23:28.106 --> 00:23:32.806 A:middle
to frame N the oldest and if
you want to move around frames,

00:23:33.176 --> 00:23:36.466 A:middle
you can use the up command
to go back to an older frame

00:23:36.516 --> 00:23:38.666 A:middle
on the stack and
the down command

00:23:38.956 --> 00:23:40.556 A:middle
to go back to a younger frame.

00:23:42.056 --> 00:23:45.936 A:middle
Another thing worth knowing
is the disassemble command

00:23:46.266 --> 00:23:48.866 A:middle
which lets you look at the
disassembly for a function.

00:23:49.346 --> 00:23:50.856 A:middle
You can do that for
the current function,

00:23:50.856 --> 00:23:54.896 A:middle
for an arbitrary frame, for an
address, for a function by name,

00:23:55.196 --> 00:23:57.346 A:middle
you can customize the way
that disassembly shows

00:23:57.816 --> 00:24:00.176 A:middle
and in some cases
it makes debugging

00:23:57.816 --> 00:24:00.176 A:middle
and in some cases
it makes debugging

00:24:00.486 --> 00:24:03.066 A:middle
where you do have source code
and debug info but you want

00:24:03.066 --> 00:24:04.636 A:middle
to compare those instructions

00:24:04.636 --> 00:24:07.226 A:middle
to machine instructions
you can also ask LLDB

00:24:07.226 --> 00:24:10.676 A:middle
to always show you always
show you disassembly along

00:24:10.676 --> 00:24:11.396 A:middle
with source code.

00:24:12.136 --> 00:24:17.126 A:middle
So in our case, we crashed there
and we can see that the thing

00:24:17.126 --> 00:24:18.896 A:middle
that called our function
is an application

00:24:18.896 --> 00:24:19.716 A:middle
that did finish launching.

00:24:20.106 --> 00:24:22.116 A:middle
So let's go there real quick
and take a look at what

00:24:22.226 --> 00:24:26.256 A:middle
that function is doing.

00:24:26.766 --> 00:24:29.196 A:middle
That function is
calling this initializer

00:24:29.196 --> 00:24:31.526 A:middle
that our framework vendor
told us, yes totally code

00:24:31.526 --> 00:24:33.246 A:middle
that initializer,
getGlobalToken.

00:24:33.696 --> 00:24:36.756 A:middle
It's moving some stuff around
and then it's making the call

00:24:36.756 --> 00:24:39.486 A:middle
to Objc msgSend that
will crash us.

00:24:40.586 --> 00:24:42.476 A:middle
So we can step around
machine code

00:24:42.476 --> 00:24:44.946 A:middle
and see what these calls
are actually doing.

00:24:45.296 --> 00:24:48.676 A:middle
First of all we step over
the getGlobalToken call

00:24:48.676 --> 00:24:52.126 A:middle
and then I'm going to
cheat for a second here.

00:24:52.466 --> 00:24:56.926 A:middle
I happen to know that the
register called rax contains the

00:24:56.926 --> 00:25:00.576 A:middle
return value of that
function and if I read it,

00:24:56.926 --> 00:25:00.576 A:middle
return value of that
function and if I read it,

00:25:01.636 --> 00:25:03.466 A:middle
that's just the bad
pointer value.

00:25:03.986 --> 00:25:05.126 A:middle
Interesting.

00:25:05.546 --> 00:25:07.596 A:middle
Let's step around a
couple more times.

00:25:08.276 --> 00:25:10.686 A:middle
No, that isn't changing
it, that isn't changing it.

00:25:11.296 --> 00:25:14.686 A:middle
All we're doing is taking
that pointer value as is

00:25:14.976 --> 00:25:19.596 A:middle
and moving it into rdi and
then calling into Objc msgSend.

00:25:20.186 --> 00:25:21.736 A:middle
I wonder if that's connected?

00:25:22.386 --> 00:25:27.416 A:middle
If I reg read $arg1 at this
point right before entering Objc

00:25:27.416 --> 00:25:32.376 A:middle
msgSend, rdi the
bad pointer value.

00:25:33.686 --> 00:25:35.246 A:middle
What have we proven
to ourselves?

00:25:35.496 --> 00:25:38.536 A:middle
We've proven to ourselves that
the getGlobalToken function

00:25:38.846 --> 00:25:40.576 A:middle
that our framework
vendor was so excited

00:25:40.576 --> 00:25:43.746 A:middle
to get us calling actually
returned to us a bad object

00:25:44.126 --> 00:25:47.066 A:middle
and upon trying to send a
message to that bad object,

00:25:47.426 --> 00:25:50.406 A:middle
big surprise, our
application ended up crashing.

00:25:51.396 --> 00:25:53.886 A:middle
And on that note of patting
ourselves on the back

00:25:53.886 --> 00:25:56.896 A:middle
for conclusively proving
our case, I want to hand it

00:25:56.896 --> 00:25:59.026 A:middle
over to Sean Callanan
to tell you all

00:25:59.026 --> 00:26:01.046 A:middle
about the great new features
in the expression parser.

00:25:59.026 --> 00:26:01.046 A:middle
about the great new features
in the expression parser.

00:26:01.316 --> 00:26:01.846 A:middle
Thank you.

00:26:02.516 --> 00:26:07.546 A:middle
[ Applause ]

00:26:08.046 --> 00:26:08.726 A:middle
&gt;&gt; Isn't that magic?

00:26:09.276 --> 00:26:10.236 A:middle
It feels like magic.

00:26:10.376 --> 00:26:13.616 A:middle
Your program is just
storing its data as numbers,

00:26:14.116 --> 00:26:19.026 A:middle
arrays of numbers and yet you
can use LLDB this powerful tool

00:26:19.536 --> 00:26:24.436 A:middle
to represent that data in
the way you think about it.

00:26:25.306 --> 00:26:30.106 A:middle
Sometimes though it's not
quite as easy as just looking

00:26:30.106 --> 00:26:32.766 A:middle
at a number and figuring
out what the data is.

00:26:33.936 --> 00:26:36.336 A:middle
Sometimes you need
the expression parser.

00:26:36.906 --> 00:26:38.726 A:middle
Now, Enrico has already
shown you

00:26:38.816 --> 00:26:40.516 A:middle
where the expression parser fits

00:26:40.516 --> 00:26:42.246 A:middle
in in the general
command syntax,

00:26:42.686 --> 00:26:44.226 A:middle
but there's a lot
that it can do.

00:26:45.656 --> 00:26:49.706 A:middle
The expression parse's job is to
work together with your program

00:26:49.796 --> 00:26:54.896 A:middle
and the SDK and get from
where you're currently stopped

00:26:55.946 --> 00:27:02.186 A:middle
through some contortions to get
at the data you want to the data

00:26:55.946 --> 00:27:02.186 A:middle
through some contortions to get
at the data you want to the data

00:27:02.186 --> 00:27:03.996 A:middle
that you're actually
trying to inspect.

00:27:05.636 --> 00:27:09.066 A:middle
Now, I said we work
with your program

00:27:09.066 --> 00:27:10.566 A:middle
and we work with the SDK.

00:27:11.826 --> 00:27:15.696 A:middle
Working with the SDK hasn't
always been easy in LLDB

00:27:15.786 --> 00:27:17.586 A:middle
if you remember from
previous years.

00:27:18.816 --> 00:27:20.566 A:middle
So for example if
you were stopped

00:27:20.566 --> 00:27:23.356 A:middle
in an Objective C
program and you tried

00:27:23.356 --> 00:27:28.146 A:middle
to get the program's undo
manager, you probably

00:27:28.856 --> 00:27:31.866 A:middle
at least once or twice
got an annoying error.

00:27:33.056 --> 00:27:36.776 A:middle
It wasn't at all relevant to
what you were trying to do

00:27:36.776 --> 00:27:39.086 A:middle
and it was really puzzling.

00:27:39.736 --> 00:27:41.366 A:middle
But last year we told
you there's a way

00:27:41.366 --> 00:27:42.166 A:middle
to get out of this.

00:27:44.416 --> 00:27:51.456 A:middle
If you just manually
import AppKit then you're

00:27:51.456 --> 00:27:52.596 A:middle
expression works.

00:27:53.406 --> 00:27:55.766 A:middle
All right, but why
did I have to do that?

00:27:55.946 --> 00:27:57.126 A:middle
It's already there.

00:27:58.546 --> 00:27:59.476 A:middle
I hear you cry.

00:28:00.516 --> 00:28:02.596 A:middle
[ Laughter ]

00:28:03.096 --> 00:28:05.196 A:middle
You're not the only ones.

00:28:05.196 --> 00:28:09.336 A:middle
So this year we thought what
can we do to make this better,

00:28:10.326 --> 00:28:11.496 A:middle
and it was pretty obvious.

00:28:12.346 --> 00:28:15.886 A:middle
We looked at which modules the
current source file imports

00:28:16.226 --> 00:28:18.346 A:middle
and we import them
for you automatically.

00:28:18.626 --> 00:28:20.866 A:middle
No more of that manual
importing business.

00:28:21.516 --> 00:28:26.546 A:middle
[ Applause ]

00:28:27.046 --> 00:28:30.546 A:middle
Cool. So we're getting out
of your way more efficiently.

00:28:30.946 --> 00:28:34.346 A:middle
That's great, but this is
supposed to be a powerful tool.

00:28:34.886 --> 00:28:38.176 A:middle
Let me tell you about
some of the great things

00:28:38.406 --> 00:28:40.286 A:middle
that you can do with it.

00:28:40.756 --> 00:28:44.046 A:middle
Now, sometimes these
conveniences might get

00:28:44.046 --> 00:28:44.556 A:middle
in your way.

00:28:44.586 --> 00:28:45.916 A:middle
You're actually trying

00:28:46.016 --> 00:28:48.316 A:middle
to manually import
the things you want.

00:28:49.336 --> 00:28:52.216 A:middle
There's a feature, a
setting that you can use

00:28:52.256 --> 00:28:54.976 A:middle
to disable this automatic
importing

00:28:55.096 --> 00:28:58.066 A:middle
and get back the feature
the way it was last year.

00:28:59.046 --> 00:29:02.396 A:middle
We think you're going to like
it though so it's by default on.

00:28:59.046 --> 00:29:02.396 A:middle
We think you're going to like
it though so it's by default on.

00:29:02.796 --> 00:29:05.656 A:middle
Great. Now let's
talk more generally

00:29:05.656 --> 00:29:07.866 A:middle
about using the expression
parser effectively

00:29:08.526 --> 00:29:10.026 A:middle
by reusing code.

00:29:10.626 --> 00:29:14.536 A:middle
Now, the most simple case

00:29:14.536 --> 00:29:16.776 A:middle
of reusing code is
reusing variables.

00:29:17.836 --> 00:29:22.146 A:middle
Now remember I said you might
need to do multistep expressions

00:29:22.676 --> 00:29:25.466 A:middle
to get to the data that you
actually want from the place

00:29:25.466 --> 00:29:26.446 A:middle
where you currently are.

00:29:27.786 --> 00:29:30.116 A:middle
In Swift you can do
something as simple

00:29:30.806 --> 00:29:33.696 A:middle
as defining a temporary
variable and using it.

00:29:35.196 --> 00:29:36.096 A:middle
This just works.

00:29:36.226 --> 00:29:37.976 A:middle
It's as if you typed
it in your own program.

00:29:39.396 --> 00:29:42.396 A:middle
Now what might be
counterintuitive is what happens

00:29:42.636 --> 00:29:43.696 A:middle
if you try to use it again.

00:29:44.896 --> 00:29:47.236 A:middle
Then we say, what's
that variable name?

00:29:49.216 --> 00:29:52.446 A:middle
Well, actually we intended
it to work this way.

00:29:53.096 --> 00:29:57.056 A:middle
The reason is you might
step around, you might stop

00:29:57.056 --> 00:30:00.326 A:middle
in different places, maybe
later you're in a place

00:29:57.056 --> 00:30:00.326 A:middle
in different places, maybe
later you're in a place

00:30:00.326 --> 00:30:02.596 A:middle
where you're program
actually defined an A.

00:30:02.936 --> 00:30:04.386 A:middle
Do we want the A you used

00:30:04.386 --> 00:30:06.286 A:middle
as a temporary valuable
to get in your way?

00:30:07.256 --> 00:30:14.626 A:middle
Probably not, but there
is a way out of this.

00:30:14.706 --> 00:30:17.936 A:middle
The affordance we
setup to make sure

00:30:17.936 --> 00:30:19.736 A:middle
that your variables don't escape

00:30:19.736 --> 00:30:22.366 A:middle
in that way is we actually
setup a local context.

00:30:22.366 --> 00:30:25.626 A:middle
It's as if you actually put a
set of braces in your program,

00:30:26.046 --> 00:30:30.376 A:middle
put the let A in there and the
print, but if you want the A

00:30:30.376 --> 00:30:34.356 A:middle
to break out, all you have to
do is give it a special name,

00:30:34.876 --> 00:30:36.346 A:middle
a name with a dollar sign.

00:30:37.176 --> 00:30:39.206 A:middle
That means that it
will never collide

00:30:39.246 --> 00:30:43.656 A:middle
with your own program's names
and it means that it will live

00:30:44.236 --> 00:30:45.856 A:middle
as long as your debug
session does.

00:30:47.176 --> 00:30:49.716 A:middle
Awesome. What else can
you do with this tool?

00:30:49.716 --> 00:30:51.746 A:middle
It turns out quite a lot.

00:30:52.386 --> 00:30:55.616 A:middle
Now in Swift ever
since day one with LLDB

00:30:55.616 --> 00:30:58.546 A:middle
and Swift you've been able to do
the same trick with functions.

00:30:59.696 --> 00:31:02.886 A:middle
Now when you did that
you probably wanted

00:30:59.696 --> 00:31:02.886 A:middle
Now when you did that
you probably wanted

00:31:02.886 --> 00:31:05.756 A:middle
to use multiline
expression modes and in fact

00:31:05.756 --> 00:31:07.956 A:middle
if you typed the expression
command and pressed enter,

00:31:08.276 --> 00:31:10.386 A:middle
you're immediately going
to get a multiline editor

00:31:10.646 --> 00:31:12.866 A:middle
where you can type
in your function.

00:31:13.726 --> 00:31:19.446 A:middle
If you define your function then
you can simply reuse it again

00:31:19.446 --> 00:31:20.526 A:middle
remembering the dollar sign.

00:31:22.106 --> 00:31:24.876 A:middle
Now, those of you who
tried this in Swift

00:31:24.876 --> 00:31:27.976 A:middle
and said that's awesome might
have tried it in Objective C

00:31:29.746 --> 00:31:32.406 A:middle
and it wasn't so great.

00:31:34.156 --> 00:31:36.286 A:middle
Function definition
isn't allowed here.

00:31:36.716 --> 00:31:38.986 A:middle
Come on these LLDB guys
always get in my way.

00:31:39.486 --> 00:31:39.886 A:middle
All right.

00:31:40.146 --> 00:31:43.896 A:middle
Well, turns out we
like this feature too,

00:31:43.896 --> 00:31:45.566 A:middle
we think it's awesome,
we want it to be better.

00:31:46.786 --> 00:31:49.936 A:middle
But we can't just make
it magically work.

00:31:50.436 --> 00:31:54.246 A:middle
The reason is remember
we're stopped in your code.

00:31:54.706 --> 00:31:57.736 A:middle
We want to act like we're
inside your function.

00:31:58.726 --> 00:32:01.746 A:middle
If you're in Swift you can
define nested functions,

00:31:58.726 --> 00:32:01.746 A:middle
If you're in Swift you can
define nested functions,

00:32:01.746 --> 00:32:03.886 A:middle
it's no big deal, the
compiler will love it.

00:32:03.886 --> 00:32:06.256 A:middle
It won't love the dollar
sign you can take that out

00:32:06.626 --> 00:32:08.156 A:middle
but the rest it's fine with.

00:32:09.056 --> 00:32:09.926 A:middle
This is totally legal.

00:32:11.746 --> 00:32:16.356 A:middle
In C, C++ and Objective C though
trying to make a nested function

00:32:16.356 --> 00:32:18.986 A:middle
like that, that's no good
the compiler is going

00:32:18.986 --> 00:32:22.136 A:middle
to yell at you.

00:32:22.356 --> 00:32:23.936 A:middle
Well, the way you get

00:32:23.936 --> 00:32:28.716 A:middle
around that is using the
top level expression mode.

00:32:29.506 --> 00:32:31.496 A:middle
That's an extension of
the expression command

00:32:31.926 --> 00:32:33.986 A:middle
that makes it break completely

00:32:33.986 --> 00:32:36.166 A:middle
out of the current
function you're stopped in

00:32:36.206 --> 00:32:39.566 A:middle
and just define global
code whether it's functions

00:32:39.566 --> 00:32:41.306 A:middle
or variables or what you will.

00:32:42.206 --> 00:32:43.606 A:middle
Now you can define your function

00:32:43.606 --> 00:32:45.306 A:middle
and use it just the
way you would expect.

00:32:46.416 --> 00:32:47.116 A:middle
All right.

00:32:48.586 --> 00:32:51.746 A:middle
Now the functions aren't
the only reusable things you

00:32:51.746 --> 00:32:52.326 A:middle
can define.

00:32:52.326 --> 00:32:53.696 A:middle
I've already talked
about variables.

00:32:54.066 --> 00:32:56.806 A:middle
You can define closures too,
they're kind of a merger

00:32:56.806 --> 00:32:58.126 A:middle
of variables and code.

00:32:59.236 --> 00:33:01.506 A:middle
In Swift you can define
a closure and use it.

00:32:59.236 --> 00:33:01.506 A:middle
In Swift you can define
a closure and use it.

00:33:03.006 --> 00:33:06.236 A:middle
New in Xcode this year
you can do the same thing

00:33:06.236 --> 00:33:07.026 A:middle
in Objective C.

00:33:07.636 --> 00:33:12.236 A:middle
Blocks can be defined and
reused and for those of you

00:33:12.236 --> 00:33:14.116 A:middle
who are diehard C++ fans,

00:33:14.546 --> 00:33:16.716 A:middle
you can do the exact
same thing with lambdas.

00:33:17.286 --> 00:33:22.006 A:middle
Now, what can you do
with these blocks?

00:33:22.006 --> 00:33:23.156 A:middle
What's special about them.

00:33:23.456 --> 00:33:25.926 A:middle
Well, you can pass them off
to functions for example.

00:33:26.846 --> 00:33:27.906 A:middle
Sometimes you might need

00:33:27.906 --> 00:33:30.596 A:middle
to manually run something
on a certain queue.

00:33:31.906 --> 00:33:32.636 A:middle
That works.

00:33:33.086 --> 00:33:35.436 A:middle
You can send stuff for
example to a global queue

00:33:35.806 --> 00:33:37.156 A:middle
and the block will simply run.

00:33:38.656 --> 00:33:43.096 A:middle
Now, sometimes it
gets a little annoying

00:33:43.526 --> 00:33:46.636 A:middle
because these complex
expressions result

00:33:46.636 --> 00:33:49.346 A:middle
in much more likelihood
of typos.

00:33:50.646 --> 00:33:54.456 A:middle
Now, what's the difference
quickly without looking back

00:33:54.536 --> 00:33:57.636 A:middle
to the previous slide between
this expression and the one

00:33:57.636 --> 00:33:58.666 A:middle
from the previous slide?

00:33:59.556 --> 00:34:00.336 A:middle
You probably missed it.

00:33:59.556 --> 00:34:00.336 A:middle
You probably missed it.

00:34:00.776 --> 00:34:02.156 A:middle
The compiler sure didn't.

00:34:03.046 --> 00:34:06.256 A:middle
It will yell at you about
the missing semicolon

00:34:06.866 --> 00:34:09.206 A:middle
but there's a better way.

00:34:09.656 --> 00:34:11.556 A:middle
If you were to type this
into the source editor,

00:34:12.406 --> 00:34:14.576 A:middle
we would have told you,
hey you probably missed a

00:34:14.576 --> 00:34:15.386 A:middle
semicolon here.

00:34:15.386 --> 00:34:18.306 A:middle
Did you mean to put it in?

00:34:18.306 --> 00:34:21.726 A:middle
Well, it turns out LLDB
can do the same thing,

00:34:22.056 --> 00:34:25.436 A:middle
and we can do one better by
just automatically putting

00:34:25.436 --> 00:34:26.956 A:middle
in the semicolon
that was missing,

00:34:27.335 --> 00:34:28.386 A:middle
running your expression.

00:34:28.976 --> 00:34:30.266 A:middle
This is called fixit.

00:34:30.266 --> 00:34:32.436 A:middle
It's been in clang for a while

00:34:32.726 --> 00:34:34.806 A:middle
and LLDB now applies
the same thing.

00:34:36.886 --> 00:34:38.496 A:middle
Swift has fixit too.

00:34:39.716 --> 00:34:42.826 A:middle
In Swift you're less likely
to run into semicolon problems

00:34:43.166 --> 00:34:45.426 A:middle
but boy those exclamation
points are annoying.

00:34:46.516 --> 00:34:48.656 A:middle
[ Laughter ]

00:34:49.156 --> 00:34:54.025 A:middle
Yeah. Well, they are as valuable
as they are in your own code

00:34:54.025 --> 00:34:55.176 A:middle
for you to understand it,

00:34:55.306 --> 00:34:57.306 A:middle
when you're debugging you
just want them the heck

00:34:57.306 --> 00:35:00.786 A:middle
out of your way, and
believe me we do too.

00:34:57.306 --> 00:35:00.786 A:middle
out of your way, and
believe me we do too.

00:35:01.756 --> 00:35:04.876 A:middle
So if you try to use something
without unwrapping it,

00:35:06.126 --> 00:35:08.076 A:middle
we just apply the fixit
and unwrap it for you.

00:35:09.306 --> 00:35:12.016 A:middle
Now, there may be
one or two people

00:35:12.186 --> 00:35:14.556 A:middle
who say I don't want
debugger touching my code.

00:35:15.146 --> 00:35:20.986 A:middle
Now, for those people I
have had those evenings too,

00:35:21.776 --> 00:35:26.136 A:middle
and we have settings that will
turn off the entire autoapply

00:35:26.136 --> 00:35:28.716 A:middle
fixit feature and
if you just don't

00:35:28.716 --> 00:35:31.116 A:middle
like the debugger
acting smug and pointing

00:35:31.116 --> 00:35:33.736 A:middle
out every little thing in your
code that it's fixing for you,

00:35:34.176 --> 00:35:36.226 A:middle
then you can turn just
that part off too.

00:35:37.956 --> 00:35:38.376 A:middle
All right.

00:35:39.516 --> 00:35:44.156 A:middle
[ Applause ]

00:35:44.656 --> 00:35:45.176 A:middle
Thanks. All right.

00:35:45.916 --> 00:35:49.246 A:middle
Great. That's a nice convenience
feature but let me finish

00:35:49.246 --> 00:35:53.696 A:middle
up with just one more thing that
you can define that's reusable.

00:35:53.696 --> 00:35:56.866 A:middle
You can define your own types.

00:35:57.966 --> 00:36:00.726 A:middle
In Swift for example you can
enter a multiline expression

00:35:57.966 --> 00:36:00.726 A:middle
In Swift for example you can
enter a multiline expression

00:36:00.926 --> 00:36:05.146 A:middle
that defines a class and
when you try to instantiate

00:36:05.146 --> 00:36:08.196 A:middle
that class indeed it
shows up just the way

00:36:08.576 --> 00:36:11.006 A:middle
as if you had defined the
class in your own program.

00:36:12.336 --> 00:36:18.026 A:middle
In the same way in C++, you can
define a class and reuse it.

00:36:18.916 --> 00:36:24.256 A:middle
Now let me show you an example
of taking all these concepts

00:36:24.306 --> 00:36:28.336 A:middle
and using them in
your own program.

00:36:28.496 --> 00:36:31.666 A:middle
Often especially in your
programs that interact

00:36:31.666 --> 00:36:34.566 A:middle
with web APIs you get a lot
of data back and you want

00:36:34.566 --> 00:36:36.446 A:middle
to filter it especially
when you're debugging.

00:36:37.736 --> 00:36:41.826 A:middle
The way you filter data
especially say in NS array is

00:36:41.826 --> 00:36:43.076 A:middle
by defining a predicate.

00:36:44.526 --> 00:36:48.356 A:middle
Now in the expression parser you
can define custom predicates.

00:36:49.176 --> 00:36:52.266 A:middle
In this case we're
taking writing a block

00:36:52.726 --> 00:36:56.266 A:middle
that takes the result
strings from the web server

00:36:56.996 --> 00:36:59.146 A:middle
and filters them to find strings

00:36:59.176 --> 00:37:01.046 A:middle
that have the text
error in them.

00:36:59.176 --> 00:37:01.046 A:middle
that have the text
error in them.

00:37:01.836 --> 00:37:02.986 A:middle
Probably useful for debugging.

00:37:04.256 --> 00:37:08.526 A:middle
Now if you simply take
an array full of data

00:37:08.526 --> 00:37:12.416 A:middle
from your web server and you
apply the predicate to it,

00:37:12.666 --> 00:37:14.696 A:middle
you can get right
down to the message

00:37:14.696 --> 00:37:17.356 A:middle
that you actually cared about.

00:37:18.426 --> 00:37:18.816 A:middle
All right.

00:37:19.186 --> 00:37:22.166 A:middle
Now you've hopefully seen how
powerful the expression parser

00:37:22.166 --> 00:37:24.806 A:middle
can be for you, I'd like to
turn things over to Jim Ingham

00:37:25.136 --> 00:37:26.816 A:middle
to show you more
powerful features of LLDB.

00:37:27.516 --> 00:37:31.886 A:middle
[ Applause ]

00:37:32.386 --> 00:37:32.936 A:middle
&gt;&gt; Thank you, Sean.

00:37:33.416 --> 00:37:36.416 A:middle
So, so far we've sort of
inverted the natural order

00:37:36.416 --> 00:37:39.586 A:middle
of things and told you
how to look at the state

00:37:39.586 --> 00:37:42.116 A:middle
of your program when you're
stopped but we haven't

00:37:42.116 --> 00:37:43.886 A:middle
yet told you how you
would actually get

00:37:43.886 --> 00:37:44.996 A:middle
to such interesting points.

00:37:44.996 --> 00:37:46.666 A:middle
So that's with what I'm going
to tell you a little bit about.

00:37:46.926 --> 00:37:49.646 A:middle
Of course breakpoints
are the natural way

00:37:49.876 --> 00:37:51.956 A:middle
that you would stop
your program.

00:37:51.956 --> 00:37:54.896 A:middle
So I want to talk a little
bit about how you might think

00:37:54.896 --> 00:37:59.586 A:middle
about breakpoints naively as the
place where I stop my program

00:37:59.806 --> 00:38:01.886 A:middle
but that's actually not
how they're implemented

00:37:59.806 --> 00:38:01.886 A:middle
but that's actually not
how they're implemented

00:38:01.886 --> 00:38:04.356 A:middle
or how LLDB thinks about them.

00:38:04.356 --> 00:38:07.196 A:middle
To LLDB a breakpoint
is really is search

00:38:07.466 --> 00:38:10.936 A:middle
through your program space
for interesting places to stop

00:38:10.936 --> 00:38:13.366 A:middle
or many different kinds of
searches as it turns out.

00:38:13.706 --> 00:38:16.496 A:middle
So breakpoints are
really search criteria

00:38:16.866 --> 00:38:20.896 A:middle
and what the individual
locations where your stop,

00:38:20.896 --> 00:38:22.876 A:middle
what you thought of
naively a breakpoint,

00:38:23.186 --> 00:38:25.136 A:middle
we call breakpoint locations.

00:38:25.466 --> 00:38:27.616 A:middle
So to make this a little more
concrete, let me tie this

00:38:27.666 --> 00:38:31.966 A:middle
to Xcode's breakpoints because
after all Xcode under the covers

00:38:31.966 --> 00:38:33.596 A:middle
when it debugs is LLDB

00:38:33.596 --> 00:38:37.176 A:middle
so all the Xcode breakpoints
must be LLDB breakpoints.

00:38:37.416 --> 00:38:41.576 A:middle
So for instance when you click
in the source gutter in Xcode,

00:38:41.756 --> 00:38:45.016 A:middle
what you're really doing is
running this command in LLDB,

00:38:45.016 --> 00:38:46.496 A:middle
some breakpoint setting command.

00:38:46.976 --> 00:38:49.606 A:middle
Similarly when you make a
symbolic breakpoint you're

00:38:49.606 --> 00:38:52.286 A:middle
running a by name
breakpoint setting.

00:38:52.506 --> 00:38:55.136 A:middle
So I want to give
you a little sense

00:38:55.136 --> 00:38:58.726 A:middle
that these are really
searches by showing you cases

00:38:58.726 --> 00:39:02.906 A:middle
in which you would end up
naturally with multiple results

00:38:58.726 --> 00:39:02.906 A:middle
in which you would end up
naturally with multiple results

00:39:02.906 --> 00:39:05.786 A:middle
from what you thought of as
a simple unitary breakpoint

00:39:05.786 --> 00:39:08.446 A:middle
setting, so the first example

00:39:08.446 --> 00:39:10.656 A:middle
that I'll show you is
symbolic breakpoints.

00:39:10.926 --> 00:39:12.846 A:middle
So here's an example
where you want

00:39:12.846 --> 00:39:14.356 A:middle
to just set a breakpoint
on main.

00:39:14.356 --> 00:39:15.896 A:middle
That should be a simple
thing to do, right?

00:39:16.236 --> 00:39:18.866 A:middle
But then it says, no
I have 19 locations.

00:39:18.866 --> 00:39:20.546 A:middle
Well, while did you
end up with 19?

00:39:20.926 --> 00:39:23.376 A:middle
Do the break list
command to see the results

00:39:23.376 --> 00:39:25.406 A:middle
of your breakpoint
setting and what you see is

00:39:25.406 --> 00:39:30.226 A:middle
that the breakpoint name
search is actually a loose name

00:39:30.226 --> 00:39:34.436 A:middle
matching search, so for instance
it picked up the selector names

00:39:34.436 --> 00:39:36.486 A:middle
within a class and
that's actually convenient

00:39:36.486 --> 00:39:39.386 A:middle
in many cases because like
if you're debugging in C++

00:39:39.386 --> 00:39:42.836 A:middle
and you have a name space, and a
name space inside, and a class,

00:39:42.836 --> 00:39:45.076 A:middle
and a method, you don't
want to have to type all

00:39:45.076 --> 00:39:49.036 A:middle
of the full path to that but
on the other hand it does mean

00:39:49.036 --> 00:39:52.006 A:middle
that the search is perhaps wider
than you intended it to be.

00:39:52.616 --> 00:39:54.976 A:middle
We provide many different
kinds of searches

00:39:54.976 --> 00:39:57.746 A:middle
so of course we provide a
slightly more strict search

00:39:57.966 --> 00:40:01.486 A:middle
which is the full name
search that forces the name

00:39:57.966 --> 00:40:01.486 A:middle
which is the full name
search that forces the name

00:40:01.486 --> 00:40:05.306 A:middle
to match the entire name of the
symbol that you're specifying.

00:40:05.726 --> 00:40:07.866 A:middle
We tried that but even
that didn't work right.

00:40:08.156 --> 00:40:10.806 A:middle
Well, for some reason somebody
decided their library has

00:40:10.806 --> 00:40:13.516 A:middle
to have a function called main
in it, no idea why but it does.

00:40:13.916 --> 00:40:17.816 A:middle
So you can even specify
further by limiting your search

00:40:17.816 --> 00:40:21.976 A:middle
to a particular shared
library with the shlib option.

00:40:21.976 --> 00:40:24.276 A:middle
So then finally then you
get the breakpoint you want.

00:40:24.716 --> 00:40:26.286 A:middle
I'm going to give you
one other instance not

00:40:26.286 --> 00:40:27.616 A:middle
because I don't think
you believe me

00:40:27.616 --> 00:40:30.206 A:middle
but because this one actually
comes up in Swift fairly often

00:40:30.416 --> 00:40:32.116 A:middle
with file and line breakpoints

00:40:32.406 --> 00:40:34.156 A:middle
because Swift has
this nice feature

00:40:34.306 --> 00:40:38.436 A:middle
that you can call a
function that uses a closure

00:40:38.566 --> 00:40:42.806 A:middle
and define the closure simply by
continuing with a curly bracket

00:40:42.806 --> 00:40:45.016 A:middle
and then on with the
body of the closure.

00:40:45.206 --> 00:40:47.526 A:middle
But then if you try to set
a breakpoint on that line,

00:40:47.696 --> 00:40:50.756 A:middle
what you're going to find out
is you have two stop points.

00:40:50.756 --> 00:40:51.656 A:middle
Why do you have that?

00:40:52.106 --> 00:40:54.696 A:middle
When you look it's actually
fairly straightforward, right?

00:40:54.886 --> 00:40:58.676 A:middle
That source line actually
contributed a little bit of code

00:40:58.676 --> 00:41:01.796 A:middle
to the closure function and
you see we have a breakpoint

00:40:58.676 --> 00:41:01.796 A:middle
to the closure function and
you see we have a breakpoint

00:41:01.796 --> 00:41:03.666 A:middle
location on the closure
function,

00:41:03.906 --> 00:41:07.486 A:middle
but it also was the invoking
site for that function

00:41:07.776 --> 00:41:11.726 A:middle
and so you also have a
location for that invoking site.

00:41:12.226 --> 00:41:16.836 A:middle
So anyway that's for that so now
having given you a few examples,

00:41:17.056 --> 00:41:19.806 A:middle
let me give you the general
form of the command and then go

00:41:19.806 --> 00:41:22.846 A:middle
on to some more interesting
uses of it.

00:41:23.416 --> 00:41:25.746 A:middle
So the breakpoint set
command works as follows:

00:41:25.746 --> 00:41:28.686 A:middle
You say break set and then
there are some options

00:41:28.686 --> 00:41:31.076 A:middle
which specify the type

00:41:31.076 --> 00:41:33.846 A:middle
and that's really
specifying the kind

00:41:33.846 --> 00:41:34.826 A:middle
of search that you're doing.

00:41:34.826 --> 00:41:37.086 A:middle
Is it a file and line
search, a symbol name search

00:41:37.086 --> 00:41:37.986 A:middle
or so on and so forth?

00:41:38.286 --> 00:41:41.436 A:middle
And the values for that
type option will be the data

00:41:41.546 --> 00:41:45.336 A:middle
for the search and then there
are other kinds of options

00:41:45.636 --> 00:41:48.046 A:middle
like ignore count,
condition and so on.

00:41:48.246 --> 00:41:51.026 A:middle
The way to think about those
options is they don't specify

00:41:51.286 --> 00:41:54.306 A:middle
where to break, they
specify whether to break.

00:41:54.576 --> 00:41:59.876 A:middle
So that's the whether can be
modified after the fact but the

00:41:59.876 --> 00:42:02.026 A:middle
where can't because we've
already done the search

00:41:59.876 --> 00:42:02.026 A:middle
where can't because we've
already done the search

00:42:02.026 --> 00:42:03.586 A:middle
and you would just
set a new breakpoint

00:42:03.586 --> 00:42:04.466 A:middle
if you wanted to do that.

00:42:04.836 --> 00:42:07.556 A:middle
So let's talk a little bit about
these breakpoint location things

00:42:07.556 --> 00:42:09.736 A:middle
which are the places where
you're going to stop.

00:42:09.736 --> 00:42:11.766 A:middle
They are the individual
search results,

00:42:12.036 --> 00:42:14.416 A:middle
they always have some
address which is the address

00:42:14.416 --> 00:42:16.746 A:middle
at which your program
is going to halt.

00:42:17.116 --> 00:42:19.576 A:middle
When you look at them
they're specified

00:42:19.576 --> 00:42:21.546 A:middle
by the generating
breakpoint's number

00:42:21.716 --> 00:42:24.416 A:middle
and a location number
written separated by a dot.

00:42:24.416 --> 00:42:27.666 A:middle
So if you actually notice
when you're debugging in Xcode

00:42:27.666 --> 00:42:30.126 A:middle
and you stop at one of your
breakpoints and you look

00:42:30.126 --> 00:42:33.746 A:middle
at the little PC ribbon, the PC
ribbon will have the stop reason

00:42:33.746 --> 00:42:36.186 A:middle
on the far right and
it will say breakpoint,

00:42:36.186 --> 00:42:37.766 A:middle
but it always says 2.1.

00:42:37.766 --> 00:42:39.416 A:middle
It never said breakpoint 2

00:42:39.596 --> 00:42:42.066 A:middle
because you only ever
really stop at locations

00:42:42.366 --> 00:42:44.316 A:middle
so 1.1, 1.2 or whatever.

00:42:44.636 --> 00:42:48.686 A:middle
By the way, the locations
and breakpoints are sort

00:42:48.686 --> 00:42:50.366 A:middle
of symmetrical with
respect to all

00:42:50.366 --> 00:42:52.606 A:middle
of these other options
that I talked about.

00:42:52.826 --> 00:42:55.836 A:middle
They all take the same sort of
generic options like commands

00:42:55.836 --> 00:42:57.076 A:middle
and conditions and so forth,

00:42:57.396 --> 00:43:00.766 A:middle
and you can specify a
command condition whatever

00:42:57.396 --> 00:43:00.766 A:middle
and you can specify a
command condition whatever

00:43:00.766 --> 00:43:03.486 A:middle
on a breakpoint and then it
will work for all the locations

00:43:03.696 --> 00:43:06.936 A:middle
but you can also override
for a particular location one

00:43:06.936 --> 00:43:08.906 A:middle
of the commands or
conditions just by setting it

00:43:08.906 --> 00:43:10.826 A:middle
on the location instead.

00:43:11.206 --> 00:43:13.556 A:middle
One other little convenience,

00:43:14.076 --> 00:43:17.116 A:middle
oftentimes if you have a
breakpoint that's generated a

00:43:17.116 --> 00:43:18.966 A:middle
bunch of locations,
you want five of them,

00:43:18.966 --> 00:43:21.226 A:middle
you don't want five of
them so you disable them

00:43:21.416 --> 00:43:22.946 A:middle
which you can do independently,

00:43:23.266 --> 00:43:26.216 A:middle
but then if you you don't want
any of them to hit you want

00:43:26.216 --> 00:43:28.316 A:middle
to be able to disable the whole
breakpoint which you can do

00:43:28.316 --> 00:43:29.616 A:middle
by disabling the breakpoint.

00:43:29.796 --> 00:43:32.766 A:middle
But it turns out that doesn't
change the enable disable state

00:43:32.766 --> 00:43:35.906 A:middle
of it locations so then you
can just turn it back on again

00:43:36.126 --> 00:43:39.206 A:middle
and all of the location state
will be as you would expect.

00:43:39.666 --> 00:43:40.666 A:middle
So that's just a little thing.

00:43:40.906 --> 00:43:42.416 A:middle
So now that you've
seen a little bit,

00:43:42.586 --> 00:43:45.356 A:middle
the notion of how breakpoints
are thought of in LLDB,

00:43:45.356 --> 00:43:48.736 A:middle
let me show you a couple
of more powerful types

00:43:48.736 --> 00:43:50.476 A:middle
of breakpoints that
LLDB provides.

00:43:50.726 --> 00:43:53.046 A:middle
So again these are
searches for places to stop.

00:43:53.156 --> 00:43:55.586 A:middle
What kinds of searches
are we going to do?

00:43:55.686 --> 00:43:57.406 A:middle
It's just what name spaces

00:43:57.406 --> 00:43:59.366 A:middle
in your program might
be interesting.

00:43:59.576 --> 00:44:02.276 A:middle
It turns out all of the
name spaces are name spaces

00:43:59.576 --> 00:44:02.276 A:middle
It turns out all of the
name spaces are name spaces

00:44:02.276 --> 00:44:04.336 A:middle
of stringy things because
they're all like names

00:44:04.336 --> 00:44:08.486 A:middle
of functions or whatever, so we
always use regular expressions

00:44:08.656 --> 00:44:10.976 A:middle
as the way to express
the search patterns.

00:44:11.196 --> 00:44:12.686 A:middle
So if you know regular
expressions,

00:44:12.686 --> 00:44:13.916 A:middle
this will make you feel lovely,

00:44:14.196 --> 00:44:16.056 A:middle
and if you don't
regular expressions,

00:44:16.376 --> 00:44:19.096 A:middle
I would have said a couple
years ago look for somebody

00:44:19.126 --> 00:44:21.536 A:middle
in your office that
has books with animals

00:44:21.536 --> 00:44:23.506 A:middle
on them although
nowadays if you're looking

00:44:23.506 --> 00:44:25.326 A:middle
for somebody old you
probably should just look

00:44:25.326 --> 00:44:26.876 A:middle
for somebody who
has books at all.

00:44:27.516 --> 00:44:29.516 A:middle
[ Laughter ]

00:44:30.516 --> 00:44:32.546 A:middle
[ Applause ]

00:44:33.046 --> 00:44:35.476 A:middle
So anyway, so we provide
two kinds of searches,

00:44:35.476 --> 00:44:38.886 A:middle
one is fairly obvious which
is a search over the names

00:44:38.886 --> 00:44:42.106 A:middle
of functions in your program
so this is the option for that,

00:44:42.366 --> 00:44:44.116 A:middle
and one that might be
slightly less obvious

00:44:44.116 --> 00:44:45.996 A:middle
but I'll convince you
is interesting I hope

00:44:45.996 --> 00:44:49.576 A:middle
as we go along, are sourced
text search breakpoints.

00:44:49.966 --> 00:44:51.456 A:middle
And this is the option
for those.

00:44:51.946 --> 00:44:54.826 A:middle
Okay, so let's give you the
first one this is function name

00:44:54.826 --> 00:44:55.996 A:middle
pattern matching breakpoints

00:44:55.996 --> 00:44:57.496 A:middle
and I'll just show
you some examples.

00:44:57.806 --> 00:44:59.636 A:middle
So suppose somebody has
given you a new class

00:45:00.216 --> 00:45:02.706 A:middle
and you don't know what it does,
you want to see how it works,

00:45:02.926 --> 00:45:04.326 A:middle
so what you want to
do really is break

00:45:04.326 --> 00:45:07.636 A:middle
on all the methods implemented
by that class which you could do

00:45:07.636 --> 00:45:10.266 A:middle
by going through the source
file in Xcode and clicking

00:45:10.266 --> 00:45:11.296 A:middle
on the beginning of all of them

00:45:11.296 --> 00:45:13.086 A:middle
but that would quickly
get tedious.

00:45:13.456 --> 00:45:15.236 A:middle
And by the way, you
don't want to stop

00:45:15.236 --> 00:45:16.476 A:middle
on the parent or
subclass whatever.

00:45:16.806 --> 00:45:18.956 A:middle
What would be better
would be to try to cons

00:45:18.956 --> 00:45:20.116 A:middle
up a regular expression

00:45:20.116 --> 00:45:23.796 A:middle
which matches all the
functions in a given class.

00:45:24.046 --> 00:45:26.756 A:middle
So in Swift this is an
appropriate regular expression

00:45:27.066 --> 00:45:29.546 A:middle
or in Objective C this is an
appropriate regular expression.

00:45:29.726 --> 00:45:32.406 A:middle
So then you would have
breakpoints on all

00:45:32.406 --> 00:45:34.456 A:middle
of those then you could run your
program and then you could go

00:45:34.456 --> 00:45:35.526 A:middle
through and see what's going on.

00:45:35.526 --> 00:45:38.066 A:middle
And remember because you can
disable individual locations,

00:45:38.336 --> 00:45:40.726 A:middle
when you do this
kind of experiment,

00:45:40.846 --> 00:45:43.606 A:middle
you find that you hit one of
them, you know what it does,

00:45:43.606 --> 00:45:45.456 A:middle
you're uninterested in that
one so you just disable

00:45:45.456 --> 00:45:47.366 A:middle
that location then
you keep going.

00:45:47.366 --> 00:45:49.666 A:middle
The second one you figure out
disable so on and so forth.

00:45:50.006 --> 00:45:52.126 A:middle
So that's kind of a nice
way to explore new code.

00:45:52.286 --> 00:45:54.556 A:middle
An even more radical version

00:45:54.556 --> 00:45:56.306 A:middle
of the same thing is somebody
is giving you a whole shared

00:45:56.306 --> 00:45:57.876 A:middle
library that does some stuff.

00:45:57.936 --> 00:45:59.676 A:middle
You want to just see
what stuff it does

00:45:59.676 --> 00:46:03.016 A:middle
when it's running then set a
regular expression breakpoint,

00:45:59.676 --> 00:46:03.016 A:middle
when it's running then set a
regular expression breakpoint,

00:46:03.016 --> 00:46:04.926 A:middle
I'm using the short
- r form here

00:46:05.246 --> 00:46:07.876 A:middle
and the regular expression
matches everything,

00:46:07.876 --> 00:46:10.216 A:middle
that's what .star
does, and then limit it

00:46:10.216 --> 00:46:12.516 A:middle
to the library you're
interested in.

00:46:12.516 --> 00:46:15.706 A:middle
Combining this with breakpoint
commands can often be a really

00:46:15.706 --> 00:46:18.526 A:middle
nice way just to sort of
get a quick and dirty trace

00:46:18.526 --> 00:46:21.786 A:middle
of execution through this
library, you could backtrace

00:46:21.786 --> 00:46:24.376 A:middle
and maybe print the
locals and then continue

00:46:24.376 --> 00:46:27.436 A:middle
and you'll just run your
program and get a tape output

00:46:27.436 --> 00:46:29.686 A:middle
of the execution
through that library.

00:46:30.316 --> 00:46:31.846 A:middle
Of course it slows
down execution

00:46:31.846 --> 00:46:33.446 A:middle
but you know whatever
sometimes you pay.

00:46:33.956 --> 00:46:37.626 A:middle
And then the other trick
again is as you find ones

00:46:37.626 --> 00:46:39.336 A:middle
that you don't care about,
you can disable them.

00:46:39.676 --> 00:46:41.636 A:middle
So let me talk about
the other kind

00:46:41.826 --> 00:46:43.966 A:middle
of pattern matching in source.

00:46:44.386 --> 00:46:47.946 A:middle
So the point here is that
there are some constructs

00:46:47.946 --> 00:46:49.596 A:middle
that are really obvious
when you're looking

00:46:49.596 --> 00:46:52.466 A:middle
at your source text but
figuring out how to get to them

00:46:52.466 --> 00:46:55.166 A:middle
in the generated code
is really not obvious.

00:46:55.406 --> 00:46:57.436 A:middle
So an example of this is macros

00:46:57.696 --> 00:47:00.086 A:middle
which generally just
get substituted as text

00:46:57.696 --> 00:47:00.086 A:middle
which generally just
get substituted as text

00:47:00.086 --> 00:47:02.996 A:middle
into your program and then
sort of vanish, but you know

00:47:02.996 --> 00:47:04.516 A:middle
where they're inserted
in your code

00:47:04.516 --> 00:47:06.176 A:middle
because they're the things
with capital letters.

00:47:06.446 --> 00:47:09.356 A:middle
So you want to do a search
maybe for all capital letters

00:47:09.356 --> 00:47:11.236 A:middle
or for the particular
macros you care about.

00:47:11.536 --> 00:47:13.886 A:middle
But you can even be
more creative than that

00:47:13.886 --> 00:47:16.426 A:middle
so for instance I
want to know anywhere

00:47:16.426 --> 00:47:19.496 A:middle
that a particular field
is gotten from a pointer

00:47:19.836 --> 00:47:22.406 A:middle
which is something that in
source text I can see obviously

00:47:22.406 --> 00:47:23.956 A:middle
because it's going
to look like that

00:47:24.246 --> 00:47:27.006 A:middle
but in generated code
finding those places would be

00:47:27.006 --> 00:47:27.736 A:middle
quite difficult.

00:47:27.736 --> 00:47:31.416 A:middle
So that's another instance
where using the pattern matching

00:47:31.416 --> 00:47:34.276 A:middle
in your source can allow
you to find constructs

00:47:34.276 --> 00:47:36.576 A:middle
that you might not be
able to find otherwise.

00:47:36.926 --> 00:47:42.696 A:middle
Then another use of this is to
sort of make topic groupings

00:47:42.806 --> 00:47:45.046 A:middle
that you can set
breakpoints on just

00:47:45.206 --> 00:47:47.556 A:middle
by inserting patterns
artificially

00:47:47.556 --> 00:47:50.816 A:middle
into your source code like
as comments saying break here

00:47:50.816 --> 00:47:53.016 A:middle
or break here when
you're interested

00:47:53.016 --> 00:47:55.596 A:middle
in inspecting this
particular subsection

00:47:55.596 --> 00:47:57.226 A:middle
of my program's functionality

00:47:57.526 --> 00:48:00.126 A:middle
and then using these source
regular expression breakpoints

00:47:57.526 --> 00:48:00.126 A:middle
and then using these source
regular expression breakpoints

00:48:00.216 --> 00:48:01.066 A:middle
to catch it.

00:48:01.476 --> 00:48:05.416 A:middle
So here's how the source
breakpoint matching

00:48:05.416 --> 00:48:06.126 A:middle
command works.

00:48:06.406 --> 00:48:09.236 A:middle
There's source regular
expression is the option,

00:48:09.456 --> 00:48:12.136 A:middle
the data you're providing for
this search is the pattern,

00:48:12.366 --> 00:48:16.256 A:middle
and then you can limit it to
one file, you can limit it

00:48:16.256 --> 00:48:19.956 A:middle
to multiple files by just
providing the -f option multiple

00:48:19.956 --> 00:48:23.296 A:middle
times and there's also a flag
to search all your source files.

00:48:24.106 --> 00:48:27.716 A:middle
So let me just give you an
example to whet your appetite.

00:48:27.996 --> 00:48:30.966 A:middle
Suppose I had like a complex
function like a state machine

00:48:31.136 --> 00:48:33.346 A:middle
which is computing stuff
and then it's running

00:48:33.346 --> 00:48:34.616 A:middle
from many different places

00:48:34.616 --> 00:48:36.756 A:middle
in some horrible huge case
statement or something

00:48:36.756 --> 00:48:40.526 A:middle
like that, and I'm interested
in finding out when it's going

00:48:40.526 --> 00:48:43.356 A:middle
to return null but I'd like
to know what was the case

00:48:43.666 --> 00:48:47.586 A:middle
in this particular run through
at which it returned null,

00:48:47.816 --> 00:48:49.666 A:middle
and that's a hard thing
to figure out to do

00:48:49.666 --> 00:48:51.556 A:middle
because you can stop
after the function returns

00:48:51.556 --> 00:48:52.656 A:middle
and check whether it's null.

00:48:52.856 --> 00:48:55.936 A:middle
You can go click on all the
places where it returns null

00:48:55.936 --> 00:48:59.726 A:middle
but you might miss one or you
can just look for the pattern.

00:49:00.176 --> 00:49:02.546 A:middle
There's one other
convenience that we offer you

00:49:02.546 --> 00:49:05.136 A:middle
in the source regular
expression breakpoint type

00:49:05.136 --> 00:49:08.206 A:middle
which is you can specify not
only a file but you can limit it

00:49:08.206 --> 00:49:09.866 A:middle
to a particular function so in

00:49:09.866 --> 00:49:11.326 A:middle
that case I'd do
something like this.

00:49:11.546 --> 00:49:14.796 A:middle
I'd break my pattern
would be return

00:49:14.796 --> 00:49:17.556 A:middle
and then I'm doing showing
that I know regular expressions

00:49:17.556 --> 00:49:20.946 A:middle
because I'm showing off, space
star is any number of spaces

00:49:21.126 --> 00:49:24.246 A:middle
and then my null pointer I limit
it to a function and I limit it

00:49:24.246 --> 00:49:27.466 A:middle
to a file I'm interested in and
then I can find out as I run

00:49:27.466 --> 00:49:29.896 A:middle
through exactly where
I've returned null

00:49:29.896 --> 00:49:31.036 A:middle
in this particular usage.

00:49:32.286 --> 00:49:34.296 A:middle
So it's worthwhile
talking about a couple

00:49:34.296 --> 00:49:37.646 A:middle
of extra breakpoint options that
you might not have heard about.

00:49:37.846 --> 00:49:41.116 A:middle
One of them is along
the lines of the where

00:49:41.116 --> 00:49:44.906 A:middle
or the filter kind that's
useful now that we have Swift

00:49:44.906 --> 00:49:49.216 A:middle
and Objective C together in
programs which is the ability

00:49:49.216 --> 00:49:51.186 A:middle
to specify a language
for a breakpoint.

00:49:51.186 --> 00:49:54.176 A:middle
So for instance, there are a
lot of count methods everywhere

00:49:54.176 --> 00:49:55.796 A:middle
in the world and if
you set a breakpoint

00:49:55.796 --> 00:49:58.306 A:middle
on the name count you're
going to set it on a bunch

00:49:58.306 --> 00:50:00.546 A:middle
of Swift code but you're also
going to set it on a bunch

00:49:58.306 --> 00:50:00.546 A:middle
of Swift code but you're also
going to set it on a bunch

00:50:00.546 --> 00:50:02.356 A:middle
of Objective C methods
and you don't care

00:50:02.356 --> 00:50:05.136 A:middle
about the Objective C methods,
you only want the Swift ones,

00:50:05.476 --> 00:50:08.126 A:middle
then you can just
specify the language Swift

00:50:08.126 --> 00:50:09.826 A:middle
and it won't set a
breakpoint on any

00:50:09.826 --> 00:50:11.716 A:middle
of the Objective C names
that happen to match.

00:50:11.786 --> 00:50:15.426 A:middle
So that's just a useful little
convenience and yeah, right.

00:50:15.656 --> 00:50:19.516 A:middle
And one other option that's
sometimes useful is being able

00:50:19.626 --> 00:50:22.716 A:middle
to narrow your search
to a particular thread.

00:50:22.966 --> 00:50:25.836 A:middle
So you've got some code that's
being called and a bunch

00:50:25.836 --> 00:50:27.856 A:middle
of different threads, it's like
a kernel or something like that

00:50:27.996 --> 00:50:31.126 A:middle
but you've starting working
on the execution in one thread

00:50:31.126 --> 00:50:33.756 A:middle
and you don't want your
breakpoints that you're using

00:50:33.756 --> 00:50:35.526 A:middle
for the investigation
to take you off

00:50:35.526 --> 00:50:37.696 A:middle
onto other threads,
it's fairly simple.

00:50:37.946 --> 00:50:41.926 A:middle
There's a thread ID option and
there's one that you can do

00:50:41.926 --> 00:50:43.406 A:middle
by thread name which you set

00:50:43.406 --> 00:50:45.986 A:middle
with this pthread
set name np call.

00:50:45.986 --> 00:50:48.966 A:middle
That one is convenient because
if you name a thread then

00:50:48.966 --> 00:50:51.246 A:middle
that persists over
many debugging sessions

00:50:51.246 --> 00:50:53.616 A:middle
where of course the thread ID
is going to change every time,

00:50:54.036 --> 00:50:57.976 A:middle
and you can even restrict it
to code that's being serviced

00:50:57.976 --> 00:50:59.596 A:middle
on a particular queue by name.

00:51:01.076 --> 00:51:02.846 A:middle
One other thing that
you might note is

00:51:02.846 --> 00:51:06.116 A:middle
that you can add all these
options to existing breakpoints

00:51:06.286 --> 00:51:08.976 A:middle
and particularly that's
useful if you've set file

00:51:08.976 --> 00:51:11.726 A:middle
and line breakpoint
in Xcode in the gutter

00:51:11.726 --> 00:51:14.526 A:middle
but then you decide you want to
like for instance limit that one

00:51:14.526 --> 00:51:16.716 A:middle
to a particular thread and
you can change all these

00:51:16.716 --> 00:51:18.786 A:middle
after the fact, the
command is break modify,

00:51:19.096 --> 00:51:20.076 A:middle
and the other useful thing

00:51:20.076 --> 00:51:22.846 A:middle
in this slide is showing
you how you specify them

00:51:23.136 --> 00:51:26.606 A:middle
because you can specify
either by breakpoint,

00:51:26.996 --> 00:51:28.616 A:middle
by breakpoint location number

00:51:28.696 --> 00:51:31.316 A:middle
and there's also a little
syntax to specify ranges.

00:51:33.296 --> 00:51:35.106 A:middle
That's that.

00:51:35.316 --> 00:51:38.436 A:middle
So now you've come up with
all these clever breakpoints

00:51:38.636 --> 00:51:41.626 A:middle
that you want but you run into
a little road block which is

00:51:41.626 --> 00:51:42.926 A:middle
that it turns out Xcode

00:51:42.926 --> 00:51:45.066 A:middle
at present only persists
breakpoints

00:51:45.066 --> 00:51:48.686 A:middle
that it knows you set and so
the ones that you've managed

00:51:48.686 --> 00:51:51.206 A:middle
to write in by hand
it won't know about.

00:51:51.446 --> 00:51:53.016 A:middle
So how do you make them persist?

00:51:53.316 --> 00:51:56.556 A:middle
The first way is what Enrico
told you about if you want it

00:51:56.556 --> 00:51:58.786 A:middle
to hold for all projects,
you just put it

00:51:58.786 --> 00:52:01.046 A:middle
in your LLDB init file
and then you're done.

00:51:58.786 --> 00:52:01.046 A:middle
in your LLDB init file
and then you're done.

00:52:01.336 --> 00:52:03.506 A:middle
But if you want to make
project specific ones,

00:52:03.506 --> 00:52:05.326 A:middle
here's a cute little
trick that you can use

00:52:05.546 --> 00:52:08.656 A:middle
to get the breakpoints
loaded every time you debug

00:52:08.656 --> 00:52:09.866 A:middle
that particular project.

00:52:10.186 --> 00:52:13.216 A:middle
What you do is make an
Xcode stored breakpoint,

00:52:13.466 --> 00:52:15.406 A:middle
preferably something that's
going to get hit early

00:52:15.406 --> 00:52:16.966 A:middle
on in your program execution,

00:52:17.186 --> 00:52:18.466 A:middle
and then you put
your breakpoints

00:52:18.466 --> 00:52:19.706 A:middle
as commands in that one.

00:52:19.706 --> 00:52:23.326 A:middle
So you know if you're a main
executable for instance,

00:52:23.326 --> 00:52:25.116 A:middle
main is a very convenient place

00:52:25.116 --> 00:52:26.786 A:middle
so you would make a
symbolic breakpoint

00:52:27.156 --> 00:52:29.626 A:middle
and then you would put main in

00:52:29.836 --> 00:52:32.906 A:middle
and then you would remember
the slide a while ago now

00:52:32.906 --> 00:52:34.776 A:middle
where I told you about our
little trouble with main,

00:52:34.976 --> 00:52:37.086 A:middle
so you would specify
the shared library,

00:52:37.476 --> 00:52:39.466 A:middle
then you would add an action

00:52:39.466 --> 00:52:42.016 A:middle
which is a debugger command
action and then don't type

00:52:42.016 --> 00:52:44.466 A:middle
in all of the breakpoints
in one in one in one here

00:52:44.466 --> 00:52:45.906 A:middle
because that's just
going to get tedious.

00:52:46.156 --> 00:52:48.806 A:middle
It's much easier to put
the commands in a file

00:52:48.946 --> 00:52:51.276 A:middle
and then use LLDB's
command source command

00:52:51.276 --> 00:52:54.166 A:middle
to load those commands in,
load those breakpoints in

00:52:54.436 --> 00:52:55.236 A:middle
and then finally

00:52:55.236 --> 00:52:57.556 A:middle
if you autocontinue then just
every time you run you will

00:52:57.556 --> 00:53:00.396 A:middle
automatically have all of
those breakpoints set for you.

00:52:57.556 --> 00:53:00.396 A:middle
automatically have all of
those breakpoints set for you.

00:53:01.106 --> 00:53:05.416 A:middle
So I want to show you one other
little convenience we've added

00:53:05.826 --> 00:53:09.076 A:middle
to overcome one particularly
annoying problem that you get

00:53:09.386 --> 00:53:13.896 A:middle
in modern languages which
is when you're trying

00:53:13.896 --> 00:53:16.276 A:middle
to step you're trying
to step into something

00:53:16.496 --> 00:53:19.906 A:middle
but the problem is that in
most modern languages most

00:53:19.906 --> 00:53:23.146 A:middle
of the variable access is
now done either as properties

00:53:23.146 --> 00:53:25.956 A:middle
or through accessor
functions or whatever so that

00:53:26.166 --> 00:53:29.906 A:middle
and they're generally that's not
the code you're trying to debug.

00:53:30.286 --> 00:53:32.246 A:middle
So you end up in a scenario

00:53:32.246 --> 00:53:34.826 A:middle
like this you know I'm
here I'm trying to get

00:53:34.826 --> 00:53:35.916 A:middle
into this function,
do something.

00:53:35.916 --> 00:53:36.906 A:middle
I want to step in there.

00:53:37.106 --> 00:53:41.136 A:middle
So I try that I step and I
don't end up there because one

00:53:41.136 --> 00:53:43.826 A:middle
of the arguments that I was
passing was an accessor function

00:53:43.826 --> 00:53:44.956 A:middle
so I ended up in the accessor.

00:53:44.996 --> 00:53:47.356 A:middle
I don't want to be there because
it's not very interesting

00:53:47.576 --> 00:53:49.146 A:middle
so what I'm going end
up doing is finishing

00:53:49.146 --> 00:53:50.296 A:middle
out and stepping back.

00:53:50.436 --> 00:53:52.956 A:middle
So is there any way that we can
make that slightly more easy?

00:53:53.146 --> 00:53:55.816 A:middle
And it turns out that we've
added something called targeted

00:53:55.816 --> 00:53:59.136 A:middle
stepping so the option
is the step in target

00:53:59.136 --> 00:54:01.806 A:middle
that you would say by
saying step and what I want

00:53:59.136 --> 00:54:01.806 A:middle
that you would say by
saying step and what I want

00:54:01.806 --> 00:54:04.346 A:middle
to do is I want you to step
but I only want you to stop

00:54:04.346 --> 00:54:05.636 A:middle
in this particular place,

00:54:05.636 --> 00:54:07.276 A:middle
that's what you're
expressing with this.

00:54:07.676 --> 00:54:10.356 A:middle
So let's try that in this
case and what we'll find is

00:54:10.356 --> 00:54:12.246 A:middle
that it almost but
doesn't quite work

00:54:12.376 --> 00:54:13.946 A:middle
and the reason it
doesn't quite work is

00:54:13.946 --> 00:54:16.286 A:middle
because though we didn't
end up in the accessor,

00:54:16.436 --> 00:54:19.966 A:middle
we ended up on the next source
line instead of in our function.

00:54:19.966 --> 00:54:21.406 A:middle
And that makes sense
when you think about it

00:54:21.406 --> 00:54:24.156 A:middle
because actually stepping is
source line by source line

00:54:24.306 --> 00:54:25.976 A:middle
and that was the multiline call.

00:54:26.046 --> 00:54:29.786 A:middle
So we've also added the
ability to specify the end range

00:54:29.786 --> 00:54:31.186 A:middle
of the stepping operation

00:54:31.386 --> 00:54:33.056 A:middle
by saying what the
end line number is

00:54:33.216 --> 00:54:35.566 A:middle
or even more conveniently
you can say just step

00:54:35.566 --> 00:54:38.756 A:middle
through this block and get me
in to do something I don't care.

00:54:38.996 --> 00:54:40.596 A:middle
And there's even
an alias for that

00:54:40.596 --> 00:54:43.376 A:middle
which is sif step in function.

00:54:43.676 --> 00:54:46.406 A:middle
So then what you would do
is you would be sitting here

00:54:46.406 --> 00:54:49.256 A:middle
and you would say step in
function and then you'd land

00:54:49.256 --> 00:54:51.006 A:middle
in the right place or if you
didn't I wouldn't have put it

00:54:51.006 --> 00:54:51.526 A:middle
on the slide.

00:54:52.386 --> 00:54:54.616 A:middle
So that I want to conclude
with a couple little bits

00:54:54.616 --> 00:54:56.036 A:middle
of troubleshooting information.

00:54:56.346 --> 00:54:58.926 A:middle
One piece of information
you often need

00:54:58.926 --> 00:55:02.446 A:middle
to know is what is actually
in my running program.

00:54:58.926 --> 00:55:02.446 A:middle
to know is what is actually
in my running program.

00:55:02.636 --> 00:55:05.366 A:middle
For instance maybe I built
the release and debug versions

00:55:05.546 --> 00:55:07.716 A:middle
and I want to know which
one I'm actually using

00:55:07.976 --> 00:55:10.116 A:middle
or somebody gave me a
library with a dSYM.

00:55:10.116 --> 00:55:11.556 A:middle
Did the dSYM get read in?

00:55:11.876 --> 00:55:13.356 A:middle
So the command that inquiries

00:55:13.566 --> 00:55:15.956 A:middle
about that information is
the image list command.

00:55:15.956 --> 00:55:18.016 A:middle
You can either give
it a module name

00:55:18.016 --> 00:55:19.356 A:middle
in which case it will
tell you information

00:55:19.356 --> 00:55:21.636 A:middle
about just one module
loaded into your program

00:55:21.636 --> 00:55:26.656 A:middle
or for amusement's sake you can
give no options you'll show all

00:55:26.656 --> 00:55:28.256 A:middle
of them which is
sometimes eye opening.

00:55:28.536 --> 00:55:32.216 A:middle
So here's an example just
to see how it's used.

00:55:32.536 --> 00:55:37.466 A:middle
I say image list example
and I see here is the path

00:55:37.466 --> 00:55:39.096 A:middle
to the binary so for
instance if I wanted

00:55:39.096 --> 00:55:41.476 A:middle
to check whether I was
using the debug build, yeah,

00:55:41.476 --> 00:55:43.436 A:middle
okay it does look like
I'm using the debug build

00:55:43.706 --> 00:55:45.706 A:middle
and if there is a
dSYM available,

00:55:45.706 --> 00:55:47.636 A:middle
it will always be
listed after the binary

00:55:47.636 --> 00:55:49.686 A:middle
so in this case I see
I did get my binary.

00:55:50.066 --> 00:55:53.376 A:middle
I want to tell you one thing
about Swift debug information.

00:55:53.486 --> 00:55:56.306 A:middle
I put on this slide the why
but I'm not actually going

00:55:56.306 --> 00:55:57.966 A:middle
to tell you the why because
we're running a little short

00:55:57.966 --> 00:56:01.956 A:middle
of time, but I'll tell you
the TLDR because I'm going

00:55:57.966 --> 00:56:01.956 A:middle
of time, but I'll tell you
the TLDR because I'm going

00:56:01.956 --> 00:56:03.416 A:middle
through too fast
for you to read.

00:56:03.416 --> 00:56:06.986 A:middle
The TLDR is that because of
the way Swift and LLDB work

00:56:06.986 --> 00:56:09.956 A:middle
with one another all the
Swift code that you have

00:56:09.956 --> 00:56:13.236 A:middle
that has debug information
has to have been built locally

00:56:13.446 --> 00:56:16.726 A:middle
so copying binaries from other
people doesn't currently work

00:56:16.726 --> 00:56:17.426 A:middle
and stuff like that.

00:56:17.426 --> 00:56:18.386 A:middle
You have to have made sure

00:56:18.386 --> 00:56:21.626 A:middle
that everything has been built
locally and with the compiler

00:56:21.816 --> 00:56:23.426 A:middle
that goes along with
the debugger

00:56:23.426 --> 00:56:24.586 A:middle
that you're currently using.

00:56:25.436 --> 00:56:29.216 A:middle
I want to say this is one
little convenience we've offered

00:56:29.216 --> 00:56:31.896 A:middle
and so Enrico's rule of
optimized code debugging

00:56:31.896 --> 00:56:35.186 A:middle
as we saw earlier is don't do
it if you don't have to and then

00:56:35.336 --> 00:56:40.416 A:middle
since most software developers
are rational actors you can

00:56:40.416 --> 00:56:42.936 A:middle
write a corollary to that
which is that most people

00:56:42.936 --> 00:56:45.866 A:middle
who debug optimized code
actually do it by accident.

00:56:46.206 --> 00:56:48.576 A:middle
So now LLDB will tell you

00:56:48.736 --> 00:56:51.966 A:middle
that a file was compiled
optimized when you stop in it.

00:56:51.966 --> 00:56:54.436 A:middle
It will only tell
you once per library

00:56:54.606 --> 00:56:56.006 A:middle
and you'll get a little
message like this.

00:56:56.006 --> 00:56:58.346 A:middle
And then you run quickly
to your build settings

00:56:58.556 --> 00:57:00.826 A:middle
and change them back.

00:56:58.556 --> 00:57:00.826 A:middle
and change them back.

00:57:00.956 --> 00:57:03.266 A:middle
One other new feature
that was added

00:57:03.266 --> 00:57:05.836 A:middle
to clang a while ago was
this notion of modules.

00:57:06.076 --> 00:57:09.536 A:middle
So modules are a way to
allow the compiler to look

00:57:09.536 --> 00:57:11.946 A:middle
at all the headers that
are the header environment

00:57:11.946 --> 00:57:16.766 A:middle
for your program, compile
them, parse them up once

00:57:17.036 --> 00:57:19.646 A:middle
and then reuse that
for all the compiles.

00:57:19.906 --> 00:57:22.426 A:middle
So then we thought well why
can't we also do the same thing

00:57:22.426 --> 00:57:24.116 A:middle
for the debug information?

00:57:24.116 --> 00:57:28.366 A:middle
Why don't we allow that parsed
form of the type information

00:57:28.366 --> 00:57:34.136 A:middle
to be also done once and then
shared amongst all the .o files

00:57:34.136 --> 00:57:35.386 A:middle
that you have debug information?

00:57:35.386 --> 00:57:38.086 A:middle
So that's called clang
module debug feature.

00:57:38.086 --> 00:57:40.786 A:middle
We can also use PCH
files by the way.

00:57:40.966 --> 00:57:44.756 A:middle
The setting in Xcode is
clang module debugging

00:57:44.756 --> 00:57:46.906 A:middle
and here's the flag for
some reason I put that in.

00:57:47.176 --> 00:57:51.086 A:middle
This is great because again like
with the compiler this speeds

00:57:51.086 --> 00:57:53.816 A:middle
up the generation of the debug
information, it will speed

00:57:53.816 --> 00:57:58.266 A:middle
up your compile times but it has
one caveat, and that caveat is

00:57:58.266 --> 00:58:00.326 A:middle
that or actually one major one.

00:57:58.266 --> 00:58:00.326 A:middle
that or actually one major one.

00:58:00.326 --> 00:58:03.696 A:middle
So that caveat is that now
your debugging is depending

00:58:03.696 --> 00:58:06.226 A:middle
on your .o files but also
on something that's sitting

00:58:06.226 --> 00:58:07.706 A:middle
in some cache somewhere.

00:58:08.096 --> 00:58:11.526 A:middle
So normally that's not a
problem everything is in place

00:58:11.686 --> 00:58:15.296 A:middle
but when you go to ship
your library or application

00:58:15.296 --> 00:58:17.536 A:middle
to somebody else, how
is that going to work?

00:58:17.536 --> 00:58:19.356 A:middle
Well, if it's an application

00:58:19.356 --> 00:58:23.426 A:middle
or a framework then you just
run dsymutil like you already do

00:58:23.426 --> 00:58:24.436 A:middle
and it does the right job,

00:58:24.436 --> 00:58:26.506 A:middle
it gathers everything
together and that all works.

00:58:26.806 --> 00:58:30.326 A:middle
But remember that dsymutil
only works on linked products,

00:58:30.326 --> 00:58:32.086 A:middle
it doesn't work on .o files.

00:58:32.306 --> 00:58:35.836 A:middle
So if you are shipping static
archives with debug information,

00:58:36.076 --> 00:58:38.676 A:middle
then you must turn off
this G module's feature

00:58:38.676 --> 00:58:42.026 A:middle
or you will ship broken debug
information to your clients.

00:58:42.076 --> 00:58:44.616 A:middle
And also by the way, if you're
running out of disk space

00:58:44.616 --> 00:58:47.076 A:middle
and you delete your module
cache, now you're not going

00:58:47.076 --> 00:58:48.186 A:middle
to be able to debug anymore.

00:58:48.786 --> 00:58:51.356 A:middle
So that's the only down
side to that feature.

00:58:52.056 --> 00:58:55.406 A:middle
So with that let me tell
you what you've seen.

00:58:56.006 --> 00:58:59.196 A:middle
We hope that you see that LLDB
is an extremely customizable

00:58:59.196 --> 00:59:03.136 A:middle
debugger providing you many
ways to look at your data

00:58:59.196 --> 00:59:03.136 A:middle
debugger providing you many
ways to look at your data

00:59:03.136 --> 00:59:06.246 A:middle
that expressions actually
give you much more power

00:59:06.246 --> 00:59:08.966 A:middle
for investigation and I
thought Sean's example was great

00:59:08.966 --> 00:59:11.396 A:middle
of how you actually
live go through

00:59:11.396 --> 00:59:14.236 A:middle
and find what you're interested
in in a complex array,

00:59:14.656 --> 00:59:17.416 A:middle
that we have more
breakpoint types than you know

00:59:17.416 --> 00:59:21.506 A:middle
of in your Xcode and that
you can actually get yourself

00:59:21.506 --> 00:59:23.346 A:middle
into super deep trouble
with more

00:59:23.346 --> 00:59:24.586 A:middle
than source level debugging,

00:59:24.586 --> 00:59:27.716 A:middle
and in general we hope we
provide you a rich set of tools

00:59:27.716 --> 00:59:28.786 A:middle
for exploring your code.

00:59:29.086 --> 00:59:32.036 A:middle
And here are a couple
of the previous sessions

00:59:32.036 --> 00:59:33.426 A:middle
that might have interesting
information.

00:59:33.586 --> 00:59:36.246 A:middle
There were a couple of sessions
earlier on which you didn't see

00:59:36.476 --> 00:59:39.326 A:middle
or did see but anyway they
are available on slides.

00:59:39.416 --> 00:59:40.786 A:middle
And with that thank
you and I hope

00:59:40.786 --> 00:59:42.976 A:middle
that you enjoy the little tiny
bit that remains of your WWDC.

00:59:43.016 --> 00:59:45.000 A:middle
[ Applause ]
