WEBVTT

00:00:07.516 --> 00:00:15.500 A:middle
[ Crowd Sounds ]

00:00:18.346 --> 00:00:19.436 A:middle
&gt;&gt; Good morning, everyone.

00:00:19.916 --> 00:00:22.256 A:middle
And welcome to session 237 this

00:00:22.256 --> 00:00:23.386 A:middle
early Friday morning.

00:00:23.716 --> 00:00:25.086 A:middle
My name is Fredrik Olsson and

00:00:25.136 --> 00:00:26.396 A:middle
I'm an engineer on the MapKit

00:00:26.446 --> 00:00:26.726 A:middle
team.

00:00:26.996 --> 00:00:28.916 A:middle
And today I'm here to talk about

00:00:28.916 --> 00:00:30.286 A:middle
what's new in MapKit.

00:00:31.496 --> 00:00:33.376 A:middle
The generic map, the standard

00:00:33.376 --> 00:00:35.476 A:middle
map that has been with us for a

00:00:35.476 --> 00:00:37.566 A:middle
couple of iterations all the

00:00:37.566 --> 00:00:39.476 A:middle
time, is a good map.

00:00:39.736 --> 00:00:41.566 A:middle
It has a road network for easy

00:00:41.566 --> 00:00:42.346 A:middle
navigation.

00:00:42.346 --> 00:00:43.896 A:middle
You have your points of interest

00:00:43.896 --> 00:00:44.886 A:middle
for reference.

00:00:45.376 --> 00:00:48.226 A:middle
But sometimes your application

00:00:48.606 --> 00:00:51.446 A:middle
has a little bit more specific

00:00:51.486 --> 00:00:52.916 A:middle
kind of data that you want to

00:00:52.916 --> 00:00:53.636 A:middle
stand out.

00:00:54.006 --> 00:00:56.896 A:middle
Like we had in AppleMaps when we

00:00:56.896 --> 00:00:58.996 A:middle
added the transit mode when we

00:00:58.996 --> 00:01:01.046 A:middle
want the transit line to stand

00:01:01.046 --> 00:01:03.046 A:middle
up and the map to take a little

00:01:03.046 --> 00:01:05.496 A:middle
bit of a step back, mute down

00:01:05.496 --> 00:01:07.856 A:middle
and let the data pop so the user

00:01:07.856 --> 00:01:09.246 A:middle
can see what is important at the

00:01:09.246 --> 00:01:09.686 A:middle
moment.

00:01:10.316 --> 00:01:14.246 A:middle
In new iOS 11, we give you muted

00:01:14.316 --> 00:01:16.626 A:middle
standard map type but do the

00:01:16.626 --> 00:01:18.706 A:middle
same for your applications so

00:01:18.706 --> 00:01:20.746 A:middle
that your data can stand out on

00:01:20.746 --> 00:01:22.796 A:middle
your map and your applications.

00:01:25.276 --> 00:01:28.756 A:middle
The map is not only the map.

00:01:29.456 --> 00:01:30.816 A:middle
There are also a couple of

00:01:30.816 --> 00:01:32.966 A:middle
system controls that we provide

00:01:32.966 --> 00:01:34.696 A:middle
for free on top of the map.

00:01:35.596 --> 00:01:37.536 A:middle
You have up in the left corner

00:01:37.536 --> 00:01:39.616 A:middle
here you can see the scale view.

00:01:39.616 --> 00:01:42.186 A:middle
You have the complex view up in

00:01:42.186 --> 00:01:43.016 A:middle
the right corner.

00:01:43.376 --> 00:01:46.376 A:middle
And down in the bottom right you

00:01:46.376 --> 00:01:48.006 A:middle
have a friend that has been

00:01:48.006 --> 00:01:50.796 A:middle
available as API for your use,

00:01:51.036 --> 00:01:52.996 A:middle
the user tracking bar bottom

00:01:52.996 --> 00:01:53.406 A:middle
item.

00:01:54.766 --> 00:01:57.546 A:middle
Now, it is a bar bottom item

00:01:57.546 --> 00:01:58.736 A:middle
which means that you can only

00:01:58.736 --> 00:02:01.496 A:middle
use it within the context of a

00:02:01.496 --> 00:02:04.296 A:middle
bar, such as navigation bars or

00:02:04.296 --> 00:02:04.916 A:middle
tool bars.

00:02:05.396 --> 00:02:07.326 A:middle
And if you want to display it

00:02:07.566 --> 00:02:10.126 A:middle
anywhere else, you have to

00:02:10.366 --> 00:02:11.886 A:middle
unfortunately roll your own.

00:02:12.216 --> 00:02:17.206 A:middle
And in iOS 11 we fixed that and

00:02:17.206 --> 00:02:18.836 A:middle
we give you a proper user

00:02:18.836 --> 00:02:20.616 A:middle
tracking button that is the

00:02:20.616 --> 00:02:22.996 A:middle
UIView subclass so that you can

00:02:22.996 --> 00:02:26.516 A:middle
use it wherever and whenever it,

00:02:27.766 --> 00:02:29.866 A:middle
well is good for the context of

00:02:29.866 --> 00:02:30.856 A:middle
your application.

00:02:32.256 --> 00:02:33.916 A:middle
When we give you the user

00:02:33.916 --> 00:02:36.436 A:middle
tracking button, we thought why

00:02:36.436 --> 00:02:37.756 A:middle
not give you more?

00:02:37.756 --> 00:02:40.676 A:middle
So, yes we will now also give

00:02:40.676 --> 00:02:42.256 A:middle
you the compass button.

00:02:43.706 --> 00:02:46.076 A:middle
The compass button is by

00:02:46.076 --> 00:02:48.546 A:middle
standard app in the upper right

00:02:48.546 --> 00:02:48.986 A:middle
corner.

00:02:49.506 --> 00:02:52.456 A:middle
By having it as a UIView button

00:02:52.456 --> 00:02:54.056 A:middle
you can position it wherever you

00:02:54.056 --> 00:02:54.496 A:middle
want.

00:02:54.926 --> 00:02:56.966 A:middle
You can even put it in one of

00:02:56.966 --> 00:02:58.476 A:middle
the navigation bars if you want

00:02:58.476 --> 00:02:58.686 A:middle
to.

00:02:59.386 --> 00:03:02.326 A:middle
The compass button has one more

00:03:02.326 --> 00:03:04.506 A:middle
property than the user tracking

00:03:04.506 --> 00:03:05.126 A:middle
button do.

00:03:05.446 --> 00:03:07.756 A:middle
It's the compass visibility.

00:03:08.276 --> 00:03:10.716 A:middle
It's on purpose that the compass

00:03:10.716 --> 00:03:12.946 A:middle
visibility is not just

00:03:12.946 --> 00:03:15.596 A:middle
repurposing the hidden property

00:03:15.996 --> 00:03:19.386 A:middle
or some equal simple bool yes

00:03:19.386 --> 00:03:21.096 A:middle
show it or don't show it.

00:03:21.766 --> 00:03:23.476 A:middle
We already could show the

00:03:23.476 --> 00:03:25.846 A:middle
compass on the map view by using

00:03:25.846 --> 00:03:28.776 A:middle
the shows compass on the map

00:03:28.776 --> 00:03:29.556 A:middle
view itself.

00:03:29.656 --> 00:03:31.456 A:middle
Which is a Boolean yes no.

00:03:31.776 --> 00:03:34.596 A:middle
But it's a bit limited and

00:03:34.996 --> 00:03:36.876 A:middle
doesn't encompass all the

00:03:37.116 --> 00:03:38.626 A:middle
features that we want to expose.

00:03:38.906 --> 00:03:41.326 A:middle
So, feature visibility is a new

00:03:41.326 --> 00:03:41.816 A:middle
enum.

00:03:43.066 --> 00:03:44.546 A:middle
It has three states.

00:03:44.786 --> 00:03:46.346 A:middle
The adaptive mode which is the

00:03:46.346 --> 00:03:48.386 A:middle
default, hidden and visible.

00:03:49.226 --> 00:03:51.646 A:middle
And if you look at them, hidden

00:03:52.426 --> 00:03:53.336 A:middle
is obvious.

00:03:53.336 --> 00:03:54.726 A:middle
It does what it says.

00:03:55.076 --> 00:03:57.526 A:middle
Visible also does what it says,

00:03:57.526 --> 00:04:00.676 A:middle
so no reason to talk much more

00:04:00.676 --> 00:04:01.166 A:middle
about it.

00:04:01.246 --> 00:04:04.376 A:middle
But the adaptive default mode do

00:04:04.486 --> 00:04:05.646 A:middle
require a little bit of

00:04:05.646 --> 00:04:06.316 A:middle
explanation.

00:04:07.246 --> 00:04:08.896 A:middle
What the adaptive mode do is

00:04:08.896 --> 00:04:11.006 A:middle
that if the user has rotated the

00:04:11.006 --> 00:04:13.056 A:middle
map a little bit away from pure

00:04:13.056 --> 00:04:14.566 A:middle
north, we display it.

00:04:15.186 --> 00:04:16.876 A:middle
And if the user rotates back to

00:04:16.876 --> 00:04:19.536 A:middle
pure north, we fade it away.

00:04:20.546 --> 00:04:22.386 A:middle
And being a button, if you tap

00:04:22.386 --> 00:04:24.986 A:middle
on it we will rotate back to

00:04:24.986 --> 00:04:26.826 A:middle
pure north and fade it away as

00:04:26.826 --> 00:04:27.106 A:middle
well.

00:04:28.216 --> 00:04:29.876 A:middle
It is tapable in all the

00:04:29.876 --> 00:04:32.186 A:middle
different visibility states, so

00:04:33.056 --> 00:04:34.126 A:middle
you can always tap it.

00:04:34.326 --> 00:04:35.536 A:middle
It will always be a button.

00:04:35.536 --> 00:04:37.386 A:middle
But it's a nice catch.

00:04:37.786 --> 00:04:39.426 A:middle
And if the user rotates away

00:04:39.426 --> 00:04:41.636 A:middle
from pure north past the little

00:04:41.636 --> 00:04:43.826 A:middle
threshold, we fade it in again.

00:04:44.596 --> 00:04:46.386 A:middle
And that is the compass button.

00:04:47.506 --> 00:04:49.836 A:middle
The last sibling, the scale

00:04:49.836 --> 00:04:50.116 A:middle
view.

00:04:52.386 --> 00:04:54.736 A:middle
Also have the visibility

00:04:54.906 --> 00:04:57.356 A:middle
property which is the same three

00:04:57.356 --> 00:04:59.026 A:middle
states in enumeration.

00:04:59.626 --> 00:05:01.636 A:middle
Hidden, self-explanatory.

00:05:01.636 --> 00:05:04.426 A:middle
Visible, also self-explanatory.

00:05:04.926 --> 00:05:07.936 A:middle
And adaptive is a new behavior

00:05:08.056 --> 00:05:10.636 A:middle
where when your user is zooming

00:05:10.676 --> 00:05:14.226 A:middle
in and out, then we display the

00:05:14.226 --> 00:05:14.836 A:middle
scale view.

00:05:14.946 --> 00:05:16.206 A:middle
Otherwise, we hide it.

00:05:17.426 --> 00:05:19.016 A:middle
The scale view has also been

00:05:19.016 --> 00:05:20.856 A:middle
available on map view previously

00:05:20.946 --> 00:05:23.956 A:middle
with the show scale property on

00:05:23.996 --> 00:05:24.476 A:middle
map view.

00:05:25.896 --> 00:05:28.076 A:middle
The default behavior for show

00:05:28.076 --> 00:05:30.146 A:middle
scale and show compass has

00:05:30.146 --> 00:05:31.706 A:middle
unfortunately been a little bit

00:05:31.796 --> 00:05:32.366 A:middle
different.

00:05:32.776 --> 00:05:33.956 A:middle
So, where the default for

00:05:33.956 --> 00:05:36.596 A:middle
showing the compass has been the

00:05:36.596 --> 00:05:38.446 A:middle
adaptive mode where we hide it,

00:05:39.166 --> 00:05:41.566 A:middle
the default for scale has been

00:05:41.566 --> 00:05:42.706 A:middle
to always show it.

00:05:43.126 --> 00:05:45.186 A:middle
And now with the scale view

00:05:45.506 --> 00:05:47.296 A:middle
being exposed to you, you have

00:05:47.296 --> 00:05:49.786 A:middle
all three options available to

00:05:49.786 --> 00:05:50.996 A:middle
use as it fits in your

00:05:50.996 --> 00:05:51.746 A:middle
applications.

00:05:53.086 --> 00:05:56.926 A:middle
There is one more property on

00:05:56.926 --> 00:05:57.516 A:middle
the scale view.

00:05:58.326 --> 00:05:59.916 A:middle
The legend alignment.

00:06:00.336 --> 00:06:02.636 A:middle
The legend alignment is related

00:06:02.636 --> 00:06:04.646 A:middle
to the also new and improved

00:06:05.356 --> 00:06:07.306 A:middle
localization support for map

00:06:07.306 --> 00:06:07.586 A:middle
view.

00:06:08.896 --> 00:06:11.656 A:middle
Previously, the compass has

00:06:11.656 --> 00:06:13.226 A:middle
always been in the upper right.

00:06:13.756 --> 00:06:15.666 A:middle
The scale has always been in the

00:06:15.856 --> 00:06:16.526 A:middle
upper left.

00:06:17.666 --> 00:06:19.866 A:middle
These are the defaults you get.

00:06:20.426 --> 00:06:23.976 A:middle
But new in iOS 11, if you

00:06:23.976 --> 00:06:26.306 A:middle
recompile against iOS 11 SDK, we

00:06:26.746 --> 00:06:29.606 A:middle
will instead fix the compass

00:06:29.716 --> 00:06:31.736 A:middle
against the trailing edge and

00:06:31.736 --> 00:06:33.176 A:middle
the scale view against the

00:06:33.176 --> 00:06:35.916 A:middle
leading edge to get that natural

00:06:36.336 --> 00:06:38.226 A:middle
look and feel for our

00:06:38.336 --> 00:06:39.636 A:middle
right-to-left users.

00:06:40.756 --> 00:06:42.986 A:middle
This, however, has one little

00:06:43.396 --> 00:06:46.546 A:middle
complication that leads us into

00:06:46.546 --> 00:06:48.816 A:middle
legend alignment property and

00:06:48.816 --> 00:06:49.586 A:middle
why we need it.

00:06:50.656 --> 00:06:53.836 A:middle
The default is leading, which

00:06:53.836 --> 00:06:56.876 A:middle
means that we will fit the

00:06:56.876 --> 00:07:00.796 A:middle
serial point of the legend to

00:07:00.796 --> 00:07:02.946 A:middle
the edge, the leading edge.

00:07:03.586 --> 00:07:05.086 A:middle
And the upper bound of the

00:07:05.086 --> 00:07:07.866 A:middle
legend is flexible and will move

00:07:07.866 --> 00:07:09.746 A:middle
as the users zoom in and out.

00:07:10.456 --> 00:07:12.516 A:middle
And the leading edge for in this

00:07:12.516 --> 00:07:14.376 A:middle
example British English would be

00:07:14.376 --> 00:07:15.316 A:middle
the left-hand side.

00:07:15.816 --> 00:07:18.006 A:middle
And for Arabic in this example

00:07:18.006 --> 00:07:20.076 A:middle
is always the right-hand side.

00:07:20.706 --> 00:07:22.256 A:middle
If you instead want to align

00:07:22.596 --> 00:07:25.036 A:middle
your scale view to the opposite

00:07:25.156 --> 00:07:27.516 A:middle
side of the screen, you need to

00:07:27.516 --> 00:07:29.176 A:middle
set the legend alignment

00:07:29.176 --> 00:07:32.146 A:middle
property to trailing and we will

00:07:32.236 --> 00:07:34.536 A:middle
flip the zero point that is

00:07:34.536 --> 00:07:38.626 A:middle
fixed and to dynamically adapt

00:07:39.286 --> 00:07:41.476 A:middle
to the localization that is

00:07:41.476 --> 00:07:42.206 A:middle
currently being used.

00:07:42.416 --> 00:07:43.476 A:middle
This makes a little bit more

00:07:43.476 --> 00:07:45.776 A:middle
sense if we look at it as the

00:07:45.966 --> 00:07:47.526 A:middle
user actually interacts with the

00:07:47.526 --> 00:07:47.786 A:middle
map.

00:07:47.846 --> 00:07:50.466 A:middle
The zero point, the zero points

00:07:50.966 --> 00:07:53.446 A:middle
are fixed but as the user starts

00:07:53.446 --> 00:07:55.806 A:middle
zooming and this animates, the

00:07:55.806 --> 00:07:57.856 A:middle
upper edge is moving.

00:07:58.536 --> 00:08:00.946 A:middle
And if that upper edge is the

00:08:00.946 --> 00:08:03.636 A:middle
closer edge to the screen, it

00:08:03.636 --> 00:08:05.476 A:middle
looks kind of silly as the zero

00:08:05.476 --> 00:08:06.746 A:middle
point in the middle of the

00:08:06.746 --> 00:08:08.376 A:middle
screen is fixed but the other

00:08:08.376 --> 00:08:09.166 A:middle
one is moving.

00:08:09.436 --> 00:08:13.096 A:middle
So, you need to change it if you

00:08:13.166 --> 00:08:14.986 A:middle
align the scale view to another

00:08:14.986 --> 00:08:15.466 A:middle
page.

00:08:17.396 --> 00:08:20.896 A:middle
In using this simple APIs, the

00:08:21.806 --> 00:08:25.056 A:middle
muted standard map and exposed

00:08:25.216 --> 00:08:27.776 A:middle
map controls, we can take this

00:08:28.326 --> 00:08:29.846 A:middle
fictional bike sharing

00:08:29.846 --> 00:08:32.186 A:middle
application that we look at

00:08:32.186 --> 00:08:32.566 A:middle
today.

00:08:33.116 --> 00:08:35.416 A:middle
It is an application that allows

00:08:35.416 --> 00:08:38.026 A:middle
us to share unicycles and

00:08:38.026 --> 00:08:39.766 A:middle
tricycles in the San Francisco

00:08:39.766 --> 00:08:40.166 A:middle
area.

00:08:40.976 --> 00:08:42.536 A:middle
We can take this application

00:08:42.906 --> 00:08:46.256 A:middle
that is a little bit dated and

00:08:46.256 --> 00:08:48.556 A:middle
making it slightly more modern.

00:08:49.566 --> 00:08:52.466 A:middle
Now, let's look at that one more

00:08:52.466 --> 00:08:52.766 A:middle
time.

00:08:53.176 --> 00:08:55.426 A:middle
It was a little bit small of a

00:08:55.426 --> 00:08:56.086 A:middle
difference maybe.

00:08:56.086 --> 00:08:58.396 A:middle
We can take the slightly dated

00:08:58.396 --> 00:09:01.146 A:middle
application and bring it to the

00:09:01.146 --> 00:09:01.546 A:middle
future.

00:09:03.146 --> 00:09:04.756 A:middle
As we see here, the big

00:09:04.756 --> 00:09:06.536 A:middle
difference might not necessarily

00:09:06.536 --> 00:09:08.746 A:middle
have been the map mode and the

00:09:08.746 --> 00:09:09.506 A:middle
controls.

00:09:09.716 --> 00:09:12.816 A:middle
The important part on your maps

00:09:12.936 --> 00:09:15.166 A:middle
in your application is your

00:09:15.336 --> 00:09:17.366 A:middle
data, your annotations,

00:09:17.436 --> 00:09:19.916 A:middle
overlays, etc. And this is what

00:09:19.916 --> 00:09:21.786 A:middle
we are going to focus on next.

00:09:23.136 --> 00:09:24.806 A:middle
The standard way to display our

00:09:24.806 --> 00:09:26.786 A:middle
annotations has been the pin

00:09:26.786 --> 00:09:29.136 A:middle
annotation view since I was two

00:09:29.136 --> 00:09:29.556 A:middle
days.

00:09:30.206 --> 00:09:32.146 A:middle
The pin annotation view comes in

00:09:32.266 --> 00:09:33.656 A:middle
two different states.

00:09:34.016 --> 00:09:35.746 A:middle
We have the normal state when we

00:09:35.836 --> 00:09:37.716 A:middle
show it on a map and it's a pin.

00:09:38.276 --> 00:09:40.366 A:middle
And the user can tap on it or we

00:09:40.366 --> 00:09:42.386 A:middle
can programmatically select it

00:09:42.466 --> 00:09:43.816 A:middle
and it becomes the selected

00:09:43.816 --> 00:09:46.066 A:middle
state with a callout and show

00:09:46.066 --> 00:09:47.726 A:middle
the title and subtitle.

00:09:48.936 --> 00:09:50.656 A:middle
There is a little drawback here

00:09:50.656 --> 00:09:53.236 A:middle
and that is we only display the

00:09:53.316 --> 00:09:56.646 A:middle
title and subtitle if the pin is

00:09:56.646 --> 00:09:57.286 A:middle
selected.

00:09:57.946 --> 00:10:01.476 A:middle
So, as a user, you have to tap

00:10:01.476 --> 00:10:02.756 A:middle
on everything to see what they

00:10:02.756 --> 00:10:04.856 A:middle
actually are, which is a little

00:10:04.856 --> 00:10:05.736 A:middle
bit cumbersome.

00:10:06.086 --> 00:10:08.496 A:middle
So, as you saw in Maps app from

00:10:08.566 --> 00:10:12.536 A:middle
iOS 10, we use something that

00:10:12.536 --> 00:10:14.006 A:middle
looks a little bit like this

00:10:14.006 --> 00:10:14.526 A:middle
instead.

00:10:15.016 --> 00:10:17.356 A:middle
And with iOS 11, it's available

00:10:17.356 --> 00:10:18.136 A:middle
also to you.

00:10:18.356 --> 00:10:18.806 A:middle
We call it the

00:10:18.806 --> 00:10:20.046 A:middle
MarkerAnnotationView.

00:10:21.046 --> 00:10:23.686 A:middle
It is a AnnotationView subclass,

00:10:23.806 --> 00:10:25.556 A:middle
so it's a sibling to the pin

00:10:25.556 --> 00:10:26.346 A:middle
annotation view.

00:10:27.176 --> 00:10:28.626 A:middle
And we think you're going to

00:10:28.626 --> 00:10:30.726 A:middle
like it so much that it's the

00:10:30.726 --> 00:10:33.536 A:middle
new default for iOS and tvOS.

00:10:34.146 --> 00:10:36.046 A:middle
So, if you don't implement the

00:10:36.046 --> 00:10:37.576 A:middle
delegate callbacks for creating

00:10:37.576 --> 00:10:40.216 A:middle
them yourself, we will give you

00:10:40.216 --> 00:10:41.886 A:middle
a MarkerAnnotationView as

00:10:41.886 --> 00:10:44.036 A:middle
default if you recompile against

00:10:44.466 --> 00:10:45.266 A:middle
iOS 11.

00:10:46.596 --> 00:10:49.006 A:middle
The MarkerAnnotationView also

00:10:49.096 --> 00:10:50.546 A:middle
have two states.

00:10:50.766 --> 00:10:52.886 A:middle
We have the normal state which

00:10:52.886 --> 00:10:55.166 A:middle
will try to display the title as

00:10:55.166 --> 00:10:58.246 A:middle
well below the marker if there

00:10:58.246 --> 00:10:59.076 A:middle
is room on the map.

00:10:59.726 --> 00:11:01.496 A:middle
We have the selected state.

00:11:01.736 --> 00:11:02.816 A:middle
And in the selected state, we

00:11:02.816 --> 00:11:05.766 A:middle
also show the subtitle if there

00:11:05.766 --> 00:11:06.556 A:middle
is room for it.

00:11:07.026 --> 00:11:09.986 A:middle
And that way the user will at

00:11:09.986 --> 00:11:11.596 A:middle
the glance at the map, see what

00:11:11.596 --> 00:11:13.746 A:middle
are all of these data points

00:11:14.006 --> 00:11:15.576 A:middle
without having to tap on them

00:11:15.776 --> 00:11:16.866 A:middle
one at a time.

00:11:17.626 --> 00:11:21.636 A:middle
Now, there is one more thing.

00:11:21.636 --> 00:11:23.066 A:middle
We have to go back to the pin

00:11:23.416 --> 00:11:25.106 A:middle
one more time.

00:11:25.646 --> 00:11:27.586 A:middle
If we look at this pin and the

00:11:27.586 --> 00:11:30.226 A:middle
callout, there is one small

00:11:30.226 --> 00:11:32.306 A:middle
little thing in the callout.

00:11:32.716 --> 00:11:34.706 A:middle
You can add accessory views to

00:11:34.706 --> 00:11:34.976 A:middle
them.

00:11:35.196 --> 00:11:36.736 A:middle
You can add detail views to

00:11:36.736 --> 00:11:36.936 A:middle
them.

00:11:36.936 --> 00:11:37.926 A:middle
You can configure them.

00:11:38.736 --> 00:11:41.596 A:middle
And MarkerAnnotationView is an

00:11:41.596 --> 00:11:42.386 A:middle
annotation view.

00:11:42.386 --> 00:11:44.996 A:middle
So, all the API from annotation

00:11:44.996 --> 00:11:47.006 A:middle
views are supported for

00:11:47.006 --> 00:11:48.926 A:middle
MarkerAnnotationViews as well.

00:11:49.706 --> 00:11:53.566 A:middle
And if you add a in this case a

00:11:53.566 --> 00:11:55.366 A:middle
right accessory view to the

00:11:55.366 --> 00:11:58.216 A:middle
callout, then there is no

00:11:58.216 --> 00:12:01.306 A:middle
natural location within the big

00:12:01.306 --> 00:12:03.266 A:middle
marker where you can display

00:12:03.266 --> 00:12:03.866 A:middle
that data.

00:12:04.256 --> 00:12:06.116 A:middle
And it's even more obvious if we

00:12:06.116 --> 00:12:07.566 A:middle
think about the detail view

00:12:07.806 --> 00:12:10.726 A:middle
where you can put endless amount

00:12:10.726 --> 00:12:12.906 A:middle
of data, a lot of data, a full

00:12:13.076 --> 00:12:15.446 A:middle
placecard of your item if you

00:12:15.446 --> 00:12:15.796 A:middle
want.

00:12:16.216 --> 00:12:18.806 A:middle
So, what do we do in that case?

00:12:19.806 --> 00:12:23.456 A:middle
We have to use a third state of

00:12:23.456 --> 00:12:24.926 A:middle
the MarkerAnnotationView.

00:12:25.426 --> 00:12:27.166 A:middle
So, in practice, your

00:12:27.166 --> 00:12:28.966 A:middle
MarkerAnnotationViews have three

00:12:28.966 --> 00:12:29.526 A:middle
states.

00:12:29.996 --> 00:12:31.886 A:middle
We have the normal state when

00:12:31.886 --> 00:12:32.786 A:middle
it's unselected.

00:12:33.276 --> 00:12:34.426 A:middle
We have the selected state.

00:12:34.866 --> 00:12:36.436 A:middle
And the selected with callout

00:12:36.436 --> 00:12:38.346 A:middle
state which we will use if you

00:12:38.346 --> 00:12:40.116 A:middle
configure the marker annotation

00:12:40.456 --> 00:12:42.356 A:middle
with views that cannot be

00:12:42.386 --> 00:12:44.506 A:middle
displayed in the marker alone.

00:12:45.736 --> 00:12:47.726 A:middle
And with that, let's look at the

00:12:47.726 --> 00:12:48.096 A:middle
code.

00:12:48.496 --> 00:12:49.716 A:middle
This is the

00:12:49.716 --> 00:12:51.446 A:middle
MarkerAnnotationView.

00:12:52.786 --> 00:12:54.886 A:middle
The MarkerAnnotationView first

00:12:54.886 --> 00:12:56.936 A:middle
and foremost you have the titles

00:12:57.316 --> 00:12:59.066 A:middle
and you can configure the titles

00:12:59.066 --> 00:13:00.786 A:middle
that are displayed below it.

00:13:01.206 --> 00:13:02.976 A:middle
And notice that we yet again see

00:13:02.976 --> 00:13:04.756 A:middle
this three-state enumeration,

00:13:04.846 --> 00:13:06.346 A:middle
the feature visibility.

00:13:06.986 --> 00:13:10.736 A:middle
Because you can configure it in

00:13:10.736 --> 00:13:12.216 A:middle
many different ways, not only

00:13:12.216 --> 00:13:13.286 A:middle
visible and hidden.

00:13:13.666 --> 00:13:14.946 A:middle
The hidden obvious.

00:13:14.946 --> 00:13:16.146 A:middle
We don't show it.

00:13:16.826 --> 00:13:19.386 A:middle
The visible is also obvious.

00:13:19.436 --> 00:13:21.256 A:middle
We will always try to display

00:13:21.576 --> 00:13:23.126 A:middle
the title and the subtitle if

00:13:23.126 --> 00:13:24.156 A:middle
you configure them to be

00:13:24.156 --> 00:13:24.646 A:middle
visible.

00:13:25.256 --> 00:13:27.376 A:middle
Do note, I say we will try.

00:13:28.526 --> 00:13:31.446 A:middle
If the map is dense with data,

00:13:31.866 --> 00:13:35.166 A:middle
we will opt to hide the titles

00:13:35.686 --> 00:13:37.726 A:middle
to unclutter the map and display

00:13:37.726 --> 00:13:39.366 A:middle
more information as needed.

00:13:39.456 --> 00:13:41.366 A:middle
So, we will display them most of

00:13:41.366 --> 00:13:43.396 A:middle
the time but they can be hidden.

00:13:43.956 --> 00:13:46.686 A:middle
And in the last visibility we

00:13:46.686 --> 00:13:48.226 A:middle
have is the adaptive mode.

00:13:48.556 --> 00:13:49.976 A:middle
The adaptive mode is also the

00:13:49.976 --> 00:13:52.716 A:middle
default mode which gives you

00:13:53.906 --> 00:13:56.376 A:middle
that for free option for the

00:13:56.376 --> 00:13:58.786 A:middle
subtitle, especially where we

00:13:58.786 --> 00:14:01.206 A:middle
will hide it when it's in normal

00:14:01.206 --> 00:14:03.476 A:middle
state and display it when you're

00:14:03.476 --> 00:14:04.516 A:middle
in selected state.

00:14:05.986 --> 00:14:08.216 A:middle
So, that is the title below the

00:14:08.216 --> 00:14:08.786 A:middle
marker.

00:14:09.006 --> 00:14:10.226 A:middle
Next up we have the markers

00:14:10.226 --> 00:14:11.846 A:middle
themselves that you can also

00:14:11.846 --> 00:14:12.476 A:middle
configure.

00:14:13.416 --> 00:14:14.696 A:middle
First with the color.

00:14:15.116 --> 00:14:16.656 A:middle
So, there's the marker tint

00:14:16.656 --> 00:14:18.616 A:middle
color and the glyph tint color.

00:14:19.126 --> 00:14:22.816 A:middle
The marker color is the color of

00:14:22.816 --> 00:14:24.086 A:middle
the marker itself.

00:14:24.556 --> 00:14:26.536 A:middle
It is a normal UI color.

00:14:26.986 --> 00:14:28.806 A:middle
The default value is a nil value

00:14:28.806 --> 00:14:30.216 A:middle
which will pick a system

00:14:30.216 --> 00:14:32.766 A:middle
default, which is currently a

00:14:33.056 --> 00:14:34.136 A:middle
slightly reddish color.

00:14:34.686 --> 00:14:35.836 A:middle
You can set it to any other

00:14:35.836 --> 00:14:37.866 A:middle
color you want, for example why

00:14:37.866 --> 00:14:38.606 A:middle
not orange.

00:14:39.196 --> 00:14:41.126 A:middle
Do note that we call it marker

00:14:41.476 --> 00:14:43.576 A:middle
tint color, not just color.

00:14:43.906 --> 00:14:45.906 A:middle
And that is because the color

00:14:45.906 --> 00:14:47.956 A:middle
you provide might not be the

00:14:47.956 --> 00:14:50.666 A:middle
color, the exact color that we

00:14:50.816 --> 00:14:51.696 A:middle
use in the end.

00:14:51.696 --> 00:14:54.056 A:middle
We may apply some visual effects

00:14:54.366 --> 00:14:55.876 A:middle
on the color to make it look

00:14:55.876 --> 00:14:56.426 A:middle
nicer.

00:14:56.816 --> 00:14:59.896 A:middle
So, it's a tint that you're

00:14:59.896 --> 00:15:00.376 A:middle
applying.

00:15:00.746 --> 00:15:02.386 A:middle
And you can even use the new in

00:15:02.476 --> 00:15:05.666 A:middle
iOS asset catalog name colors of

00:15:05.666 --> 00:15:06.126 A:middle
course.

00:15:06.566 --> 00:15:09.666 A:middle
And the same thing for the glyph

00:15:10.086 --> 00:15:12.206 A:middle
tint color which is instead the

00:15:12.246 --> 00:15:15.066 A:middle
color of the glyph within the

00:15:15.066 --> 00:15:18.316 A:middle
marker which is defaulting to

00:15:18.316 --> 00:15:19.986 A:middle
white pin in this case.

00:15:22.876 --> 00:15:25.156 A:middle
Speaking of the glyph.

00:15:25.336 --> 00:15:27.116 A:middle
You want to configure also what

00:15:27.116 --> 00:15:29.266 A:middle
is inside of the marker, the

00:15:29.266 --> 00:15:30.586 A:middle
little glyph in it.

00:15:30.936 --> 00:15:32.886 A:middle
And the easiest way to do it is

00:15:33.366 --> 00:15:35.276 A:middle
by using the glyph text

00:15:35.406 --> 00:15:35.856 A:middle
property.

00:15:36.586 --> 00:15:37.686 A:middle
It's a simple string.

00:15:38.486 --> 00:15:39.656 A:middle
We see a pattern here.

00:15:39.656 --> 00:15:40.906 A:middle
It defaults to nil.

00:15:41.466 --> 00:15:42.956 A:middle
And when it defaults to nil, we

00:15:42.956 --> 00:15:44.956 A:middle
pick a system default which is a

00:15:44.956 --> 00:15:45.406 A:middle
pin.

00:15:46.366 --> 00:15:47.606 A:middle
It's a pin in a balloon.

00:15:47.606 --> 00:15:48.886 A:middle
It might be dangerous, but it

00:15:48.886 --> 00:15:49.366 A:middle
works.

00:15:50.236 --> 00:15:52.376 A:middle
And you can set it to any text

00:15:52.376 --> 00:15:52.796 A:middle
you want.

00:15:52.796 --> 00:15:54.706 A:middle
You might want to grade your

00:15:54.706 --> 00:15:55.546 A:middle
annotations.

00:15:55.906 --> 00:15:58.116 A:middle
You can even use the characters

00:15:58.116 --> 00:15:59.996 A:middle
or the Unicode standard to get

00:15:59.996 --> 00:16:01.526 A:middle
vector graphics for free.

00:16:02.496 --> 00:16:05.296 A:middle
Now, glyph text is a string.

00:16:05.296 --> 00:16:07.466 A:middle
So, you can set it to any text

00:16:07.466 --> 00:16:07.906 A:middle
you want.

00:16:07.906 --> 00:16:09.386 A:middle
If you want, you can put the old

00:16:09.926 --> 00:16:12.766 A:middle
iliad into it and we will try to

00:16:12.766 --> 00:16:13.306 A:middle
render it.

00:16:13.716 --> 00:16:16.236 A:middle
But it will look silly.

00:16:16.426 --> 00:16:18.066 A:middle
We will try to shrink down the

00:16:18.066 --> 00:16:21.206 A:middle
text as much as possible but the

00:16:21.206 --> 00:16:23.136 A:middle
user will not really be able to

00:16:23.136 --> 00:16:24.576 A:middle
read what is on screen.

00:16:24.816 --> 00:16:26.916 A:middle
So, as a rule of thumb, please

00:16:26.976 --> 00:16:29.436 A:middle
try to limit yourself to around

00:16:29.966 --> 00:16:31.376 A:middle
two to three characters.

00:16:32.676 --> 00:16:36.026 A:middle
And not everything though his

00:16:36.026 --> 00:16:39.186 A:middle
representable by characters or

00:16:39.256 --> 00:16:39.786 A:middle
text.

00:16:39.996 --> 00:16:41.816 A:middle
Not even with the full Unicode

00:16:41.816 --> 00:16:43.736 A:middle
standard being expanded every

00:16:43.736 --> 00:16:44.106 A:middle
year.

00:16:44.346 --> 00:16:46.256 A:middle
So, you might want to use your

00:16:46.256 --> 00:16:47.946 A:middle
own image graphics.

00:16:48.126 --> 00:16:49.896 A:middle
And for that we have glyph image

00:16:50.206 --> 00:16:51.606 A:middle
and the selected glyph image

00:16:51.706 --> 00:16:52.296 A:middle
properties.

00:16:53.096 --> 00:16:55.976 A:middle
The glyph image property is the

00:16:55.976 --> 00:16:58.146 A:middle
only property that you probably

00:16:58.146 --> 00:17:00.006 A:middle
will want to use most of the

00:17:00.006 --> 00:17:00.426 A:middle
time.

00:17:00.766 --> 00:17:03.576 A:middle
And you just give it an image

00:17:03.856 --> 00:17:05.736 A:middle
that is 40 x 40 points.

00:17:06.266 --> 00:17:08.766 A:middle
And when, which is used in the

00:17:08.766 --> 00:17:09.546 A:middle
selected state.

00:17:10.196 --> 00:17:11.956 A:middle
And then for the normal state,

00:17:11.956 --> 00:17:13.766 A:middle
we will shrink it down to 20 x

00:17:13.766 --> 00:17:14.156 A:middle
20.

00:17:15.016 --> 00:17:16.546 A:middle
Which works most of the time,

00:17:16.926 --> 00:17:18.916 A:middle
unless the graphics you have is

00:17:18.916 --> 00:17:21.156 A:middle
quite detailed, since then you

00:17:21.416 --> 00:17:23.396 A:middle
can get graphical scaling

00:17:23.396 --> 00:17:25.266 A:middle
artifacts as we scale it down.

00:17:25.536 --> 00:17:27.776 A:middle
And if that is the case, you

00:17:27.776 --> 00:17:29.096 A:middle
need to use both of the

00:17:29.096 --> 00:17:29.716 A:middle
properties.

00:17:29.896 --> 00:17:31.906 A:middle
So, for the small glyph image,

00:17:31.906 --> 00:17:33.406 A:middle
you can provide the smaller 20 x

00:17:33.406 --> 00:17:33.826 A:middle
20.

00:17:34.386 --> 00:17:35.876 A:middle
And for the larger one you give

00:17:35.876 --> 00:17:38.086 A:middle
it the bigger 40 x 40.

00:17:38.426 --> 00:17:39.836 A:middle
We will cross fade between the

00:17:39.836 --> 00:17:42.016 A:middle
two and you get that crispiness,

00:17:42.266 --> 00:17:44.416 A:middle
both in the normal and selective

00:17:45.616 --> 00:17:45.776 A:middle
states.

00:17:45.946 --> 00:17:49.606 A:middle
And using that, we can get this

00:17:49.736 --> 00:17:51.676 A:middle
much, much more modern-looking

00:17:51.676 --> 00:17:52.456 A:middle
application.

00:17:53.056 --> 00:17:55.846 A:middle
Now, this application though is,

00:17:56.626 --> 00:17:58.206 A:middle
if I have to say so, a little

00:17:58.206 --> 00:17:58.886 A:middle
bit cluttered.

00:17:59.386 --> 00:18:00.766 A:middle
You might want to clean it up

00:18:00.766 --> 00:18:02.846 A:middle
and have it easier to look at

00:18:02.846 --> 00:18:04.696 A:middle
and find what you actually want.

00:18:05.016 --> 00:18:06.216 A:middle
You want it to look a little bit

00:18:06.216 --> 00:18:07.166 A:middle
more like this.

00:18:07.546 --> 00:18:10.416 A:middle
And there is one single property

00:18:11.276 --> 00:18:13.076 A:middle
that we add in iOS 11 to do

00:18:13.076 --> 00:18:13.346 A:middle
this.

00:18:13.656 --> 00:18:15.786 A:middle
We call it the display priority

00:18:16.526 --> 00:18:19.566 A:middle
where we can tell annotation

00:18:19.566 --> 00:18:22.776 A:middle
views what priority are you in

00:18:22.776 --> 00:18:24.166 A:middle
order to display on the screen.

00:18:24.866 --> 00:18:27.136 A:middle
The feature display priority is

00:18:27.666 --> 00:18:29.296 A:middle
modeled after the layout

00:18:29.526 --> 00:18:31.886 A:middle
constraint priorities from UIKit

00:18:32.176 --> 00:18:32.796 A:middle
and MapKit.

00:18:33.866 --> 00:18:35.286 A:middle
Which means it's a floating

00:18:35.286 --> 00:18:37.886 A:middle
point range between a 0 and 1000

00:18:38.356 --> 00:18:39.996 A:middle
where 1000 is the required

00:18:39.996 --> 00:18:40.506 A:middle
value.

00:18:40.826 --> 00:18:42.856 A:middle
And if we look at what they do,

00:18:43.556 --> 00:18:45.496 A:middle
required means opt out.

00:18:46.006 --> 00:18:48.306 A:middle
Do not occlude or hide anything

00:18:48.306 --> 00:18:50.166 A:middle
as the annotation views overlap.

00:18:50.526 --> 00:18:51.236 A:middle
Do nothing.

00:18:51.596 --> 00:18:52.876 A:middle
But if you set the display

00:18:52.876 --> 00:18:54.546 A:middle
priority property to anything

00:18:54.546 --> 00:18:56.136 A:middle
else, like the provider

00:18:56.136 --> 00:18:56.886 A:middle
defaults.

00:18:57.226 --> 00:19:00.826 A:middle
Default high which is 750 and

00:19:00.826 --> 00:19:03.436 A:middle
default low 250, yes, that's the

00:19:03.436 --> 00:19:04.376 A:middle
layout constraints.

00:19:05.196 --> 00:19:07.876 A:middle
Then, you get these annotations

00:19:08.206 --> 00:19:08.576 A:middle
hiding.

00:19:09.136 --> 00:19:14.106 A:middle
And you can get from the, oops.

00:19:14.986 --> 00:19:16.256 A:middle
That is not what I meant.

00:19:16.756 --> 00:19:18.646 A:middle
So, being a floating point value

00:19:18.976 --> 00:19:21.146 A:middle
from 0 to 1000 means that you

00:19:21.146 --> 00:19:23.436 A:middle
can use it for nice things.

00:19:24.456 --> 00:19:26.356 A:middle
If you for example map your

00:19:26.356 --> 00:19:27.866 A:middle
display priority to the

00:19:27.966 --> 00:19:29.716 A:middle
popularity of your items.

00:19:29.716 --> 00:19:31.916 A:middle
So, you have a high, a very

00:19:31.916 --> 00:19:33.496 A:middle
popular item get the high

00:19:33.496 --> 00:19:35.616 A:middle
display priority and a less

00:19:35.616 --> 00:19:37.806 A:middle
popular item get a lower display

00:19:37.806 --> 00:19:39.666 A:middle
priority, that would mean as the

00:19:39.666 --> 00:19:41.236 A:middle
user is zoomed out on a high

00:19:41.236 --> 00:19:42.456 A:middle
level and looking at the whole

00:19:42.456 --> 00:19:44.996 A:middle
city, the most popular items are

00:19:44.996 --> 00:19:46.686 A:middle
the one that is remaining on

00:19:46.686 --> 00:19:47.636 A:middle
screen and visible.

00:19:48.016 --> 00:19:50.606 A:middle
And as the user zooms in, you

00:19:50.606 --> 00:19:52.516 A:middle
see also all the other data.

00:19:53.166 --> 00:19:55.426 A:middle
Which allows you to go from this

00:19:55.866 --> 00:19:58.076 A:middle
very cluttered map to something

00:19:58.076 --> 00:19:59.346 A:middle
that is a lot cleaner.

00:20:00.696 --> 00:20:03.006 A:middle
Now, if you do the popularity

00:20:03.006 --> 00:20:04.966 A:middle
thing and hide all the data,

00:20:04.966 --> 00:20:07.766 A:middle
then yes all the data is hidden.

00:20:07.986 --> 00:20:09.736 A:middle
So, the user will have to zoom

00:20:09.736 --> 00:20:11.436 A:middle
in a bit to actually find it and

00:20:11.436 --> 00:20:13.956 A:middle
then zoom out again to see the

00:20:13.956 --> 00:20:14.536 A:middle
rest of it.

00:20:14.956 --> 00:20:17.756 A:middle
And there is a better way to do

00:20:17.756 --> 00:20:17.896 A:middle
it.

00:20:17.896 --> 00:20:20.736 A:middle
What we could do is just cluster

00:20:20.826 --> 00:20:23.906 A:middle
the annotations and say that

00:20:23.906 --> 00:20:25.946 A:middle
yes, here we have 11 more and

00:20:25.946 --> 00:20:27.036 A:middle
here is 8 more.

00:20:27.276 --> 00:20:28.576 A:middle
You don't have to zoom in.

00:20:28.836 --> 00:20:29.556 A:middle
Well show you.

00:20:30.286 --> 00:20:32.986 A:middle
And the API for this is just as

00:20:32.986 --> 00:20:35.846 A:middle
simple as the API for display

00:20:35.846 --> 00:20:36.346 A:middle
priority.

00:20:36.636 --> 00:20:38.046 A:middle
We call it a clustering

00:20:38.046 --> 00:20:38.986 A:middle
identifier.

00:20:39.556 --> 00:20:41.296 A:middle
It is a string, so you can set

00:20:41.296 --> 00:20:42.316 A:middle
it to anything you want.

00:20:42.936 --> 00:20:44.896 A:middle
It is modeled after the reuse

00:20:44.976 --> 00:20:45.726 A:middle
identifier.

00:20:45.726 --> 00:20:47.626 A:middle
Both annotations views, your

00:20:47.626 --> 00:20:49.396 A:middle
table view cells and collection

00:20:49.396 --> 00:20:49.996 A:middle
view cells.

00:20:50.396 --> 00:20:52.256 A:middle
So, that you can have groups.

00:20:52.756 --> 00:20:54.766 A:middle
In the case of our application,

00:20:55.066 --> 00:20:57.246 A:middle
the bike sharing application, it

00:20:57.276 --> 00:20:59.286 A:middle
might be that we want to cluster

00:20:59.476 --> 00:21:02.836 A:middle
unicycles with unicycles and

00:21:02.836 --> 00:21:05.036 A:middle
tricycles with tricycles, but we

00:21:05.036 --> 00:21:06.356 A:middle
don't want to mix them together.

00:21:06.786 --> 00:21:09.176 A:middle
And if you can achieve that but

00:21:09.176 --> 00:21:11.186 A:middle
give them those annotation views

00:21:11.396 --> 00:21:12.946 A:middle
different but distinct

00:21:13.196 --> 00:21:14.716 A:middle
clustering identifiers.

00:21:15.276 --> 00:21:17.476 A:middle
So, as you use it, the default

00:21:17.476 --> 00:21:18.006 A:middle
tis nil.

00:21:18.646 --> 00:21:20.236 A:middle
If you set it to nil, you opt

00:21:20.236 --> 00:21:21.456 A:middle
out and nothing happens.

00:21:22.206 --> 00:21:23.386 A:middle
And if you set it to any other

00:21:23.386 --> 00:21:26.196 A:middle
string, all annotations sharing

00:21:26.196 --> 00:21:27.916 A:middle
the same annotation view are

00:21:27.916 --> 00:21:29.716 A:middle
illegible for being clustered

00:21:30.066 --> 00:21:34.286 A:middle
into a group as they overlap.

00:21:34.286 --> 00:21:36.866 A:middle
This is a very powerful and

00:21:36.866 --> 00:21:38.816 A:middle
beautiful feature but a little

00:21:38.816 --> 00:21:40.376 A:middle
bit hard to explain.

00:21:40.536 --> 00:21:43.036 A:middle
So, let me switch over to the

00:21:43.036 --> 00:21:45.466 A:middle
demo machine and show it to you

00:21:45.466 --> 00:21:45.796 A:middle
instead.

00:21:48.456 --> 00:21:49.856 A:middle
There is the demo machine.

00:21:50.956 --> 00:21:53.726 A:middle
So, in this little sample app, I

00:21:53.726 --> 00:21:55.246 A:middle
have four annotations.

00:21:55.996 --> 00:21:58.236 A:middle
I have a unicycle and a second

00:21:58.236 --> 00:21:59.876 A:middle
unicycle that share one

00:22:00.196 --> 00:22:01.716 A:middle
clustering identifier.

00:22:02.306 --> 00:22:04.496 A:middle
And I have another tricycle and

00:22:04.496 --> 00:22:06.196 A:middle
a tricycle sharing a second

00:22:06.196 --> 00:22:06.886 A:middle
identifier.

00:22:07.366 --> 00:22:09.166 A:middle
If I move them together, we'll

00:22:09.166 --> 00:22:09.946 A:middle
see their cluster.

00:22:11.136 --> 00:22:12.856 A:middle
And if I drag them apart, they

00:22:12.856 --> 00:22:13.816 A:middle
decluster again.

00:22:14.756 --> 00:22:17.386 A:middle
Now, all four of these have the

00:22:17.386 --> 00:22:19.166 A:middle
same display priority.

00:22:19.586 --> 00:22:20.736 A:middle
So, all four have the same

00:22:20.736 --> 00:22:21.636 A:middle
display priority.

00:22:22.666 --> 00:22:25.396 A:middle
When I group them together, the

00:22:25.396 --> 00:22:27.486 A:middle
cluster will get the display

00:22:27.486 --> 00:22:30.376 A:middle
priority of the highest display

00:22:30.376 --> 00:22:32.296 A:middle
priority within the group.

00:22:33.296 --> 00:22:35.526 A:middle
So, in practice, this means that

00:22:35.526 --> 00:22:37.096 A:middle
in this example, both of them

00:22:37.096 --> 00:22:38.576 A:middle
still have the same display

00:22:38.576 --> 00:22:39.136 A:middle
priority.

00:22:39.816 --> 00:22:40.836 A:middle
And when I move them even

00:22:40.836 --> 00:22:43.246 A:middle
further together, they collide

00:22:43.546 --> 00:22:44.596 A:middle
and they hide each other.

00:22:45.216 --> 00:22:46.456 A:middle
Move them out again and they

00:22:46.456 --> 00:22:47.276 A:middle
hide each other.

00:22:47.956 --> 00:22:50.116 A:middle
Now, if two annotation views

00:22:50.166 --> 00:22:52.056 A:middle
have the same display priority,

00:22:52.336 --> 00:22:53.776 A:middle
which one should we hide?

00:22:55.006 --> 00:22:57.476 A:middle
And there is logic to it.

00:22:58.066 --> 00:22:59.616 A:middle
If we rotate the map a little

00:22:59.616 --> 00:23:01.786 A:middle
bit and move them together, we

00:23:01.786 --> 00:23:03.356 A:middle
see we are still hiding the

00:23:03.356 --> 00:23:03.946 A:middle
green one.

00:23:04.936 --> 00:23:08.596 A:middle
If we rotate 180 degrees and

00:23:08.596 --> 00:23:10.866 A:middle
move them together, we notice

00:23:11.066 --> 00:23:12.466 A:middle
the orange one is the one

00:23:12.466 --> 00:23:13.056 A:middle
getting hidden.

00:23:13.686 --> 00:23:16.426 A:middle
So, the logic here is if they

00:23:16.426 --> 00:23:18.296 A:middle
have the same display priority,

00:23:18.376 --> 00:23:20.806 A:middle
we hide the one that is closest

00:23:20.806 --> 00:23:21.906 A:middle
to the top of the screen.

00:23:22.936 --> 00:23:25.696 A:middle
Which is good for developers and

00:23:25.696 --> 00:23:28.196 A:middle
users because you can see,

00:23:28.196 --> 00:23:29.626 A:middle
expect what is going to happen

00:23:29.626 --> 00:23:30.026 A:middle
next.

00:23:30.506 --> 00:23:32.816 A:middle
But one of the many reasons this

00:23:32.816 --> 00:23:34.546 A:middle
was done, I have to say if we

00:23:34.576 --> 00:23:37.196 A:middle
tilt the map into 3D mode, it

00:23:37.196 --> 00:23:39.196 A:middle
looks kind of cool as you rotate

00:23:39.196 --> 00:23:41.146 A:middle
in the annotation behind the

00:23:41.146 --> 00:23:41.766 A:middle
other one.

00:23:43.696 --> 00:23:47.866 A:middle
Now, let's zoom out a bit and

00:23:47.866 --> 00:23:49.796 A:middle
drop another annotation on the

00:23:49.796 --> 00:23:50.066 A:middle
map.

00:23:50.906 --> 00:23:52.486 A:middle
Being in annotation view, you

00:23:52.486 --> 00:23:54.736 A:middle
inherit all the APIs from

00:23:54.736 --> 00:23:57.046 A:middle
annotation view including

00:23:57.166 --> 00:23:57.676 A:middle
dragging.

00:23:57.726 --> 00:23:59.756 A:middle
So, I can pick it up and drop it

00:23:59.756 --> 00:24:00.246 A:middle
down again.

00:24:01.016 --> 00:24:03.436 A:middle
I can pick it up, drag it around

00:24:04.046 --> 00:24:06.326 A:middle
and drop it down again.

00:24:09.016 --> 00:24:10.236 A:middle
[ Applause ]

00:24:10.236 --> 00:24:11.356 A:middle
Did you notice something

00:24:11.356 --> 00:24:12.976 A:middle
happening there as I dropped it

00:24:12.976 --> 00:24:14.606 A:middle
down close to beach street?

00:24:15.426 --> 00:24:17.316 A:middle
So, look closely as I pick it up

00:24:17.966 --> 00:24:19.906 A:middle
and drop it down on Dollar

00:24:19.906 --> 00:24:22.046 A:middle
Rent-A-Car.

00:24:22.246 --> 00:24:23.106 A:middle
It gets hidden.

00:24:23.706 --> 00:24:25.626 A:middle
If you set the display priority

00:24:25.716 --> 00:24:27.756 A:middle
on annotation views, you will

00:24:27.756 --> 00:24:29.716 A:middle
also, we will also try to

00:24:29.716 --> 00:24:32.156 A:middle
collide out items and labels on

00:24:32.156 --> 00:24:34.126 A:middle
the base map for you to keep the

00:24:34.126 --> 00:24:36.296 A:middle
map even more uncluttered.

00:24:36.736 --> 00:24:39.056 A:middle
So, I can pick it up and why not

00:24:39.056 --> 00:24:40.956 A:middle
drag it down, drop it down on

00:24:40.956 --> 00:24:42.756 A:middle
another annotation and they

00:24:42.906 --> 00:24:45.096 A:middle
merge in one smooth animation.

00:24:45.746 --> 00:24:47.016 A:middle
All of these are actually

00:24:47.616 --> 00:24:48.126 A:middle
draggable.

00:24:48.706 --> 00:24:51.196 A:middle
So, I can pick them up and pick

00:24:51.396 --> 00:24:54.236 A:middle
them up, which is not true.

00:24:54.386 --> 00:24:58.746 A:middle
Because the cluster itself is

00:24:58.746 --> 00:24:59.666 A:middle
not draggable.

00:25:00.256 --> 00:25:02.506 A:middle
In order to be a draggable

00:25:02.506 --> 00:25:04.196 A:middle
annotation, you need to have a

00:25:04.256 --> 00:25:04.806 A:middle
coordinate.

00:25:05.886 --> 00:25:08.636 A:middle
And a cluster doesn't have a

00:25:08.636 --> 00:25:10.006 A:middle
coordinate on its own.

00:25:10.386 --> 00:25:12.706 A:middle
The geographical coordinate for

00:25:12.706 --> 00:25:14.716 A:middle
the cluster is the average of

00:25:14.716 --> 00:25:17.016 A:middle
all the member annotations that

00:25:17.016 --> 00:25:18.496 A:middle
is currently encompassing.

00:25:18.566 --> 00:25:20.086 A:middle
And that is why you can't drag

00:25:20.086 --> 00:25:20.216 A:middle
it.

00:25:20.816 --> 00:25:22.356 A:middle
But back to the slides.

00:25:23.216 --> 00:25:24.776 A:middle
It's a simple and powerful API

00:25:25.426 --> 00:25:27.116 A:middle
that allows you to go from this

00:25:28.006 --> 00:25:29.906 A:middle
cluttered mess to something a

00:25:29.906 --> 00:25:31.276 A:middle
little bit more clutter

00:25:31.826 --> 00:25:32.646 A:middle
cleanliness.

00:25:33.196 --> 00:25:37.166 A:middle
And this is good, since now we

00:25:37.166 --> 00:25:39.136 A:middle
see there are 11 annotations up

00:25:39.136 --> 00:25:41.086 A:middle
there and we have two more up

00:25:41.086 --> 00:25:41.626 A:middle
there.

00:25:41.626 --> 00:25:44.236 A:middle
And, but we don't really see

00:25:44.236 --> 00:25:46.216 A:middle
what kind of annotations are

00:25:46.216 --> 00:25:46.516 A:middle
there.

00:25:47.036 --> 00:25:48.556 A:middle
So, being unicycles and

00:25:48.556 --> 00:25:50.886 A:middle
tricycles, I really don't want

00:25:50.886 --> 00:25:52.416 A:middle
to go to a location where there

00:25:52.416 --> 00:25:53.756 A:middle
is only unicycles.

00:25:53.756 --> 00:25:55.526 A:middle
Because I haven't bothered to

00:25:55.526 --> 00:25:57.066 A:middle
learn to ride one yet so I want

00:25:57.066 --> 00:25:58.366 A:middle
to make sure I go to a place

00:25:58.866 --> 00:26:00.396 A:middle
with tricycles only.

00:26:00.846 --> 00:26:03.426 A:middle
So, we want to have the clusters

00:26:03.426 --> 00:26:06.026 A:middle
display at the glance what kind

00:26:06.026 --> 00:26:07.936 A:middle
of data do they contain at this

00:26:07.936 --> 00:26:08.566 A:middle
location.

00:26:08.906 --> 00:26:11.116 A:middle
And that we can do by doing our

00:26:11.116 --> 00:26:13.086 A:middle
own custom annotation views.

00:26:13.396 --> 00:26:14.616 A:middle
So, we can display it as a

00:26:14.616 --> 00:26:15.676 A:middle
little pie chart.

00:26:16.856 --> 00:26:19.136 A:middle
And I can see, yeah, there are

00:26:19.136 --> 00:26:21.526 A:middle
at least two tricycles there.

00:26:21.526 --> 00:26:22.736 A:middle
It's safe, I can go there.

00:26:23.276 --> 00:26:24.286 A:middle
How do we do this?

00:26:24.766 --> 00:26:26.606 A:middle
We have to go to our good old

00:26:26.606 --> 00:26:28.806 A:middle
friend the map view for

00:26:28.806 --> 00:26:30.576 A:middle
annotation delegate callback.

00:26:31.726 --> 00:26:33.336 A:middle
This delegate callbacks has

00:26:33.476 --> 00:26:36.196 A:middle
always provided a system

00:26:36.406 --> 00:26:37.406 A:middle
annotation for you.

00:26:37.476 --> 00:26:39.196 A:middle
The user location annotation

00:26:39.196 --> 00:26:41.016 A:middle
which is the representation of

00:26:41.016 --> 00:26:43.616 A:middle
where is the user currently in

00:26:43.616 --> 00:26:44.076 A:middle
the world.

00:26:44.796 --> 00:26:46.646 A:middle
And you can either return nil

00:26:46.646 --> 00:26:48.206 A:middle
value and you get the default

00:26:48.206 --> 00:26:48.696 A:middle
pack.

00:26:49.156 --> 00:26:50.836 A:middle
Or you could return your own

00:26:50.836 --> 00:26:52.526 A:middle
custom annotation and display

00:26:52.526 --> 00:26:53.836 A:middle
the user location in a

00:26:54.186 --> 00:26:55.456 A:middle
completely different way that

00:26:55.456 --> 00:26:56.816 A:middle
fits your application needs.

00:26:57.206 --> 00:27:00.696 A:middle
And for everything else you DQ

00:27:00.696 --> 00:27:02.776 A:middle
create your annotation view and

00:27:02.836 --> 00:27:03.926 A:middle
return it.

00:27:04.526 --> 00:27:06.456 A:middle
If you return nil, you get the

00:27:06.456 --> 00:27:09.466 A:middle
system default which, in iOS 11,

00:27:09.656 --> 00:27:11.116 A:middle
is the MarkerAnnotationView.

00:27:11.826 --> 00:27:15.826 A:middle
Now, in iOS 11, you will also

00:27:15.826 --> 00:27:18.676 A:middle
get one more different kind of

00:27:18.876 --> 00:27:21.416 A:middle
annotation, system annotation in

00:27:21.416 --> 00:27:22.246 A:middle
your callbacks.

00:27:22.606 --> 00:27:23.656 A:middle
You might get this

00:27:23.846 --> 00:27:25.076 A:middle
ClusterAnnotation.

00:27:25.496 --> 00:27:27.366 A:middle
So, if you opt into clustering

00:27:28.086 --> 00:27:30.406 A:middle
and they collide, there is not a

00:27:30.406 --> 00:27:31.616 A:middle
new delegate callback.

00:27:31.616 --> 00:27:33.636 A:middle
We reuse the existing callback,

00:27:33.966 --> 00:27:36.006 A:middle
give you a ClusterAnnotation

00:27:36.086 --> 00:27:37.906 A:middle
that represents the cluster, and

00:27:37.906 --> 00:27:38.916 A:middle
you can return the

00:27:38.916 --> 00:27:40.776 A:middle
AnnotationView that you want.

00:27:41.116 --> 00:27:43.336 A:middle
The ClusterAnnotation is a

00:27:43.336 --> 00:27:45.836 A:middle
simple concrete class of the

00:27:45.836 --> 00:27:47.416 A:middle
annotation protocol.

00:27:48.076 --> 00:27:49.746 A:middle
It provides you an array of all

00:27:49.746 --> 00:27:51.056 A:middle
the member annotations.

00:27:51.606 --> 00:27:53.426 A:middle
It's a flat array, so we

00:27:53.426 --> 00:27:54.986 A:middle
guarantee that there will be no

00:27:54.986 --> 00:27:56.636 A:middle
clusters within clusters within

00:27:56.636 --> 00:27:57.096 A:middle
clusters.

00:27:57.096 --> 00:27:58.626 A:middle
It's a flat array of all the

00:27:58.626 --> 00:28:00.546 A:middle
annotations that is currently

00:28:00.546 --> 00:28:02.066 A:middle
representing and only those.

00:28:02.586 --> 00:28:04.536 A:middle
We order it so the one with the

00:28:04.666 --> 00:28:06.686 A:middle
highest display priority is

00:28:06.686 --> 00:28:07.136 A:middle
first.

00:28:08.146 --> 00:28:09.806 A:middle
So, if you, as I said

00:28:09.806 --> 00:28:11.666 A:middle
previously, using display

00:28:11.666 --> 00:28:12.846 A:middle
priority and mapping it with

00:28:12.876 --> 00:28:14.186 A:middle
popularity, you will get the

00:28:14.186 --> 00:28:16.916 A:middle
most popular one at the start.

00:28:17.556 --> 00:28:19.216 A:middle
The MarkerAnnotationView placed

00:28:19.216 --> 00:28:21.876 A:middle
well with the ClusterAnnotation.

00:28:22.076 --> 00:28:24.046 A:middle
So, we will display the count

00:28:24.046 --> 00:28:26.266 A:middle
there as the glyph.

00:28:26.446 --> 00:28:27.676 A:middle
So, you can see at a glance how

00:28:27.676 --> 00:28:28.356 A:middle
many there are.

00:28:29.056 --> 00:28:31.466 A:middle
We will also, for the title and

00:28:31.466 --> 00:28:34.016 A:middle
subtitle, provide good default.

00:28:34.366 --> 00:28:36.726 A:middle
So, the title will be the title

00:28:36.726 --> 00:28:38.646 A:middle
of the most popular one or the

00:28:38.646 --> 00:28:40.256 A:middle
first member annotation.

00:28:40.686 --> 00:28:42.836 A:middle
And the subtitle is a localized

00:28:43.156 --> 00:28:45.276 A:middle
plus X number or more how many

00:28:45.276 --> 00:28:46.876 A:middle
annotations you want to have.

00:28:48.296 --> 00:28:49.406 A:middle
Both of these properties are

00:28:49.406 --> 00:28:51.046 A:middle
mutable, so you can change them

00:28:51.156 --> 00:28:52.786 A:middle
anytime you want and provide

00:28:52.786 --> 00:28:53.456 A:middle
something else.

00:28:53.936 --> 00:28:55.546 A:middle
We might want to change it and

00:28:55.546 --> 00:28:59.066 A:middle
have, say, three unicycles and

00:28:59.066 --> 00:29:00.686 A:middle
two tricycles and then you can

00:29:00.686 --> 00:29:02.796 A:middle
see at the subtitle what it is

00:29:03.036 --> 00:29:04.956 A:middle
without doing a custom

00:29:04.956 --> 00:29:05.706 A:middle
AnnotationView.

00:29:06.236 --> 00:29:08.746 A:middle
But you might want to do that

00:29:08.746 --> 00:29:09.756 A:middle
custom AnnotationView.

00:29:10.866 --> 00:29:13.376 A:middle
So, custom AnnotationViews.

00:29:14.686 --> 00:29:16.016 A:middle
Let's look at this little pie

00:29:16.016 --> 00:29:16.356 A:middle
chart.

00:29:16.816 --> 00:29:19.646 A:middle
A AnnotationVview is a view.

00:29:20.126 --> 00:29:21.906 A:middle
A view has a frame.

00:29:22.946 --> 00:29:25.646 A:middle
And the underlying thing that

00:29:25.716 --> 00:29:27.746 A:middle
drives both display priority to

00:29:27.746 --> 00:29:30.016 A:middle
hiding things and clustering is

00:29:30.016 --> 00:29:31.976 A:middle
that annotations must be able to

00:29:31.976 --> 00:29:33.716 A:middle
detect if they are overlapping.

00:29:34.956 --> 00:29:36.426 A:middle
And since we are views and we

00:29:36.426 --> 00:29:38.756 A:middle
have a frame, we can just use

00:29:38.756 --> 00:29:39.986 A:middle
that frame and detect a

00:29:39.986 --> 00:29:40.396 A:middle
collision.

00:29:41.856 --> 00:29:43.546 A:middle
Now this doesn't look good.

00:29:44.236 --> 00:29:46.216 A:middle
I mean, they're circles, yes.

00:29:46.216 --> 00:29:48.356 A:middle
The frames are colliding but

00:29:48.356 --> 00:29:50.316 A:middle
visually they are not really

00:29:50.316 --> 00:29:50.996 A:middle
colliding yet.

00:29:51.066 --> 00:29:52.926 A:middle
So, this is not quite what we

00:29:52.926 --> 00:29:53.316 A:middle
want.

00:29:53.686 --> 00:29:56.036 A:middle
So, we add one more property on

00:29:56.116 --> 00:29:56.836 A:middle
AnnotationView.

00:29:56.936 --> 00:29:58.056 A:middle
We call it collisionMode.

00:29:58.776 --> 00:30:00.846 A:middle
The default value is rectangle.

00:30:01.486 --> 00:30:03.546 A:middle
So, we have to use the frame.

00:30:04.196 --> 00:30:06.046 A:middle
The other option we have is

00:30:06.046 --> 00:30:06.596 A:middle
circle.

00:30:07.516 --> 00:30:09.016 A:middle
Where we use the inscribed

00:30:09.016 --> 00:30:11.956 A:middle
circle of the frame for the

00:30:11.956 --> 00:30:13.156 A:middle
annotation.

00:30:13.226 --> 00:30:14.446 A:middle
And now when we move them

00:30:14.446 --> 00:30:17.236 A:middle
together, they collide and

00:30:17.236 --> 00:30:18.806 A:middle
detect a collision when they are

00:30:18.806 --> 00:30:19.896 A:middle
visually colliding.

00:30:20.646 --> 00:30:23.796 A:middle
Now, not all AnnotationViews are

00:30:23.796 --> 00:30:25.996 A:middle
perfect boxes.

00:30:26.216 --> 00:30:27.406 A:middle
Some of them are actually

00:30:27.406 --> 00:30:28.146 A:middle
rectangles.

00:30:28.636 --> 00:30:30.406 A:middle
And for collisionMode rectangle,

00:30:30.976 --> 00:30:32.926 A:middle
yes, the collision is with the

00:30:32.926 --> 00:30:33.566 A:middle
rectangle.

00:30:33.816 --> 00:30:35.546 A:middle
But if you change it to the

00:30:35.546 --> 00:30:37.746 A:middle
circle, it is a circle.

00:30:37.956 --> 00:30:40.256 A:middle
So, we use the inscribed circle

00:30:40.336 --> 00:30:41.836 A:middle
in the rectangle, not the

00:30:41.836 --> 00:30:43.376 A:middle
inscribed ellipses.

00:30:44.646 --> 00:30:45.916 A:middle
It's important to take a little

00:30:45.916 --> 00:30:46.736 A:middle
bit of note there.

00:30:47.106 --> 00:30:49.936 A:middle
So, not everything is rectangles

00:30:49.936 --> 00:30:50.996 A:middle
or circles either.

00:30:50.996 --> 00:30:51.996 A:middle
We might have something a little

00:30:51.996 --> 00:30:52.966 A:middle
bit more fancy, like

00:30:53.446 --> 00:30:55.776 A:middle
nice-looking 3D rendered golf

00:30:55.776 --> 00:30:58.256 A:middle
clubs for our golf application

00:30:58.606 --> 00:31:00.566 A:middle
that is displayed in flyover.

00:31:00.726 --> 00:31:02.626 A:middle
And as we tilt the map in 3D and

00:31:02.626 --> 00:31:04.236 A:middle
we move them together, we want

00:31:04.236 --> 00:31:05.196 A:middle
them to actually overlap a

00:31:05.196 --> 00:31:06.716 A:middle
little bit because it looks

00:31:06.716 --> 00:31:07.016 A:middle
cool.

00:31:07.796 --> 00:31:09.056 A:middle
It looks really nice, actually.

00:31:09.476 --> 00:31:10.806 A:middle
So, if we use just the

00:31:10.806 --> 00:31:13.306 A:middle
rectangles, they are way past

00:31:13.306 --> 00:31:16.226 A:middle
when we want them to detect

00:31:16.266 --> 00:31:16.716 A:middle
collision.

00:31:17.196 --> 00:31:19.436 A:middle
If we use the circles, no.

00:31:19.596 --> 00:31:21.056 A:middle
it doesn't really fit either.

00:31:21.056 --> 00:31:22.486 A:middle
I mean, what we really want is

00:31:22.486 --> 00:31:23.536 A:middle
something a little bit more

00:31:23.536 --> 00:31:25.566 A:middle
close to this which would be the

00:31:25.566 --> 00:31:26.666 A:middle
circle in the bottom with the

00:31:26.666 --> 00:31:30.076 A:middle
five-point outset option that we

00:31:30.076 --> 00:31:31.056 A:middle
did not give you [laughter].

00:31:32.916 --> 00:31:34.126 A:middle
You don't have that option,

00:31:34.236 --> 00:31:34.536 A:middle
sorry.

00:31:35.556 --> 00:31:38.256 A:middle
Instead, we went back to all the

00:31:38.256 --> 00:31:39.716 A:middle
way when outer layout was

00:31:39.716 --> 00:31:42.446 A:middle
introduced to both iOS and macOS

00:31:42.446 --> 00:31:43.596 A:middle
in the year before.

00:31:43.976 --> 00:31:45.096 A:middle
And you have the alignment

00:31:45.096 --> 00:31:46.996 A:middle
rectangle insets which are the

00:31:46.996 --> 00:31:49.126 A:middle
options that say that you can

00:31:49.126 --> 00:31:51.546 A:middle
configure if two views re to be

00:31:51.546 --> 00:31:53.686 A:middle
aligned next to each other, what

00:31:53.686 --> 00:31:56.246 A:middle
kind of insets would they use to

00:31:56.246 --> 00:31:57.526 A:middle
look visually pleasing?

00:31:58.196 --> 00:31:59.626 A:middle
Which is just what we're doing

00:31:59.626 --> 00:32:00.776 A:middle
here with the AnnotationViews,

00:32:00.776 --> 00:32:01.006 A:middle
right?

00:32:01.656 --> 00:32:03.396 A:middle
What is the visually pleasing

00:32:04.166 --> 00:32:05.476 A:middle
collision rectangle.

00:32:05.776 --> 00:32:07.016 A:middle
So, all you need to do.

00:32:07.386 --> 00:32:09.726 A:middle
Override it and you provide

00:32:09.726 --> 00:32:10.176 A:middle
offset.

00:32:10.356 --> 00:32:11.946 A:middle
So, for the top we can set it to

00:32:11.946 --> 00:32:13.836 A:middle
50 points and we move the

00:32:14.056 --> 00:32:15.156 A:middle
collision area down.

00:32:15.676 --> 00:32:17.596 A:middle
The left edge, 0, we don't need

00:32:17.706 --> 00:32:19.026 A:middle
to change it at all.

00:32:19.406 --> 00:32:21.176 A:middle
The bottom edge we move out by

00:32:21.176 --> 00:32:23.326 A:middle
negative 5, because we want an

00:32:23.426 --> 00:32:24.746 A:middle
outset, not an inset.

00:32:25.206 --> 00:32:26.966 A:middle
And then we do the right edge as

00:32:26.966 --> 00:32:27.256 A:middle
well.

00:32:27.726 --> 00:32:30.756 A:middle
And what we have is that little

00:32:31.056 --> 00:32:32.966 A:middle
circle in the bottom left outset

00:32:32.966 --> 00:32:34.876 A:middle
by 5 points, just as we wanted.

00:32:35.426 --> 00:32:38.356 A:middle
And when we now collide them, it

00:32:38.356 --> 00:32:40.366 A:middle
looks very visually pleasing.

00:32:41.256 --> 00:32:42.946 A:middle
Let's look at the code to

00:32:42.946 --> 00:32:44.166 A:middle
configure our custom

00:32:44.166 --> 00:32:45.156 A:middle
AnnotationViews.

00:32:45.516 --> 00:32:48.816 A:middle
And a few tips and tricks to

00:32:48.816 --> 00:32:50.516 A:middle
make our code base a little bit

00:32:50.516 --> 00:32:53.186 A:middle
more modern and nice.

00:32:54.046 --> 00:32:55.466 A:middle
There we go.

00:32:57.256 --> 00:32:59.876 A:middle
So, let's run the application

00:32:59.876 --> 00:33:01.816 A:middle
first so we see that it works.

00:33:04.196 --> 00:33:05.366 A:middle
Build succeeded.

00:33:05.806 --> 00:33:06.506 A:middle
Compiling.

00:33:07.106 --> 00:33:07.806 A:middle
It is running.

00:33:08.796 --> 00:33:12.426 A:middle
And we have the collision when

00:33:12.426 --> 00:33:13.476 A:middle
we move them together.

00:33:14.286 --> 00:33:15.116 A:middle
They collide out.

00:33:16.156 --> 00:33:16.806 A:middle
So, it works.

00:33:18.196 --> 00:33:20.646 A:middle
Now, looking at the code, we

00:33:20.646 --> 00:33:23.056 A:middle
have our mapView, viewFor

00:33:23.056 --> 00:33:23.686 A:middle
annotation.

00:33:25.016 --> 00:33:26.346 A:middle
The first thing we do is we

00:33:26.346 --> 00:33:28.386 A:middle
check if that is one of our own

00:33:28.386 --> 00:33:29.226 A:middle
annotations.

00:33:29.486 --> 00:33:34.606 A:middle
And if it is, we configure it a

00:33:34.606 --> 00:33:36.346 A:middle
lot to set it up.

00:33:37.266 --> 00:33:39.856 A:middle
And otherwise we check if it's

00:33:39.856 --> 00:33:41.206 A:middle
the system-provided

00:33:41.616 --> 00:33:42.706 A:middle
ClusterAnnotation.

00:33:43.396 --> 00:33:46.246 A:middle
And if it is, we configure it

00:33:46.246 --> 00:33:46.986 A:middle
differently.

00:33:48.016 --> 00:33:50.286 A:middle
And for the else case, we just

00:33:50.286 --> 00:33:51.846 A:middle
return nil to get the system

00:33:51.846 --> 00:33:52.406 A:middle
default.

00:33:52.886 --> 00:33:54.526 A:middle
Currently that would be called

00:33:54.526 --> 00:33:57.156 A:middle
for all the user locations, but

00:33:57.156 --> 00:33:58.836 A:middle
it might be that we add more

00:33:58.996 --> 00:34:00.226 A:middle
system annotations in the

00:34:00.226 --> 00:34:00.696 A:middle
future.

00:34:00.696 --> 00:34:02.106 A:middle
So, good take.

00:34:02.776 --> 00:34:05.006 A:middle
Don't check for user location by

00:34:05.006 --> 00:34:05.486 A:middle
default.

00:34:05.986 --> 00:34:07.616 A:middle
Do the else case, return nil,

00:34:07.616 --> 00:34:08.796 A:middle
and let the system do the right

00:34:08.826 --> 00:34:11.386 A:middle
thing for all the other cases.

00:34:12.376 --> 00:34:15.796 A:middle
Now, this is a lot of code, in

00:34:15.796 --> 00:34:18.436 A:middle
our view controller nonetheless,

00:34:18.756 --> 00:34:19.946 A:middle
and it doesn't really have

00:34:19.946 --> 00:34:21.856 A:middle
anything to do with how it's

00:34:21.856 --> 00:34:24.606 A:middle
going to be displayed or rather

00:34:24.606 --> 00:34:26.096 A:middle
it is all how it's going to be

00:34:26.096 --> 00:34:26.566 A:middle
displayed.

00:34:26.856 --> 00:34:29.006 A:middle
So, I don't think this should be

00:34:29.006 --> 00:34:30.136 A:middle
in the view controller.

00:34:30.746 --> 00:34:35.906 A:middle
So, if I grab here and drag in a

00:34:35.976 --> 00:34:39.416 A:middle
couple of views to my project, I

00:34:39.416 --> 00:34:43.046 A:middle
think that first of all I know I

00:34:43.046 --> 00:34:44.996 A:middle
need to add these files to the

00:34:45.126 --> 00:34:47.086 A:middle
target or it won't compile.

00:34:47.606 --> 00:34:48.046 A:middle
There we go.

00:34:48.946 --> 00:34:51.966 A:middle
Another good tip is in your

00:34:51.966 --> 00:34:54.506 A:middle
AnnotationViews, you can

00:34:54.506 --> 00:34:56.126 A:middle
override the set annotation

00:34:56.126 --> 00:34:58.186 A:middle
method and do the configuration

00:34:58.186 --> 00:34:58.516 A:middle
there.

00:34:58.886 --> 00:35:00.416 A:middle
So, here I have the same thing.

00:35:00.416 --> 00:35:02.036 A:middle
I know I will get a bike.

00:35:02.326 --> 00:35:04.746 A:middle
And if I get a bike, I configure

00:35:04.746 --> 00:35:07.066 A:middle
it, set it up, and be done with

00:35:08.486 --> 00:35:08.876 A:middle
it.

00:35:08.876 --> 00:35:11.426 A:middle
The, this will allow me to go

00:35:11.746 --> 00:35:20.276 A:middle
back here and delete all of

00:35:20.276 --> 00:35:20.726 A:middle
this.

00:35:21.086 --> 00:35:23.846 A:middle
No, actually, not that one.

00:35:23.996 --> 00:35:25.776 A:middle
And delete all of this, because

00:35:25.776 --> 00:35:27.816 A:middle
it's really not fitting there in

00:35:27.816 --> 00:35:28.656 A:middle
the view controller.

00:35:28.656 --> 00:35:30.116 A:middle
It gets a lot, lot smaller.

00:35:31.546 --> 00:35:33.716 A:middle
Another thing that might annoy

00:35:33.906 --> 00:35:38.276 A:middle
SWF developers is that this view

00:35:38.276 --> 00:35:40.376 A:middle
here is an optional.

00:35:40.986 --> 00:35:42.926 A:middle
We really don't want optionals.

00:35:43.986 --> 00:35:47.416 A:middle
So, we want it to be normal

00:35:47.416 --> 00:35:48.536 A:middle
required variable.

00:35:49.146 --> 00:35:52.326 A:middle
Now, the DQ reusable annotation

00:35:52.416 --> 00:35:56.416 A:middle
with view do return an optional.

00:35:57.366 --> 00:36:00.296 A:middle
But we fixed that and give you a

00:36:00.296 --> 00:36:00.876 A:middle
sibling.

00:36:01.546 --> 00:36:04.506 A:middle
The DQ reusable annotation with

00:36:04.506 --> 00:36:07.116 A:middle
identifier for annotation.

00:36:07.976 --> 00:36:09.556 A:middle
It is modeled after the DQ

00:36:09.556 --> 00:36:11.676 A:middle
methods on UITableView and

00:36:11.676 --> 00:36:12.706 A:middle
UICollectionView.

00:36:13.366 --> 00:36:15.016 A:middle
So, it will always return an

00:36:15.016 --> 00:36:15.636 A:middle
instance.

00:36:15.886 --> 00:36:21.066 A:middle
Let's give it a, oops.

00:36:21.546 --> 00:36:27.446 A:middle
Yeah. That's how you type.

00:36:27.446 --> 00:36:30.356 A:middle
And the annotation.

00:36:30.896 --> 00:36:32.546 A:middle
You might notice I did not have

00:36:32.546 --> 00:36:33.326 A:middle
US keyboard here.

00:36:34.176 --> 00:36:36.976 A:middle
And by doing that, we no longer

00:36:37.566 --> 00:36:40.206 A:middle
have to do the if check for did

00:36:40.206 --> 00:36:42.886 A:middle
we actually do it and create it

00:36:42.886 --> 00:36:43.296 A:middle
instead.

00:36:43.916 --> 00:36:45.346 A:middle
We don't have to set the

00:36:45.346 --> 00:36:46.866 A:middle
annotation, because we give it

00:36:46.946 --> 00:36:48.256 A:middle
to the initializer.

00:36:48.786 --> 00:36:49.936 A:middle
And we can just delete this.

00:36:50.916 --> 00:36:52.656 A:middle
Actually, let's go one further.

00:36:53.866 --> 00:36:56.566 A:middle
We can delete all of this.

00:36:56.606 --> 00:36:57.726 A:middle
We don't need that.

00:36:58.556 --> 00:37:00.586 A:middle
Because we can register our

00:37:00.586 --> 00:37:04.576 A:middle
AnnotationViews to use for reuse

00:37:04.576 --> 00:37:05.606 A:middle
identifiers.

00:37:06.456 --> 00:37:08.666 A:middle
So, just as with the TableViews

00:37:09.196 --> 00:37:10.816 A:middle
and CollectionViews, we have

00:37:10.996 --> 00:37:13.406 A:middle
tell the map view here, I want

00:37:13.406 --> 00:37:14.086 A:middle
to register.

00:37:14.476 --> 00:37:17.596 A:middle
And use the bike view class for

00:37:17.596 --> 00:37:20.516 A:middle
any view with the reuse

00:37:20.516 --> 00:37:22.746 A:middle
identifier that could be of your

00:37:22.746 --> 00:37:24.666 A:middle
choosing or one of the two

00:37:25.066 --> 00:37:26.566 A:middle
constants that we provide for

00:37:26.566 --> 00:37:26.776 A:middle
you.

00:37:27.146 --> 00:37:29.746 A:middle
The default annotation view

00:37:29.986 --> 00:37:31.496 A:middle
which we use for any single

00:37:31.496 --> 00:37:33.006 A:middle
annotation view created by the

00:37:33.006 --> 00:37:35.606 A:middle
system and the default

00:37:35.796 --> 00:37:37.526 A:middle
ClusterAnnotation view that we

00:37:37.526 --> 00:37:39.826 A:middle
use for any system annotation

00:37:39.826 --> 00:37:40.006 A:middle
view.

00:37:40.876 --> 00:37:49.226 A:middle
And now when we run it, it

00:37:49.496 --> 00:37:50.186 A:middle
compiles.

00:37:50.626 --> 00:37:52.496 A:middle
It runs. It launches.

00:37:53.066 --> 00:37:55.236 A:middle
And as we move them together

00:37:55.866 --> 00:37:57.636 A:middle
with no code, they merge.

00:37:58.996 --> 00:38:01.136 A:middle
And when we group them, we get

00:38:01.136 --> 00:38:02.626 A:middle
the nice little pie chart.

00:38:03.506 --> 00:38:05.416 A:middle
And that is a few tips and

00:38:05.416 --> 00:38:06.586 A:middle
tricks for how to make

00:38:06.586 --> 00:38:08.686 A:middle
AnnotationViews a lot easier.

00:38:09.456 --> 00:38:10.406 A:middle
Let's go back to the slides.

00:38:11.516 --> 00:38:14.516 A:middle
[ Applause ]

00:38:15.016 --> 00:38:19.216 A:middle
So, thank you for being here.

00:38:19.846 --> 00:38:21.036 A:middle
Today we covered a lot of

00:38:21.036 --> 00:38:21.376 A:middle
things.

00:38:21.826 --> 00:38:25.286 A:middle
First we have the new map type,

00:38:25.286 --> 00:38:28.566 A:middle
the muted standard, that allows

00:38:28.566 --> 00:38:30.786 A:middle
your data to stand out on your

00:38:30.786 --> 00:38:32.326 A:middle
map in your application.

00:38:33.146 --> 00:38:35.446 A:middle
We give you all of the map

00:38:35.516 --> 00:38:37.936 A:middle
controls as proper views so you

00:38:37.936 --> 00:38:40.266 A:middle
can configure in to display them

00:38:40.266 --> 00:38:42.576 A:middle
where and when it makes sense

00:38:42.576 --> 00:38:43.666 A:middle
with the context of your

00:38:43.666 --> 00:38:44.516 A:middle
applications.

00:38:45.066 --> 00:38:45.686 A:middle
We have the new

00:38:45.686 --> 00:38:47.506 A:middle
MarkerAnnotationView that

00:38:47.506 --> 00:38:49.736 A:middle
displays a lot more information

00:38:49.736 --> 00:38:51.486 A:middle
about your data at a glance

00:38:51.486 --> 00:38:53.176 A:middle
without having to dig in and out

00:38:53.176 --> 00:38:54.296 A:middle
of the data all the time.

00:38:54.976 --> 00:38:57.006 A:middle
And the MarkerAnnotationView

00:38:57.006 --> 00:38:59.386 A:middle
works beautiful with the new

00:38:59.416 --> 00:39:03.206 A:middle
APIs for display priority and

00:39:03.236 --> 00:39:06.276 A:middle
clustering to get your data a

00:39:06.276 --> 00:39:08.906 A:middle
lot more nicer looking and less

00:39:09.426 --> 00:39:10.236 A:middle
cluttered map.

00:39:10.946 --> 00:39:13.556 A:middle
For more information, go to this

00:39:13.556 --> 00:39:14.036 A:middle
website.

00:39:14.776 --> 00:39:17.666 A:middle
There is also the sample code

00:39:17.766 --> 00:39:19.146 A:middle
for the application I've been

00:39:19.446 --> 00:39:20.326 A:middle
showing you today.

00:39:20.906 --> 00:39:22.466 A:middle
Please play around with it and

00:39:22.466 --> 00:39:24.106 A:middle
see what great things can be

00:39:24.106 --> 00:39:24.446 A:middle
done.

00:39:24.796 --> 00:39:26.376 A:middle
I'm very excited to see what you

00:39:26.376 --> 00:39:28.646 A:middle
will do with this.

00:39:29.186 --> 00:39:30.456 A:middle
Also, go back and watch the

00:39:30.456 --> 00:39:32.486 A:middle
videos for What's New in

00:39:32.706 --> 00:39:34.116 A:middle
Location Technologies from

00:39:34.116 --> 00:39:34.666 A:middle
yesterday.

00:39:34.966 --> 00:39:36.956 A:middle
And What's New in MapKit from

00:39:36.956 --> 00:39:38.136 A:middle
2015.

00:39:38.636 --> 00:39:39.416 A:middle
Thank you very much.

00:39:40.508 --> 00:39:42.508 A:middle
[ Applause ]