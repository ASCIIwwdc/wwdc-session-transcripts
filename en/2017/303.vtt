WEBVTT

00:00:20.806 --> 00:00:21.556 A:middle
&gt;&gt; Good morning, everyone.

00:00:22.516 --> 00:00:26.636 A:middle
[ Applause ]

00:00:27.136 --> 00:00:28.096 A:middle
Welcome to What's New in

00:00:28.096 --> 00:00:28.656 A:middle
StoreKit.

00:00:29.116 --> 00:00:30.256 A:middle
My name is Pete Hare, and I'm an

00:00:30.256 --> 00:00:31.736 A:middle
engineer on the App Store Team

00:00:31.736 --> 00:00:33.586 A:middle
here, at Apple.

00:00:33.796 --> 00:00:35.286 A:middle
In-app purchases represent a

00:00:35.286 --> 00:00:36.996 A:middle
huge percentage of revenue,

00:00:37.086 --> 00:00:38.286 A:middle
generated by apps on the App

00:00:38.286 --> 00:00:38.636 A:middle
Store.

00:00:38.636 --> 00:00:40.116 A:middle
So, to be able to implement them

00:00:40.116 --> 00:00:41.546 A:middle
and to sell content to your

00:00:41.546 --> 00:00:42.036 A:middle
users.

00:00:42.086 --> 00:00:42.956 A:middle
And to provide a great

00:00:42.956 --> 00:00:43.836 A:middle
experience throughout this

00:00:43.836 --> 00:00:44.836 A:middle
process, is becoming

00:00:45.066 --> 00:00:46.576 A:middle
increasingly important for you

00:00:46.576 --> 00:00:47.386 A:middle
and your business.

00:00:48.366 --> 00:00:49.326 A:middle
Now, we're working on ways for

00:00:49.326 --> 00:00:50.416 A:middle
you to do all of these things,

00:00:50.416 --> 00:00:51.476 A:middle
even more effectively.

00:00:51.476 --> 00:00:52.926 A:middle
And we're here, today, to talk

00:00:52.926 --> 00:00:54.056 A:middle
to you about some enhancements

00:00:54.056 --> 00:00:55.016 A:middle
to the StoreKit framework.

00:00:55.746 --> 00:00:57.306 A:middle
StoreKit is the framework that

00:00:57.306 --> 00:00:58.536 A:middle
powers in-app purchases, amongst

00:00:58.586 --> 00:00:59.536 A:middle
some other store related

00:00:59.786 --> 00:01:00.396 A:middle
abilities.

00:00:59.786 --> 00:01:00.396 A:middle
abilities.

00:01:00.706 --> 00:01:01.376 A:middle
But we've got some new

00:01:01.376 --> 00:01:02.886 A:middle
advancements in iOS 11.

00:01:03.556 --> 00:01:04.635 A:middle
Firstly, you're going to have

00:01:04.635 --> 00:01:05.826 A:middle
the ability now, to promote your

00:01:05.826 --> 00:01:07.496 A:middle
in-app purchases directly in the

00:01:07.496 --> 00:01:08.076 A:middle
App Store app.

00:01:08.606 --> 00:01:09.906 A:middle
So, a user can buy an in-app

00:01:09.906 --> 00:01:11.476 A:middle
purchase and complete that in

00:01:11.476 --> 00:01:12.366 A:middle
your own application.

00:01:13.116 --> 00:01:14.936 A:middle
Secondly, we're introducing some

00:01:14.936 --> 00:01:15.876 A:middle
enhancements to the

00:01:15.876 --> 00:01:17.236 A:middle
subscription, auto-renewable

00:01:17.236 --> 00:01:18.096 A:middle
subscription flows.

00:01:18.306 --> 00:01:19.366 A:middle
We've got new server to server

00:01:19.366 --> 00:01:20.806 A:middle
subscription notifications.

00:01:20.806 --> 00:01:21.966 A:middle
This is really going to make

00:01:21.966 --> 00:01:22.876 A:middle
your lives easier if you're

00:01:22.876 --> 00:01:23.816 A:middle
dealing with auto-renewable

00:01:23.816 --> 00:01:24.516 A:middle
subscriptions.

00:01:24.616 --> 00:01:24.786 A:middle
Yeah.

00:01:25.516 --> 00:01:28.556 A:middle
[ Applause ]

00:01:29.056 --> 00:01:30.376 A:middle
We've also got some new detailed

00:01:30.376 --> 00:01:32.076 A:middle
subscription status information

00:01:32.236 --> 00:01:33.246 A:middle
when you're dealing with service

00:01:33.246 --> 00:01:33.876 A:middle
side management.

00:01:33.876 --> 00:01:34.596 A:middle
This is going to give you much

00:01:34.636 --> 00:01:36.036 A:middle
greater insight into some of

00:01:36.036 --> 00:01:37.186 A:middle
those business questions about

00:01:37.186 --> 00:01:38.506 A:middle
individual users and their

00:01:38.506 --> 00:01:39.426 A:middle
subscription states.

00:01:39.766 --> 00:01:41.976 A:middle
We also, introduced earlier this

00:01:41.976 --> 00:01:43.236 A:middle
year, the ability for you to

00:01:43.236 --> 00:01:44.506 A:middle
respond to user's reviews on the

00:01:44.506 --> 00:01:44.956 A:middle
App Store.

00:01:45.286 --> 00:01:46.426 A:middle
And along with that, we have

00:01:46.426 --> 00:01:47.666 A:middle
some new enhancements in the

00:01:47.666 --> 00:01:49.086 A:middle
ways you can ask for ratings and

00:01:49.086 --> 00:01:49.666 A:middle
reviews.

00:01:50.356 --> 00:01:51.996 A:middle
Now, before we go into some of

00:01:51.996 --> 00:01:53.456 A:middle
these new features, I'd like to

00:01:53.456 --> 00:01:54.966 A:middle
start with an overview of the

00:01:54.966 --> 00:01:56.246 A:middle
in-app purchase process.

00:01:56.286 --> 00:01:57.496 A:middle
So, let's look at implementing

00:01:57.496 --> 00:01:58.456 A:middle
in-app purchases in your

00:01:58.456 --> 00:01:59.046 A:middle
application.

00:02:00.236 --> 00:02:02.386 A:middle
Now, in app purchases haven't

00:02:02.386 --> 00:02:03.156 A:middle
really changed much.

00:02:03.156 --> 00:02:04.546 A:middle
They were introduced in iOS 3.

00:02:04.886 --> 00:02:07.006 A:middle
An in-app purchase is really the

00:02:07.006 --> 00:02:08.175 A:middle
ability for you to sell digital

00:02:08.175 --> 00:02:09.705 A:middle
content or a service inside your

00:02:09.705 --> 00:02:09.816 A:middle
app.

00:02:10.705 --> 00:02:11.716 A:middle
So, when it comes to physical

00:02:11.716 --> 00:02:13.206 A:middle
goods or services, it's not

00:02:13.206 --> 00:02:14.236 A:middle
really appropriate for in-app

00:02:14.236 --> 00:02:14.676 A:middle
purchases.

00:02:14.676 --> 00:02:15.706 A:middle
We provide things like Apple

00:02:15.706 --> 00:02:17.326 A:middle
Pay, and you can implement your

00:02:17.326 --> 00:02:18.256 A:middle
own payment systems to

00:02:18.256 --> 00:02:19.516 A:middle
accomplish selling physical

00:02:19.516 --> 00:02:19.856 A:middle
goods.

00:02:20.016 --> 00:02:20.836 A:middle
But when it comes to digital

00:02:20.836 --> 00:02:22.326 A:middle
services, that's what in-app

00:02:22.326 --> 00:02:24.706 A:middle
purchases are good for.

00:02:24.896 --> 00:02:26.066 A:middle
We have four different types of

00:02:26.066 --> 00:02:27.086 A:middle
in-app purchases that you can

00:02:27.086 --> 00:02:27.466 A:middle
use.

00:02:28.276 --> 00:02:29.706 A:middle
Firstly, we have consumable

00:02:29.706 --> 00:02:30.246 A:middle
products.

00:02:30.486 --> 00:02:31.496 A:middle
Now, this type of in-app

00:02:31.496 --> 00:02:32.666 A:middle
purchase is the kind of in-app

00:02:32.666 --> 00:02:34.176 A:middle
purchase that can be consumed,

00:02:34.176 --> 00:02:35.646 A:middle
as the name suggests, and used

00:02:35.646 --> 00:02:36.306 A:middle
up by a user.

00:02:36.446 --> 00:02:38.226 A:middle
So, this might be gold coins in

00:02:38.226 --> 00:02:39.916 A:middle
a game that a user buys and

00:02:39.916 --> 00:02:40.566 A:middle
maybe spends.

00:02:40.866 --> 00:02:42.066 A:middle
And it doesn't persist around

00:02:42.066 --> 00:02:43.486 A:middle
subsequent restores or new

00:02:43.486 --> 00:02:44.086 A:middle
devices.

00:02:45.176 --> 00:02:46.846 A:middle
The second kind is a

00:02:46.846 --> 00:02:47.986 A:middle
non-consumable product.

00:02:48.456 --> 00:02:50.296 A:middle
It's a little different than the

00:02:50.296 --> 00:02:51.276 A:middle
consumable product in that it

00:02:51.276 --> 00:02:52.026 A:middle
does persist.

00:02:52.026 --> 00:02:52.986 A:middle
So, this might be more

00:02:52.986 --> 00:02:53.956 A:middle
appropriate for things like

00:02:54.446 --> 00:02:55.786 A:middle
unlocking a pro feature in your

00:02:55.786 --> 00:02:56.706 A:middle
application, or maybe,

00:02:56.866 --> 00:02:57.826 A:middle
downloading a level pack for a

00:02:57.826 --> 00:02:57.936 A:middle
game.

00:03:00.346 --> 00:03:01.566 A:middle
We also offer two different

00:03:01.566 --> 00:03:02.866 A:middle
types of subscription products.

00:03:02.866 --> 00:03:04.466 A:middle
We have the nonrenewing

00:03:04.466 --> 00:03:05.206 A:middle
subscriptions.

00:03:05.206 --> 00:03:07.116 A:middle
Now, as the name suggests, this

00:03:07.116 --> 00:03:08.056 A:middle
is the type of subscription

00:03:08.056 --> 00:03:08.626 A:middle
product that doesn't

00:03:08.626 --> 00:03:10.236 A:middle
automatically charge the user at

00:03:10.236 --> 00:03:11.506 A:middle
the end of the billing period.

00:03:11.506 --> 00:03:12.556 A:middle
You can kind of think of this

00:03:12.556 --> 00:03:14.336 A:middle
one like a consumable product

00:03:14.336 --> 00:03:16.316 A:middle
with an expiry date on it.

00:03:16.546 --> 00:03:17.616 A:middle
And of course, the last type is

00:03:17.616 --> 00:03:18.406 A:middle
the auto-renewable

00:03:18.406 --> 00:03:19.256 A:middle
subscriptions.

00:03:20.116 --> 00:03:21.666 A:middle
So, we open the categories of

00:03:21.666 --> 00:03:23.396 A:middle
auto-renewable subscriptions to

00:03:23.616 --> 00:03:24.736 A:middle
a much wider array of

00:03:24.736 --> 00:03:25.576 A:middle
categories, last year.

00:03:25.576 --> 00:03:26.516 A:middle
And have seen some great uptake

00:03:26.516 --> 00:03:26.886 A:middle
of that.

00:03:27.656 --> 00:03:28.766 A:middle
In this particular talk, we're

00:03:28.766 --> 00:03:29.636 A:middle
just going to focus on these

00:03:29.706 --> 00:03:30.906 A:middle
first two types, though.

00:03:30.906 --> 00:03:31.906 A:middle
Mostly, consumable and

00:03:31.906 --> 00:03:32.586 A:middle
non-consumable.

00:03:32.586 --> 00:03:33.686 A:middle
We're going to be going into

00:03:33.686 --> 00:03:35.076 A:middle
subscriptions in much greater

00:03:35.076 --> 00:03:36.456 A:middle
detail, in the Advanced talk,

00:03:36.456 --> 00:03:37.116 A:middle
this afternoon.

00:03:37.336 --> 00:03:39.146 A:middle
It's at 1:50 p.m. in the Grand

00:03:39.146 --> 00:03:39.746 A:middle
Ballroom A.

00:03:39.746 --> 00:03:40.476 A:middle
So, if you're dealing with

00:03:40.696 --> 00:03:42.086 A:middle
subscriptions in a particularly

00:03:42.086 --> 00:03:43.066 A:middle
service side environment, I

00:03:43.066 --> 00:03:44.086 A:middle
definitely encourage you to come

00:03:44.086 --> 00:03:44.746 A:middle
along to that session.

00:03:44.746 --> 00:03:45.526 A:middle
We've got some great new

00:03:45.856 --> 00:03:46.566 A:middle
enhancements, there.

00:03:47.806 --> 00:03:48.836 A:middle
So, let's look at how to

00:03:48.836 --> 00:03:50.266 A:middle
implement in-app purchases in

00:03:50.266 --> 00:03:50.956 A:middle
your application.

00:03:51.896 --> 00:03:53.936 A:middle
It starts with loading up your

00:03:53.936 --> 00:03:55.216 A:middle
in-app identifiers in your

00:03:55.216 --> 00:03:55.716 A:middle
application.

00:03:55.876 --> 00:03:57.166 A:middle
We're going to dive into each of

00:03:57.166 --> 00:03:57.916 A:middle
these steps in a little more

00:03:57.916 --> 00:03:58.336 A:middle
detail.

00:03:58.336 --> 00:03:59.016 A:middle
But I'll just give you an

00:03:59.016 --> 00:03:59.436 A:middle
overview, now.

00:03:59.926 --> 00:04:02.286 A:middle
Using those in-app identifiers,

00:03:59.926 --> 00:04:02.286 A:middle
Using those in-app identifiers,

00:04:02.286 --> 00:04:03.706 A:middle
you can fetch localized product

00:04:03.706 --> 00:04:04.926 A:middle
information from the App Store.

00:04:05.486 --> 00:04:06.876 A:middle
And once you have that localized

00:04:06.876 --> 00:04:08.336 A:middle
information for the products,

00:04:08.886 --> 00:04:10.766 A:middle
you can display in-app UI to the

00:04:10.766 --> 00:04:11.046 A:middle
user.

00:04:11.886 --> 00:04:12.706 A:middle
This gives the user an

00:04:12.706 --> 00:04:14.206 A:middle
opportunity to tap that Buy

00:04:14.206 --> 00:04:15.846 A:middle
button and agree to purchase it,

00:04:16.125 --> 00:04:17.185 A:middle
at which point it's up to you to

00:04:17.185 --> 00:04:19.346 A:middle
go ahead and request a payment.

00:04:20.236 --> 00:04:22.466 A:middle
The user then, elects to buy

00:04:22.466 --> 00:04:23.186 A:middle
your in-app purchase and

00:04:23.186 --> 00:04:24.146 A:middle
authenticate the payment.

00:04:24.746 --> 00:04:25.706 A:middle
And it's up to you, to then

00:04:25.706 --> 00:04:27.036 A:middle
process the transaction that

00:04:27.036 --> 00:04:28.066 A:middle
comes back from StoreKit.

00:04:28.426 --> 00:04:30.836 A:middle
Once the transaction's been

00:04:30.836 --> 00:04:32.436 A:middle
processed, it's up to you to

00:04:32.436 --> 00:04:33.236 A:middle
unlock the content.

00:04:33.236 --> 00:04:34.236 A:middle
Make that in-app purchase

00:04:34.236 --> 00:04:35.106 A:middle
available to the user.

00:04:36.276 --> 00:04:37.886 A:middle
And finally, the last step is to

00:04:37.886 --> 00:04:39.016 A:middle
finish the transaction.

00:04:39.836 --> 00:04:41.406 A:middle
So, let's dive into the first

00:04:41.406 --> 00:04:42.606 A:middle
step, loading the in-app

00:04:42.606 --> 00:04:42.976 A:middle
identifiers.

00:04:45.676 --> 00:04:46.996 A:middle
The in-app identifiers are

00:04:46.996 --> 00:04:48.346 A:middle
really just kind of product

00:04:48.346 --> 00:04:49.796 A:middle
skews that you set up in iTunes

00:04:49.796 --> 00:04:50.146 A:middle
Connect.

00:04:50.496 --> 00:04:51.516 A:middle
Each product that you sell has

00:04:51.516 --> 00:04:52.336 A:middle
its own identifier.

00:04:52.336 --> 00:04:54.006 A:middle
And when it comes to loading

00:04:54.006 --> 00:04:54.966 A:middle
these in your applications, you

00:04:54.966 --> 00:04:56.256 A:middle
can do it a couple of ways.

00:04:56.256 --> 00:04:57.766 A:middle
Firstly, you can just bake them

00:04:57.766 --> 00:04:59.026 A:middle
directly into your application.

00:04:59.376 --> 00:05:00.236 A:middle
So, in this case, I've just got

00:04:59.376 --> 00:05:00.236 A:middle
So, in this case, I've just got

00:05:00.236 --> 00:05:01.136 A:middle
an array of strings.

00:05:02.066 --> 00:05:03.226 A:middle
Or the other way, of course, is

00:05:03.226 --> 00:05:05.116 A:middle
to maybe fetch them from your

00:05:05.776 --> 00:05:07.256 A:middle
own server.

00:05:07.426 --> 00:05:08.506 A:middle
Either one of these techniques

00:05:08.506 --> 00:05:09.386 A:middle
will work, but the important

00:05:09.386 --> 00:05:10.456 A:middle
thing is that you just have this

00:05:10.456 --> 00:05:11.916 A:middle
set of strings, these in-app

00:05:11.916 --> 00:05:13.536 A:middle
identifiers that you can use to

00:05:13.536 --> 00:05:14.696 A:middle
go ahead and fetch product

00:05:14.696 --> 00:05:15.476 A:middle
information for.

00:05:16.266 --> 00:05:17.766 A:middle
Which is the next step.

00:05:18.716 --> 00:05:21.266 A:middle
So, if you have these, it's just

00:05:21.266 --> 00:05:22.566 A:middle
a simple step to go ahead and

00:05:22.566 --> 00:05:23.766 A:middle
load up the product information.

00:05:23.766 --> 00:05:25.386 A:middle
Let's look at the code for it.

00:05:26.276 --> 00:05:28.546 A:middle
You take that set of identifiers

00:05:28.676 --> 00:05:29.926 A:middle
and you pass it through to an

00:05:29.926 --> 00:05:31.496 A:middle
SKProductsRequest initializer.

00:05:32.726 --> 00:05:34.736 A:middle
Set a delegate on that request.

00:05:34.856 --> 00:05:36.026 A:middle
And then, just kick it off using

00:05:36.516 --> 00:05:38.296 A:middle
the start method.

00:05:38.356 --> 00:05:40.006 A:middle
Now, you've set a delegate

00:05:40.006 --> 00:05:41.156 A:middle
method on this so you'll get a

00:05:41.156 --> 00:05:42.506 A:middle
response in the didReceive

00:05:42.506 --> 00:05:43.496 A:middle
response callback.

00:05:43.496 --> 00:05:46.766 A:middle
So, inside this callback you'll

00:05:46.766 --> 00:05:48.176 A:middle
receive an array of products

00:05:48.216 --> 00:05:49.096 A:middle
that match those in-app

00:05:49.096 --> 00:05:50.926 A:middle
identifiers that you've sent up

00:05:50.926 --> 00:05:51.776 A:middle
in the request.

00:05:52.496 --> 00:05:53.196 A:middle
Now, you can loop through these

00:05:53.236 --> 00:05:53.636 A:middle
products.

00:05:53.636 --> 00:05:54.726 A:middle
And we'll just highlight some of

00:05:54.726 --> 00:05:56.326 A:middle
the fields that are included on

00:05:56.326 --> 00:05:57.766 A:middle
these product objects.

00:05:57.766 --> 00:05:58.976 A:middle
There's a localized title and a

00:05:58.976 --> 00:06:00.716 A:middle
localized description for that

00:05:58.976 --> 00:06:00.716 A:middle
localized description for that

00:06:00.716 --> 00:06:01.096 A:middle
product.

00:06:02.226 --> 00:06:03.486 A:middle
There's also localized price

00:06:03.486 --> 00:06:05.036 A:middle
information about that product

00:06:05.236 --> 00:06:06.386 A:middle
in the store that, that user's

00:06:06.386 --> 00:06:06.946 A:middle
logged into.

00:06:07.526 --> 00:06:09.916 A:middle
And we also have the information

00:06:09.916 --> 00:06:10.986 A:middle
here, about any downloadable

00:06:10.986 --> 00:06:12.566 A:middle
content that might be associated

00:06:12.566 --> 00:06:14.986 A:middle
with this product.

00:06:15.246 --> 00:06:16.736 A:middle
So, one more important point,

00:06:16.736 --> 00:06:17.496 A:middle
here, just to highlight, is that

00:06:17.496 --> 00:06:18.416 A:middle
you shouldn't cache the

00:06:18.416 --> 00:06:19.716 A:middle
SKProduct that comes back in

00:06:19.716 --> 00:06:20.196 A:middle
this point.

00:06:20.736 --> 00:06:22.456 A:middle
It's really important that you

00:06:22.456 --> 00:06:23.336 A:middle
get up to date product

00:06:23.336 --> 00:06:24.746 A:middle
information, by performing these

00:06:24.746 --> 00:06:25.646 A:middle
requests regularly.

00:06:25.976 --> 00:06:27.126 A:middle
Because things like currency can

00:06:27.126 --> 00:06:27.716 A:middle
fluctuate.

00:06:27.926 --> 00:06:29.236 A:middle
You know, a user might log out,

00:06:29.236 --> 00:06:30.256 A:middle
log into a different store

00:06:30.256 --> 00:06:30.516 A:middle
front.

00:06:30.516 --> 00:06:31.656 A:middle
So, the locale might change.

00:06:31.836 --> 00:06:32.976 A:middle
Make sure that as often as you

00:06:32.976 --> 00:06:34.576 A:middle
need to, you're requesting new

00:06:34.576 --> 00:06:35.766 A:middle
product information from the App

00:06:35.766 --> 00:06:36.936 A:middle
Store, and not holding onto an

00:06:36.936 --> 00:06:38.366 A:middle
instance of these SKProducts.

00:06:39.346 --> 00:06:41.046 A:middle
But now, you have your SKProduct

00:06:41.046 --> 00:06:41.966 A:middle
object and you're ready to go

00:06:41.966 --> 00:06:43.636 A:middle
ahead and show an actual in-app

00:06:43.636 --> 00:06:44.476 A:middle
UI to the user.

00:06:45.276 --> 00:06:46.436 A:middle
So, when it comes to showing the

00:06:46.436 --> 00:06:47.706 A:middle
UI, of course, this is really up

00:06:47.706 --> 00:06:48.456 A:middle
to your application.

00:06:48.456 --> 00:06:49.566 A:middle
And every application's a little

00:06:49.566 --> 00:06:50.816 A:middle
different in how you're going to

00:06:50.816 --> 00:06:51.566 A:middle
present the products to the

00:06:51.566 --> 00:06:52.046 A:middle
users.

00:06:52.596 --> 00:06:55.576 A:middle
It can have a large effect on

00:06:55.576 --> 00:06:56.006 A:middle
sales.

00:06:56.006 --> 00:06:56.946 A:middle
So, I'd encourage you to really

00:06:56.946 --> 00:06:57.896 A:middle
be careful about how you

00:06:57.896 --> 00:06:58.576 A:middle
structure this UI.

00:06:58.696 --> 00:07:00.416 A:middle
And if you want to learn a bit

00:06:58.696 --> 00:07:00.416 A:middle
And if you want to learn a bit

00:07:00.416 --> 00:07:01.226 A:middle
more about that, we've got some

00:07:01.226 --> 00:07:02.396 A:middle
information online on our

00:07:02.396 --> 00:07:03.926 A:middle
developer website, here, to

00:07:03.926 --> 00:07:04.286 A:middle
check out.

00:07:04.286 --> 00:07:05.506 A:middle
This has useful tips about how

00:07:05.506 --> 00:07:06.876 A:middle
to format this particular page

00:07:07.156 --> 00:07:09.106 A:middle
in a way that can, you know,

00:07:09.386 --> 00:07:10.276 A:middle
improve your sales.

00:07:10.786 --> 00:07:13.366 A:middle
One tip, though, just on

00:07:13.436 --> 00:07:14.576 A:middle
formatting the product price.

00:07:14.576 --> 00:07:15.786 A:middle
So, when it comes to the product

00:07:15.786 --> 00:07:17.406 A:middle
price, this is the technique you

00:07:17.406 --> 00:07:18.576 A:middle
can use to actually display that

00:07:18.576 --> 00:07:19.476 A:middle
in your UI.

00:07:19.536 --> 00:07:20.576 A:middle
Create a number formatter

00:07:20.576 --> 00:07:20.956 A:middle
object.

00:07:21.816 --> 00:07:22.966 A:middle
Set the number style to be the

00:07:22.996 --> 00:07:23.906 A:middle
currency style.

00:07:24.616 --> 00:07:26.816 A:middle
And then, set the locale to be

00:07:26.816 --> 00:07:28.146 A:middle
the product price locale.

00:07:28.146 --> 00:07:29.216 A:middle
Now, this is a really important

00:07:29.216 --> 00:07:29.626 A:middle
step.

00:07:29.836 --> 00:07:30.856 A:middle
Because if you don't do this,

00:07:30.856 --> 00:07:31.726 A:middle
it's going to default to the

00:07:31.726 --> 00:07:33.226 A:middle
system device locale.

00:07:33.356 --> 00:07:34.416 A:middle
Which may not actually match the

00:07:34.416 --> 00:07:35.386 A:middle
store that the user's logged

00:07:35.386 --> 00:07:35.706 A:middle
into.

00:07:35.976 --> 00:07:36.806 A:middle
So, the user might be logged

00:07:36.806 --> 00:07:37.676 A:middle
into say, the Chinese

00:07:37.676 --> 00:07:39.436 A:middle
storefront, but have the device

00:07:39.436 --> 00:07:40.416 A:middle
set to U.S. English.

00:07:40.696 --> 00:07:41.486 A:middle
That's important that all the

00:07:41.486 --> 00:07:42.716 A:middle
pricing and currency stuff

00:07:42.876 --> 00:07:44.216 A:middle
matches what they're seeing in

00:07:44.216 --> 00:07:44.756 A:middle
the App Store.

00:07:45.026 --> 00:07:45.936 A:middle
So, make sure you set the

00:07:45.966 --> 00:07:47.606 A:middle
product's price locale under the

00:07:47.606 --> 00:07:48.346 A:middle
number formatting, here.

00:07:49.076 --> 00:07:50.356 A:middle
But once you've done that, you

00:07:50.356 --> 00:07:51.586 A:middle
can just take a string from the

00:07:51.586 --> 00:07:52.946 A:middle
number formatter, and you've got

00:07:52.946 --> 00:07:54.456 A:middle
yourself a formatted string that

00:07:54.456 --> 00:07:56.476 A:middle
you can display in your UI.

00:07:58.396 --> 00:08:00.346 A:middle
Another point, here, don't

00:07:58.396 --> 00:08:00.346 A:middle
Another point, here, don't

00:08:00.546 --> 00:08:01.906 A:middle
perform any currency conversion

00:08:01.906 --> 00:08:02.306 A:middle
yourself.

00:08:02.306 --> 00:08:03.266 A:middle
There's no need to actually

00:08:03.526 --> 00:08:04.396 A:middle
convert currency.

00:08:04.396 --> 00:08:05.926 A:middle
You can let StoreKit handle all

00:08:05.926 --> 00:08:06.436 A:middle
this for you.

00:08:06.716 --> 00:08:07.956 A:middle
So, just take that number and

00:08:08.016 --> 00:08:09.096 A:middle
price locale that you get and

00:08:09.096 --> 00:08:10.066 A:middle
let the number formatter do the

00:08:10.066 --> 00:08:10.556 A:middle
job for you.

00:08:12.456 --> 00:08:13.386 A:middle
The next step, though, once

00:08:13.386 --> 00:08:14.866 A:middle
you've displayed your UI, is to

00:08:14.866 --> 00:08:15.606 A:middle
request a payment.

00:08:15.606 --> 00:08:16.716 A:middle
So, at this point, hopefully the

00:08:16.716 --> 00:08:18.006 A:middle
user's elected to buy your

00:08:18.006 --> 00:08:18.586 A:middle
in-app purchase.

00:08:18.586 --> 00:08:19.606 A:middle
They've hit that Buy button.

00:08:19.856 --> 00:08:21.046 A:middle
So, at this point it's up to you

00:08:21.046 --> 00:08:21.976 A:middle
to go ahead and request a

00:08:21.976 --> 00:08:22.856 A:middle
payment of the user.

00:08:23.726 --> 00:08:24.856 A:middle
Again, this is a really simple

00:08:24.856 --> 00:08:25.076 A:middle
step.

00:08:25.076 --> 00:08:26.066 A:middle
It's just a couple of lines.

00:08:26.636 --> 00:08:28.036 A:middle
You take that SKProduct that the

00:08:28.036 --> 00:08:29.766 A:middle
user's agreed to buy, pass it

00:08:29.766 --> 00:08:32.476 A:middle
into an SKPayment initializer to

00:08:32.476 --> 00:08:33.496 A:middle
create a payment object.

00:08:34.135 --> 00:08:35.496 A:middle
Then, you add that payment to

00:08:35.496 --> 00:08:37.336 A:middle
the SKPaymentQueue's default

00:08:37.336 --> 00:08:37.626 A:middle
queue.

00:08:39.385 --> 00:08:40.306 A:middle
Now, as soon as you add the

00:08:40.306 --> 00:08:41.395 A:middle
payment to the default queue,

00:08:42.155 --> 00:08:44.006 A:middle
the user sees this great new

00:08:44.006 --> 00:08:45.676 A:middle
looking in-app purchase payment

00:08:45.676 --> 00:08:46.006 A:middle
sheet.

00:08:46.006 --> 00:08:47.166 A:middle
So, this is new in iOS 11.

00:08:48.516 --> 00:08:52.806 A:middle
[ Applause ]

00:08:53.306 --> 00:08:54.236 A:middle
And the user, of course, can

00:08:54.236 --> 00:08:55.566 A:middle
just authenticate the purchase

00:08:55.566 --> 00:08:57.336 A:middle
using Touch ID, and then,

00:08:57.336 --> 00:08:58.786 A:middle
continue using your app.

00:08:59.036 --> 00:09:00.026 A:middle
So, we think this is a much

00:08:59.036 --> 00:09:00.026 A:middle
So, we think this is a much

00:09:00.026 --> 00:09:00.926 A:middle
improved design that's going to

00:09:00.926 --> 00:09:02.266 A:middle
make that experience a lot nicer

00:09:02.266 --> 00:09:02.856 A:middle
for users.

00:09:04.126 --> 00:09:04.816 A:middle
Now, at this point, I'll just

00:09:04.816 --> 00:09:05.966 A:middle
take a quick sidestep to talk a

00:09:05.966 --> 00:09:07.396 A:middle
bit about detecting irregular

00:09:07.396 --> 00:09:07.926 A:middle
activity.

00:09:08.476 --> 00:09:09.936 A:middle
So, the ability to detect

00:09:09.936 --> 00:09:11.466 A:middle
irregular activity gives us

00:09:11.466 --> 00:09:12.636 A:middle
warning signs if potentially

00:09:12.636 --> 00:09:13.736 A:middle
something fishy might be going

00:09:13.736 --> 00:09:15.296 A:middle
on in this particular process.

00:09:15.826 --> 00:09:16.986 A:middle
Now, Apple has an advanced

00:09:16.986 --> 00:09:18.446 A:middle
engine to detect and block

00:09:18.446 --> 00:09:19.646 A:middle
irregular activity before it

00:09:19.646 --> 00:09:20.946 A:middle
happens, in the best cases.

00:09:21.446 --> 00:09:22.556 A:middle
But there are some cases where

00:09:22.556 --> 00:09:24.646 A:middle
this happens after a payment's

00:09:24.646 --> 00:09:25.016 A:middle
gone through.

00:09:25.016 --> 00:09:26.266 A:middle
And it can only detect it after

00:09:26.516 --> 00:09:27.016 A:middle
the fact.

00:09:27.916 --> 00:09:29.636 A:middle
Now, in those cases, we refund

00:09:29.836 --> 00:09:30.916 A:middle
developers or users as

00:09:30.916 --> 00:09:31.756 A:middle
appropriate, but that's not a

00:09:31.756 --> 00:09:32.476 A:middle
great experience.

00:09:32.476 --> 00:09:34.116 A:middle
So, we try to ask for a little

00:09:34.116 --> 00:09:35.456 A:middle
collaboration from you, at this

00:09:35.496 --> 00:09:36.956 A:middle
point, to help us detect these

00:09:36.956 --> 00:09:37.676 A:middle
things a little earlier.

00:09:38.456 --> 00:09:39.406 A:middle
Now, I'll just go through an

00:09:39.406 --> 00:09:40.426 A:middle
illustration that'll probably

00:09:41.096 --> 00:09:42.106 A:middle
demonstrate what I'm talking

00:09:42.106 --> 00:09:42.616 A:middle
about a bit better.

00:09:42.616 --> 00:09:45.506 A:middle
Let's say I have three devices,

00:09:45.506 --> 00:09:45.716 A:middle
here.

00:09:46.246 --> 00:09:47.196 A:middle
Three different users that are

00:09:47.196 --> 00:09:48.576 A:middle
logged into different Apple IDs.

00:09:49.486 --> 00:09:50.886 A:middle
These three users are purchasing

00:09:50.886 --> 00:09:52.666 A:middle
the same gold coin product from

00:09:52.666 --> 00:09:53.836 A:middle
the App Store from your

00:09:53.836 --> 00:09:54.396 A:middle
application.

00:09:55.286 --> 00:09:56.356 A:middle
Now, this is a really normal

00:09:56.356 --> 00:09:56.766 A:middle
scenario.

00:09:56.766 --> 00:09:57.936 A:middle
This happens millions of times

00:09:57.936 --> 00:09:58.966 A:middle
from millions of users around

00:09:58.966 --> 00:09:59.676 A:middle
the world, every day.

00:10:00.926 --> 00:10:02.206 A:middle
But let's add in another piece

00:10:02.206 --> 00:10:03.306 A:middle
of information to this puzzle

00:10:03.306 --> 00:10:04.426 A:middle
that changes the picture, quite

00:10:04.426 --> 00:10:04.786 A:middle
a lot.

00:10:05.096 --> 00:10:06.446 A:middle
Let's say that these three users

00:10:06.446 --> 00:10:07.596 A:middle
buy gold coins in your

00:10:07.596 --> 00:10:09.186 A:middle
application, but all these

00:10:09.186 --> 00:10:10.956 A:middle
separate IDs are actually

00:10:10.956 --> 00:10:12.466 A:middle
cashing these gold coins into

00:10:12.466 --> 00:10:14.246 A:middle
the same game account on your

00:10:14.246 --> 00:10:14.506 A:middle
server.

00:10:15.436 --> 00:10:16.416 A:middle
Suddenly, this picture looks

00:10:16.416 --> 00:10:17.366 A:middle
highly suspicious.

00:10:18.786 --> 00:10:19.876 A:middle
So, how do we detect these sort

00:10:19.876 --> 00:10:21.206 A:middle
of scenarios earlier on in the

00:10:21.206 --> 00:10:21.796 A:middle
process?

00:10:22.076 --> 00:10:23.756 A:middle
We ask you to provide an account

00:10:23.756 --> 00:10:25.226 A:middle
identifier with this payment

00:10:25.226 --> 00:10:25.506 A:middle
step.

00:10:26.336 --> 00:10:26.926 A:middle
Now, this is really for

00:10:26.926 --> 00:10:27.986 A:middle
applications that have their own

00:10:27.986 --> 00:10:28.866 A:middle
account management.

00:10:29.256 --> 00:10:30.676 A:middle
So, if you've got, say, a server

00:10:30.676 --> 00:10:31.806 A:middle
account and a user is logged in

00:10:31.806 --> 00:10:32.546 A:middle
as a particular user.

00:10:33.296 --> 00:10:34.576 A:middle
And we ask for an opaque

00:10:34.576 --> 00:10:35.726 A:middle
identifier at this step.

00:10:36.666 --> 00:10:37.646 A:middle
Now, what is an opaque

00:10:37.646 --> 00:10:38.216 A:middle
identifier?

00:10:38.336 --> 00:10:40.176 A:middle
Well, we don't really want you

00:10:40.176 --> 00:10:41.496 A:middle
to give us actual information

00:10:41.496 --> 00:10:41.996 A:middle
about the user.

00:10:41.996 --> 00:10:43.276 A:middle
We already know the user's Apple

00:10:43.366 --> 00:10:44.456 A:middle
ID, so don't give us that.

00:10:44.746 --> 00:10:45.996 A:middle
We don't want to know what the

00:10:45.996 --> 00:10:47.996 A:middle
actual username is for the user

00:10:47.996 --> 00:10:48.756 A:middle
or the password.

00:10:48.756 --> 00:10:49.576 A:middle
We don't want to know any of

00:10:49.576 --> 00:10:49.986 A:middle
these details.

00:10:49.986 --> 00:10:51.226 A:middle
What we suggest here, is that

00:10:51.226 --> 00:10:53.436 A:middle
you create a hash of the account

00:10:53.566 --> 00:10:54.426 A:middle
name, or something like this,

00:10:54.426 --> 00:10:54.596 A:middle
right.

00:10:54.596 --> 00:10:55.686 A:middle
This just gives us a unique

00:10:55.686 --> 00:10:57.126 A:middle
identifier to be able to match

00:10:57.126 --> 00:10:58.656 A:middle
these payments across different

00:10:58.656 --> 00:11:00.286 A:middle
Apple IDs and associate them

00:10:58.656 --> 00:11:00.286 A:middle
Apple IDs and associate them

00:11:00.286 --> 00:11:00.566 A:middle
together.

00:11:01.456 --> 00:11:03.336 A:middle
It's a really simple step to be

00:11:03.336 --> 00:11:03.716 A:middle
able to do this.

00:11:03.716 --> 00:11:04.746 A:middle
When you create the SKPayment

00:11:04.746 --> 00:11:06.006 A:middle
that we just saw a moment ago,

00:11:06.006 --> 00:11:07.306 A:middle
there's just an extra step you

00:11:07.306 --> 00:11:07.606 A:middle
can do.

00:11:07.606 --> 00:11:08.816 A:middle
Which is to set the application

00:11:08.816 --> 00:11:09.276 A:middle
username.

00:11:09.276 --> 00:11:11.346 A:middle
And here, you can just set that

00:11:11.346 --> 00:11:12.446 A:middle
hash of the account name, and

00:11:12.446 --> 00:11:13.726 A:middle
that'll just help us detect the

00:11:13.726 --> 00:11:14.936 A:middle
irregular activity earlier on,

00:11:14.936 --> 00:11:15.706 A:middle
in the process.

00:11:16.266 --> 00:11:18.516 A:middle
So, that's a really simple step

00:11:18.516 --> 00:11:20.116 A:middle
you can do to make your payments

00:11:20.116 --> 00:11:21.096 A:middle
a little more secure in your

00:11:22.166 --> 00:11:22.233 A:middle
app.

00:11:23.636 --> 00:11:24.726 A:middle
Once the user's authenticated

00:11:24.726 --> 00:11:25.856 A:middle
they payment, though, the credit

00:11:25.856 --> 00:11:26.536 A:middle
card's charged.

00:11:26.846 --> 00:11:27.656 A:middle
And it's up to you to go ahead

00:11:27.656 --> 00:11:29.016 A:middle
and process the transaction that

00:11:29.016 --> 00:11:30.466 A:middle
comes down from StoreKit.

00:11:31.236 --> 00:11:32.216 A:middle
So, let's see what that looks

00:11:32.216 --> 00:11:32.456 A:middle
like.

00:11:33.016 --> 00:11:33.976 A:middle
Right at the beginning of your

00:11:33.976 --> 00:11:35.056 A:middle
application lifecycle.

00:11:35.176 --> 00:11:36.806 A:middle
And here, I'm doing it at the

00:11:36.806 --> 00:11:38.576 A:middle
didFinishLaunchingWithOptions

00:11:38.856 --> 00:11:39.826 A:middle
app delegate method.

00:11:40.146 --> 00:11:41.346 A:middle
It's important to set a

00:11:41.346 --> 00:11:43.116 A:middle
transaction observer onto the

00:11:43.116 --> 00:11:44.036 A:middle
SKPayment queue.

00:11:44.846 --> 00:11:46.296 A:middle
Now, here I'm adding the actual

00:11:46.296 --> 00:11:47.736 A:middle
AppDelegate, itself, as my

00:11:47.736 --> 00:11:49.426 A:middle
SKPayment transaction observer.

00:11:49.426 --> 00:11:50.826 A:middle
But you could use another object

00:11:50.826 --> 00:11:51.826 A:middle
if you want to actually monitor

00:11:51.826 --> 00:11:52.636 A:middle
these transactions.

00:11:52.906 --> 00:11:53.976 A:middle
The really important thing here,

00:11:53.976 --> 00:11:55.036 A:middle
is that it's happening as early

00:11:55.036 --> 00:11:56.476 A:middle
on in the application lifecycle,

00:11:56.476 --> 00:11:56.936 A:middle
as possible.

00:11:57.576 --> 00:11:59.016 A:middle
See, transactions can come into

00:11:59.256 --> 00:12:00.906 A:middle
this transaction observer any

00:11:59.256 --> 00:12:00.906 A:middle
this transaction observer any

00:12:00.906 --> 00:12:02.326 A:middle
point during your application

00:12:02.326 --> 00:12:02.696 A:middle
lifecycle.

00:12:02.696 --> 00:12:03.576 A:middle
So, make sure that you're

00:12:03.576 --> 00:12:04.386 A:middle
registering it right at the

00:12:04.386 --> 00:12:04.756 A:middle
start.

00:12:05.826 --> 00:12:07.006 A:middle
But once that's registered,

00:12:07.226 --> 00:12:08.296 A:middle
you're ready to start receiving

00:12:08.296 --> 00:12:09.766 A:middle
transactions in the callbacks.

00:12:10.616 --> 00:12:11.636 A:middle
There's this one callback

00:12:11.636 --> 00:12:13.036 A:middle
updated transactions, which is

00:12:13.256 --> 00:12:14.526 A:middle
kind of the center of where this

00:12:14.526 --> 00:12:15.176 A:middle
all happens.

00:12:16.076 --> 00:12:16.836 A:middle
You receive an array of

00:12:16.836 --> 00:12:18.076 A:middle
transactions that come in, and

00:12:18.076 --> 00:12:19.496 A:middle
you can check the transaction

00:12:19.496 --> 00:12:20.306 A:middle
state on each of these

00:12:20.306 --> 00:12:20.996 A:middle
transactions.

00:12:21.836 --> 00:12:22.686 A:middle
And you'll look for a

00:12:22.686 --> 00:12:23.956 A:middle
transaction in the purchased

00:12:24.046 --> 00:12:24.416 A:middle
state.

00:12:25.026 --> 00:12:26.006 A:middle
This is a transaction that's

00:12:26.006 --> 00:12:27.386 A:middle
StoreKit deems appropriate for

00:12:27.386 --> 00:12:29.036 A:middle
you to go ahead and check for

00:12:29.036 --> 00:12:31.106 A:middle
validity and unlock content for,

00:12:31.106 --> 00:12:31.616 A:middle
accordingly.

00:12:32.696 --> 00:12:33.986 A:middle
There are some other states

00:12:33.986 --> 00:12:35.206 A:middle
here, that we won't go into in

00:12:35.206 --> 00:12:35.616 A:middle
this talk.

00:12:35.616 --> 00:12:36.876 A:middle
But one of the ones that I will

00:12:36.876 --> 00:12:38.256 A:middle
call out, is the deferred state.

00:12:38.806 --> 00:12:41.216 A:middle
A transaction can come through

00:12:41.216 --> 00:12:42.256 A:middle
in a deferred state if the user

00:12:42.256 --> 00:12:43.766 A:middle
has asked to buy turned on.

00:12:44.726 --> 00:12:46.566 A:middle
So, a child might ask to buy an

00:12:46.566 --> 00:12:48.046 A:middle
in-app purchase and a request

00:12:48.046 --> 00:12:49.106 A:middle
goes to their parent for

00:12:49.106 --> 00:12:50.256 A:middle
approval to actually approve the

00:12:50.256 --> 00:12:50.826 A:middle
purchase.

00:12:51.206 --> 00:12:52.096 A:middle
And that could take anywhere

00:12:52.096 --> 00:12:54.196 A:middle
between seconds, minutes, weeks,

00:12:54.466 --> 00:12:55.136 A:middle
who knows how long.

00:12:55.136 --> 00:12:56.496 A:middle
So, it's important if something

00:12:56.496 --> 00:12:57.546 A:middle
comes through in this deferred

00:12:57.546 --> 00:12:58.596 A:middle
state, while they're waiting for

00:12:58.596 --> 00:12:59.746 A:middle
an approval, that you allow

00:12:59.976 --> 00:13:00.976 A:middle
access to the application.

00:12:59.976 --> 00:13:00.976 A:middle
access to the application.

00:13:00.976 --> 00:13:02.096 A:middle
Allow them to keep using your

00:13:02.096 --> 00:13:03.196 A:middle
app, and don't let them get

00:13:03.196 --> 00:13:04.606 A:middle
stuck on any kind of modal

00:13:04.606 --> 00:13:05.986 A:middle
loading spinners or things like

00:13:06.016 --> 00:13:06.256 A:middle
that.

00:13:06.886 --> 00:13:07.946 A:middle
The transaction will eventually

00:13:07.946 --> 00:13:09.026 A:middle
come through as a purchased one,

00:13:09.026 --> 00:13:09.946 A:middle
once it does get approved.

00:13:09.946 --> 00:13:11.156 A:middle
And you can just handle it like

00:13:11.156 --> 00:13:12.166 A:middle
any purchase transaction.

00:13:13.476 --> 00:13:15.556 A:middle
In order to test out deferred

00:13:15.556 --> 00:13:16.686 A:middle
transactions, we provide a way

00:13:16.686 --> 00:13:17.366 A:middle
for you to do this.

00:13:17.566 --> 00:13:18.886 A:middle
You can create a mutable payment

00:13:18.886 --> 00:13:19.326 A:middle
object.

00:13:20.086 --> 00:13:20.706 A:middle
And you can set the

00:13:20.706 --> 00:13:22.666 A:middle
simulatesAskToBuy flag on this

00:13:22.666 --> 00:13:23.056 A:middle
object.

00:13:23.336 --> 00:13:24.286 A:middle
Now, this is effective when

00:13:24.286 --> 00:13:25.176 A:middle
you're using the Sandbox

00:13:25.176 --> 00:13:25.756 A:middle
environment.

00:13:25.986 --> 00:13:26.706 A:middle
We're not going to go into the

00:13:26.706 --> 00:13:27.796 A:middle
Sandbox as much, this talk.

00:13:27.796 --> 00:13:29.196 A:middle
But this is what it looks like,

00:13:29.196 --> 00:13:29.576 A:middle
in code.

00:13:29.576 --> 00:13:31.726 A:middle
You just set that

00:13:31.926 --> 00:13:33.676 A:middle
simulatesAskToBuyInSandbox flag

00:13:33.676 --> 00:13:34.096 A:middle
to true.

00:13:34.096 --> 00:13:35.116 A:middle
And this just means that when

00:13:35.266 --> 00:13:36.696 A:middle
you're testing out developing

00:13:36.696 --> 00:13:37.696 A:middle
in-app purchases, this

00:13:37.696 --> 00:13:38.826 A:middle
particular transaction's going

00:13:38.826 --> 00:13:40.236 A:middle
to come through in the updated

00:13:40.236 --> 00:13:41.926 A:middle
transactions call a deferred

00:13:41.926 --> 00:13:42.456 A:middle
transaction.

00:13:42.456 --> 00:13:43.736 A:middle
So, you can just test out how

00:13:43.736 --> 00:13:44.776 A:middle
you handle those particular

00:13:44.776 --> 00:13:45.276 A:middle
cases.

00:13:45.276 --> 00:13:48.326 A:middle
When it comes to handling

00:13:48.326 --> 00:13:49.826 A:middle
errors, couple of points to

00:13:49.826 --> 00:13:50.106 A:middle
remember.

00:13:50.106 --> 00:13:51.326 A:middle
Now, not all errors that come

00:13:51.326 --> 00:13:52.626 A:middle
through this process are equal.

00:13:53.216 --> 00:13:54.256 A:middle
And that means you really need

00:13:54.256 --> 00:13:55.176 A:middle
to pay attention to the error

00:13:55.176 --> 00:13:56.536 A:middle
code that comes through with a

00:13:56.536 --> 00:13:57.196 A:middle
transaction.

00:13:57.706 --> 00:13:59.296 A:middle
So, maybe don't show an alert

00:13:59.296 --> 00:14:00.766 A:middle
unless it's absolutely necessary

00:13:59.296 --> 00:14:00.766 A:middle
unless it's absolutely necessary

00:14:00.766 --> 00:14:01.836 A:middle
to inform your user of a

00:14:01.836 --> 00:14:02.396 A:middle
particular error.

00:14:03.066 --> 00:14:04.016 A:middle
You know, we see things like

00:14:04.276 --> 00:14:05.756 A:middle
maybe a user cancels a payment,

00:14:05.966 --> 00:14:07.686 A:middle
which has a specific error code.

00:14:08.276 --> 00:14:09.126 A:middle
And you don't need to show an

00:14:09.126 --> 00:14:10.486 A:middle
alert that says user cancelled

00:14:10.536 --> 00:14:11.026 A:middle
to the user.

00:14:11.106 --> 00:14:12.296 A:middle
You know, they hit the Cancel

00:14:12.296 --> 00:14:12.956 A:middle
button, they know they

00:14:12.956 --> 00:14:13.426 A:middle
cancelled.

00:14:13.876 --> 00:14:14.616 A:middle
You don't need to let them know,

00:14:14.616 --> 00:14:14.836 A:middle
again.

00:14:15.386 --> 00:14:17.326 A:middle
It's also important to let

00:14:17.326 --> 00:14:18.706 A:middle
StoreKit handle the transaction

00:14:18.706 --> 00:14:19.786 A:middle
flow as much as possible.

00:14:20.276 --> 00:14:21.296 A:middle
And this means that you don't

00:14:21.296 --> 00:14:22.646 A:middle
need to ask for confirmation for

00:14:22.646 --> 00:14:23.676 A:middle
things like in-app purchases,

00:14:23.676 --> 00:14:25.386 A:middle
once they elect to buy it.

00:14:25.386 --> 00:14:26.446 A:middle
We have that nice new payment

00:14:26.446 --> 00:14:27.376 A:middle
sheet to do that for you.

00:14:27.546 --> 00:14:28.716 A:middle
And you can let StoreKit handle

00:14:29.346 --> 00:14:29.486 A:middle
that.

00:14:30.276 --> 00:14:32.056 A:middle
Now, once a transaction comes

00:14:32.106 --> 00:14:33.416 A:middle
through in the purchase state, I

00:14:33.416 --> 00:14:34.436 A:middle
mentioned that it's important

00:14:34.436 --> 00:14:35.616 A:middle
for you to verify that

00:14:35.616 --> 00:14:36.186 A:middle
transaction.

00:14:36.456 --> 00:14:37.216 A:middle
How do we do that?

00:14:37.216 --> 00:14:38.696 A:middle
How are we sure that money has

00:14:38.696 --> 00:14:39.786 A:middle
actually changed hands?

00:14:39.786 --> 00:14:41.566 A:middle
Well, we use the application

00:14:41.566 --> 00:14:43.776 A:middle
receipt to do this.

00:14:44.136 --> 00:14:45.216 A:middle
This application receipt is

00:14:45.216 --> 00:14:46.386 A:middle
really just like any receipt you

00:14:46.386 --> 00:14:47.486 A:middle
get in the department store.

00:14:47.786 --> 00:14:49.936 A:middle
It's a proof of purchase that is

00:14:49.936 --> 00:14:51.286 A:middle
evidence that the user has

00:14:51.286 --> 00:14:52.276 A:middle
bought something they say

00:14:52.276 --> 00:14:52.816 A:middle
they've bought.

00:14:52.936 --> 00:14:55.316 A:middle
So, in this particular case,

00:14:55.316 --> 00:14:56.976 A:middle
it's a trusted record of the app

00:14:56.976 --> 00:14:58.086 A:middle
and any in-app purchases that

00:14:58.086 --> 00:14:59.096 A:middle
have occurred for a particular

00:14:59.096 --> 00:14:59.616 A:middle
application.

00:15:00.416 --> 00:15:01.556 A:middle
Every app actually has an app

00:15:01.556 --> 00:15:02.596 A:middle
receipt, because it includes

00:15:02.596 --> 00:15:03.906 A:middle
information about initial app

00:15:03.906 --> 00:15:06.116 A:middle
purchases and even information

00:15:06.176 --> 00:15:07.366 A:middle
about the original free app

00:15:07.416 --> 00:15:08.156 A:middle
downloads, as well.

00:15:08.946 --> 00:15:10.556 A:middle
This document's stored on the

00:15:10.556 --> 00:15:12.246 A:middle
user's device, and it's issued

00:15:12.246 --> 00:15:13.376 A:middle
and put there by the App Store.

00:15:14.236 --> 00:15:15.466 A:middle
And it's also a signed and

00:15:15.466 --> 00:15:16.476 A:middle
verifiable document.

00:15:16.476 --> 00:15:17.696 A:middle
So, you can be sure that this is

00:15:17.696 --> 00:15:19.026 A:middle
a document issued by Apple.

00:15:19.206 --> 00:15:20.766 A:middle
And you can use certificates to

00:15:20.766 --> 00:15:22.006 A:middle
actually check that that's the

00:15:22.006 --> 00:15:22.406 A:middle
case.

00:15:23.626 --> 00:15:25.366 A:middle
Finally, it's for your app, on

00:15:25.366 --> 00:15:26.306 A:middle
that device only.

00:15:26.306 --> 00:15:27.756 A:middle
So, this receipt document can't

00:15:27.756 --> 00:15:29.006 A:middle
be shared across devices.

00:15:29.006 --> 00:15:30.396 A:middle
And it can't be shared amongst

00:15:30.396 --> 00:15:31.976 A:middle
applications on the same device.

00:15:33.386 --> 00:15:34.506 A:middle
Now, to be sure that the

00:15:34.506 --> 00:15:35.606 A:middle
document that you're using to

00:15:35.606 --> 00:15:36.796 A:middle
check these transactions is

00:15:36.946 --> 00:15:38.056 A:middle
indeed a valid one, you do what

00:15:38.056 --> 00:15:39.306 A:middle
we call receipt validation.

00:15:40.026 --> 00:15:41.186 A:middle
Receipt validation can be done a

00:15:41.186 --> 00:15:41.946 A:middle
couple of ways.

00:15:42.426 --> 00:15:43.696 A:middle
You can do it directly on the

00:15:43.696 --> 00:15:45.236 A:middle
user's device using on device

00:15:45.236 --> 00:15:45.966 A:middle
validation.

00:15:45.966 --> 00:15:46.906 A:middle
And you can unlock features,

00:15:46.906 --> 00:15:47.416 A:middle
accordingly.

00:15:48.306 --> 00:15:49.746 A:middle
Well, the other way is to use

00:15:49.746 --> 00:15:50.966 A:middle
server to server validation.

00:15:51.046 --> 00:15:52.386 A:middle
So, you can take that encrypted

00:15:52.386 --> 00:15:53.956 A:middle
receipt data, and you can send

00:15:53.956 --> 00:15:54.836 A:middle
it up to your server.

00:15:55.266 --> 00:15:56.526 A:middle
And from there you can send it

00:15:56.526 --> 00:15:57.656 A:middle
over to the App Store server, in

00:15:57.656 --> 00:15:59.066 A:middle
order to perform some of those

00:15:59.066 --> 00:15:59.666 A:middle
checks for you.

00:15:59.666 --> 00:16:02.076 A:middle
We're not going to go into the

00:15:59.666 --> 00:16:02.076 A:middle
We're not going to go into the

00:16:02.076 --> 00:16:03.006 A:middle
details about receipt

00:16:03.006 --> 00:16:03.476 A:middle
validation.

00:16:03.476 --> 00:16:04.616 A:middle
And this talk that's going to be

00:16:04.616 --> 00:16:05.426 A:middle
talked about, again, in the

00:16:05.426 --> 00:16:06.176 A:middle
Advanced Session, this

00:16:06.176 --> 00:16:06.676 A:middle
afternoon.

00:16:06.676 --> 00:16:07.866 A:middle
I'm going to talk about you

00:16:07.866 --> 00:16:08.776 A:middle
know, how to read in this

00:16:08.776 --> 00:16:10.246 A:middle
receipt data from the device.

00:16:10.246 --> 00:16:11.276 A:middle
And also, how to do the server

00:16:11.276 --> 00:16:13.236 A:middle
to server exchanges for that,

00:16:13.236 --> 00:16:13.436 A:middle
too.

00:16:14.416 --> 00:16:16.156 A:middle
But once you've confirmed that

00:16:16.156 --> 00:16:17.236 A:middle
this receipt is an authentic

00:16:17.236 --> 00:16:18.796 A:middle
document, you can go ahead and

00:16:18.796 --> 00:16:20.586 A:middle
read in transactions and ensure

00:16:20.586 --> 00:16:21.696 A:middle
that this transaction that's

00:16:21.696 --> 00:16:22.846 A:middle
come through in this process is

00:16:22.846 --> 00:16:23.786 A:middle
present in the receipt.

00:16:23.786 --> 00:16:24.816 A:middle
And that means that you've got a

00:16:24.816 --> 00:16:26.776 A:middle
valid purchase ready to go ahead

00:16:26.776 --> 00:16:28.976 A:middle
with for the next step.

00:16:29.096 --> 00:16:30.486 A:middle
Which is to unlock the content

00:16:30.486 --> 00:16:31.456 A:middle
for your in-app purchase.

00:16:31.896 --> 00:16:32.706 A:middle
This is, obviously, a pretty

00:16:32.706 --> 00:16:33.276 A:middle
important step.

00:16:34.006 --> 00:16:35.116 A:middle
To make the functionality that

00:16:35.116 --> 00:16:36.396 A:middle
the user's bought, available to

00:16:36.396 --> 00:16:36.746 A:middle
the user.

00:16:37.196 --> 00:16:38.346 A:middle
This is the step where you might

00:16:38.346 --> 00:16:39.776 A:middle
download any additional content

00:16:39.776 --> 00:16:40.686 A:middle
and make it available to the

00:16:40.686 --> 00:16:40.996 A:middle
user.

00:16:41.816 --> 00:16:43.256 A:middle
If you are downloading content

00:16:43.256 --> 00:16:44.176 A:middle
for in-app purchases, there's a

00:16:44.176 --> 00:16:46.976 A:middle
couple of ways you can do this.

00:16:47.176 --> 00:16:48.676 A:middle
Apple actually offers two

00:16:48.676 --> 00:16:50.106 A:middle
techniques for you to use, as

00:16:50.106 --> 00:16:50.456 A:middle
well.

00:16:50.526 --> 00:16:52.306 A:middle
We have on-demand resources,

00:16:52.306 --> 00:16:53.206 A:middle
which is an API that we

00:16:53.206 --> 00:16:54.166 A:middle
introduced a couple of years,

00:16:54.166 --> 00:16:54.416 A:middle
ago.

00:16:54.776 --> 00:16:55.916 A:middle
And we also have what I

00:16:55.916 --> 00:16:56.466 A:middle
mentioned earlier.

00:16:56.466 --> 00:16:57.856 A:middle
The hosted in-app purchase

00:16:58.066 --> 00:16:59.016 A:middle
downloadable content.

00:16:59.016 --> 00:17:00.096 A:middle
So, you can associate

00:16:59.016 --> 00:17:00.096 A:middle
So, you can associate

00:17:00.096 --> 00:17:01.636 A:middle
downloadable content through

00:17:01.686 --> 00:17:03.726 A:middle
iTunes Connect that's accessed

00:17:03.786 --> 00:17:05.406 A:middle
through the SKProduct object,

00:17:05.406 --> 00:17:05.846 A:middle
directly.

00:17:06.566 --> 00:17:07.996 A:middle
Of course, the other way is just

00:17:08.326 --> 00:17:09.386 A:middle
to host the content, yourself,

00:17:09.386 --> 00:17:10.026 A:middle
on your own server.

00:17:10.445 --> 00:17:11.336 A:middle
Which is perfectly okay.

00:17:11.336 --> 00:17:12.556 A:middle
But if you do that, I just

00:17:12.556 --> 00:17:13.506 A:middle
encourage you to remember to use

00:17:13.506 --> 00:17:14.506 A:middle
the appropriate background

00:17:14.705 --> 00:17:15.675 A:middle
downloading APIs.

00:17:15.675 --> 00:17:17.425 A:middle
Use NSURL session to make sure

00:17:17.425 --> 00:17:18.606 A:middle
that these downloads aren't

00:17:18.606 --> 00:17:19.415 A:middle
interrupted, you know, when a

00:17:19.415 --> 00:17:20.945 A:middle
user exits your application.

00:17:22.195 --> 00:17:23.766 A:middle
Once you've unlocked your

00:17:23.766 --> 00:17:25.106 A:middle
content, maybe you've made that

00:17:25.165 --> 00:17:26.576 A:middle
pro version of your application

00:17:26.576 --> 00:17:27.406 A:middle
available to the user.

00:17:28.226 --> 00:17:29.406 A:middle
You can go ahead and finish the

00:17:29.406 --> 00:17:29.956 A:middle
transaction.

00:17:29.956 --> 00:17:30.816 A:middle
This is the last step in

00:17:30.816 --> 00:17:32.056 A:middle
implementing in-app purchases.

00:17:32.606 --> 00:17:34.426 A:middle
So, it's important to finish all

00:17:34.426 --> 00:17:35.656 A:middle
transactions that come through

00:17:35.656 --> 00:17:36.196 A:middle
this process.

00:17:36.196 --> 00:17:37.296 A:middle
Even if they're in like an error

00:17:37.296 --> 00:17:38.606 A:middle
state, you got to finish all

00:17:38.606 --> 00:17:39.726 A:middle
transactions that come through

00:17:39.726 --> 00:17:40.236 A:middle
in this flow.

00:17:40.636 --> 00:17:41.546 A:middle
And that includes when you're

00:17:41.546 --> 00:17:42.546 A:middle
dealing with auto-renewable

00:17:42.546 --> 00:17:43.126 A:middle
subscriptions.

00:17:43.126 --> 00:17:45.406 A:middle
Any renewal transactions that

00:17:45.406 --> 00:17:46.566 A:middle
come in this flow, as well.

00:17:46.566 --> 00:17:48.516 A:middle
So, any of those, billing period

00:17:48.516 --> 00:17:49.906 A:middle
renewals that come through, you

00:17:49.906 --> 00:17:50.886 A:middle
have to make sure you take all

00:17:50.886 --> 00:17:52.216 A:middle
of these through this process to

00:17:52.266 --> 00:17:52.716 A:middle
finish them.

00:17:53.776 --> 00:17:55.566 A:middle
If you don't finish the

00:17:55.566 --> 00:17:56.466 A:middle
transaction, they actually

00:17:56.466 --> 00:17:57.496 A:middle
remain on the payment queue.

00:17:57.496 --> 00:17:58.196 A:middle
And they're going to keep on

00:17:58.256 --> 00:17:59.436 A:middle
popping up in that updated

00:17:59.436 --> 00:18:01.006 A:middle
transactions callback on every

00:17:59.436 --> 00:18:01.006 A:middle
transactions callback on every

00:18:01.006 --> 00:18:01.616 A:middle
app launch.

00:18:01.826 --> 00:18:02.626 A:middle
So, make sure that you are

00:18:02.626 --> 00:18:03.776 A:middle
finishing them properly and

00:18:03.776 --> 00:18:04.796 A:middle
getting them out of that payment

00:18:04.796 --> 00:18:05.026 A:middle
queue.

00:18:05.726 --> 00:18:06.516 A:middle
In fact, when it comes to

00:18:06.516 --> 00:18:07.626 A:middle
auto-renewable subscriptions,

00:18:07.626 --> 00:18:09.646 A:middle
we've got some details around

00:18:09.646 --> 00:18:11.756 A:middle
billing retry that relies on up

00:18:11.756 --> 00:18:13.026 A:middle
to date knowledge around the

00:18:13.026 --> 00:18:14.126 A:middle
state of all these renewal

00:18:14.126 --> 00:18:14.816 A:middle
transactions.

00:18:15.036 --> 00:18:16.066 A:middle
So, It's really important that

00:18:16.066 --> 00:18:18.656 A:middle
you do keep these finished and

00:18:18.656 --> 00:18:19.266 A:middle
up to date.

00:18:20.316 --> 00:18:21.946 A:middle
When it comes to finishing them,

00:18:21.946 --> 00:18:22.846 A:middle
it's actually just one line of

00:18:22.846 --> 00:18:23.096 A:middle
code.

00:18:23.096 --> 00:18:24.426 A:middle
So, there's no excuses.

00:18:24.776 --> 00:18:25.876 A:middle
You just pass the transaction

00:18:25.876 --> 00:18:26.436 A:middle
through to the finished

00:18:26.436 --> 00:18:27.346 A:middle
transaction callback.

00:18:27.666 --> 00:18:28.996 A:middle
This is a API on the

00:18:28.996 --> 00:18:30.326 A:middle
SKPaymentQueue's default queue.

00:18:30.886 --> 00:18:33.406 A:middle
But once you do that, you've

00:18:33.406 --> 00:18:34.916 A:middle
finished the transaction, that's

00:18:34.916 --> 00:18:35.906 A:middle
the last step in actually

00:18:35.906 --> 00:18:36.986 A:middle
implementing the in-app purchase

00:18:36.986 --> 00:18:37.736 A:middle
flow on a device.

00:18:37.736 --> 00:18:39.686 A:middle
So, the user's now got access to

00:18:39.686 --> 00:18:40.546 A:middle
that in-app purchase that

00:18:40.546 --> 00:18:41.156 A:middle
they've paid for.

00:18:42.316 --> 00:18:43.476 A:middle
A couple of tips just while

00:18:43.476 --> 00:18:44.136 A:middle
we're on the subject.

00:18:44.406 --> 00:18:46.056 A:middle
When you're in app review, you

00:18:46.056 --> 00:18:47.576 A:middle
must have a Restore button if

00:18:47.576 --> 00:18:50.376 A:middle
you've got non-consumable or

00:18:50.376 --> 00:18:51.636 A:middle
auto-renewable subscription

00:18:51.636 --> 00:18:52.706 A:middle
products in your application.

00:18:52.706 --> 00:18:54.236 A:middle
And this Restore button has to

00:18:54.236 --> 00:18:55.836 A:middle
be a separate button from the

00:18:55.836 --> 00:18:56.876 A:middle
actual purchase button.

00:18:57.186 --> 00:18:58.096 A:middle
So, it can be somewhere in your

00:18:58.096 --> 00:18:58.806 A:middle
app, maybe buried in your

00:18:58.806 --> 00:18:59.476 A:middle
settings, somewhere.

00:18:59.476 --> 00:19:01.656 A:middle
But it's just a tool to allow

00:18:59.476 --> 00:19:01.656 A:middle
But it's just a tool to allow

00:19:01.656 --> 00:19:02.766 A:middle
users to restore completed

00:19:02.766 --> 00:19:03.366 A:middle
transactions.

00:19:03.366 --> 00:19:04.946 A:middle
And it's not just a backup tool.

00:19:05.156 --> 00:19:06.406 A:middle
You know. People use this all

00:19:06.406 --> 00:19:07.196 A:middle
the time when they're dealing

00:19:07.196 --> 00:19:08.206 A:middle
with maybe a new device.

00:19:08.206 --> 00:19:09.206 A:middle
If they go and buy a new iPad,

00:19:09.206 --> 00:19:10.726 A:middle
and they want to unlock the

00:19:10.726 --> 00:19:12.246 A:middle
content that they've paid for on

00:19:12.246 --> 00:19:12.756 A:middle
their phone.

00:19:13.096 --> 00:19:13.836 A:middle
They use that Restore

00:19:13.836 --> 00:19:15.016 A:middle
Transactions feature to be able

00:19:15.016 --> 00:19:15.466 A:middle
to do that.

00:19:15.466 --> 00:19:16.416 A:middle
So, it's important you have a

00:19:16.416 --> 00:19:17.696 A:middle
Restore Transactions button,

00:19:17.696 --> 00:19:19.216 A:middle
somewhere in your application.

00:19:20.056 --> 00:19:21.166 A:middle
As I mentioned, though, it does

00:19:21.166 --> 00:19:22.436 A:middle
only restore transactions for

00:19:22.436 --> 00:19:23.366 A:middle
non-consumable and

00:19:23.366 --> 00:19:24.816 A:middle
auto-renewable subscription

00:19:24.816 --> 00:19:25.276 A:middle
products.

00:19:25.896 --> 00:19:27.106 A:middle
So, if you're selling consumable

00:19:27.106 --> 00:19:28.206 A:middle
products or non-renewing

00:19:28.206 --> 00:19:29.336 A:middle
subscriptions, you've got to

00:19:29.336 --> 00:19:30.346 A:middle
persist the state of those

00:19:30.346 --> 00:19:31.136 A:middle
things, yourself.

00:19:31.386 --> 00:19:32.246 A:middle
So, maybe you've got a game

00:19:32.246 --> 00:19:33.616 A:middle
account, you might associate it

00:19:33.616 --> 00:19:34.636 A:middle
with that account information

00:19:34.636 --> 00:19:35.676 A:middle
somewhere on your own server.

00:19:35.816 --> 00:19:38.686 A:middle
In order to actually restore

00:19:38.686 --> 00:19:40.066 A:middle
them, this is the API for it.

00:19:40.996 --> 00:19:41.096 A:middle
It's

00:19:41.096 --> 00:19:42.696 A:middle
restoreCompletedTransactions as

00:19:42.696 --> 00:19:43.446 A:middle
the method, and it's on the

00:19:43.446 --> 00:19:44.346 A:middle
default payment queue.

00:19:44.896 --> 00:19:46.406 A:middle
If you call that, that's going

00:19:46.406 --> 00:19:47.686 A:middle
to cause all the completed

00:19:47.686 --> 00:19:49.006 A:middle
transactions in those categories

00:19:49.196 --> 00:19:50.686 A:middle
to reappear on the updated

00:19:50.686 --> 00:19:51.656 A:middle
transactions callback.

00:19:51.996 --> 00:19:52.956 A:middle
So, you can just do the same

00:19:52.956 --> 00:19:54.886 A:middle
process that we just saw, check

00:19:54.886 --> 00:19:55.876 A:middle
for them being in the purchase

00:19:55.876 --> 00:19:57.276 A:middle
state, do receipt validation,

00:19:57.276 --> 00:19:58.296 A:middle
unlock all the features

00:19:58.296 --> 00:19:58.816 A:middle
accordingly.

00:20:00.116 --> 00:20:01.346 A:middle
There's a couple more APIs

00:20:01.346 --> 00:20:02.456 A:middle
around the restoring completed

00:20:02.456 --> 00:20:02.976 A:middle
transactions.

00:20:03.096 --> 00:20:04.356 A:middle
You can understand if it's

00:20:04.356 --> 00:20:05.516 A:middle
finished or if there was an

00:20:05.516 --> 00:20:06.716 A:middle
error with a particular process.

00:20:06.766 --> 00:20:08.466 A:middle
But the real thing to do, here,

00:20:08.466 --> 00:20:09.356 A:middle
is just if you have a

00:20:09.356 --> 00:20:10.696 A:middle
transaction observer registered

00:20:10.696 --> 00:20:11.836 A:middle
early on in your application.

00:20:11.836 --> 00:20:13.056 A:middle
You can just handle all of these

00:20:13.056 --> 00:20:14.106 A:middle
transactions as they come

00:20:14.106 --> 00:20:15.366 A:middle
through that updated

00:20:15.366 --> 00:20:16.366 A:middle
transactions callback.

00:20:18.276 --> 00:20:20.316 A:middle
So, just to summarize this

00:20:20.316 --> 00:20:21.316 A:middle
process that we just talked

00:20:21.316 --> 00:20:21.656 A:middle
about.

00:20:21.656 --> 00:20:22.876 A:middle
Always observe the payment queue

00:20:22.876 --> 00:20:23.786 A:middle
and make sure you're doing it as

00:20:23.786 --> 00:20:25.176 A:middle
early on in your application

00:20:25.176 --> 00:20:27.476 A:middle
lifecycle, as possible.

00:20:27.476 --> 00:20:28.756 A:middle
Use an SKProducts request to

00:20:28.756 --> 00:20:30.546 A:middle
request localized information

00:20:30.776 --> 00:20:31.876 A:middle
about the products from the App

00:20:31.876 --> 00:20:32.266 A:middle
Store.

00:20:32.516 --> 00:20:33.386 A:middle
And use that to display

00:20:33.386 --> 00:20:34.946 A:middle
localized pricing information.

00:20:35.266 --> 00:20:36.246 A:middle
Use that technique we just saw

00:20:36.246 --> 00:20:37.156 A:middle
with the number formatter, to

00:20:37.156 --> 00:20:38.816 A:middle
make sure that your price is

00:20:38.816 --> 00:20:40.196 A:middle
being displayed in the user's

00:20:40.906 --> 00:20:42.056 A:middle
store locale.

00:20:42.206 --> 00:20:44.996 A:middle
Use the receipt to actually

00:20:44.996 --> 00:20:46.276 A:middle
validate that the purchase has

00:20:46.276 --> 00:20:47.106 A:middle
taken place.

00:20:47.696 --> 00:20:49.256 A:middle
This is an important security

00:20:49.256 --> 00:20:50.506 A:middle
step and we'll talk a bit more

00:20:50.506 --> 00:20:51.476 A:middle
about that, this afternoon.

00:20:51.576 --> 00:20:53.176 A:middle
You got to remember to make the

00:20:53.176 --> 00:20:54.526 A:middle
content available to the user.

00:20:54.526 --> 00:20:55.566 A:middle
So, make sure they get what

00:20:55.566 --> 00:20:56.186 A:middle
they've paid for.

00:20:57.326 --> 00:20:59.186 A:middle
And then, finish the transaction

00:20:59.186 --> 00:21:00.306 A:middle
at the end of this process.

00:20:59.186 --> 00:21:00.306 A:middle
at the end of this process.

00:21:00.416 --> 00:21:01.096 A:middle
Make sure that you call

00:21:01.096 --> 00:21:02.376 A:middle
finishTransaction and pass in

00:21:02.376 --> 00:21:03.366 A:middle
that transaction object.

00:21:03.706 --> 00:21:04.616 A:middle
And then, somewhere in your app,

00:21:04.846 --> 00:21:06.376 A:middle
have a Restore button to allow

00:21:06.376 --> 00:21:08.026 A:middle
users to restore completed

00:21:08.026 --> 00:21:09.676 A:middle
transactions onto that device.

00:21:10.596 --> 00:21:11.616 A:middle
So, that's a bit about

00:21:11.956 --> 00:21:13.236 A:middle
implementing in-app purchases

00:21:13.406 --> 00:21:14.236 A:middle
and that process.

00:21:14.896 --> 00:21:16.486 A:middle
Next, we're going to discuss the

00:21:16.486 --> 00:21:17.836 A:middle
new ability to promote in-app

00:21:18.106 --> 00:21:19.346 A:middle
purchases, directly in the App

00:21:19.346 --> 00:21:19.886 A:middle
Store app.

00:21:20.146 --> 00:21:21.126 A:middle
And to talk a bit more about

00:21:21.126 --> 00:21:22.246 A:middle
that, I'd like to invite Ross

00:21:22.246 --> 00:21:23.346 A:middle
LeBeau up onto the stage.

00:21:24.516 --> 00:21:32.946 A:middle
[ Applause ]

00:21:33.446 --> 00:21:34.386 A:middle
&gt;&gt; Hi. I'm Ross.

00:21:34.386 --> 00:21:36.046 A:middle
I'm an engineer on the App Store

00:21:36.046 --> 00:21:36.306 A:middle
team.

00:21:37.156 --> 00:21:38.646 A:middle
And today, I'm excited to tell

00:21:38.646 --> 00:21:39.686 A:middle
you about our latest addition to

00:21:39.686 --> 00:21:40.206 A:middle
the App Store.

00:21:41.376 --> 00:21:42.336 A:middle
It's called Promoting In-App

00:21:42.336 --> 00:21:42.906 A:middle
Purchases.

00:21:43.446 --> 00:21:44.546 A:middle
And it's a great way to reach an

00:21:44.546 --> 00:21:45.426 A:middle
even wider audience with

00:21:45.426 --> 00:21:46.226 A:middle
everything your app has to

00:21:46.226 --> 00:21:46.546 A:middle
offer.

00:21:49.166 --> 00:21:50.716 A:middle
So, before today, if a user

00:21:50.716 --> 00:21:51.926 A:middle
wasn't actively using your app,

00:21:52.436 --> 00:21:53.256 A:middle
your in-app purchases were

00:21:53.256 --> 00:21:54.066 A:middle
pretty hard to find.

00:21:55.496 --> 00:21:57.496 A:middle
But starting in iOS 11, your

00:21:57.496 --> 00:21:58.276 A:middle
in-app purchases will be

00:21:58.276 --> 00:21:59.446 A:middle
discoverable, right in the App

00:21:59.446 --> 00:21:59.716 A:middle
Store.

00:22:00.806 --> 00:22:01.716 A:middle
They'll be visible on your app

00:22:01.716 --> 00:22:02.036 A:middle
page.

00:22:03.206 --> 00:22:03.916 A:middle
They'll be eligible for

00:22:03.956 --> 00:22:04.736 A:middle
editorial feature.

00:22:05.726 --> 00:22:06.566 A:middle
And they can even show up in

00:22:06.566 --> 00:22:07.256 A:middle
search results.

00:22:08.686 --> 00:22:10.486 A:middle
Not only that, but users will be

00:22:10.486 --> 00:22:11.896 A:middle
able to begin a purchase right

00:22:11.896 --> 00:22:12.866 A:middle
from the App Store itself.

00:22:14.466 --> 00:22:15.376 A:middle
We think this will be a huge

00:22:15.376 --> 00:22:16.596 A:middle
improvement to how users view

00:22:16.596 --> 00:22:17.436 A:middle
your in-app purchases.

00:22:19.666 --> 00:22:20.496 A:middle
So, how does it all work?

00:22:21.686 --> 00:22:22.916 A:middle
Well, promoting your in-app

00:22:22.916 --> 00:22:23.896 A:middle
purchases is easy.

00:22:24.386 --> 00:22:25.746 A:middle
You'll need to do to things.

00:22:26.946 --> 00:22:28.886 A:middle
First, choose up to 20 in-app

00:22:28.886 --> 00:22:30.656 A:middle
purchases to promote per app,

00:22:31.016 --> 00:22:32.046 A:middle
and set them up in iTunes

00:22:32.046 --> 00:22:33.056 A:middle
Connect with an accompanying

00:22:33.056 --> 00:22:33.426 A:middle
image.

00:22:34.466 --> 00:22:35.736 A:middle
Then, implement a single

00:22:35.736 --> 00:22:37.106 A:middle
delegate method in your app to

00:22:37.106 --> 00:22:38.306 A:middle
handle the purchase info sent to

00:22:38.306 --> 00:22:39.096 A:middle
you from the App Store.

00:22:39.776 --> 00:22:41.236 A:middle
In most cases, this

00:22:41.236 --> 00:22:42.356 A:middle
implementation can be just a

00:22:42.356 --> 00:22:43.396 A:middle
single line of code, and

00:22:43.396 --> 00:22:44.386 A:middle
StoreKit will handle the rest of

00:22:44.386 --> 00:22:45.316 A:middle
the transaction for you.

00:22:47.136 --> 00:22:51.906 A:middle
Also, if you want, you can

00:22:52.146 --> 00:22:53.046 A:middle
override the order and

00:22:53.046 --> 00:22:54.306 A:middle
visibility that they show up in,

00:22:54.546 --> 00:22:55.006 A:middle
locally.

00:22:56.056 --> 00:22:57.316 A:middle
Now, this isn't required, but it

00:22:57.316 --> 00:22:58.266 A:middle
can be useful in a variety of

00:22:58.266 --> 00:22:59.006 A:middle
situations.

00:22:59.566 --> 00:23:02.196 A:middle
So, we've already gone into

00:22:59.566 --> 00:23:02.196 A:middle
So, we've already gone into

00:23:02.196 --> 00:23:03.456 A:middle
detail on how to do the iTunes

00:23:03.456 --> 00:23:04.706 A:middle
Connect setup in the What's New

00:23:04.706 --> 00:23:05.796 A:middle
in iTunes Connect session.

00:23:06.116 --> 00:23:06.826 A:middle
That was yesterday.

00:23:07.186 --> 00:23:07.986 A:middle
If you missed it, you can just

00:23:07.986 --> 00:23:08.656 A:middle
catch it online.

00:23:09.326 --> 00:23:11.156 A:middle
But for now, let's dive in and

00:23:11.156 --> 00:23:12.016 A:middle
take a look at handling your

00:23:12.016 --> 00:23:13.156 A:middle
transaction info when it's sent

00:23:13.156 --> 00:23:13.896 A:middle
to you from the App Store.

00:23:17.316 --> 00:23:18.696 A:middle
So, a user has clicked to

00:23:18.696 --> 00:23:19.606 A:middle
purchase one of your in-app

00:23:19.606 --> 00:23:20.586 A:middle
purchases in the App Store.

00:23:22.066 --> 00:23:23.456 A:middle
StoreKit will automatically open

00:23:23.456 --> 00:23:25.146 A:middle
your app and send information

00:23:25.146 --> 00:23:26.946 A:middle
about the transaction to you via

00:23:26.946 --> 00:23:28.286 A:middle
a new delegate method on the

00:23:28.286 --> 00:23:29.756 A:middle
SKPaymentTransaction observer

00:23:29.756 --> 00:23:30.196 A:middle
protocol.

00:23:30.196 --> 00:23:31.966 A:middle
Now, you already have an object

00:23:32.026 --> 00:23:33.106 A:middle
implementing this protocol,

00:23:33.236 --> 00:23:34.346 A:middle
doing things like observing a

00:23:34.346 --> 00:23:35.626 A:middle
transaction state, as Pete was

00:23:35.626 --> 00:23:36.336 A:middle
talking about earlier.

00:23:37.156 --> 00:23:38.506 A:middle
So, you can put your new code

00:23:38.506 --> 00:23:39.676 A:middle
for promoting in-app purchases

00:23:39.826 --> 00:23:40.636 A:middle
right next to your already

00:23:40.636 --> 00:23:41.226 A:middle
existing code.

00:23:43.116 --> 00:23:44.386 A:middle
It's good to know that if your

00:23:44.386 --> 00:23:45.686 A:middle
app isn't already installed, the

00:23:46.186 --> 00:23:48.196 A:middle
App Store will download or

00:23:48.196 --> 00:23:49.416 A:middle
prompt the user to buy it.

00:23:49.876 --> 00:23:50.936 A:middle
In this case, it can't be opened

00:23:50.936 --> 00:23:52.276 A:middle
automatically, so instead, the

00:23:52.426 --> 00:23:53.266 A:middle
user will receive a

00:23:53.266 --> 00:23:53.956 A:middle
notification.

00:23:54.376 --> 00:23:55.836 A:middle
And when they tap on that, then

00:23:55.836 --> 00:23:57.006 A:middle
your app will open and be sent

00:23:57.006 --> 00:23:57.926 A:middle
the transaction info.

00:24:01.216 --> 00:24:03.146 A:middle
So, what's the code look like?

00:24:04.236 --> 00:24:06.296 A:middle
Well, this is all the new code

00:24:06.296 --> 00:24:07.076 A:middle
you need to get started

00:24:07.076 --> 00:24:08.216 A:middle
promoting in-app purchases.

00:24:09.586 --> 00:24:10.466 A:middle
StoreKit will send you the

00:24:10.466 --> 00:24:12.366 A:middle
SKPayment queue, the SKPayment,

00:24:12.456 --> 00:24:13.296 A:middle
and the SKProduct.

00:24:13.506 --> 00:24:14.326 A:middle
Which is everything you need to

00:24:14.326 --> 00:24:15.156 A:middle
handle the transaction.

00:24:15.706 --> 00:24:16.766 A:middle
And the SKPayment will already

00:24:16.766 --> 00:24:18.056 A:middle
be set up with the SKProduct on

00:24:18.056 --> 00:24:18.123 A:middle
it.

00:24:19.826 --> 00:24:21.956 A:middle
When you return true, the user

00:24:21.956 --> 00:24:23.196 A:middle
will be shown that nice new

00:24:23.196 --> 00:24:24.186 A:middle
in-app purchase payment sheet,

00:24:24.696 --> 00:24:25.366 A:middle
so they can complete the

00:24:25.366 --> 00:24:25.966 A:middle
transaction.

00:24:26.246 --> 00:24:26.806 A:middle
And that's it.

00:24:26.976 --> 00:24:27.336 A:middle
We're done.

00:24:27.936 --> 00:24:28.426 A:middle
Time to ship it.

00:24:30.606 --> 00:24:31.056 A:middle
Oh, all right.

00:24:31.056 --> 00:24:32.266 A:middle
Well, what if the user is in the

00:24:32.266 --> 00:24:33.046 A:middle
middle of onboarding?

00:24:33.046 --> 00:24:34.446 A:middle
Or if they're creating an

00:24:34.446 --> 00:24:34.776 A:middle
account?

00:24:34.776 --> 00:24:36.246 A:middle
Or if they've already unlocked

00:24:36.246 --> 00:24:38.976 A:middle
the item they're trying to buy?

00:24:39.926 --> 00:24:41.496 A:middle
Well, in this case, you can hold

00:24:41.496 --> 00:24:42.636 A:middle
onto the payment and return

00:24:42.636 --> 00:24:43.116 A:middle
false.

00:24:44.356 --> 00:24:45.376 A:middle
Then, when the user is done

00:24:45.376 --> 00:24:46.326 A:middle
onboarding or whatever they

00:24:46.326 --> 00:24:48.366 A:middle
needed to do, simply add the

00:24:48.366 --> 00:24:49.496 A:middle
payment to the payment queue as

00:24:49.496 --> 00:24:50.506 A:middle
you would with a normal in-app

00:24:50.506 --> 00:24:50.926 A:middle
purchase.

00:24:52.216 --> 00:24:53.516 A:middle
It's important that you add the

00:24:53.516 --> 00:24:54.556 A:middle
SKPayment that was sent to you

00:24:54.556 --> 00:24:55.796 A:middle
in this delegate method and not

00:24:55.796 --> 00:24:56.786 A:middle
create a new one with the same

00:24:56.786 --> 00:24:57.206 A:middle
product.

00:24:58.686 --> 00:24:59.686 A:middle
If for some reason you need to

00:24:59.686 --> 00:25:01.036 A:middle
cancel the transaction entirely,

00:24:59.686 --> 00:25:01.036 A:middle
cancel the transaction entirely,

00:25:01.766 --> 00:25:03.056 A:middle
just return false and no other

00:25:03.056 --> 00:25:03.876 A:middle
action is required.

00:25:04.596 --> 00:25:07.656 A:middle
If you're going to cancel or

00:25:07.656 --> 00:25:09.226 A:middle
defer a payment, you should

00:25:09.226 --> 00:25:10.306 A:middle
definitely consider letting the

00:25:10.306 --> 00:25:11.216 A:middle
user know, in some way.

00:25:12.086 --> 00:25:13.166 A:middle
What you don't want, is for the

00:25:13.166 --> 00:25:14.626 A:middle
user to tap on the in-app

00:25:14.656 --> 00:25:16.266 A:middle
purchase in the App Store, be

00:25:16.266 --> 00:25:17.306 A:middle
brought to your app, and then,

00:25:17.306 --> 00:25:17.946 A:middle
nothing happens.

00:25:18.756 --> 00:25:19.596 A:middle
They're going to think there's a

00:25:19.596 --> 00:25:22.976 A:middle
bug, and that's not good.

00:25:24.026 --> 00:25:25.316 A:middle
Okay. So, now you've got this

00:25:25.316 --> 00:25:25.756 A:middle
all set up.

00:25:25.886 --> 00:25:26.876 A:middle
You want to test it.

00:25:26.876 --> 00:25:29.016 A:middle
Right. Well, your in-app

00:25:29.016 --> 00:25:30.446 A:middle
purchases won't actually show up

00:25:30.446 --> 00:25:31.756 A:middle
in the App Store, until you've

00:25:31.756 --> 00:25:34.076 A:middle
submitted a binary that has this

00:25:34.076 --> 00:25:34.876 A:middle
delegate method.

00:25:34.926 --> 00:25:36.036 A:middle
So, we know you can handle the

00:25:36.236 --> 00:25:36.956 A:middle
transactions.

00:25:38.586 --> 00:25:39.946 A:middle
So, instead, we've created a

00:25:39.946 --> 00:25:41.206 A:middle
system URL for you to use.

00:25:42.466 --> 00:25:44.106 A:middle
This URL has the ITMS services

00:25:44.136 --> 00:25:45.726 A:middle
protocol and three parameters.

00:25:46.466 --> 00:25:47.786 A:middle
The first parameter is action,

00:25:47.786 --> 00:25:48.806 A:middle
and that's always purchase

00:25:48.806 --> 00:25:49.116 A:middle
intent.

00:25:50.316 --> 00:25:51.526 A:middle
The next parameter is bundleID,

00:25:51.526 --> 00:25:52.646 A:middle
which is of course, the bundle

00:25:52.646 --> 00:25:53.246 A:middle
ID for your app.

00:25:53.246 --> 00:25:55.096 A:middle
And the last one is

00:25:55.146 --> 00:25:56.156 A:middle
productIdentifier, which you

00:25:56.156 --> 00:25:57.026 A:middle
fill in with the product

00:25:57.026 --> 00:25:58.316 A:middle
identifier of the in-app

00:25:58.316 --> 00:25:59.236 A:middle
purchase you want to test.

00:26:01.386 --> 00:26:02.476 A:middle
And once you've constructed this

00:26:02.476 --> 00:26:04.486 A:middle
URL like so, you can simple send

00:26:04.486 --> 00:26:06.546 A:middle
it to yourself in an iMessage or

00:26:06.546 --> 00:26:08.196 A:middle
an email, and tap it on your

00:26:08.196 --> 00:26:08.666 A:middle
device.

00:26:09.856 --> 00:26:10.926 A:middle
You'll now it's working, because

00:26:10.926 --> 00:26:11.686 A:middle
your app will be opened

00:26:11.686 --> 00:26:12.246 A:middle
automatically.

00:26:13.096 --> 00:26:14.236 A:middle
And you can test its behavior

00:26:14.236 --> 00:26:14.556 A:middle
from there.

00:26:17.926 --> 00:26:19.266 A:middle
All right.

00:26:19.266 --> 00:26:20.746 A:middle
Now, we've gone over how to

00:26:20.746 --> 00:26:21.926 A:middle
handle the payment info when

00:26:21.926 --> 00:26:22.596 A:middle
it's sent to you from the App

00:26:22.596 --> 00:26:22.856 A:middle
Store.

00:26:23.856 --> 00:26:25.126 A:middle
Let's take a look at the more

00:26:25.126 --> 00:26:25.756 A:middle
advanced setup.

00:26:28.386 --> 00:26:29.666 A:middle
When you set up your promoted

00:26:29.666 --> 00:26:30.656 A:middle
in-app purchases in iTunes

00:26:30.686 --> 00:26:32.236 A:middle
Connect, you'll be able to

00:26:32.236 --> 00:26:34.236 A:middle
choose a default order that they

00:26:34.236 --> 00:26:35.436 A:middle
appear in on your app page.

00:26:36.126 --> 00:26:37.216 A:middle
You'll also be able to choose to

00:26:37.216 --> 00:26:38.476 A:middle
set some to hidden, so that they

00:26:38.476 --> 00:26:39.106 A:middle
don't appear, at all.

00:26:40.386 --> 00:26:41.506 A:middle
Then, when your app is running

00:26:41.506 --> 00:26:43.696 A:middle
on the device, you can set

00:26:43.696 --> 00:26:45.316 A:middle
overrides for these, locally, to

00:26:45.316 --> 00:26:46.546 A:middle
change the order of visibility.

00:26:47.886 --> 00:26:49.336 A:middle
So, for example, if you're

00:26:49.336 --> 00:26:51.266 A:middle
making a racing game you may

00:26:51.266 --> 00:26:52.486 A:middle
want to hide in-app purchases

00:26:52.486 --> 00:26:53.776 A:middle
for a car until the user has

00:26:53.776 --> 00:26:54.816 A:middle
actually unlocked that car.

00:26:55.786 --> 00:26:59.336 A:middle
Then, when they do, you can move

00:26:59.336 --> 00:27:00.716 A:middle
that in-app purchase to the top

00:26:59.336 --> 00:27:00.716 A:middle
that in-app purchase to the top

00:27:00.716 --> 00:27:02.016 A:middle
of the list and unhide it.

00:27:02.766 --> 00:27:03.536 A:middle
So, they've just unlocked the

00:27:03.536 --> 00:27:04.956 A:middle
car, and now they'll see the

00:27:04.956 --> 00:27:06.216 A:middle
most relevant in-app purchase

00:27:06.216 --> 00:27:07.256 A:middle
right at the front of the list.

00:27:08.906 --> 00:27:09.936 A:middle
it's important to know that

00:27:09.936 --> 00:27:11.326 A:middle
these are not synched across the

00:27:11.326 --> 00:27:11.696 A:middle
bases.

00:27:11.726 --> 00:27:13.926 A:middle
They're stored locally on each

00:27:14.596 --> 00:27:14.816 A:middle
device.

00:27:15.836 --> 00:27:16.996 A:middle
So, if you need to replicate the

00:27:16.996 --> 00:27:18.426 A:middle
same behavior, you should make

00:27:18.426 --> 00:27:20.126 A:middle
sure that your app locally can

00:27:20.306 --> 00:27:21.236 A:middle
reproduce the results.

00:27:21.266 --> 00:27:24.726 A:middle
All right.

00:27:24.726 --> 00:27:25.866 A:middle
Let's take a look at some

00:27:25.866 --> 00:27:26.916 A:middle
specific examples.

00:27:27.836 --> 00:27:30.706 A:middle
Here, we have an app called

00:27:30.706 --> 00:27:31.616 A:middle
Forest Explorer.

00:27:31.786 --> 00:27:33.546 A:middle
This is an app we made up that

00:27:33.546 --> 00:27:35.416 A:middle
helps people discover and travel

00:27:35.416 --> 00:27:37.746 A:middle
to destinations.

00:27:37.746 --> 00:27:41.206 A:middle
This app doesn't exist in the

00:27:41.206 --> 00:27:41.606 A:middle
App Store.

00:27:41.776 --> 00:27:42.786 A:middle
It's only this presentation.

00:27:43.876 --> 00:27:45.106 A:middle
So, here we're promoting three

00:27:45.106 --> 00:27:45.786 A:middle
app purchases.

00:27:45.786 --> 00:27:46.946 A:middle
We have the Pro Subscription,

00:27:47.276 --> 00:27:48.246 A:middle
which upgrades the level of

00:27:48.246 --> 00:27:49.706 A:middle
detail the user sees and maps

00:27:49.706 --> 00:27:50.256 A:middle
and directions.

00:27:51.146 --> 00:27:52.856 A:middle
We have the Fishing Hotspots and

00:27:52.856 --> 00:27:53.876 A:middle
the Hidden Beaches packs.

00:27:54.216 --> 00:27:55.216 A:middle
Which simply unlock more

00:27:55.216 --> 00:27:56.596 A:middle
destinations that follow those

00:27:56.596 --> 00:27:57.006 A:middle
themes.

00:27:58.756 --> 00:28:00.756 A:middle
So, one thing you may want to do

00:27:58.756 --> 00:28:00.756 A:middle
So, one thing you may want to do

00:28:00.756 --> 00:28:02.576 A:middle
is, say a user has purchased the

00:28:02.616 --> 00:28:03.576 A:middle
Pro Subscription in-app

00:28:03.636 --> 00:28:06.166 A:middle
purchase, is hide this from your

00:28:06.166 --> 00:28:06.696 A:middle
app page.

00:28:06.936 --> 00:28:08.376 A:middle
So, this is not something that

00:28:08.376 --> 00:28:09.356 A:middle
StoreKit or the App Store does,

00:28:09.356 --> 00:28:09.986 A:middle
automatically.

00:28:10.736 --> 00:28:12.316 A:middle
If they buy this and then, go to

00:28:12.316 --> 00:28:13.556 A:middle
the App Store, they'll still see

00:28:13.556 --> 00:28:14.366 A:middle
it there on your list.

00:28:15.246 --> 00:28:16.276 A:middle
Which might not make sense,

00:28:16.316 --> 00:28:17.046 A:middle
because they can't buy it,

00:28:17.046 --> 00:28:17.366 A:middle
again.

00:28:18.596 --> 00:28:19.806 A:middle
So, instead, what you can do is

00:28:19.876 --> 00:28:21.116 A:middle
use the local visibility

00:28:21.116 --> 00:28:23.716 A:middle
override to hide the app

00:28:23.716 --> 00:28:24.136 A:middle
purchase.

00:28:24.286 --> 00:28:25.446 A:middle
And then, they'll only see items

00:28:25.446 --> 00:28:26.336 A:middle
that are relevant to them on

00:28:26.336 --> 00:28:26.966 A:middle
your app page.

00:28:29.876 --> 00:28:30.726 A:middle
So, what's the code look like

00:28:30.726 --> 00:28:30.976 A:middle
for this?

00:28:34.756 --> 00:28:35.256 A:middle
Here it is.

00:28:35.406 --> 00:28:37.256 A:middle
First, you want to start by

00:28:37.336 --> 00:28:38.836 A:middle
fetching the SKProduct so you

00:28:38.836 --> 00:28:39.606 A:middle
have the most up to date

00:28:39.606 --> 00:28:40.626 A:middle
information from the server.

00:28:41.236 --> 00:28:42.406 A:middle
Here, we'll fetch the info for

00:28:42.406 --> 00:28:43.406 A:middle
the Pro Subscription in-app

00:28:43.406 --> 00:28:43.826 A:middle
purchase.

00:28:45.626 --> 00:28:47.766 A:middle
Then, we have a new class for

00:28:47.766 --> 00:28:48.756 A:middle
dealing with these local

00:28:48.756 --> 00:28:49.746 A:middle
overrides called

00:28:49.916 --> 00:28:51.306 A:middle
SKProductStorePromotion

00:28:51.306 --> 00:28:51.806 A:middle
Controller.

00:28:52.906 --> 00:28:53.876 A:middle
You'll want to get the default

00:28:53.876 --> 00:28:54.336 A:middle
controller.

00:28:56.056 --> 00:28:57.466 A:middle
And then, passing your SKProduct

00:28:57.586 --> 00:28:58.326 A:middle
to the update

00:28:58.326 --> 00:28:59.576 A:middle
StorePromotionVisibility

00:28:59.636 --> 00:29:00.376 A:middle
forProduct method.

00:28:59.636 --> 00:29:00.376 A:middle
forProduct method.

00:29:00.906 --> 00:29:01.996 A:middle
Along with the new visibility

00:29:01.996 --> 00:29:02.696 A:middle
you want to set it to.

00:29:03.506 --> 00:29:04.606 A:middle
So, here we want to hide the Pro

00:29:04.606 --> 00:29:05.706 A:middle
Subscription, since the user

00:29:05.706 --> 00:29:06.416 A:middle
just purchased it.

00:29:08.466 --> 00:29:09.346 A:middle
That's all there is to it.

00:29:09.416 --> 00:29:09.856 A:middle
Pretty simple.

00:29:11.456 --> 00:29:12.366 A:middle
Now, if you want to check to see

00:29:12.366 --> 00:29:13.456 A:middle
what overrides you've already

00:29:15.756 --> 00:29:17.556 A:middle
set, start again by fetching the

00:29:17.646 --> 00:29:18.176 A:middle
SKProduct.

00:29:18.526 --> 00:29:19.416 A:middle
Here, we'll look at the Hidden

00:29:19.416 --> 00:29:19.876 A:middle
Beaches pack.

00:29:21.426 --> 00:29:22.606 A:middle
So, pass this into the fetch

00:29:22.606 --> 00:29:24.006 A:middle
StorePromotionVisibilityFor

00:29:24.006 --> 00:29:24.656 A:middle
Product method.

00:29:24.956 --> 00:29:27.256 A:middle
And what we can see here, is the

00:29:27.256 --> 00:29:28.726 A:middle
visibility is done, default.

00:29:29.116 --> 00:29:30.076 A:middle
Now, this is because we haven't

00:29:30.076 --> 00:29:31.046 A:middle
set any overrides, yet.

00:29:31.046 --> 00:29:32.726 A:middle
And it means that it will be

00:29:32.726 --> 00:29:34.056 A:middle
hidden or shown based on what

00:29:34.056 --> 00:29:35.186 A:middle
you've set as a default in

00:29:35.216 --> 00:29:35.856 A:middle
iTunes Connect.

00:29:39.766 --> 00:29:41.016 A:middle
Okay. So, we've talked about

00:29:41.116 --> 00:29:42.126 A:middle
overriding the visibility.

00:29:42.606 --> 00:29:43.776 A:middle
How about changing the order

00:29:43.776 --> 00:29:44.666 A:middle
that your in-app purchases

00:29:44.666 --> 00:29:45.706 A:middle
appear in on your app page?

00:29:47.806 --> 00:29:48.656 A:middle
Let's go back to Forest

00:29:48.656 --> 00:29:49.156 A:middle
Explorer.

00:29:51.216 --> 00:29:52.826 A:middle
Now, maybe you've been looking

00:29:52.826 --> 00:29:54.136 A:middle
at your metrics, and you notice

00:29:54.176 --> 00:29:55.636 A:middle
that this user is going to a lot

00:29:55.636 --> 00:29:56.146 A:middle
of beaches.

00:29:57.426 --> 00:29:58.616 A:middle
Could make sense to move the

00:29:58.616 --> 00:29:59.916 A:middle
Hidden Beaches back to the front

00:29:59.916 --> 00:30:01.776 A:middle
of the list so that they're more

00:29:59.916 --> 00:30:01.776 A:middle
of the list so that they're more

00:30:01.776 --> 00:30:02.446 A:middle
likely to see it.

00:30:02.996 --> 00:30:04.056 A:middle
And since it's something that's

00:30:04.056 --> 00:30:05.216 A:middle
interesting to them, they might

00:30:05.216 --> 00:30:05.976 A:middle
be more likely to buy it.

00:30:10.426 --> 00:30:11.336 A:middle
Now, the code for this looks

00:30:11.336 --> 00:30:12.936 A:middle
very similar to updating

00:30:13.166 --> 00:30:14.036 A:middle
visibility overrides.

00:30:14.996 --> 00:30:16.166 A:middle
You'll want to fetch the

00:30:16.166 --> 00:30:17.996 A:middle
SKProducts for every in-app

00:30:17.996 --> 00:30:18.966 A:middle
purchase you want to override

00:30:18.966 --> 00:30:20.136 A:middle
the order of, so here we'll do

00:30:20.136 --> 00:30:20.556 A:middle
all three.

00:30:20.556 --> 00:30:21.676 A:middle
We'll do the Pro Subscription,

00:30:21.856 --> 00:30:23.326 A:middle
Fishing Hotspots, and the Hidden

00:30:23.326 --> 00:30:23.706 A:middle
Beaches.

00:30:24.866 --> 00:30:26.976 A:middle
Then, create an array that has

00:30:26.976 --> 00:30:28.306 A:middle
these in-app purchases in the

00:30:28.306 --> 00:30:29.406 A:middle
order that you want to override

00:30:29.406 --> 00:30:30.016 A:middle
them to be.

00:30:30.626 --> 00:30:31.616 A:middle
So, move the Hidden Beaches to

00:30:31.616 --> 00:30:31.976 A:middle
the front.

00:30:33.796 --> 00:30:35.566 A:middle
Finally, pass this array into

00:30:35.566 --> 00:30:36.956 A:middle
the updateStorePromotionOrder

00:30:36.956 --> 00:30:37.256 A:middle
method.

00:30:37.886 --> 00:30:39.376 A:middle
And there you go.

00:30:39.376 --> 00:30:39.986 A:middle
It's been updated.

00:30:39.986 --> 00:30:43.736 A:middle
Now, if we want to view the

00:30:43.736 --> 00:30:44.636 A:middle
overrides we may have set,

00:30:44.636 --> 00:30:44.986 A:middle
already.

00:30:45.936 --> 00:30:47.326 A:middle
Once again, it's very similar.

00:30:48.446 --> 00:30:49.116 A:middle
Grab the default

00:30:49.116 --> 00:30:50.736 A:middle
storePromotionController and

00:30:50.736 --> 00:30:51.256 A:middle
simply use the

00:30:51.326 --> 00:30:52.326 A:middle
fetchStorePromotionalOrder

00:30:52.326 --> 00:30:52.696 A:middle
method.

00:30:54.396 --> 00:30:56.696 A:middle
Here, we can see that we get an

00:30:56.696 --> 00:30:57.856 A:middle
array back and Hidden Beaches is

00:30:57.856 --> 00:30:59.096 A:middle
in front, since we've just set

00:30:59.096 --> 00:30:59.706 A:middle
that override.

00:31:01.786 --> 00:31:03.926 A:middle
Now, you don't need to use every

00:31:03.926 --> 00:31:04.976 A:middle
in-app purchase in your array

00:31:04.976 --> 00:31:05.886 A:middle
when you set the overrides.

00:31:06.006 --> 00:31:07.436 A:middle
You can actually use any subset

00:31:07.436 --> 00:31:08.266 A:middle
of them that you want.

00:31:08.996 --> 00:31:10.216 A:middle
If you do, what'll happen is

00:31:10.296 --> 00:31:11.826 A:middle
that subset will be shown at the

00:31:11.826 --> 00:31:14.126 A:middle
front of the list in the order

00:31:14.126 --> 00:31:15.226 A:middle
you've specified the override

00:31:15.226 --> 00:31:15.536 A:middle
for.

00:31:16.176 --> 00:31:16.926 A:middle
The rest of your in-app

00:31:16.926 --> 00:31:18.746 A:middle
purchases will be shown after

00:31:18.746 --> 00:31:20.056 A:middle
those, in the same relative

00:31:20.056 --> 00:31:21.096 A:middle
order as you've set in iTunes

00:31:21.096 --> 00:31:21.326 A:middle
Connect.

00:31:23.116 --> 00:31:24.476 A:middle
Also, you can receive an empty

00:31:24.476 --> 00:31:25.266 A:middle
array from this method.

00:31:25.706 --> 00:31:26.686 A:middle
This would mean that you haven't

00:31:26.686 --> 00:31:28.136 A:middle
set any order overrides, at all.

00:31:29.016 --> 00:31:30.366 A:middle
And similarly, you could pass in

00:31:30.366 --> 00:31:32.236 A:middle
an empty array to the update

00:31:32.236 --> 00:31:32.596 A:middle
method.

00:31:32.806 --> 00:31:34.066 A:middle
And that would be the same as

00:31:34.556 --> 00:31:35.786 A:middle
cancelling all the overrides.

00:31:36.346 --> 00:31:38.116 A:middle
You can think of this as using

00:31:38.116 --> 00:31:39.306 A:middle
the empty set of overrides.

00:31:40.026 --> 00:31:43.716 A:middle
So, this is all the code there

00:31:43.716 --> 00:31:44.566 A:middle
is for promoting in-app

00:31:44.566 --> 00:31:45.096 A:middle
purchases.

00:31:46.146 --> 00:31:48.256 A:middle
The new delegate method and the

00:31:48.256 --> 00:31:49.536 A:middle
test URL are available, right

00:31:49.536 --> 00:31:50.606 A:middle
now, in the Seed we sent out,

00:31:50.606 --> 00:31:51.266 A:middle
earlier this week.

00:31:52.126 --> 00:31:53.886 A:middle
And this order and visibility

00:31:53.886 --> 00:31:55.296 A:middle
override will be available in a

00:31:55.296 --> 00:31:56.646 A:middle
later Seed.

00:31:57.636 --> 00:32:00.116 A:middle
To recap on promoting in-app

00:31:57.636 --> 00:32:00.116 A:middle
To recap on promoting in-app

00:32:00.116 --> 00:32:02.786 A:middle
purchases, it's a great way to

00:32:02.786 --> 00:32:03.836 A:middle
make them more discoverable, by

00:32:03.836 --> 00:32:04.856 A:middle
promoting them in the App Store.

00:32:06.276 --> 00:32:07.426 A:middle
You'll choose up to 20 to

00:32:07.426 --> 00:32:09.026 A:middle
promote per app and set them up

00:32:09.026 --> 00:32:09.796 A:middle
in iTunes Connect.

00:32:11.256 --> 00:32:12.866 A:middle
Then, a user can tap in the App

00:32:12.866 --> 00:32:14.446 A:middle
Store to begin the purchase.

00:32:16.626 --> 00:32:18.006 A:middle
The transaction info will be

00:32:18.006 --> 00:32:19.226 A:middle
sent to your app as it's opened

00:32:19.226 --> 00:32:21.036 A:middle
automatically via a new delegate

00:32:21.036 --> 00:32:22.336 A:middle
method on the SKPayment

00:32:22.336 --> 00:32:23.656 A:middle
transaction observer protocol.

00:32:25.646 --> 00:32:28.446 A:middle
Finally, if you want, you can

00:32:28.446 --> 00:32:29.366 A:middle
override the order and

00:32:29.366 --> 00:32:30.446 A:middle
visibility of they appear on

00:32:30.446 --> 00:32:31.736 A:middle
your app page, locally at

00:32:31.736 --> 00:32:32.116 A:middle
runtime.

00:32:33.436 --> 00:32:34.366 A:middle
Now, I'm really excited to see

00:32:34.366 --> 00:32:35.466 A:middle
how you all will use promoting

00:32:35.526 --> 00:32:36.546 A:middle
app purchases in your apps.

00:32:36.966 --> 00:32:38.426 A:middle
But for now, I hand the stage

00:32:38.426 --> 00:32:39.516 A:middle
back over to Pete, so he can

00:32:39.516 --> 00:32:40.386 A:middle
tell you what's new in working

00:32:40.386 --> 00:32:41.246 A:middle
with customer reviews.

00:32:42.516 --> 00:32:47.546 A:middle
[ Applause ]

00:32:48.046 --> 00:32:48.596 A:middle
&gt;&gt; Thanks, Ross.

00:32:49.716 --> 00:32:51.166 A:middle
I can't wait to try out Forest

00:32:51.166 --> 00:32:51.596 A:middle
Explorer.

00:32:51.786 --> 00:32:53.096 A:middle
Looks like a great app.

00:32:53.666 --> 00:32:55.046 A:middle
Well, now we've learned a bit

00:32:55.046 --> 00:32:55.926 A:middle
about implementing in-app

00:32:55.926 --> 00:32:57.126 A:middle
purchases and how to promote

00:32:57.126 --> 00:32:57.966 A:middle
them in the App Store.

00:32:58.286 --> 00:32:59.326 A:middle
Let's look at some ways you can

00:32:59.326 --> 00:33:00.546 A:middle
now interact with your

00:32:59.326 --> 00:33:00.546 A:middle
now interact with your

00:33:00.546 --> 00:33:01.186 A:middle
customers.

00:33:01.926 --> 00:33:03.866 A:middle
So, in iOS 11 we've got this

00:33:03.866 --> 00:33:05.026 A:middle
great new looking App Store

00:33:05.026 --> 00:33:05.396 A:middle
design.

00:33:05.846 --> 00:33:07.226 A:middle
And this is a product page.

00:33:07.226 --> 00:33:08.446 A:middle
If you scroll down the product

00:33:08.446 --> 00:33:10.446 A:middle
page, this is the new ratings

00:33:10.446 --> 00:33:11.946 A:middle
and reviews section, with a new

00:33:11.946 --> 00:33:13.206 A:middle
unified rating there.

00:33:13.336 --> 00:33:14.996 A:middle
And the user can just swipe

00:33:15.076 --> 00:33:16.846 A:middle
through different reviews in

00:33:16.846 --> 00:33:18.456 A:middle
order to read information about

00:33:18.906 --> 00:33:19.956 A:middle
user's experience with your

00:33:19.956 --> 00:33:20.316 A:middle
apps.

00:33:20.666 --> 00:33:21.956 A:middle
So, what's new in this regard?

00:33:21.956 --> 00:33:23.476 A:middle
Well, we've got a few new

00:33:23.476 --> 00:33:23.976 A:middle
features, here.

00:33:23.976 --> 00:33:25.116 A:middle
The first one, you can now

00:33:25.116 --> 00:33:26.586 A:middle
choose when you want your rating

00:33:26.586 --> 00:33:27.236 A:middle
to reset.

00:33:27.536 --> 00:33:28.226 A:middle
When you release your

00:33:28.226 --> 00:33:29.676 A:middle
application, you can decide if

00:33:29.676 --> 00:33:30.406 A:middle
this is something you want to

00:33:30.406 --> 00:33:30.926 A:middle
happen or not.

00:33:30.926 --> 00:33:32.636 A:middle
Previously, this would reset

00:33:32.636 --> 00:33:33.996 A:middle
your rating every single time.

00:33:33.996 --> 00:33:35.386 A:middle
So, now it's kind of up to you.

00:33:35.526 --> 00:33:35.636 A:middle
Yeah.

00:33:36.516 --> 00:33:40.046 A:middle
[ Applause ]

00:33:40.546 --> 00:33:41.926 A:middle
We've also, recently added the

00:33:41.926 --> 00:33:43.086 A:middle
ability for you to respond to

00:33:43.086 --> 00:33:44.216 A:middle
reviews on the App Store.

00:33:44.216 --> 00:33:45.466 A:middle
So, you can have that dialog

00:33:45.606 --> 00:33:46.556 A:middle
with consumers, now.

00:33:47.126 --> 00:33:48.666 A:middle
There's also some new ways for

00:33:48.666 --> 00:33:49.616 A:middle
you to ask for ratings and

00:33:49.616 --> 00:33:50.356 A:middle
reviews by the

00:33:50.426 --> 00:33:51.906 A:middle
SKStoreReviewController.

00:33:52.766 --> 00:33:54.546 A:middle
And finally, we added a new deep

00:33:54.546 --> 00:33:56.886 A:middle
link in iOS 10.3, that can link

00:33:56.886 --> 00:33:58.166 A:middle
directly to be able to write a

00:33:58.166 --> 00:33:59.136 A:middle
review in the App Store.

00:34:00.086 --> 00:34:02.216 A:middle
We also have added Helpfulness

00:34:02.216 --> 00:34:03.596 A:middle
and Report a Concern to iOS.

00:34:03.696 --> 00:34:05.556 A:middle
So, what does that look like?

00:34:06.006 --> 00:34:08.176 A:middle
Well, a user can now 3D Touch on

00:34:08.226 --> 00:34:09.376 A:middle
a review itself, and they get

00:34:09.406 --> 00:34:10.906 A:middle
presented with this Helpful or

00:34:10.906 --> 00:34:12.116 A:middle
Not Helpful menu.

00:34:12.116 --> 00:34:13.446 A:middle
They can mark them as helpful or

00:34:13.446 --> 00:34:13.976 A:middle
not helpful.

00:34:13.976 --> 00:34:15.426 A:middle
They can even report a concern

00:34:15.426 --> 00:34:17.746 A:middle
directly in the iOS app.

00:34:18.556 --> 00:34:20.496 A:middle
And when it comes to responding

00:34:20.496 --> 00:34:21.806 A:middle
to reviews, we introduced this

00:34:21.806 --> 00:34:23.005 A:middle
in iOS 10.3.

00:34:23.146 --> 00:34:24.156 A:middle
And the response has been really

00:34:24.156 --> 00:34:24.716 A:middle
fantastic.

00:34:25.255 --> 00:34:26.426 A:middle
We think users have loved this

00:34:26.426 --> 00:34:27.106 A:middle
feature and we've seen

00:34:27.106 --> 00:34:28.786 A:middle
developers really utilizing this

00:34:28.786 --> 00:34:29.386 A:middle
in a great way.

00:34:29.616 --> 00:34:31.156 A:middle
And when you respond to a user's

00:34:31.156 --> 00:34:32.146 A:middle
review, the user gets a

00:34:32.146 --> 00:34:33.565 A:middle
notification on their device,

00:34:33.565 --> 00:34:35.536 A:middle
informing them of your response.

00:34:36.126 --> 00:34:37.485 A:middle
They also get an email, as well,

00:34:38.016 --> 00:34:40.116 A:middle
detailing that response to their

00:34:40.116 --> 00:34:40.466 A:middle
review.

00:34:40.466 --> 00:34:41.866 A:middle
Now, down at the bottom of this

00:34:41.866 --> 00:34:43.306 A:middle
email, we actually have a link

00:34:43.306 --> 00:34:44.496 A:middle
for them to be able to update

00:34:44.496 --> 00:34:44.896 A:middle
their review.

00:34:44.896 --> 00:34:45.446 A:middle
So, we give them that

00:34:45.446 --> 00:34:47.166 A:middle
opportunity to tap that link.

00:34:47.446 --> 00:34:48.356 A:middle
And they get a chance to

00:34:48.356 --> 00:34:49.755 A:middle
actually edit their rating and

00:34:49.755 --> 00:34:51.045 A:middle
perhaps change their review, as

00:34:51.045 --> 00:34:51.446 A:middle
well.

00:34:52.016 --> 00:34:53.416 A:middle
And we've found that as users

00:34:53.416 --> 00:34:54.186 A:middle
are doing this, when they're

00:34:54.186 --> 00:34:55.456 A:middle
updating their reviews after

00:34:55.456 --> 00:34:57.106 A:middle
receiving a response, across the

00:34:57.106 --> 00:34:58.036 A:middle
board we've seen an average

00:34:58.036 --> 00:34:59.876 A:middle
increase of 1.5 stars per

00:34:59.876 --> 00:35:00.286 A:middle
review.

00:34:59.876 --> 00:35:00.286 A:middle
review.

00:35:00.686 --> 00:35:02.016 A:middle
So, as you can see, it's a

00:35:02.016 --> 00:35:03.436 A:middle
really great opportunity to see

00:35:03.546 --> 00:35:04.266 A:middle
a better rating.

00:35:04.266 --> 00:35:05.316 A:middle
A better experience for the

00:35:05.316 --> 00:35:07.056 A:middle
user, and also, a better rating

00:35:07.056 --> 00:35:08.216 A:middle
for your app on the App Store,

00:35:08.216 --> 00:35:08.706 A:middle
entirely.

00:35:09.766 --> 00:35:11.006 A:middle
So, for more information about

00:35:11.006 --> 00:35:12.426 A:middle
this, we have a guide online

00:35:12.426 --> 00:35:13.776 A:middle
about some techniques and the

00:35:13.776 --> 00:35:15.146 A:middle
best ways to respond to reviews

00:35:15.146 --> 00:35:15.996 A:middle
and to interact with your

00:35:15.996 --> 00:35:16.536 A:middle
customers.

00:35:16.906 --> 00:35:18.126 A:middle
And we also chatted about this

00:35:18.126 --> 00:35:19.096 A:middle
in the What's New in iTunes

00:35:19.096 --> 00:35:20.066 A:middle
Connect session, yesterday.

00:35:20.066 --> 00:35:21.466 A:middle
So, if you weren't able to make

00:35:21.466 --> 00:35:22.736 A:middle
that, I'd encourage you to check

00:35:22.736 --> 00:35:25.256 A:middle
out the video for that, too.

00:35:25.806 --> 00:35:26.616 A:middle
When it comes to receiving

00:35:26.616 --> 00:35:27.936 A:middle
reviews, there's a couple of

00:35:27.936 --> 00:35:29.206 A:middle
ways you can do this, now.

00:35:29.206 --> 00:35:30.846 A:middle
You can prompt the user for

00:35:30.846 --> 00:35:31.596 A:middle
reviews in the

00:35:31.596 --> 00:35:33.716 A:middle
SKStoreReviewController class.

00:35:34.026 --> 00:35:35.196 A:middle
And we also provide this deep

00:35:35.196 --> 00:35:36.056 A:middle
link to be able to write a

00:35:36.056 --> 00:35:37.336 A:middle
review in the App Store,

00:35:37.336 --> 00:35:37.756 A:middle
directly.

00:35:38.646 --> 00:35:40.026 A:middle
So first, let's look at the

00:35:40.026 --> 00:35:41.406 A:middle
SKStoreReviewController.

00:35:41.406 --> 00:35:42.556 A:middle
This was a class that we

00:35:42.756 --> 00:35:44.936 A:middle
introduced in iOS 10.3 And it

00:35:44.936 --> 00:35:46.606 A:middle
provides a really nice clean

00:35:46.606 --> 00:35:47.566 A:middle
interface for the user to be

00:35:47.566 --> 00:35:48.886 A:middle
able to rate your application

00:35:49.086 --> 00:35:49.926 A:middle
without leaving it.

00:35:50.066 --> 00:35:51.246 A:middle
So, they can now, just tap a

00:35:51.246 --> 00:35:53.226 A:middle
star, hit submit, and rate your

00:35:53.226 --> 00:35:54.406 A:middle
application in a really seamless

00:35:54.406 --> 00:35:55.016 A:middle
experience.

00:35:55.016 --> 00:35:56.086 A:middle
They can ever write a review

00:35:56.316 --> 00:35:56.926 A:middle
without leaving your

00:35:56.926 --> 00:35:58.586 A:middle
application, now.

00:35:58.836 --> 00:35:59.856 A:middle
Now, if you're asking for

00:35:59.856 --> 00:36:01.516 A:middle
reviews using another kind of

00:35:59.856 --> 00:36:01.516 A:middle
reviews using another kind of

00:36:01.516 --> 00:36:03.176 A:middle
alert or modal prompt, I just

00:36:03.176 --> 00:36:04.346 A:middle
highly encourage you to start

00:36:04.346 --> 00:36:05.686 A:middle
adopting this API, because at

00:36:05.686 --> 00:36:06.746 A:middle
some point in the future, we are

00:36:06.746 --> 00:36:07.736 A:middle
going to start requiring that

00:36:07.736 --> 00:36:09.376 A:middle
any modal presentation, any

00:36:09.376 --> 00:36:11.886 A:middle
modal prompts for reviews do use

00:36:11.886 --> 00:36:12.966 A:middle
this API, instead.

00:36:12.966 --> 00:36:14.366 A:middle
And there are some restrictions

00:36:14.366 --> 00:36:15.716 A:middle
in place for how this API can be

00:36:15.716 --> 00:36:16.116 A:middle
used.

00:36:17.026 --> 00:36:18.496 A:middle
There's a limited number of

00:36:18.496 --> 00:36:19.736 A:middle
requests per device.

00:36:19.816 --> 00:36:21.876 A:middle
So, we limit the amount of times

00:36:21.876 --> 00:36:23.236 A:middle
a user gets bombarded with these

00:36:23.236 --> 00:36:23.776 A:middle
alerts.

00:36:23.776 --> 00:36:24.786 A:middle
And the user can actually now,

00:36:24.786 --> 00:36:26.306 A:middle
in iOS 11, switch it off in the

00:36:26.306 --> 00:36:26.856 A:middle
Setting app.

00:36:26.856 --> 00:36:27.686 A:middle
So, they can go into the App

00:36:27.686 --> 00:36:29.276 A:middle
Store Settings, hit a toggle to

00:36:29.276 --> 00:36:30.736 A:middle
actually turn off these prompts

00:36:30.736 --> 00:36:31.366 A:middle
for ratings.

00:36:31.836 --> 00:36:32.956 A:middle
So, we think this is going to be

00:36:32.956 --> 00:36:34.016 A:middle
a better experience for users

00:36:34.016 --> 00:36:35.086 A:middle
and for developers, alike.

00:36:36.356 --> 00:36:37.706 A:middle
A couple of tips for

00:36:38.106 --> 00:36:40.586 A:middle
implementing this.

00:36:40.586 --> 00:36:41.656 A:middle
The SKStoreReviewController is a

00:36:41.656 --> 00:36:42.536 A:middle
prompt, so it's kind of

00:36:42.536 --> 00:36:43.556 A:middle
interruptive by nature.

00:36:43.686 --> 00:36:45.366 A:middle
So, think about doing this thing

00:36:45.366 --> 00:36:46.686 A:middle
at the end of maybe, some kind

00:36:46.686 --> 00:36:47.486 A:middle
of user interaction.

00:36:47.676 --> 00:36:49.136 A:middle
Maybe after a user has completed

00:36:49.136 --> 00:36:49.696 A:middle
a task.

00:36:49.996 --> 00:36:51.436 A:middle
Maybe, then use that opportunity

00:36:51.436 --> 00:36:52.466 A:middle
to ask them for a rating or

00:36:52.466 --> 00:36:52.766 A:middle
review.

00:36:52.766 --> 00:36:53.946 A:middle
Don't interrupt them when

00:36:53.946 --> 00:36:54.476 A:middle
they're in the middle of

00:36:54.476 --> 00:36:54.846 A:middle
something.

00:36:55.946 --> 00:36:57.246 A:middle
It's also, not appropriate to

00:36:57.246 --> 00:36:58.616 A:middle
use this API from a button.

00:36:58.716 --> 00:36:59.606 A:middle
Because you're not kind of

00:36:59.606 --> 00:37:01.056 A:middle
guaranteed to have UI presented

00:36:59.606 --> 00:37:01.056 A:middle
guaranteed to have UI presented

00:37:01.056 --> 00:37:02.356 A:middle
to the user, based on those

00:37:02.356 --> 00:37:03.346 A:middle
restrictions we just saw.

00:37:03.876 --> 00:37:05.916 A:middle
So, it's not appropriate to use

00:37:05.916 --> 00:37:07.086 A:middle
from some kind of embedded link

00:37:07.086 --> 00:37:07.846 A:middle
in your application.

00:37:08.606 --> 00:37:09.796 A:middle
But when you do want to do it,

00:37:09.796 --> 00:37:10.656 A:middle
this is what is looks like in

00:37:10.656 --> 00:37:10.986 A:middle
code.

00:37:11.186 --> 00:37:12.196 A:middle
It's just one line of code.

00:37:12.696 --> 00:37:13.826 A:middle
But you can wrap it in your own

00:37:13.826 --> 00:37:14.506 A:middle
business logic.

00:37:14.506 --> 00:37:15.846 A:middle
So, in this example here, we're

00:37:15.846 --> 00:37:16.676 A:middle
checking to see if this

00:37:16.726 --> 00:37:18.386 A:middle
particular user is the kind of

00:37:18.386 --> 00:37:19.486 A:middle
user that we want to ask a

00:37:19.486 --> 00:37:19.946 A:middle
review of.

00:37:21.016 --> 00:37:22.226 A:middle
And if we determine that they

00:37:22.226 --> 00:37:24.066 A:middle
are, we can call the request

00:37:24.066 --> 00:37:25.846 A:middle
review method on the

00:37:25.846 --> 00:37:26.976 A:middle
SKStoreReviewController.

00:37:27.056 --> 00:37:28.026 A:middle
And that's the only thing you

00:37:28.026 --> 00:37:28.786 A:middle
need to call.

00:37:28.786 --> 00:37:29.996 A:middle
And that'll present that rating

00:37:29.996 --> 00:37:31.196 A:middle
prompt to a user while they're

00:37:31.196 --> 00:37:32.126 A:middle
using your application.

00:37:32.716 --> 00:37:35.726 A:middle
The other way, of course, is

00:37:35.726 --> 00:37:36.836 A:middle
this new deep link to write a

00:37:36.836 --> 00:37:37.656 A:middle
review that I mentioned.

00:37:39.056 --> 00:37:40.216 A:middle
So, this was also actually

00:37:40.216 --> 00:37:41.726 A:middle
introduced in iOS 10.3, but

00:37:41.726 --> 00:37:42.586 A:middle
we're talking a bit about it,

00:37:42.586 --> 00:37:42.876 A:middle
now.

00:37:43.166 --> 00:37:44.726 A:middle
This provides you a link to open

00:37:44.726 --> 00:37:46.016 A:middle
your app page in the App Store.

00:37:46.276 --> 00:37:47.496 A:middle
But straightaway actually

00:37:47.496 --> 00:37:48.756 A:middle
presents the write review sheet,

00:37:48.756 --> 00:37:49.916 A:middle
or the edit review in the case

00:37:49.916 --> 00:37:50.836 A:middle
of they've already written one.

00:37:51.406 --> 00:37:52.746 A:middle
And this is more appropriate for

00:37:52.746 --> 00:37:53.866 A:middle
thing like user initiated

00:37:53.866 --> 00:37:54.246 A:middle
actions.

00:37:54.246 --> 00:37:55.256 A:middle
So, in the case that maybe you

00:37:55.256 --> 00:37:56.736 A:middle
do want a persistent link in

00:37:56.736 --> 00:37:57.836 A:middle
your app, maybe a button in your

00:37:57.836 --> 00:37:58.936 A:middle
Settings to write a review for

00:37:58.936 --> 00:37:59.896 A:middle
your app in the App Store.

00:38:00.306 --> 00:38:01.716 A:middle
And it's a little different to

00:38:01.716 --> 00:38:02.946 A:middle
the SKStoreReviewController, in

00:38:02.946 --> 00:38:03.356 A:middle
that sense.

00:38:03.356 --> 00:38:04.296 A:middle
You can kind of think about it

00:38:04.296 --> 00:38:05.266 A:middle
as being the opposite.

00:38:05.596 --> 00:38:06.856 A:middle
So, it's more appropriate from a

00:38:06.856 --> 00:38:08.726 A:middle
button in your Settings, or some

00:38:08.846 --> 00:38:09.956 A:middle
embedded content in your

00:38:09.956 --> 00:38:10.386 A:middle
application.

00:38:10.386 --> 00:38:11.336 A:middle
Because it provides that

00:38:11.556 --> 00:38:12.916 A:middle
consistent experience, a

00:38:12.916 --> 00:38:14.436 A:middle
guaranteed action that's going

00:38:14.926 --> 00:38:15.546 A:middle
to happen.

00:38:15.546 --> 00:38:16.666 A:middle
However, it's not appropriate to

00:38:16.666 --> 00:38:17.476 A:middle
use from an alert.

00:38:17.606 --> 00:38:18.876 A:middle
I mentioned if you're going to

00:38:18.876 --> 00:38:20.326 A:middle
use alerts to prompt users for

00:38:20.326 --> 00:38:21.136 A:middle
reviews, make sure that you

00:38:21.136 --> 00:38:21.976 A:middle
start to adopt

00:38:21.976 --> 00:38:23.186 A:middle
SKStoreReviewController,

00:38:23.186 --> 00:38:23.556 A:middle
instead.

00:38:24.146 --> 00:38:27.856 A:middle
This is how you actually form

00:38:27.856 --> 00:38:28.316 A:middle
the deep link.

00:38:28.626 --> 00:38:31.836 A:middle
You take you app page URL, which

00:38:31.836 --> 00:38:32.966 A:middle
you can get online from the Link

00:38:32.966 --> 00:38:34.006 A:middle
Maker website, if you don't know

00:38:34.006 --> 00:38:34.696 A:middle
what that is, already.

00:38:35.026 --> 00:38:36.256 A:middle
And you just append the query

00:38:36.256 --> 00:38:37.616 A:middle
parameter action equals write

00:38:37.726 --> 00:38:38.866 A:middle
review onto the end of it.

00:38:38.866 --> 00:38:40.056 A:middle
And that just means when the

00:38:40.056 --> 00:38:41.306 A:middle
user arrives at your app page,

00:38:41.476 --> 00:38:42.436 A:middle
they get presented with that

00:38:42.436 --> 00:38:43.146 A:middle
Write Review sheet.

00:38:44.226 --> 00:38:47.286 A:middle
So, for more information about

00:38:47.506 --> 00:38:48.596 A:middle
ratings and reviews and some of

00:38:48.596 --> 00:38:49.486 A:middle
the changes we introduced

00:38:49.486 --> 00:38:50.146 A:middle
earlier, this year, I'd

00:38:50.146 --> 00:38:51.356 A:middle
encourage you to check out the

00:38:51.356 --> 00:38:52.286 A:middle
developer website, here.

00:38:52.756 --> 00:38:53.696 A:middle
We've got some more information,

00:38:53.696 --> 00:38:53.846 A:middle
there.

00:38:54.566 --> 00:38:56.796 A:middle
So, we've covered a few of the

00:38:56.796 --> 00:38:58.456 A:middle
new features, today, for what's

00:38:58.456 --> 00:38:59.176 A:middle
new in StoreKit.

00:38:59.476 --> 00:39:00.136 A:middle
Just to recap.

00:38:59.476 --> 00:39:00.136 A:middle
Just to recap.

00:39:00.576 --> 00:39:01.836 A:middle
We talked about the way to

00:39:01.836 --> 00:39:02.966 A:middle
implement in-app purchases in

00:39:03.116 --> 00:39:04.266 A:middle
your application, that seven

00:39:04.266 --> 00:39:05.386 A:middle
step flow for implementing

00:39:05.386 --> 00:39:06.126 A:middle
in-app purchases.

00:39:06.576 --> 00:39:07.796 A:middle
Ross, got up here and discussed

00:39:07.796 --> 00:39:08.846 A:middle
some of the newer ways that you

00:39:08.846 --> 00:39:09.726 A:middle
can promote your in-app

00:39:09.726 --> 00:39:10.966 A:middle
purchases, directly in the App

00:39:10.966 --> 00:39:11.276 A:middle
Store.

00:39:11.276 --> 00:39:12.476 A:middle
So, you can now sell content to

00:39:12.476 --> 00:39:13.176 A:middle
your users while they're

00:39:13.176 --> 00:39:14.186 A:middle
browsing the App Store app.

00:39:14.996 --> 00:39:16.286 A:middle
We've got that new App Store

00:39:16.286 --> 00:39:17.706 A:middle
design, featuring the new

00:39:17.896 --> 00:39:19.136 A:middle
Ratings and Reviews section,

00:39:19.396 --> 00:39:20.766 A:middle
including developer responses.

00:39:20.976 --> 00:39:22.196 A:middle
And we've seen that using

00:39:22.196 --> 00:39:23.206 A:middle
developer responses, we've got

00:39:23.206 --> 00:39:24.546 A:middle
some great new opportunities to

00:39:24.546 --> 00:39:25.986 A:middle
actually see improvements in

00:39:25.986 --> 00:39:27.106 A:middle
your ratings and reviews.

00:39:27.356 --> 00:39:28.616 A:middle
Better customer experiences, in

00:39:28.616 --> 00:39:29.396 A:middle
that regard as well.

00:39:30.146 --> 00:39:32.456 A:middle
For more information about this

00:39:32.456 --> 00:39:34.576 A:middle
session, we've got some links on

00:39:34.576 --> 00:39:35.106 A:middle
the website, here.

00:39:35.106 --> 00:39:36.476 A:middle
And this is Session 303.

00:39:37.666 --> 00:39:38.996 A:middle
There's also, some related

00:39:38.996 --> 00:39:39.876 A:middle
sessions, particularly this

00:39:39.876 --> 00:39:40.996 A:middle
afternoon, with the Advanced

00:39:40.996 --> 00:39:41.906 A:middle
StoreKit session.

00:39:42.156 --> 00:39:43.496 A:middle
And I can see you there,

00:39:43.496 --> 00:39:44.536 A:middle
hopefully, if you come along.

00:39:44.656 --> 00:39:46.326 A:middle
We've got some more details

00:39:46.326 --> 00:39:47.656 A:middle
about receipt validation.

00:39:47.656 --> 00:39:48.486 A:middle
We're going to go really

00:39:48.486 --> 00:39:49.526 A:middle
in-depth into subscription

00:39:49.526 --> 00:39:50.926 A:middle
management, persisting state

00:39:50.926 --> 00:39:52.016 A:middle
across the server environment,

00:39:52.016 --> 00:39:52.626 A:middle
and that kind of thing.

00:39:52.626 --> 00:39:54.966 A:middle
So, please come along and we've

00:39:54.966 --> 00:39:55.926 A:middle
got some more content for you,

00:39:55.926 --> 00:39:56.096 A:middle
there.

00:39:56.536 --> 00:39:57.836 A:middle
But that's it for today.

00:39:57.836 --> 00:39:58.816 A:middle
Thank you, for coming along this

00:39:58.816 --> 00:39:59.206 A:middle
session.

00:39:59.206 --> 00:39:59.856 A:middle
And I hope you have a great

00:39:59.856 --> 00:39:59.976 A:middle
lunch.

00:40:00.516 --> 00:40:03.500 A:middle
[ Applause ]
