WEBVTT

00:00:07.516 --> 00:00:15.500 A:middle
[ Music ]

00:00:23.506 --> 00:00:23.976 A:middle
&gt;&gt; All right [applause].

00:00:24.806 --> 00:00:27.546 A:middle
Thank you [applause].

00:00:27.546 --> 00:00:28.616 A:middle
Good afternoon everyone and

00:00:28.616 --> 00:00:29.646 A:middle
thank you for coming to our

00:00:29.646 --> 00:00:31.166 A:middle
session today on Core Image.

00:00:31.456 --> 00:00:32.846 A:middle
My name is David Hayward, and

00:00:32.846 --> 00:00:34.216 A:middle
I'm really excited to be talking

00:00:34.216 --> 00:00:35.716 A:middle
about the great new performance

00:00:35.866 --> 00:00:37.566 A:middle
and prototyping features our

00:00:37.566 --> 00:00:39.156 A:middle
team has been adding to Core

00:00:39.156 --> 00:00:40.536 A:middle
Image over the last year.

00:00:41.166 --> 00:00:42.406 A:middle
We have a lot to talk about, so

00:00:42.406 --> 00:00:43.646 A:middle
let's get right into the agenda.

00:00:44.346 --> 00:00:45.486 A:middle
So, the first thing we're going

00:00:45.486 --> 00:00:46.936 A:middle
to be talking about today are

00:00:46.936 --> 00:00:48.556 A:middle
some great new APIs we've added

00:00:48.556 --> 00:00:50.216 A:middle
to Core Image to help improve

00:00:50.216 --> 00:00:51.016 A:middle
the performance of your

00:00:51.016 --> 00:00:51.796 A:middle
applications.

00:00:52.436 --> 00:00:53.446 A:middle
After that, we're going to segue

00:00:53.446 --> 00:00:55.696 A:middle
into another topic, which is how

00:00:55.696 --> 00:00:57.016 A:middle
you can use Core Image to help

00:00:57.016 --> 00:00:58.176 A:middle
prototype new algorithm

00:00:58.176 --> 00:00:58.716 A:middle
development.

00:00:59.296 --> 00:01:00.236 A:middle
And lastly, we're going to be

00:00:59.296 --> 00:01:00.236 A:middle
And lastly, we're going to be

00:01:00.236 --> 00:01:01.836 A:middle
talking about how you can use

00:01:01.836 --> 00:01:04.036 A:middle
Core Image with various machine

00:01:04.036 --> 00:01:05.656 A:middle
learning applications.

00:01:07.336 --> 00:01:08.046 A:middle
All right.

00:01:08.046 --> 00:01:10.026 A:middle
So, let's get into this and

00:01:10.026 --> 00:01:11.216 A:middle
start talking about performance

00:01:11.216 --> 00:01:11.376 A:middle
APIs.

00:01:11.376 --> 00:01:13.066 A:middle
There's two main areas where

00:01:13.066 --> 00:01:15.206 A:middle
we've worked on performance this

00:01:15.206 --> 00:01:15.396 A:middle
year.

00:01:15.396 --> 00:01:16.856 A:middle
First of all, we've added some

00:01:16.856 --> 00:01:18.266 A:middle
new controls for inserting

00:01:18.636 --> 00:01:20.076 A:middle
intermediate buffers -- we'll

00:01:20.076 --> 00:01:21.386 A:middle
talk about that in some detail.

00:01:22.006 --> 00:01:23.356 A:middle
And the second thing is we'll be

00:01:23.356 --> 00:01:25.346 A:middle
talking about some new CI kernel

00:01:25.346 --> 00:01:27.196 A:middle
language features that you can

00:01:27.196 --> 00:01:27.916 A:middle
take advantage of.

00:01:28.156 --> 00:01:30.356 A:middle
So, let's start by talking about

00:01:30.356 --> 00:01:31.376 A:middle
intermediate buffers.

00:01:32.806 --> 00:01:34.546 A:middle
As you are aware, if you've used

00:01:34.546 --> 00:01:36.076 A:middle
Core Image before, Core Image

00:01:36.076 --> 00:01:37.356 A:middle
allows you to easily chain

00:01:37.356 --> 00:01:39.866 A:middle
together sequences of filters.

00:01:40.266 --> 00:01:41.836 A:middle
Every filter in Core Image is

00:01:41.836 --> 00:01:43.796 A:middle
made up of one or more kernels.

00:01:44.076 --> 00:01:45.196 A:middle
And one of the great features

00:01:45.196 --> 00:01:46.926 A:middle
that Core Image uses to improve

00:01:46.926 --> 00:01:48.376 A:middle
performance is the ability to

00:01:48.376 --> 00:01:49.836 A:middle
concatenate kernels in order to

00:01:49.836 --> 00:01:50.886 A:middle
minimize the number of

00:01:50.886 --> 00:01:51.836 A:middle
intermediate buffers.

00:01:52.226 --> 00:01:53.966 A:middle
In many cases, to get the best

00:01:53.966 --> 00:01:54.996 A:middle
performance you want to have the

00:01:54.996 --> 00:01:56.496 A:middle
minimum number of buffers.

00:01:57.596 --> 00:01:58.796 A:middle
However, there are some

00:01:58.796 --> 00:02:00.776 A:middle
scenarios where you don't want

00:01:58.796 --> 00:02:00.776 A:middle
scenarios where you don't want

00:02:01.386 --> 00:02:02.766 A:middle
to concatenate as much as

00:02:02.766 --> 00:02:03.226 A:middle
possible.

00:02:03.496 --> 00:02:05.216 A:middle
For example, your application

00:02:05.216 --> 00:02:06.886 A:middle
might have an expensive filter

00:02:06.886 --> 00:02:08.476 A:middle
early on in the filter chain.

00:02:08.675 --> 00:02:10.876 A:middle
And the user of your application

00:02:10.876 --> 00:02:12.376 A:middle
at a given moment in time might

00:02:12.376 --> 00:02:13.486 A:middle
be adjusting a filter that

00:02:13.486 --> 00:02:15.146 A:middle
follows it in the graph.

00:02:15.206 --> 00:02:16.786 A:middle
And this is a classic situation

00:02:16.786 --> 00:02:18.076 A:middle
where it's a good idea to have

00:02:18.076 --> 00:02:20.216 A:middle
an intermediate buffer at a

00:02:20.216 --> 00:02:22.116 A:middle
location like this in between.

00:02:22.916 --> 00:02:24.546 A:middle
The idea is that by having an

00:02:24.546 --> 00:02:26.346 A:middle
intermediate buffer here, the

00:02:26.346 --> 00:02:28.186 A:middle
cost of the expensive filter

00:02:28.506 --> 00:02:30.126 A:middle
does not have to be paid for

00:02:30.126 --> 00:02:32.726 A:middle
again when you adjust a

00:02:32.726 --> 00:02:33.566 A:middle
secondary filter.

00:02:33.976 --> 00:02:35.426 A:middle
So, how do you do this in your

00:02:35.426 --> 00:02:36.036 A:middle
application?

00:02:36.036 --> 00:02:38.006 A:middle
We have a new API, very aptly

00:02:38.006 --> 00:02:39.846 A:middle
named, inserting intermediate.

00:02:40.466 --> 00:02:42.486 A:middle
So, let's talk about how this

00:02:42.486 --> 00:02:43.756 A:middle
affects our results.

00:02:43.756 --> 00:02:44.736 A:middle
What we do is instead of

00:02:44.736 --> 00:02:45.896 A:middle
concatenating as much as

00:02:45.896 --> 00:02:47.616 A:middle
possible, we will respect that

00:02:47.886 --> 00:02:49.516 A:middle
location of the intermediate and

00:02:49.516 --> 00:02:51.436 A:middle
concatenate as much as possible

00:02:51.436 --> 00:02:51.746 A:middle
around it.

00:02:52.956 --> 00:02:54.246 A:middle
Some notes on this.

00:02:54.246 --> 00:02:55.966 A:middle
One thing to keep in mind, is

00:02:55.966 --> 00:02:57.846 A:middle
that by default, Core Image

00:02:57.846 --> 00:02:59.496 A:middle
cashes all intermediate buffers

00:02:59.496 --> 00:03:01.126 A:middle
so that the assumption is that a

00:02:59.496 --> 00:03:01.126 A:middle
so that the assumption is that a

00:03:01.126 --> 00:03:02.906 A:middle
subsequent render can be made as

00:03:02.906 --> 00:03:03.776 A:middle
fast as possible.

00:03:04.296 --> 00:03:05.946 A:middle
There are, sometimes, however,

00:03:06.166 --> 00:03:07.546 A:middle
when you might want to turn off

00:03:07.706 --> 00:03:08.886 A:middle
caching of intermediates.

00:03:09.386 --> 00:03:10.756 A:middle
So, for example, if you

00:03:10.756 --> 00:03:12.106 A:middle
application is going to be doing

00:03:12.106 --> 00:03:14.436 A:middle
a batch export of 100 images,

00:03:14.986 --> 00:03:16.306 A:middle
there is little benefit of

00:03:16.336 --> 00:03:17.656 A:middle
caching the first one, because

00:03:17.656 --> 00:03:18.776 A:middle
you'll be rendering a completely

00:03:18.776 --> 00:03:20.026 A:middle
different image afterwards.

00:03:20.476 --> 00:03:21.956 A:middle
So, you can do that today in

00:03:21.956 --> 00:03:23.336 A:middle
your application by using the

00:03:23.336 --> 00:03:24.936 A:middle
context option cache

00:03:24.936 --> 00:03:26.046 A:middle
intermediates and setting that

00:03:26.046 --> 00:03:26.976 A:middle
value to false.

00:03:28.616 --> 00:03:30.176 A:middle
However, if you are also using

00:03:30.176 --> 00:03:31.966 A:middle
this new API that we spoke

00:03:31.966 --> 00:03:34.466 A:middle
about, you can still turn on

00:03:34.466 --> 00:03:35.836 A:middle
caching of intermediates, even

00:03:35.836 --> 00:03:37.676 A:middle
if this context option is turned

00:03:37.676 --> 00:03:38.436 A:middle
off.

00:03:38.436 --> 00:03:39.686 A:middle
So, this allows you to really

00:03:39.686 --> 00:03:40.806 A:middle
make sure that we cache

00:03:40.806 --> 00:03:41.956 A:middle
something and don't cache

00:03:41.956 --> 00:03:42.686 A:middle
anything else.

00:03:44.516 --> 00:03:46.846 A:middle
The next subject I'd like to

00:03:46.846 --> 00:03:48.606 A:middle
talk about is some new features

00:03:48.606 --> 00:03:50.446 A:middle
we've added to the kernel

00:03:50.446 --> 00:03:52.876 A:middle
language that allows us to apply

00:03:52.876 --> 00:03:53.656 A:middle
image processing.

00:03:55.156 --> 00:03:56.596 A:middle
So, one thing to keep in mind is

00:03:56.596 --> 00:03:58.216 A:middle
that we have two different ways

00:03:58.216 --> 00:03:59.386 A:middle
of writing kernels in Core

00:03:59.386 --> 00:03:59.696 A:middle
Image.

00:04:00.046 --> 00:04:02.476 A:middle
The traditional way is to use

00:04:02.476 --> 00:04:03.646 A:middle
the CI kernel language.

00:04:04.016 --> 00:04:05.396 A:middle
And in this case, you have a

00:04:05.396 --> 00:04:06.966 A:middle
string inside your source file;

00:04:06.966 --> 00:04:08.356 A:middle
either your Swift code or your

00:04:08.356 --> 00:04:09.256 A:middle
objective C code.

00:04:09.676 --> 00:04:11.726 A:middle
And at run time you make a call,

00:04:11.726 --> 00:04:13.686 A:middle
to say, kernel with source.

00:04:14.796 --> 00:04:17.016 A:middle
And later on, when you create an

00:04:17.016 --> 00:04:18.706 A:middle
image based on that kernel, you

00:04:18.706 --> 00:04:20.446 A:middle
can then render that to any type

00:04:20.446 --> 00:04:21.565 A:middle
of Core Image context, whether

00:04:21.565 --> 00:04:24.156 A:middle
that context is backed by Metal

00:04:24.556 --> 00:04:25.476 A:middle
or open GL.

00:04:26.986 --> 00:04:28.066 A:middle
When it comes time to render,

00:04:28.066 --> 00:04:29.736 A:middle
however, that source needs to be

00:04:29.736 --> 00:04:30.346 A:middle
translated.

00:04:30.346 --> 00:04:31.556 A:middle
It needs to be translated either

00:04:31.556 --> 00:04:34.856 A:middle
to Metal or GLSL, and that step

00:04:34.856 --> 00:04:35.666 A:middle
has a cost.

00:04:36.236 --> 00:04:38.006 A:middle
Eventually then, that code is

00:04:38.216 --> 00:04:40.056 A:middle
compiled to the GPU instruction

00:04:40.056 --> 00:04:41.426 A:middle
set and then executed.

00:04:42.036 --> 00:04:45.046 A:middle
Starting last year in iOS 11, we

00:04:45.046 --> 00:04:46.586 A:middle
added a new way of writing CI

00:04:46.586 --> 00:04:47.616 A:middle
kernels, which has some

00:04:47.806 --> 00:04:48.926 A:middle
significant advantages.

00:04:49.226 --> 00:04:50.896 A:middle
And that's CI kernels based on

00:04:50.896 --> 00:04:51.986 A:middle
the Metal shading language.

00:04:52.686 --> 00:04:54.556 A:middle
In this case, you have your

00:04:54.556 --> 00:04:56.056 A:middle
source in your project and this

00:04:56.056 --> 00:04:57.826 A:middle
is -- this source is complied at

00:04:57.826 --> 00:04:59.836 A:middle
build time rather than at

00:04:59.836 --> 00:05:00.306 A:middle
runtime.

00:04:59.836 --> 00:05:00.306 A:middle
runtime.

00:05:01.576 --> 00:05:03.776 A:middle
As before, you substantiate a

00:05:03.776 --> 00:05:06.326 A:middle
kernel based on this code by

00:05:06.326 --> 00:05:08.136 A:middle
using the kernel with Metal

00:05:08.136 --> 00:05:10.196 A:middle
function name and binary data.

00:05:11.526 --> 00:05:14.206 A:middle
The advantage here is that this

00:05:15.016 --> 00:05:16.896 A:middle
data can be applied without

00:05:17.416 --> 00:05:18.526 A:middle
paying the cost of an additional

00:05:18.526 --> 00:05:18.946 A:middle
compile.

00:05:19.566 --> 00:05:21.776 A:middle
The caveat, however, is it works

00:05:21.776 --> 00:05:23.676 A:middle
on Metal backed CI context.

00:05:24.306 --> 00:05:25.606 A:middle
But it gives a big performance

00:05:27.186 --> 00:05:27.606 A:middle
advantage.

00:05:27.606 --> 00:05:29.976 A:middle
So, starting in this release

00:05:29.976 --> 00:05:31.606 A:middle
we're going to be marking the CI

00:05:31.606 --> 00:05:33.296 A:middle
kernel language as deprecated,

00:05:33.786 --> 00:05:35.206 A:middle
because while we will continue

00:05:35.206 --> 00:05:37.486 A:middle
to support this language, we

00:05:37.486 --> 00:05:39.106 A:middle
feel that the new way of writing

00:05:39.106 --> 00:05:40.636 A:middle
Metal kernels offers a lot of

00:05:40.636 --> 00:05:41.606 A:middle
advantages to you, the

00:05:41.606 --> 00:05:42.096 A:middle
developer.

00:05:42.256 --> 00:05:43.236 A:middle
For one thing, you get the

00:05:43.236 --> 00:05:44.956 A:middle
performance advantage I outlined

00:05:44.956 --> 00:05:46.496 A:middle
earlier, but it also gives you

00:05:46.496 --> 00:05:48.606 A:middle
the advantage of getting build

00:05:48.606 --> 00:05:50.476 A:middle
time syntax coloring on your

00:05:50.476 --> 00:05:52.726 A:middle
code and great debugging tools

00:05:52.906 --> 00:05:54.596 A:middle
when you're working with your

00:05:54.766 --> 00:05:56.946 A:middle
Metal source.

00:05:57.956 --> 00:05:58.916 A:middle
So, great.

00:05:59.516 --> 00:06:03.246 A:middle
[ Applause ]

00:05:59.516 --> 00:06:03.246 A:middle
[ Applause ]

00:06:03.746 --> 00:06:05.056 A:middle
So, with that in mind I want to

00:06:05.056 --> 00:06:06.896 A:middle
talk about a few other things

00:06:06.896 --> 00:06:09.046 A:middle
that we've added to our kernel

00:06:09.046 --> 00:06:09.456 A:middle
language.

00:06:09.516 --> 00:06:10.716 A:middle
For one thing, we have added

00:06:10.716 --> 00:06:11.686 A:middle
half float support.

00:06:12.226 --> 00:06:15.046 A:middle
There are a lot of cases when

00:06:15.046 --> 00:06:17.756 A:middle
your CI kernel can be perfectly

00:06:18.256 --> 00:06:19.676 A:middle
happy with the precision that

00:06:19.676 --> 00:06:20.486 A:middle
half float gives you.

00:06:20.896 --> 00:06:22.346 A:middle
If you're working with RGB color

00:06:22.346 --> 00:06:23.916 A:middle
values, half float precision is

00:06:23.916 --> 00:06:24.656 A:middle
more than adequate.

00:06:25.036 --> 00:06:26.746 A:middle
The advantage of using half

00:06:26.746 --> 00:06:27.686 A:middle
floats in your kernel is it

00:06:27.686 --> 00:06:29.526 A:middle
allows operations to run faster,

00:06:29.526 --> 00:06:31.736 A:middle
especially on A11 devices like

00:06:31.806 --> 00:06:32.506 A:middle
the iPhone 10.

00:06:33.466 --> 00:06:34.786 A:middle
Another advantage of using half

00:06:34.786 --> 00:06:36.286 A:middle
floats in your kernels is it

00:06:36.286 --> 00:06:37.866 A:middle
allows for smaller registers,

00:06:37.866 --> 00:06:38.936 A:middle
which increases the amount of

00:06:38.936 --> 00:06:40.376 A:middle
utilization of the GPU, which

00:06:40.376 --> 00:06:41.556 A:middle
also helps performance.

00:06:42.456 --> 00:06:43.466 A:middle
Another great feature we've

00:06:43.466 --> 00:06:44.566 A:middle
added to the kernel language

00:06:44.566 --> 00:06:46.386 A:middle
this year is adding support for

00:06:46.386 --> 00:06:47.046 A:middle
group reads.

00:06:47.366 --> 00:06:48.406 A:middle
This gives your shader the

00:06:48.406 --> 00:06:49.636 A:middle
ability to do four

00:06:49.766 --> 00:06:51.166 A:middle
single-channel reads from an

00:06:51.166 --> 00:06:53.626 A:middle
input image with only one

00:06:53.626 --> 00:06:55.026 A:middle
instruction, so this really can

00:06:55.026 --> 00:06:55.236 A:middle
help.

00:06:56.636 --> 00:06:58.526 A:middle
And as a complement to that, we

00:06:58.526 --> 00:06:59.836 A:middle
also have the ability to write

00:06:59.886 --> 00:07:00.746 A:middle
groups of pixels.

00:06:59.886 --> 00:07:00.746 A:middle
groups of pixels.

00:07:01.166 --> 00:07:02.156 A:middle
This gives you the ability to

00:07:02.156 --> 00:07:04.196 A:middle
write four pixels of an image

00:07:04.576 --> 00:07:06.526 A:middle
with just one call inside your

00:07:06.526 --> 00:07:06.836 A:middle
shader.

00:07:08.246 --> 00:07:10.296 A:middle
So, all three of these features

00:07:10.296 --> 00:07:12.966 A:middle
can be used in your shaders to

00:07:13.406 --> 00:07:14.756 A:middle
give great performance

00:07:14.896 --> 00:07:15.446 A:middle
improvements.

00:07:15.446 --> 00:07:16.296 A:middle
So, let me talk a little bit

00:07:16.296 --> 00:07:17.606 A:middle
about an example of how that

00:07:17.606 --> 00:07:18.006 A:middle
works.

00:07:18.316 --> 00:07:20.686 A:middle
So, imagine today you have a

00:07:20.686 --> 00:07:22.946 A:middle
simple 3 by 3 convolution kernel

00:07:23.626 --> 00:07:25.616 A:middle
that is working only on one

00:07:25.616 --> 00:07:26.556 A:middle
channel of an image.

00:07:26.686 --> 00:07:27.916 A:middle
This is actually a fairly common

00:07:27.916 --> 00:07:29.186 A:middle
operation, for example, if you

00:07:29.186 --> 00:07:30.356 A:middle
want to sharpen the luminance of

00:07:30.356 --> 00:07:30.756 A:middle
an image.

00:07:31.226 --> 00:07:32.826 A:middle
So, in a kernel like this,

00:07:32.826 --> 00:07:34.636 A:middle
typically, you're -- each time

00:07:34.636 --> 00:07:36.386 A:middle
your kernel is evoked, it is

00:07:37.076 --> 00:07:38.606 A:middle
responsible for producing one

00:07:38.606 --> 00:07:39.336 A:middle
output pixel.

00:07:39.986 --> 00:07:41.386 A:middle
But, because this is a 3 by 3

00:07:41.386 --> 00:07:43.366 A:middle
convolution, your kernel needs

00:07:43.366 --> 00:07:46.296 A:middle
to read 9 pixels in order to

00:07:46.296 --> 00:07:46.946 A:middle
achieve that effect.

00:07:47.186 --> 00:07:48.756 A:middle
So, we have 9 pixels read for

00:07:48.756 --> 00:07:50.116 A:middle
every one pixel written.

00:07:51.466 --> 00:07:52.956 A:middle
However, we can improve this by

00:07:52.956 --> 00:07:54.956 A:middle
making use of the new group

00:07:54.956 --> 00:07:55.866 A:middle
write functionality.

00:07:56.466 --> 00:07:57.326 A:middle
With the new group write

00:07:57.326 --> 00:07:59.026 A:middle
functionality, your kernel can

00:07:59.116 --> 00:08:01.866 A:middle
write a 2 by 2 group of pixels

00:07:59.116 --> 00:08:01.866 A:middle
write a 2 by 2 group of pixels

00:08:01.866 --> 00:08:02.906 A:middle
in one evocation.

00:08:03.506 --> 00:08:05.426 A:middle
Now, of course this 2 by 2 group

00:08:05.426 --> 00:08:06.556 A:middle
is a little bit bigger, so

00:08:06.556 --> 00:08:08.486 A:middle
instead of a 3 by 3, we need to

00:08:08.486 --> 00:08:11.186 A:middle
have a 4 by 4 set of pixels read

00:08:11.186 --> 00:08:12.346 A:middle
in order to be able to write

00:08:12.416 --> 00:08:13.696 A:middle
those four pixels.

00:08:14.456 --> 00:08:16.126 A:middle
But, if you do the math, you'll

00:08:16.126 --> 00:08:17.776 A:middle
see that that means we have 16

00:08:17.876 --> 00:08:19.406 A:middle
pixels read for 4 pixels

00:08:19.406 --> 00:08:19.706 A:middle
written.

00:08:19.786 --> 00:08:21.146 A:middle
So, already we're seeing an

00:08:21.146 --> 00:08:22.806 A:middle
advantage here.

00:08:23.676 --> 00:08:26.606 A:middle
The other feature we have is the

00:08:26.606 --> 00:08:28.656 A:middle
ability to do gathers.

00:08:29.156 --> 00:08:31.506 A:middle
In this example, we're reading a

00:08:31.506 --> 00:08:33.426 A:middle
4 by 4 or 16 pixels.

00:08:33.706 --> 00:08:35.366 A:middle
And with this feature, we can do

00:08:35.366 --> 00:08:37.895 A:middle
these 16 pixels red with just

00:08:37.895 --> 00:08:38.836 A:middle
four instructions.

00:08:39.506 --> 00:08:40.936 A:middle
So again, if you look at the

00:08:40.936 --> 00:08:42.025 A:middle
math on this, this means we're

00:08:42.025 --> 00:08:43.626 A:middle
doing just 4 group reads for

00:08:43.626 --> 00:08:44.886 A:middle
every 4 pixels written.

00:08:44.886 --> 00:08:46.886 A:middle
And this can really help the

00:08:46.996 --> 00:08:47.646 A:middle
performance.

00:08:47.826 --> 00:08:48.596 A:middle
Let me walk you through the

00:08:48.596 --> 00:08:50.466 A:middle
process of this on actual kernel

00:08:50.466 --> 00:08:50.656 A:middle
code.

00:08:52.026 --> 00:08:54.736 A:middle
So, here's an example of a

00:08:54.736 --> 00:08:56.186 A:middle
simple convolution like the one

00:08:56.186 --> 00:08:56.946 A:middle
I described.

00:08:57.596 --> 00:08:58.886 A:middle
Here, what we're doing is making

00:08:58.886 --> 00:09:01.236 A:middle
9 samples from the input image

00:08:58.886 --> 00:09:01.236 A:middle
9 samples from the input image

00:09:01.486 --> 00:09:02.556 A:middle
and we're only using the red

00:09:02.556 --> 00:09:03.106 A:middle
channel of it.

00:09:03.756 --> 00:09:05.486 A:middle
And then once we have those 9

00:09:05.486 --> 00:09:06.596 A:middle
values, we're going to average

00:09:06.596 --> 00:09:08.146 A:middle
those 9 values and write them

00:09:08.146 --> 00:09:09.516 A:middle
out in the traditional way by

00:09:09.516 --> 00:09:11.146 A:middle
returning a single vec4 pixel

00:09:11.426 --> 00:09:11.996 A:middle
value.

00:09:12.606 --> 00:09:15.586 A:middle
Now, first step to make this

00:09:15.586 --> 00:09:16.776 A:middle
faster is to convert this to

00:09:16.776 --> 00:09:16.976 A:middle
Metal.

00:09:17.176 --> 00:09:18.366 A:middle
This is actually quite simple.

00:09:18.366 --> 00:09:19.576 A:middle
So, we start with code that

00:09:19.576 --> 00:09:20.876 A:middle
looks like this, which is our

00:09:20.876 --> 00:09:22.196 A:middle
traditional CI kernel language.

00:09:22.656 --> 00:09:23.646 A:middle
And with effectively, some

00:09:23.646 --> 00:09:24.796 A:middle
searching and replacing in your

00:09:24.796 --> 00:09:26.646 A:middle
code, you could update this to

00:09:26.646 --> 00:09:28.686 A:middle
the new Metal-based CI kernel

00:09:28.686 --> 00:09:29.136 A:middle
language.

00:09:29.346 --> 00:09:30.186 A:middle
There's a couple things that are

00:09:30.186 --> 00:09:31.086 A:middle
important to notice here.

00:09:31.496 --> 00:09:33.806 A:middle
We have added a destination

00:09:33.806 --> 00:09:35.096 A:middle
parameter to the kernel, and

00:09:35.096 --> 00:09:36.606 A:middle
this is important if you're

00:09:37.106 --> 00:09:38.236 A:middle
checking for the destination

00:09:38.236 --> 00:09:39.756 A:middle
coordinate inside your shader,

00:09:39.756 --> 00:09:41.436 A:middle
which a convolution-like kernel

00:09:41.436 --> 00:09:42.156 A:middle
like this does.

00:09:42.686 --> 00:09:44.056 A:middle
And then we're using the new,

00:09:44.056 --> 00:09:45.686 A:middle
more modern syntax to sample

00:09:45.886 --> 00:09:47.146 A:middle
from the input by just saying

00:09:47.146 --> 00:09:49.056 A:middle
sample -- s.sample and

00:09:49.056 --> 00:09:49.986 A:middle
s.transform.

00:09:50.806 --> 00:09:52.246 A:middle
And the last thing we've done

00:09:52.246 --> 00:09:53.416 A:middle
when we've updated this code is

00:09:53.416 --> 00:09:55.666 A:middle
to change the traditional vec4

00:09:55.666 --> 00:09:57.266 A:middle
and vec2 parameter types to

00:09:57.706 --> 00:09:59.756 A:middle
float 4 and float 2.

00:10:00.296 --> 00:10:01.976 A:middle
But as you can see, the overall

00:10:01.976 --> 00:10:03.366 A:middle
architecture of the code, the

00:10:03.426 --> 00:10:06.646 A:middle
flow of the kernel is the same.

00:10:06.806 --> 00:10:07.116 A:middle
All right.

00:10:07.176 --> 00:10:09.616 A:middle
Step 2 is to use half-floats.

00:10:10.156 --> 00:10:11.766 A:middle
Again, this is an example where

00:10:11.766 --> 00:10:13.286 A:middle
we can get away with just using

00:10:13.286 --> 00:10:14.376 A:middle
the precision of half-floats

00:10:14.376 --> 00:10:15.376 A:middle
because we're just working with

00:10:15.376 --> 00:10:17.256 A:middle
color values, and so again,

00:10:17.256 --> 00:10:18.136 A:middle
we're going to make again some

00:10:18.296 --> 00:10:19.766 A:middle
very simple changes to our code.

00:10:20.336 --> 00:10:21.866 A:middle
Basically, places in our code

00:10:21.866 --> 00:10:24.556 A:middle
where we were using floating

00:10:24.556 --> 00:10:25.436 A:middle
point precision, we're going to

00:10:25.436 --> 00:10:26.886 A:middle
use half-float precision as

00:10:26.886 --> 00:10:27.096 A:middle
well.

00:10:27.396 --> 00:10:29.246 A:middle
This means the sampler parameter

00:10:29.246 --> 00:10:30.396 A:middle
and the destination parameter

00:10:30.596 --> 00:10:32.486 A:middle
have an underscore H suffix on

00:10:32.486 --> 00:10:34.666 A:middle
them and any case in their code

00:10:34.666 --> 00:10:36.506 A:middle
where we're using float 4 now

00:10:36.506 --> 00:10:37.246 A:middle
becomes half 4.

00:10:38.226 --> 00:10:39.376 A:middle
So again, this is very simple

00:10:39.376 --> 00:10:40.056 A:middle
and easy to do.

00:10:40.056 --> 00:10:41.356 A:middle
Another thing to be aware of is

00:10:41.356 --> 00:10:42.926 A:middle
if you've got constancy in your

00:10:42.926 --> 00:10:43.926 A:middle
code, you want to make sure to

00:10:43.926 --> 00:10:45.276 A:middle
add the H on the end of them,

00:10:45.276 --> 00:10:47.006 A:middle
like the dividing by 9.0.

00:10:47.596 --> 00:10:49.606 A:middle
So again these -- this is

00:10:49.606 --> 00:10:50.516 A:middle
another simple thing.

00:10:51.146 --> 00:10:53.136 A:middle
The last thing we're going to do

00:10:53.136 --> 00:10:54.226 A:middle
to get the best performance out

00:10:54.226 --> 00:10:55.916 A:middle
of this example is to leverage

00:10:55.916 --> 00:10:57.296 A:middle
group reads and group writes.

00:10:57.446 --> 00:10:58.536 A:middle
So, let me walk you through the

00:10:58.856 --> 00:10:59.746 A:middle
code to do this.

00:11:00.276 --> 00:11:02.706 A:middle
So, again, we want to write a 2

00:11:02.706 --> 00:11:04.196 A:middle
by 2 group of pixels, and from

00:11:04.196 --> 00:11:06.066 A:middle
that we need to read from a 4 by

00:11:06.066 --> 00:11:07.186 A:middle
4 group of pixels.

00:11:07.826 --> 00:11:09.086 A:middle
So, the first thing we're going

00:11:09.086 --> 00:11:10.406 A:middle
to do is specify that we want a

00:11:10.406 --> 00:11:11.346 A:middle
group destination.

00:11:11.346 --> 00:11:13.306 A:middle
If you look at the function

00:11:13.306 --> 00:11:14.866 A:middle
declaration, it now has a group

00:11:14.916 --> 00:11:17.286 A:middle
destination, H datatype.

00:11:18.056 --> 00:11:19.106 A:middle
Then, we're going to get the

00:11:19.106 --> 00:11:20.246 A:middle
destination coordinate like we

00:11:20.246 --> 00:11:21.606 A:middle
had before, and that will point

00:11:21.606 --> 00:11:22.716 A:middle
to the center of a pixel.

00:11:23.046 --> 00:11:24.676 A:middle
However, that coordinate

00:11:24.676 --> 00:11:26.246 A:middle
actually represents the

00:11:26.676 --> 00:11:29.086 A:middle
coordinate of a group of 2 by 2

00:11:29.086 --> 00:11:29.596 A:middle
pixels.

00:11:30.766 --> 00:11:32.006 A:middle
The next thing we're going to do

00:11:32.306 --> 00:11:34.636 A:middle
in order to fill in this 2 by 2

00:11:34.636 --> 00:11:36.346 A:middle
group of pixels is do a bunch of

00:11:36.346 --> 00:11:37.196 A:middle
reads from the image.

00:11:37.726 --> 00:11:40.396 A:middle
So, the first gather read is

00:11:40.396 --> 00:11:41.976 A:middle
going to read from a 2 by 2

00:11:41.976 --> 00:11:43.816 A:middle
group of pixels -- in this case,

00:11:43.816 --> 00:11:45.306 A:middle
the lower left-hand corner of

00:11:45.306 --> 00:11:46.456 A:middle
our 16.

00:11:46.456 --> 00:11:48.176 A:middle
And it's going to return the

00:11:48.176 --> 00:11:51.276 A:middle
value of the red channel in a

00:11:51.766 --> 00:11:53.596 A:middle
half-four array.

00:11:54.856 --> 00:11:56.596 A:middle
The four parameters will be

00:11:56.596 --> 00:11:57.966 A:middle
stored in this order, which is

00:11:57.966 --> 00:12:01.126 A:middle
X, Y, Z, W going in a

00:11:57.966 --> 00:12:01.126 A:middle
X, Y, Z, W going in a

00:12:01.336 --> 00:12:02.466 A:middle
counter-clockwise direction.

00:12:02.466 --> 00:12:04.006 A:middle
This is the same direction that

00:12:04.006 --> 00:12:05.096 A:middle
is used in Metal, if you're

00:12:05.096 --> 00:12:07.776 A:middle
familiar with the gather

00:12:07.776 --> 00:12:08.816 A:middle
operations in Metal.

00:12:10.136 --> 00:12:11.506 A:middle
So, again in that one

00:12:11.506 --> 00:12:12.686 A:middle
instruction we've done four

00:12:12.686 --> 00:12:13.966 A:middle
reads and we're going to repeat

00:12:13.966 --> 00:12:15.356 A:middle
this process for the other

00:12:15.356 --> 00:12:16.056 A:middle
groups of four.

00:12:16.196 --> 00:12:17.946 A:middle
So, we're going to get group 2,

00:12:18.296 --> 00:12:20.006 A:middle
group 3, and group 4.

00:12:20.766 --> 00:12:22.346 A:middle
Now that we've done all 16

00:12:22.346 --> 00:12:23.626 A:middle
reads, we need to figure out

00:12:24.076 --> 00:12:25.186 A:middle
what values go in what

00:12:25.186 --> 00:12:25.866 A:middle
locations.

00:12:26.246 --> 00:12:27.286 A:middle
So, the first thing we're going

00:12:27.286 --> 00:12:29.626 A:middle
to do is get the appropriate

00:12:29.626 --> 00:12:31.466 A:middle
channels of this 3 by 3 sub

00:12:31.466 --> 00:12:34.066 A:middle
group and average them together.

00:12:34.066 --> 00:12:35.396 A:middle
And then we're going to store

00:12:35.396 --> 00:12:38.486 A:middle
those channels into the result 1

00:12:38.486 --> 00:12:38.886 A:middle
variable.

00:12:39.516 --> 00:12:40.486 A:middle
And we're going to repeat this

00:12:40.486 --> 00:12:42.016 A:middle
process for the other four

00:12:42.016 --> 00:12:45.576 A:middle
result pixels that we want to

00:12:45.576 --> 00:12:46.106 A:middle
write -- R1, R2, R3, and R4.

00:12:46.106 --> 00:12:48.616 A:middle
And the last thing we're going

00:12:48.616 --> 00:12:50.366 A:middle
to do is called "Destination

00:12:50.366 --> 00:12:52.956 A:middle
Write" to write the 4 pixels all

00:12:52.956 --> 00:12:53.806 A:middle
in one operation.

00:12:54.156 --> 00:12:55.256 A:middle
So note, this is a little

00:12:55.256 --> 00:12:56.756 A:middle
different from a traditional CI

00:12:56.926 --> 00:12:58.006 A:middle
kernel where you would've

00:12:58.006 --> 00:13:00.536 A:middle
returned a value from your

00:12:58.006 --> 00:13:00.536 A:middle
returned a value from your

00:13:00.536 --> 00:13:01.886 A:middle
kernel and said you're going to

00:13:01.886 --> 00:13:02.976 A:middle
be calling "Destination Write"

00:13:03.016 --> 00:13:03.416 A:middle
instead.

00:13:03.416 --> 00:13:04.026 A:middle
All right.

00:13:04.796 --> 00:13:08.676 A:middle
So, the great result of all this

00:13:08.746 --> 00:13:10.186 A:middle
is that with very little effort,

00:13:10.326 --> 00:13:12.006 A:middle
we can now get two times the

00:13:12.006 --> 00:13:13.496 A:middle
performance in this exact

00:13:13.496 --> 00:13:13.786 A:middle
shader.

00:13:13.786 --> 00:13:14.976 A:middle
This is a very simple shader.

00:13:14.976 --> 00:13:16.546 A:middle
You can actually get similar

00:13:16.546 --> 00:13:17.786 A:middle
results in many other types of

00:13:17.786 --> 00:13:18.896 A:middle
shaders, especially ones that

00:13:18.896 --> 00:13:19.996 A:middle
are doing convolutions.

00:13:20.746 --> 00:13:21.926 A:middle
So, this is a great way of

00:13:21.926 --> 00:13:23.526 A:middle
adding performance to your

00:13:23.796 --> 00:13:24.136 A:middle
kernels.

00:13:24.136 --> 00:13:26.826 A:middle
So I'm going to seg -- I like to

00:13:26.996 --> 00:13:28.536 A:middle
tell people to go to this great

00:13:28.536 --> 00:13:29.916 A:middle
new documentation that we have

00:13:29.916 --> 00:13:32.076 A:middle
for our kernel language, both

00:13:32.076 --> 00:13:33.086 A:middle
the traditional CI kernel

00:13:33.086 --> 00:13:35.306 A:middle
language and the CI kernel

00:13:35.306 --> 00:13:36.356 A:middle
language that's based on Metal.

00:13:36.616 --> 00:13:37.936 A:middle
I highly encourage you to go and

00:13:37.936 --> 00:13:39.016 A:middle
read this documentation.

00:13:39.566 --> 00:13:40.596 A:middle
But now that we've talked about

00:13:40.596 --> 00:13:42.046 A:middle
improving the performance of how

00:13:42.046 --> 00:13:43.836 A:middle
your kernels can run, I'd like

00:13:43.836 --> 00:13:45.946 A:middle
to bring up Emanuel on stage,

00:13:45.946 --> 00:13:47.246 A:middle
who will help talk to you about

00:13:47.246 --> 00:13:48.126 A:middle
how you can make your

00:13:48.126 --> 00:13:49.426 A:middle
development process of new

00:13:49.426 --> 00:13:50.786 A:middle
algorithms even faster as well.

00:13:51.516 --> 00:13:55.546 A:middle
[ Applause ]

00:13:56.046 --> 00:13:56.936 A:middle
&gt;&gt; Thank you, David.

00:13:59.246 --> 00:14:00.116 A:middle
Good afternoon everyone.

00:13:59.246 --> 00:14:00.116 A:middle
Good afternoon everyone.

00:14:00.666 --> 00:14:01.496 A:middle
It's great to be here.

00:14:01.626 --> 00:14:03.036 A:middle
My name is Emmanuel, I'm an

00:14:03.036 --> 00:14:04.116 A:middle
engineer on a Core Image team.

00:14:05.436 --> 00:14:07.036 A:middle
So, during the next half of this

00:14:07.036 --> 00:14:08.766 A:middle
session, we'll shift our focus

00:14:08.766 --> 00:14:10.206 A:middle
away from the Core Image Engine

00:14:10.356 --> 00:14:12.946 A:middle
and explore novel ways to

00:14:12.946 --> 00:14:14.066 A:middle
prototype using Core Image.

00:14:14.916 --> 00:14:17.266 A:middle
We'll also see how we can

00:14:17.266 --> 00:14:18.206 A:middle
leverage Core Image in your

00:14:18.206 --> 00:14:19.286 A:middle
machine learning applications.

00:14:19.876 --> 00:14:20.806 A:middle
So let's get started.

00:14:21.226 --> 00:14:23.356 A:middle
Since I want to talk about

00:14:23.356 --> 00:14:24.966 A:middle
prototyping, let's take a look

00:14:25.076 --> 00:14:27.076 A:middle
at the lifecycle of an image

00:14:27.076 --> 00:14:27.816 A:middle
processing filter.

00:14:30.256 --> 00:14:33.136 A:middle
So, let's say that we are trying

00:14:33.136 --> 00:14:34.696 A:middle
to come up with a foreground to

00:14:34.696 --> 00:14:35.676 A:middle
background segmentation.

00:14:35.836 --> 00:14:38.506 A:middle
And here, what this means

00:14:38.506 --> 00:14:39.546 A:middle
precisely is that we'd like to

00:14:39.546 --> 00:14:41.076 A:middle
get a mask which is 1.0 in the

00:14:41.076 --> 00:14:43.076 A:middle
foreground; 0.0 in the

00:14:43.076 --> 00:14:44.596 A:middle
background and has continuous

00:14:44.596 --> 00:14:45.426 A:middle
values in between.

00:14:46.116 --> 00:14:48.256 A:middle
The difficulty in implementing

00:14:48.256 --> 00:14:49.986 A:middle
such a filter heavily depends on

00:14:49.986 --> 00:14:51.056 A:middle
the nature of data you have

00:14:51.056 --> 00:14:51.576 A:middle
available.

00:14:51.706 --> 00:14:54.466 A:middle
So, for example, if you have an

00:14:54.466 --> 00:14:56.006 A:middle
additional depth buffer,

00:14:56.406 --> 00:14:58.926 A:middle
alongside your RGB image, things

00:14:58.926 --> 00:15:00.246 A:middle
can become easier.

00:14:58.926 --> 00:15:00.246 A:middle
can become easier.

00:15:00.536 --> 00:15:01.456 A:middle
And if you're interested to

00:15:01.456 --> 00:15:03.736 A:middle
combine RGB images with depth

00:15:03.736 --> 00:15:05.576 A:middle
information, I highly encourage

00:15:05.576 --> 00:15:07.466 A:middle
you to look at the session on

00:15:07.466 --> 00:15:08.676 A:middle
creating photo and video effects

00:15:08.676 --> 00:15:09.116 A:middle
using that.

00:15:10.506 --> 00:15:12.736 A:middle
Today, I don't want to focus on

00:15:12.736 --> 00:15:13.706 A:middle
these other sources of

00:15:13.706 --> 00:15:15.016 A:middle
information, but I want to focus

00:15:15.016 --> 00:15:16.296 A:middle
on prototyping in general, so --

00:15:16.956 --> 00:15:20.726 A:middle
so let's say that -- so, we have

00:15:20.726 --> 00:15:23.766 A:middle
this filter well-drafted, and we

00:15:23.766 --> 00:15:24.946 A:middle
know the effect we're trying to

00:15:25.046 --> 00:15:25.906 A:middle
come up with, so in this

00:15:25.906 --> 00:15:26.926 A:middle
particular case, a foreground

00:15:26.926 --> 00:15:27.716 A:middle
and background mask.

00:15:28.526 --> 00:15:30.246 A:middle
The very next natural step is to

00:15:30.246 --> 00:15:32.286 A:middle
try implementing it, and you

00:15:32.286 --> 00:15:33.256 A:middle
pick your favorite prototype in

00:15:33.256 --> 00:15:34.826 A:middle
the stack and you start hacking

00:15:34.826 --> 00:15:36.806 A:middle
away and combining different

00:15:36.806 --> 00:15:37.986 A:middle
filters together and showing

00:15:37.986 --> 00:15:39.506 A:middle
them in such a way that you

00:15:39.886 --> 00:15:41.446 A:middle
achieve the filter effect that

00:15:41.446 --> 00:15:42.436 A:middle
you're looking after.

00:15:44.006 --> 00:15:45.446 A:middle
So, let's say you did just that,

00:15:45.446 --> 00:15:46.796 A:middle
and here we have an example of

00:15:46.796 --> 00:15:49.826 A:middle
such a foreground to background

00:15:50.066 --> 00:15:50.476 A:middle
mask.

00:15:51.476 --> 00:15:52.906 A:middle
Now, if you're in an iOS or Mac

00:15:52.906 --> 00:15:54.576 A:middle
OS environment, the very next

00:15:54.576 --> 00:15:57.086 A:middle
natural step is to deploy that

00:15:57.086 --> 00:15:57.686 A:middle
algorithm.

00:15:57.686 --> 00:16:00.226 A:middle
So, you have a variety of

00:15:57.686 --> 00:16:00.226 A:middle
So, you have a variety of

00:16:00.226 --> 00:16:01.286 A:middle
[inaudible] that you can use

00:16:01.286 --> 00:16:02.176 A:middle
such as Core Image,

00:16:04.416 --> 00:16:05.926 A:middle
Metal-with-Metal performance

00:16:05.926 --> 00:16:07.886 A:middle
shaders, as well as VImage if

00:16:07.886 --> 00:16:09.176 A:middle
you want to stay on the CPU.

00:16:10.456 --> 00:16:12.106 A:middle
That initial port from prototype

00:16:12.106 --> 00:16:13.886 A:middle
to production can be quite time

00:16:13.886 --> 00:16:15.086 A:middle
consuming, and the very first

00:16:15.086 --> 00:16:17.416 A:middle
render might not exactly look

00:16:17.416 --> 00:16:18.416 A:middle
like what you're expecting.

00:16:19.406 --> 00:16:21.256 A:middle
And there is a great variety of

00:16:21.256 --> 00:16:22.476 A:middle
sources that can contribute to

00:16:22.476 --> 00:16:24.146 A:middle
these pixel differences, one of

00:16:24.346 --> 00:16:25.756 A:middle
them being simply the fact that

00:16:25.756 --> 00:16:26.786 A:middle
the way filters are implemented

00:16:26.786 --> 00:16:28.576 A:middle
across frameworks can be quite

00:16:28.576 --> 00:16:29.016 A:middle
different.

00:16:29.216 --> 00:16:30.726 A:middle
If you take an example here on

00:16:30.726 --> 00:16:32.236 A:middle
the left-hand side, we have a

00:16:32.236 --> 00:16:33.336 A:middle
[inaudible] blur that applies

00:16:33.336 --> 00:16:34.866 A:middle
this nice feathering from

00:16:34.866 --> 00:16:36.116 A:middle
foreground to background.

00:16:36.526 --> 00:16:37.496 A:middle
And that's an example of a

00:16:37.496 --> 00:16:40.106 A:middle
filter that can leverage a grid

00:16:40.106 --> 00:16:41.096 A:middle
variety of performance

00:16:41.096 --> 00:16:42.586 A:middle
optimizations under the hood to

00:16:42.586 --> 00:16:43.576 A:middle
make it much faster.

00:16:44.436 --> 00:16:46.226 A:middle
All these optimizations can

00:16:46.226 --> 00:16:47.836 A:middle
introduce numerical errors which

00:16:47.836 --> 00:16:48.916 A:middle
will propagate in your filter

00:16:48.916 --> 00:16:51.436 A:middle
stack, thereby potentially

00:16:51.556 --> 00:16:53.286 A:middle
creating dramatic changes in

00:16:53.286 --> 00:16:54.036 A:middle
your filter output.

00:16:55.806 --> 00:16:56.906 A:middle
Another problem that typically

00:16:56.906 --> 00:16:58.026 A:middle
arises when you're putting your

00:16:58.026 --> 00:16:59.626 A:middle
code, is that when you're

00:16:59.626 --> 00:17:00.866 A:middle
prototyping environment, a lot

00:16:59.626 --> 00:17:00.866 A:middle
prototyping environment, a lot

00:17:00.866 --> 00:17:01.736 A:middle
of the memory management is

00:17:01.736 --> 00:17:02.586 A:middle
taken care of for you.

00:17:02.586 --> 00:17:04.266 A:middle
So, you don't often run into

00:17:04.266 --> 00:17:05.606 A:middle
issues of memory pressure and

00:17:05.606 --> 00:17:07.366 A:middle
memory consumption until it's

00:17:07.366 --> 00:17:09.626 A:middle
pretty late in the game.

00:17:10.376 --> 00:17:11.886 A:middle
Another topic, of course, that's

00:17:11.886 --> 00:17:15.016 A:middle
important to consider is

00:17:15.016 --> 00:17:16.076 A:middle
performance.

00:17:16.165 --> 00:17:17.886 A:middle
Oftentimes, the prototypes are

00:17:17.886 --> 00:17:19.796 A:middle
already using CPU code, and we

00:17:19.796 --> 00:17:21.455 A:middle
over - sometimes-- we often

00:17:21.455 --> 00:17:22.695 A:middle
over-estimate the amount of

00:17:22.695 --> 00:17:23.896 A:middle
performance we can get from

00:17:23.896 --> 00:17:25.536 A:middle
pointing our CP Code to GP Code,

00:17:25.536 --> 00:17:26.306 A:middle
thinking that everything is

00:17:26.306 --> 00:17:27.106 A:middle
going to get real-time.

00:17:27.746 --> 00:17:30.616 A:middle
So, what if we could catch these

00:17:30.616 --> 00:17:33.106 A:middle
concerns way, way earlier on in

00:17:33.106 --> 00:17:34.146 A:middle
our prototyping and workflow?

00:17:35.116 --> 00:17:36.356 A:middle
Well, we believe we have a

00:17:36.356 --> 00:17:37.086 A:middle
solution for you.

00:17:37.606 --> 00:17:39.476 A:middle
And it's called PyCoreImage.

00:17:39.536 --> 00:17:41.136 A:middle
Python bindings for Core Image.

00:17:42.386 --> 00:17:43.526 A:middle
So, this is combining the

00:17:43.526 --> 00:17:45.636 A:middle
high-performance rendering of

00:17:45.636 --> 00:17:48.066 A:middle
Core Image with the flexibility

00:17:48.216 --> 00:17:49.136 A:middle
of the Python programming

00:17:49.136 --> 00:17:50.256 A:middle
language together.

00:17:51.166 --> 00:17:52.366 A:middle
And by using Core Image, you

00:17:52.366 --> 00:17:54.066 A:middle
also inherit its support for

00:17:54.066 --> 00:17:56.466 A:middle
both iOS and Mac OS along with

00:17:56.526 --> 00:17:58.106 A:middle
more than 200 built-in filters.

00:17:58.536 --> 00:18:00.626 A:middle
Let's take a look at what's

00:17:58.536 --> 00:18:00.626 A:middle
Let's take a look at what's

00:18:00.626 --> 00:18:02.296 A:middle
under the hood of PyCoreImage.

00:18:03.566 --> 00:18:05.906 A:middle
So, PyCoreImage is made of three

00:18:05.906 --> 00:18:06.656 A:middle
main pieces.

00:18:07.206 --> 00:18:09.366 A:middle
It uses Core Image for its

00:18:09.366 --> 00:18:10.086 A:middle
rendering back end.

00:18:10.636 --> 00:18:12.216 A:middle
It uses Python for the

00:18:12.216 --> 00:18:13.806 A:middle
programming interface.

00:18:14.296 --> 00:18:16.796 A:middle
And it had -- it also has a thin

00:18:16.796 --> 00:18:19.106 A:middle
layer of an [inaudible] code to

00:18:19.106 --> 00:18:20.416 A:middle
allow interoperability with your

00:18:20.416 --> 00:18:21.356 A:middle
existing code bases.

00:18:22.356 --> 00:18:24.526 A:middle
We believe PyCoreImage can now

00:18:24.526 --> 00:18:25.686 A:middle
allow you to reduce the friction

00:18:25.686 --> 00:18:27.466 A:middle
between your prototyping and

00:18:27.466 --> 00:18:28.206 A:middle
product-ready code.

00:18:28.796 --> 00:18:30.126 A:middle
If you'd like to stay in a

00:18:30.126 --> 00:18:31.576 A:middle
Swift-centric environment, a lot

00:18:31.576 --> 00:18:32.686 A:middle
of that can be done as well

00:18:32.686 --> 00:18:34.316 A:middle
using Swift playgrounds, and we

00:18:34.316 --> 00:18:35.066 A:middle
encourage you to look at a

00:18:35.066 --> 00:18:36.146 A:middle
session on creating your own

00:18:36.146 --> 00:18:38.936 A:middle
Swift playgrounds subscription.

00:18:41.016 --> 00:18:42.256 A:middle
All right.

00:18:42.506 --> 00:18:44.086 A:middle
Let's take a look at the main

00:18:44.086 --> 00:18:45.386 A:middle
components of PyCoreImage.

00:18:46.266 --> 00:18:48.276 A:middle
So, PyCoreImage leverages Python

00:18:48.276 --> 00:18:50.036 A:middle
bindings for objective C, PyObjC

00:18:50.036 --> 00:18:52.536 A:middle
and interestingly, we've been

00:18:52.536 --> 00:18:54.256 A:middle
shipping PyObjC since Mac OS

00:18:54.256 --> 00:18:55.156 A:middle
10.5 Leopard.

00:18:56.276 --> 00:18:58.096 A:middle
It was initially implemented as

00:18:58.096 --> 00:18:59.316 A:middle
a bidirectional bridge between

00:18:59.316 --> 00:19:01.076 A:middle
Python and Objective C and

00:18:59.316 --> 00:19:01.076 A:middle
Python and Objective C and

00:19:01.076 --> 00:19:02.216 A:middle
[inaudible] in the context of

00:19:02.266 --> 00:19:03.476 A:middle
Coco app development.

00:19:03.476 --> 00:19:04.266 A:middle
But since then it's been

00:19:04.266 --> 00:19:06.276 A:middle
extended to support most Apple

00:19:06.276 --> 00:19:07.426 A:middle
frameworks.

00:19:08.136 --> 00:19:11.426 A:middle
The calling syntax for PyObjC is

00:19:11.426 --> 00:19:12.636 A:middle
very simple, you take your

00:19:12.636 --> 00:19:14.126 A:middle
existing Objective C code and

00:19:14.126 --> 00:19:14.906 A:middle
you place columns with

00:19:14.906 --> 00:19:15.446 A:middle
underscore.

00:19:15.876 --> 00:19:17.336 A:middle
There's a few more intricacies

00:19:17.336 --> 00:19:18.476 A:middle
and I encourage you to look at

00:19:18.476 --> 00:19:19.676 A:middle
the API if you'd like more

00:19:19.676 --> 00:19:20.206 A:middle
information.

00:19:21.096 --> 00:19:22.716 A:middle
But let's take our CIVector

00:19:22.716 --> 00:19:23.836 A:middle
class as an example here.

00:19:24.106 --> 00:19:25.556 A:middle
So here we have some Objective C

00:19:25.556 --> 00:19:26.776 A:middle
code where we create an instance

00:19:26.776 --> 00:19:28.016 A:middle
of a CIVector by calling

00:19:28.016 --> 00:19:31.386 A:middle
CIVector, Vector with X, Y, Z,

00:19:31.386 --> 00:19:31.866 A:middle
W.

00:19:32.986 --> 00:19:34.086 A:middle
Let's take a look a the PyObjC

00:19:34.086 --> 00:19:34.336 A:middle
code.

00:19:34.786 --> 00:19:35.436 A:middle
It's very similar.

00:19:35.586 --> 00:19:36.886 A:middle
We import the CIVector from the

00:19:36.886 --> 00:19:39.376 A:middle
Quartz umbrella package and we

00:19:39.376 --> 00:19:40.506 A:middle
can call a vector with X, Y, Z,

00:19:40.506 --> 00:19:41.906 A:middle
W and the CIVector class

00:19:41.906 --> 00:19:42.246 A:middle
directly.

00:19:42.736 --> 00:19:45.396 A:middle
One thing you may note here is

00:19:45.396 --> 00:19:46.496 A:middle
that the code does not exactly

00:19:46.496 --> 00:19:47.276 A:middle
look Python-like.

00:19:48.106 --> 00:19:49.076 A:middle
And so, we're going to address

00:19:49.076 --> 00:19:50.086 A:middle
that in just a few minutes.

00:19:50.146 --> 00:19:54.566 A:middle
Now, let's take a look at the

00:19:54.566 --> 00:19:55.076 A:middle
[inaudible] gram for

00:19:55.076 --> 00:19:55.766 A:middle
PyCoreImage.

00:19:56.076 --> 00:19:57.446 A:middle
So the rendering back in is then

00:19:57.446 --> 00:19:59.006 A:middle
using Core Image, and Core Image

00:19:59.006 --> 00:20:00.476 A:middle
is very close to the hardware,

00:19:59.006 --> 00:20:00.476 A:middle
is very close to the hardware,

00:20:00.556 --> 00:20:01.786 A:middle
so it's able to redirect your

00:20:01.786 --> 00:20:02.996 A:middle
filtered calls to the most

00:20:02.996 --> 00:20:04.036 A:middle
appropriate rendering back end,

00:20:04.616 --> 00:20:05.656 A:middle
to give you as much performance

00:20:05.656 --> 00:20:06.256 A:middle
as possible.

00:20:07.496 --> 00:20:08.936 A:middle
PyObjC lives on top of Core

00:20:08.936 --> 00:20:10.276 A:middle
Image, and it can communicate

00:20:10.276 --> 00:20:11.916 A:middle
with it through the Python

00:20:11.916 --> 00:20:13.556 A:middle
bindings for Core Image by the

00:20:13.556 --> 00:20:15.106 A:middle
Quartz umbrella package.

00:20:15.726 --> 00:20:18.116 A:middle
And the Quartz is a package that

00:20:18.116 --> 00:20:19.546 A:middle
also contains a variety of other

00:20:19.546 --> 00:20:20.676 A:middle
image processing frameworks such

00:20:20.676 --> 00:20:22.426 A:middle
as Core Graphics, and all the

00:20:22.426 --> 00:20:24.006 A:middle
classes that's using Core Image,

00:20:24.006 --> 00:20:25.916 A:middle
such as CIVector, CIImages, and

00:20:25.916 --> 00:20:26.646 A:middle
CI Context.

00:20:28.766 --> 00:20:29.966 A:middle
PyCoreImage lives on top of

00:20:29.966 --> 00:20:31.946 A:middle
PyObjC, and it provides--

00:20:33.586 --> 00:20:36.056 A:middle
essentially leverages PyObjC to

00:20:36.056 --> 00:20:37.236 A:middle
be able to communicate with Core

00:20:37.236 --> 00:20:38.736 A:middle
Image and makes a lot of

00:20:38.736 --> 00:20:39.826 A:middle
simplifications under the hood

00:20:39.826 --> 00:20:41.906 A:middle
for you, so that you don't have

00:20:41.906 --> 00:20:43.196 A:middle
as much setup code when you're

00:20:43.196 --> 00:20:44.116 A:middle
working with Core Image.

00:20:44.116 --> 00:20:45.036 A:middle
And we'll take a look at this in

00:20:45.036 --> 00:20:45.616 A:middle
just a moment.

00:20:46.156 --> 00:20:48.046 A:middle
A lot of it is done through the

00:20:48.046 --> 00:20:50.596 A:middle
class CIMG that you can also use

00:20:50.876 --> 00:20:52.126 A:middle
to interpret with NumPy via

00:20:52.126 --> 00:20:52.976 A:middle
vendor call.

00:20:53.816 --> 00:20:55.656 A:middle
And you can also wrap your NumPy

00:20:55.656 --> 00:20:57.226 A:middle
buffers by using the class

00:20:57.226 --> 00:20:58.166 A:middle
constructor directly.

00:20:59.546 --> 00:21:00.696 A:middle
All right.

00:20:59.546 --> 00:21:00.696 A:middle
All right.

00:21:00.696 --> 00:21:02.116 A:middle
So, let's take an example how

00:21:02.116 --> 00:21:03.086 A:middle
you can apply a filter using

00:21:03.086 --> 00:21:04.326 A:middle
PyCoreImage, and you'll see just

00:21:04.326 --> 00:21:05.376 A:middle
how simple and powerful the

00:21:05.566 --> 00:21:06.196 A:middle
framework is.

00:21:06.526 --> 00:21:07.996 A:middle
So, the very first thing you

00:21:07.996 --> 00:21:09.466 A:middle
want to do is import your CIMG

00:21:09.466 --> 00:21:10.726 A:middle
class from your PyCoreImage

00:21:10.726 --> 00:21:13.086 A:middle
package, which we can then use

00:21:13.086 --> 00:21:14.126 A:middle
to load the image from file.

00:21:15.526 --> 00:21:17.766 A:middle
Note that at this point we don't

00:21:17.766 --> 00:21:18.656 A:middle
have a pixel buffer.

00:21:19.126 --> 00:21:21.296 A:middle
Core Image creates recipes for

00:21:21.296 --> 00:21:22.626 A:middle
images and in [inaudible] the

00:21:22.626 --> 00:21:24.836 A:middle
recipe is just giving

00:21:24.836 --> 00:21:25.816 A:middle
instruction to load the image

00:21:25.816 --> 00:21:26.276 A:middle
from file.

00:21:26.626 --> 00:21:28.546 A:middle
You can create a more

00:21:28.546 --> 00:21:30.166 A:middle
complicated graph by applying a

00:21:30.166 --> 00:21:31.686 A:middle
filter, by just calling the CI

00:21:32.076 --> 00:21:33.716 A:middle
filter name on it and passing

00:21:33.716 --> 00:21:34.596 A:middle
the input primaries in this

00:21:34.596 --> 00:21:35.366 A:middle
case, a radius.

00:21:35.646 --> 00:21:36.726 A:middle
And we can that we are

00:21:36.726 --> 00:21:37.796 A:middle
assembling a more complicated

00:21:37.796 --> 00:21:38.226 A:middle
graph.

00:21:38.226 --> 00:21:40.006 A:middle
And if we zoom on it, we can see

00:21:40.006 --> 00:21:41.276 A:middle
that we have out blur processor

00:21:41.426 --> 00:21:41.996 A:middle
right at the middle.

00:21:43.146 --> 00:21:44.766 A:middle
If you want to get your pixel

00:21:44.766 --> 00:21:46.066 A:middle
buffer representation, what you

00:21:46.066 --> 00:21:47.956 A:middle
can do is call render on your

00:21:47.956 --> 00:21:48.866 A:middle
CIMG instance.

00:21:48.986 --> 00:21:50.896 A:middle
And what you get out is a proper

00:21:50.896 --> 00:21:52.000 A:middle
unit by buffer.

00:21:56.066 --> 00:21:57.206 A:middle
So, to make that possible, we

00:21:57.206 --> 00:21:57.876 A:middle
need to make a few

00:21:57.876 --> 00:21:59.666 A:middle
simplifications on how Core

00:21:59.666 --> 00:22:00.716 A:middle
Image is called or do a bit of

00:21:59.666 --> 00:22:00.716 A:middle
Image is called or do a bit of

00:22:00.816 --> 00:22:01.896 A:middle
the setup code for you.

00:22:02.106 --> 00:22:04.356 A:middle
So, for those of you who are

00:22:04.356 --> 00:22:05.606 A:middle
already familiar with Core

00:22:05.606 --> 00:22:08.306 A:middle
Image, this will not come as a

00:22:08.306 --> 00:22:09.396 A:middle
surprise, but for those of you

00:22:09.396 --> 00:22:10.996 A:middle
who are not familiar, please

00:22:11.076 --> 00:22:12.216 A:middle
stay with me until the end.

00:22:12.596 --> 00:22:13.656 A:middle
You'll see the few

00:22:14.176 --> 00:22:15.996 A:middle
simplifications we made, and

00:22:15.996 --> 00:22:17.106 A:middle
that should become very clear.

00:22:17.886 --> 00:22:19.556 A:middle
So, Core Image is a

00:22:19.556 --> 00:22:21.366 A:middle
high-performance GPU image

00:22:21.366 --> 00:22:22.426 A:middle
processing framework that

00:22:22.426 --> 00:22:24.866 A:middle
supports both iOS and Mac OS as

00:22:24.866 --> 00:22:26.186 A:middle
well as a variety of rendering

00:22:26.186 --> 00:22:26.696 A:middle
back ends.

00:22:27.996 --> 00:22:29.056 A:middle
Most pixel formats are

00:22:29.056 --> 00:22:29.516 A:middle
supported.

00:22:29.786 --> 00:22:32.006 A:middle
That, of course means bitmap

00:22:32.006 --> 00:22:34.056 A:middle
data as well as raw files from a

00:22:34.056 --> 00:22:35.186 A:middle
large variety of vendors.

00:22:35.506 --> 00:22:39.396 A:middle
Most file formats are supported,

00:22:40.786 --> 00:22:43.136 A:middle
so, like I said, bitmap data and

00:22:43.476 --> 00:22:44.436 A:middle
raw from a large variety of

00:22:44.436 --> 00:22:46.006 A:middle
vendors, most pixel formats are

00:22:46.006 --> 00:22:46.416 A:middle
separated.

00:22:46.416 --> 00:22:47.976 A:middle
So, for example, you can load

00:22:47.976 --> 00:22:49.916 A:middle
your image in an unsigned 8-bit

00:22:50.326 --> 00:22:51.596 A:middle
through your computation and

00:22:51.596 --> 00:22:53.036 A:middle
half float and during your final

00:22:53.036 --> 00:22:54.826 A:middle
render in full 32-bit float.

00:22:56.466 --> 00:22:57.986 A:middle
Core Image can extract image

00:22:57.986 --> 00:22:59.386 A:middle
metadata for you, for example,

00:22:59.386 --> 00:23:01.416 A:middle
capture time; exist tags, as

00:22:59.386 --> 00:23:01.416 A:middle
capture time; exist tags, as

00:23:01.416 --> 00:23:04.456 A:middle
well as embedded metadata such

00:23:04.456 --> 00:23:06.266 A:middle
as portrait map and portrait

00:23:06.266 --> 00:23:07.086 A:middle
depth information.

00:23:09.466 --> 00:23:10.866 A:middle
Core Image handles color

00:23:10.866 --> 00:23:11.786 A:middle
management very well.

00:23:11.786 --> 00:23:13.086 A:middle
This is a difficult topic on its

00:23:13.086 --> 00:23:14.496 A:middle
own that a lot of frameworks

00:23:14.496 --> 00:23:15.226 A:middle
don't handle.

00:23:16.376 --> 00:23:17.696 A:middle
Core Image supports many battery

00:23:17.696 --> 00:23:20.536 A:middle
conditions, infinite images, and

00:23:20.536 --> 00:23:21.856 A:middle
has more than 200 built-in

00:23:21.856 --> 00:23:23.046 A:middle
filters that you can use, so you

00:23:23.046 --> 00:23:24.066 A:middle
don't need to invent the wheel.

00:23:25.416 --> 00:23:26.226 A:middle
All right, so I don't think I

00:23:26.226 --> 00:23:27.306 A:middle
need to convince you that that's

00:23:27.306 --> 00:23:28.826 A:middle
a lot of information and if

00:23:28.956 --> 00:23:30.246 A:middle
you're trying to use Core Image

00:23:30.246 --> 00:23:31.156 A:middle
in your prototype and your

00:23:31.156 --> 00:23:34.546 A:middle
workflow, the learning curve can

00:23:34.546 --> 00:23:35.186 A:middle
be quite steep.

00:23:35.336 --> 00:23:36.796 A:middle
So what we did is we kept the

00:23:36.796 --> 00:23:38.486 A:middle
best of that list, made a few

00:23:38.486 --> 00:23:39.956 A:middle
simplifications, which,

00:23:39.956 --> 00:23:41.376 A:middle
remember, these simplifications

00:23:41.376 --> 00:23:42.636 A:middle
can all be overridden at one

00:23:42.636 --> 00:23:42.996 A:middle
time.

00:23:43.116 --> 00:23:44.076 A:middle
And since we'll be giving you a

00:23:44.076 --> 00:23:45.536 A:middle
weighted code, you can actually

00:23:45.536 --> 00:23:46.846 A:middle
hardcode these changes in if

00:23:46.846 --> 00:23:48.356 A:middle
this was your prototyping stack.

00:23:48.896 --> 00:23:50.726 A:middle
The first thing we did is that

00:23:50.726 --> 00:23:51.596 A:middle
we still have the

00:23:51.596 --> 00:23:54.036 A:middle
high-performance feature of Core

00:23:54.036 --> 00:23:54.356 A:middle
Image.

00:23:54.356 --> 00:23:55.226 A:middle
We still render to a Metal

00:23:55.226 --> 00:23:55.736 A:middle
backend.

00:23:56.586 --> 00:23:57.566 A:middle
Most all formats are still

00:23:57.566 --> 00:23:59.566 A:middle
supported in and out and we can

00:23:59.566 --> 00:24:00.836 A:middle
still extract capture time of

00:23:59.566 --> 00:24:00.836 A:middle
still extract capture time of

00:24:00.836 --> 00:24:02.456 A:middle
the data as well as portrait

00:24:02.456 --> 00:24:04.756 A:middle
depth and matte information.

00:24:05.656 --> 00:24:06.536 A:middle
Last but not least, you have

00:24:06.536 --> 00:24:08.086 A:middle
more than 200 built-in filters

00:24:08.086 --> 00:24:08.776 A:middle
that you can use.

00:24:09.296 --> 00:24:11.306 A:middle
The first change we made is that

00:24:11.306 --> 00:24:12.826 A:middle
by default, all your renders

00:24:12.826 --> 00:24:14.676 A:middle
will be done using full 32-bit

00:24:14.676 --> 00:24:14.986 A:middle
float.

00:24:16.676 --> 00:24:18.506 A:middle
Second change, everything will

00:24:18.506 --> 00:24:20.266 A:middle
be done using SRGB color spaces.

00:24:21.516 --> 00:24:22.956 A:middle
Third, all the boundary

00:24:22.956 --> 00:24:24.196 A:middle
conditions will be handled with

00:24:24.196 --> 00:24:25.166 A:middle
clamped and cropping.

00:24:25.166 --> 00:24:26.426 A:middle
What that means is, if you're

00:24:26.426 --> 00:24:27.866 A:middle
applying convolution or

00:24:27.866 --> 00:24:29.796 A:middle
creation, for example, your

00:24:29.796 --> 00:24:30.916 A:middle
image will be repeated

00:24:30.916 --> 00:24:31.616 A:middle
infinitely.

00:24:32.256 --> 00:24:33.926 A:middle
A filter will be applied, and

00:24:33.926 --> 00:24:34.716 A:middle
the resulting image will be

00:24:34.716 --> 00:24:36.296 A:middle
cropped back to your input size.

00:24:36.556 --> 00:24:38.236 A:middle
This is a setting that can also

00:24:38.236 --> 00:24:40.526 A:middle
be overridden at one time.

00:24:41.616 --> 00:24:44.146 A:middle
Finally, infinite images become

00:24:44.146 --> 00:24:45.826 A:middle
finite so that we can get their

00:24:45.956 --> 00:24:48.596 A:middle
pixel buffer representation, and

00:24:49.546 --> 00:24:52.326 A:middle
that's what really PyCoreImage

00:24:52.326 --> 00:24:52.976 A:middle
is under the hood.

00:24:53.466 --> 00:24:57.086 A:middle
So, before looking at a great

00:24:57.086 --> 00:24:59.076 A:middle
demo of all of this in practice,

00:24:59.076 --> 00:24:59.986 A:middle
I just want to go through

00:24:59.986 --> 00:25:01.926 A:middle
quickly a cheat sheet for

00:24:59.986 --> 00:25:01.926 A:middle
quickly a cheat sheet for

00:25:01.926 --> 00:25:02.736 A:middle
PyCoreImage.

00:25:02.736 --> 00:25:03.716 A:middle
So, let's have a look at the

00:25:03.716 --> 00:25:03.976 A:middle
API.

00:25:04.996 --> 00:25:06.716 A:middle
So, as you saw earlier, we

00:25:06.716 --> 00:25:08.096 A:middle
import the CIMG class from the

00:25:08.096 --> 00:25:09.086 A:middle
pycoreimage package.

00:25:10.256 --> 00:25:11.766 A:middle
We can use this to load images

00:25:11.796 --> 00:25:12.416 A:middle
fromfile [inaudible].

00:25:12.546 --> 00:25:15.296 A:middle
Here's a Swift equivalent for

00:25:15.296 --> 00:25:16.486 A:middle
those of you who are wondering.

00:25:16.486 --> 00:25:18.056 A:middle
You can use CIImage for contents

00:25:18.056 --> 00:25:18.476 A:middle
of file.

00:25:19.116 --> 00:25:22.206 A:middle
You can use fromfile to load

00:25:22.206 --> 00:25:23.496 A:middle
your portrait matte information

00:25:23.496 --> 00:25:24.506 A:middle
directly as well as your

00:25:24.506 --> 00:25:26.116 A:middle
portrait depth by just using the

00:25:26.116 --> 00:25:28.056 A:middle
optional arguments usedepth and

00:25:28.056 --> 00:25:29.066 A:middle
usematte.

00:25:30.616 --> 00:25:33.646 A:middle
You can interpret with NumPy by

00:25:33.646 --> 00:25:35.806 A:middle
wrapping your NumPy buffers in

00:25:35.806 --> 00:25:37.636 A:middle
the CIImage constructor or

00:25:37.636 --> 00:25:38.876 A:middle
calling render directly under

00:25:38.876 --> 00:25:40.816 A:middle
CIImage instances to go the

00:25:41.346 --> 00:25:42.706 A:middle
other way around.

00:25:43.536 --> 00:25:44.716 A:middle
If you're in Swift, there's a

00:25:44.716 --> 00:25:45.896 A:middle
bit more set of coding to do.

00:25:45.956 --> 00:25:46.756 A:middle
You need to first create a

00:25:46.756 --> 00:25:47.856 A:middle
CIrender destination.

00:25:48.636 --> 00:25:49.776 A:middle
Make sure to allocate your

00:25:49.776 --> 00:25:50.696 A:middle
buffer previous.

00:25:51.716 --> 00:25:52.706 A:middle
Make sure to give the right

00:25:52.706 --> 00:25:54.966 A:middle
buffer properties, initiate and

00:25:55.116 --> 00:25:56.006 A:middle
create an incidence of the CI

00:25:56.006 --> 00:25:58.196 A:middle
Contex and Qtest render.

00:25:59.476 --> 00:26:00.956 A:middle
So, all of that is handled for

00:25:59.476 --> 00:26:00.956 A:middle
So, all of that is handled for

00:26:00.956 --> 00:26:02.226 A:middle
you under the hood.

00:26:02.956 --> 00:26:04.266 A:middle
Core Image also supports

00:26:04.366 --> 00:26:05.746 A:middle
residual images, such as

00:26:05.746 --> 00:26:08.006 A:middle
creating images from a color or

00:26:08.006 --> 00:26:08.856 A:middle
creating an image from a

00:26:08.856 --> 00:26:09.406 A:middle
generator.

00:26:11.156 --> 00:26:12.546 A:middle
Let's have a look at how to

00:26:12.546 --> 00:26:13.296 A:middle
apply filters now.

00:26:14.526 --> 00:26:16.126 A:middle
So, applying a filter has never

00:26:16.126 --> 00:26:16.476 A:middle
been easier.

00:26:16.476 --> 00:26:17.936 A:middle
You take a CIImage instance,

00:26:18.466 --> 00:26:19.676 A:middle
call the filter name directly on

00:26:19.676 --> 00:26:21.666 A:middle
it and pass the list of input

00:26:21.706 --> 00:26:22.266 A:middle
primaries.

00:26:23.026 --> 00:26:24.476 A:middle
Every CIImage instance is

00:26:24.476 --> 00:26:26.496 A:middle
augmented with more than 200

00:26:26.686 --> 00:26:28.536 A:middle
lambda expressions, which

00:26:28.536 --> 00:26:30.516 A:middle
directly map to the Core Image

00:26:30.516 --> 00:26:30.996 A:middle
filters.

00:26:31.216 --> 00:26:33.406 A:middle
If you're in Swift, this is the

00:26:33.406 --> 00:26:34.726 A:middle
syntax you've seen before I'm

00:26:34.726 --> 00:26:36.476 A:middle
sure, applying filter, passing

00:26:36.476 --> 00:26:38.106 A:middle
the filter name as well as the

00:26:38.106 --> 00:26:39.866 A:middle
list of input arguments as a

00:26:39.866 --> 00:26:41.536 A:middle
dictionary of key value pairs.

00:26:42.856 --> 00:26:45.376 A:middle
To apply kernels, you can go

00:26:45.376 --> 00:26:46.876 A:middle
applykernel in your CIMG

00:26:46.876 --> 00:26:48.966 A:middle
instance, passing of the source

00:26:48.966 --> 00:26:50.346 A:middle
string containing your kernel

00:26:50.346 --> 00:26:52.316 A:middle
code and the list of input

00:26:52.416 --> 00:26:53.976 A:middle
parameters to that kernel, and

00:26:53.976 --> 00:26:55.376 A:middle
we'll have a look at this in

00:26:55.376 --> 00:26:55.906 A:middle
just a second.

00:26:57.526 --> 00:26:58.806 A:middle
Then you just specify the extent

00:26:58.806 --> 00:26:59.456 A:middle
in which you're applying that

00:26:59.456 --> 00:27:00.746 A:middle
kernel, as well as a region of

00:26:59.456 --> 00:27:00.746 A:middle
kernel, as well as a region of

00:27:00.746 --> 00:27:01.536 A:middle
interest from which you're

00:27:01.536 --> 00:27:03.796 A:middle
sampling in the buffer where

00:27:03.796 --> 00:27:05.816 A:middle
you're sampling from.

00:27:07.356 --> 00:27:09.156 A:middle
PyCoreImage provides a selection

00:27:09.156 --> 00:27:10.986 A:middle
of useful APIs that you can use,

00:27:10.986 --> 00:27:12.676 A:middle
such as a composite operations.

00:27:12.676 --> 00:27:15.116 A:middle
Here is a source-over as well as

00:27:15.156 --> 00:27:16.466 A:middle
geometrical operations such as

00:27:16.466 --> 00:27:19.506 A:middle
translation, scaling, rotation,

00:27:20.386 --> 00:27:21.006 A:middle
and cropping.

00:27:21.536 --> 00:27:22.406 A:middle
All right.

00:27:23.536 --> 00:27:25.476 A:middle
I just want to spend a bit more

00:27:25.476 --> 00:27:28.706 A:middle
time on the GPU kernels because

00:27:28.706 --> 00:27:29.796 A:middle
that's an extremely powerful

00:27:29.796 --> 00:27:30.836 A:middle
feature especially for pro

00:27:30.836 --> 00:27:31.296 A:middle
typing.

00:27:31.416 --> 00:27:33.696 A:middle
So what we have here is a string

00:27:33.696 --> 00:27:35.376 A:middle
containing the code to a GPU

00:27:35.376 --> 00:27:36.196 A:middle
fragmentor.

00:27:36.606 --> 00:27:38.356 A:middle
And what we have there is

00:27:38.356 --> 00:27:39.716 A:middle
essentially a way for you to

00:27:39.716 --> 00:27:41.326 A:middle
prototype in real time what that

00:27:41.326 --> 00:27:41.916 A:middle
effect is.

00:27:43.726 --> 00:27:44.926 A:middle
This is an example of five tap

00:27:44.926 --> 00:27:46.786 A:middle
Laplacian and we're going to be

00:27:46.786 --> 00:27:47.996 A:middle
using this for sharpening.

00:27:48.386 --> 00:27:50.166 A:middle
So, we make five samples in

00:27:50.166 --> 00:27:51.226 A:middle
neighborhood of each pixel.

00:27:51.896 --> 00:27:53.136 A:middle
Combine them in a way to compute

00:27:53.136 --> 00:27:54.186 A:middle
a local derivative, which is

00:27:54.186 --> 00:27:55.726 A:middle
going to be our detail, and

00:27:55.726 --> 00:27:56.916 A:middle
we're adding in on -- back on

00:27:56.916 --> 00:27:57.936 A:middle
top of the center pixel.

00:27:58.486 --> 00:27:59.776 A:middle
I don't want to focus too much

00:27:59.776 --> 00:28:00.916 A:middle
on the filter itself, but how to

00:27:59.776 --> 00:28:00.916 A:middle
on the filter itself, but how to

00:28:00.916 --> 00:28:01.436 A:middle
call it.

00:28:02.266 --> 00:28:04.556 A:middle
So, we call it black kernel on

00:28:04.556 --> 00:28:05.696 A:middle
our CIMG instance.

00:28:06.636 --> 00:28:08.576 A:middle
Bass source code, that's just

00:28:08.576 --> 00:28:10.306 A:middle
sitting above using a triple

00:28:10.306 --> 00:28:11.026 A:middle
[inaudible] python string.

00:28:12.036 --> 00:28:13.486 A:middle
[Inaudible] the extent in which

00:28:13.486 --> 00:28:14.806 A:middle
we're going to be applying the

00:28:14.806 --> 00:28:15.206 A:middle
kernel.

00:28:15.816 --> 00:28:18.226 A:middle
And define the region of

00:28:18.226 --> 00:28:19.656 A:middle
interest is along the expression

00:28:19.846 --> 00:28:20.646 A:middle
that we're going to be sampling

00:28:20.646 --> 00:28:20.996 A:middle
from.

00:28:21.866 --> 00:28:23.126 A:middle
If you're not familiar with the

00:28:23.126 --> 00:28:24.396 A:middle
concepts of domain of

00:28:24.396 --> 00:28:25.876 A:middle
destination as well as regions

00:28:25.876 --> 00:28:27.656 A:middle
of interest, I encourage you to

00:28:27.656 --> 00:28:29.086 A:middle
look at online documentation for

00:28:29.086 --> 00:28:30.706 A:middle
Core Image as well as previous

00:28:30.706 --> 00:28:31.566 A:middle
WWDC sessions.

00:28:32.216 --> 00:28:33.716 A:middle
But here is the convolutional

00:28:33.716 --> 00:28:35.426 A:middle
kernel, we are reading one pixel

00:28:35.426 --> 00:28:36.506 A:middle
away from the boundary, so we

00:28:36.506 --> 00:28:38.216 A:middle
need to instruct Core Image if

00:28:38.216 --> 00:28:39.436 A:middle
we're going to be doing so, so

00:28:39.436 --> 00:28:40.586 A:middle
that it can handle boundary

00:28:40.586 --> 00:28:41.526 A:middle
conditions properly.

00:28:43.016 --> 00:28:43.606 A:middle
All right.

00:28:43.956 --> 00:28:44.516 A:middle
So, that was a lot of

00:28:44.516 --> 00:28:47.016 A:middle
information and looking at APIs

00:28:47.016 --> 00:28:48.766 A:middle
is going to always be dry, so

00:28:48.766 --> 00:28:49.626 A:middle
let's take a look at a demo and

00:28:49.626 --> 00:28:50.526 A:middle
let's put all of this into

00:28:50.526 --> 00:28:51.000 A:middle
practice.

00:28:55.508 --> 00:28:57.508 A:middle
[ Applause ]

00:29:02.046 --> 00:29:02.216 A:middle
All right.

00:29:02.216 --> 00:29:03.086 A:middle
So, during that demo I'll be

00:29:03.086 --> 00:29:05.656 A:middle
using Jupiter Notebook, which is

00:29:05.656 --> 00:29:08.176 A:middle
a browser-based real-time Python

00:29:08.176 --> 00:29:08.696 A:middle
interpreter.

00:29:09.546 --> 00:29:10.916 A:middle
So, all the results you're going

00:29:10.916 --> 00:29:12.876 A:middle
to be seeing are rendered in

00:29:12.876 --> 00:29:14.286 A:middle
real-time using Core Image in

00:29:14.286 --> 00:29:14.896 A:middle
the backend.

00:29:14.896 --> 00:29:15.936 A:middle
So, none of this has been

00:29:15.936 --> 00:29:17.076 A:middle
pre-computed; this is all done

00:29:17.076 --> 00:29:17.396 A:middle
live.

00:29:17.886 --> 00:29:19.286 A:middle
So, the very first thing I want

00:29:19.286 --> 00:29:22.086 A:middle
to do here is import the utility

00:29:22.176 --> 00:29:23.286 A:middle
classes we're going to be using,

00:29:23.286 --> 00:29:24.666 A:middle
the most important one being the

00:29:24.666 --> 00:29:25.996 A:middle
CIMG class here for my

00:29:25.996 --> 00:29:27.066 A:middle
PyCoreImage package.

00:29:28.136 --> 00:29:28.836 A:middle
Then, we just have a bit of

00:29:28.836 --> 00:29:29.916 A:middle
setup code so that we can

00:29:29.916 --> 00:29:31.676 A:middle
actually visualize images in

00:29:31.676 --> 00:29:32.286 A:middle
that notebook.

00:29:32.996 --> 00:29:33.636 A:middle
Let's get started.

00:29:34.676 --> 00:29:36.456 A:middle
First thing I want to show you

00:29:36.456 --> 00:29:37.876 A:middle
is how to load images in.

00:29:38.266 --> 00:29:40.576 A:middle
So, using from file here, we see

00:29:40.576 --> 00:29:43.526 A:middle
that the type of my object is a

00:29:43.526 --> 00:29:45.016 A:middle
PyCoreImage CIMG.

00:29:45.016 --> 00:29:47.246 A:middle
And we can see that it's backed

00:29:47.506 --> 00:29:49.106 A:middle
by an actually proper Core Image

00:29:49.526 --> 00:29:50.606 A:middle
object in the back.

00:29:51.626 --> 00:29:53.706 A:middle
We can do a render on our image

00:29:53.976 --> 00:29:55.876 A:middle
and have a look, I would -- its

00:29:55.876 --> 00:29:58.406 A:middle
actual pixel representation

00:29:58.406 --> 00:29:59.156 A:middle
using Matte [inaudible] lib

00:29:59.156 --> 00:29:59.396 A:middle
here.

00:30:00.236 --> 00:30:04.226 A:middle
This is our input image, and now

00:30:04.226 --> 00:30:05.386 A:middle
I want to apply a filter on it,

00:30:05.546 --> 00:30:07.136 A:middle
so let's take a look at the 200

00:30:07.136 --> 00:30:08.306 A:middle
plus filters that are supported

00:30:08.306 --> 00:30:09.000 A:middle
in Core Image.

00:30:13.116 --> 00:30:14.456 A:middle
Let's say that I'm interested in

00:30:14.456 --> 00:30:16.176 A:middle
applying GaussianBlur here, and

00:30:16.176 --> 00:30:16.946 A:middle
I'd like to know which

00:30:16.946 --> 00:30:18.306 A:middle
parameters are supported by that

00:30:18.306 --> 00:30:19.386 A:middle
filter, so I'm going to call

00:30:19.386 --> 00:30:21.856 A:middle
inputs on my CIMG class, and I

00:30:21.856 --> 00:30:23.926 A:middle
see that it supports input image

00:30:24.206 --> 00:30:25.356 A:middle
-- I shouldn't be surprised --

00:30:25.356 --> 00:30:26.566 A:middle
as well as an input radius.

00:30:26.986 --> 00:30:28.356 A:middle
So, I'm going to do just that

00:30:28.356 --> 00:30:28.666 A:middle
here.

00:30:29.886 --> 00:30:30.696 A:middle
Take my input image.

00:30:31.486 --> 00:30:32.786 A:middle
Apply GaussianBlur filter on it

00:30:32.946 --> 00:30:34.726 A:middle
with a radius of 100 pixels, and

00:30:35.236 --> 00:30:36.176 A:middle
then show the two images

00:30:36.176 --> 00:30:36.786 A:middle
side-by-side.

00:30:38.756 --> 00:30:41.596 A:middle
So, pretty easy, right?

00:30:42.176 --> 00:30:42.526 A:middle
Okay.

00:30:43.226 --> 00:30:45.116 A:middle
Let's keep going.

00:30:45.166 --> 00:30:46.026 A:middle
Like I mentioned earlier, you

00:30:46.026 --> 00:30:47.326 A:middle
can generate procedural images

00:30:47.326 --> 00:30:48.076 A:middle
using Core Image.

00:30:48.266 --> 00:30:49.506 A:middle
So, we'll take a look at Core

00:30:49.506 --> 00:30:50.636 A:middle
Image generators.

00:30:51.626 --> 00:30:52.956 A:middle
And the first thing we do here

00:30:52.956 --> 00:30:54.536 A:middle
is we call from generator --

00:30:54.536 --> 00:30:55.736 A:middle
specify the name of our

00:30:55.736 --> 00:30:56.186 A:middle
generator.

00:30:56.286 --> 00:30:58.756 A:middle
In this case, CIQR code and pass

00:30:58.756 --> 00:31:00.916 A:middle
them in the message that we're

00:30:58.756 --> 00:31:00.916 A:middle
them in the message that we're

00:31:00.916 --> 00:31:01.506 A:middle
trying to encode.

00:31:02.446 --> 00:31:03.556 A:middle
Here it is in real time, so I

00:31:03.556 --> 00:31:06.306 A:middle
can do changes to that message

00:31:06.306 --> 00:31:08.546 A:middle
and see how that affects the QR

00:31:08.546 --> 00:31:09.456 A:middle
code that's being generated.

00:31:11.536 --> 00:31:13.076 A:middle
Core Image also has support for

00:31:13.076 --> 00:31:14.326 A:middle
labeling your images, so you can

00:31:14.326 --> 00:31:15.716 A:middle
use a CI text image generator to

00:31:15.716 --> 00:31:16.066 A:middle
do that.

00:31:16.576 --> 00:31:18.026 A:middle
So, here's the example here.

00:31:18.916 --> 00:31:21.746 A:middle
WWDC and using the SFLO font.

00:31:22.446 --> 00:31:24.456 A:middle
All right, let's keep going.

00:31:25.536 --> 00:31:26.846 A:middle
As I mentioned, we support

00:31:26.846 --> 00:31:27.966 A:middle
interoperability with a -- to

00:31:28.046 --> 00:31:29.906 A:middle
and from NumPy, so this is the

00:31:29.906 --> 00:31:30.696 A:middle
first thing we're going to do

00:31:30.696 --> 00:31:30.926 A:middle
here.

00:31:32.206 --> 00:31:32.966 A:middle
We're going to start with an

00:31:32.966 --> 00:31:34.916 A:middle
image and apply some interesting

00:31:34.916 --> 00:31:35.986 A:middle
and non-trivial affect to it.

00:31:35.986 --> 00:31:37.066 A:middle
In this case, a vortex

00:31:37.066 --> 00:31:37.546 A:middle
distortion.

00:31:38.716 --> 00:31:40.896 A:middle
Next thing we'll do is, we'll

00:31:40.896 --> 00:31:45.496 A:middle
render that buffer getting NumPy

00:31:45.496 --> 00:31:46.316 A:middle
area out of it.

00:31:46.316 --> 00:31:47.936 A:middle
You can see its type here as

00:31:47.936 --> 00:31:50.226 A:middle
well as its shape, its depth,

00:31:50.616 --> 00:31:52.656 A:middle
and a few statistics on it.

00:31:52.656 --> 00:31:54.616 A:middle
It's minimum, median value as

00:31:54.616 --> 00:31:55.796 A:middle
well as its maximum value.

00:31:56.396 --> 00:31:59.766 A:middle
We can also go the other way

00:31:59.766 --> 00:32:01.596 A:middle
around and go from NumPy to Core

00:31:59.766 --> 00:32:01.596 A:middle
around and go from NumPy to Core

00:32:01.656 --> 00:32:01.886 A:middle
Image.

00:32:02.506 --> 00:32:04.596 A:middle
To do this, let's start with a

00:32:04.596 --> 00:32:05.576 A:middle
NumPy array-- that's

00:32:05.576 --> 00:32:06.146 A:middle
non-trivial.

00:32:06.186 --> 00:32:08.066 A:middle
In this case, a random -- a

00:32:08.066 --> 00:32:10.046 A:middle
random buffer where 75% of the

00:32:10.046 --> 00:32:11.346 A:middle
values have been [inaudible] to

00:32:11.346 --> 00:32:11.746 A:middle
black.

00:32:12.926 --> 00:32:15.396 A:middle
First thing I do here is wrap my

00:32:15.396 --> 00:32:16.646 A:middle
NumPy array into my CIMG

00:32:16.646 --> 00:32:18.566 A:middle
constructor, and we can see that

00:32:18.566 --> 00:32:19.946 A:middle
we have again, our CIMG class

00:32:19.946 --> 00:32:21.656 A:middle
instance and the backing

00:32:21.726 --> 00:32:22.336 A:middle
CIImage.

00:32:23.576 --> 00:32:26.376 A:middle
Now that I have my CIImage, I

00:32:26.376 --> 00:32:27.606 A:middle
can apply a variety of filters

00:32:27.606 --> 00:32:27.866 A:middle
on it.

00:32:28.296 --> 00:32:29.936 A:middle
So, the first thing I do is I'll

00:32:29.936 --> 00:32:30.756 A:middle
apply this blur.

00:32:31.426 --> 00:32:33.036 A:middle
I'll use a wire filter; a light

00:32:33.036 --> 00:32:33.396 A:middle
tunnel.

00:32:34.286 --> 00:32:35.576 A:middle
Change of contrast in my image.

00:32:36.036 --> 00:32:38.006 A:middle
The exposure adjustment as well

00:32:38.006 --> 00:32:38.866 A:middle
as the gamma value.

00:32:39.916 --> 00:32:40.706 A:middle
Let's take a look at these

00:32:40.706 --> 00:32:41.916 A:middle
filters side-by-side.

00:32:42.556 --> 00:32:44.346 A:middle
So at this blur, light tunnel,

00:32:44.346 --> 00:32:45.966 A:middle
exposure adjust; gamma adjust,

00:32:46.616 --> 00:32:47.506 A:middle
here's our final effect.

00:32:48.396 --> 00:32:49.576 A:middle
Pretty fun and really easy to

00:32:49.576 --> 00:32:49.986 A:middle
work with.

00:32:52.586 --> 00:32:53.336 A:middle
So we -- let's put it all

00:32:53.336 --> 00:32:53.746 A:middle
together.

00:32:53.746 --> 00:32:54.916 A:middle
So, I'm going to start with a

00:32:54.916 --> 00:32:57.316 A:middle
new image here, and what I'll be

00:32:57.316 --> 00:32:59.246 A:middle
showing you in this demo is, how

00:32:59.246 --> 00:33:00.536 A:middle
we can do bend processing.

00:32:59.246 --> 00:33:00.536 A:middle
we can do bend processing.

00:33:00.536 --> 00:33:01.946 A:middle
For those of you who are filming

00:33:01.946 --> 00:33:03.066 A:middle
here with slicing images in

00:33:03.066 --> 00:33:04.096 A:middle
Python, this is exactly what

00:33:04.096 --> 00:33:04.906 A:middle
we're going to be doing.

00:33:05.276 --> 00:33:07.136 A:middle
We'll define bands or slices --

00:33:07.246 --> 00:33:08.856 A:middle
horizontal slices in our image,

00:33:09.196 --> 00:33:10.516 A:middle
and we'll only be applying

00:33:10.696 --> 00:33:11.616 A:middle
filters on these.

00:33:12.096 --> 00:33:14.136 A:middle
Let's take a look at a code

00:33:14.136 --> 00:33:14.486 A:middle
first.

00:33:14.656 --> 00:33:16.566 A:middle
This is our add band function

00:33:16.566 --> 00:33:16.896 A:middle
here.

00:33:17.546 --> 00:33:18.846 A:middle
And we can see that the very

00:33:18.846 --> 00:33:21.086 A:middle
bottom of it, we render our

00:33:21.086 --> 00:33:22.296 A:middle
image in two composites, which

00:33:22.296 --> 00:33:23.666 A:middle
is an actual NumPy buffer.

00:33:23.666 --> 00:33:24.966 A:middle
But the right-hand side is a

00:33:24.966 --> 00:33:25.616 A:middle
CIImage.

00:33:26.576 --> 00:33:27.866 A:middle
By using slicing like this, we

00:33:27.866 --> 00:33:29.806 A:middle
forced Core Image to only do a

00:33:29.806 --> 00:33:31.016 A:middle
render in that band, not in the

00:33:31.016 --> 00:33:33.816 A:middle
entire image, thereby being much

00:33:33.816 --> 00:33:35.296 A:middle
more performant.

00:33:35.296 --> 00:33:38.836 A:middle
So, let's do this and create

00:33:38.836 --> 00:33:40.316 A:middle
five different bands into our

00:33:40.316 --> 00:33:41.766 A:middle
image and show the final

00:33:41.766 --> 00:33:42.226 A:middle
composite.

00:33:44.916 --> 00:33:45.756 A:middle
Pretty amazing.

00:33:45.756 --> 00:33:48.586 A:middle
And we've got other labels on

00:33:48.586 --> 00:33:49.946 A:middle
top as well, which correspond to

00:33:49.946 --> 00:33:51.186 A:middle
the filters being applied.

00:33:52.026 --> 00:33:53.106 A:middle
It's really that simple to work

00:33:53.106 --> 00:33:53.806 A:middle
with PyCoreImage.

00:33:54.636 --> 00:33:54.936 A:middle
All right.

00:33:55.086 --> 00:33:56.146 A:middle
And I mentioned performance

00:33:56.146 --> 00:33:57.886 A:middle
earlier, so let's take a quick

00:33:57.886 --> 00:33:58.316 A:middle
look at this.

00:33:58.396 --> 00:34:00.216 A:middle
First thing I want to show you

00:33:58.396 --> 00:34:00.216 A:middle
First thing I want to show you

00:34:00.216 --> 00:34:02.156 A:middle
is that whenever you call render

00:34:02.156 --> 00:34:03.876 A:middle
on your CIImage instances, the

00:34:03.876 --> 00:34:06.206 A:middle
NumPy is baked and cached under

00:34:06.206 --> 00:34:06.516 A:middle
the hood.

00:34:06.646 --> 00:34:08.406 A:middle
For example, here we create an

00:34:08.406 --> 00:34:10.196 A:middle
image where we scaled down as

00:34:10.196 --> 00:34:11.856 A:middle
well as applied GaussianBlur, so

00:34:11.856 --> 00:34:13.116 A:middle
the first call took 56

00:34:13.116 --> 00:34:14.016 A:middle
milliseconds; the second one

00:34:14.016 --> 00:34:14.976 A:middle
only 2 milliseconds.

00:34:16.085 --> 00:34:17.976 A:middle
And let's take a look at large

00:34:17.976 --> 00:34:18.795 A:middle
convolutions as well.

00:34:18.886 --> 00:34:21.116 A:middle
Core Image is extremely fast and

00:34:21.116 --> 00:34:22.406 A:middle
is able to handle large

00:34:22.406 --> 00:34:23.806 A:middle
convolutions as if it was

00:34:23.806 --> 00:34:24.176 A:middle
nothing.

00:34:24.646 --> 00:34:26.406 A:middle
Here we're using CIBlur,

00:34:26.806 --> 00:34:28.636 A:middle
CIGaussianBlur with a radius --

00:34:28.636 --> 00:34:31.005 A:middle
with a sigma of 200 -- a value

00:34:31.005 --> 00:34:32.585 A:middle
of 200 for a sigma, which is

00:34:32.585 --> 00:34:32.866 A:middle
huge.

00:34:32.866 --> 00:34:34.466 A:middle
Just to give you a sense here,

00:34:34.936 --> 00:34:36.186 A:middle
as I was look -- showing you the

00:34:36.186 --> 00:34:38.306 A:middle
image, I'm actually executing

00:34:38.306 --> 00:34:39.116 A:middle
the equivalent using

00:34:39.326 --> 00:34:40.156 A:middle
scikit-image.

00:34:40.616 --> 00:34:42.235 A:middle
And we had a 16 seconds running

00:34:42.235 --> 00:34:42.606 A:middle
time.

00:34:43.025 --> 00:34:44.306 A:middle
But this time the same thing

00:34:44.306 --> 00:34:46.076 A:middle
using CoreImage; 130

00:34:46.076 --> 00:34:46.786 A:middle
milliseconds.

00:34:47.335 --> 00:34:48.306 A:middle
Yeah, it's that fast [applause]

00:34:48.576 --> 00:34:49.536 A:middle
-- 200X, yeah.

00:34:50.166 --> 00:34:50.476 A:middle
Thank you.

00:34:51.936 --> 00:34:53.606 A:middle
All right, let's keep going.

00:34:53.606 --> 00:34:55.676 A:middle
So, one of the most powerful

00:34:55.676 --> 00:34:56.985 A:middle
features of PyCoreImage is its

00:34:56.985 --> 00:34:59.536 A:middle
ability to create custom GP

00:34:59.536 --> 00:35:00.986 A:middle
kernels inline and execute them

00:34:59.536 --> 00:35:00.986 A:middle
kernels inline and execute them

00:35:00.986 --> 00:35:02.476 A:middle
on the fly and modify them on

00:35:02.476 --> 00:35:02.836 A:middle
the fly.

00:35:02.916 --> 00:35:04.000 A:middle
So, let's take a look at that.

00:35:09.046 --> 00:35:09.216 A:middle
All right.

00:35:09.786 --> 00:35:11.406 A:middle
So, the first thing I want to

00:35:11.406 --> 00:35:12.736 A:middle
show is how to use color

00:35:12.736 --> 00:35:13.206 A:middle
kernels.

00:35:13.356 --> 00:35:14.956 A:middle
So, color kernels are kernels

00:35:14.956 --> 00:35:16.626 A:middle
that only take a pixel in and

00:35:16.626 --> 00:35:18.796 A:middle
spit a pixel out and don't make

00:35:18.796 --> 00:35:20.466 A:middle
any other samples around that

00:35:20.466 --> 00:35:20.856 A:middle
pixel.

00:35:21.186 --> 00:35:22.866 A:middle
So, here's our input image and

00:35:22.866 --> 00:35:23.576 A:middle
here's our kernel.

00:35:23.826 --> 00:35:25.346 A:middle
So what we actually get in is a

00:35:25.346 --> 00:35:27.566 A:middle
color and we turn a color out.

00:35:27.716 --> 00:35:30.506 A:middle
So, let's take a look at this

00:35:30.506 --> 00:35:31.076 A:middle
effect here.

00:35:31.076 --> 00:35:32.566 A:middle
I'm going to be swapping my red

00:35:32.566 --> 00:35:34.246 A:middle
and blue channels with my blue

00:35:34.246 --> 00:35:35.356 A:middle
and red channels and we'll be

00:35:35.356 --> 00:35:36.006 A:middle
inverting them.

00:35:36.826 --> 00:35:38.226 A:middle
Not a terribly exciting effect,

00:35:38.226 --> 00:35:39.376 A:middle
but what I want to show you is

00:35:39.376 --> 00:35:41.476 A:middle
that I can do things like, start

00:35:42.676 --> 00:35:44.396 A:middle
typing away, and say, maybe I

00:35:44.396 --> 00:35:45.966 A:middle
want to scale my red channel by

00:35:45.966 --> 00:35:49.226 A:middle
my blue channel and I want to

00:35:49.226 --> 00:35:50.366 A:middle
just play with the amount of

00:35:50.366 --> 00:35:51.756 A:middle
scaling I'm playing here, so we

00:35:51.756 --> 00:35:54.716 A:middle
can go from .25 to pretty high

00:35:54.716 --> 00:35:56.946 A:middle
values if we want to and

00:35:56.946 --> 00:35:57.916 A:middle
generate interesting effects

00:35:57.916 --> 00:35:58.116 A:middle
here.

00:35:58.726 --> 00:36:00.336 A:middle
It's extremely powerful, and

00:35:58.726 --> 00:36:00.336 A:middle
It's extremely powerful, and

00:36:00.336 --> 00:36:01.646 A:middle
this all [inaudible] time so you

00:36:01.646 --> 00:36:02.756 A:middle
can really fine-tune your

00:36:02.756 --> 00:36:03.926 A:middle
filters this way and make sure

00:36:03.926 --> 00:36:05.626 A:middle
you achieve the effect that

00:36:05.626 --> 00:36:06.276 A:middle
you're looking for.

00:36:06.476 --> 00:36:09.716 A:middle
Let's take a look at a more

00:36:09.716 --> 00:36:11.436 A:middle
complicated kernel here.

00:36:11.436 --> 00:36:12.406 A:middle
So, we'll look at a general

00:36:12.406 --> 00:36:14.626 A:middle
kernel, which is a bit like the

00:36:14.626 --> 00:36:15.086 A:middle
[inaudible] I showed you

00:36:15.086 --> 00:36:16.456 A:middle
earlier, which is a kernel that

00:36:16.456 --> 00:36:17.506 A:middle
makes additional taps in the

00:36:17.506 --> 00:36:18.536 A:middle
neighborhood of each pixel.

00:36:19.516 --> 00:36:20.856 A:middle
So start with an image from

00:36:20.856 --> 00:36:21.826 A:middle
file, which is the same image we

00:36:21.826 --> 00:36:24.116 A:middle
saw earlier, and we have our

00:36:24.116 --> 00:36:25.236 A:middle
kernel code here.

00:36:25.346 --> 00:36:26.456 A:middle
Without going into the detail,

00:36:26.456 --> 00:36:27.576 A:middle
this is a bilateral filter,

00:36:27.576 --> 00:36:29.186 A:middle
which is an edge over blurring

00:36:29.186 --> 00:36:29.646 A:middle
filter.

00:36:30.006 --> 00:36:32.816 A:middle
So let's just get the code in

00:36:33.286 --> 00:36:39.016 A:middle
and use apply kernel with some

00:36:39.016 --> 00:36:41.376 A:middle
parameters that will allow us to

00:36:41.376 --> 00:36:42.396 A:middle
get this very nice effect.

00:36:42.396 --> 00:36:43.236 A:middle
And what we did here,

00:36:43.236 --> 00:36:46.156 A:middle
essentially, is clipped the

00:36:46.156 --> 00:36:47.686 A:middle
non-redundant high frequencies

00:36:47.736 --> 00:36:48.286 A:middle
in the image.

00:36:48.286 --> 00:36:50.326 A:middle
And if we take a look -- let's

00:36:50.326 --> 00:36:51.136 A:middle
take a look at this a bit more

00:36:51.136 --> 00:36:51.566 A:middle
closely.

00:36:52.156 --> 00:36:54.096 A:middle
Look at a crop here.

00:36:54.096 --> 00:36:55.776 A:middle
We can see how the strong edges

00:36:55.776 --> 00:36:57.456 A:middle
are still there, but the fine

00:36:57.456 --> 00:36:58.626 A:middle
frequencies that are not

00:36:58.626 --> 00:36:59.746 A:middle
redundant were washed away.

00:37:00.806 --> 00:37:03.006 A:middle
And bilateral filter can be used

00:37:03.006 --> 00:37:03.756 A:middle
for many, many different

00:37:03.756 --> 00:37:04.246 A:middle
purposes.

00:37:04.246 --> 00:37:05.386 A:middle
In this particular case, we'll

00:37:05.386 --> 00:37:06.406 A:middle
use it to do sharpening.

00:37:07.086 --> 00:37:08.256 A:middle
And to achieve sharpening with

00:37:08.256 --> 00:37:10.026 A:middle
this filter, we can simply take

00:37:10.026 --> 00:37:11.426 A:middle
the image on the left and

00:37:11.426 --> 00:37:12.616 A:middle
subtract the image on the right,

00:37:12.616 --> 00:37:13.826 A:middle
giving us a map of high

00:37:13.826 --> 00:37:15.476 A:middle
frequencies or details of the

00:37:15.476 --> 00:37:15.866 A:middle
image.

00:37:15.966 --> 00:37:16.816 A:middle
Let's do just that.

00:37:17.196 --> 00:37:19.036 A:middle
So, here what I'm doing is I'm

00:37:19.036 --> 00:37:20.576 A:middle
rendering my image, it's an

00:37:20.576 --> 00:37:21.296 A:middle
NumPy buffer.

00:37:21.776 --> 00:37:24.346 A:middle
Rendering my bilinear, my

00:37:24.976 --> 00:37:27.116 A:middle
filtered image and we're

00:37:27.116 --> 00:37:28.706 A:middle
subtracting them together using

00:37:28.706 --> 00:37:30.096 A:middle
the operator overloading that's

00:37:30.096 --> 00:37:30.826 A:middle
provided with NumPy.

00:37:30.826 --> 00:37:32.776 A:middle
Let's take a look at the detail

00:37:32.776 --> 00:37:33.106 A:middle
layer.

00:37:33.856 --> 00:37:35.946 A:middle
So, if you have detail on your

00:37:35.946 --> 00:37:37.306 A:middle
left-hand side for the entire

00:37:37.306 --> 00:37:39.036 A:middle
image and a crop for the center

00:37:39.036 --> 00:37:39.556 A:middle
of the image.

00:37:40.276 --> 00:37:42.306 A:middle
Now, what we can do with this is

00:37:42.306 --> 00:37:44.126 A:middle
we can add it on top of the

00:37:44.126 --> 00:37:44.886 A:middle
original image.

00:37:45.996 --> 00:37:46.946 A:middle
We're going to be doing just

00:37:46.946 --> 00:37:47.456 A:middle
that here.

00:37:47.486 --> 00:37:48.736 A:middle
We're going to be adding it

00:37:48.736 --> 00:37:49.176 A:middle
twice.

00:37:50.196 --> 00:37:51.376 A:middle
By doing this, we achieve formed

00:37:51.376 --> 00:37:51.826 A:middle
sharpening.

00:37:52.906 --> 00:37:53.756 A:middle
It's really that simple.

00:37:53.916 --> 00:37:55.646 A:middle
If I wanted, I could go back to

00:37:55.646 --> 00:37:58.256 A:middle
my filter kernel string and

00:37:58.256 --> 00:37:59.336 A:middle
start hacking away and making

00:37:59.336 --> 00:38:01.086 A:middle
changes there in real time.

00:37:59.336 --> 00:38:01.086 A:middle
changes there in real time.

00:38:02.426 --> 00:38:04.116 A:middle
The other thing I wanted to show

00:38:04.116 --> 00:38:06.546 A:middle
you is how to load metadata from

00:38:06.546 --> 00:38:07.126 A:middle
your images.

00:38:07.526 --> 00:38:09.696 A:middle
So, here I have an image that

00:38:09.696 --> 00:38:11.116 A:middle
has portrait effect matte loaded

00:38:11.116 --> 00:38:12.616 A:middle
in, as well as portrait depth

00:38:12.616 --> 00:38:12.806 A:middle
data.

00:38:14.216 --> 00:38:15.106 A:middle
Here are the images

00:38:15.106 --> 00:38:15.726 A:middle
side-by-side.

00:38:16.416 --> 00:38:18.206 A:middle
The image on the left is the RGB

00:38:18.206 --> 00:38:18.646 A:middle
image.

00:38:18.646 --> 00:38:20.296 A:middle
In the center is the depth data.

00:38:20.296 --> 00:38:21.066 A:middle
On the right-hand side is a

00:38:21.066 --> 00:38:22.326 A:middle
high-quality portrait effects

00:38:22.326 --> 00:38:23.786 A:middle
map, which we introduced in

00:38:23.786 --> 00:38:24.686 A:middle
another session today.

00:38:25.566 --> 00:38:27.256 A:middle
We can also look at the exist

00:38:27.256 --> 00:38:29.086 A:middle
tags directly by looking at the

00:38:29.086 --> 00:38:31.906 A:middle
underlying CIImage from CIMG

00:38:31.966 --> 00:38:33.486 A:middle
instances and calling

00:38:33.486 --> 00:38:33.996 A:middle
properties.

00:38:35.006 --> 00:38:36.166 A:middle
Here, we get information

00:38:36.526 --> 00:38:37.656 A:middle
pertaining to the actual capture

00:38:37.656 --> 00:38:38.056 A:middle
itself.

00:38:40.056 --> 00:38:41.206 A:middle
Like I said, we introduce the

00:38:41.206 --> 00:38:42.776 A:middle
portrait effects matte at

00:38:42.776 --> 00:38:44.466 A:middle
another session, Session 503, so

00:38:44.466 --> 00:38:45.666 A:middle
I highly encourage you to look

00:38:45.666 --> 00:38:45.916 A:middle
at it.

00:38:45.916 --> 00:38:47.166 A:middle
So without going into the

00:38:47.166 --> 00:38:49.436 A:middle
details here, I'm going to be

00:38:49.436 --> 00:38:50.206 A:middle
choosing this filter.

00:38:50.206 --> 00:38:51.676 A:middle
If you are interested to know

00:38:51.676 --> 00:38:53.896 A:middle
how we did this, I highly

00:38:53.896 --> 00:38:55.376 A:middle
encourage you to take a look at

00:38:55.376 --> 00:38:55.796 A:middle
this session.

00:38:57.226 --> 00:38:58.626 A:middle
Pretty fun stuff [applause].

00:38:59.696 --> 00:39:01.106 A:middle
Thank you.

00:38:59.696 --> 00:39:01.106 A:middle
Thank you.

00:39:02.516 --> 00:39:04.000 A:middle
[ Applause ]

00:39:06.056 --> 00:39:06.336 A:middle
All right.

00:39:07.116 --> 00:39:07.926 A:middle
Let's go back to the

00:39:07.926 --> 00:39:08.636 A:middle
presentation.

00:39:08.736 --> 00:39:10.346 A:middle
I want to switch gear a little

00:39:10.346 --> 00:39:14.546 A:middle
bit here and talk about bringing

00:39:14.546 --> 00:39:16.000 A:middle
CoreImage and CoreML together.

00:39:23.466 --> 00:39:24.696 A:middle
If you would like to get more

00:39:24.696 --> 00:39:26.986 A:middle
information about working with

00:39:27.066 --> 00:39:28.926 A:middle
Portrait Matte and Portrait

00:39:28.926 --> 00:39:30.626 A:middle
depth information, I encourage

00:39:30.626 --> 00:39:31.996 A:middle
you to look at session on

00:39:31.996 --> 00:39:35.316 A:middle
creating photo and video effects

00:39:35.316 --> 00:39:35.383 A:middle
[inaudible].

00:39:35.383 --> 00:39:35.736 A:middle
All right.

00:39:35.736 --> 00:39:36.786 A:middle
Let's look at bringing Core

00:39:36.786 --> 00:39:37.856 A:middle
Image and CoreML together.

00:39:38.966 --> 00:39:40.576 A:middle
This year, we're really excited

00:39:40.746 --> 00:39:42.106 A:middle
to announce that we're coming up

00:39:42.106 --> 00:39:44.446 A:middle
with a new filter, CI CoreML

00:39:44.446 --> 00:39:45.196 A:middle
model filter.

00:39:45.776 --> 00:39:47.126 A:middle
It's an extremely simple, yet

00:39:47.126 --> 00:39:48.516 A:middle
very powerful filter that takes

00:39:48.566 --> 00:39:49.036 A:middle
two input.

00:39:49.586 --> 00:39:51.706 A:middle
The very first input is the

00:39:51.756 --> 00:39:54.486 A:middle
image itself with a filter and

00:39:54.486 --> 00:39:58.666 A:middle
input CoreML model, and you get

00:39:58.666 --> 00:40:00.176 A:middle
an output, which has been run

00:39:58.666 --> 00:40:00.176 A:middle
an output, which has been run

00:40:00.176 --> 00:40:01.336 A:middle
through the underlying neural

00:40:01.336 --> 00:40:01.846 A:middle
network.

00:40:01.846 --> 00:40:02.916 A:middle
It's really that's simple;

00:40:02.916 --> 00:40:03.986 A:middle
extremely powerful.

00:40:04.566 --> 00:40:05.966 A:middle
Just to show you how simple the

00:40:05.966 --> 00:40:07.326 A:middle
code is, let's take a look at

00:40:07.326 --> 00:40:08.386 A:middle
Swift.

00:40:09.286 --> 00:40:10.076 A:middle
So, we have an input image on

00:40:10.076 --> 00:40:11.436 A:middle
the left-hand side, all we need

00:40:11.436 --> 00:40:12.676 A:middle
to do is call applying filter.

00:40:13.356 --> 00:40:14.556 A:middle
But as a new filter that we've

00:40:14.556 --> 00:40:15.676 A:middle
entered -- are introducing this

00:40:15.676 --> 00:40:16.846 A:middle
year and give your [inaudible]

00:40:16.956 --> 00:40:18.346 A:middle
in the model.

00:40:18.566 --> 00:40:19.486 A:middle
It's really that simple.

00:40:19.566 --> 00:40:21.346 A:middle
And if you'd like to look at

00:40:21.346 --> 00:40:22.746 A:middle
other ways to leverage machine

00:40:22.746 --> 00:40:23.856 A:middle
learning in your image

00:40:23.856 --> 00:40:24.826 A:middle
processing applications, I

00:40:24.826 --> 00:40:26.776 A:middle
encourage you to look at the

00:40:26.776 --> 00:40:28.266 A:middle
other sessions on A Guide to

00:40:28.266 --> 00:40:29.916 A:middle
Turi Create as well as Vision

00:40:29.916 --> 00:40:30.556 A:middle
with CoreML.

00:40:33.106 --> 00:40:33.366 A:middle
All right.

00:40:33.366 --> 00:40:35.246 A:middle
On a related topic, one of the

00:40:35.246 --> 00:40:37.026 A:middle
common operations we carry in

00:40:37.026 --> 00:40:38.156 A:middle
our training datasets in machine

00:40:38.156 --> 00:40:39.946 A:middle
learning is data augmentation.

00:40:40.636 --> 00:40:43.126 A:middle
And data augmentation can

00:40:43.306 --> 00:40:43.976 A:middle
dramatically increase the

00:40:43.976 --> 00:40:45.776 A:middle
robustness of your neural

00:40:45.776 --> 00:40:46.186 A:middle
networks.

00:40:46.186 --> 00:40:47.166 A:middle
In this particular case, let's

00:40:47.166 --> 00:40:49.026 A:middle
say we're doing object

00:40:49.026 --> 00:40:51.416 A:middle
classification and we're trying

00:40:51.416 --> 00:40:52.526 A:middle
to determine whether that image

00:40:52.526 --> 00:40:56.726 A:middle
is a bridge or has water in it.

00:40:57.006 --> 00:41:00.216 A:middle
So, augmentation is on your

00:40:57.006 --> 00:41:00.216 A:middle
So, augmentation is on your

00:41:00.216 --> 00:41:01.846 A:middle
original trend dataset will

00:41:01.846 --> 00:41:03.066 A:middle
increase yet the number of

00:41:03.066 --> 00:41:04.206 A:middle
images you have in that dataset

00:41:04.206 --> 00:41:06.306 A:middle
without needing to gather new

00:41:06.306 --> 00:41:06.806 A:middle
images.

00:41:07.466 --> 00:41:08.286 A:middle
You essentially get them for

00:41:08.286 --> 00:41:08.586 A:middle
free.

00:41:09.046 --> 00:41:10.506 A:middle
So, there's many operations you

00:41:10.506 --> 00:41:11.176 A:middle
can carry.

00:41:11.446 --> 00:41:12.696 A:middle
One of them is just changing its

00:41:12.696 --> 00:41:13.116 A:middle
appearance.

00:41:13.116 --> 00:41:14.156 A:middle
For example, the tense, the

00:41:14.156 --> 00:41:15.626 A:middle
temperature and the white point

00:41:15.626 --> 00:41:16.156 A:middle
of your image.

00:41:17.236 --> 00:41:18.496 A:middle
Changing the spectral properties

00:41:18.496 --> 00:41:19.946 A:middle
of your image by adding noise.

00:41:21.466 --> 00:41:22.606 A:middle
Or changing the geometry of your

00:41:22.606 --> 00:41:23.806 A:middle
image by applying transforms.

00:41:25.026 --> 00:41:26.306 A:middle
Well, it turns out all of these

00:41:26.306 --> 00:41:27.636 A:middle
are trivial to achieve using

00:41:27.636 --> 00:41:28.146 A:middle
Core Image.

00:41:28.926 --> 00:41:29.786 A:middle
Let's take a look at a few

00:41:29.786 --> 00:41:31.476 A:middle
filters and how you can use them

00:41:31.666 --> 00:41:32.726 A:middle
for your data augmentation

00:41:32.726 --> 00:41:33.176 A:middle
purposes.

00:41:34.816 --> 00:41:35.716 A:middle
So, we have our input image on

00:41:35.716 --> 00:41:36.556 A:middle
the left-hand side here.

00:41:37.306 --> 00:41:38.606 A:middle
And we can change the

00:41:38.606 --> 00:41:40.016 A:middle
temperature and tint using CI

00:41:40.016 --> 00:41:40.716 A:middle
Temperature and Tint.

00:41:41.806 --> 00:41:43.096 A:middle
We can adjust the brightness,

00:41:43.186 --> 00:41:44.846 A:middle
contrast, as well as saturation

00:41:44.846 --> 00:41:47.296 A:middle
in your images using CI color

00:41:47.296 --> 00:41:47.906 A:middle
controls.

00:41:49.066 --> 00:41:50.126 A:middle
Change the frequency spectrum of

00:41:50.126 --> 00:41:51.896 A:middle
your image using CI dither as

00:41:51.896 --> 00:41:53.006 A:middle
well as CI GaussianBlur.

00:41:53.566 --> 00:41:56.066 A:middle
And change the geometry of your

00:41:56.066 --> 00:41:57.736 A:middle
image using affine transforms.

00:41:58.586 --> 00:42:00.386 A:middle
Let's take a look at all of this

00:41:58.586 --> 00:42:00.386 A:middle
Let's take a look at all of this

00:42:00.386 --> 00:42:01.000 A:middle
in practice.

00:42:09.156 --> 00:42:09.446 A:middle
All right.

00:42:09.446 --> 00:42:10.376 A:middle
So, we're back to my Jupiter

00:42:10.376 --> 00:42:11.036 A:middle
notebook here.

00:42:11.406 --> 00:42:13.006 A:middle
Same setup as before.

00:42:13.156 --> 00:42:14.776 A:middle
First thing I want to show you

00:42:14.776 --> 00:42:15.106 A:middle
is how to [inaudible]

00:42:15.106 --> 00:42:16.386 A:middle
augmentations using Core Image.

00:42:17.176 --> 00:42:18.506 A:middle
So, we're loading an image in

00:42:19.216 --> 00:42:20.646 A:middle
and we're going to define our

00:42:20.646 --> 00:42:21.846 A:middle
augmentation function here.

00:42:21.846 --> 00:42:22.646 A:middle
And what we'll be doing

00:42:22.646 --> 00:42:23.856 A:middle
essentially is sampling from a

00:42:23.856 --> 00:42:25.526 A:middle
random space for each of the

00:42:25.526 --> 00:42:26.686 A:middle
filter I've defined here.

00:42:26.856 --> 00:42:28.096 A:middle
So, we'll be applying

00:42:28.556 --> 00:42:30.816 A:middle
GaussianBlur, scaling rotation,

00:42:31.336 --> 00:42:32.616 A:middle
a few adjustments -- exposure

00:42:32.616 --> 00:42:34.706 A:middle
adjustments -- fibrines as well

00:42:34.706 --> 00:42:35.816 A:middle
as dithering for noise.

00:42:36.516 --> 00:42:38.186 A:middle
All right?

00:42:38.256 --> 00:42:40.286 A:middle
Let's cache that function in and

00:42:40.566 --> 00:42:41.656 A:middle
let's have a look at a few

00:42:41.656 --> 00:42:43.416 A:middle
realizations of that

00:42:44.176 --> 00:42:44.786 A:middle
augmentation.

00:42:45.056 --> 00:42:48.396 A:middle
So my slider here controls the

00:42:48.396 --> 00:42:49.626 A:middle
[inaudible] that I'm using in

00:42:49.626 --> 00:42:50.866 A:middle
the back end.

00:42:52.416 --> 00:42:53.296 A:middle
All right, pretty cool.

00:42:53.296 --> 00:42:55.106 A:middle
I'm not sure how efficient that

00:42:55.106 --> 00:42:56.286 A:middle
is, so here I'm going to be

00:42:56.286 --> 00:42:57.346 A:middle
processing 200 of these

00:42:57.346 --> 00:42:58.506 A:middle
augmentations in real time and

00:42:59.076 --> 00:43:00.506 A:middle
we'll take a look at here -- how

00:42:59.076 --> 00:43:00.506 A:middle
we'll take a look at here -- how

00:43:00.506 --> 00:43:01.936 A:middle
they are being -- actually saved

00:43:01.936 --> 00:43:03.126 A:middle
to disc in real time.

00:43:03.306 --> 00:43:04.826 A:middle
So let's just do that, just to

00:43:04.826 --> 00:43:05.856 A:middle
give you a sense of how fast

00:43:05.856 --> 00:43:06.000 A:middle
that is.

00:43:10.156 --> 00:43:11.000 A:middle
That's really powerful.

00:43:15.236 --> 00:43:15.686 A:middle
All right.

00:43:16.886 --> 00:43:17.806 A:middle
This next thing I want to show

00:43:17.806 --> 00:43:20.346 A:middle
you is how to use CoreML using

00:43:20.346 --> 00:43:20.836 A:middle
Core Image.

00:43:22.026 --> 00:43:23.776 A:middle
And first thing you do is to

00:43:23.776 --> 00:43:25.096 A:middle
load your Core ML model in,

00:43:25.246 --> 00:43:26.066 A:middle
which we did here.

00:43:26.066 --> 00:43:28.606 A:middle
We have a glass model, which

00:43:28.606 --> 00:43:30.736 A:middle
we're going to be using to

00:43:30.866 --> 00:43:32.046 A:middle
generate interesting effect.

00:43:32.146 --> 00:43:32.806 A:middle
So, let's start with the

00:43:32.806 --> 00:43:33.696 A:middle
procedural image.

00:43:34.376 --> 00:43:35.316 A:middle
We've seen this one before.

00:43:35.876 --> 00:43:37.866 A:middle
And then to make it a bit more

00:43:37.866 --> 00:43:38.756 A:middle
interesting, we'll add some

00:43:38.756 --> 00:43:39.416 A:middle
texture to it.

00:43:40.196 --> 00:43:42.336 A:middle
So, we'll be adding multi-band

00:43:42.336 --> 00:43:46.096 A:middle
noise on it as well as some

00:43:46.096 --> 00:43:47.956 A:middle
feathering and some [inaudible].

00:43:47.956 --> 00:43:51.146 A:middle
All right, so this is the input

00:43:51.146 --> 00:43:52.526 A:middle
image we're going to be feeding

00:43:52.526 --> 00:43:54.126 A:middle
to our neural network alongside

00:43:54.126 --> 00:43:55.796 A:middle
the other -- the CoreML model

00:43:55.796 --> 00:43:57.716 A:middle
that we have pre-trained.

00:43:58.026 --> 00:43:58.326 A:middle
All right?

00:43:58.916 --> 00:44:01.500 A:middle
So, let's run this.

00:43:58.916 --> 00:44:01.500 A:middle
So, let's run this.

00:44:05.396 --> 00:44:06.000 A:middle
And --

00:44:10.046 --> 00:44:10.696 A:middle
There you go.

00:44:10.696 --> 00:44:12.566 A:middle
WWDC 2018, just for you.

00:44:13.846 --> 00:44:14.246 A:middle
All right.

00:44:14.636 --> 00:44:16.996 A:middle
On that note, I want to thank

00:44:16.996 --> 00:44:18.666 A:middle
you for coming to this session

00:44:18.666 --> 00:44:19.036 A:middle
today.

00:44:19.806 --> 00:44:21.386 A:middle
I hope you enjoyed this as much

00:44:21.386 --> 00:44:22.666 A:middle
as we enjoyed preparing these

00:44:22.666 --> 00:44:23.246 A:middle
slides for you.

00:44:23.886 --> 00:44:25.626 A:middle
I highly encourage you to come

00:44:25.626 --> 00:44:27.566 A:middle
and talk to us tomorrow at Core

00:44:27.566 --> 00:44:28.936 A:middle
Image Technical Lab at 3:00 pm

00:44:29.616 --> 00:44:30.886 A:middle
and thank you very much.

00:44:31.516 --> 00:44:36.500 A:middle
[ Applause ]
