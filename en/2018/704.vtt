WEBVTT

00:00:07.516 --> 00:00:15.500 A:middle
[ Music ]

00:00:21.216 --> 00:00:21.856 A:middle
&gt;&gt; Good afternoon.

00:00:22.516 --> 00:00:26.796 A:middle
[ Applause ]

00:00:27.296 --> 00:00:28.656 A:middle
Welcome to Best Practices and

00:00:28.656 --> 00:00:29.606 A:middle
What's New with In-App

00:00:29.686 --> 00:00:30.966 A:middle
Purchases, my name is Dana

00:00:30.966 --> 00:00:32.466 A:middle
DuBois, I'm an App Store

00:00:32.466 --> 00:00:33.566 A:middle
engineering manager.

00:00:34.406 --> 00:00:35.596 A:middle
In-app purchases are an

00:00:35.596 --> 00:00:37.596 A:middle
essential part of how so many

00:00:37.596 --> 00:00:38.946 A:middle
apps do businesses in the App

00:00:38.946 --> 00:00:39.326 A:middle
Store.

00:00:39.806 --> 00:00:40.946 A:middle
Whether you have a subscription

00:00:40.946 --> 00:00:43.136 A:middle
model where you're maybe a video

00:00:43.136 --> 00:00:44.926 A:middle
streaming service or a newspaper

00:00:44.926 --> 00:00:46.976 A:middle
or magazine or you offer

00:00:46.976 --> 00:00:49.546 A:middle
consumables, content that the

00:00:49.546 --> 00:00:51.136 A:middle
user can buy over and over again

00:00:51.136 --> 00:00:52.866 A:middle
like in-game currency or

00:00:52.866 --> 00:00:54.996 A:middle
non-consumables, something where

00:00:55.116 --> 00:00:56.906 A:middle
the user buy once and uses from

00:00:56.906 --> 00:00:57.516 A:middle
then on.

00:00:58.136 --> 00:00:59.886 A:middle
It's important to make that user

00:00:59.886 --> 00:01:02.746 A:middle
experience great, this is your


00:00:59.886 --> 00:01:02.746 A:middle
experience great, this is your

00:01:02.746 --> 00:01:04.046 A:middle
business after all.

00:01:05.476 --> 00:01:06.976 A:middle
So we're going to cover some

00:01:06.976 --> 00:01:08.556 A:middle
best practices in order to help

00:01:08.556 --> 00:01:10.036 A:middle
you make that experience great.

00:01:10.156 --> 00:01:10.976 A:middle
We're also going to talk about

00:01:10.976 --> 00:01:12.166 A:middle
some stuff that we have been

00:01:12.166 --> 00:01:14.916 A:middle
doing to make this great for

00:01:14.916 --> 00:01:14.983 A:middle
you.

00:01:19.106 --> 00:01:19.976 A:middle
So first, I'm going to invite my

00:01:19.976 --> 00:01:21.606 A:middle
colleague Ross up on stage, he's

00:01:21.606 --> 00:01:22.666 A:middle
going to talk about Introductory

00:01:22.666 --> 00:01:23.626 A:middle
Pricing, this is a feature we

00:01:23.626 --> 00:01:25.226 A:middle
launched last December and it

00:01:25.226 --> 00:01:26.926 A:middle
allows you for your subscription

00:01:26.926 --> 00:01:28.716 A:middle
business to entice new customers

00:01:28.716 --> 00:01:29.026 A:middle
in.

00:01:29.426 --> 00:01:31.106 A:middle
I'm going to give a quick update

00:01:31.106 --> 00:01:32.956 A:middle
on trials in the App Store.

00:01:32.956 --> 00:01:35.546 A:middle
We're going to go over ratings

00:01:35.546 --> 00:01:37.126 A:middle
and reviews and how your app can

00:01:37.126 --> 00:01:39.146 A:middle
get customers to give feedback

00:01:39.146 --> 00:01:40.176 A:middle
into the App Store.

00:01:40.456 --> 00:01:42.116 A:middle
I'm going to give an update on

00:01:42.116 --> 00:01:43.896 A:middle
how you can use the Apple App

00:01:44.066 --> 00:01:46.266 A:middle
Store Sandbox environment for

00:01:46.266 --> 00:01:47.986 A:middle
testing your in-app purchases.

00:01:49.026 --> 00:01:50.176 A:middle
Ross is going to come back up

00:01:50.176 --> 00:01:51.756 A:middle
and talk about processing

00:01:51.756 --> 00:01:52.806 A:middle
transactions, this is when

00:01:52.806 --> 00:01:53.936 A:middle
you're actually buying those

00:01:53.936 --> 00:01:54.996 A:middle
in-app purchases.

00:01:55.506 --> 00:01:57.416 A:middle
And finally, I'm going to give

00:01:57.416 --> 00:01:58.856 A:middle
you an overview about the in-app

00:01:59.586 --> 00:02:00.266 A:middle
receipt.


00:01:59.586 --> 00:02:00.266 A:middle
receipt.

00:02:01.156 --> 00:02:04.066 A:middle
So to begin here's my colleague

00:02:04.066 --> 00:02:04.556 A:middle
Ross.

00:02:07.106 --> 00:02:09.515 A:middle
&gt;&gt; Thanks Dana.

00:02:09.686 --> 00:02:13.256 A:middle
In iOS 11.2 and macOS 10.13.2 we

00:02:13.256 --> 00:02:14.466 A:middle
added the Introductory Pricing

00:02:14.466 --> 00:02:15.506 A:middle
feature to in-app purchase

00:02:15.506 --> 00:02:16.086 A:middle
subscriptions.

00:02:17.146 --> 00:02:17.946 A:middle
This allows you to create a

00:02:17.946 --> 00:02:19.446 A:middle
one-time use discount for new

00:02:19.446 --> 00:02:20.136 A:middle
subscribers.

00:02:21.556 --> 00:02:23.286 A:middle
We set up introductory pricing

00:02:23.996 --> 00:02:25.736 A:middle
in App Store Connect and each

00:02:25.876 --> 00:02:26.776 A:middle
subscription can only have a

00:02:26.826 --> 00:02:28.186 A:middle
single introductory price at a

00:02:28.756 --> 00:02:28.846 A:middle
time.

00:02:29.206 --> 00:02:30.656 A:middle
When an eligible user purchases

00:02:30.656 --> 00:02:33.056 A:middle
the subscription in your app the

00:02:33.056 --> 00:02:33.936 A:middle
discount is applied

00:02:33.936 --> 00:02:35.376 A:middle
automatically by the App Store.

00:02:36.496 --> 00:02:37.536 A:middle
Each user is eligible for a

00:02:37.536 --> 00:02:39.356 A:middle
single introductory price based

00:02:39.356 --> 00:02:40.346 A:middle
on the subscription group.

00:02:40.776 --> 00:02:42.646 A:middle
I'll go into that a little bit

00:02:43.476 --> 00:02:43.906 A:middle
more later.

00:02:44.126 --> 00:02:45.366 A:middle
Along with Introductory Pricing

00:02:45.846 --> 00:02:47.046 A:middle
we added several new types and

00:02:47.046 --> 00:02:47.926 A:middle
properties in StoreKit.

00:02:49.096 --> 00:02:50.766 A:middle
These APIs reflect the data that

00:02:50.766 --> 00:02:51.646 A:middle
you've set up in App Store

00:02:51.646 --> 00:02:54.186 A:middle
Connect and you can use them to

00:02:54.466 --> 00:02:55.946 A:middle
format your UI to display the

00:02:55.946 --> 00:02:57.186 A:middle
terms of the subscription to

00:02:57.186 --> 00:02:59.156 A:middle
your users, as well as to

00:02:59.156 --> 00:03:00.616 A:middle
determine which users are


00:02:59.156 --> 00:03:00.616 A:middle
determine which users are

00:03:00.616 --> 00:03:01.676 A:middle
eligible for the introductory

00:03:01.676 --> 00:03:02.156 A:middle
prices.

00:03:03.836 --> 00:03:06.296 A:middle
For example, here's what it

00:03:06.296 --> 00:03:07.696 A:middle
looks like in the App Store when

00:03:07.696 --> 00:03:08.996 A:middle
you set up an introductory price

00:03:08.996 --> 00:03:10.456 A:middle
on a promoted in-app purchase.

00:03:11.306 --> 00:03:12.796 A:middle
You can see that it clearly

00:03:12.796 --> 00:03:14.646 A:middle
naturally lays out the terms of

00:03:14.646 --> 00:03:15.726 A:middle
the subscription to the user,

00:03:16.426 --> 00:03:18.586 A:middle
the first year for 19.99, then

00:03:18.586 --> 00:03:21.006 A:middle
39.99 for each year after that.

00:03:21.556 --> 00:03:23.016 A:middle
This is also a great benefit of

00:03:23.016 --> 00:03:24.106 A:middle
promoting your in-app purchases

00:03:24.106 --> 00:03:25.236 A:middle
that have introductory prices.

00:03:25.596 --> 00:03:26.716 A:middle
Users can see the discount

00:03:26.716 --> 00:03:27.696 A:middle
before they even install your

00:03:27.886 --> 00:03:28.486 A:middle
app.

00:03:29.596 --> 00:03:30.696 A:middle
Today I'm going to go over these

00:03:30.696 --> 00:03:32.336 A:middle
new APIs with you and look at a

00:03:32.336 --> 00:03:33.386 A:middle
couple ways you may want to set

00:03:33.386 --> 00:03:36.616 A:middle
up your introductory prices.

00:03:37.856 --> 00:03:40.026 A:middle
First, there's a new property on

00:03:40.126 --> 00:03:41.496 A:middle
SKProduct which is called

00:03:41.496 --> 00:03:42.016 A:middle
fittingly enough

00:03:42.656 --> 00:03:43.476 A:middle
introductoryPrice.

00:03:44.116 --> 00:03:45.456 A:middle
This is a new class that's

00:03:45.456 --> 00:03:46.676 A:middle
called SKProductDiscount.

00:03:47.656 --> 00:03:48.566 A:middle
This class contains all the

00:03:48.566 --> 00:03:49.776 A:middle
information about introductory

00:03:49.776 --> 00:03:50.426 A:middle
price you've set up.

00:03:50.486 --> 00:03:52.406 A:middle
And as you can see it's an

00:03:52.406 --> 00:03:53.776 A:middle
optional property that's because

00:03:53.776 --> 00:03:55.226 A:middle
only subscriptions can have

00:03:55.226 --> 00:03:56.996 A:middle
introductory prices and not all

00:03:56.996 --> 00:03:59.226 A:middle
subscriptions will have them.

00:03:59.316 --> 00:04:00.286 A:middle
So let's dive into


00:03:59.316 --> 00:04:00.286 A:middle
So let's dive into

00:04:00.286 --> 00:04:01.526 A:middle
SKProductDiscount.

00:04:03.636 --> 00:04:05.266 A:middle
SKProductDiscount reflects the

00:04:05.266 --> 00:04:06.236 A:middle
data you've set up about the

00:04:06.236 --> 00:04:07.946 A:middle
introductory price in App Store

00:04:07.946 --> 00:04:08.216 A:middle
Connect.

00:04:08.216 --> 00:04:10.756 A:middle
It has a price and a price

00:04:10.756 --> 00:04:12.396 A:middle
locale property and these behave

00:04:12.396 --> 00:04:13.466 A:middle
the same as the properties with

00:04:13.466 --> 00:04:14.436 A:middle
the same names you're familiar

00:04:14.436 --> 00:04:15.306 A:middle
with on SKProduct.

00:04:15.306 --> 00:04:19.315 A:middle
Also as a subscription period

00:04:19.315 --> 00:04:21.146 A:middle
property, this is a new class

00:04:21.146 --> 00:04:21.546 A:middle
called

00:04:21.546 --> 00:04:24.276 A:middle
SKProductSubscriptionPeriod and

00:04:24.276 --> 00:04:25.456 A:middle
this reflects all the data about

00:04:25.456 --> 00:04:26.976 A:middle
the billing and renewal terms of

00:04:26.976 --> 00:04:27.976 A:middle
the introductory price.

00:04:28.516 --> 00:04:30.466 A:middle
It achieves this with two

00:04:30.466 --> 00:04:32.496 A:middle
properties of its own, the first

00:04:32.496 --> 00:04:33.826 A:middle
is unit which is an enum that

00:04:33.826 --> 00:04:35.806 A:middle
can be day, week, month or year.

00:04:37.196 --> 00:04:38.866 A:middle
The next is number of units.

00:04:39.386 --> 00:04:42.606 A:middle
So for example if you have a

00:04:42.606 --> 00:04:44.286 A:middle
unit of month and a number of

00:04:44.286 --> 00:04:45.976 A:middle
units of 2 that means that the

00:04:45.976 --> 00:04:47.306 A:middle
introductory price renews every

00:04:47.306 --> 00:04:47.836 A:middle
2 months.

00:04:48.346 --> 00:04:51.866 A:middle
And back on SKProductDiscount

00:04:51.936 --> 00:04:53.296 A:middle
there's also a numberOfPeriods

00:04:53.296 --> 00:04:53.686 A:middle
property.

00:04:54.676 --> 00:04:56.016 A:middle
So this reflects the number of

00:04:56.016 --> 00:04:57.166 A:middle
those subscription periods the

00:04:57.166 --> 00:04:58.666 A:middle
introductory price is valid for.

00:04:59.706 --> 00:05:00.906 A:middle
Say if you have that 2-month


00:04:59.706 --> 00:05:00.906 A:middle
Say if you have that 2-month

00:05:00.956 --> 00:05:02.516 A:middle
introductory price, the number

00:05:02.516 --> 00:05:03.996 A:middle
of periods is 3, that means the

00:05:03.996 --> 00:05:05.146 A:middle
introductory price is valid for

00:05:05.146 --> 00:05:05.916 A:middle
a total of 6 months.

00:05:10.066 --> 00:05:11.606 A:middle
Finally, on SKProductDiscount

00:05:12.876 --> 00:05:14.286 A:middle
there's a payment mode property.

00:05:15.286 --> 00:05:16.576 A:middle
This is another new enum that

00:05:16.656 --> 00:05:17.496 A:middle
has three values.

00:05:18.276 --> 00:05:20.496 A:middle
The first value is payAsYouGo,

00:05:21.716 --> 00:05:22.586 A:middle
this behaves like a normal

00:05:22.586 --> 00:05:24.416 A:middle
subscription where the user pays

00:05:24.416 --> 00:05:25.576 A:middle
once per renewal period.

00:05:27.036 --> 00:05:28.416 A:middle
The renewal period for these

00:05:28.416 --> 00:05:29.766 A:middle
does have to be the same as the

00:05:29.766 --> 00:05:30.816 A:middle
renewal period of the base

00:05:30.816 --> 00:05:31.766 A:middle
subscription you've set up the

00:05:31.766 --> 00:05:32.736 A:middle
introductory price on.

00:05:33.306 --> 00:05:35.466 A:middle
So if you had a month-long

00:05:35.586 --> 00:05:37.216 A:middle
subscription you couldn't have a

00:05:37.216 --> 00:05:38.506 A:middle
2-week long introductory price

00:05:38.506 --> 00:05:39.036 A:middle
in this case.

00:05:39.576 --> 00:05:41.886 A:middle
You can use these types of

00:05:41.886 --> 00:05:43.176 A:middle
introductory prices to offer

00:05:43.176 --> 00:05:45.246 A:middle
your users a longer introductory

00:05:45.246 --> 00:05:46.716 A:middle
duration but with less friction

00:05:46.836 --> 00:05:48.746 A:middle
up front.

00:05:48.746 --> 00:05:51.116 A:middle
For example, if you have a

00:05:51.166 --> 00:05:52.796 A:middle
3-month renewing subscription

00:05:52.796 --> 00:05:56.096 A:middle
that's billed at 9.99 you could

00:05:56.096 --> 00:05:57.446 A:middle
set up a 6-month introductory

00:05:57.446 --> 00:06:00.176 A:middle
price that renews twice at 1.99


00:05:57.446 --> 00:06:00.176 A:middle
price that renews twice at 1.99

00:06:00.176 --> 00:06:00.536 A:middle
each.

00:06:02.396 --> 00:06:03.596 A:middle
The billing period would look

00:06:03.596 --> 00:06:05.716 A:middle
like this, the user purchases

00:06:05.716 --> 00:06:07.046 A:middle
the subscription at the

00:06:07.046 --> 00:06:09.446 A:middle
introductory price of 1.99 and

00:06:09.446 --> 00:06:11.036 A:middle
receives 3 months of access.

00:06:11.556 --> 00:06:13.166 A:middle
After that they can renew at

00:06:13.166 --> 00:06:15.106 A:middle
1.99 for another 3 months of

00:06:15.106 --> 00:06:15.596 A:middle
access.

00:06:16.076 --> 00:06:18.236 A:middle
When that's over they'll renew

00:06:18.236 --> 00:06:19.416 A:middle
at the normal subscription terms

00:06:19.416 --> 00:06:20.756 A:middle
of 9.99 for 3 months.

00:06:20.756 --> 00:06:23.856 A:middle
Here's what the data from

00:06:23.856 --> 00:06:25.326 A:middle
StoreKit would look like in this

00:06:25.326 --> 00:06:25.706 A:middle
case.

00:06:26.546 --> 00:06:27.536 A:middle
You can see the

00:06:27.536 --> 00:06:28.826 A:middle
subscriptionPeriod has a unit of

00:06:28.826 --> 00:06:30.636 A:middle
month and the number of units is

00:06:30.636 --> 00:06:32.426 A:middle
3, so it'll renew every 3 months

00:06:32.456 --> 00:06:32.606 A:middle
number.

00:06:33.376 --> 00:06:34.486 A:middle
And then the numberOfPeriods is

00:06:34.486 --> 00:06:35.726 A:middle
2 giving us that total of 6

00:06:35.726 --> 00:06:36.516 A:middle
months of introductory.

00:06:37.056 --> 00:06:39.426 A:middle
The payment mode is payAsYouGo.

00:06:39.486 --> 00:06:40.376 A:middle
And the price for the

00:06:40.376 --> 00:06:41.976 A:middle
introductory price is 1.99.

00:06:46.046 --> 00:06:47.276 A:middle
The next payment mode is

00:06:47.406 --> 00:06:47.926 A:middle
payUpFront.

00:06:47.926 --> 00:06:50.846 A:middle
With this type of introductory

00:06:50.846 --> 00:06:52.206 A:middle
price the user pays just one

00:06:52.206 --> 00:06:53.336 A:middle
time and receives the entire

00:06:53.336 --> 00:06:54.246 A:middle
introductory duration.

00:06:55.516 --> 00:06:57.436 A:middle
This is not limited to multiples

00:06:57.436 --> 00:06:58.536 A:middle
of your subscriptions renewal

00:06:58.536 --> 00:06:58.876 A:middle
period.

00:06:59.206 --> 00:07:00.326 A:middle
So in this case, you could have


00:06:59.206 --> 00:07:00.326 A:middle
So in this case, you could have

00:07:00.796 --> 00:07:02.496 A:middle
a 1-year renewing subscription

00:07:02.736 --> 00:07:04.206 A:middle
and offer a 1-month introductory

00:07:04.206 --> 00:07:04.606 A:middle
price.

00:07:05.166 --> 00:07:08.086 A:middle
So if we can take our previous

00:07:08.086 --> 00:07:10.106 A:middle
example of our 3-month auto

00:07:10.106 --> 00:07:11.706 A:middle
renewable subscription, this

00:07:12.376 --> 00:07:14.426 A:middle
time we'll offer a payUpFront

00:07:14.426 --> 00:07:15.846 A:middle
introductory price for 6 months.

00:07:16.286 --> 00:07:19.666 A:middle
Charging 3.99, so it's about the

00:07:19.666 --> 00:07:20.846 A:middle
same overall cost as the

00:07:20.846 --> 00:07:22.476 A:middle
previous example, but this time

00:07:22.836 --> 00:07:24.416 A:middle
the user will pay 3.99 upfront

00:07:24.416 --> 00:07:25.986 A:middle
and receive the entire 6 months.

00:07:26.106 --> 00:07:28.806 A:middle
After that's up we'll renew with

00:07:28.806 --> 00:07:29.616 A:middle
the normal terms of the

00:07:29.616 --> 00:07:31.826 A:middle
subscription at 9.99 for every 3

00:07:31.826 --> 00:07:31.976 A:middle
months.

00:07:36.046 --> 00:07:36.556 A:middle
Here's what the data from

00:07:36.556 --> 00:07:37.386 A:middle
StoreKit would look like in this

00:07:37.386 --> 00:07:37.766 A:middle
case.

00:07:38.416 --> 00:07:39.736 A:middle
The subscriptionPeriod's unit is

00:07:39.736 --> 00:07:41.126 A:middle
still month, but this time we

00:07:41.126 --> 00:07:42.046 A:middle
have 6 units.

00:07:42.636 --> 00:07:44.566 A:middle
The numberOfPeriods is 1 because

00:07:44.566 --> 00:07:45.816 A:middle
it's a payUpFront introductory

00:07:45.816 --> 00:07:45.976 A:middle
price.

00:07:51.216 --> 00:07:52.446 A:middle
The final payment mode is

00:07:52.556 --> 00:07:52.986 A:middle
freeTrial.

00:07:54.306 --> 00:07:55.436 A:middle
This behaves the same as the old

00:07:55.436 --> 00:07:56.886 A:middle
freeTrial behavior where the

00:07:56.886 --> 00:07:57.896 A:middle
user pays nothing and receives

00:07:57.896 --> 00:07:58.796 A:middle
the entire introductory

00:07:58.796 --> 00:07:59.156 A:middle
duration.


00:08:00.216 --> 00:08:01.406 A:middle
This is available under

00:08:01.406 --> 00:08:03.016 A:middle
durations varying from 3 days

00:08:03.016 --> 00:08:03.896 A:middle
all the way up to 1 year.

00:08:08.166 --> 00:08:10.426 A:middle
Excuse me.

00:08:10.666 --> 00:08:13.256 A:middle
Also in iOS 12 and macOS 10.13.2

00:08:14.766 --> 00:08:15.186 A:middle
we've added the

00:08:15.186 --> 00:08:16.946 A:middle
subscriptionPeriod property to

00:08:16.946 --> 00:08:17.596 A:middle
SKProduct itself.

00:08:18.736 --> 00:08:19.976 A:middle
This way you have access to the

00:08:19.976 --> 00:08:21.616 A:middle
billing and renewal terms of all

00:08:21.616 --> 00:08:22.286 A:middle
of your auto renewable

00:08:22.286 --> 00:08:23.386 A:middle
subscriptions not just the

00:08:23.386 --> 00:08:26.426 A:middle
introductory price.

00:08:26.556 --> 00:08:28.816 A:middle
Also, in iOS 12 and macOS 10.14

00:08:29.486 --> 00:08:29.916 A:middle
we've added the

00:08:29.916 --> 00:08:31.416 A:middle
subscriptionGroupIdentifier to

00:08:31.466 --> 00:08:32.206 A:middle
the SKProduct.

00:08:32.676 --> 00:08:35.756 A:middle
This is important because

00:08:35.905 --> 00:08:37.216 A:middle
introductory pricing eligibility

00:08:37.216 --> 00:08:38.226 A:middle
is based on the subscription

00:08:38.226 --> 00:08:39.356 A:middle
group not the subscription

00:08:39.356 --> 00:08:39.866 A:middle
itself.

00:08:41.196 --> 00:08:42.405 A:middle
Each user is eligible for a

00:08:42.405 --> 00:08:43.976 A:middle
single introductory price per

00:08:43.976 --> 00:08:44.816 A:middle
subscription group.

00:08:45.326 --> 00:08:47.426 A:middle
This is because subscription

00:08:47.426 --> 00:08:48.266 A:middle
groups are meant to offer the

00:08:48.266 --> 00:08:50.216 A:middle
same features or content just a

00:08:50.216 --> 00:08:51.696 A:middle
different at renewal periods and

00:08:51.726 --> 00:08:52.286 A:middle
price points.

00:08:52.476 --> 00:08:54.116 A:middle
For example, many apps offer

00:08:54.116 --> 00:08:55.736 A:middle
both a yearly and a monthly

00:08:55.736 --> 00:08:57.406 A:middle
option for the same content with

00:08:57.406 --> 00:08:58.136 A:middle
the yearly one being

00:08:58.136 --> 00:08:59.206 A:middle
less-expensive over time.


00:09:00.106 --> 00:09:01.136 A:middle
Now it wouldn't really make

00:09:01.136 --> 00:09:02.326 A:middle
sense for a user to receive an

00:09:02.326 --> 00:09:03.506 A:middle
introductory price to both the

00:09:03.506 --> 00:09:05.176 A:middle
monthly and the yearly option

00:09:05.176 --> 00:09:05.976 A:middle
for exact same content.

00:09:09.416 --> 00:09:10.876 A:middle
Since introductory prices are

00:09:10.876 --> 00:09:12.326 A:middle
applied automatically by the App

00:09:12.326 --> 00:09:13.426 A:middle
Store at the time of purchase

00:09:13.826 --> 00:09:14.756 A:middle
it's important that your app

00:09:14.756 --> 00:09:16.196 A:middle
correctly determines the user's

00:09:16.196 --> 00:09:18.506 A:middle
eligibility when displaying the

00:09:19.076 --> 00:09:19.216 A:middle
price.

00:09:19.326 --> 00:09:20.186 A:middle
For more information about

00:09:20.186 --> 00:09:21.946 A:middle
determining eligibility you can

00:09:21.946 --> 00:09:23.236 A:middle
see the engineering subscription

00:09:23.236 --> 00:09:24.526 A:middle
session which is just after this

00:09:24.526 --> 00:09:25.196 A:middle
one at 3 o'clock.

00:09:25.296 --> 00:09:28.546 A:middle
Now with these new APIs you'll

00:09:28.546 --> 00:09:29.636 A:middle
have access to all the

00:09:29.636 --> 00:09:30.776 A:middle
information you've set up in App

00:09:30.776 --> 00:09:31.466 A:middle
Store Connect for your

00:09:31.466 --> 00:09:33.136 A:middle
subscriptions, so your app can

00:09:33.136 --> 00:09:34.356 A:middle
reflect any changes you make

00:09:34.636 --> 00:09:35.806 A:middle
without updates to your binary

00:09:35.806 --> 00:09:36.686 A:middle
or to your server code.

00:09:37.136 --> 00:09:39.836 A:middle
I'd like to invite Dana back on

00:09:39.836 --> 00:09:41.276 A:middle
who has a few tips and

00:09:41.276 --> 00:09:41.976 A:middle
improvements for you.

00:09:44.516 --> 00:09:47.096 A:middle
[ Applause ]

00:09:47.596 --> 00:09:49.826 A:middle
&gt;&gt; Thank you Ross, so

00:09:49.826 --> 00:09:51.736 A:middle
Introductory Pricing is a great

00:09:51.776 --> 00:09:54.836 A:middle
way to attract new customers if

00:09:54.836 --> 00:09:55.806 A:middle
your business model is a

00:09:55.806 --> 00:09:56.476 A:middle
subscription.

00:09:57.086 --> 00:09:58.636 A:middle
But what if it doesn't make

00:09:58.636 --> 00:10:00.246 A:middle
sense for your app and your


00:09:58.636 --> 00:10:00.246 A:middle
sense for your app and your

00:10:00.246 --> 00:10:01.946 A:middle
app's business model to offer a

00:10:01.946 --> 00:10:02.976 A:middle
subscription service?

00:10:03.966 --> 00:10:06.986 A:middle
Well, starting today we're

00:10:06.986 --> 00:10:08.006 A:middle
excited to announce that you can

00:10:08.006 --> 00:10:09.476 A:middle
offer free trials for

00:10:09.476 --> 00:10:11.086 A:middle
non-subscription based apps.

00:10:11.836 --> 00:10:12.936 A:middle
This will allow you to have a

00:10:12.936 --> 00:10:14.506 A:middle
try before you can buy

00:10:14.506 --> 00:10:15.436 A:middle
experience.

00:10:15.436 --> 00:10:18.606 A:middle
So how do you do this?

00:10:19.746 --> 00:10:22.796 A:middle
Well you take your payUpFront

00:10:22.796 --> 00:10:25.306 A:middle
app and you make it free in the

00:10:25.306 --> 00:10:26.106 A:middle
App Store.

00:10:26.946 --> 00:10:28.096 A:middle
And then you add a

00:10:28.096 --> 00:10:30.086 A:middle
non-consumable in-app purchase

00:10:30.086 --> 00:10:30.656 A:middle
to unlock.

00:10:30.656 --> 00:10:32.456 A:middle
So if your app is 9.99 in the

00:10:32.456 --> 00:10:33.426 A:middle
App Store you're going to want

00:10:33.426 --> 00:10:35.336 A:middle
to make a non-consumable in-app

00:10:35.466 --> 00:10:37.156 A:middle
purchase of 9.99.

00:10:38.486 --> 00:10:39.446 A:middle
But it's important to let the

00:10:39.446 --> 00:10:41.456 A:middle
user decide when to begin the

00:10:41.456 --> 00:10:43.976 A:middle
trial period, so to do that you

00:10:43.976 --> 00:10:45.176 A:middle
need to make a second

00:10:45.796 --> 00:10:47.406 A:middle
non-consumable in-app purchase

00:10:47.406 --> 00:10:48.656 A:middle
at price tier 0.

00:10:48.656 --> 00:10:50.006 A:middle
This will be a free

00:10:50.006 --> 00:10:52.636 A:middle
non-consumable that the user

00:10:52.636 --> 00:10:54.576 A:middle
will use to begin their trial

00:10:54.576 --> 00:10:55.026 A:middle
period.

00:10:56.216 --> 00:10:57.856 A:middle
The naming convention of that

00:10:58.186 --> 00:11:00.486 A:middle
free non-consumable should


00:10:58.186 --> 00:11:00.486 A:middle
free non-consumable should

00:11:00.586 --> 00:11:02.956 A:middle
detail out how long that

00:11:02.956 --> 00:11:04.086 A:middle
introductory period is.

00:11:04.086 --> 00:11:05.796 A:middle
So in this example it's 14-day

00:11:05.796 --> 00:11:06.426 A:middle
trial.

00:11:07.836 --> 00:11:10.506 A:middle
Before the user begins their

00:11:10.506 --> 00:11:11.586 A:middle
free trial, they should be

00:11:11.626 --> 00:11:13.846 A:middle
clearly informed of how long

00:11:13.846 --> 00:11:15.386 A:middle
that trial is, in your app's UI

00:11:15.386 --> 00:11:18.636 A:middle
what the ultimate cost is going

00:11:18.636 --> 00:11:20.646 A:middle
to be to unlock at the end of

00:11:20.646 --> 00:11:21.626 A:middle
that free trial.

00:11:22.366 --> 00:11:25.106 A:middle
And finally, what features or

00:11:25.176 --> 00:11:27.016 A:middle
content is going to be lost if

00:11:27.016 --> 00:11:28.706 A:middle
they let the free trial expire

00:11:28.706 --> 00:11:30.356 A:middle
and choose not to purchase the

00:11:30.356 --> 00:11:31.096 A:middle
full unlock.

00:11:31.346 --> 00:11:32.406 A:middle
That information needs to be

00:11:32.406 --> 00:11:33.286 A:middle
presented up front.

00:11:34.046 --> 00:11:34.906 A:middle
So this gives you a quick

00:11:34.906 --> 00:11:36.246 A:middle
overview of the change, I'm

00:11:36.246 --> 00:11:37.396 A:middle
going to talk more about how you

00:11:37.396 --> 00:11:38.636 A:middle
can implement this inside your

00:11:38.636 --> 00:11:40.306 A:middle
app when I go over receipts.

00:11:40.806 --> 00:11:44.486 A:middle
Right now however I'd like to

00:11:44.486 --> 00:11:46.316 A:middle
give an update on requesting

00:11:46.316 --> 00:11:47.786 A:middle
ratings and reviews.

00:11:48.936 --> 00:11:50.116 A:middle
Whether or not your app has

00:11:50.116 --> 00:11:51.936 A:middle
in-app purchases if it's in the

00:11:51.936 --> 00:11:53.336 A:middle
App Store you care about the

00:11:53.446 --> 00:11:55.316 A:middle
feedback your users are going to

00:11:55.316 --> 00:11:55.516 A:middle
give.

00:11:55.796 --> 00:11:56.956 A:middle
And there are ae few ways the

00:11:56.956 --> 00:11:58.836 A:middle
App Store and StoreKit can get

00:11:58.836 --> 00:11:59.826 A:middle
you that information.


00:12:01.096 --> 00:12:04.166 A:middle
First, in iOS 10.3 we introduced

00:12:04.166 --> 00:12:06.016 A:middle
the SKStoreReviewController.

00:12:06.016 --> 00:12:08.586 A:middle
This is a powerful API and it

00:12:08.586 --> 00:12:10.986 A:middle
allows an app to give a quick

00:12:11.026 --> 00:12:12.796 A:middle
and easy prompt for the user to

00:12:12.796 --> 00:12:14.706 A:middle
select a star rating or maybe

00:12:14.706 --> 00:12:16.076 A:middle
even type in a review and get

00:12:16.076 --> 00:12:17.926 A:middle
right back to using your app.

00:12:18.596 --> 00:12:21.036 A:middle
But with great power comes

00:12:21.246 --> 00:12:22.246 A:middle
restrictions.

00:12:23.006 --> 00:12:25.836 A:middle
First, we limit the number of

00:12:25.836 --> 00:12:27.186 A:middle
times that this prompt can

00:12:27.186 --> 00:12:30.466 A:middle
appear per app, per device and

00:12:30.466 --> 00:12:31.316 A:middle
per year.

00:12:32.866 --> 00:12:35.516 A:middle
Second, if users choose never to

00:12:35.516 --> 00:12:37.556 A:middle
see these rating prompt they can

00:12:37.556 --> 00:12:38.956 A:middle
just go into App Store settings

00:12:38.956 --> 00:12:40.286 A:middle
and disable them altogether.

00:12:41.346 --> 00:12:43.116 A:middle
So with those 2 restrictions in

00:12:43.116 --> 00:12:45.666 A:middle
mind what are some strategies

00:12:45.666 --> 00:12:46.936 A:middle
you want to use for when to

00:12:46.936 --> 00:12:49.296 A:middle
determine is the best time to

00:12:49.296 --> 00:12:51.186 A:middle
call into the review controller.

00:12:52.356 --> 00:12:54.486 A:middle
Well first and foremost, don't

00:12:54.486 --> 00:12:55.166 A:middle
interrupt.

00:12:55.236 --> 00:12:57.486 A:middle
If the user is in the middle of

00:12:57.486 --> 00:12:58.866 A:middle
playing that level and fighting

00:12:58.866 --> 00:13:00.426 A:middle
the big boss at the end of it


00:12:58.866 --> 00:13:00.426 A:middle
the big boss at the end of it

00:13:01.036 --> 00:13:02.386 A:middle
it's not a great time to ask

00:13:02.386 --> 00:13:04.516 A:middle
them to rate your game, wait

00:13:04.516 --> 00:13:05.156 A:middle
until they're done.

00:13:05.676 --> 00:13:09.186 A:middle
You should also wait until both

00:13:09.386 --> 00:13:10.876 A:middle
they've had enough experience

00:13:10.876 --> 00:13:12.276 A:middle
with your app to actually have a

00:13:12.276 --> 00:13:14.196 A:middle
good opinion about it, as well

00:13:14.196 --> 00:13:15.046 A:middle
as wait until they've had a

00:13:15.046 --> 00:13:16.236 A:middle
positive experience.

00:13:16.236 --> 00:13:17.516 A:middle
Maybe they just finished

00:13:17.516 --> 00:13:19.216 A:middle
fighting that boss, maybe they

00:13:19.216 --> 00:13:20.616 A:middle
just ordered food and it got

00:13:20.616 --> 00:13:22.126 A:middle
delivered through your app, wait

00:13:22.126 --> 00:13:23.856 A:middle
until that positive experience.

00:13:25.196 --> 00:13:26.376 A:middle
Finally, I mentioned before that

00:13:26.376 --> 00:13:28.746 A:middle
we limit the number of times we

00:13:28.746 --> 00:13:30.666 A:middle
will prompt this review her app,

00:13:30.836 --> 00:13:33.046 A:middle
per device, per year, but that

00:13:33.046 --> 00:13:34.206 A:middle
doesn't mean we do any sort of

00:13:34.206 --> 00:13:34.876 A:middle
rate limiting.

00:13:35.786 --> 00:13:37.906 A:middle
So if within one session you

00:13:37.906 --> 00:13:39.886 A:middle
call the SKStoreReviewController

00:13:40.046 --> 00:13:42.046 A:middle
3 times and the user keeps

00:13:42.046 --> 00:13:44.006 A:middle
clicking not now they will see

00:13:44.006 --> 00:13:45.486 A:middle
that 3 times in a row.

00:13:45.486 --> 00:13:47.316 A:middle
It's up to you to add your own

00:13:47.316 --> 00:13:49.186 A:middle
rate limiting to your app.

00:13:49.466 --> 00:13:50.706 A:middle
So how does this look in code?

00:13:51.826 --> 00:13:54.556 A:middle
Well as I've been saying, wrap

00:13:54.556 --> 00:13:55.216 A:middle
any call to the

00:13:55.216 --> 00:13:56.396 A:middle
StoreReviewController around

00:13:56.396 --> 00:13:58.096 A:middle
your own app's business logic.

00:13:58.396 --> 00:13:59.286 A:middle
Here's what you're going to want

00:13:59.286 --> 00:14:00.946 A:middle
to check, is this a good time to


00:13:59.286 --> 00:14:00.946 A:middle
to check, is this a good time to

00:14:00.946 --> 00:14:03.426 A:middle
do it, are they in the middle or

00:14:03.426 --> 00:14:05.066 A:middle
have they just completed a task.

00:14:05.696 --> 00:14:06.776 A:middle
Have they just had a positive

00:14:06.776 --> 00:14:08.936 A:middle
experience and have you prompted

00:14:08.936 --> 00:14:10.286 A:middle
recently, that's where you want

00:14:10.286 --> 00:14:10.936 A:middle
to have your check.

00:14:11.146 --> 00:14:13.366 A:middle
As soon as all of those pass you

00:14:13.366 --> 00:14:14.246 A:middle
simply call

00:14:14.286 --> 00:14:15.946 A:middle
SKStoreReviewController.

00:14:15.946 --> 00:14:17.486 A:middle
requestReview.

00:14:17.856 --> 00:14:19.416 A:middle
It takes no input and it gives

00:14:19.416 --> 00:14:21.166 A:middle
back no output, it's a simple

00:14:21.166 --> 00:14:22.176 A:middle
but powerful API.

00:14:23.726 --> 00:14:25.746 A:middle
We've gotten immense response

00:14:25.746 --> 00:14:27.036 A:middle
from developers about these

00:14:27.036 --> 00:14:28.936 A:middle
APIs, I'm happy to share a few

00:14:28.936 --> 00:14:29.346 A:middle
with you.

00:14:30.176 --> 00:14:32.036 A:middle
Zappos have said they're seeing

00:14:32.396 --> 00:14:34.786 A:middle
10 times the amount of reviews

00:14:34.786 --> 00:14:36.266 A:middle
that they used to using the

00:14:36.266 --> 00:14:37.936 A:middle
SKStoreReviewController and it's

00:14:37.936 --> 00:14:39.596 A:middle
giving them the confidence to

00:14:39.596 --> 00:14:40.566 A:middle
know that they're delivering the

00:14:40.566 --> 00:14:42.176 A:middle
right things to their customers.

00:14:42.836 --> 00:14:45.186 A:middle
Frosty Pop, maker of such great

00:14:45.186 --> 00:14:47.796 A:middle
games like Kingpin Bowling and

00:14:47.796 --> 00:14:49.776 A:middle
Ninja Attack have said that

00:14:50.436 --> 00:14:51.636 A:middle
they're getting greater

00:14:51.636 --> 00:14:53.206 A:middle
visibility in the App Store and

00:14:53.686 --> 00:14:55.576 A:middle
because of a larger sample size

00:14:56.006 --> 00:14:57.616 A:middle
they have a much greater and

00:14:57.616 --> 00:14:59.326 A:middle
more relevantly engaged user

00:14:59.326 --> 00:15:00.426 A:middle
base giving feedback.


00:14:59.326 --> 00:15:00.426 A:middle
base giving feedback.

00:15:00.426 --> 00:15:03.286 A:middle
I hope this type of feedback

00:15:03.286 --> 00:15:04.566 A:middle
convinces you that you shouldn't

00:15:04.566 --> 00:15:06.496 A:middle
be using your own prompts to

00:15:06.496 --> 00:15:07.606 A:middle
request review you should move

00:15:07.606 --> 00:15:08.436 A:middle
over to the

00:15:08.436 --> 00:15:11.216 A:middle
SKStoreReviewController, it

00:15:11.216 --> 00:15:12.326 A:middle
really has been making

00:15:12.326 --> 00:15:13.276 A:middle
tremendous gains.

00:15:16.116 --> 00:15:18.056 A:middle
As I'm sure you saw yesterday,

00:15:18.576 --> 00:15:20.556 A:middle
we announced a beautiful new Mac

00:15:20.556 --> 00:15:22.646 A:middle
App Store and we know you guys

00:15:22.646 --> 00:15:23.676 A:middle
are all going to rush off and

00:15:23.676 --> 00:15:25.476 A:middle
make great new Mac apps.

00:15:25.906 --> 00:15:27.486 A:middle
And so with that we're excited

00:15:27.486 --> 00:15:29.056 A:middle
to announce that we brought the

00:15:29.056 --> 00:15:30.856 A:middle
write a review API to the Mac

00:15:31.136 --> 00:15:31.976 A:middle
starting with Mojave.

00:15:32.516 --> 00:15:36.566 A:middle
[ Applause ]

00:15:37.066 --> 00:15:38.136 A:middle
So I mentioned there were a few

00:15:38.136 --> 00:15:41.156 A:middle
ways you can get users to write

00:15:41.156 --> 00:15:42.716 A:middle
reviews for your apps.

00:15:44.226 --> 00:15:46.046 A:middle
Well another way of doing it is

00:15:46.156 --> 00:15:47.676 A:middle
you can deep link right into the

00:15:47.676 --> 00:15:48.436 A:middle
App Store.

00:15:49.226 --> 00:15:50.636 A:middle
We also introduced this in iOS

00:15:50.636 --> 00:15:52.216 A:middle
10.3 and we're also bringing

00:15:52.216 --> 00:15:53.436 A:middle
that to the Mac this year.

00:15:54.746 --> 00:15:56.156 A:middle
It's basically just a link right

00:15:56.156 --> 00:15:57.816 A:middle
into your product page, you tell

00:15:57.816 --> 00:15:59.126 A:middle
the App Store bring up the write

00:15:59.126 --> 00:16:00.886 A:middle
a review sheet and the user can


00:15:59.126 --> 00:16:00.886 A:middle
a review sheet and the user can

00:16:00.886 --> 00:16:01.786 A:middle
fill it out right then and

00:16:01.786 --> 00:16:02.036 A:middle
there.

00:16:02.196 --> 00:16:04.046 A:middle
As an alternative to the

00:16:04.046 --> 00:16:05.606 A:middle
SKStoreReviewController this

00:16:05.606 --> 00:16:07.386 A:middle
works much better from any sort

00:16:07.386 --> 00:16:09.056 A:middle
of UI you might have where the

00:16:09.056 --> 00:16:10.626 A:middle
user has to take an immediate

00:16:10.626 --> 00:16:11.216 A:middle
action.

00:16:11.936 --> 00:16:13.856 A:middle
So for example, if you had a

00:16:13.856 --> 00:16:15.946 A:middle
button inside a settings page

00:16:15.946 --> 00:16:17.726 A:middle
within your app basically asking

00:16:17.726 --> 00:16:18.866 A:middle
the user to kindly write a

00:16:18.866 --> 00:16:20.576 A:middle
review this would be a great

00:16:20.576 --> 00:16:22.296 A:middle
time to use a deep link right

00:16:22.296 --> 00:16:23.406 A:middle
into your product page.

00:16:24.086 --> 00:16:24.986 A:middle
So how does this work?

00:16:25.976 --> 00:16:28.536 A:middle
Well pretty simple, you take

00:16:28.536 --> 00:16:30.326 A:middle
your product page URL and you

00:16:30.326 --> 00:16:32.406 A:middle
add action=write-review to the

00:16:32.406 --> 00:16:32.836 A:middle
end of it.

00:16:32.836 --> 00:16:34.136 A:middle
This informs the App Store to

00:16:34.136 --> 00:16:35.216 A:middle
bring right up the write a

00:16:35.216 --> 00:16:35.866 A:middle
review sheet.

00:16:36.246 --> 00:16:38.776 A:middle
If you don't know how to get a

00:16:38.776 --> 00:16:41.176 A:middle
product URL for your app

00:16:41.766 --> 00:16:44.316 A:middle
linkmaker.itunes.apple.com is a

00:16:44.316 --> 00:16:46.356 A:middle
great facility for finding that.

00:16:46.446 --> 00:16:47.166 A:middle
You can get a lot more

00:16:47.166 --> 00:16:48.536 A:middle
information about ratings and

00:16:48.536 --> 00:16:49.686 A:middle
reviews, including how to

00:16:49.686 --> 00:16:51.596 A:middle
respond to your customer reviews

00:16:51.736 --> 00:16:53.106 A:middle
right on the developer website.

00:16:53.636 --> 00:16:57.776 A:middle
I'd like to do a deep dive into

00:16:58.006 --> 00:16:59.676 A:middle
the App Store Sandbox next.


00:17:00.686 --> 00:17:02.066 A:middle
So what do I mean by the

00:17:02.066 --> 00:17:03.036 A:middle
Sandbox?

00:17:03.656 --> 00:17:05.906 A:middle
Well first what don't I mean,

00:17:05.996 --> 00:17:07.906 A:middle
I'm not talking about the app

00:17:07.906 --> 00:17:10.236 A:middle
Sandbox, that part of the

00:17:10.266 --> 00:17:11.766 A:middle
operating system in kernel that

00:17:11.766 --> 00:17:14.106 A:middle
limits what resources your apps

00:17:14.106 --> 00:17:14.886 A:middle
have access to.

00:17:15.126 --> 00:17:16.435 A:middle
What I'm really talking about is

00:17:16.435 --> 00:17:18.435 A:middle
a dedicated environment, it's an

00:17:18.435 --> 00:17:20.736 A:middle
entire copy of the App Store

00:17:20.736 --> 00:17:22.106 A:middle
commerce engine on the server

00:17:22.106 --> 00:17:24.106 A:middle
side that's there for you to

00:17:24.106 --> 00:17:26.016 A:middle
test your apps and in-app

00:17:26.016 --> 00:17:26.915 A:middle
purchases.

00:17:28.435 --> 00:17:31.076 A:middle
StoreKit knows when to go to the

00:17:31.076 --> 00:17:32.946 A:middle
Sandbox environment based on how

00:17:32.946 --> 00:17:34.036 A:middle
your app is signed.

00:17:34.806 --> 00:17:36.486 A:middle
So for example, you're building

00:17:36.486 --> 00:17:38.196 A:middle
your app in Xcode, it's signed

00:17:38.196 --> 00:17:39.946 A:middle
with the developer's certificate

00:17:40.566 --> 00:17:41.756 A:middle
StoreKit knows right then and

00:17:41.756 --> 00:17:43.526 A:middle
there take all of your requests

00:17:43.526 --> 00:17:44.846 A:middle
to the Sandbox environment.

00:17:45.356 --> 00:17:47.996 A:middle
If the user downloads the app

00:17:48.076 --> 00:17:49.676 A:middle
from the production App Store in

00:17:49.676 --> 00:17:50.466 A:middle
that case it's going to be

00:17:50.466 --> 00:17:51.346 A:middle
production signed.

00:17:51.906 --> 00:17:53.476 A:middle
StoreKit knows to go right to

00:17:53.476 --> 00:17:55.016 A:middle
the regular production

00:17:55.016 --> 00:17:55.536 A:middle
environment.

00:17:56.916 --> 00:17:58.496 A:middle
So what makes the Sandbox

00:17:58.496 --> 00:17:59.386 A:middle
environment different?

00:17:59.386 --> 00:18:02.676 A:middle
Well first we don't charge, this


00:17:59.386 --> 00:18:02.676 A:middle
Well first we don't charge, this

00:18:02.676 --> 00:18:04.266 A:middle
is an environment for you to

00:18:04.266 --> 00:18:05.406 A:middle
test your in-apps.

00:18:05.756 --> 00:18:06.716 A:middle
You're going to test them over

00:18:06.716 --> 00:18:08.066 A:middle
and over and over again, there's

00:18:08.066 --> 00:18:09.306 A:middle
no reason to charge.

00:18:10.206 --> 00:18:12.396 A:middle
Second, we have specific

00:18:12.396 --> 00:18:14.266 A:middle
dedicated Sandbox accounts that

00:18:14.266 --> 00:18:16.146 A:middle
you create in App Store Connect

00:18:16.476 --> 00:18:18.406 A:middle
for your developer to use in the

00:18:18.406 --> 00:18:19.986 A:middle
Sandbox environment, they're not

00:18:19.986 --> 00:18:22.136 A:middle
the same as your regular iTunes

00:18:22.136 --> 00:18:23.686 A:middle
in-apps accounts.

00:18:24.956 --> 00:18:26.586 A:middle
We also as I mentioned before

00:18:26.586 --> 00:18:27.906 A:middle
have a completely different

00:18:27.906 --> 00:18:29.196 A:middle
backend environment which means

00:18:29.196 --> 00:18:30.526 A:middle
there's a completely different

00:18:30.526 --> 00:18:32.006 A:middle
URL from when you're doing

00:18:32.196 --> 00:18:33.726 A:middle
server to server receipt

00:18:33.726 --> 00:18:34.496 A:middle
validation.

00:18:34.746 --> 00:18:35.886 A:middle
This is important to know if

00:18:35.886 --> 00:18:37.726 A:middle
you're taking that development

00:18:37.896 --> 00:18:39.736 A:middle
test receipt from your device,

00:18:39.736 --> 00:18:41.916 A:middle
sending it to your QA server and

00:18:41.916 --> 00:18:43.896 A:middle
wanting to have that go to the

00:18:44.186 --> 00:18:45.726 A:middle
Verify Receipt endpoint for

00:18:45.726 --> 00:18:46.406 A:middle
validation.

00:18:47.256 --> 00:18:48.186 A:middle
I'll talk more about that a

00:18:48.186 --> 00:18:49.086 A:middle
little bit later on.

00:18:50.416 --> 00:18:52.016 A:middle
We also offer some test modes

00:18:52.016 --> 00:18:53.196 A:middle
right in StoreKit.

00:18:53.596 --> 00:18:54.496 A:middle
So for example,

00:18:54.656 --> 00:18:58.536 A:middle
SKReceiptRefreshRequest can take

00:18:58.536 --> 00:19:00.616 A:middle
in an argument to get an expired


00:18:58.536 --> 00:19:00.616 A:middle
in an argument to get an expired

00:19:00.616 --> 00:19:01.156 A:middle
receipt.

00:19:01.586 --> 00:19:03.066 A:middle
This way you can actually test

00:19:03.426 --> 00:19:04.876 A:middle
hey what happens if I get an

00:19:04.876 --> 00:19:06.816 A:middle
expired receipt later on.

00:19:08.356 --> 00:19:09.856 A:middle
We also have an ability for you

00:19:09.856 --> 00:19:12.386 A:middle
to simulate what would happen if

00:19:12.386 --> 00:19:14.896 A:middle
a kid is asking their parent for

00:19:14.896 --> 00:19:15.896 A:middle
an in-app purchase.

00:19:16.666 --> 00:19:17.026 A:middle
We have

00:19:17.026 --> 00:19:19.006 A:middle
simulatesAskToBuyInSandbox.

00:19:20.696 --> 00:19:21.986 A:middle
Probably one of the biggest

00:19:21.986 --> 00:19:24.476 A:middle
differences is that when you're

00:19:24.476 --> 00:19:25.306 A:middle
working with in-app

00:19:25.306 --> 00:19:27.506 A:middle
subscriptions we can track down

00:19:27.506 --> 00:19:29.206 A:middle
how long it takes to auto renew.

00:19:29.726 --> 00:19:30.886 A:middle
If you have an annual

00:19:30.886 --> 00:19:32.666 A:middle
subscription in your app it

00:19:32.666 --> 00:19:33.846 A:middle
would be ridiculous for us to

00:19:33.846 --> 00:19:35.536 A:middle
make you wait a year to test

00:19:35.836 --> 00:19:37.046 A:middle
your annual subscription

00:19:37.046 --> 00:19:37.576 A:middle
renewing.

00:19:39.016 --> 00:19:41.356 A:middle
A general rule of thumb is 1

00:19:41.356 --> 00:19:44.166 A:middle
year in real time equals 1 hour

00:19:44.166 --> 00:19:45.196 A:middle
in Sandbox.

00:19:46.196 --> 00:19:47.336 A:middle
You can also see that if you

00:19:47.336 --> 00:19:48.636 A:middle
have a monthly subscription

00:19:48.826 --> 00:19:50.166 A:middle
that's only 5 minutes.

00:19:51.636 --> 00:19:53.816 A:middle
We also limit the number of auto

00:19:53.816 --> 00:19:55.986 A:middle
renews in Sandbox to 5.

00:19:56.576 --> 00:19:58.826 A:middle
So when you buy that initial

00:19:59.036 --> 00:20:00.836 A:middle
subscription purchase you'll


00:19:59.036 --> 00:20:00.836 A:middle
subscription purchase you'll

00:20:00.836 --> 00:20:02.886 A:middle
have 5 automatic auto renews

00:20:03.156 --> 00:20:04.826 A:middle
working up this cadence and at

00:20:04.826 --> 00:20:05.976 A:middle
the end it'll just stop.

00:20:06.096 --> 00:20:07.996 A:middle
This is to simulate what would

00:20:07.996 --> 00:20:09.166 A:middle
happen if a user goes into

00:20:09.166 --> 00:20:10.726 A:middle
managed accounts and disables

00:20:10.726 --> 00:20:11.716 A:middle
that subscription, they just

00:20:11.756 --> 00:20:13.926 A:middle
turn it off or what we call

00:20:13.926 --> 00:20:15.726 A:middle
voluntary turn, they've decided

00:20:15.726 --> 00:20:16.516 A:middle
they don't want to use your

00:20:16.516 --> 00:20:17.366 A:middle
service anymore.

00:20:17.846 --> 00:20:21.486 A:middle
So how do set all this up, how

00:20:21.486 --> 00:20:22.656 A:middle
do you work with the Sandbox

00:20:22.656 --> 00:20:23.106 A:middle
environment?

00:20:23.106 --> 00:20:24.276 A:middle
Well first you go into App Store

00:20:24.276 --> 00:20:26.576 A:middle
Connect, you create your users.

00:20:27.076 --> 00:20:29.666 A:middle
You create your products that

00:20:29.666 --> 00:20:30.806 A:middle
you're going to sell, you're

00:20:30.806 --> 00:20:31.846 A:middle
going to need to get that up on

00:20:31.846 --> 00:20:33.156 A:middle
the server side before your app

00:20:33.156 --> 00:20:34.236 A:middle
starts working with that.

00:20:35.446 --> 00:20:36.656 A:middle
You build and sign your app in

00:20:36.686 --> 00:20:37.896 A:middle
Xcode just like you do all the

00:20:37.896 --> 00:20:38.336 A:middle
time.

00:20:39.086 --> 00:20:40.346 A:middle
And you launch your app and you

00:20:40.346 --> 00:20:41.646 A:middle
go find a product to buy.

00:20:42.206 --> 00:20:44.386 A:middle
And then when prompted you sign

00:20:44.386 --> 00:20:45.586 A:middle
in with your Sandbox account.

00:20:46.076 --> 00:20:48.866 A:middle
Now if you're paying attention

00:20:48.866 --> 00:20:50.426 A:middle
you might have thought I missed

00:20:50.426 --> 00:20:51.206 A:middle
a step.

00:20:51.816 --> 00:20:53.946 A:middle
What would happen if I'm already

00:20:53.946 --> 00:20:56.206 A:middle
signed in to my production app

00:20:56.606 --> 00:20:58.706 A:middle
or iTunes Store, don't I need to

00:20:58.706 --> 00:21:00.676 A:middle
sign out before using a Sandbox


00:20:58.706 --> 00:21:00.676 A:middle
sign out before using a Sandbox

00:21:00.676 --> 00:21:01.046 A:middle
account?

00:21:01.816 --> 00:21:03.316 A:middle
Well starting in iOS 12 that's

00:21:03.316 --> 00:21:04.546 A:middle
no longer the case.

00:21:05.516 --> 00:21:11.086 A:middle
[ Applause ]

00:21:11.586 --> 00:21:13.786 A:middle
Down here we've separated out

00:21:14.086 --> 00:21:15.196 A:middle
your production account from

00:21:15.196 --> 00:21:16.426 A:middle
your Sandbox account, you can

00:21:16.426 --> 00:21:18.176 A:middle
manage it separately just like

00:21:18.176 --> 00:21:19.736 A:middle
how we use the receipt to decide

00:21:19.736 --> 00:21:21.366 A:middle
which environment to use we use

00:21:21.366 --> 00:21:22.906 A:middle
the -- I'm sorry, just like we

00:21:22.906 --> 00:21:24.616 A:middle
use the certificate to know

00:21:24.616 --> 00:21:26.286 A:middle
which environment to use we know

00:21:26.286 --> 00:21:28.926 A:middle
to use the Sandbox account when

00:21:28.926 --> 00:21:30.086 A:middle
you're in development mode.

00:21:30.896 --> 00:21:32.056 A:middle
So look forward to that in iOS

00:21:32.056 --> 00:21:33.006 A:middle
12 I think it's going to make a

00:21:33.006 --> 00:21:34.466 A:middle
huge difference for carrying

00:21:34.466 --> 00:21:35.866 A:middle
these test apps on your personal

00:21:35.866 --> 00:21:37.646 A:middle
devices for long-term testing.

00:21:38.166 --> 00:21:41.156 A:middle
So now I'm going to invite Ross

00:21:41.156 --> 00:21:42.076 A:middle
back up and he's going to talk

00:21:42.076 --> 00:21:43.756 A:middle
about some best practices, some

00:21:43.756 --> 00:21:45.056 A:middle
things you want to keep in mind

00:21:45.056 --> 00:21:45.846 A:middle
when processing your

00:21:45.846 --> 00:21:46.826 A:middle
transactions.

00:21:47.236 --> 00:21:47.626 A:middle
Ross.

00:21:48.516 --> 00:21:53.500 A:middle
[ Applause ]

00:21:55.256 --> 00:21:56.576 A:middle
&gt;&gt; I would like to go over a few

00:21:56.576 --> 00:21:57.876 A:middle
common questions and scenarios

00:21:57.876 --> 00:21:59.106 A:middle
we see and discuss the best way

00:21:59.106 --> 00:22:00.856 A:middle
to handle them.


00:21:59.106 --> 00:22:00.856 A:middle
to handle them.

00:22:01.056 --> 00:22:02.756 A:middle
First things first, you should

00:22:02.756 --> 00:22:04.236 A:middle
add your Transaction Observer to

00:22:04.236 --> 00:22:05.576 A:middle
the default gaming queue as

00:22:05.636 --> 00:22:06.806 A:middle
early as possible in the life

00:22:06.806 --> 00:22:08.066 A:middle
cycle of your app.

00:22:09.456 --> 00:22:10.956 A:middle
This is a common issue we see

00:22:10.956 --> 00:22:12.176 A:middle
where apps don't add a

00:22:12.176 --> 00:22:13.416 A:middle
Transaction Observer until the

00:22:13.416 --> 00:22:14.616 A:middle
user navigates to the in-app

00:22:14.656 --> 00:22:16.216 A:middle
purchase UI or even until they

00:22:16.216 --> 00:22:17.136 A:middle
begin a transaction.

00:22:18.206 --> 00:22:19.996 A:middle
In fact we recommend adding it

00:22:20.376 --> 00:22:21.586 A:middle
right in the application

00:22:21.586 --> 00:22:22.336 A:middle
didFinishLaunching

00:22:22.336 --> 00:22:23.316 A:middle
WithOptions method of your

00:22:23.316 --> 00:22:23.866 A:middle
AppDelegate.

00:22:25.616 --> 00:22:26.946 A:middle
Well why we recommend this.

00:22:27.746 --> 00:22:29.016 A:middle
Well the Transaction Observer is

00:22:29.016 --> 00:22:30.276 A:middle
StoreKit's way of communicating

00:22:30.276 --> 00:22:32.366 A:middle
changes in transactions the user

00:22:32.366 --> 00:22:34.186 A:middle
is making in their app and

00:22:34.186 --> 00:22:35.236 A:middle
pretty much all of these changes

00:22:35.236 --> 00:22:35.726 A:middle
are important.

00:22:35.726 --> 00:22:37.636 A:middle
And it's a good user experience

00:22:37.636 --> 00:22:38.796 A:middle
and generally good business to

00:22:38.796 --> 00:22:39.706 A:middle
make sure you handle any

00:22:39.706 --> 00:22:40.736 A:middle
transaction promptly.

00:22:42.596 --> 00:22:43.776 A:middle
There are a few cases when

00:22:43.776 --> 00:22:44.656 A:middle
transactions can become

00:22:44.656 --> 00:22:45.146 A:middle
interrupted.

00:22:46.426 --> 00:22:47.626 A:middle
For example, if the user leaves

00:22:47.626 --> 00:22:48.356 A:middle
your app in the middle of a

00:22:48.356 --> 00:22:49.846 A:middle
transaction, maybe they got

00:22:49.846 --> 00:22:51.076 A:middle
caught playing games in class.

00:22:52.446 --> 00:22:53.526 A:middle
Your app could be terminated by

00:22:53.526 --> 00:22:55.076 A:middle
the system later on or even by

00:22:55.076 --> 00:22:56.886 A:middle
the user and then when it's

00:22:56.886 --> 00:22:58.456 A:middle
opened back up again StoreKit

00:22:58.456 --> 00:22:59.346 A:middle
won't know to continue the

00:22:59.346 --> 00:23:00.676 A:middle
transaction until you add the


00:22:59.346 --> 00:23:00.676 A:middle
transaction until you add the

00:23:00.676 --> 00:23:01.576 A:middle
Transaction Observer.

00:23:01.746 --> 00:23:03.446 A:middle
If the user decides to buy

00:23:03.446 --> 00:23:04.676 A:middle
something else this could result

00:23:04.676 --> 00:23:05.846 A:middle
in confusion when they receive

00:23:05.846 --> 00:23:08.156 A:middle
two prompts or they could

00:23:08.156 --> 00:23:09.346 A:middle
receive a prompt out of nowhere

00:23:09.346 --> 00:23:10.416 A:middle
when you finally add the

00:23:10.416 --> 00:23:12.666 A:middle
Transaction Observer again.

00:23:13.446 --> 00:23:14.926 A:middle
Not great [inaudible].

00:23:15.106 --> 00:23:16.156 A:middle
Another common case where the

00:23:16.156 --> 00:23:17.176 A:middle
user needs to leave your app in

00:23:17.176 --> 00:23:18.216 A:middle
the middle of a transaction is

00:23:18.216 --> 00:23:18.886 A:middle
if they have to edit their

00:23:18.886 --> 00:23:20.456 A:middle
billing info, this happens all

00:23:20.456 --> 00:23:20.816 A:middle
the time.

00:23:21.156 --> 00:23:22.086 A:middle
You'd have to leave your app and

00:23:22.086 --> 00:23:22.816 A:middle
you want to make sure to

00:23:22.816 --> 00:23:23.596 A:middle
smoothly continue the

00:23:23.596 --> 00:23:24.806 A:middle
transaction when they do return.

00:23:26.916 --> 00:23:29.276 A:middle
Finally, it happens your app can

00:23:29.276 --> 00:23:31.016 A:middle
crash, in this case you want to

00:23:31.016 --> 00:23:32.466 A:middle
make sure to smoothly continue

00:23:32.466 --> 00:23:32.886 A:middle
as well.

00:23:33.426 --> 00:23:37.026 A:middle
Now there are some other reason

00:23:37.026 --> 00:23:38.316 A:middle
as well that you want to make

00:23:38.316 --> 00:23:39.286 A:middle
sure to add this as early as

00:23:39.286 --> 00:23:39.766 A:middle
possible.

00:23:39.766 --> 00:23:41.806 A:middle
There are several types of

00:23:41.806 --> 00:23:43.246 A:middle
transactions that can actually

00:23:43.246 --> 00:23:44.016 A:middle
come from outside your app.

00:23:45.236 --> 00:23:46.266 A:middle
For example subscription

00:23:46.266 --> 00:23:47.076 A:middle
renewals come through the

00:23:47.076 --> 00:23:47.956 A:middle
Transaction Observer.

00:23:49.096 --> 00:23:50.726 A:middle
When an auto renewable renews

00:23:50.726 --> 00:23:52.236 A:middle
successfully you'll receive a

00:23:52.236 --> 00:23:53.426 A:middle
transaction in the payment

00:23:53.426 --> 00:23:53.616 A:middle
queue.

00:23:53.756 --> 00:23:56.066 A:middle
You definitely want to make sure

00:23:56.066 --> 00:23:57.246 A:middle
to receive this as early as

00:23:57.246 --> 00:23:58.346 A:middle
possible so you don't interrupt

00:23:58.346 --> 00:23:59.636 A:middle
the user's service when they

00:23:59.636 --> 00:24:02.866 A:middle
actually have paid for it.


00:23:59.636 --> 00:24:02.866 A:middle
actually have paid for it.

00:24:03.136 --> 00:24:04.656 A:middle
Also promoted in-app purchases,

00:24:05.086 --> 00:24:06.366 A:middle
users click on these in the App

00:24:06.366 --> 00:24:07.896 A:middle
Store and then the transaction

00:24:07.896 --> 00:24:08.936 A:middle
is handed off to your app.

00:24:09.536 --> 00:24:10.526 A:middle
So you want to make sure to have

00:24:10.526 --> 00:24:13.496 A:middle
a smooth transition there.

00:24:13.616 --> 00:24:14.746 A:middle
Finally, if you set up promo

00:24:14.746 --> 00:24:15.826 A:middle
codes for your in-app purchases

00:24:15.856 --> 00:24:16.836 A:middle
these are redeemed from inside

00:24:16.836 --> 00:24:17.656 A:middle
the App Store and sent to your

00:24:17.656 --> 00:24:17.976 A:middle
app as well.

00:24:23.286 --> 00:24:24.526 A:middle
Another question we get all time

00:24:24.526 --> 00:24:25.906 A:middle
is when should I call Finish

00:24:25.906 --> 00:24:26.496 A:middle
Transaction.

00:24:27.946 --> 00:24:29.066 A:middle
Well the general rule is you

00:24:29.066 --> 00:24:30.426 A:middle
should call Finish Transaction

00:24:30.486 --> 00:24:31.856 A:middle
after a transaction has

00:24:31.856 --> 00:24:33.746 A:middle
completed successfully and you

00:24:33.746 --> 00:24:34.796 A:middle
have downloaded and delivered

00:24:34.796 --> 00:24:37.156 A:middle
all the content to the user or

00:24:37.156 --> 00:24:38.126 A:middle
after the transaction has

00:24:38.126 --> 00:24:39.356 A:middle
computed unsuccessfully.

00:24:40.776 --> 00:24:43.306 A:middle
To get more specific, let's go

00:24:43.306 --> 00:24:44.266 A:middle
through all the transaction

00:24:44.266 --> 00:24:46.296 A:middle
states and talk about how to

00:24:46.296 --> 00:24:47.196 A:middle
handle them.

00:24:47.896 --> 00:24:50.086 A:middle
The purchasing state you don't

00:24:50.086 --> 00:24:50.776 A:middle
need to do anything at the

00:24:50.776 --> 00:24:52.196 A:middle
moment, just continue to observe

00:24:52.236 --> 00:24:53.556 A:middle
the payment queue and wait for

00:24:53.556 --> 00:24:54.286 A:middle
the state to change.

00:24:54.836 --> 00:24:57.526 A:middle
In the purchased state the

00:24:57.526 --> 00:24:58.686 A:middle
transaction has completed

00:24:58.686 --> 00:24:59.096 A:middle
successfully.

00:24:59.096 --> 00:25:00.966 A:middle
You should download and deliver


00:24:59.096 --> 00:25:00.966 A:middle
You should download and deliver

00:25:00.966 --> 00:25:02.106 A:middle
all of the content to the user

00:25:02.376 --> 00:25:03.076 A:middle
and then call Finish

00:25:03.076 --> 00:25:03.626 A:middle
Transaction.

00:25:04.166 --> 00:25:07.416 A:middle
In the failed state the

00:25:07.416 --> 00:25:08.536 A:middle
transaction has completed

00:25:08.606 --> 00:25:09.326 A:middle
unsuccessfully.

00:25:09.326 --> 00:25:11.216 A:middle
You should inspect the error and

00:25:11.216 --> 00:25:12.706 A:middle
handle it appropriately, maybe

00:25:12.706 --> 00:25:13.746 A:middle
update your UI, record

00:25:13.746 --> 00:25:14.666 A:middle
analytics, whatever you need to

00:25:14.666 --> 00:25:16.366 A:middle
do, and then you should call

00:25:16.366 --> 00:25:17.156 A:middle
Finish Transaction.

00:25:17.356 --> 00:25:19.196 A:middle
And it's also important to note

00:25:19.196 --> 00:25:22.106 A:middle
here that transactions come back

00:25:22.106 --> 00:25:23.286 A:middle
in the failed state if the user

00:25:23.316 --> 00:25:23.896 A:middle
cancels them.

00:25:24.546 --> 00:25:25.886 A:middle
So it's very important that you

00:25:25.886 --> 00:25:26.926 A:middle
do inspect the error and make

00:25:26.926 --> 00:25:28.096 A:middle
sure it's not the canceled error

00:25:28.296 --> 00:25:29.176 A:middle
because you shouldn't show any

00:25:29.176 --> 00:25:30.046 A:middle
UI in that case.

00:25:30.046 --> 00:25:31.206 A:middle
You know the user just canceled

00:25:31.206 --> 00:25:32.216 A:middle
they don't need to know that it

00:25:32.246 --> 00:25:32.456 A:middle
failed.

00:25:35.556 --> 00:25:37.086 A:middle
The restored state, this is very

00:25:37.086 --> 00:25:38.336 A:middle
similar to the purchased state.

00:25:38.586 --> 00:25:40.286 A:middle
It indicates the transaction has

00:25:40.286 --> 00:25:41.796 A:middle
completed successfully, so again

00:25:41.796 --> 00:25:42.856 A:middle
you should download and deliver

00:25:42.856 --> 00:25:43.976 A:middle
all of the content to the user

00:25:44.156 --> 00:25:45.346 A:middle
and then you should call Finish

00:25:45.346 --> 00:25:45.876 A:middle
Transaction.

00:25:48.356 --> 00:25:49.786 A:middle
Finally, the deferred state,

00:25:50.616 --> 00:25:51.566 A:middle
this is similar to the

00:25:51.566 --> 00:25:53.676 A:middle
purchasing state except it means

00:25:53.676 --> 00:25:54.806 A:middle
that the transaction is waiting

00:25:54.806 --> 00:25:55.886 A:middle
on some outside action to

00:25:55.886 --> 00:25:56.346 A:middle
continue.

00:25:57.346 --> 00:25:58.726 A:middle
For example, if a user has Ask

00:25:58.816 --> 00:26:01.336 A:middle
to Buy turned on, so Ask to Buy


00:25:58.816 --> 00:26:01.336 A:middle
to Buy turned on, so Ask to Buy

00:26:01.336 --> 00:26:02.766 A:middle
is a feature that allows parents

00:26:02.826 --> 00:26:04.766 A:middle
to manually approve or decline

00:26:04.766 --> 00:26:05.856 A:middle
transactions made by their

00:26:05.856 --> 00:26:06.236 A:middle
children.

00:26:07.596 --> 00:26:09.216 A:middle
Any user can have Ask to Buy set

00:26:09.216 --> 00:26:11.206 A:middle
up, but it can happen to any of

00:26:11.206 --> 00:26:12.386 A:middle
your in-app purchases so it is

00:26:12.386 --> 00:26:13.306 A:middle
important that you handle this

00:26:13.306 --> 00:26:13.976 A:middle
case appropriately.

00:26:18.046 --> 00:26:20.436 A:middle
Speaking of Ask to Buy, if your

00:26:20.436 --> 00:26:21.716 A:middle
transaction is deferred due to

00:26:21.716 --> 00:26:24.136 A:middle
Ask to Buy the user will receive

00:26:24.136 --> 00:26:25.206 A:middle
a message from the App Store

00:26:25.206 --> 00:26:26.306 A:middle
saying that their parent has

00:26:26.306 --> 00:26:28.406 A:middle
been notified to approve it.

00:26:29.236 --> 00:26:31.706 A:middle
If it is approved and then it

00:26:31.706 --> 00:26:32.786 A:middle
will be returned to your

00:26:33.046 --> 00:26:34.606 A:middle
Transaction Observer in the

00:26:34.666 --> 00:26:35.296 A:middle
purchased state.

00:26:35.996 --> 00:26:36.836 A:middle
You should let the user know

00:26:36.836 --> 00:26:38.316 A:middle
it's been approved, of course

00:26:38.316 --> 00:26:39.786 A:middle
deliver the content, and call

00:26:39.786 --> 00:26:40.516 A:middle
Finish Transaction.

00:26:41.096 --> 00:26:44.396 A:middle
If it's declined it will be

00:26:44.396 --> 00:26:45.426 A:middle
returned to your Transaction

00:26:45.426 --> 00:26:46.456 A:middle
Observer in the failed state.

00:26:46.976 --> 00:26:48.026 A:middle
So here you should let the user

00:26:48.026 --> 00:26:49.636 A:middle
know that it was declined and

00:26:49.636 --> 00:26:50.816 A:middle
then call Finish Transaction to

00:26:50.816 --> 00:26:51.246 A:middle
finish it up.

00:26:52.206 --> 00:26:55.736 A:middle
However, if there's no action

00:26:55.736 --> 00:26:58.346 A:middle
taken within 24 hours then the

00:26:58.346 --> 00:27:02.416 A:middle
transaction fails silently, this


00:26:58.346 --> 00:27:02.416 A:middle
transaction fails silently, this

00:27:02.416 --> 00:27:03.486 A:middle
means that nothing will be

00:27:03.486 --> 00:27:04.566 A:middle
returned to your Transaction

00:27:04.566 --> 00:27:04.916 A:middle
Observer.

00:27:05.686 --> 00:27:07.946 A:middle
Furthermore, all Ask to Buy

00:27:07.946 --> 00:27:09.416 A:middle
transactions within that 24

00:27:09.416 --> 00:27:11.036 A:middle
hours are consolidated into a

00:27:11.036 --> 00:27:12.886 A:middle
single ask.

00:27:13.506 --> 00:27:14.486 A:middle
So the important takeaway here

00:27:14.486 --> 00:27:15.756 A:middle
is that you should not wait on

00:27:15.756 --> 00:27:17.486 A:middle
deferred transactions or even

00:27:17.486 --> 00:27:18.646 A:middle
expect them to come back at all,

00:27:18.826 --> 00:27:19.946 A:middle
you should make sure you don't

00:27:19.946 --> 00:27:21.176 A:middle
lock the UI and allow the user

00:27:21.176 --> 00:27:22.546 A:middle
to continue using your app as

00:27:22.546 --> 00:27:24.666 A:middle
much as possible.

00:27:24.666 --> 00:27:26.106 A:middle
Another important tip when

00:27:26.106 --> 00:27:27.756 A:middle
working with in-app purchases

00:27:27.756 --> 00:27:29.326 A:middle
that have Apple hosted content

00:27:29.326 --> 00:27:31.096 A:middle
via SKDownload is that you

00:27:31.096 --> 00:27:32.346 A:middle
should always finish downloading

00:27:32.346 --> 00:27:34.246 A:middle
the hosted content before

00:27:34.246 --> 00:27:35.356 A:middle
calling Finish Transaction.

00:27:36.616 --> 00:27:37.996 A:middle
This is because once you call

00:27:37.996 --> 00:27:39.556 A:middle
Finish Transaction all

00:27:39.696 --> 00:27:41.766 A:middle
SKDownloads will be canceled and

00:27:41.876 --> 00:27:42.896 A:middle
no longer valid for

00:27:42.896 --> 00:27:43.436 A:middle
redownloading.

00:27:44.256 --> 00:27:45.826 A:middle
If you do this on accident then

00:27:45.826 --> 00:27:47.066 A:middle
you have to call Restore

00:27:47.066 --> 00:27:48.146 A:middle
Transactions to get a new

00:27:48.146 --> 00:27:49.016 A:middle
download to finish.

00:27:49.346 --> 00:27:51.056 A:middle
So even if your download fails

00:27:51.786 --> 00:27:53.116 A:middle
you should withhold calling

00:27:53.116 --> 00:27:54.656 A:middle
Finish Transaction until you

00:27:54.656 --> 00:27:55.726 A:middle
retry it and you actually

00:27:56.006 --> 00:27:56.996 A:middle
successfully download it and

00:27:56.996 --> 00:27:58.016 A:middle
deliver that content to the

00:27:58.016 --> 00:27:58.316 A:middle
user.


00:28:00.756 --> 00:28:02.416 A:middle
Finally, if you're using Receipt

00:28:02.416 --> 00:28:05.006 A:middle
Verification you should always

00:28:05.006 --> 00:28:06.496 A:middle
make sure to do this before

00:28:06.496 --> 00:28:07.586 A:middle
calling Finish Transaction as

00:28:07.586 --> 00:28:07.816 A:middle
well.

00:28:08.806 --> 00:28:09.996 A:middle
This is especially important for

00:28:09.996 --> 00:28:11.306 A:middle
consumable in-app purchases

00:28:11.306 --> 00:28:12.756 A:middle
because consumable in-app

00:28:12.756 --> 00:28:14.286 A:middle
purchases only appear in receipt

00:28:14.556 --> 00:28:15.936 A:middle
as long as they're unfinished.

00:28:16.736 --> 00:28:17.516 A:middle
Once you do call Finish

00:28:17.516 --> 00:28:18.856 A:middle
Transaction they will no longer

00:28:18.946 --> 00:28:19.986 A:middle
appear in their seats and you

00:28:19.986 --> 00:28:21.016 A:middle
won't be able to validate them.

00:28:21.316 --> 00:28:22.686 A:middle
So if you're using Receipt

00:28:22.686 --> 00:28:24.416 A:middle
Verification make sure that it's

00:28:24.416 --> 00:28:26.046 A:middle
a real Apple signed transaction

00:28:26.046 --> 00:28:27.976 A:middle
the user paid for, always do

00:28:27.976 --> 00:28:29.016 A:middle
this before calling Finish

00:28:29.016 --> 00:28:29.556 A:middle
Transaction.

00:28:29.686 --> 00:28:32.916 A:middle
I'd like to hand it back to Dana

00:28:32.916 --> 00:28:34.036 A:middle
to discuss some tips for

00:28:34.036 --> 00:28:34.696 A:middle
managing the receipt.

00:28:36.516 --> 00:28:39.546 A:middle
[ Applause ]

00:28:40.046 --> 00:28:41.306 A:middle
&gt;&gt; Thanks again Ross.

00:28:43.496 --> 00:28:44.836 A:middle
So what is the receipt?

00:28:46.006 --> 00:28:46.846 A:middle
It's a lot like its name

00:28:46.846 --> 00:28:49.016 A:middle
implies, it is a record of your

00:28:49.016 --> 00:28:50.336 A:middle
app in in-app purchases.

00:28:50.336 --> 00:28:51.476 A:middle
It's a lot like the piece of

00:28:51.476 --> 00:28:53.216 A:middle
paper you get when you buy some

00:28:53.216 --> 00:28:54.006 A:middle
retail good.

00:28:54.556 --> 00:28:57.716 A:middle
It's stored on the device, it's

00:28:57.716 --> 00:28:59.096 A:middle
a file, it's a file that we

00:28:59.096 --> 00:29:00.676 A:middle
actually get from the App Store.


00:28:59.096 --> 00:29:00.676 A:middle
actually get from the App Store.

00:29:00.676 --> 00:29:01.696 A:middle
It comes from the server,

00:29:01.696 --> 00:29:03.256 A:middle
StoreKit doesn't make it and we

00:29:03.256 --> 00:29:04.946 A:middle
store it on the device and your

00:29:05.066 --> 00:29:07.506 A:middle
app can actually read it.

00:29:07.776 --> 00:29:09.626 A:middle
It's signed by the App Store so

00:29:09.626 --> 00:29:10.796 A:middle
that's how you know it's

00:29:10.796 --> 00:29:11.506 A:middle
authentic.

00:29:12.966 --> 00:29:15.116 A:middle
And finally, it's for your app

00:29:15.116 --> 00:29:16.636 A:middle
and for that device.

00:29:17.316 --> 00:29:19.526 A:middle
The receipt is an important way

00:29:19.526 --> 00:29:22.066 A:middle
for making sure that that app is

00:29:22.066 --> 00:29:23.776 A:middle
valid for the device it's trying

00:29:23.776 --> 00:29:24.336 A:middle
to run on.

00:29:24.856 --> 00:29:28.046 A:middle
How do you validate the receipt?

00:29:28.086 --> 00:29:29.356 A:middle
Well there's two things you can

00:29:29.356 --> 00:29:29.616 A:middle
do.

00:29:29.686 --> 00:29:31.356 A:middle
First, you can look at on-device

00:29:31.356 --> 00:29:32.876 A:middle
receipt validation, this is

00:29:32.876 --> 00:29:34.336 A:middle
where you can just use

00:29:35.086 --> 00:29:36.296 A:middle
cryptography right on your

00:29:36.296 --> 00:29:38.176 A:middle
device to validate that receipt

00:29:38.416 --> 00:29:39.876 A:middle
and unlock content right then

00:29:39.876 --> 00:29:40.226 A:middle
and there.

00:29:40.666 --> 00:29:42.406 A:middle
Alternatively, you can do

00:29:42.406 --> 00:29:44.176 A:middle
server-to-server validation.

00:29:44.346 --> 00:29:45.486 A:middle
This is where you take the

00:29:45.486 --> 00:29:47.116 A:middle
receipt, send it up to your

00:29:47.116 --> 00:29:49.106 A:middle
trusted server, and it'll manage

00:29:49.106 --> 00:29:49.756 A:middle
it for you.

00:29:50.316 --> 00:29:52.956 A:middle
In this case it'll call

00:29:53.086 --> 00:29:56.136 A:middle
itunes.apple.com/verifyreceipt,

00:29:56.276 --> 00:29:57.946 A:middle
send that receipt over and the

00:29:57.946 --> 00:29:59.976 A:middle
App Store will validate it for

00:29:59.976 --> 00:30:00.976 A:middle
your trusted server.


00:29:59.976 --> 00:30:00.976 A:middle
your trusted server.

00:30:01.596 --> 00:30:02.796 A:middle
This is great if you have a

00:30:02.796 --> 00:30:04.106 A:middle
subscription service on the

00:30:04.106 --> 00:30:04.726 A:middle
backend.

00:30:05.366 --> 00:30:07.576 A:middle
However, I'm going to focus more

00:30:07.576 --> 00:30:09.226 A:middle
for the purposes of my talk for

00:30:09.226 --> 00:30:10.626 A:middle
on-device validation.

00:30:11.086 --> 00:30:12.256 A:middle
If you have a subscription

00:30:12.256 --> 00:30:14.686 A:middle
service I highly suggest you

00:30:14.686 --> 00:30:15.686 A:middle
check out engineering

00:30:15.686 --> 00:30:18.026 A:middle
subscriptions here in Hall 1

00:30:18.026 --> 00:30:19.386 A:middle
today at 3 o'clock right after

00:30:19.386 --> 00:30:19.966 A:middle
this talk.

00:30:20.446 --> 00:30:23.816 A:middle
But I do want to make one point

00:30:24.006 --> 00:30:25.166 A:middle
about server-to-server

00:30:25.166 --> 00:30:25.876 A:middle
validation.

00:30:27.276 --> 00:30:28.296 A:middle
As I said, it's completely

00:30:28.296 --> 00:30:29.356 A:middle
correct, it's completely

00:30:29.356 --> 00:30:30.836 A:middle
appropriate to take that receipt

00:30:30.886 --> 00:30:32.176 A:middle
from the device and send it up

00:30:32.176 --> 00:30:32.996 A:middle
to your server.

00:30:34.226 --> 00:30:36.026 A:middle
But you should never send the

00:30:36.026 --> 00:30:37.586 A:middle
receipt from your device

00:30:37.746 --> 00:30:39.926 A:middle
directly to Verify Receipt.

00:30:40.746 --> 00:30:42.166 A:middle
You don't control either end of

00:30:42.166 --> 00:30:43.066 A:middle
that connection, you don't

00:30:43.066 --> 00:30:44.596 A:middle
control the user's device and

00:30:44.596 --> 00:30:45.966 A:middle
what connections it makes and

00:30:45.966 --> 00:30:47.166 A:middle
you don't control the other end

00:30:47.216 --> 00:30:48.026 A:middle
with the App Store.

00:30:48.246 --> 00:30:49.986 A:middle
There's no way to make a trusted

00:30:49.986 --> 00:30:51.266 A:middle
connection from your app right

00:30:51.266 --> 00:30:51.716 A:middle
then and there.

00:30:51.986 --> 00:30:53.266 A:middle
You should send it, always send

00:30:53.266 --> 00:30:54.856 A:middle
it up to an intermediate server.

00:30:55.376 --> 00:30:59.046 A:middle
So what is the structure of the

00:30:59.046 --> 00:30:59.556 A:middle
receipt?


00:31:00.856 --> 00:31:01.836 A:middle
Well it has some purchase

00:31:01.836 --> 00:31:03.296 A:middle
information, the certificates

00:31:03.296 --> 00:31:04.206 A:middle
and signatures.

00:31:04.666 --> 00:31:06.496 A:middle
We give you an API to pull it

00:31:06.496 --> 00:31:07.636 A:middle
off the file system.

00:31:08.216 --> 00:31:09.976 A:middle
And as I said it's a single

00:31:10.686 --> 00:31:10.786 A:middle
file.

00:31:11.836 --> 00:31:14.546 A:middle
We use opensource standards,

00:31:15.116 --> 00:31:18.566 A:middle
PKCS Cryptographic Container and

00:31:18.566 --> 00:31:20.706 A:middle
ASN.1 to store the metadata

00:31:20.706 --> 00:31:21.496 A:middle
within the receipt.

00:31:21.496 --> 00:31:23.216 A:middle
These are all well documented

00:31:23.216 --> 00:31:24.906 A:middle
and well published open file

00:31:25.286 --> 00:31:26.266 A:middle
formats.

00:31:26.776 --> 00:31:29.236 A:middle
And there are tons of options

00:31:29.236 --> 00:31:30.856 A:middle
out there for verifying and

00:31:30.856 --> 00:31:33.366 A:middle
reading the receipt, OpenSSL,

00:31:34.366 --> 00:31:36.466 A:middle
asn1c, there's tons more, you

00:31:36.466 --> 00:31:37.766 A:middle
can even build your own.

00:31:38.586 --> 00:31:39.826 A:middle
How do you read that receipt no

00:31:39.826 --> 00:31:40.876 A:middle
matter what API you're going to

00:31:40.876 --> 00:31:41.286 A:middle
use?

00:31:41.286 --> 00:31:42.196 A:middle
Well you call

00:31:42.196 --> 00:31:44.666 A:middle
bundle.appStoreReceiptURL, this

00:31:44.666 --> 00:31:46.616 A:middle
returns a URL to your app, but

00:31:46.616 --> 00:31:48.126 A:middle
again it's just a path to the

00:31:48.126 --> 00:31:49.466 A:middle
file in the file system.

00:31:50.256 --> 00:31:50.966 A:middle
There you're going to want to

00:31:50.966 --> 00:31:52.736 A:middle
read in that content, get that

00:31:52.736 --> 00:31:54.766 A:middle
blob of data into memory, and if

00:31:54.766 --> 00:31:55.906 A:middle
you're doing server-to-server

00:31:55.906 --> 00:31:57.486 A:middle
validation send it up to your

00:31:57.486 --> 00:31:58.886 A:middle
server, otherwise you can

00:31:58.886 --> 00:32:00.066 A:middle
process it right there on the


00:31:58.886 --> 00:32:00.066 A:middle
process it right there on the

00:32:00.066 --> 00:32:00.656 A:middle
device.

00:32:01.386 --> 00:32:03.476 A:middle
When you are processing it if

00:32:03.476 --> 00:32:05.596 A:middle
you're using OpenSSL here are

00:32:05.596 --> 00:32:07.016 A:middle
some tips you want to follow.

00:32:07.156 --> 00:32:09.706 A:middle
First, build a static library

00:32:10.476 --> 00:32:12.176 A:middle
not a dynamic one, it much more

00:32:12.176 --> 00:32:13.566 A:middle
secure if you use a static

00:32:13.566 --> 00:32:14.126 A:middle
library.

00:32:15.336 --> 00:32:16.426 A:middle
Finally, if you're going to

00:32:16.516 --> 00:32:18.516 A:middle
include the Apple Root CA

00:32:18.516 --> 00:32:19.656 A:middle
Certificate, which is what you

00:32:19.656 --> 00:32:21.356 A:middle
need to validate the receipt you

00:32:21.356 --> 00:32:22.936 A:middle
can grab that online, there's

00:32:22.936 --> 00:32:24.406 A:middle
tons of documentation out there,

00:32:24.576 --> 00:32:26.276 A:middle
but watch out for the expiration

00:32:26.276 --> 00:32:26.966 A:middle
of that receipt.

00:32:30.196 --> 00:32:31.596 A:middle
So as I mentioned before there's

00:32:31.636 --> 00:32:33.236 A:middle
tons of solutions out there for

00:32:33.236 --> 00:32:35.666 A:middle
this, but keep in mind

00:32:35.726 --> 00:32:37.326 A:middle
convenience comes at a price.

00:32:37.326 --> 00:32:39.456 A:middle
This is your business, you need

00:32:39.456 --> 00:32:41.416 A:middle
to understand and know the risks

00:32:41.546 --> 00:32:42.976 A:middle
that come to any solution you

00:32:42.976 --> 00:32:43.486 A:middle
implement.

00:32:44.356 --> 00:32:46.166 A:middle
If you're using some popular

00:32:46.346 --> 00:32:47.776 A:middle
third-party solution out there

00:32:47.776 --> 00:32:49.096 A:middle
and there's an exploit within

00:32:49.096 --> 00:32:51.286 A:middle
there your app is going to be

00:32:51.286 --> 00:32:52.566 A:middle
vulnerable to that as well.

00:32:53.736 --> 00:32:55.506 A:middle
It's your revenue stream, make

00:32:55.506 --> 00:32:57.276 A:middle
sure you understand what

00:32:57.276 --> 00:32:57.976 A:middle
products you're choosing.


00:33:02.156 --> 00:33:04.226 A:middle
So I mentioned that there's a

00:33:04.226 --> 00:33:05.086 A:middle
signature and there's

00:33:05.086 --> 00:33:06.376 A:middle
certificates within the receipt.

00:33:07.126 --> 00:33:10.416 A:middle
One best practice is don't check

00:33:10.766 --> 00:33:12.026 A:middle
the expiration date of those

00:33:12.026 --> 00:33:13.296 A:middle
certificates within the receipt

00:33:13.296 --> 00:33:14.996 A:middle
against the current clock.

00:33:15.766 --> 00:33:17.346 A:middle
First of all, the user can

00:33:17.346 --> 00:33:18.986 A:middle
actually change the clock on the

00:33:18.986 --> 00:33:24.336 A:middle
device, but more importantly the

00:33:24.436 --> 00:33:26.776 A:middle
receipt isn't necessarily

00:33:26.776 --> 00:33:27.986 A:middle
invalid just because the

00:33:27.986 --> 00:33:29.236 A:middle
certificates within it are

00:33:29.236 --> 00:33:29.926 A:middle
expired.

00:33:30.746 --> 00:33:31.976 A:middle
What you should be comparing it

00:33:31.976 --> 00:33:33.246 A:middle
to is the dates of the

00:33:33.246 --> 00:33:35.136 A:middle
transactions within the receipt.

00:33:35.136 --> 00:33:37.026 A:middle
As long as all the transactions

00:33:37.226 --> 00:33:38.926 A:middle
occurred before the certificate

00:33:38.926 --> 00:33:41.086 A:middle
is expired it's a valid receipt.

00:33:43.856 --> 00:33:45.906 A:middle
So let's dive in and get a sense

00:33:45.906 --> 00:33:47.486 A:middle
of what is inside the receipt.

00:33:48.546 --> 00:33:49.726 A:middle
That purchase information

00:33:49.966 --> 00:33:51.486 A:middle
contains just a bunch of types

00:33:51.486 --> 00:33:52.436 A:middle
and attributes.

00:33:53.156 --> 00:33:54.226 A:middle
Here you can see there's a

00:33:54.226 --> 00:33:56.896 A:middle
bundle identifier and a bunch of

00:33:56.896 --> 00:33:58.266 A:middle
other values that go along with

00:33:58.916 --> 00:33:58.986 A:middle
it.


00:34:01.116 --> 00:34:02.546 A:middle
If you're going to check that

00:34:02.546 --> 00:34:03.776 A:middle
the receipt is for your

00:34:03.776 --> 00:34:05.656 A:middle
application first you want to

00:34:05.656 --> 00:34:07.866 A:middle
check that bundle identifier and

00:34:07.866 --> 00:34:10.016 A:middle
you want to check type 3, which

00:34:10.016 --> 00:34:11.406 A:middle
gives you the version that goes

00:34:11.406 --> 00:34:13.866 A:middle
with the app.

00:34:14.126 --> 00:34:15.626 A:middle
But a best practice here is

00:34:15.996 --> 00:34:17.656 A:middle
always use hardcoded values,

00:34:17.656 --> 00:34:19.266 A:middle
don't just read from your app's

00:34:19.266 --> 00:34:20.416 A:middle
Info.plist.

00:34:20.726 --> 00:34:22.085 A:middle
It's too easy to change the

00:34:22.085 --> 00:34:24.436 A:middle
Info.plist to match an invalid

00:34:24.436 --> 00:34:26.085 A:middle
receipt to spoof your app into

00:34:26.085 --> 00:34:26.436 A:middle
running.

00:34:27.786 --> 00:34:29.536 A:middle
Now that you've matched that

00:34:29.536 --> 00:34:31.516 A:middle
bundle identifier and version to

00:34:31.516 --> 00:34:33.386 A:middle
the receipt you're going to want

00:34:33.386 --> 00:34:35.005 A:middle
to make sure that it's valid for

00:34:35.005 --> 00:34:36.806 A:middle
your device and the way to do

00:34:36.806 --> 00:34:38.456 A:middle
this is to use attribute 5.

00:34:39.255 --> 00:34:41.846 A:middle
Attribute 5 is shawl SHA-1 hash

00:34:42.116 --> 00:34:44.936 A:middle
of a couple values, including

00:34:44.936 --> 00:34:46.536 A:middle
the bundle identifier, the

00:34:46.536 --> 00:34:48.016 A:middle
device identifier, the thing

00:34:48.016 --> 00:34:49.636 A:middle
that represents the hardware

00:34:49.746 --> 00:34:50.525 A:middle
that is running your

00:34:50.525 --> 00:34:52.456 A:middle
application, and an opaque

00:34:52.456 --> 00:34:52.976 A:middle
value.

00:34:53.536 --> 00:34:54.686 A:middle
This is a bit of cryptic or

00:34:54.926 --> 00:34:55.966 A:middle
[inaudible] entropy, it changes

00:34:55.966 --> 00:34:57.496 A:middle
over time and we store that in

00:34:57.496 --> 00:34:58.776 A:middle
the receipt as type 4.

00:34:59.476 --> 00:35:00.846 A:middle
You're going to take those 3


00:34:59.476 --> 00:35:00.846 A:middle
You're going to take those 3

00:35:00.846 --> 00:35:03.826 A:middle
values, generate your SHA-1 hash

00:35:04.696 --> 00:35:07.126 A:middle
and compare and if it matches

00:35:07.846 --> 00:35:09.256 A:middle
what you generate with what's in

00:35:09.256 --> 00:35:10.776 A:middle
the receipt you know that that

00:35:10.776 --> 00:35:12.786 A:middle
receipt was generated for your

00:35:12.786 --> 00:35:14.246 A:middle
app on that device.

00:35:17.056 --> 00:35:18.406 A:middle
Well what happens if you get an

00:35:18.596 --> 00:35:21.526 A:middle
invalid receipt or it just

00:35:21.526 --> 00:35:22.776 A:middle
doesn't exist for whatever

00:35:22.776 --> 00:35:23.276 A:middle
reason?

00:35:24.556 --> 00:35:26.676 A:middle
StoreKit gives you APIs to

00:35:26.876 --> 00:35:28.836 A:middle
request a new receipt from the

00:35:28.836 --> 00:35:29.466 A:middle
App Store.

00:35:30.176 --> 00:35:31.656 A:middle
Again, the receipt comes from

00:35:31.656 --> 00:35:33.616 A:middle
our commerce backend so you're

00:35:33.616 --> 00:35:35.806 A:middle
going to need a network in order

00:35:35.806 --> 00:35:36.686 A:middle
to be able to complete this

00:35:36.686 --> 00:35:37.426 A:middle
operation.

00:35:38.596 --> 00:35:41.586 A:middle
In order to make sure that we

00:35:41.586 --> 00:35:43.196 A:middle
are using an authentic receipt

00:35:43.196 --> 00:35:44.886 A:middle
from an authentic user a sign-in

00:35:44.886 --> 00:35:45.806 A:middle
may be required.

00:35:46.306 --> 00:35:49.806 A:middle
When you get an updated receipt

00:35:49.806 --> 00:35:51.526 A:middle
you need to be careful to avoid

00:35:51.526 --> 00:35:53.386 A:middle
any sort of continuous loop of

00:35:53.386 --> 00:35:54.586 A:middle
validate and refresh.

00:35:54.586 --> 00:35:55.916 A:middle
If you get an updated receipt

00:35:56.136 --> 00:35:57.836 A:middle
check it once and if it's still

00:35:57.836 --> 00:35:59.486 A:middle
invalid error out then.


00:36:00.506 --> 00:36:01.526 A:middle
So what does this look like in

00:36:01.526 --> 00:36:01.886 A:middle
code?

00:36:02.846 --> 00:36:03.606 A:middle
You simply call

00:36:03.606 --> 00:36:06.416 A:middle
SKReceiptRefreshRequest, you set

00:36:06.416 --> 00:36:08.526 A:middle
your purchase queue delegate

00:36:08.726 --> 00:36:09.266 A:middle
right there on the

00:36:09.266 --> 00:36:10.886 A:middle
ReceiptRefresh, you call start

00:36:11.186 --> 00:36:12.706 A:middle
and as that receipt gets updated

00:36:12.966 --> 00:36:14.176 A:middle
we'll call back and let you know

00:36:14.176 --> 00:36:14.846 A:middle
when it's down.

00:36:15.376 --> 00:36:19.546 A:middle
On macOS you can also call exit

00:36:19.546 --> 00:36:23.176 A:middle
173, that 173 code will tell the

00:36:23.176 --> 00:36:24.486 A:middle
operating system and tell

00:36:24.486 --> 00:36:27.746 A:middle
StoreKit to refresh a receipt on

00:36:27.746 --> 00:36:28.156 A:middle
your behalf.

00:36:29.246 --> 00:36:30.066 A:middle
There the app will get

00:36:30.066 --> 00:36:31.596 A:middle
relaunched once a new receipt

00:36:31.596 --> 00:36:32.166 A:middle
comes down.

00:36:32.696 --> 00:36:36.156 A:middle
As I mentioned earlier, we're

00:36:36.156 --> 00:36:38.156 A:middle
now allowing non-subscription

00:36:38.156 --> 00:36:39.736 A:middle
apps to do free trials and the

00:36:39.736 --> 00:36:41.406 A:middle
receipt is a great way to

00:36:41.406 --> 00:36:43.446 A:middle
understand is the user in the

00:36:43.446 --> 00:36:45.146 A:middle
middle of a free trial or have

00:36:45.146 --> 00:36:47.946 A:middle
they bought the full unlock

00:36:48.476 --> 00:36:49.656 A:middle
non-consumable IAP.

00:36:49.656 --> 00:36:53.016 A:middle
To do this you're going to want

00:36:53.016 --> 00:36:55.776 A:middle
to look for type 17 within the

00:36:55.776 --> 00:36:56.236 A:middle
receipt.

00:36:56.556 --> 00:36:58.156 A:middle
This includes all of your

00:36:58.286 --> 00:37:00.036 A:middle
subscription consumable and


00:36:58.286 --> 00:37:00.036 A:middle
subscription consumable and

00:37:00.036 --> 00:37:01.846 A:middle
non-consumable IAPs.

00:37:03.246 --> 00:37:05.496 A:middle
Within type 17 there's a couple

00:37:05.936 --> 00:37:07.866 A:middle
subdictionaries of data.

00:37:08.466 --> 00:37:12.816 A:middle
Type 1702 is going to be the

00:37:12.816 --> 00:37:14.066 A:middle
product identifier that's

00:37:14.066 --> 00:37:15.376 A:middle
associated with your

00:37:15.746 --> 00:37:17.246 A:middle
non-consumable IAP.

00:37:17.246 --> 00:37:19.316 A:middle
This is where you're going to

00:37:19.316 --> 00:37:21.186 A:middle
want to check to see is it my

00:37:21.956 --> 00:37:23.316 A:middle
non-consumable that represents

00:37:23.316 --> 00:37:24.746 A:middle
the beginning of the free trial

00:37:24.746 --> 00:37:25.796 A:middle
or the non-consumable that

00:37:25.796 --> 00:37:27.366 A:middle
represents the full unlock of

00:37:27.366 --> 00:37:27.866 A:middle
the app.

00:37:29.246 --> 00:37:30.176 A:middle
You're also going to want use

00:37:30.176 --> 00:37:32.076 A:middle
type 1704, this is where you can

00:37:32.076 --> 00:37:33.496 A:middle
check the purchase date of when

00:37:33.496 --> 00:37:34.866 A:middle
that consumable was actually

00:37:34.866 --> 00:37:34.966 A:middle
made.

00:37:38.076 --> 00:37:39.326 A:middle
So what's the algorithm you're

00:37:39.326 --> 00:37:40.176 A:middle
going to want to follow?

00:37:40.646 --> 00:37:41.366 A:middle
Well first, you're going to

00:37:41.436 --> 00:37:43.136 A:middle
iterate over all those in-app

00:37:43.136 --> 00:37:44.766 A:middle
purchases, all of those type

00:37:44.766 --> 00:37:45.576 A:middle
17's.

00:37:46.966 --> 00:37:48.526 A:middle
If you find any within the

00:37:48.526 --> 00:37:50.256 A:middle
receipt that matches the product

00:37:50.256 --> 00:37:51.576 A:middle
identifier that you've

00:37:51.576 --> 00:37:53.216 A:middle
represented the Full Unlock of

00:37:53.216 --> 00:37:54.526 A:middle
the app you're done.

00:37:54.806 --> 00:37:55.956 A:middle
You know that the user has

00:37:56.016 --> 00:37:57.506 A:middle
purchased the Full Unlock of

00:37:57.506 --> 00:37:59.196 A:middle
your app, give them the access

00:37:59.196 --> 00:38:01.006 A:middle
to it.


00:37:59.196 --> 00:38:01.006 A:middle
to it.

00:38:01.246 --> 00:38:03.336 A:middle
Alternatively, if you find a

00:38:03.776 --> 00:38:05.436 A:middle
Free Trial Product Identifier,

00:38:05.436 --> 00:38:06.526 A:middle
the product identifier that

00:38:06.526 --> 00:38:08.046 A:middle
represents the user beginning

00:38:08.046 --> 00:38:09.486 A:middle
their free trial you're going to

00:38:09.486 --> 00:38:10.496 A:middle
want to look at the purchase

00:38:10.526 --> 00:38:11.976 A:middle
date associated with that free

00:38:11.976 --> 00:38:12.426 A:middle
trial.

00:38:13.646 --> 00:38:14.556 A:middle
Here's where things get a little

00:38:14.556 --> 00:38:15.016 A:middle
tricky.

00:38:15.986 --> 00:38:17.476 A:middle
You can't always trust the clock

00:38:17.476 --> 00:38:18.826 A:middle
on the device, again the user

00:38:18.826 --> 00:38:19.556 A:middle
can change that.

00:38:19.556 --> 00:38:20.616 A:middle
So you might want to use your

00:38:20.616 --> 00:38:22.416 A:middle
own backend server or some sort

00:38:22.416 --> 00:38:24.406 A:middle
of time server to make sure that

00:38:24.406 --> 00:38:25.586 A:middle
it's still within your free

00:38:25.586 --> 00:38:26.526 A:middle
trial period.

00:38:27.636 --> 00:38:29.876 A:middle
There's also device check APIs

00:38:30.086 --> 00:38:30.946 A:middle
which I highly recommend you

00:38:30.946 --> 00:38:31.946 A:middle
check out that help you

00:38:32.106 --> 00:38:33.776 A:middle
determine whether or not the

00:38:33.776 --> 00:38:35.436 A:middle
user has previously completed

00:38:35.436 --> 00:38:37.016 A:middle
their free trial window on that

00:38:37.056 --> 00:38:37.716 A:middle
device.

00:38:39.416 --> 00:38:41.206 A:middle
Lastly, if neither are present

00:38:41.416 --> 00:38:43.456 A:middle
this is your signal to display

00:38:43.666 --> 00:38:46.956 A:middle
that free trial upsell to begin

00:38:46.956 --> 00:38:48.116 A:middle
the free trial, but again you

00:38:48.116 --> 00:38:49.276 A:middle
need to be careful to make sure

00:38:49.276 --> 00:38:51.066 A:middle
you represent the length of that

00:38:51.066 --> 00:38:52.936 A:middle
free trial, the content that

00:38:52.936 --> 00:38:54.116 A:middle
they're going to lose if they

00:38:54.286 --> 00:38:56.766 A:middle
don't buy that Full Unlock, and

00:38:56.766 --> 00:38:58.206 A:middle
the ultimate price of the Full

00:38:58.206 --> 00:38:58.656 A:middle
Unlock.


00:39:01.356 --> 00:39:03.026 A:middle
If you already have an app in

00:39:03.026 --> 00:39:05.086 A:middle
the App Store and you're selling

00:39:05.086 --> 00:39:06.676 A:middle
it or you have a subscription

00:39:06.676 --> 00:39:08.006 A:middle
model and you want to move to a

00:39:08.006 --> 00:39:10.406 A:middle
new free trial there's some

00:39:10.406 --> 00:39:11.326 A:middle
things you can also use the

00:39:11.326 --> 00:39:12.916 A:middle
receipt for to make that easier

00:39:12.916 --> 00:39:13.356 A:middle
for you.

00:39:14.636 --> 00:39:15.976 A:middle
So if you're paid up front and

00:39:15.976 --> 00:39:16.656 A:middle
you want to move to a

00:39:16.656 --> 00:39:18.516 A:middle
subscription or if you're paid

00:39:18.516 --> 00:39:19.946 A:middle
up, paid up front and you want

00:39:19.946 --> 00:39:22.226 A:middle
to move to a free trial use type

00:39:22.276 --> 00:39:22.996 A:middle
19.

00:39:23.736 --> 00:39:25.756 A:middle
This will tell you the original

00:39:25.756 --> 00:39:27.356 A:middle
version that the user purchased

00:39:27.356 --> 00:39:28.466 A:middle
that app with from the App

00:39:28.466 --> 00:39:28.836 A:middle
Store.

00:39:29.926 --> 00:39:31.186 A:middle
Even if they delete the app and

00:39:31.186 --> 00:39:32.426 A:middle
redownload it over and over

00:39:32.426 --> 00:39:34.856 A:middle
again that type 19 will tell you

00:39:34.856 --> 00:39:36.596 A:middle
exactly what version they bought

00:39:36.596 --> 00:39:37.226 A:middle
their app with.

00:39:37.776 --> 00:39:41.516 A:middle
If the user did originally pay

00:39:41.516 --> 00:39:44.026 A:middle
up front make sure to give them

00:39:44.026 --> 00:39:45.276 A:middle
the functionality that they

00:39:45.276 --> 00:39:45.736 A:middle
bought.

00:39:46.246 --> 00:39:47.296 A:middle
Just because you move to a

00:39:47.296 --> 00:39:48.826 A:middle
subscription model if they

00:39:48.826 --> 00:39:50.766 A:middle
bought it when it was a paid for

00:39:50.766 --> 00:39:53.396 A:middle
app in the App Store you need to

00:39:53.396 --> 00:39:54.666 A:middle
give them that access to that

00:39:54.666 --> 00:39:55.886 A:middle
content they originally paid

00:39:55.886 --> 00:39:55.976 A:middle
for.

00:39:57.796 --> 00:40:00.056 A:middle
So again use type 19 within the


00:39:57.796 --> 00:40:00.056 A:middle
So again use type 19 within the

00:40:00.056 --> 00:40:02.676 A:middle
receipt to know what version

00:40:02.676 --> 00:40:03.646 A:middle
they bought that app with.

00:40:04.156 --> 00:40:06.986 A:middle
So we went over a lot of things

00:40:06.986 --> 00:40:07.856 A:middle
today, we talked about

00:40:07.856 --> 00:40:09.366 A:middle
Introductory Pricing, this is a

00:40:09.366 --> 00:40:11.666 A:middle
great means of enticing new

00:40:11.666 --> 00:40:12.596 A:middle
customers into your

00:40:12.596 --> 00:40:14.306 A:middle
subscription, you can show

00:40:14.306 --> 00:40:15.986 A:middle
content right on the App Store

00:40:17.096 --> 00:40:18.346 A:middle
if you're merchandising your

00:40:18.606 --> 00:40:19.886 A:middle
subscription IAPs.

00:40:20.636 --> 00:40:22.646 A:middle
I also talked about how you can

00:40:22.646 --> 00:40:24.636 A:middle
now offer non-subscription free

00:40:24.636 --> 00:40:26.566 A:middle
trials within your apps.

00:40:27.326 --> 00:40:28.416 A:middle
We talked about

00:40:28.416 --> 00:40:30.466 A:middle
SKStoreReviewController and how

00:40:31.256 --> 00:40:32.526 A:middle
developers have seen such a

00:40:32.526 --> 00:40:33.786 A:middle
great response to that and how

00:40:33.786 --> 00:40:34.966 A:middle
we brought it to the Mac App

00:40:34.966 --> 00:40:35.746 A:middle
Store this year.

00:40:37.136 --> 00:40:38.256 A:middle
Talked about the Sandbox

00:40:38.256 --> 00:40:39.746 A:middle
environment and how now we

00:40:39.746 --> 00:40:41.496 A:middle
manage your Sandbox account

00:40:41.496 --> 00:40:42.876 A:middle
separately from your regular

00:40:42.876 --> 00:40:44.126 A:middle
iTunes and App Store production

00:40:44.126 --> 00:40:44.736 A:middle
accounts.

00:40:45.696 --> 00:40:47.106 A:middle
Ross gave a great overview of

00:40:47.106 --> 00:40:48.436 A:middle
things you need to keep in mind

00:40:48.436 --> 00:40:49.346 A:middle
when processing your

00:40:49.346 --> 00:40:51.266 A:middle
transactions, including making

00:40:51.266 --> 00:40:53.076 A:middle
sure to observe early and

00:40:53.226 --> 00:40:54.526 A:middle
knowing when the right time to

00:40:54.526 --> 00:40:56.066 A:middle
call Finish Transaction is.

00:40:56.636 --> 00:40:58.266 A:middle
And finally, I gave you some

00:40:58.266 --> 00:41:00.086 A:middle
good points on how to manage


00:40:58.266 --> 00:41:00.086 A:middle
good points on how to manage

00:41:00.086 --> 00:41:01.196 A:middle
that in-app receipt for

00:41:01.196 --> 00:41:02.956 A:middle
on-device validation and making

00:41:02.956 --> 00:41:04.726 A:middle
sure your free trials go

00:41:04.726 --> 00:41:06.136 A:middle
smoothly using the receipt.

00:41:07.896 --> 00:41:09.676 A:middle
For more information I highly

00:41:09.676 --> 00:41:10.916 A:middle
suggest you stick around for

00:41:10.966 --> 00:41:12.566 A:middle
Engineering Subscriptions if you

00:41:12.566 --> 00:41:13.916 A:middle
have a subscription business

00:41:13.916 --> 00:41:14.396 A:middle
model.

00:41:14.506 --> 00:41:15.306 A:middle
We're also going to be at the

00:41:15.306 --> 00:41:17.886 A:middle
labs today at 4 o'clock and then

00:41:18.046 --> 00:41:19.916 A:middle
Thursday morning at 9 a.m. We'd

00:41:19.916 --> 00:41:21.076 A:middle
love to get your questions and

00:41:21.076 --> 00:41:22.246 A:middle
help you out as best we can.

00:41:22.756 --> 00:41:23.686 A:middle
Thanks so much for coming.

00:41:24.516 --> 00:41:30.500 A:middle
[ Applause ]
