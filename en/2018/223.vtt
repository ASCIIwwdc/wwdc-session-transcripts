WEBVTT

00:00:07.516 --> 00:00:15.500 A:middle
[ Music ]

00:00:17.516 --> 00:00:23.056 A:middle
[ Applause ]

00:00:23.556 --> 00:00:24.156 A:middle
&gt;&gt; Hi, everybody.

00:00:24.876 --> 00:00:26.136 A:middle
It's great to see you all here

00:00:26.136 --> 00:00:26.446 A:middle
today.

00:00:27.306 --> 00:00:29.676 A:middle
I'm Dave, and the next 40

00:00:29.676 --> 00:00:32.436 A:middle
minutes are about understanding

00:00:32.485 --> 00:00:33.996 A:middle
and honoring what makes our

00:00:34.036 --> 00:00:35.716 A:middle
programs actually work.

00:00:36.766 --> 00:00:38.286 A:middle
There will be practical advice,

00:00:38.636 --> 00:00:40.986 A:middle
but this is not a talk about

00:00:41.056 --> 00:00:43.116 A:middle
tips and techniques or any

00:00:43.116 --> 00:00:44.876 A:middle
specific algorithms even, though

00:00:44.876 --> 00:00:45.816 A:middle
we will look at a few.

00:00:47.026 --> 00:00:49.156 A:middle
It's about revealing something

00:00:49.296 --> 00:00:50.956 A:middle
fundamental, the potential of

00:00:51.036 --> 00:00:53.076 A:middle
which is already present in your

00:00:53.906 --> 00:00:54.006 A:middle
code.

00:00:54.936 --> 00:00:57.216 A:middle
I hope that for at least a few

00:00:57.216 --> 00:00:58.796 A:middle
of you it marks the beginning of

00:00:58.796 --> 00:01:00.056 A:middle
a new relationship to the

00:00:58.796 --> 00:01:00.056 A:middle
a new relationship to the

00:01:00.056 --> 00:01:01.056 A:middle
practice of programming.

00:01:02.236 --> 00:01:03.446 A:middle
Speaking personally, when I

00:01:03.446 --> 00:01:05.116 A:middle
discovered this approach, it

00:01:05.116 --> 00:01:06.446 A:middle
changed the course of my life

00:01:06.756 --> 00:01:07.486 A:middle
and my career.

00:01:08.446 --> 00:01:09.926 A:middle
It's the reason I care so much

00:01:09.926 --> 00:01:11.966 A:middle
about software libraries, but

00:01:11.966 --> 00:01:13.786 A:middle
it's also the source of the

00:01:13.786 --> 00:01:15.866 A:middle
liability, maintainability, and

00:01:15.866 --> 00:01:17.976 A:middle
performance in every piece of

00:01:17.976 --> 00:01:19.016 A:middle
concrete code I've written

00:01:19.016 --> 00:01:19.436 A:middle
since.

00:01:20.836 --> 00:01:22.876 A:middle
But before we get into that, let

00:01:22.876 --> 00:01:24.226 A:middle
me introduce you to a friend of

00:01:24.226 --> 00:01:24.396 A:middle
mine.

00:01:26.776 --> 00:01:27.506 A:middle
This is Crusty.

00:01:28.516 --> 00:01:31.616 A:middle
[ Applause ]

00:01:32.116 --> 00:01:34.006 A:middle
Crusty is old school.

00:01:34.896 --> 00:01:37.026 A:middle
He doesn't trust debuggers or or

00:01:37.026 --> 00:01:38.786 A:middle
mess around with integrated

00:01:38.786 --> 00:01:40.016 A:middle
development environments.

00:01:40.806 --> 00:01:43.246 A:middle
No, he favors an 80 x 24

00:01:43.246 --> 00:01:45.436 A:middle
terminal window in plain text,

00:01:45.506 --> 00:01:46.246 A:middle
thank you very much.

00:01:47.516 --> 00:01:49.566 A:middle
Now, Crusty takes a dim view of

00:01:49.566 --> 00:01:51.916 A:middle
the latest programming fads, so

00:01:51.916 --> 00:01:53.476 A:middle
it can sometimes be an effort to

00:01:53.476 --> 00:01:55.166 A:middle
drag him into the 21st century.

00:01:56.126 --> 00:01:57.636 A:middle
He just thinks different.

00:01:58.656 --> 00:02:00.866 A:middle
But if you listen carefully, you

00:01:58.656 --> 00:02:00.866 A:middle
But if you listen carefully, you

00:02:00.866 --> 00:02:03.336 A:middle
can learn a thing or two.

00:02:03.576 --> 00:02:05.356 A:middle
Now, sometimes his cryptic

00:02:05.356 --> 00:02:07.666 A:middle
pronouncements like "programming

00:02:07.666 --> 00:02:10.156 A:middle
reveals the real; border on the

00:02:10.156 --> 00:02:10.675 A:middle
mystical."

00:02:11.416 --> 00:02:13.576 A:middle
And to understand him, I found

00:02:13.576 --> 00:02:15.096 A:middle
it helpful to actually write

00:02:15.096 --> 00:02:16.286 A:middle
some code.

00:02:17.526 --> 00:02:18.796 A:middle
So, lately, I've been working on

00:02:18.796 --> 00:02:20.586 A:middle
a little program called Shapes.

00:02:21.656 --> 00:02:22.906 A:middle
I'm hoping to make it into a

00:02:22.906 --> 00:02:24.216 A:middle
full-featured vector drawing

00:02:24.216 --> 00:02:26.876 A:middle
program, but so far it lets you

00:02:26.876 --> 00:02:28.336 A:middle
arrange shapes on an infinite

00:02:28.336 --> 00:02:28.836 A:middle
canvas.

00:02:30.416 --> 00:02:31.376 A:middle
Now, I want to tell you the

00:02:31.376 --> 00:02:33.226 A:middle
story of the delete selection

00:02:33.226 --> 00:02:35.526 A:middle
command because I learned so

00:02:35.526 --> 00:02:37.826 A:middle
much from implementing this one

00:02:37.826 --> 00:02:38.266 A:middle
feature.

00:02:39.596 --> 00:02:41.216 A:middle
I think we've probably all gone

00:02:41.216 --> 00:02:43.426 A:middle
through part of this progression

00:02:43.426 --> 00:02:45.436 A:middle
as programmers as we learn how

00:02:45.436 --> 00:02:46.856 A:middle
to remove things from an array.

00:02:47.816 --> 00:02:49.106 A:middle
Everybody starts out doing

00:02:49.106 --> 00:02:51.000 A:middle
something like this.

00:02:53.596 --> 00:02:55.006 A:middle
That's the delete selection

00:02:56.836 --> 00:02:57.026 A:middle
command.

00:02:58.656 --> 00:03:02.316 A:middle
We loop from 0 to count, and

00:02:58.656 --> 00:03:02.316 A:middle
We loop from 0 to count, and

00:03:02.316 --> 00:03:03.326 A:middle
when we find something to

00:03:03.326 --> 00:03:05.126 A:middle
delete, we [inaudible] remove

00:03:05.126 --> 00:03:07.546 A:middle
that, and then we continue with

00:03:07.546 --> 00:03:11.266 A:middle
our loop until, ouch, we walk

00:03:11.266 --> 00:03:11.846 A:middle
off the end.

00:03:13.366 --> 00:03:14.906 A:middle
The array got shorter, but we

00:03:14.906 --> 00:03:16.256 A:middle
picked the number of iterations

00:03:16.256 --> 00:03:17.166 A:middle
when the loop started.

00:03:17.876 --> 00:03:19.196 A:middle
Fortunately, you can't miss this

00:03:19.246 --> 00:03:20.796 A:middle
bug if you Swift and test your

00:03:20.826 --> 00:03:23.436 A:middle
code because it'll trap.

00:03:23.946 --> 00:03:25.226 A:middle
But if you had to learn this

00:03:25.266 --> 00:03:26.996 A:middle
lesson as a C-programmer, like I

00:03:26.996 --> 00:03:28.966 A:middle
did, you might not be so lucky.

00:03:29.926 --> 00:03:30.256 A:middle
Okay.

00:03:30.626 --> 00:03:32.796 A:middle
So, we can fix it by replacing

00:03:32.796 --> 00:03:34.096 A:middle
the for loop with a somewhat

00:03:34.096 --> 00:03:36.346 A:middle
uglier while loop, which lets us

00:03:36.346 --> 00:03:37.516 A:middle
examine the count at each

00:03:37.516 --> 00:03:38.096 A:middle
iteration.

00:03:38.646 --> 00:03:42.156 A:middle
But there's a subtle bug in this

00:03:42.156 --> 00:03:42.736 A:middle
one too.

00:03:43.956 --> 00:03:46.056 A:middle
If two consecutive elements are

00:03:46.056 --> 00:03:48.706 A:middle
selected, it'll remove the first

00:03:48.706 --> 00:03:51.916 A:middle
one and then immediately hop

00:03:51.916 --> 00:03:54.256 A:middle
over the next one.

00:03:54.466 --> 00:03:56.956 A:middle
Now, this bug is a little more

00:03:56.956 --> 00:03:58.496 A:middle
insidious because it hides from

00:03:58.496 --> 00:04:00.286 A:middle
you unless your tests happen to

00:03:58.496 --> 00:04:00.286 A:middle
you unless your tests happen to

00:04:00.286 --> 00:04:02.716 A:middle
exercise it.

00:04:02.946 --> 00:04:04.416 A:middle
But if we're lucky enough to

00:04:04.416 --> 00:04:06.496 A:middle
notice it, we press ahead and we

00:04:06.496 --> 00:04:08.826 A:middle
fix the implementation again by

00:04:08.826 --> 00:04:10.026 A:middle
guarding the increment in an

00:04:10.026 --> 00:04:10.586 A:middle
else block.

00:04:11.226 --> 00:04:13.596 A:middle
So, are we done now?

00:04:13.596 --> 00:04:16.476 A:middle
Are we sure this one is correct?

00:04:17.706 --> 00:04:19.906 A:middle
I think I can prove to myself

00:04:19.995 --> 00:04:20.755 A:middle
that it works.

00:04:21.875 --> 00:04:24.106 A:middle
Anyway, having gone through this

00:04:24.106 --> 00:04:25.356 A:middle
ordeal, what do we do?

00:04:25.746 --> 00:04:27.336 A:middle
Well, of course, we lock this

00:04:27.336 --> 00:04:28.696 A:middle
nine-line pattern into our

00:04:28.696 --> 00:04:30.506 A:middle
brains so we can trot it out

00:04:30.506 --> 00:04:32.056 A:middle
whenever we have to delete

00:04:32.056 --> 00:04:32.456 A:middle
something.

00:04:33.026 --> 00:04:35.666 A:middle
Now, I'm sure many of you have

00:04:35.666 --> 00:04:36.676 A:middle
been holding yourselves back

00:04:36.676 --> 00:04:38.566 A:middle
from screaming at me because

00:04:38.656 --> 00:04:40.506 A:middle
that there's a much more elegant

00:04:40.506 --> 00:04:41.906 A:middle
way to do it.

00:04:41.906 --> 00:04:43.206 A:middle
I still remember the day I

00:04:43.206 --> 00:04:44.686 A:middle
discovered this trick for myself

00:04:45.106 --> 00:04:46.666 A:middle
because once you find it, you

00:04:46.666 --> 00:04:48.126 A:middle
never do this nine-line dance

00:04:48.126 --> 00:04:48.456 A:middle
again.

00:04:49.406 --> 00:04:51.496 A:middle
The iteration limit and the

00:04:51.556 --> 00:04:52.786 A:middle
index of the next item to

00:04:52.786 --> 00:04:54.956 A:middle
examine kept shifting under our

00:04:54.956 --> 00:04:56.866 A:middle
feet because remove(at: i)

00:04:57.746 --> 00:04:59.426 A:middle
changes parts of the array after

00:04:59.426 --> 00:04:59.696 A:middle
i.

00:05:00.766 --> 00:05:06.266 A:middle
But if you go backwards, you

00:05:06.266 --> 00:05:07.526 A:middle
only iterate over the parts of

00:05:07.526 --> 00:05:08.376 A:middle
the array that you haven't

00:05:08.376 --> 00:05:08.896 A:middle
changed yet.

00:05:10.056 --> 00:05:10.776 A:middle
Slick, right?

00:05:11.456 --> 00:05:12.556 A:middle
And this is the pattern I've

00:05:12.606 --> 00:05:14.916 A:middle
used ever since because it's

00:05:14.946 --> 00:05:19.476 A:middle
clean, and it never fails, until

00:05:20.086 --> 00:05:21.736 A:middle
a few months ago.

00:05:21.736 --> 00:05:24.056 A:middle
One morning, I had just finished

00:05:24.056 --> 00:05:26.216 A:middle
my avocado toast, and I was idly

00:05:26.306 --> 00:05:28.376 A:middle
fooling with my app when I tried

00:05:28.376 --> 00:05:29.986 A:middle
deleting about half the shapes

00:05:29.986 --> 00:05:31.216 A:middle
from a really complicated

00:05:31.216 --> 00:05:31.686 A:middle
canvas.

00:05:33.016 --> 00:05:35.166 A:middle
My iPad, it froze up for like

00:05:35.526 --> 00:05:36.206 A:middle
three seconds.

00:05:36.886 --> 00:05:40.586 A:middle
So, I took a sip of my half caf

00:05:40.626 --> 00:05:42.746 A:middle
triple shot latte in its bamboo

00:05:43.156 --> 00:05:44.716 A:middle
thermal commuter cup, and I

00:05:44.716 --> 00:05:45.936 A:middle
considered my options.

00:05:47.656 --> 00:05:48.526 A:middle
This was disturbing.

00:05:49.136 --> 00:05:50.006 A:middle
I mean, it's a pretty

00:05:50.006 --> 00:05:51.716 A:middle
straightforward operation, and

00:05:51.716 --> 00:05:53.686 A:middle
my code was so clean, how could

00:05:53.686 --> 00:05:54.286 A:middle
it be wrong?

00:05:56.176 --> 00:05:58.256 A:middle
Profiling showed me that the hot

00:05:58.256 --> 00:06:01.156 A:middle
spot was right here, but beyond

00:05:58.256 --> 00:06:01.156 A:middle
spot was right here, but beyond

00:06:01.156 --> 00:06:02.056 A:middle
that, I was stumped.

00:06:02.706 --> 00:06:05.636 A:middle
So, just about then, Crusty

00:06:05.636 --> 00:06:07.076 A:middle
walked up behind me carrying a

00:06:07.076 --> 00:06:09.416 A:middle
can of off-brand coffee grounds

00:06:09.416 --> 00:06:10.796 A:middle
from the local supermarket for

00:06:10.796 --> 00:06:11.546 A:middle
his daily brew.

00:06:12.936 --> 00:06:15.876 A:middle
"Stuck?" he said.

00:06:16.086 --> 00:06:18.016 A:middle
"Yeah," I sighed, and I

00:06:18.016 --> 00:06:19.216 A:middle
explained the situation.

00:06:19.706 --> 00:06:24.556 A:middle
"Well, did you even look at the

00:06:24.556 --> 00:06:25.796 A:middle
documentation for that?"

00:06:27.826 --> 00:06:29.916 A:middle
Well, I hadn't, so I popped up

00:06:29.916 --> 00:06:31.516 A:middle
the Quick Help for Remove At,

00:06:31.806 --> 00:06:33.526 A:middle
and Crusty leaned in.

00:06:34.316 --> 00:06:35.856 A:middle
"There's your problem, right

00:06:35.856 --> 00:06:38.986 A:middle
there," he said, leaving a

00:06:38.986 --> 00:06:40.506 A:middle
smudge on my gorgeous retina

00:06:40.506 --> 00:06:41.036 A:middle
display.

00:06:42.906 --> 00:06:45.506 A:middle
Now, I carefully wiped off the

00:06:45.546 --> 00:06:47.216 A:middle
fingerprint with a handcrafted

00:06:47.216 --> 00:06:50.596 A:middle
Italian microfiber cloth, and

00:06:50.596 --> 00:06:53.386 A:middle
Crusty said, "What's that tell

00:06:53.996 --> 00:06:54.856 A:middle
you, son?"

00:06:55.096 --> 00:06:57.516 A:middle
"Well," I said, "it means that

00:06:57.596 --> 00:06:59.056 A:middle
removing an element takes a

00:06:59.056 --> 00:07:01.216 A:middle
number of steps proportional to

00:06:59.056 --> 00:07:01.216 A:middle
number of steps proportional to

00:07:01.216 --> 00:07:02.476 A:middle
the length of the array."

00:07:02.476 --> 00:07:04.456 A:middle
And it kind of makes sense,

00:07:04.456 --> 00:07:06.686 A:middle
since the array has to slide all

00:07:06.686 --> 00:07:08.316 A:middle
of the following elements into

00:07:08.316 --> 00:07:09.186 A:middle
their new positions.

00:07:10.996 --> 00:07:12.466 A:middle
"So, what's that mean about your

00:07:12.466 --> 00:07:13.806 A:middle
Delete Selection command?"

00:07:14.596 --> 00:07:14.996 A:middle
he asked.

00:07:16.166 --> 00:07:17.646 A:middle
"Uh," I said.

00:07:18.186 --> 00:07:21.606 A:middle
That's when he pulled out a pack

00:07:21.606 --> 00:07:22.976 A:middle
of mentholated lozenges and

00:07:22.976 --> 00:07:24.086 A:middle
lined them up on my desk.

00:07:24.756 --> 00:07:25.596 A:middle
"Try it yourself."

00:07:27.246 --> 00:07:29.216 A:middle
So, I went through the process

00:07:29.216 --> 00:07:30.226 A:middle
as I tried to answer his

00:07:30.226 --> 00:07:30.656 A:middle
question.

00:07:30.896 --> 00:07:32.096 A:middle
"Well, since Delete Selection

00:07:32.096 --> 00:07:34.116 A:middle
has to do order n steps, once

00:07:34.116 --> 00:07:35.486 A:middle
for each selected element, and

00:07:35.486 --> 00:07:36.996 A:middle
you can select up to n elements,

00:07:37.276 --> 00:07:38.396 A:middle
the total number of steps is

00:07:38.396 --> 00:07:40.906 A:middle
proportional to n squared."

00:07:42.276 --> 00:07:44.356 A:middle
Crusty added, "That's quadratic,

00:07:44.356 --> 00:07:46.296 A:middle
son, whether you do it the ugly

00:07:46.296 --> 00:07:48.186 A:middle
forward way or the fancy pants

00:07:48.186 --> 00:07:50.346 A:middle
backward way."

00:07:50.976 --> 00:07:54.106 A:middle
I realized then that for my

00:07:54.106 --> 00:07:56.036 A:middle
little 10 to 20-element test

00:07:56.036 --> 00:07:58.006 A:middle
cases, we'd only been talking

00:07:58.006 --> 00:08:00.376 A:middle
about a few hundred steps, and

00:07:58.006 --> 00:08:00.376 A:middle
about a few hundred steps, and

00:08:00.376 --> 00:08:01.936 A:middle
since the steps are pretty fast,

00:08:02.046 --> 00:08:02.876 A:middle
it seemed great.

00:08:04.116 --> 00:08:05.396 A:middle
But the problem is that it

00:08:05.396 --> 00:08:06.296 A:middle
doesn't scale well.

00:08:06.796 --> 00:08:10.576 A:middle
Fifty squared is 2,500 and 100

00:08:10.576 --> 00:08:11.986 A:middle
squared is 10,000.

00:08:12.546 --> 00:08:15.326 A:middle
So, if you do all your testing

00:08:15.326 --> 00:08:17.186 A:middle
in this little region down here,

00:08:17.476 --> 00:08:18.766 A:middle
you'll probably never see it,

00:08:19.336 --> 00:08:21.746 A:middle
but scalability matters because

00:08:21.746 --> 00:08:23.336 A:middle
people are using their phones

00:08:23.336 --> 00:08:25.626 A:middle
and iPads to manage more and

00:08:25.626 --> 00:08:27.376 A:middle
more data, and we keep shipping

00:08:27.376 --> 00:08:29.096 A:middle
devices with more memory to help

00:08:29.096 --> 00:08:29.586 A:middle
them do it.

00:08:30.606 --> 00:08:32.346 A:middle
You care about this because

00:08:32.346 --> 00:08:34.476 A:middle
scalability is predictability

00:08:34.476 --> 00:08:35.296 A:middle
for your users.

00:08:35.826 --> 00:08:39.946 A:middle
So, now, I understood the

00:08:39.946 --> 00:08:41.986 A:middle
problem, but I still wasn't sure

00:08:41.986 --> 00:08:42.746 A:middle
what to do about it.

00:08:43.326 --> 00:08:43.706 A:middle
"Now what?"

00:08:43.706 --> 00:08:44.446 A:middle
I asked Crusty.

00:08:45.526 --> 00:08:47.056 A:middle
"You know, kid," he said,

00:08:47.496 --> 00:08:49.776 A:middle
popping a lozenge, "there is an

00:08:49.776 --> 00:08:51.466 A:middle
algorithm for that."

00:08:53.056 --> 00:08:56.236 A:middle
I told him, "Listen, Crusty, I'm

00:08:56.236 --> 00:08:57.176 A:middle
an app developer.

00:08:58.226 --> 00:09:00.176 A:middle
You say you don't do object

00:08:58.226 --> 00:09:00.176 A:middle
You say you don't do object

00:09:00.176 --> 00:09:00.716 A:middle
oriented.

00:09:00.716 --> 00:09:02.646 A:middle
Well, I don't 'do' algorithms."

00:09:03.276 --> 00:09:04.406 A:middle
You pay attention to your data

00:09:04.406 --> 00:09:06.066 A:middle
structures in algorithms class

00:09:06.396 --> 00:09:08.036 A:middle
because you know when it's time

00:09:08.036 --> 00:09:09.806 A:middle
to get a job, your interviewer

00:09:09.806 --> 00:09:10.946 A:middle
is going to ask you about them.

00:09:11.346 --> 00:09:12.776 A:middle
But in the real programming

00:09:12.776 --> 00:09:14.766 A:middle
world, what separates the elite

00:09:14.926 --> 00:09:16.946 A:middle
from the newbies is the ability

00:09:16.946 --> 00:09:18.396 A:middle
to wire together controllers,

00:09:18.396 --> 00:09:19.766 A:middle
delegates, and responders to

00:09:19.766 --> 00:09:22.546 A:middle
build a working system.

00:09:22.996 --> 00:09:24.906 A:middle
"Bonkey," he said; I don't know

00:09:24.906 --> 00:09:27.276 A:middle
why he calls me that, "What do

00:09:27.506 --> 00:09:28.656 A:middle
computers do?"

00:09:30.096 --> 00:09:30.816 A:middle
"They compute."

00:09:31.796 --> 00:09:33.086 A:middle
"Now, where's the computation in

00:09:33.086 --> 00:09:34.286 A:middle
all that?"

00:09:35.356 --> 00:09:37.966 A:middle
"Well," I replied, "I guess I

00:09:37.966 --> 00:09:39.106 A:middle
don't see anything that looks

00:09:39.106 --> 00:09:40.496 A:middle
like an algorithm in my code."

00:09:41.046 --> 00:09:43.296 A:middle
But Crusty wasn't having it.

00:09:43.806 --> 00:09:45.106 A:middle
"Oh, your app is full of them,"

00:09:45.106 --> 00:09:46.646 A:middle
he said, dropping an old dead

00:09:46.646 --> 00:09:47.956 A:middle
tree dictionary on my desk,

00:09:48.526 --> 00:09:50.496 A:middle
"Look it up."

00:09:51.266 --> 00:09:54.066 A:middle
After I gathered my composure, I

00:09:54.066 --> 00:09:55.396 A:middle
carefully slid the book to one

00:09:55.396 --> 00:09:57.226 A:middle
side and typed Define Algorithm

00:09:57.226 --> 00:09:58.886 A:middle
into Spotlight, which Crusty

00:09:58.886 --> 00:10:00.000 A:middle
thought was a neat trick.

00:10:03.976 --> 00:10:04.976 A:middle
Hmm.

00:10:05.046 --> 00:10:06.876 A:middle
A process or set of rules to be

00:10:06.876 --> 00:10:08.656 A:middle
followed in calculations or

00:10:08.656 --> 00:10:09.806 A:middle
other problem solving

00:10:09.806 --> 00:10:10.416 A:middle
operations.

00:10:11.756 --> 00:10:13.356 A:middle
Well, come to think of it, that

00:10:13.806 --> 00:10:16.016 A:middle
did sound like most code, but I

00:10:16.016 --> 00:10:16.906 A:middle
still wasn't sure.

00:10:18.036 --> 00:10:19.446 A:middle
"You ever do a long division?"

00:10:19.596 --> 00:10:20.236 A:middle
asked Crusty.

00:10:20.646 --> 00:10:21.576 A:middle
"That's an algorithm."

00:10:25.766 --> 00:10:27.606 A:middle
I started to type into Spotlight

00:10:27.606 --> 00:10:29.266 A:middle
again, but he snapped, "On

00:10:29.266 --> 00:10:29.646 A:middle
paper."

00:10:30.306 --> 00:10:31.616 A:middle
And not wanting to embarrass

00:10:31.616 --> 00:10:32.746 A:middle
myself, I turned the subject

00:10:32.746 --> 00:10:33.476 A:middle
back to my code.

00:10:35.316 --> 00:10:35.386 A:middle
"Hmm."

00:10:36.256 --> 00:10:39.926 A:middle
I asked, "So, what is this magic

00:10:39.926 --> 00:10:41.666 A:middle
algorithm that will cure my

00:10:41.666 --> 00:10:42.856 A:middle
performance problem?"

00:10:44.126 --> 00:10:45.496 A:middle
"Well, if you'll just let me at

00:10:45.496 --> 00:10:46.976 A:middle
your TTY there for a minute," he

00:10:46.976 --> 00:10:48.446 A:middle
said, "How do you work this

00:10:48.446 --> 00:10:48.626 A:middle
thing?

00:10:48.626 --> 00:10:49.816 A:middle
Oh, it's a track pad.

00:10:49.816 --> 00:10:50.826 A:middle
I'll try not to touch that.

00:10:51.226 --> 00:10:53.356 A:middle
So, first, you do away with this

00:10:53.356 --> 00:10:54.330 A:middle
foolishness.

00:10:57.046 --> 00:11:00.676 A:middle
Now, shapes.removeallwhere the

00:10:57.046 --> 00:11:00.676 A:middle
Now, shapes.removeallwhere the

00:11:00.676 --> 00:11:02.186 A:middle
shape is selected.

00:11:03.146 --> 00:11:03.326 A:middle
Hmm.

00:11:04.026 --> 00:11:05.236 A:middle
Try that on for size."

00:11:06.216 --> 00:11:07.756 A:middle
Now, Crusty headed off to wash

00:11:07.756 --> 00:11:08.856 A:middle
out the pitcher of his coffee

00:11:08.856 --> 00:11:11.066 A:middle
maker, leaving me to figure out

00:11:11.066 --> 00:11:12.816 A:middle
what had just happened in my

00:11:13.666 --> 00:11:13.766 A:middle
code.

00:11:14.736 --> 00:11:17.756 A:middle
First, I checked, and I found

00:11:17.756 --> 00:11:18.936 A:middle
that the performance problem was

00:11:18.996 --> 00:11:19.286 A:middle
fixed.

00:11:19.856 --> 00:11:20.226 A:middle
Nice.

00:11:21.536 --> 00:11:22.886 A:middle
And I didn't want another earful

00:11:22.886 --> 00:11:24.226 A:middle
from Crusty about looking at the

00:11:24.226 --> 00:11:26.626 A:middle
documentation, so I popped up

00:11:26.626 --> 00:11:28.126 A:middle
Quick Help for removeAll(where:

00:11:28.676 --> 00:11:32.856 A:middle
and I saw that its complexity

00:11:32.856 --> 00:11:34.266 A:middle
scales proportionally to the

00:11:34.266 --> 00:11:36.176 A:middle
length of the collection just

00:11:36.176 --> 00:11:36.806 A:middle
like removeAt.

00:11:37.796 --> 00:11:39.656 A:middle
But since I didn't have to put

00:11:39.656 --> 00:11:41.576 A:middle
it in a loop, that became the

00:11:41.576 --> 00:11:42.836 A:middle
complexity of my whole

00:11:42.836 --> 00:11:43.376 A:middle
operation.

00:11:44.576 --> 00:11:46.776 A:middle
Now, I want to give you some

00:11:46.776 --> 00:11:48.026 A:middle
intuition for the kind of

00:11:48.106 --> 00:11:50.106 A:middle
difference this makes.

00:11:50.566 --> 00:11:52.476 A:middle
What are n means that the time

00:11:52.476 --> 00:11:54.216 A:middle
the algorithm runs scales

00:11:54.566 --> 00:11:56.166 A:middle
linearly with the problem size.

00:11:56.696 --> 00:11:57.936 A:middle
The graph is a straight line.

00:11:59.396 --> 00:12:00.826 A:middle
Now, the orange line is the

00:11:59.396 --> 00:12:00.826 A:middle
Now, the orange line is the

00:12:00.826 --> 00:12:02.076 A:middle
shape of order n squared.

00:12:03.356 --> 00:12:04.846 A:middle
As you can see, a linear

00:12:04.846 --> 00:12:06.406 A:middle
algorithm may do worse on a

00:12:06.406 --> 00:12:07.956 A:middle
small problem, but it's

00:12:07.956 --> 00:12:09.596 A:middle
eventually faster than a

00:12:09.596 --> 00:12:10.606 A:middle
quadratic algorithm.

00:12:11.926 --> 00:12:13.716 A:middle
The cool thing is though, it

00:12:13.716 --> 00:12:15.546 A:middle
doesn't matter how expensive you

00:12:15.546 --> 00:12:16.856 A:middle
make the steps of the linear

00:12:16.856 --> 00:12:19.226 A:middle
algorithm, if you keep looking

00:12:19.226 --> 00:12:22.456 A:middle
at larger problem sizes, you'll

00:12:22.566 --> 00:12:24.736 A:middle
always find one where the linear

00:12:24.736 --> 00:12:27.206 A:middle
algorithm wins and continues to

00:12:27.206 --> 00:12:28.206 A:middle
win forever.

00:12:29.346 --> 00:12:30.506 A:middle
So, we're talking about

00:12:30.506 --> 00:12:32.356 A:middle
scalability, not absolute

00:12:32.406 --> 00:12:33.000 A:middle
performance.

00:12:36.436 --> 00:12:40.346 A:middle
Well, my scalability problem was

00:12:40.346 --> 00:12:42.316 A:middle
fixed, but I really wanted to

00:12:42.316 --> 00:12:44.196 A:middle
see how the standard library had

00:12:44.196 --> 00:12:46.256 A:middle
improved on my backward deletion

00:12:46.256 --> 00:12:46.616 A:middle
scheme.

00:12:47.886 --> 00:12:49.586 A:middle
Crusty reminded me that Swift is

00:12:49.586 --> 00:12:50.986 A:middle
open source, so I could pull it

00:12:50.986 --> 00:12:53.006 A:middle
up on what he calls "the hipster

00:12:53.006 --> 00:12:53.426 A:middle
web."

00:12:53.816 --> 00:12:54.786 A:middle
But the rest of us know as

00:12:54.786 --> 00:12:55.500 A:middle
GitHub.

00:12:59.266 --> 00:13:00.776 A:middle
Now, the first thing I noticed

00:12:59.266 --> 00:13:00.776 A:middle
Now, the first thing I noticed

00:13:00.776 --> 00:13:03.106 A:middle
was the dot comment, which was

00:13:03.136 --> 00:13:04.456 A:middle
the source of all that Quick

00:13:04.456 --> 00:13:06.636 A:middle
Help, describing both what the

00:13:06.636 --> 00:13:08.556 A:middle
algorithm does and its

00:13:08.556 --> 00:13:09.136 A:middle
complexity.

00:13:09.596 --> 00:13:14.046 A:middle
Next, it turns out that

00:13:14.046 --> 00:13:15.946 A:middle
removeAll(where) isn't just some

00:13:15.946 --> 00:13:18.486 A:middle
method on a reg; it's a generic

00:13:18.486 --> 00:13:20.466 A:middle
algorithm, which means that it

00:13:20.466 --> 00:13:22.126 A:middle
works on a wide variety of

00:13:22.126 --> 00:13:22.926 A:middle
different collections.

00:13:24.286 --> 00:13:25.296 A:middle
It depends on a couple of

00:13:25.296 --> 00:13:28.376 A:middle
things, the ability to rearrange

00:13:28.376 --> 00:13:29.556 A:middle
elements, which comes from

00:13:29.556 --> 00:13:31.636 A:middle
mutable collection, and the

00:13:31.966 --> 00:13:34.626 A:middle
ability to change the length and

00:13:34.626 --> 00:13:36.506 A:middle
structure, which comes from

00:13:36.506 --> 00:13:37.656 A:middle
range-replaceable collection.

00:13:38.186 --> 00:13:41.606 A:middle
And it's built from a couple of

00:13:41.606 --> 00:13:43.206 A:middle
other order n algorithms.

00:13:44.016 --> 00:13:46.126 A:middle
The first is a half stable

00:13:46.126 --> 00:13:48.096 A:middle
partition, which moves all of

00:13:48.096 --> 00:13:49.416 A:middle
the elements satisfying some

00:13:49.416 --> 00:13:53.456 A:middle
predicate to the end and tells

00:13:53.456 --> 00:13:54.846 A:middle
us where that suffix starts.

00:13:56.136 --> 00:13:57.786 A:middle
The half stable in its name,

00:13:58.186 --> 00:14:00.196 A:middle
that comes, that indicates that

00:13:58.186 --> 00:14:00.196 A:middle
that comes, that indicates that

00:14:00.196 --> 00:14:02.116 A:middle
it preserves the order of the

00:14:02.116 --> 00:14:03.646 A:middle
elements that it doesn't move,

00:14:04.486 --> 00:14:06.396 A:middle
but it can scramble the elements

00:14:06.436 --> 00:14:09.026 A:middle
that it moves to the end.

00:14:09.206 --> 00:14:10.426 A:middle
Now, sometimes, that doesn't

00:14:10.426 --> 00:14:11.786 A:middle
matter though; the second

00:14:11.786 --> 00:14:13.166 A:middle
algorithm removes subrange.

00:14:13.166 --> 00:14:14.146 A:middle
It's just going to delete them

00:14:14.146 --> 00:14:14.456 A:middle
anyway.

00:14:16.476 --> 00:14:17.956 A:middle
Have we all seen this partial

00:14:17.956 --> 00:14:18.696 A:middle
range notation?

00:14:19.256 --> 00:14:21.426 A:middle
It's just a really convenient

00:14:21.426 --> 00:14:22.656 A:middle
way of writing a range that

00:14:22.656 --> 00:14:23.696 A:middle
extends to the end of the

00:14:23.696 --> 00:14:24.000 A:middle
collection.

00:14:26.896 --> 00:14:27.116 A:middle
Okay.

00:14:27.846 --> 00:14:29.986 A:middle
Now, remove subrange is part of

00:14:29.986 --> 00:14:31.826 A:middle
the library's public API, so you

00:14:31.826 --> 00:14:33.496 A:middle
can find its documentation

00:14:33.496 --> 00:14:36.276 A:middle
online, but halfStablePartition

00:14:36.456 --> 00:14:37.696 A:middle
is an implementation detail.

00:14:38.236 --> 00:14:42.166 A:middle
Now, we're not going to step

00:14:42.166 --> 00:14:43.556 A:middle
through all of it, but there are

00:14:43.556 --> 00:14:44.906 A:middle
a few things worth noticing

00:14:44.906 --> 00:14:45.116 A:middle
here.

00:14:46.516 --> 00:14:48.846 A:middle
First, it starts by calling yet

00:14:48.846 --> 00:14:49.696 A:middle
another algorithm,

00:14:50.486 --> 00:14:52.596 A:middle
firstIndex(where), to find the

00:14:52.856 --> 00:14:54.716 A:middle
position of the first element

00:14:54.716 --> 00:14:55.796 A:middle
that belongs in the suffix.

00:14:57.176 --> 00:14:58.766 A:middle
Next, it sets up a loop variable

00:14:58.766 --> 00:15:01.126 A:middle
j, and there's a single loop,

00:14:58.766 --> 00:15:01.126 A:middle
j, and there's a single loop,

00:15:01.616 --> 00:15:04.906 A:middle
and the loop index j moves

00:15:05.046 --> 00:15:06.646 A:middle
forward one on each iteration.

00:15:07.696 --> 00:15:09.196 A:middle
So, it's a sure bet that j makes

00:15:09.196 --> 00:15:10.716 A:middle
just one pass over the elements.

00:15:11.116 --> 00:15:14.086 A:middle
You can almost see the order and

00:15:14.086 --> 00:15:20.306 A:middle
complexity just from that.

00:15:20.516 --> 00:15:22.106 A:middle
Lastly, because this method

00:15:22.106 --> 00:15:23.526 A:middle
needs to rearrange elements but

00:15:23.526 --> 00:15:24.726 A:middle
not change the length or

00:15:24.726 --> 00:15:26.396 A:middle
structure of the collection, it

00:15:26.396 --> 00:15:27.506 A:middle
only depends on mutable

00:15:27.506 --> 00:15:28.606 A:middle
collection conformance.

00:15:29.146 --> 00:15:32.366 A:middle
So, this is the first lesson I

00:15:32.366 --> 00:15:32.676 A:middle
learned.

00:15:33.686 --> 00:15:34.966 A:middle
Become familiar with what's in

00:15:34.966 --> 00:15:36.166 A:middle
the Swift Standard Library.

00:15:37.176 --> 00:15:38.606 A:middle
It contains a suite of

00:15:38.606 --> 00:15:40.416 A:middle
algorithms with documented

00:15:40.416 --> 00:15:41.486 A:middle
meanings and performance

00:15:41.486 --> 00:15:42.316 A:middle
characteristics.

00:15:43.406 --> 00:15:45.526 A:middle
And although we happened to peek

00:15:45.526 --> 00:15:47.416 A:middle
at the implementation, and you

00:15:47.416 --> 00:15:49.126 A:middle
can learn a lot that way, it's

00:15:49.156 --> 00:15:50.786 A:middle
designed so that you do not have

00:15:50.836 --> 00:15:50.946 A:middle
to.

00:15:52.426 --> 00:15:53.756 A:middle
The official documentation

00:15:53.756 --> 00:15:55.046 A:middle
should tell you everything you

00:15:55.046 --> 00:15:56.856 A:middle
need to know in order to use the

00:15:56.856 --> 00:15:58.006 A:middle
library effectively.

00:15:58.996 --> 00:16:00.126 A:middle
You'll even find a playground

00:15:58.996 --> 00:16:00.126 A:middle
You'll even find a playground

00:16:00.126 --> 00:16:00.846 A:middle
tutorial there.

00:16:01.906 --> 00:16:03.856 A:middle
Now, I realize there's a lot in

00:16:03.856 --> 00:16:05.436 A:middle
Swift, so it can look daunting,

00:16:06.196 --> 00:16:07.306 A:middle
but you don't need to remember

00:16:07.306 --> 00:16:07.706 A:middle
everything.

00:16:08.696 --> 00:16:10.066 A:middle
Having an idea of what's there

00:16:10.066 --> 00:16:12.156 A:middle
and how to find it will take you

00:16:12.156 --> 00:16:13.326 A:middle
a long way.

00:16:14.396 --> 00:16:16.466 A:middle
Now, before we move on, I want

00:16:16.466 --> 00:16:18.326 A:middle
to point out something else that

00:16:18.326 --> 00:16:19.576 A:middle
happened in my code when Crusty

00:16:19.576 --> 00:16:20.276 A:middle
made this change.

00:16:21.136 --> 00:16:22.816 A:middle
Which one of these most directly

00:16:22.816 --> 00:16:23.776 A:middle
describes its meaning?

00:16:24.346 --> 00:16:27.166 A:middle
Now, I actually have to read and

00:16:27.226 --> 00:16:28.406 A:middle
think through the first one to

00:16:28.406 --> 00:16:29.216 A:middle
know what it's doing.

00:16:30.086 --> 00:16:30.376 A:middle
Hmm.

00:16:30.616 --> 00:16:31.836 A:middle
Maybe I'd better add a comment.

00:16:32.806 --> 00:16:33.026 A:middle
Okay.

00:16:33.026 --> 00:16:33.646 A:middle
How does that look?

00:16:34.196 --> 00:16:35.836 A:middle
Oh, even with that comment, the

00:16:35.836 --> 00:16:37.156 A:middle
reverse iteration is kind of

00:16:37.156 --> 00:16:38.356 A:middle
tricky, and I don't want

00:16:38.356 --> 00:16:39.776 A:middle
somebody breaking this code

00:16:39.776 --> 00:16:40.826 A:middle
because they don't understand

00:16:40.826 --> 00:16:40.946 A:middle
it.

00:16:41.266 --> 00:16:45.046 A:middle
So, I'd better explain that.

00:16:45.256 --> 00:16:45.726 A:middle
Okay.

00:16:46.126 --> 00:16:47.596 A:middle
While we're clarifying things,

00:16:47.656 --> 00:16:49.866 A:middle
the After code actually reads

00:16:49.866 --> 00:16:50.956 A:middle
better with a trailing closure

00:16:50.956 --> 00:16:51.606 A:middle
syntax.

00:16:51.966 --> 00:16:54.896 A:middle
Now, take a breath and look

00:16:54.896 --> 00:16:55.196 A:middle
again.

00:16:56.606 --> 00:16:57.936 A:middle
Which one is more obviously

00:16:57.936 --> 00:16:58.346 A:middle
correct?

00:16:59.526 --> 00:17:00.956 A:middle
Even with all these comments, I

00:16:59.526 --> 00:17:00.956 A:middle
Even with all these comments, I

00:17:00.956 --> 00:17:02.016 A:middle
still need to read through the

00:17:02.016 --> 00:17:03.936 A:middle
first one just to see that it

00:17:03.936 --> 00:17:05.886 A:middle
does inefficiently the same

00:17:05.955 --> 00:17:06.976 A:middle
thing as the second one.

00:17:08.056 --> 00:17:09.465 A:middle
Using the algorithm just made

00:17:09.465 --> 00:17:10.955 A:middle
the code better in every way.

00:17:11.526 --> 00:17:15.356 A:middle
So, this is a guideline, an

00:17:15.356 --> 00:17:16.955 A:middle
aspiration for your code first

00:17:16.986 --> 00:17:18.486 A:middle
put forward by Shawn Perin.

00:17:19.636 --> 00:17:20.836 A:middle
Every time you write a loop,

00:17:21.316 --> 00:17:22.526 A:middle
replace it with a call to an

00:17:22.526 --> 00:17:23.046 A:middle
algorithm.

00:17:23.846 --> 00:17:25.955 A:middle
If you can't find one, make that

00:17:25.955 --> 00:17:27.366 A:middle
algorithm yourself and move the

00:17:27.366 --> 00:17:28.656 A:middle
loop into its implementation.

00:17:30.656 --> 00:17:32.496 A:middle
Actually following this might

00:17:32.496 --> 00:17:34.156 A:middle
seem unrealistic to you now, but

00:17:34.196 --> 00:17:36.166 A:middle
by the end of the talk, I hope

00:17:36.516 --> 00:17:37.056 A:middle
it won't.

00:17:38.096 --> 00:17:39.356 A:middle
For a little motivation though,

00:17:39.856 --> 00:17:42.246 A:middle
think back to the last time you

00:17:42.246 --> 00:17:43.536 A:middle
were looking at spaghetti code.

00:17:44.066 --> 00:17:46.296 A:middle
Was it full of loops?

00:17:47.506 --> 00:17:50.276 A:middle
I bet it was.

00:17:50.766 --> 00:17:51.236 A:middle
All right.

00:17:51.386 --> 00:17:52.286 A:middle
Done and done.

00:17:52.506 --> 00:17:53.666 A:middle
I have just made the code

00:17:53.666 --> 00:17:56.066 A:middle
shorter, faster, and better in

00:17:56.066 --> 00:17:56.686 A:middle
every way.

00:17:56.686 --> 00:17:58.726 A:middle
I was ready to call it a day.

00:17:59.376 --> 00:18:00.546 A:middle
"Thanks for your help, Crusty,"

00:17:59.376 --> 00:18:00.546 A:middle
"Thanks for your help, Crusty,"

00:18:00.546 --> 00:18:02.576 A:middle
I said, fastening the titanium

00:18:02.576 --> 00:18:05.036 A:middle
carabiners on my bespoke leather

00:18:05.036 --> 00:18:07.336 A:middle
messenger bag, but he looked at

00:18:07.336 --> 00:18:09.586 A:middle
me suspiciously, and said, "You

00:18:09.586 --> 00:18:10.966 A:middle
suppose you might have made that

00:18:10.966 --> 00:18:12.330 A:middle
mistake anywhere else?"

00:18:14.166 --> 00:18:16.746 A:middle
I sighed, put my bag down and

00:18:16.746 --> 00:18:18.156 A:middle
started hunting down the loops

00:18:18.156 --> 00:18:18.746 A:middle
in my code.

00:18:20.016 --> 00:18:21.786 A:middle
There were lots in the file

00:18:22.106 --> 00:18:24.106 A:middle
[inaudible].

00:18:24.426 --> 00:18:28.666 A:middle
Bring to front, send it back,

00:18:29.596 --> 00:18:31.126 A:middle
bring forward, which sort of

00:18:31.126 --> 00:18:32.686 A:middle
hops the selected shape over the

00:18:32.686 --> 00:18:33.486 A:middle
one in front of it.

00:18:34.746 --> 00:18:36.666 A:middle
Let's do that a couple of more

00:18:38.076 --> 00:18:38.206 A:middle
times.

00:18:38.406 --> 00:18:40.536 A:middle
Send backward with hops, under

00:18:40.536 --> 00:18:41.756 A:middle
the shape, below the selected

00:18:41.756 --> 00:18:45.486 A:middle
shape, and last of all, dragging

00:18:45.486 --> 00:18:49.776 A:middle
in the shape list at the left.

00:18:49.776 --> 00:18:52.196 A:middle
Now, these sound really simple

00:18:52.746 --> 00:18:56.126 A:middle
until you realize that they all

00:18:56.126 --> 00:18:57.566 A:middle
need to operate on multiple

00:18:57.566 --> 00:18:59.096 A:middle
selected shapes that might not

00:18:59.096 --> 00:19:01.316 A:middle
even be contiguous in the list.

00:18:59.096 --> 00:19:01.316 A:middle
even be contiguous in the list.

00:19:05.226 --> 00:19:06.486 A:middle
So, it turns out that the

00:19:06.486 --> 00:19:07.906 A:middle
behavior that makes sense is to

00:19:07.906 --> 00:19:09.166 A:middle
leave all of the selected

00:19:09.166 --> 00:19:10.826 A:middle
elements next to each other

00:19:10.826 --> 00:19:12.126 A:middle
after the operation is finished.

00:19:13.126 --> 00:19:14.176 A:middle
So, when you're bringing shapes

00:19:14.176 --> 00:19:15.596 A:middle
forward, you hop the front most

00:19:15.596 --> 00:19:17.136 A:middle
selected shape in front of its

00:19:17.136 --> 00:19:18.936 A:middle
neighbor, and then you group all

00:19:18.936 --> 00:19:20.566 A:middle
the other ones behind it.

00:19:22.386 --> 00:19:23.736 A:middle
And when you send shapes

00:19:23.776 --> 00:19:25.496 A:middle
backward, you hop the bottom

00:19:25.496 --> 00:19:26.926 A:middle
most selected shape backward

00:19:26.926 --> 00:19:28.396 A:middle
behind its neighbor and group

00:19:28.396 --> 00:19:30.366 A:middle
the other ones in front of it.

00:19:33.756 --> 00:19:36.256 A:middle
So, if you didn't follow that

00:19:36.256 --> 00:19:37.626 A:middle
completely, don't worry.

00:19:37.626 --> 00:19:38.526 A:middle
We'll come back to it.

00:19:38.856 --> 00:19:41.386 A:middle
But suffice it to say that I had

00:19:41.386 --> 00:19:42.836 A:middle
some pretty carefully worked out

00:19:42.836 --> 00:19:44.356 A:middle
code to get all of these details

00:19:44.356 --> 00:19:44.606 A:middle
right.

00:19:45.866 --> 00:19:47.996 A:middle
For example, this was

00:19:47.996 --> 00:19:51.256 A:middle
bringToFront, and when I looked

00:19:51.256 --> 00:19:53.656 A:middle
at it, sure enough, there was an

00:19:53.656 --> 00:19:55.366 A:middle
order n loop over the shapes

00:19:55.956 --> 00:19:57.716 A:middle
containing two order n

00:19:57.716 --> 00:20:00.186 A:middle
operations, remove(at:) and

00:19:57.716 --> 00:20:00.186 A:middle
operations, remove(at:) and

00:20:00.186 --> 00:20:02.756 A:middle
insert(at:), which makes this,

00:20:03.246 --> 00:20:04.786 A:middle
you guessed it, n squared.

00:20:06.246 --> 00:20:08.526 A:middle
In fact, that same problem

00:20:08.526 --> 00:20:10.076 A:middle
showed up in every one of my

00:20:10.076 --> 00:20:11.076 A:middle
other four commands.

00:20:12.516 --> 00:20:14.046 A:middle
All of the implementations here

00:20:14.386 --> 00:20:16.196 A:middle
loop over an array, performing

00:20:16.196 --> 00:20:17.936 A:middle
insertions and removals, which

00:20:17.936 --> 00:20:19.126 A:middle
means they're all quadratic.

00:20:19.626 --> 00:20:23.096 A:middle
Now, I was kind of discouraged

00:20:23.096 --> 00:20:24.996 A:middle
at this point, so I asked Crusty

00:20:24.996 --> 00:20:26.106 A:middle
if he'd look at them with me.

00:20:27.406 --> 00:20:29.106 A:middle
He said, "Can't stay too late,"

00:20:29.186 --> 00:20:31.156 A:middle
he said, "I got my ballroom

00:20:31.156 --> 00:20:33.096 A:middle
dancing tonight, but I guess we

00:20:33.226 --> 00:20:34.546 A:middle
better get a move on."

00:20:35.306 --> 00:20:37.486 A:middle
So, I pulled up bringToFront,

00:20:38.686 --> 00:20:40.946 A:middle
and Crusty's first question was,

00:20:42.156 --> 00:20:44.546 A:middle
"What does it actually do?"

00:20:45.846 --> 00:20:47.566 A:middle
"Well," I said, "there's a while

00:20:47.566 --> 00:20:49.426 A:middle
loop and j tracks the insertion

00:20:49.426 --> 00:20:51.266 A:middle
point and i tracks the element

00:20:51.266 --> 00:20:51.906 A:middle
we're looking at."

00:20:52.226 --> 00:20:54.216 A:middle
"In words, not in codes," said

00:20:54.246 --> 00:20:54.666 A:middle
Crusty.

00:20:55.706 --> 00:20:57.126 A:middle
"Describe it."

00:20:58.146 --> 00:20:59.286 A:middle
"Okay. Let's see.

00:20:59.776 --> 00:21:01.616 A:middle
It moves the selected shapes to

00:20:59.776 --> 00:21:01.616 A:middle
It moves the selected shapes to

00:21:01.616 --> 00:21:03.406 A:middle
the front, maintaining their

00:21:03.406 --> 00:21:04.176 A:middle
relative order."

00:21:04.706 --> 00:21:07.136 A:middle
"Write that down in a dot

00:21:07.136 --> 00:21:08.376 A:middle
comment and read it back to me."

00:21:10.406 --> 00:21:13.146 A:middle
I'm a superfast typist.

00:21:15.236 --> 00:21:17.416 A:middle
"Moves the selected shapes to

00:21:17.416 --> 00:21:18.496 A:middle
the front, maintaining their

00:21:18.496 --> 00:21:19.286 A:middle
relative order."

00:21:19.706 --> 00:21:21.766 A:middle
"Sound familiar?"

00:21:22.186 --> 00:21:22.796 A:middle
said Crusty.

00:21:24.066 --> 00:21:25.276 A:middle
That's when I realized that this

00:21:25.276 --> 00:21:26.736 A:middle
was a lot like half stable

00:21:26.766 --> 00:21:29.286 A:middle
partition, except it's fully

00:21:29.286 --> 00:21:29.676 A:middle
stable.

00:21:29.676 --> 00:21:32.046 A:middle
I was starting to get excited.

00:21:32.556 --> 00:21:33.776 A:middle
And what do you think this one

00:21:33.776 --> 00:21:34.226 A:middle
is called?

00:21:34.906 --> 00:21:36.516 A:middle
So, I had to guess, "Stable

00:21:36.516 --> 00:21:37.026 A:middle
partition?"

00:21:37.566 --> 00:21:38.346 A:middle
"That's right.

00:21:38.536 --> 00:21:41.126 A:middle
One of my old favorites, and you

00:21:41.126 --> 00:21:42.426 A:middle
can find an implementation in

00:21:42.426 --> 00:21:43.946 A:middle
this here file from the Swift

00:21:43.946 --> 00:21:45.486 A:middle
Open Source project."

00:21:46.356 --> 00:21:48.396 A:middle
So, I pulled the file into my

00:21:48.396 --> 00:21:50.006 A:middle
project, while Crusty mumbled

00:21:50.006 --> 00:21:51.266 A:middle
something about how that comment

00:21:51.266 --> 00:21:52.206 A:middle
we added should have been there

00:21:52.206 --> 00:21:55.756 A:middle
all along, and I started coding,

00:21:56.936 --> 00:21:59.526 A:middle
getting about this far before I

00:21:59.526 --> 00:22:00.196 A:middle
had a problem.

00:21:59.526 --> 00:22:00.196 A:middle
had a problem.

00:22:01.666 --> 00:22:03.716 A:middle
You see, stable partition takes

00:22:03.716 --> 00:22:06.306 A:middle
a predicate that says whether to

00:22:06.306 --> 00:22:07.966 A:middle
move an element into the suffix

00:22:08.416 --> 00:22:09.126 A:middle
of the collection.

00:22:09.946 --> 00:22:11.326 A:middle
So, I had to express bring to

00:22:11.516 --> 00:22:13.496 A:middle
front in terms of moving things

00:22:13.496 --> 00:22:14.046 A:middle
to the back.

00:22:15.406 --> 00:22:16.256 A:middle
I looked at Crusty.

00:22:17.276 --> 00:22:19.286 A:middle
"Visualize it," he said.

00:22:20.286 --> 00:22:21.986 A:middle
So, I closed my eyes and watched

00:22:22.646 --> 00:22:24.176 A:middle
as the unselected shapes

00:22:24.176 --> 00:22:25.936 A:middle
gathered at the back, which gave

00:22:25.936 --> 00:22:26.616 A:middle
me my answer.

00:22:27.226 --> 00:22:31.096 A:middle
Now, I guess sendToBack was even

00:22:31.096 --> 00:22:32.436 A:middle
easier because we just need to

00:22:32.436 --> 00:22:33.276 A:middle
invert the predicate.

00:22:33.836 --> 00:22:34.996 A:middle
We're sending the selected ones

00:22:35.056 --> 00:22:38.126 A:middle
to the back.

00:22:38.346 --> 00:22:40.566 A:middle
Now, I was just about to attack

00:22:40.566 --> 00:22:42.476 A:middle
the bring forward command, and I

00:22:42.476 --> 00:22:43.986 A:middle
figured that Crusty would be as

00:22:43.986 --> 00:22:46.346 A:middle
eager to move on as I was, given

00:22:46.346 --> 00:22:47.436 A:middle
his plans for the evening, but

00:22:47.756 --> 00:22:48.376 A:middle
he stopped me.

00:22:49.296 --> 00:22:50.446 A:middle
"Hold your horses, Snuffy.

00:22:51.616 --> 00:22:52.856 A:middle
I don't want to miss the opening

00:22:52.856 --> 00:22:54.676 A:middle
tango, but aren't you going to

00:22:54.676 --> 00:22:55.926 A:middle
check whether it'll scale?"

00:22:57.326 --> 00:22:59.776 A:middle
He had a point, so I popped up

00:22:59.776 --> 00:23:00.766 A:middle
the Quick Help for stable

00:22:59.776 --> 00:23:00.766 A:middle
the Quick Help for stable

00:23:00.806 --> 00:23:04.196 A:middle
partition, and I saw that it had

00:23:04.416 --> 00:23:06.046 A:middle
(n log n) complexity.

00:23:06.606 --> 00:23:09.356 A:middle
So, for a way to think about (n

00:23:09.356 --> 00:23:11.506 A:middle
log n) take a look at log n.

00:23:12.096 --> 00:23:15.236 A:middle
It starts to level off really

00:23:15.236 --> 00:23:17.246 A:middle
quickly, and the bigger it gets,

00:23:17.496 --> 00:23:19.856 A:middle
the slower it grows, and the

00:23:19.886 --> 00:23:21.246 A:middle
closer it comes to being a

00:23:21.246 --> 00:23:21.716 A:middle
constant.

00:23:22.526 --> 00:23:24.136 A:middle
So, when you multiply that by n,

00:23:24.136 --> 00:23:27.366 A:middle
you get something that doesn't

00:23:27.566 --> 00:23:29.376 A:middle
scale quite as well as order n

00:23:29.876 --> 00:23:31.466 A:middle
but that gets closer and closer

00:23:31.466 --> 00:23:32.946 A:middle
to linear as it grows.

00:23:34.146 --> 00:23:36.696 A:middle
So, order n login is rightly

00:23:36.696 --> 00:23:38.556 A:middle
often treated as being almost

00:23:38.556 --> 00:23:40.066 A:middle
the same as order n.

00:23:40.896 --> 00:23:42.296 A:middle
I was pretty happy with that.

00:23:43.056 --> 00:23:44.326 A:middle
So, we moved on to bring

00:23:44.326 --> 00:23:44.696 A:middle
forward.

00:23:45.246 --> 00:23:49.646 A:middle
Now, as we said earlier, bring

00:23:49.726 --> 00:23:51.626 A:middle
forward bumps the front most

00:23:51.626 --> 00:23:53.006 A:middle
selected shape forward by one

00:23:53.006 --> 00:23:55.296 A:middle
position and gathers the other

00:23:55.296 --> 00:23:56.576 A:middle
selected shapes behind it.

00:23:57.876 --> 00:24:00.156 A:middle
But Crusty didn't like that way

00:23:57.876 --> 00:24:00.156 A:middle
But Crusty didn't like that way

00:24:00.156 --> 00:24:01.506 A:middle
of thinking about it at all.

00:24:02.146 --> 00:24:03.396 A:middle
"That little do-si-do at the

00:24:03.396 --> 00:24:05.026 A:middle
beginning is making a line dance

00:24:05.026 --> 00:24:06.096 A:middle
look like a Fox Trot."

00:24:06.356 --> 00:24:08.466 A:middle
he said, "You don't need it."

00:24:09.096 --> 00:24:10.906 A:middle
When I looked at him blankly, he

00:24:10.906 --> 00:24:12.206 A:middle
broke out the lozenges again,

00:24:13.976 --> 00:24:15.616 A:middle
and with five of his free

00:24:15.616 --> 00:24:17.836 A:middle
digits, he executed the

00:24:17.836 --> 00:24:19.926 A:middle
bringForward command.

00:24:22.556 --> 00:24:23.506 A:middle
"See it again?"

00:24:23.776 --> 00:24:24.226 A:middle
he asked.

00:24:25.416 --> 00:24:26.816 A:middle
I felt a little like a mark in a

00:24:26.816 --> 00:24:29.666 A:middle
Three-card Monte, but I played

00:24:33.826 --> 00:24:33.976 A:middle
along.

00:24:34.256 --> 00:24:35.176 A:middle
"Look familiar?"

00:24:36.336 --> 00:24:36.616 A:middle
"No."

00:24:37.826 --> 00:24:39.296 A:middle
He threw a hanky over the first

00:24:39.876 --> 00:24:40.006 A:middle
few.

00:24:42.296 --> 00:24:46.366 A:middle
"How about now?"

00:24:46.636 --> 00:24:48.876 A:middle
That's when I realized it was

00:24:48.876 --> 00:24:50.226 A:middle
just another stable partition.

00:24:51.416 --> 00:24:51.766 A:middle
Okay.

00:24:52.236 --> 00:24:54.046 A:middle
I got this, I thought.

00:24:55.856 --> 00:24:58.096 A:middle
If we find the front most

00:24:58.096 --> 00:25:01.716 A:middle
selected shape, then move to its

00:24:58.096 --> 00:25:01.716 A:middle
selected shape, then move to its

00:25:01.746 --> 00:25:05.326 A:middle
predecessor, and isolate the

00:25:05.606 --> 00:25:07.086 A:middle
section of the array that starts

00:25:07.086 --> 00:25:09.716 A:middle
there, we could just partition

00:25:10.556 --> 00:25:10.666 A:middle
that.

00:25:12.236 --> 00:25:14.166 A:middle
"But how do you modify just part

00:25:14.166 --> 00:25:14.776 A:middle
of a collection?"

00:25:14.976 --> 00:25:15.676 A:middle
I asked Crusty.

00:25:16.876 --> 00:25:17.746 A:middle
"Ain't you never heard of a

00:25:17.746 --> 00:25:18.296 A:middle
slice?"

00:25:18.526 --> 00:25:19.516 A:middle
he said, taking over the

00:25:19.516 --> 00:25:19.946 A:middle
keyboard.

00:25:23.156 --> 00:25:25.106 A:middle
"Shapes, starting with

00:25:25.726 --> 00:25:26.336 A:middle
predecessor.

00:25:27.656 --> 00:25:28.256 A:middle
There.

00:25:28.256 --> 00:25:29.596 A:middle
Stick that in your algorithm and

00:25:29.596 --> 00:25:30.146 A:middle
mutate it."

00:25:30.896 --> 00:25:32.000 A:middle
Which I promptly did.

00:25:37.716 --> 00:25:41.456 A:middle
So, human knowledge about how to

00:25:41.456 --> 00:25:43.096 A:middle
compute things correctly and

00:25:43.096 --> 00:25:44.976 A:middle
efficiently predates computers

00:25:44.976 --> 00:25:47.156 A:middle
by thousands of years, going

00:25:47.156 --> 00:25:48.846 A:middle
back at least to ancient Egypt,

00:25:49.546 --> 00:25:50.656 A:middle
and since the invention of

00:25:50.656 --> 00:25:52.086 A:middle
computers, there's been an

00:25:52.086 --> 00:25:53.696 A:middle
explosion of work in this area.

00:25:55.186 --> 00:25:56.586 A:middle
If the standard library doesn't

00:25:56.586 --> 00:25:58.386 A:middle
have what you need, what you do

00:25:58.386 --> 00:26:00.556 A:middle
need is probably out there with

00:25:58.386 --> 00:26:00.556 A:middle
need is probably out there with

00:26:00.556 --> 00:26:03.396 A:middle
tests, with documentation, often

00:26:03.396 --> 00:26:04.786 A:middle
with a proof of correctness.

00:26:05.746 --> 00:26:07.436 A:middle
Learn how to search the web for

00:26:07.436 --> 00:26:08.746 A:middle
research that applies to your

00:26:08.746 --> 00:26:10.086 A:middle
problem domain.

00:26:12.716 --> 00:26:12.946 A:middle
Okay.

00:26:12.946 --> 00:26:13.596 A:middle
Back to the code.

00:26:14.076 --> 00:26:15.656 A:middle
I was intrigued by this slice

00:26:15.706 --> 00:26:17.136 A:middle
thing, and when I checked out

00:26:17.136 --> 00:26:19.596 A:middle
its type, I saw that it wasn't

00:26:19.596 --> 00:26:20.156 A:middle
an array.

00:26:20.716 --> 00:26:23.306 A:middle
Since we had used stable

00:26:23.306 --> 00:26:24.876 A:middle
partition on an array and

00:26:24.876 --> 00:26:27.216 A:middle
bringToFront and sendToBack, and

00:26:27.216 --> 00:26:28.776 A:middle
now we were using it on an array

00:26:28.776 --> 00:26:30.876 A:middle
slice, I guessed out loud that

00:26:30.876 --> 00:26:32.496 A:middle
it must be generic.

00:26:32.496 --> 00:26:34.636 A:middle
"Of course, it is.

00:26:35.176 --> 00:26:36.446 A:middle
What's stable partition got to

00:26:36.446 --> 00:26:37.846 A:middle
do with the specifics of array?"

00:26:39.166 --> 00:26:40.436 A:middle
"That's right, nothing.

00:26:41.336 --> 00:26:44.046 A:middle
Speaking of which, Blonkey, just

00:26:44.046 --> 00:26:45.416 A:middle
what does bringForward have to

00:26:45.416 --> 00:26:46.946 A:middle
do with shapes and selection?"

00:26:48.616 --> 00:26:51.166 A:middle
"Well," I said, "it works on

00:26:51.166 --> 00:26:52.876 A:middle
shapes, and it brings forward

00:26:52.876 --> 00:26:53.796 A:middle
the selected ones."

00:26:54.046 --> 00:26:55.936 A:middle
"That's right, nothing," he went

00:26:55.936 --> 00:26:56.736 A:middle
on without listening.

00:26:58.636 --> 00:27:00.006 A:middle
"Can you run bring forward on a

00:26:58.636 --> 00:27:00.006 A:middle
"Can you run bring forward on a

00:27:00.006 --> 00:27:00.926 A:middle
row of lozenges?

00:27:01.926 --> 00:27:03.106 A:middle
Of course, you can.

00:27:04.086 --> 00:27:05.516 A:middle
So, it's got nothing to do with

00:27:06.206 --> 00:27:06.500 A:middle
shapes."

00:27:08.206 --> 00:27:08.446 A:middle
Hmm.

00:27:08.896 --> 00:27:10.916 A:middle
"Are you suggesting we make it

00:27:10.916 --> 00:27:11.376 A:middle
generic?"

00:27:11.556 --> 00:27:12.056 A:middle
I asked.

00:27:12.676 --> 00:27:13.626 A:middle
"Isn't that premature

00:27:13.626 --> 00:27:14.426 A:middle
generalization?"

00:27:15.416 --> 00:27:16.546 A:middle
Answering a question with a

00:27:16.546 --> 00:27:20.866 A:middle
question, Crusty replied, "Well,

00:27:20.866 --> 00:27:22.416 A:middle
just how do you plan to test

00:27:22.416 --> 00:27:23.330 A:middle
this method?"

00:27:24.946 --> 00:27:26.736 A:middle
"Okay," I said, "I'll create a

00:27:26.736 --> 00:27:27.376 A:middle
canvas.

00:27:27.616 --> 00:27:28.726 A:middle
I'll add a bunch of random

00:27:28.726 --> 00:27:29.186 A:middle
shapes.

00:27:29.186 --> 00:27:30.886 A:middle
I'll select some of them, and

00:27:30.886 --> 00:27:31.676 A:middle
then finally..."

00:27:32.466 --> 00:27:33.776 A:middle
But I didn't even finish the

00:27:33.776 --> 00:27:35.506 A:middle
sentence because I knew it was a

00:27:35.506 --> 00:27:36.216 A:middle
bad idea.

00:27:37.076 --> 00:27:39.126 A:middle
If I did all of that, would I

00:27:39.126 --> 00:27:40.456 A:middle
really be testing my function,

00:27:40.966 --> 00:27:42.066 A:middle
or would I be testing the

00:27:42.066 --> 00:27:43.646 A:middle
initializers of Canvas and

00:27:43.646 --> 00:27:45.606 A:middle
various shapes, the addShape

00:27:45.606 --> 00:27:47.776 A:middle
method, the isSelected property

00:27:47.976 --> 00:27:49.136 A:middle
of the various shapes if it's

00:27:49.136 --> 00:27:49.706 A:middle
computed?

00:27:50.106 --> 00:27:52.356 A:middle
I have to build test cases for

00:27:52.356 --> 00:27:54.506 A:middle
sure, but ideally, that code

00:27:54.736 --> 00:27:56.266 A:middle
shouldn't depend on other code

00:27:56.266 --> 00:27:57.826 A:middle
that I also have to test.

00:27:59.126 --> 00:28:00.506 A:middle
If I can bring the lozenges

00:27:59.126 --> 00:28:00.506 A:middle
If I can bring the lozenges

00:28:00.506 --> 00:28:02.776 A:middle
forward, it should be possible

00:28:02.776 --> 00:28:04.406 A:middle
to do something casual with

00:28:04.866 --> 00:28:05.636 A:middle
[inaudible] in a playground,

00:28:05.986 --> 00:28:08.226 A:middle
like this, which brings forward

00:28:08.226 --> 00:28:09.796 A:middle
the number divisible by 3.

00:28:13.276 --> 00:28:14.596 A:middle
Now, at the other end of the

00:28:14.596 --> 00:28:16.296 A:middle
spectrum, I should be able to

00:28:16.296 --> 00:28:18.116 A:middle
throw vast quantities of

00:28:18.116 --> 00:28:19.856 A:middle
randomly generated test data at

00:28:19.856 --> 00:28:21.256 A:middle
it and make sure that the

00:28:21.256 --> 00:28:22.386 A:middle
algorithm scales.

00:28:23.246 --> 00:28:24.696 A:middle
Neither of those was going to be

00:28:24.696 --> 00:28:26.076 A:middle
easy as long as the code was

00:28:26.116 --> 00:28:27.906 A:middle
tied to Canvas and shapes.

00:28:29.146 --> 00:28:31.506 A:middle
And so, I admitted to Crusty

00:28:32.296 --> 00:28:33.546 A:middle
that he was right and started

00:28:33.546 --> 00:28:34.846 A:middle
making this non-generic

00:28:35.616 --> 00:28:37.106 A:middle
bringForward into a generic one.

00:28:38.436 --> 00:28:40.666 A:middle
The first step was to decouple

00:28:40.666 --> 00:28:44.896 A:middle
it from Canvas and move it to

00:28:44.896 --> 00:28:45.696 A:middle
arrays of shapes.

00:28:47.216 --> 00:28:49.266 A:middle
Of course, this array is the

00:28:49.266 --> 00:28:50.556 A:middle
shape, so I had to replace

00:28:50.556 --> 00:28:54.366 A:middle
shapes with self, and then I

00:28:54.366 --> 00:28:56.866 A:middle
decoupled it from selection by

00:28:56.866 --> 00:28:58.636 A:middle
passing a predicate indicating

00:28:58.736 --> 00:29:00.046 A:middle
whether a given shape should be

00:28:58.736 --> 00:29:00.046 A:middle
whether a given shape should be

00:29:00.046 --> 00:29:00.866 A:middle
brought forward.

00:29:04.716 --> 00:29:06.156 A:middle
And everything kept compiling.

00:29:07.036 --> 00:29:07.386 A:middle
Awesome!

00:29:08.266 --> 00:29:10.826 A:middle
At that point, I was pleased to

00:29:10.826 --> 00:29:12.086 A:middle
find there were no dependencies

00:29:12.086 --> 00:29:14.266 A:middle
left on shape, and I could just

00:29:14.426 --> 00:29:15.406 A:middle
delete the where clause.

00:29:15.956 --> 00:29:18.106 A:middle
Pretty cool, I thought.

00:29:18.106 --> 00:29:20.106 A:middle
Now, I can bring forward on any

00:29:20.106 --> 00:29:20.506 A:middle
array.

00:29:21.636 --> 00:29:23.386 A:middle
I looked over at Crusty, who had

00:29:23.386 --> 00:29:24.636 A:middle
been quietly practicing the

00:29:24.676 --> 00:29:26.876 A:middle
cha-cha-cha in the corner, but

00:29:26.876 --> 00:29:28.586 A:middle
he didn't seem to think I was

00:29:29.736 --> 00:29:30.000 A:middle
finished.

00:29:31.316 --> 00:29:32.996 A:middle
"What does bring forward have to

00:29:32.996 --> 00:29:34.026 A:middle
do with arrays?"

00:29:34.916 --> 00:29:37.196 A:middle
he asked.

00:29:37.436 --> 00:29:38.976 A:middle
"Well, nothing," I sighed and

00:29:38.976 --> 00:29:40.046 A:middle
started thinking about how to

00:29:40.046 --> 00:29:41.206 A:middle
remove this dependency.

00:29:42.656 --> 00:29:43.706 A:middle
Let's see, there's a stable

00:29:43.706 --> 00:29:46.066 A:middle
partition here, which requires

00:29:46.066 --> 00:29:47.636 A:middle
mutable collection conformance.

00:29:48.186 --> 00:29:49.416 A:middle
So, maybe I'll just move it to

00:29:49.416 --> 00:29:52.676 A:middle
mutable collection.

00:29:53.006 --> 00:29:53.466 A:middle
Hmm.

00:29:53.896 --> 00:29:56.076 A:middle
I thought, clearly the index

00:29:56.116 --> 00:29:58.536 A:middle
type doesn't match Int.

00:29:59.456 --> 00:29:59.746 A:middle
Okay.

00:29:59.746 --> 00:30:00.826 A:middle
So, there's a simple fix for

00:29:59.746 --> 00:30:00.826 A:middle
So, there's a simple fix for

00:30:00.826 --> 00:30:01.000 A:middle
this, right?

00:30:04.216 --> 00:30:04.936 A:middle
Have you done this?

00:30:06.176 --> 00:30:08.106 A:middle
Don't do this.

00:30:09.546 --> 00:30:11.326 A:middle
It compiled, but Crusty had

00:30:11.326 --> 00:30:12.586 A:middle
suddenly stopped dancing, and I

00:30:12.586 --> 00:30:15.156 A:middle
knew something was wrong.

00:30:15.366 --> 00:30:16.166 A:middle
"What?" I said.

00:30:16.966 --> 00:30:18.836 A:middle
"Rookies always do that," said

00:30:18.836 --> 00:30:20.036 A:middle
Crusty, shaking his head.

00:30:21.566 --> 00:30:23.216 A:middle
"First, you got that comparison

00:30:23.216 --> 00:30:24.736 A:middle
with 0, which is going to be

00:30:24.736 --> 00:30:26.056 A:middle
wrong for array slice.

00:30:26.686 --> 00:30:29.456 A:middle
So, did you know that array

00:30:29.456 --> 00:30:31.596 A:middle
slices, their indices don't

00:30:31.596 --> 00:30:32.216 A:middle
start at 0?

00:30:32.216 --> 00:30:35.696 A:middle
The indices of all slices start

00:30:35.966 --> 00:30:37.506 A:middle
with the corresponding index in

00:30:37.506 --> 00:30:38.786 A:middle
the underlying collection that

00:30:38.786 --> 00:30:40.246 A:middle
they were sliced from.

00:30:40.796 --> 00:30:42.976 A:middle
That relationship is critical if

00:30:42.976 --> 00:30:44.126 A:middle
you want to be able to compose

00:30:44.126 --> 00:30:46.466 A:middle
generic algorithms using slices,

00:30:47.056 --> 00:30:47.946 A:middle
so it's really important."

00:30:49.156 --> 00:30:51.946 A:middle
Well, this problem, I knew to

00:30:51.946 --> 00:30:52.406 A:middle
fix.

00:30:53.146 --> 00:30:54.126 A:middle
Just compare it with start

00:30:54.126 --> 00:30:54.516 A:middle
index.

00:30:55.766 --> 00:30:58.346 A:middle
But the real problem is "What

00:30:58.346 --> 00:31:00.056 A:middle
does bringForward have to do

00:30:58.346 --> 00:31:00.056 A:middle
does bringForward have to do

00:31:00.056 --> 00:31:01.846 A:middle
with having integer indices?"

00:31:01.846 --> 00:31:02.576 A:middle
I interrupted.

00:31:03.416 --> 00:31:04.416 A:middle
"Yeah, I know."

00:31:05.266 --> 00:31:07.466 A:middle
"Well, I do have to get the

00:31:07.466 --> 00:31:10.156 A:middle
index before i, which I can do

00:31:10.156 --> 00:31:10.876 A:middle
with subtraction."

00:31:12.856 --> 00:31:14.976 A:middle
Crusty just sighed and broke out

00:31:14.976 --> 00:31:15.906 A:middle
the lozenges again.

00:31:17.466 --> 00:31:19.376 A:middle
And then, he laid two fingers

00:31:19.376 --> 00:31:22.156 A:middle
down on the desk and walked them

00:31:22.566 --> 00:31:24.966 A:middle
across until his right hand was

00:31:25.136 --> 00:31:26.706 A:middle
pointing at the first green

00:31:26.706 --> 00:31:27.276 A:middle
lozenge.

00:31:27.806 --> 00:31:31.446 A:middle
"Not a backwards step in the

00:31:31.446 --> 00:31:32.506 A:middle
whole dance," he said.

00:31:33.406 --> 00:31:35.286 A:middle
And I realized that Crusty had

00:31:35.286 --> 00:31:37.586 A:middle
just shown me a new algorithm.

00:31:38.636 --> 00:31:39.546 A:middle
Let's call that one

00:31:39.696 --> 00:31:40.986 A:middle
indexBeforeFirst.

00:31:42.066 --> 00:31:43.776 A:middle
"Now, the trick here is to keep

00:31:43.776 --> 00:31:46.086 A:middle
your focus by assuming somebody

00:31:46.086 --> 00:31:46.976 A:middle
already wrote it for you."

00:31:47.826 --> 00:31:49.116 A:middle
And he proceeded to hack away

00:31:49.116 --> 00:31:50.336 A:middle
all the code that we didn't

00:31:50.336 --> 00:31:53.906 A:middle
need, like that and that.

00:31:56.616 --> 00:32:00.866 A:middle
"Predecessor is the index before

00:31:56.616 --> 00:32:00.866 A:middle
"Predecessor is the index before

00:32:00.866 --> 00:32:02.416 A:middle
the first one where the

00:32:02.416 --> 00:32:04.286 A:middle
predicate is satisfied.

00:32:05.346 --> 00:32:06.656 A:middle
Now, just look how pretty that

00:32:06.656 --> 00:32:07.046 A:middle
reads."

00:32:08.486 --> 00:32:10.946 A:middle
Now, if you look at it, you can

00:32:10.946 --> 00:32:11.706 A:middle
see that he's right.

00:32:13.116 --> 00:32:15.006 A:middle
Taking away all the irrelevant

00:32:15.006 --> 00:32:17.436 A:middle
detail about shapes, selections,

00:32:17.546 --> 00:32:20.066 A:middle
arrays, and integers had left me

00:32:20.066 --> 00:32:22.006 A:middle
with clearer code because it

00:32:22.006 --> 00:32:23.626 A:middle
only traffics in the essentials

00:32:23.696 --> 00:32:24.356 A:middle
of the problem.

00:32:24.926 --> 00:32:27.496 A:middle
"I already showed you how

00:32:27.496 --> 00:32:28.956 A:middle
indexBeforeFirst works.

00:32:29.266 --> 00:32:31.986 A:middle
See if you could write it," he

00:32:31.986 --> 00:32:32.236 A:middle
said.

00:32:32.706 --> 00:32:34.036 A:middle
So, I think I was starting to

00:32:34.036 --> 00:32:36.016 A:middle
catch on now because I got it

00:32:36.016 --> 00:32:37.036 A:middle
right the first time.

00:32:37.666 --> 00:32:40.646 A:middle
I told you, I'm a superfast

00:32:40.646 --> 00:32:40.996 A:middle
typist.

00:32:41.466 --> 00:32:41.726 A:middle
All right.

00:32:42.236 --> 00:32:45.436 A:middle
So, return the first index whose

00:32:45.436 --> 00:32:48.536 A:middle
successor matches the predicate.

00:32:49.206 --> 00:32:51.556 A:middle
I was pretty excited about how

00:32:51.556 --> 00:32:52.396 A:middle
well this was going.

00:32:53.436 --> 00:32:54.456 A:middle
"All right, Crusty," I said,

00:32:54.766 --> 00:32:55.726 A:middle
"let's do the next one."

00:32:57.516 --> 00:32:58.946 A:middle
"Ain't you forgetting something,

00:32:58.946 --> 00:32:59.296 A:middle
Bonkey?"

00:33:00.116 --> 00:33:00.586 A:middle
he asked.

00:33:00.586 --> 00:33:02.306 A:middle
I didn't know what he was

00:33:02.306 --> 00:33:02.906 A:middle
talking about.

00:33:03.466 --> 00:33:05.276 A:middle
The code was clean, and it

00:33:05.276 --> 00:33:05.666 A:middle
worked.

00:33:07.016 --> 00:33:08.336 A:middle
"Semantics, son.

00:33:09.046 --> 00:33:10.216 A:middle
How am I supposed to use these

00:33:10.216 --> 00:33:11.416 A:middle
from other code if I don't know

00:33:11.416 --> 00:33:12.156 A:middle
what they mean?"

00:33:12.786 --> 00:33:17.156 A:middle
And that's when I realized every

00:33:17.156 --> 00:33:18.926 A:middle
time we'd use the new algorithm,

00:33:19.446 --> 00:33:20.326 A:middle
we had leaned on his

00:33:20.326 --> 00:33:21.936 A:middle
documentation to draw

00:33:21.936 --> 00:33:23.416 A:middle
conclusions about the meaning

00:33:23.726 --> 00:33:25.296 A:middle
and efficiency of our own code.

00:33:26.346 --> 00:33:27.846 A:middle
And because most algorithms are

00:33:27.846 --> 00:33:29.456 A:middle
built out of other algorithms,

00:33:29.896 --> 00:33:32.816 A:middle
they lean on the same thing.

00:33:33.026 --> 00:33:34.826 A:middle
Recently, I was interviewing a

00:33:34.826 --> 00:33:36.486 A:middle
perspective intern and asked him

00:33:36.486 --> 00:33:38.236 A:middle
about the role of documentation,

00:33:38.636 --> 00:33:40.226 A:middle
and he began with a phrase I

00:33:40.226 --> 00:33:41.156 A:middle
won't forget.

00:33:41.966 --> 00:33:43.306 A:middle
"Oh, it's incredibly important,"

00:33:43.776 --> 00:33:44.206 A:middle
he said.

00:33:45.646 --> 00:33:46.816 A:middle
"We're building these towers of

00:33:46.816 --> 00:33:48.996 A:middle
abstraction," and now I'm

00:33:48.996 --> 00:33:50.946 A:middle
paraphrasing, "the reason we can

00:33:50.946 --> 00:33:52.286 A:middle
build without constantly

00:33:52.286 --> 00:33:54.086 A:middle
inspecting the layers below us

00:33:54.706 --> 00:33:56.036 A:middle
is that the parts that we build

00:33:56.036 --> 00:33:57.176 A:middle
on are documented."

00:33:57.666 --> 00:34:01.966 A:middle
Now, as an app developer, you

00:33:57.666 --> 00:34:01.966 A:middle
Now, as an app developer, you

00:34:02.176 --> 00:34:03.746 A:middle
are working at the very top of a

00:34:03.746 --> 00:34:05.356 A:middle
tower that stretches through

00:34:05.356 --> 00:34:07.966 A:middle
your system frameworks, DOS, and

00:34:07.966 --> 00:34:09.556 A:middle
into the hardware, which rests

00:34:10.146 --> 00:34:11.216 A:middle
on the laws of physics.

00:34:12.815 --> 00:34:14.096 A:middle
But as soon as you call one of

00:34:14.096 --> 00:34:15.936 A:middle
your own methods, it becomes

00:34:15.936 --> 00:34:18.146 A:middle
part of your foundation; so,

00:34:18.146 --> 00:34:19.666 A:middle
document your code.

00:34:20.235 --> 00:34:21.565 A:middle
The intern was hired, by the

00:34:21.565 --> 00:34:23.946 A:middle
way, and he's sitting right

00:34:26.295 --> 00:34:26.406 A:middle
there.

00:34:26.616 --> 00:34:28.896 A:middle
So, I took the hint and

00:34:28.896 --> 00:34:29.936 A:middle
documented Crusty's new

00:34:29.936 --> 00:34:32.956 A:middle
algorithm, which meant that we

00:34:32.956 --> 00:34:33.716 A:middle
could forget about the

00:34:33.716 --> 00:34:36.956 A:middle
implementation and just use it,

00:34:37.206 --> 00:34:38.306 A:middle
knowing that Quick Help had

00:34:38.306 --> 00:34:39.416 A:middle
everything that we needed.

00:34:41.246 --> 00:34:42.856 A:middle
Now, I also documented

00:34:42.856 --> 00:34:43.496 A:middle
bringForward.

00:34:45.956 --> 00:34:46.565 A:middle
Cool!

00:34:48.136 --> 00:34:49.456 A:middle
Now, because it seemed to be

00:34:49.456 --> 00:34:51.626 A:middle
solving all of my problems, at

00:34:51.626 --> 00:34:53.496 A:middle
this point, I was really curious

00:34:53.496 --> 00:34:55.786 A:middle
to see what was going on inside

00:34:55.786 --> 00:34:56.596 A:middle
stablePartition.

00:34:57.806 --> 00:34:59.456 A:middle
It turns out I was well rewarded

00:34:59.526 --> 00:35:01.416 A:middle
because it's a really beautiful

00:34:59.526 --> 00:35:01.416 A:middle
because it's a really beautiful

00:35:01.416 --> 00:35:02.486 A:middle
and instructive algorithm.

00:35:03.766 --> 00:35:05.196 A:middle
The public method gets the

00:35:05.196 --> 00:35:06.846 A:middle
collections count and passes it

00:35:06.846 --> 00:35:10.506 A:middle
on to this helper, which uses a

00:35:10.506 --> 00:35:11.776 A:middle
divide and conquer strategy.

00:35:13.056 --> 00:35:15.136 A:middle
So, first, it takes care of the

00:35:15.136 --> 00:35:17.276 A:middle
base cases when the count is

00:35:17.276 --> 00:35:18.436 A:middle
less than 2, we're done.

00:35:18.966 --> 00:35:19.916 A:middle
We just need to figure out

00:35:20.396 --> 00:35:21.656 A:middle
whether the partition point is

00:35:21.656 --> 00:35:23.046 A:middle
at the beginning or at the end

00:35:23.046 --> 00:35:26.016 A:middle
of the collection.

00:35:26.116 --> 00:35:28.496 A:middle
Next, we divide the collection

00:35:28.546 --> 00:35:29.416 A:middle
in two.

00:35:31.136 --> 00:35:33.696 A:middle
Now, at this point, you have to

00:35:33.746 --> 00:35:35.136 A:middle
temporarily take it on faith

00:35:35.136 --> 00:35:37.146 A:middle
that the algorithm works because

00:35:37.146 --> 00:35:38.346 A:middle
we're going to stable partition

00:35:38.346 --> 00:35:41.056 A:middle
the left half and the right

00:35:41.056 --> 00:35:41.446 A:middle
half.

00:35:42.136 --> 00:35:46.766 A:middle
Now, if you take a look at these

00:35:46.766 --> 00:35:49.166 A:middle
two ends, you can see that

00:35:49.166 --> 00:35:50.746 A:middle
everything is exactly in the

00:35:50.746 --> 00:35:54.556 A:middle
right place, but this center

00:35:54.556 --> 00:35:56.516 A:middle
section has two parts that need

00:35:56.516 --> 00:35:57.316 A:middle
to be exchanged.

00:35:58.806 --> 00:36:01.016 A:middle
Now, they won't always have the

00:35:58.806 --> 00:36:01.016 A:middle
Now, they won't always have the

00:36:01.016 --> 00:36:03.126 A:middle
same length as they do in this

00:36:03.126 --> 00:36:06.716 A:middle
example, and fortunately there's

00:36:06.716 --> 00:36:07.986 A:middle
an algorithm for that.

00:36:08.906 --> 00:36:10.636 A:middle
We call it rotate.

00:36:11.176 --> 00:36:11.276 A:middle
Okay.

00:36:14.466 --> 00:36:16.496 A:middle
I'm not going to go into rotate

00:36:16.496 --> 00:36:18.226 A:middle
here, but it's actually quite

00:36:18.256 --> 00:36:19.156 A:middle
beautiful, and if you're

00:36:19.156 --> 00:36:20.686 A:middle
interested, you can find its

00:36:20.686 --> 00:36:22.446 A:middle
implementation in the same file

00:36:22.446 --> 00:36:23.436 A:middle
as stable partitions.

00:36:24.116 --> 00:36:24.216 A:middle
Okay.

00:36:25.596 --> 00:36:27.146 A:middle
Back to shapes.

00:36:28.186 --> 00:36:32.486 A:middle
Now, this mess implemented the

00:36:32.696 --> 00:36:34.706 A:middle
dragging in the shapes list, and

00:36:34.706 --> 00:36:36.626 A:middle
it had always been one of my

00:36:36.626 --> 00:36:38.706 A:middle
most complicated and buggy

00:36:38.706 --> 00:36:39.326 A:middle
operations.

00:36:40.336 --> 00:36:41.616 A:middle
The strategy had been to

00:36:41.616 --> 00:36:43.246 A:middle
allocate the temporary buffer;

00:36:44.536 --> 00:36:46.486 A:middle
then, loop over the shapes

00:36:47.076 --> 00:36:48.506 A:middle
before the insertion point,

00:36:48.736 --> 00:36:50.196 A:middle
extracting the selected ones and

00:36:50.196 --> 00:36:51.576 A:middle
adjusting the insertion point,

00:36:52.526 --> 00:36:54.086 A:middle
and then separately loop over

00:36:54.086 --> 00:36:55.896 A:middle
the rest of the shapes without

00:36:55.896 --> 00:36:57.236 A:middle
adjusting the insertion point,

00:36:57.236 --> 00:36:58.596 A:middle
extracting the selected ones.

00:36:59.126 --> 00:37:02.716 A:middle
And then, finally, reinsert

00:36:59.126 --> 00:37:02.716 A:middle
And then, finally, reinsert

00:37:02.716 --> 00:37:02.916 A:middle
them.

00:37:06.536 --> 00:37:08.806 A:middle
Honestly, I was a little scared

00:37:08.806 --> 00:37:10.726 A:middle
to touch the code because I

00:37:10.726 --> 00:37:12.156 A:middle
thought I finally had it right.

00:37:12.156 --> 00:37:14.276 A:middle
It had been almost a week since

00:37:14.276 --> 00:37:15.536 A:middle
the last time I discovered a new

00:37:15.536 --> 00:37:16.056 A:middle
bug.

00:37:16.526 --> 00:37:21.026 A:middle
But I had gotten pretty good at

00:37:21.026 --> 00:37:22.726 A:middle
this process now, so I tried

00:37:23.286 --> 00:37:24.766 A:middle
visualizing the operation

00:37:24.766 --> 00:37:28.976 A:middle
happening all at once.

00:37:29.106 --> 00:37:31.116 A:middle
Hey, that looks familiar.

00:37:31.326 --> 00:37:34.856 A:middle
Let's see it again.

00:37:35.056 --> 00:37:35.486 A:middle
Hmm.

00:37:36.946 --> 00:37:39.826 A:middle
Suppose we do this first, and

00:37:39.826 --> 00:37:40.926 A:middle
then take care of the parts

00:37:40.926 --> 00:37:41.456 A:middle
separately.

00:37:43.456 --> 00:37:44.246 A:middle
That's right.

00:37:44.706 --> 00:37:45.946 A:middle
This is just two stable

00:37:45.946 --> 00:37:48.036 A:middle
partitions with inverted

00:37:48.696 --> 00:37:48.976 A:middle
predicates.

00:37:49.596 --> 00:37:51.316 A:middle
So, the generic algorithm

00:37:51.736 --> 00:37:52.846 A:middle
collapsed down to this

00:37:52.886 --> 00:37:56.716 A:middle
two-liner, and here's what's

00:37:56.716 --> 00:37:57.636 A:middle
left in canvas.

00:37:58.186 --> 00:38:01.126 A:middle
Now, let's just see that next to

00:37:58.186 --> 00:38:01.126 A:middle
Now, let's just see that next to

00:38:01.126 --> 00:38:02.426 A:middle
the old code.

00:38:04.456 --> 00:38:07.886 A:middle
That's not bad, but we got a

00:38:07.886 --> 00:38:10.396 A:middle
reusable efficient documented

00:38:10.766 --> 00:38:12.346 A:middle
general purpose algorithm out of

00:38:12.346 --> 00:38:13.846 A:middle
it, which is spectacular.

00:38:14.446 --> 00:38:14.556 A:middle
Okay.

00:38:17.916 --> 00:38:21.846 A:middle
So, this is a learned skill to

00:38:21.846 --> 00:38:23.746 A:middle
look past the details that are

00:38:23.746 --> 00:38:25.086 A:middle
specific to your application

00:38:25.086 --> 00:38:27.056 A:middle
domain, see what your code is

00:38:27.056 --> 00:38:29.126 A:middle
doing fundamentally, and capture

00:38:29.126 --> 00:38:31.416 A:middle
that in reusable generic code.

00:38:32.276 --> 00:38:33.776 A:middle
It takes practice.

00:38:34.966 --> 00:38:35.636 A:middle
So, why bother?

00:38:36.536 --> 00:38:38.636 A:middle
Well, the practical answer is

00:38:38.636 --> 00:38:39.966 A:middle
that because they're decoupled

00:38:39.966 --> 00:38:41.896 A:middle
from those irrelevant details,

00:38:42.336 --> 00:38:44.126 A:middle
generic algorithms are more

00:38:44.126 --> 00:38:46.296 A:middle
reusable, testable, and even

00:38:46.296 --> 00:38:47.976 A:middle
clearer than their non-generic

00:38:47.976 --> 00:38:48.706 A:middle
counterparts.

00:38:49.676 --> 00:38:51.336 A:middle
But I also think it's just

00:38:51.586 --> 00:38:53.156 A:middle
deeply rewarding for anyone that

00:38:53.296 --> 00:38:54.446 A:middle
really loves programming.

00:38:55.646 --> 00:38:56.996 A:middle
It's a search for truth and

00:38:56.996 --> 00:38:59.406 A:middle
beauty but not some abstract

00:38:59.406 --> 00:39:01.266 A:middle
untouchable truth because the

00:38:59.406 --> 00:39:01.266 A:middle
untouchable truth because the

00:39:01.266 --> 00:39:02.876 A:middle
constraints of actual hardware

00:39:02.876 --> 00:39:03.696 A:middle
keep you honest.

00:39:04.836 --> 00:39:06.066 A:middle
As Crusty likes to say,

00:39:07.026 --> 00:39:10.136 A:middle
"Programming reveals the real."

00:39:10.346 --> 00:39:12.296 A:middle
So, treat your computation as a

00:39:12.296 --> 00:39:14.576 A:middle
first class citizen with all the

00:39:14.576 --> 00:39:16.186 A:middle
rights and obligations that you

00:39:16.186 --> 00:39:18.416 A:middle
take seriously for types and

00:39:18.416 --> 00:39:19.856 A:middle
application architecture.

00:39:20.316 --> 00:39:22.566 A:middle
Identify it, give it a name,

00:39:22.846 --> 00:39:25.756 A:middle
unit test it, and document its

00:39:25.756 --> 00:39:27.006 A:middle
semantics and performance.

00:39:27.096 --> 00:39:30.556 A:middle
Now, I want to close by putting

00:39:30.556 --> 00:39:32.366 A:middle
this advice you saw from Shawn

00:39:32.366 --> 00:39:34.136 A:middle
Perin in its full context.

00:39:34.676 --> 00:39:37.466 A:middle
"If you want to improve the code

00:39:37.466 --> 00:39:39.146 A:middle
quality in your organization,

00:39:39.606 --> 00:39:41.586 A:middle
replace all of your coding

00:39:41.586 --> 00:39:44.506 A:middle
standards with one goal, No Raw

00:39:44.506 --> 00:39:44.976 A:middle
Loops."

00:39:46.386 --> 00:39:46.696 A:middle
Thank you.

00:39:47.516 --> 00:39:52.500 A:middle
[ Applause ]
