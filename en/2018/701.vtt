WEBVTT

00:00:06.516 --> 00:00:15.500 A:middle
[ Music ]

00:00:22.346 --> 00:00:22.996 A:middle
&gt;&gt; Good morning.

00:00:23.426 --> 00:00:24.156 A:middle
How is everybody?

00:00:24.756 --> 00:00:24.846 A:middle
&gt;&gt; Good.

00:00:25.516 --> 00:00:28.886 A:middle
[ Applause ]

00:00:29.386 --> 00:00:30.816 A:middle
&gt;&gt; My name is Matthew Badin, and

00:00:30.816 --> 00:00:31.706 A:middle
I'm an engineer at Apple.

00:00:32.526 --> 00:00:33.646 A:middle
Welcome to the Using Accelerate

00:00:33.646 --> 00:00:34.376 A:middle
and simd session.

00:00:37.026 --> 00:00:38.096 A:middle
So my colleague Luke Chang and I

00:00:38.096 --> 00:00:39.046 A:middle
are pretty excited today.

00:00:39.046 --> 00:00:40.756 A:middle
We get to talk to you about all

00:00:40.756 --> 00:00:41.716 A:middle
the great APIs that are

00:00:41.716 --> 00:00:43.206 A:middle
available in Accelerate and its

00:00:43.206 --> 00:00:44.656 A:middle
associated frameworks, and we're

00:00:45.426 --> 00:00:46.386 A:middle
going to start by taking a

00:00:46.386 --> 00:00:47.716 A:middle
high-level overview of

00:00:47.716 --> 00:00:48.696 A:middle
Accelerate and some of the

00:00:48.696 --> 00:00:49.596 A:middle
high-performance libraries that

00:00:49.596 --> 00:00:51.216 A:middle
are contained inside it.

00:00:51.576 --> 00:00:52.516 A:middle
We're then going to take a deep

00:00:52.516 --> 00:00:54.196 A:middle
dive into a few of libraries,

00:00:54.756 --> 00:00:56.346 A:middle
and we're going to start by

00:00:56.346 --> 00:00:57.196 A:middle
taking a look at vDSP.

00:00:57.196 --> 00:00:59.766 A:middle
We have two examples for you.

00:01:00.996 --> 00:01:01.826 A:middle
The first one, we're going to

00:01:01.826 --> 00:01:03.036 A:middle
show you how to extract signal

00:01:03.036 --> 00:01:04.686 A:middle
from noise, and then we're going

00:01:04.686 --> 00:01:06.346 A:middle
to show you how you can remove

00:01:06.466 --> 00:01:07.666 A:middle
certain types of artifacts from

00:01:07.666 --> 00:01:07.996 A:middle
an image.

00:01:09.426 --> 00:01:10.696 A:middle
We're then going to take a look

00:01:10.696 --> 00:01:12.406 A:middle
at simd, and we're going to show

00:01:12.406 --> 00:01:13.656 A:middle
you how you can use quaternions

00:01:13.656 --> 00:01:14.986 A:middle
to represent rotations in three

00:01:14.986 --> 00:01:15.446 A:middle
dimensions.

00:01:16.056 --> 00:01:19.526 A:middle
I'm then going to pass off the

00:01:19.526 --> 00:01:20.646 A:middle
presentation to my colleague,

00:01:20.646 --> 00:01:21.926 A:middle
Luke Cheng, who's going to show

00:01:21.926 --> 00:01:22.726 A:middle
you some of the interesting

00:01:22.726 --> 00:01:23.646 A:middle
things that you can do with

00:01:23.646 --> 00:01:24.116 A:middle
vImage.

00:01:25.256 --> 00:01:27.116 A:middle
So with that, let's get started.

00:01:27.736 --> 00:01:30.226 A:middle
So you're probably asking

00:01:30.226 --> 00:01:31.266 A:middle
yourself exactly this.

00:01:31.656 --> 00:01:33.026 A:middle
What on Earth is Accelerate?

00:01:33.596 --> 00:01:37.276 A:middle
So the primary purpose of

00:01:37.276 --> 00:01:38.616 A:middle
Accelerate is to provide

00:01:38.906 --> 00:01:40.236 A:middle
thousands of low-level math

00:01:40.236 --> 00:01:42.146 A:middle
primitives, and we provide these

00:01:42.146 --> 00:01:43.606 A:middle
primitives across all of Apple's

00:01:43.606 --> 00:01:44.186 A:middle
platforms.

00:01:44.846 --> 00:01:46.376 A:middle
So this includes not only iOS

00:01:46.376 --> 00:01:48.436 A:middle
and macOS but watchOS and tvOS

00:01:48.436 --> 00:01:48.796 A:middle
as well.

00:01:51.536 --> 00:01:52.796 A:middle
Most of these primitives are

00:01:52.796 --> 00:01:53.546 A:middle
hand-tuned to the

00:01:53.546 --> 00:01:54.846 A:middle
microarchitecture of the

00:01:54.846 --> 00:01:55.316 A:middle
processor.

00:01:56.156 --> 00:01:57.596 A:middle
So this means we get excellent

00:01:57.596 --> 00:01:58.276 A:middle
performance.

00:01:58.766 --> 00:02:01.536 A:middle
And this performance translates

00:01:58.766 --> 00:02:01.536 A:middle
And this performance translates

00:02:01.536 --> 00:02:02.956 A:middle
directly into energy savings.

00:02:03.756 --> 00:02:05.646 A:middle
So if you're an app developer

00:02:05.816 --> 00:02:06.696 A:middle
and you use the Accelerate

00:02:06.696 --> 00:02:08.276 A:middle
framework, not only will your

00:02:08.276 --> 00:02:09.876 A:middle
application run faster, but

00:02:09.876 --> 00:02:10.816 A:middle
you'll also use less battery

00:02:10.816 --> 00:02:11.146 A:middle
life.

00:02:11.846 --> 00:02:12.776 A:middle
This means your users are going

00:02:12.776 --> 00:02:13.676 A:middle
to have an overall better

00:02:13.676 --> 00:02:13.976 A:middle
experience.

00:02:18.446 --> 00:02:20.416 A:middle
Now, because we provide so many

00:02:20.416 --> 00:02:22.496 A:middle
primitives, we find it useful to

00:02:22.496 --> 00:02:24.186 A:middle
organize or group them into

00:02:24.186 --> 00:02:25.406 A:middle
domain-specific libraries.

00:02:26.706 --> 00:02:28.676 A:middle
So, for instance, we group all

00:02:28.676 --> 00:02:29.926 A:middle
the signal processing primitives

00:02:29.996 --> 00:02:31.026 A:middle
under vDSP.

00:02:32.156 --> 00:02:33.256 A:middle
So, for instance, this would be

00:02:33.256 --> 00:02:35.196 A:middle
your FFTs or your DFTs and your

00:02:35.196 --> 00:02:36.636 A:middle
DCTs, your fast Fourier

00:02:36.636 --> 00:02:37.956 A:middle
transforms, your discrete cosine

00:02:37.956 --> 00:02:38.516 A:middle
transforms.

00:02:40.186 --> 00:02:42.786 A:middle
VImage contains the image

00:02:42.786 --> 00:02:43.586 A:middle
processing primitives.

00:02:44.306 --> 00:02:45.506 A:middle
If you're doing color space

00:02:45.506 --> 00:02:46.976 A:middle
conversions, this is the library

00:02:48.296 --> 00:02:49.836 A:middle
for you.

00:02:49.836 --> 00:02:51.056 A:middle
VForce contains vector versions

00:02:51.056 --> 00:02:52.196 A:middle
of the transcendental functions.

00:02:52.466 --> 00:02:55.906 A:middle
So for instance sine and cosine.

00:02:56.616 --> 00:02:57.906 A:middle
We also have support for dense

00:02:57.906 --> 00:03:00.596 A:middle
linear algebra as well as sparse

00:02:57.906 --> 00:03:00.596 A:middle
linear algebra as well as sparse

00:03:00.596 --> 00:03:03.336 A:middle
linear algebra, and we have a

00:03:03.336 --> 00:03:05.176 A:middle
specialized library for neural

00:03:05.176 --> 00:03:06.626 A:middle
networks called BNNS.

00:03:06.626 --> 00:03:07.896 A:middle
It stands for Basic Neural

00:03:07.896 --> 00:03:08.726 A:middle
Network Subroutines.

00:03:09.766 --> 00:03:10.916 A:middle
Not strictly part of the

00:03:10.916 --> 00:03:12.596 A:middle
Accelerate framework but very

00:03:12.596 --> 00:03:13.716 A:middle
closely related, and we find

00:03:13.716 --> 00:03:14.796 A:middle
these libraries very useful,

00:03:15.126 --> 00:03:16.656 A:middle
include libraries like simd,

00:03:17.406 --> 00:03:18.336 A:middle
which is a vector programming

00:03:18.336 --> 00:03:20.636 A:middle
aid for the CPU, and

00:03:20.636 --> 00:03:21.956 A:middle
Compression, which contains

00:03:22.036 --> 00:03:23.386 A:middle
several different lossless data

00:03:23.386 --> 00:03:24.136 A:middle
compression algorithms.

00:03:24.136 --> 00:03:27.116 A:middle
So let's take a look at our

00:03:27.116 --> 00:03:27.766 A:middle
first library.

00:03:28.266 --> 00:03:30.646 A:middle
We're going to take a look at

00:03:31.366 --> 00:03:31.776 A:middle
vDSP.

00:03:31.916 --> 00:03:33.186 A:middle
VDSP is a state-of-the-art

00:03:33.186 --> 00:03:34.346 A:middle
signal processing library, and

00:03:34.516 --> 00:03:35.556 A:middle
it contains a wide range of

00:03:35.556 --> 00:03:36.606 A:middle
signal processing primitives.

00:03:37.706 --> 00:03:39.016 A:middle
These range from basic

00:03:39.016 --> 00:03:40.456 A:middle
arithmetic operations on arrays

00:03:40.766 --> 00:03:43.396 A:middle
such as add and subtract as well

00:03:43.396 --> 00:03:44.806 A:middle
as more complicated operations

00:03:44.996 --> 00:03:47.716 A:middle
like convolution and FFTs.

00:03:47.716 --> 00:03:50.306 A:middle
If you're a successful app

00:03:50.306 --> 00:03:51.846 A:middle
developer and maybe in the past

00:03:51.846 --> 00:03:54.196 A:middle
you have avoided FFTs, I want to

00:03:54.196 --> 00:03:55.156 A:middle
show you how we make that easy

00:03:55.156 --> 00:03:55.776 A:middle
with Accelerate.

00:03:56.286 --> 00:03:57.326 A:middle
With just a few lines of code,

00:03:57.486 --> 00:03:58.286 A:middle
you can make that work.

00:03:59.206 --> 00:03:59.946 A:middle
And I have an example.

00:03:59.946 --> 00:04:00.696 A:middle
I'm going to show you how to

00:03:59.946 --> 00:04:00.696 A:middle
I'm going to show you how to

00:04:00.726 --> 00:04:01.976 A:middle
extract signal from noise.

00:04:15.046 --> 00:04:15.936 A:middle
So what we have here is an audio

00:04:15.936 --> 00:04:16.315 A:middle
signal.

00:04:16.706 --> 00:04:18.005 A:middle
This is the base signal.

00:04:18.116 --> 00:04:19.346 A:middle
We haven't added any noise to it

00:04:19.346 --> 00:04:20.926 A:middle
yet, and you'll notice I have

00:04:20.926 --> 00:04:21.946 A:middle
two sliders at the bottom.

00:04:22.506 --> 00:04:24.196 A:middle
In the lower left I have a

00:04:24.196 --> 00:04:27.236 A:middle
slider that lets me add noise,

00:04:27.966 --> 00:04:30.316 A:middle
and you can see that.

00:04:30.506 --> 00:04:31.976 A:middle
And I also have a second slider

00:04:31.976 --> 00:04:33.196 A:middle
that let's me remove this noise

00:04:34.666 --> 00:04:35.366 A:middle
called Threshold.

00:04:37.316 --> 00:04:38.216 A:middle
You'll also notice I have a

00:04:38.216 --> 00:04:39.306 A:middle
toggle switch in the lower

00:04:39.306 --> 00:04:39.566 A:middle
right.

00:04:40.946 --> 00:04:42.596 A:middle
This lets me look at this under

00:04:42.596 --> 00:04:43.276 A:middle
a different domain.

00:04:43.436 --> 00:04:45.456 A:middle
So currently we're looking at

00:04:45.456 --> 00:04:46.696 A:middle
this signal under the time

00:04:46.696 --> 00:04:47.026 A:middle
domain.

00:04:47.026 --> 00:04:48.276 A:middle
We're going to do some analysis

00:04:49.226 --> 00:04:50.416 A:middle
and see this signal in the

00:04:50.416 --> 00:04:51.056 A:middle
frequency domain.

00:04:51.606 --> 00:04:54.396 A:middle
You can see all the spikes on

00:04:54.396 --> 00:04:54.836 A:middle
the left.

00:04:55.416 --> 00:04:56.296 A:middle
Those are the frequency

00:04:56.296 --> 00:04:59.806 A:middle
components of the signal.

00:04:59.986 --> 00:05:01.626 A:middle
You'll also notice the blue bar.

00:04:59.986 --> 00:05:01.626 A:middle
You'll also notice the blue bar.

00:05:02.496 --> 00:05:04.396 A:middle
The blue bar is the threshold

00:05:04.396 --> 00:05:05.416 A:middle
slider, so you can see I can

00:05:05.416 --> 00:05:06.266 A:middle
move it.

00:05:07.596 --> 00:05:10.026 A:middle
So what I'm going to do now is

00:05:10.516 --> 00:05:11.386 A:middle
add some more noise to the

00:05:11.386 --> 00:05:11.746 A:middle
signal.

00:05:12.706 --> 00:05:13.656 A:middle
Actually, let's add quite a bit

00:05:13.656 --> 00:05:13.976 A:middle
of noise.

00:05:18.466 --> 00:05:19.526 A:middle
So you can see the signal that

00:05:19.526 --> 00:05:21.286 A:middle
I'm still interested in is

00:05:21.426 --> 00:05:22.896 A:middle
represented by the spikes on the

00:05:22.896 --> 00:05:24.896 A:middle
left or another way of looking

00:05:24.896 --> 00:05:26.036 A:middle
at it is the spikes with the

00:05:26.106 --> 00:05:28.326 A:middle
tallest height, and what we've

00:05:28.326 --> 00:05:29.366 A:middle
added, the type of noise we're

00:05:29.366 --> 00:05:30.406 A:middle
adding to this, is background

00:05:30.406 --> 00:05:30.726 A:middle
noise.

00:05:31.406 --> 00:05:32.176 A:middle
So it's kind of evenly

00:05:32.176 --> 00:05:34.026 A:middle
distributed spikes everywhere,

00:05:34.026 --> 00:05:36.746 A:middle
but they're low-level spikes.

00:05:37.126 --> 00:05:38.876 A:middle
So now I'm going to remove this

00:05:38.876 --> 00:05:40.276 A:middle
noise, and the way I'm going to

00:05:40.276 --> 00:05:41.196 A:middle
do this is I'm going to move

00:05:41.196 --> 00:05:42.436 A:middle
this threshold slightly higher.

00:05:44.146 --> 00:05:45.956 A:middle
As I do this, what's happening

00:05:45.956 --> 00:05:47.816 A:middle
is, behind the scenes, is we're

00:05:47.816 --> 00:05:50.246 A:middle
identifying any frequency

00:05:50.246 --> 00:05:51.146 A:middle
component less than this

00:05:51.146 --> 00:05:52.466 A:middle
threshold and removing it.

00:05:52.646 --> 00:05:54.166 A:middle
We're saying effectively if

00:05:54.166 --> 00:05:55.876 A:middle
there is any spike with a height

00:05:55.876 --> 00:05:57.056 A:middle
less than this blue bar, we're

00:05:57.416 --> 00:05:58.586 A:middle
going to pretend it's noise and

00:05:58.586 --> 00:05:59.726 A:middle
remove it.

00:06:00.996 --> 00:06:02.186 A:middle
So if I keep sliding this

00:06:02.186 --> 00:06:02.566 A:middle
higher,

00:06:05.976 --> 00:06:07.276 A:middle
eventually I've removed all the

00:06:07.276 --> 00:06:07.616 A:middle
noise.

00:06:07.946 --> 00:06:12.186 A:middle
And if I go back to the time

00:06:12.186 --> 00:06:12.866 A:middle
domain, you can see that I

00:06:12.866 --> 00:06:13.636 A:middle
removed the noise.

00:06:14.066 --> 00:06:14.916 A:middle
And in case you don't believe

00:06:14.946 --> 00:06:17.166 A:middle
me, we can remove the threshold,

00:06:17.976 --> 00:06:19.096 A:middle
and this is what this looks like

00:06:19.496 --> 00:06:21.096 A:middle
with all the noise still added.

00:06:21.666 --> 00:06:23.606 A:middle
So let me show you how we do

00:06:23.606 --> 00:06:23.856 A:middle
that.

00:06:30.046 --> 00:06:30.876 A:middle
At a high level what we're going

00:06:30.876 --> 00:06:32.146 A:middle
to do is first perform an

00:06:32.146 --> 00:06:33.256 A:middle
analysis on a signal.

00:06:33.656 --> 00:06:34.686 A:middle
That's what the switch let me

00:06:34.686 --> 00:06:34.846 A:middle
do.

00:06:36.246 --> 00:06:37.936 A:middle
We're then going to identify the

00:06:37.936 --> 00:06:38.956 A:middle
frequency components that

00:06:38.956 --> 00:06:40.426 A:middle
represent the noise and remove

00:06:40.426 --> 00:06:40.616 A:middle
them.

00:06:41.926 --> 00:06:43.016 A:middle
After we have done that, we're

00:06:43.016 --> 00:06:44.366 A:middle
going to reconstruct the audio

00:06:44.366 --> 00:06:44.686 A:middle
signal.

00:06:44.686 --> 00:06:45.966 A:middle
So let me show you some code.

00:06:50.176 --> 00:06:51.446 A:middle
What we're going to use here is

00:06:51.446 --> 00:06:53.296 A:middle
a discrete cosine transform or a

00:06:53.296 --> 00:06:53.786 A:middle
DCT.

00:06:55.496 --> 00:06:56.666 A:middle
You can see here the DCT

00:06:56.666 --> 00:06:57.476 A:middle
CreateSetup.

00:06:58.516 --> 00:07:01.046 A:middle
This context is going to

00:06:58.516 --> 00:07:01.046 A:middle
This context is going to

00:07:01.586 --> 00:07:02.576 A:middle
describe the type of work we're

00:07:02.576 --> 00:07:03.746 A:middle
going to do as well as give us

00:07:03.746 --> 00:07:04.896 A:middle
space to perform this work.

00:07:06.396 --> 00:07:08.276 A:middle
In this case, we're going to use

00:07:08.276 --> 00:07:09.986 A:middle
a type 2 DCT.

00:07:10.596 --> 00:07:11.476 A:middle
We're then going to pass this

00:07:11.476 --> 00:07:13.506 A:middle
context to an execute function.

00:07:16.016 --> 00:07:18.026 A:middle
This will actually perform the

00:07:18.026 --> 00:07:18.316 A:middle
work.

00:07:21.466 --> 00:07:22.756 A:middle
Once we've performed the

00:07:22.756 --> 00:07:23.996 A:middle
analysis, we want to remove the

00:07:23.996 --> 00:07:24.356 A:middle
noise.

00:07:24.746 --> 00:07:25.616 A:middle
This right here is where the

00:07:25.616 --> 00:07:26.296 A:middle
magic happens.

00:07:27.326 --> 00:07:28.496 A:middle
This routine is going to

00:07:28.496 --> 00:07:30.396 A:middle
identify any frequency component

00:07:30.396 --> 00:07:32.516 A:middle
less than that threshold and

00:07:32.586 --> 00:07:33.256 A:middle
make it zero.

00:07:33.616 --> 00:07:36.486 A:middle
It's going to zero it out.

00:07:36.756 --> 00:07:37.736 A:middle
After we've done that, we want

00:07:37.736 --> 00:07:38.916 A:middle
to reconstruct the audio signal.

00:07:43.406 --> 00:07:44.156 A:middle
Again, we're going to need to

00:07:44.156 --> 00:07:45.336 A:middle
use CreateSetup to create

00:07:45.336 --> 00:07:45.976 A:middle
context.

00:07:47.456 --> 00:07:49.996 A:middle
In this case, we're going to use

00:07:49.996 --> 00:07:52.736 A:middle
a type 3 DCT to reconstruct the

00:07:52.736 --> 00:07:52.976 A:middle
signal.

00:07:56.436 --> 00:07:58.926 A:middle
We're then going to pass this

00:07:58.926 --> 00:08:00.676 A:middle
context DCT execute, and this

00:07:58.926 --> 00:08:00.676 A:middle
context DCT execute, and this

00:08:00.676 --> 00:08:02.036 A:middle
will actually perform the work

00:08:02.036 --> 00:08:02.886 A:middle
of reconstructing the audio

00:08:02.886 --> 00:08:03.216 A:middle
signal.

00:08:05.316 --> 00:08:08.356 A:middle
So what we've shown you is an

00:08:08.356 --> 00:08:09.546 A:middle
example of how you can remove

00:08:09.546 --> 00:08:11.026 A:middle
certain types of noise from an

00:08:11.026 --> 00:08:11.966 A:middle
audio signal using vDSP.

00:08:11.966 --> 00:08:14.436 A:middle
I want to show you an example of

00:08:14.436 --> 00:08:15.396 A:middle
how we can remove certain types

00:08:15.396 --> 00:08:17.126 A:middle
of noise from an image also

00:08:17.126 --> 00:08:17.836 A:middle
using vDSP.

00:08:18.496 --> 00:08:22.496 A:middle
In this case, we're going to

00:08:22.566 --> 00:08:23.596 A:middle
restore an old newspaper

00:08:23.596 --> 00:08:23.966 A:middle
photograph.

00:08:32.086 --> 00:08:32.816 A:middle
So what we've done is we've

00:08:32.816 --> 00:08:35.916 A:middle
taken this image, and we've

00:08:36.275 --> 00:08:38.525 A:middle
applied a two-tone screen to it.

00:08:39.296 --> 00:08:40.796 A:middle
So this could represent an old

00:08:40.796 --> 00:08:41.716 A:middle
newspaper photograph.

00:08:41.916 --> 00:08:42.746 A:middle
And what we're going to try to

00:08:42.746 --> 00:08:45.236 A:middle
do is remove this screen.

00:08:45.236 --> 00:08:46.086 A:middle
We're going to try to remove the

00:08:46.086 --> 00:08:47.456 A:middle
artifacts that you see.

00:08:48.296 --> 00:08:49.636 A:middle
Currently, we're in off, so

00:08:49.636 --> 00:08:50.506 A:middle
we're not doing anything.

00:08:51.126 --> 00:08:52.476 A:middle
What we're going to do is

00:08:52.476 --> 00:08:53.586 A:middle
actually take a sample of this

00:08:53.586 --> 00:08:55.196 A:middle
screen, and we're going to

00:08:55.196 --> 00:08:56.796 A:middle
create a mask from that sample

00:08:56.796 --> 00:08:58.076 A:middle
and then apply that to the image

00:08:58.076 --> 00:08:58.796 A:middle
to try to remove it.

00:08:58.796 --> 00:09:00.576 A:middle
So let me show you the first

00:08:58.796 --> 00:09:00.576 A:middle
So let me show you the first

00:09:00.576 --> 00:09:00.956 A:middle
attempt.

00:09:05.066 --> 00:09:06.346 A:middle
So what we're doing is we are

00:09:06.346 --> 00:09:08.306 A:middle
identifying a frequency

00:09:08.306 --> 00:09:09.366 A:middle
component at a certain

00:09:09.366 --> 00:09:11.276 A:middle
threshold, and any frequency

00:09:11.276 --> 00:09:13.286 A:middle
component higher than that

00:09:13.286 --> 00:09:16.496 A:middle
threshold we're going to remove.

00:09:17.066 --> 00:09:17.866 A:middle
And you see, if we set the

00:09:17.866 --> 00:09:20.486 A:middle
threshold too low, not only do

00:09:20.486 --> 00:09:22.466 A:middle
we remove the artifacts, but we

00:09:22.466 --> 00:09:23.326 A:middle
also remove quite a bit of the

00:09:23.326 --> 00:09:23.896 A:middle
image as well.

00:09:27.716 --> 00:09:29.336 A:middle
If we set it too high, you can

00:09:29.756 --> 00:09:34.486 A:middle
see that we didn't do much of

00:09:37.756 --> 00:09:37.976 A:middle
anything.

00:09:38.986 --> 00:09:39.976 A:middle
Medium seems about right.

00:09:40.836 --> 00:09:42.386 A:middle
Medium seems too correctly

00:09:42.386 --> 00:09:45.136 A:middle
identify the artifacts in the

00:09:45.136 --> 00:09:47.316 A:middle
image without damaging too much

00:09:47.316 --> 00:09:47.726 A:middle
of the image.

00:09:48.366 --> 00:09:49.626 A:middle
So let me show you how we do

00:09:49.626 --> 00:09:49.876 A:middle
that.

00:09:55.316 --> 00:09:56.346 A:middle
At a high level what we're going

00:09:56.346 --> 00:09:57.986 A:middle
to do is we're going to perform

00:09:57.986 --> 00:09:59.626 A:middle
an FFT on the image and the

00:09:59.626 --> 00:09:59.976 A:middle
sample.

00:10:01.296 --> 00:10:02.276 A:middle
We're then going to create a

00:10:02.276 --> 00:10:04.516 A:middle
mask from that sample and apply

00:10:04.626 --> 00:10:06.956 A:middle
it to the image.

00:10:07.436 --> 00:10:08.336 A:middle
Once we've done that, we're

00:10:08.336 --> 00:10:09.576 A:middle
going to reconstruct the

00:10:09.576 --> 00:10:10.176 A:middle
original image.

00:10:10.516 --> 00:10:11.826 A:middle
So let me walk you through some

00:10:11.826 --> 00:10:11.976 A:middle
code.

00:10:14.736 --> 00:10:18.396 A:middle
We're going to do an FFT.

00:10:18.516 --> 00:10:19.306 A:middle
This means it needs to be a

00:10:19.306 --> 00:10:19.936 A:middle
power of 2.

00:10:20.306 --> 00:10:21.236 A:middle
That's why you see the log2

00:10:21.236 --> 00:10:21.496 A:middle
call.

00:10:21.496 --> 00:10:24.796 A:middle
The 1024 x 1024 is the size of

00:10:24.796 --> 00:10:25.226 A:middle
the image.

00:10:28.646 --> 00:10:30.106 A:middle
We're then going to pass it to

00:10:30.106 --> 00:10:30.846 A:middle
fft2d zrop.

00:10:31.226 --> 00:10:32.076 A:middle
This is quite a mouthful.

00:10:32.506 --> 00:10:33.976 A:middle
The important part here is the

00:10:33.976 --> 00:10:35.616 A:middle
op stands for out of place.

00:10:35.616 --> 00:10:36.746 A:middle
So we're going to have to create

00:10:36.746 --> 00:10:38.346 A:middle
some temporary space just for

00:10:38.346 --> 00:10:38.756 A:middle
the result.

00:10:39.256 --> 00:10:42.876 A:middle
We're going to store in this

00:10:42.876 --> 00:10:44.346 A:middle
complex structure, and

00:10:44.486 --> 00:10:45.226 A:middle
effectively this says we're

00:10:45.226 --> 00:10:46.176 A:middle
going to store the complex

00:10:46.176 --> 00:10:48.526 A:middle
number in two arrays with the

00:10:48.526 --> 00:10:49.926 A:middle
real component in one array and

00:10:49.956 --> 00:10:51.366 A:middle
the imaginary component in the

00:10:51.686 --> 00:10:51.866 A:middle
second.

00:10:52.856 --> 00:10:53.816 A:middle
We also need to specify a

00:10:53.816 --> 00:10:54.296 A:middle
direction.

00:10:54.746 --> 00:10:55.596 A:middle
In this case we're going to do a

00:10:55.596 --> 00:10:56.406 A:middle
forward FFT.

00:11:01.636 --> 00:11:04.736 A:middle
Now the artifact removal is a

00:11:04.736 --> 00:11:06.886 A:middle
little bit more advanced, so I'm

00:11:06.886 --> 00:11:07.646 A:middle
only going to go through this at

00:11:07.646 --> 00:11:08.736 A:middle
a very high level.

00:11:09.116 --> 00:11:10.056 A:middle
I recommend you download the

00:11:10.056 --> 00:11:11.126 A:middle
sample application that's

00:11:11.126 --> 00:11:13.066 A:middle
available online right now, and

00:11:13.066 --> 00:11:14.666 A:middle
each one of these routines is

00:11:14.946 --> 00:11:16.726 A:middle
also documented under vDSP, and

00:11:16.726 --> 00:11:17.536 A:middle
we have excellent online

00:11:17.536 --> 00:11:18.176 A:middle
documentation.

00:11:18.766 --> 00:11:21.726 A:middle
A high level what we're going to

00:11:21.726 --> 00:11:22.926 A:middle
do is we're going to identify

00:11:22.926 --> 00:11:24.346 A:middle
the magnitude of the frequency

00:11:24.346 --> 00:11:25.686 A:middle
components, in this case with

00:11:25.686 --> 00:11:26.166 A:middle
the sample.

00:11:27.116 --> 00:11:28.956 A:middle
We're then going to identify the

00:11:28.956 --> 00:11:30.046 A:middle
components we want to remove.

00:11:31.316 --> 00:11:33.806 A:middle
We're then going to create a

00:11:33.806 --> 00:11:35.916 A:middle
mask from that.

00:11:36.436 --> 00:11:37.936 A:middle
And once we've done that, we're

00:11:37.936 --> 00:11:39.136 A:middle
going to apply that mask to the

00:11:39.136 --> 00:11:39.506 A:middle
image.

00:11:40.856 --> 00:11:42.196 A:middle
Effectively what we're doing is

00:11:42.196 --> 00:11:44.066 A:middle
we're multiplying by 0 the

00:11:44.066 --> 00:11:45.446 A:middle
components we want to remove and

00:11:45.446 --> 00:11:46.796 A:middle
by 1 the components we want to

00:11:46.796 --> 00:11:46.976 A:middle
keep.

00:11:52.336 --> 00:11:53.756 A:middle
We're going to use zrop again to

00:11:53.756 --> 00:11:54.636 A:middle
reconstruct the image.

00:11:55.066 --> 00:11:56.306 A:middle
Because this is an FFT, we get

00:11:56.306 --> 00:11:57.376 A:middle
to reuse the context.

00:12:01.076 --> 00:12:03.876 A:middle
In this case, one key detail is

00:12:03.916 --> 00:12:05.266 A:middle
we're going to store the image

00:12:05.316 --> 00:12:06.896 A:middle
in two arrays because this is a

00:12:06.896 --> 00:12:07.646 A:middle
complex structure.

00:12:08.136 --> 00:12:09.366 A:middle
So the even pixels are going to

00:12:09.366 --> 00:12:10.496 A:middle
be in the real array, and the

00:12:10.496 --> 00:12:11.576 A:middle
odd pixels are going to be in

00:12:11.576 --> 00:12:12.086 A:middle
the imaginary.

00:12:12.656 --> 00:12:16.136 A:middle
And again we're going to specify

00:12:16.136 --> 00:12:16.596 A:middle
a direction.

00:12:16.596 --> 00:12:17.436 A:middle
In this case, we're going to use

00:12:17.436 --> 00:12:18.576 A:middle
an inverse FFT.

00:12:18.726 --> 00:12:21.066 A:middle
So now I want to shift gears for

00:12:21.066 --> 00:12:21.536 A:middle
a moment.

00:12:22.096 --> 00:12:23.536 A:middle
Previously we showed you two

00:12:23.536 --> 00:12:27.616 A:middle
examples, and we had two working

00:12:27.616 --> 00:12:29.616 A:middle
examples for vDSP, and then we

00:12:29.616 --> 00:12:30.876 A:middle
worked backwards, and we showed

00:12:30.876 --> 00:12:33.786 A:middle
you how we constructed these

00:12:34.116 --> 00:12:34.706 A:middle
examples.

00:12:34.706 --> 00:12:35.576 A:middle
We worked backwards and showed

00:12:35.576 --> 00:12:36.756 A:middle
you the moving pieces.

00:12:37.586 --> 00:12:39.086 A:middle
For this next library, what I

00:12:39.086 --> 00:12:40.286 A:middle
want to do is start at the basic

00:12:40.286 --> 00:12:40.816 A:middle
components.

00:12:41.256 --> 00:12:42.636 A:middle
I want to build up to a result.

00:12:42.636 --> 00:12:44.066 A:middle
So we're going to take a look at

00:12:44.066 --> 00:12:46.066 A:middle
simd, and we're going to start

00:12:46.066 --> 00:12:46.956 A:middle
at the basic low-level

00:12:46.956 --> 00:12:48.246 A:middle
primitives, and we're going to

00:12:48.246 --> 00:12:50.116 A:middle
build up to rotations.

00:12:50.116 --> 00:12:51.336 A:middle
In this case, rotations of 3D

00:12:51.336 --> 00:12:51.836 A:middle
objects.

00:12:52.896 --> 00:12:57.556 A:middle
At a high level, simd is an

00:12:57.556 --> 00:12:58.776 A:middle
abstraction for the vector

00:12:58.776 --> 00:12:59.476 A:middle
processing unit.

00:13:00.556 --> 00:13:02.306 A:middle
So what this lets you do is

00:13:02.716 --> 00:13:04.156 A:middle
declare vector and matrix

00:13:04.156 --> 00:13:06.256 A:middle
objects, and you get to perform

00:13:06.256 --> 00:13:08.046 A:middle
operations on these objects, and

00:13:08.046 --> 00:13:09.256 A:middle
this will map directly to the

00:13:09.256 --> 00:13:10.056 A:middle
vector hardware of the

00:13:10.056 --> 00:13:10.506 A:middle
processor.

00:13:11.626 --> 00:13:12.866 A:middle
So let me show you a coding

00:13:12.866 --> 00:13:13.296 A:middle
example.

00:13:13.296 --> 00:13:16.866 A:middle
So what we're going to do here

00:13:16.866 --> 00:13:17.886 A:middle
is we're going to take two

00:13:17.886 --> 00:13:18.716 A:middle
arrays, and we're going to

00:13:18.716 --> 00:13:19.896 A:middle
average the components.

00:13:19.896 --> 00:13:21.916 A:middle
So we're going to iteratively go

00:13:21.916 --> 00:13:23.146 A:middle
through each of the scaler

00:13:23.146 --> 00:13:24.526 A:middle
components, add them together,

00:13:24.526 --> 00:13:25.186 A:middle
and divide by 2.

00:13:25.366 --> 00:13:28.636 A:middle
This is going to be really slow.

00:13:30.816 --> 00:13:32.486 A:middle
Instead, you can declare these

00:13:32.486 --> 00:13:34.366 A:middle
arrays as simd float4 vector

00:13:34.366 --> 00:13:34.796 A:middle
types.

00:13:36.116 --> 00:13:38.606 A:middle
So then we can perform basic

00:13:38.606 --> 00:13:40.906 A:middle
arithmetic operations on these

00:13:40.906 --> 00:13:41.436 A:middle
objects.

00:13:42.086 --> 00:13:44.516 A:middle
So not only can you express the

00:13:44.516 --> 00:13:45.996 A:middle
computation more naturally, but

00:13:45.996 --> 00:13:47.916 A:middle
this will also run about as fast

00:13:47.916 --> 00:13:48.356 A:middle
as it can.

00:13:49.036 --> 00:13:51.056 A:middle
And this will work across all of

00:13:51.056 --> 00:13:51.826 A:middle
Apple's platforms.

00:13:56.066 --> 00:13:57.276 A:middle
Simd has a tremendous amount of

00:13:57.276 --> 00:13:57.846 A:middle
functionality.

00:13:58.906 --> 00:14:00.686 A:middle
In addition to vector and matrix

00:13:58.906 --> 00:14:00.686 A:middle
In addition to vector and matrix

00:14:00.686 --> 00:14:03.696 A:middle
objects and allowing you to

00:14:03.696 --> 00:14:06.016 A:middle
perform arithmetic operations on

00:14:06.016 --> 00:14:06.636 A:middle
these objects.

00:14:07.236 --> 00:14:09.896 A:middle
It has extensions.

00:14:09.896 --> 00:14:11.886 A:middle
So for instance, dot products

00:14:12.766 --> 00:14:13.826 A:middle
and clamp.

00:14:14.286 --> 00:14:15.176 A:middle
It also has support for the

00:14:15.176 --> 00:14:16.346 A:middle
transcendental functions, so for

00:14:16.346 --> 00:14:20.096 A:middle
instance sine and cosine as well

00:14:20.096 --> 00:14:20.816 A:middle
as quaternions.

00:14:21.536 --> 00:14:23.116 A:middle
Quaternions are very useful for

00:14:23.116 --> 00:14:24.416 A:middle
representing rotations in three

00:14:24.416 --> 00:14:25.996 A:middle
dimensions, and I actually want

00:14:25.996 --> 00:14:27.076 A:middle
to talk a little bit more about

00:14:27.116 --> 00:14:27.346 A:middle
those.

00:14:27.346 --> 00:14:30.836 A:middle
So I'm going to walk you through

00:14:30.946 --> 00:14:31.856 A:middle
a coding example.

00:14:32.376 --> 00:14:34.666 A:middle
There's quite a bit to unpack

00:14:34.666 --> 00:14:34.836 A:middle
here.

00:14:35.416 --> 00:14:36.566 A:middle
So we're going to start on the

00:14:36.566 --> 00:14:36.826 A:middle
right.

00:14:37.596 --> 00:14:38.416 A:middle
We have a unit sphere.

00:14:38.486 --> 00:14:39.696 A:middle
That's what this gray sphere is.

00:14:39.956 --> 00:14:41.526 A:middle
And you'll notice this red dot.

00:14:42.136 --> 00:14:44.206 A:middle
And that's actually the tip of

00:14:44.206 --> 00:14:44.686 A:middle
this vector.

00:14:45.976 --> 00:14:47.576 A:middle
We've declared a simd float3

00:14:47.576 --> 00:14:47.986 A:middle
vector.

00:14:48.166 --> 00:14:49.656 A:middle
We've set the x and y components

00:14:49.656 --> 00:14:51.576 A:middle
to 0 and the z component to 1.

00:14:52.176 --> 00:14:53.156 A:middle
So it's coming out at us.

00:14:53.656 --> 00:14:55.696 A:middle
And that red dot is represented

00:14:55.696 --> 00:14:56.946 A:middle
by the tip of that vector.

00:14:58.926 --> 00:14:59.796 A:middle
We're now going to perform a

00:14:59.796 --> 00:15:01.406 A:middle
rotation on this vector using a

00:14:59.796 --> 00:15:01.406 A:middle
rotation on this vector using a

00:15:01.406 --> 00:15:01.896 A:middle
quaternion.

00:15:03.136 --> 00:15:04.836 A:middle
Technically, we're rotating the

00:15:04.836 --> 00:15:06.176 A:middle
entire scene, but for purposes

00:15:06.176 --> 00:15:07.066 A:middle
of illustration, we're going to

00:15:07.066 --> 00:15:08.256 A:middle
say we're rotating this vector.

00:15:10.066 --> 00:15:11.116 A:middle
When using a quaternion for

00:15:11.116 --> 00:15:12.896 A:middle
rotations, you need to specify

00:15:12.896 --> 00:15:14.406 A:middle
an axis and angle of rotation.

00:15:14.666 --> 00:15:16.716 A:middle
Or to put it another way, what

00:15:17.006 --> 00:15:18.386 A:middle
are you rotating about and by

00:15:18.386 --> 00:15:18.956 A:middle
how much.

00:15:19.696 --> 00:15:21.126 A:middle
So we're going to rotate about

00:15:21.126 --> 00:15:22.506 A:middle
the x axis, and we're going to

00:15:22.506 --> 00:15:26.426 A:middle
rotate pi over 3 radians up.

00:15:27.706 --> 00:15:28.736 A:middle
You apply the rotation by

00:15:28.736 --> 00:15:30.046 A:middle
calling the simd act function.

00:15:31.476 --> 00:15:33.256 A:middle
This applies the action of the

00:15:33.256 --> 00:15:34.326 A:middle
quaternion on that vector and

00:15:34.326 --> 00:15:35.646 A:middle
returns a rotated vector.

00:15:36.106 --> 00:15:37.786 A:middle
So let's take a look at that

00:15:37.786 --> 00:15:37.946 A:middle
now.

00:15:47.256 --> 00:15:48.566 A:middle
So normally you're not

00:15:48.566 --> 00:15:49.846 A:middle
interested in rotating along a

00:15:49.846 --> 00:15:50.626 A:middle
single axis.

00:15:50.676 --> 00:15:51.856 A:middle
You usually want to rotate along

00:15:51.856 --> 00:15:54.906 A:middle
multiple axes, and if you're

00:15:54.906 --> 00:15:55.856 A:middle
already familiar with rotation

00:15:55.856 --> 00:15:56.996 A:middle
matrices, this is going to seem

00:15:56.996 --> 00:15:57.566 A:middle
very natural.

00:16:00.186 --> 00:16:01.376 A:middle
Like rotation matrices, you can

00:16:01.376 --> 00:16:02.426 A:middle
combine the rotations using

00:16:02.426 --> 00:16:03.826 A:middle
multiplication, and also like

00:16:03.826 --> 00:16:04.876 A:middle
rotation matrices, the

00:16:04.876 --> 00:16:05.826 A:middle
multiplication is not

00:16:05.866 --> 00:16:06.406 A:middle
commutative.

00:16:06.936 --> 00:16:08.406 A:middle
So this means if you change the

00:16:08.406 --> 00:16:09.366 A:middle
order of the operands, you will

00:16:09.476 --> 00:16:10.206 A:middle
change the order of the

00:16:10.206 --> 00:16:10.706 A:middle
rotations.

00:16:11.846 --> 00:16:14.406 A:middle
So effectively what we're going

00:16:14.406 --> 00:16:15.766 A:middle
to do here is rotate pi over 3

00:16:15.766 --> 00:16:17.996 A:middle
radians up, and then pi over 3

00:16:17.996 --> 00:16:18.826 A:middle
radians to the right.

00:16:19.016 --> 00:16:19.906 A:middle
And we're going to combine that

00:16:19.906 --> 00:16:20.916 A:middle
into a single rotation.

00:16:26.136 --> 00:16:27.766 A:middle
Some of the more interesting

00:16:27.766 --> 00:16:28.876 A:middle
things you can actually do with

00:16:28.876 --> 00:16:30.136 A:middle
quaternions and simd is

00:16:30.136 --> 00:16:31.756 A:middle
interpolation, and we support

00:16:31.756 --> 00:16:33.186 A:middle
two types of interpolation.

00:16:34.936 --> 00:16:35.876 A:middle
The first is Slerp.

00:16:36.516 --> 00:16:39.106 A:middle
It stands for Spherical Linear

00:16:39.106 --> 00:16:42.326 A:middle
Interpolation, and there are

00:16:42.326 --> 00:16:44.206 A:middle
actually two variants of it.

00:16:45.476 --> 00:16:48.926 A:middle
We have simd slerp, which will

00:16:48.926 --> 00:16:49.886 A:middle
find the shortest arc between

00:16:49.886 --> 00:16:51.266 A:middle
these two points, in this case

00:16:51.306 --> 00:16:52.296 A:middle
between the blue and the green,

00:16:53.276 --> 00:16:55.096 A:middle
and we have simd slerp longest,

00:16:55.096 --> 00:16:56.196 A:middle
which will find the longest arc.

00:16:56.196 --> 00:16:57.156 A:middle
So you'll actually see it go

00:16:57.156 --> 00:16:57.976 A:middle
behind the unit sphere.

00:17:07.195 --> 00:17:08.546 A:middle
The second variant is Spline.

00:17:09.826 --> 00:17:11.126 A:middle
Spline is really more useful if

00:17:11.126 --> 00:17:12.396 A:middle
you have more than two

00:17:12.396 --> 00:17:12.996 A:middle
rotations.

00:17:13.116 --> 00:17:14.066 A:middle
So, for instance, here we're

00:17:14.066 --> 00:17:16.205 A:middle
going to interpolate between an

00:17:16.205 --> 00:17:18.226 A:middle
array of rotations, and there's

00:17:18.226 --> 00:17:19.256 A:middle
quite a bit of boilerplate code

00:17:19.256 --> 00:17:20.526 A:middle
here, so I want you to focus

00:17:20.526 --> 00:17:21.476 A:middle
just on the Spline call.

00:17:23.695 --> 00:17:25.695 A:middle
Effectively what we're doing is

00:17:25.695 --> 00:17:27.175 A:middle
just iterating through all the

00:17:27.175 --> 00:17:28.465 A:middle
individual rotations and

00:17:28.465 --> 00:17:28.946 A:middle
applying Spline.

00:17:34.546 --> 00:17:35.516 A:middle
So the thing you have to specify

00:17:35.516 --> 00:17:37.426 A:middle
with Spline is not only the two

00:17:38.086 --> 00:17:39.136 A:middle
rotations that you wish to

00:17:39.136 --> 00:17:40.696 A:middle
interpolate between but also the

00:17:40.696 --> 00:17:42.176 A:middle
previous and the next as well.

00:17:42.296 --> 00:17:44.856 A:middle
And this is what this looks

00:17:44.856 --> 00:17:44.976 A:middle
like.

00:17:52.076 --> 00:17:53.056 A:middle
So if you're a game developer,

00:17:53.056 --> 00:17:54.146 A:middle
you're probably not interested

00:17:54.146 --> 00:17:55.476 A:middle
in rotating individual vectors.

00:17:55.476 --> 00:17:56.486 A:middle
You're probably interested in

00:17:56.486 --> 00:17:57.286 A:middle
rotating objects.

00:17:57.976 --> 00:17:58.766 A:middle
So we have that for you.

00:17:58.906 --> 00:17:59.936 A:middle
We have a cube.

00:18:00.396 --> 00:18:02.376 A:middle
It's represented by multiple

00:18:02.376 --> 00:18:03.676 A:middle
vectors, and it's going to go

00:18:03.676 --> 00:18:04.286 A:middle
through a series of eight

00:18:04.286 --> 00:18:04.886 A:middle
rotations.

00:18:05.486 --> 00:18:06.546 A:middle
On the left, we're going to

00:18:06.546 --> 00:18:07.766 A:middle
trace those rotations using

00:18:07.836 --> 00:18:09.166 A:middle
Slerp, and on the right we're

00:18:09.166 --> 00:18:09.996 A:middle
going to use Spline.

00:18:10.316 --> 00:18:11.406 A:middle
So let me show you what Slerp

00:18:11.406 --> 00:18:11.836 A:middle
looks like.

00:18:20.066 --> 00:18:20.676 A:middle
And you can see because it's a

00:18:20.676 --> 00:18:21.826 A:middle
linear interpolation, every

00:18:21.826 --> 00:18:23.306 A:middle
single time it changes direction

00:18:23.356 --> 00:18:24.616 A:middle
you get these sharp corners.

00:18:25.346 --> 00:18:26.576 A:middle
Whereas if we look at Spline --

00:18:35.156 --> 00:18:35.846 A:middle
Because it's aware of the

00:18:35.846 --> 00:18:37.446 A:middle
previous and next rotation as

00:18:37.446 --> 00:18:38.426 A:middle
well, you end up with these

00:18:38.426 --> 00:18:39.146 A:middle
rounded corners.

00:18:39.736 --> 00:18:40.506 A:middle
So let's see that again.

00:18:52.726 --> 00:18:53.466 A:middle
So now I went through all those

00:18:53.466 --> 00:18:55.846 A:middle
topics pretty quickly, so as a

00:18:55.846 --> 00:18:58.866 A:middle
quick recap, we started by

00:18:58.866 --> 00:19:00.566 A:middle
taking a look at vDSP, and we

00:18:58.866 --> 00:19:00.566 A:middle
taking a look at vDSP, and we

00:19:00.566 --> 00:19:01.546 A:middle
showed you two examples.

00:19:01.746 --> 00:19:02.786 A:middle
The first was how to extract a

00:19:02.786 --> 00:19:04.776 A:middle
signal from noise, and the

00:19:04.776 --> 00:19:06.136 A:middle
second was how to remove certain

00:19:06.136 --> 00:19:07.276 A:middle
types of artifacts from an

00:19:07.276 --> 00:19:07.586 A:middle
image.

00:19:08.996 --> 00:19:10.606 A:middle
We then took a look at simd, and

00:19:10.606 --> 00:19:11.456 A:middle
I showed you how you can

00:19:11.456 --> 00:19:12.776 A:middle
represent rotations in three

00:19:12.776 --> 00:19:13.996 A:middle
dimensions using quaternions.

00:19:14.466 --> 00:19:16.196 A:middle
I'm now going to pass off the

00:19:16.196 --> 00:19:17.216 A:middle
presentation to my colleague,

00:19:17.216 --> 00:19:18.686 A:middle
Luke Chang, who's going to show

00:19:18.686 --> 00:19:19.376 A:middle
you some of the interesting

00:19:19.376 --> 00:19:20.376 A:middle
things you can do with vImage.

00:19:21.516 --> 00:19:26.246 A:middle
[ Applause ]

00:19:26.746 --> 00:19:27.356 A:middle
&gt;&gt; Thank you, Matthew.

00:19:30.206 --> 00:19:30.916 A:middle
Hello everyone.

00:19:31.276 --> 00:19:32.546 A:middle
My name is Luke Chang.

00:19:32.546 --> 00:19:33.786 A:middle
I'm an engineer in Vector and

00:19:33.786 --> 00:19:34.456 A:middle
Numerics group.

00:19:35.226 --> 00:19:36.576 A:middle
Today, I'm going to talk about

00:19:36.576 --> 00:19:39.176 A:middle
vImage, what vImage offers, and

00:19:39.176 --> 00:19:41.086 A:middle
how easy it is to use vImage in

00:19:41.086 --> 00:19:41.626 A:middle
your apps.

00:19:41.816 --> 00:19:43.796 A:middle
With just a few lines of code,

00:19:43.796 --> 00:19:45.836 A:middle
you can create engaging video

00:19:45.836 --> 00:19:46.906 A:middle
effects in your app.

00:19:47.446 --> 00:19:49.636 A:middle
Let's get right to it.

00:19:50.876 --> 00:19:52.856 A:middle
VImage is our image processing

00:19:52.856 --> 00:19:53.346 A:middle
library.

00:19:53.816 --> 00:19:55.886 A:middle
It has several components.

00:19:56.146 --> 00:19:58.386 A:middle
The first component is the

00:19:58.386 --> 00:19:59.216 A:middle
conversion function.

00:20:00.206 --> 00:20:01.746 A:middle
Conversion function help you

00:20:02.636 --> 00:20:04.536 A:middle
move image between different

00:20:04.536 --> 00:20:05.416 A:middle
image formats.

00:20:06.486 --> 00:20:08.746 A:middle
Different image formats have

00:20:08.746 --> 00:20:09.826 A:middle
different advantages.

00:20:10.176 --> 00:20:13.296 A:middle
For example, RGV format matches

00:20:13.296 --> 00:20:15.266 A:middle
the pixels on your display, so

00:20:15.266 --> 00:20:16.216 A:middle
it's best for the display.

00:20:17.166 --> 00:20:19.406 A:middle
On the other hand, we have YCbCr

00:20:19.406 --> 00:20:21.946 A:middle
image, which is similar to how

00:20:21.946 --> 00:20:23.396 A:middle
human perceive the image.

00:20:24.026 --> 00:20:25.876 A:middle
Human eyes recognize brightness,

00:20:26.286 --> 00:20:27.696 A:middle
which is the luminance channel.

00:20:28.526 --> 00:20:30.096 A:middle
Also, the color, which is the

00:20:30.096 --> 00:20:30.926 A:middle
chrominance channel.

00:20:32.156 --> 00:20:35.196 A:middle
Also, camera uses YCbCr format

00:20:35.196 --> 00:20:36.346 A:middle
to capture images.

00:20:37.066 --> 00:20:39.426 A:middle
So converging function helps you

00:20:39.426 --> 00:20:41.156 A:middle
easily move images between these

00:20:41.156 --> 00:20:41.636 A:middle
formats.

00:20:43.726 --> 00:20:45.586 A:middle
Next, we have geometry function.

00:20:46.956 --> 00:20:48.676 A:middle
Geometry function changes the

00:20:48.676 --> 00:20:50.966 A:middle
size or orientation of the

00:20:50.966 --> 00:20:51.466 A:middle
image.

00:20:52.176 --> 00:20:54.936 A:middle
We have vImage scale that can do

00:20:54.936 --> 00:20:56.756 A:middle
enlarge or shrink the image.

00:20:57.476 --> 00:20:59.466 A:middle
We use Lanczos algorithm, so

00:20:59.606 --> 00:21:01.416 A:middle
we'll have high-quality output

00:20:59.606 --> 00:21:01.416 A:middle
we'll have high-quality output

00:21:01.606 --> 00:21:02.666 A:middle
after the operation.

00:21:03.366 --> 00:21:06.186 A:middle
We also have vImage rotate that

00:21:06.186 --> 00:21:07.826 A:middle
can rotate image clockwise or

00:21:07.826 --> 00:21:08.906 A:middle
counterclockwise.

00:21:09.346 --> 00:21:13.016 A:middle
Next, convolution function.

00:21:13.486 --> 00:21:15.616 A:middle
The most notable effect of

00:21:15.616 --> 00:21:17.576 A:middle
convolution function is the blur

00:21:17.576 --> 00:21:17.846 A:middle
effect.

00:21:18.836 --> 00:21:20.296 A:middle
You see blur effect all the

00:21:20.296 --> 00:21:23.116 A:middle
time, in UI, in photography.

00:21:23.326 --> 00:21:25.086 A:middle
If you want to phase something

00:21:25.086 --> 00:21:26.656 A:middle
into the background, you can

00:21:26.656 --> 00:21:28.576 A:middle
apply the blur function, blur

00:21:29.986 --> 00:21:30.156 A:middle
effect.

00:21:31.126 --> 00:21:32.786 A:middle
Next, transform function.

00:21:33.796 --> 00:21:35.616 A:middle
Transform function is basically

00:21:35.616 --> 00:21:36.786 A:middle
a matrix multiply.

00:21:37.446 --> 00:21:39.346 A:middle
It lets you operate on the data

00:21:39.346 --> 00:21:40.586 A:middle
channel of each pixel.

00:21:41.256 --> 00:21:42.576 A:middle
Let's say you want to increase

00:21:42.576 --> 00:21:44.736 A:middle
red or increase green, you can

00:21:44.736 --> 00:21:46.016 A:middle
do that with transform

00:21:46.016 --> 00:21:46.566 A:middle
functions.

00:21:48.196 --> 00:21:49.426 A:middle
Morphology.

00:21:50.456 --> 00:21:52.926 A:middle
Morphology changes the size or

00:21:52.926 --> 00:21:54.866 A:middle
shape of the objects in the

00:21:54.866 --> 00:21:56.926 A:middle
image, not the image itself.

00:21:57.916 --> 00:22:00.646 A:middle
We have vImage erode, vImage

00:21:57.916 --> 00:22:00.646 A:middle
We have vImage erode, vImage

00:22:00.646 --> 00:22:02.566 A:middle
dilate to make the object

00:22:02.566 --> 00:22:04.016 A:middle
smaller and bigger.

00:22:04.856 --> 00:22:06.996 A:middle
If you're feeling adventurous,

00:22:06.996 --> 00:22:08.506 A:middle
you can actually provide a

00:22:08.506 --> 00:22:10.336 A:middle
custom shape of kernels to these

00:22:10.336 --> 00:22:13.126 A:middle
functions, and vImage erode and

00:22:13.126 --> 00:22:15.436 A:middle
dilate will make the object

00:22:15.436 --> 00:22:17.246 A:middle
smaller or bigger according to

00:22:17.246 --> 00:22:18.396 A:middle
the kernel you provided.

00:22:20.406 --> 00:22:21.986 A:middle
Those are the five things in

00:22:21.986 --> 00:22:22.576 A:middle
vImage.

00:22:22.786 --> 00:22:24.626 A:middle
Now, I want to show you a demo

00:22:24.626 --> 00:22:26.256 A:middle
app that we wrote based on

00:22:26.256 --> 00:22:28.096 A:middle
vImage and show you what kind of

00:22:28.096 --> 00:22:28.976 A:middle
effect you can get from vImage.

00:22:34.046 --> 00:22:35.566 A:middle
What I have here is a lab that

00:22:35.606 --> 00:22:37.496 A:middle
captures images using the back

00:22:37.496 --> 00:22:40.936 A:middle
camera and put the image onto

00:22:40.936 --> 00:22:41.456 A:middle
the screen.

00:22:42.466 --> 00:22:44.656 A:middle
And we're doing in real-time.

00:22:44.656 --> 00:22:45.956 A:middle
This is a live stream, so you

00:22:45.956 --> 00:22:47.666 A:middle
can see the drinking bird doing

00:22:47.666 --> 00:22:49.696 A:middle
its motion next to the roses.

00:22:50.656 --> 00:22:51.806 A:middle
All right, the first effect I

00:22:51.806 --> 00:22:53.206 A:middle
want to show you is the color

00:22:53.206 --> 00:22:54.256 A:middle
saturation effect.

00:22:54.856 --> 00:22:57.246 A:middle
You can see this effect in a lot

00:22:57.246 --> 00:22:59.406 A:middle
of photo editing software.

00:23:00.136 --> 00:23:01.676 A:middle
So I want to bring out the

00:23:01.676 --> 00:23:02.316 A:middle
color.

00:23:02.586 --> 00:23:04.826 A:middle
What I can do is move this

00:23:04.826 --> 00:23:09.576 A:middle
slider to the right to make the

00:23:09.576 --> 00:23:11.586 A:middle
red really red and green really

00:23:11.586 --> 00:23:11.866 A:middle
green.

00:23:13.646 --> 00:23:15.706 A:middle
And on the other side, I have

00:23:15.706 --> 00:23:16.666 A:middle
white roses.

00:23:17.366 --> 00:23:20.066 A:middle
I feel that the color of white

00:23:20.066 --> 00:23:21.346 A:middle
roses is not that interesting to

00:23:21.346 --> 00:23:21.636 A:middle
me.

00:23:21.636 --> 00:23:23.136 A:middle
I would like to direct the focus

00:23:23.136 --> 00:23:24.916 A:middle
of my audience to the

00:23:24.916 --> 00:23:27.426 A:middle
composition and the contrast of

00:23:27.426 --> 00:23:28.056 A:middle
this image.

00:23:28.996 --> 00:23:32.386 A:middle
I can slide to the left to

00:23:32.386 --> 00:23:36.376 A:middle
desaturate the image to the

00:23:36.376 --> 00:23:38.586 A:middle
point that this becomes a black

00:23:38.586 --> 00:23:39.406 A:middle
and white image.

00:23:39.906 --> 00:23:41.636 A:middle
So now color is no more

00:23:41.636 --> 00:23:43.596 A:middle
distraction in this image, and

00:23:43.696 --> 00:23:45.126 A:middle
the viewer can focus on the

00:23:45.126 --> 00:23:46.826 A:middle
composition and contrast.

00:23:48.266 --> 00:23:50.976 A:middle
Okay. So, how do we do this?

00:23:56.046 --> 00:23:57.116 A:middle
There are several steps we need

00:23:57.116 --> 00:23:57.536 A:middle
to take.

00:23:57.876 --> 00:24:00.246 A:middle
First, of course, we have to get

00:23:57.876 --> 00:24:00.246 A:middle
First, of course, we have to get

00:24:00.306 --> 00:24:02.186 A:middle
the image from the camera, and

00:24:03.476 --> 00:24:05.836 A:middle
then we want to use vImage to

00:24:05.836 --> 00:24:08.746 A:middle
process, to apply the effect, so

00:24:08.746 --> 00:24:10.436 A:middle
we have to prepare the input and

00:24:10.436 --> 00:24:12.036 A:middle
output buffer for vImage.

00:24:13.456 --> 00:24:15.576 A:middle
Then we actually calling vImage

00:24:15.576 --> 00:24:16.756 A:middle
functions to apply these

00:24:16.756 --> 00:24:19.936 A:middle
effects, and we display the

00:24:19.936 --> 00:24:21.186 A:middle
output to the screen.

00:24:22.046 --> 00:24:25.286 A:middle
Let me jump ahead and talk about

00:24:25.286 --> 00:24:27.006 A:middle
how do we apply effects using

00:24:27.006 --> 00:24:27.956 A:middle
vImage functions.

00:24:29.076 --> 00:24:32.096 A:middle
The effect I show you is a color

00:24:32.096 --> 00:24:34.306 A:middle
saturation effect, and here is

00:24:34.306 --> 00:24:35.966 A:middle
the formula to do color

00:24:35.966 --> 00:24:36.616 A:middle
saturation.

00:24:37.426 --> 00:24:38.886 A:middle
Basically, we want to remove the

00:24:38.886 --> 00:24:41.886 A:middle
bias from the pixel, and using

00:24:41.886 --> 00:24:43.376 A:middle
multiplication to apply the

00:24:43.376 --> 00:24:46.746 A:middle
saturation effects, and then we

00:24:46.746 --> 00:24:48.326 A:middle
put the bias back to the pixel.

00:24:49.686 --> 00:24:51.786 A:middle
VImage has exactly the function

00:24:51.786 --> 00:24:54.116 A:middle
to do this operation, which is

00:24:54.496 --> 00:24:55.956 A:middle
vImage matrix multiply.

00:24:58.246 --> 00:25:00.206 A:middle
VImage matrix multiply takes the

00:24:58.246 --> 00:25:00.206 A:middle
VImage matrix multiply takes the

00:25:00.206 --> 00:25:03.476 A:middle
preBias, in this case minus 128,

00:25:03.766 --> 00:25:06.786 A:middle
to remove the bias, and because

00:25:06.786 --> 00:25:08.276 A:middle
the saturation is [inaudible]

00:25:08.276 --> 00:25:10.466 A:middle
point and the image is an

00:25:10.466 --> 00:25:13.046 A:middle
integer, we want to convert this

00:25:13.046 --> 00:25:14.746 A:middle
saturation value first into

00:25:14.746 --> 00:25:15.806 A:middle
fixed point format.

00:25:16.366 --> 00:25:18.256 A:middle
We chose Q12 as the fixed point

00:25:18.256 --> 00:25:20.026 A:middle
format, hence a divisor of

00:25:20.026 --> 00:25:21.236 A:middle
0x100.

00:25:21.776 --> 00:25:24.086 A:middle
And then we have the postBias

00:25:24.086 --> 00:25:26.336 A:middle
128 times the divisor, just to

00:25:26.336 --> 00:25:27.796 A:middle
put the bias back to the pixel.

00:25:28.336 --> 00:25:32.036 A:middle
And the matrix itself is really,

00:25:32.036 --> 00:25:32.626 A:middle
really simple.

00:25:33.136 --> 00:25:35.006 A:middle
All we want to do is just doing

00:25:35.006 --> 00:25:37.246 A:middle
a scaling of CbCr channel.

00:25:37.546 --> 00:25:39.016 A:middle
So the matrix itself is just a

00:25:39.016 --> 00:25:42.026 A:middle
scaler, want to multiply CbCr

00:25:42.026 --> 00:25:43.966 A:middle
channel with this scaler.

00:25:44.836 --> 00:25:47.126 A:middle
We have all the information, so

00:25:47.126 --> 00:25:49.026 A:middle
let's call vImageMatrixMultiply,

00:25:49.906 --> 00:25:51.906 A:middle
and with just one line of code,

00:25:51.906 --> 00:25:53.606 A:middle
one function call, you can

00:25:53.666 --> 00:25:56.126 A:middle
achieve the saturation effect.

00:25:56.906 --> 00:25:58.616 A:middle
Now let me come back to other

00:25:58.616 --> 00:25:59.746 A:middle
steps that we need to take.

00:26:01.226 --> 00:26:03.256 A:middle
We need to take the image from

00:26:03.256 --> 00:26:03.726 A:middle
the camera.

00:26:04.036 --> 00:26:06.516 A:middle
How do we do that?

00:26:06.556 --> 00:26:07.546 A:middle
We need to write a delegate

00:26:07.546 --> 00:26:10.616 A:middle
method, and what camera gives us

00:26:10.616 --> 00:26:12.246 A:middle
is a CV image buffer.

00:26:13.376 --> 00:26:14.806 A:middle
So we get the buffer.

00:26:14.806 --> 00:26:17.706 A:middle
We have to make sure this buffer

00:26:17.706 --> 00:26:19.586 A:middle
is accessible to CPU.

00:26:19.956 --> 00:26:21.186 A:middle
That's where vImage lives.

00:26:21.806 --> 00:26:24.196 A:middle
After we apply the effects,

00:26:24.676 --> 00:26:26.026 A:middle
whatever effects that may be,

00:26:26.426 --> 00:26:28.416 A:middle
and we have to unlock the base

00:26:28.416 --> 00:26:31.066 A:middle
address of this pixel buffer so

00:26:31.066 --> 00:26:32.736 A:middle
that the camera can reuse this

00:26:32.736 --> 00:26:33.386 A:middle
piece of memory.

00:26:36.556 --> 00:26:38.236 A:middle
The second step, we have to

00:26:38.236 --> 00:26:40.116 A:middle
prepare the vImage input and

00:26:40.116 --> 00:26:40.706 A:middle
output buffer.

00:26:43.276 --> 00:26:45.486 A:middle
We already have this image in CV

00:26:45.546 --> 00:26:46.616 A:middle
image buffer.

00:26:46.736 --> 00:26:48.676 A:middle
All we need to do is just get

00:26:48.676 --> 00:26:50.696 A:middle
the information such as height

00:26:51.336 --> 00:26:54.206 A:middle
and width, and then we can

00:26:54.366 --> 00:26:55.856 A:middle
package this into a vImage

00:26:55.856 --> 00:26:57.906 A:middle
buffer object so it can be

00:26:57.906 --> 00:26:59.376 A:middle
consumed by vImage library.

00:26:59.806 --> 00:27:01.346 A:middle
We do this for luminance and

00:26:59.806 --> 00:27:01.346 A:middle
We do this for luminance and

00:27:01.346 --> 00:27:02.046 A:middle
chrominance channel.

00:27:03.586 --> 00:27:05.256 A:middle
Now we need to prepare an output

00:27:05.256 --> 00:27:05.566 A:middle
buffer.

00:27:06.596 --> 00:27:08.496 A:middle
Remember, we don't have a piece

00:27:08.496 --> 00:27:09.796 A:middle
of memory allocated to the

00:27:09.796 --> 00:27:11.736 A:middle
output image yet, so we need to

00:27:11.736 --> 00:27:13.776 A:middle
do that, and vImage has a

00:27:13.776 --> 00:27:15.446 A:middle
convenience function, vImage

00:27:15.446 --> 00:27:18.116 A:middle
buffer in it, to do just that.

00:27:18.756 --> 00:27:21.196 A:middle
Given this height, width, and

00:27:21.646 --> 00:27:24.906 A:middle
bits per pixel, vImage buffer in

00:27:24.906 --> 00:27:26.626 A:middle
it will allocate a memory that's

00:27:26.626 --> 00:27:27.936 A:middle
large enough to hold this image

00:27:28.016 --> 00:27:29.516 A:middle
and then also create a vImage

00:27:29.556 --> 00:27:31.486 A:middle
buffer object so it can be

00:27:31.486 --> 00:27:33.286 A:middle
consumed by the vImage library.

00:27:33.756 --> 00:27:38.466 A:middle
Last step is put this process

00:27:38.856 --> 00:27:40.076 A:middle
image to the screen.

00:27:40.556 --> 00:27:46.596 A:middle
Like I said before, RGB is

00:27:46.596 --> 00:27:47.656 A:middle
really the best format for

00:27:47.656 --> 00:27:49.456 A:middle
display, so let's use the

00:27:49.456 --> 00:27:51.296 A:middle
conversion function to convert

00:27:51.296 --> 00:27:54.016 A:middle
YCbCr image into a RGB image.

00:27:54.316 --> 00:27:56.906 A:middle
And then because the UI expect

00:27:56.906 --> 00:27:59.196 A:middle
the cgImage object, we have to

00:27:59.196 --> 00:27:59.856 A:middle
create one.

00:28:00.206 --> 00:28:02.776 A:middle
There is a convenience function

00:28:02.776 --> 00:28:03.296 A:middle
in vImage.

00:28:03.356 --> 00:28:06.606 A:middle
vImageCreatesCGImage FromBuffer

00:28:07.566 --> 00:28:09.606 A:middle
that helps you to create a

00:28:09.606 --> 00:28:11.286 A:middle
cgImage based on the buffer you

00:28:11.286 --> 00:28:12.596 A:middle
already have in vImage.

00:28:13.896 --> 00:28:15.566 A:middle
One thing to note is that we're

00:28:15.566 --> 00:28:17.706 A:middle
not actually copying the large

00:28:17.706 --> 00:28:19.636 A:middle
data buffer in the image from

00:28:19.636 --> 00:28:20.726 A:middle
one place to another.

00:28:21.206 --> 00:28:23.426 A:middle
We're simply creating a cgImage

00:28:23.426 --> 00:28:25.956 A:middle
object that adds a container to

00:28:25.956 --> 00:28:27.306 A:middle
this image buffer.

00:28:28.216 --> 00:28:29.876 A:middle
So we are only filling in the

00:28:29.876 --> 00:28:31.716 A:middle
information that cgImage needs,

00:28:31.716 --> 00:28:33.576 A:middle
create a cgImage objects,

00:28:33.716 --> 00:28:35.966 A:middle
instead of copying data around.

00:28:36.556 --> 00:28:39.136 A:middle
Once we have that, we can send

00:28:39.136 --> 00:28:41.456 A:middle
the cgImage object to the image

00:28:41.456 --> 00:28:43.616 A:middle
view, and it will be displayed

00:28:43.706 --> 00:28:44.406 A:middle
on the screen.

00:28:45.016 --> 00:28:45.796 A:middle
So it's that simple.

00:28:46.286 --> 00:28:48.146 A:middle
Four steps and you can create

00:28:48.146 --> 00:28:50.626 A:middle
your own effects, we show you

00:28:50.626 --> 00:28:51.656 A:middle
the saturation effects.

00:28:52.026 --> 00:28:54.736 A:middle
Now, there are other effects we

00:28:54.736 --> 00:28:56.166 A:middle
can do with vImage.

00:28:56.816 --> 00:28:59.116 A:middle
We can do a rotation, like I

00:28:59.116 --> 00:29:00.716 A:middle
said before, rotate the image

00:28:59.116 --> 00:29:00.716 A:middle
said before, rotate the image

00:29:00.916 --> 00:29:02.946 A:middle
clockwise, counterclockwise.

00:29:03.336 --> 00:29:05.736 A:middle
We can do blur or phase

00:29:05.736 --> 00:29:07.026 A:middle
something into the background.

00:29:07.536 --> 00:29:10.966 A:middle
And you feel, if you feel like

00:29:10.966 --> 00:29:12.136 A:middle
you want to add some retro

00:29:12.136 --> 00:29:13.716 A:middle
feeling to your images, you can

00:29:13.716 --> 00:29:15.376 A:middle
do dithering for black and white

00:29:15.376 --> 00:29:18.026 A:middle
images, and color quantization

00:29:18.206 --> 00:29:19.226 A:middle
for color images.

00:29:20.066 --> 00:29:21.436 A:middle
Let me show you how they look

00:29:21.436 --> 00:29:22.976 A:middle
like in the app.

00:29:36.536 --> 00:29:38.346 A:middle
So, again, I have the slider

00:29:38.346 --> 00:29:40.156 A:middle
here to control the rotation.

00:29:40.916 --> 00:29:44.346 A:middle
I can do rotate counterclockwise

00:29:45.976 --> 00:29:48.586 A:middle
or rotate clockwise.

00:29:49.146 --> 00:29:52.866 A:middle
Now I want to try the blurring

00:29:52.866 --> 00:29:53.206 A:middle
effect.

00:29:53.556 --> 00:29:55.016 A:middle
Let me click on the one here.

00:29:56.026 --> 00:30:01.246 A:middle
And I can apply more blurring or

00:29:56.026 --> 00:30:01.246 A:middle
And I can apply more blurring or

00:30:01.856 --> 00:30:04.116 A:middle
slide to the left, bring the

00:30:04.116 --> 00:30:05.796 A:middle
roses back to the foreground.

00:30:07.756 --> 00:30:10.726 A:middle
For black and white, I can use

00:30:11.596 --> 00:30:11.796 A:middle
dithering.

00:30:12.316 --> 00:30:14.916 A:middle
Now this black and white image,

00:30:15.066 --> 00:30:16.846 A:middle
the gray scale is represented

00:30:16.846 --> 00:30:18.666 A:middle
now by the density of the dots,

00:30:18.886 --> 00:30:19.976 A:middle
that's the dithering effect.

00:30:20.156 --> 00:30:21.766 A:middle
And we use the accents and

00:30:21.916 --> 00:30:24.146 A:middle
dithering algorithm for this,

00:30:24.206 --> 00:30:25.326 A:middle
and I will show you how to do it

00:30:25.326 --> 00:30:28.076 A:middle
later, and for color

00:30:28.076 --> 00:30:29.766 A:middle
quantization, we have lookup

00:30:29.766 --> 00:30:30.126 A:middle
table.

00:30:30.446 --> 00:30:32.626 A:middle
And I can move this slider to

00:30:32.626 --> 00:30:34.186 A:middle
increase the quantization level.

00:30:34.426 --> 00:30:35.996 A:middle
As I move the slider to the

00:30:35.996 --> 00:30:39.006 A:middle
right, fewer and fewer color is

00:30:39.006 --> 00:30:40.646 A:middle
available in this image.

00:30:41.386 --> 00:30:44.766 A:middle
That's sort of creative, that's

00:30:44.766 --> 00:30:46.616 A:middle
how your computer screen looks

00:30:46.616 --> 00:30:49.706 A:middle
like in the '90's or in the

00:30:49.886 --> 00:30:49.996 A:middle
'80's.

00:30:50.486 --> 00:30:50.936 A:middle
All right.

00:30:51.286 --> 00:30:54.306 A:middle
So let me show you how we do

00:30:54.306 --> 00:30:54.516 A:middle
that.

00:30:58.536 --> 00:30:59.836 A:middle
For rotation effect, you can

00:30:59.836 --> 00:31:03.036 A:middle
call vImageRotate and given the

00:30:59.836 --> 00:31:03.036 A:middle
call vImageRotate and given the

00:31:03.036 --> 00:31:05.006 A:middle
angle of rotation, it will do

00:31:05.006 --> 00:31:06.726 A:middle
counterclockwise or clockwise to

00:31:06.726 --> 00:31:07.956 A:middle
better align your images.

00:31:09.276 --> 00:31:11.766 A:middle
For the blur effect, we use

00:31:11.846 --> 00:31:12.536 A:middle
TentConvolve.

00:31:13.676 --> 00:31:15.066 A:middle
The blur effect is controlled by

00:31:15.066 --> 00:31:15.976 A:middle
the size of the kernel.

00:31:16.446 --> 00:31:18.086 A:middle
The larger the kernel, the more

00:31:18.086 --> 00:31:19.746 A:middle
blur you'll get.

00:31:20.916 --> 00:31:22.996 A:middle
Dither effect is basically

00:31:22.996 --> 00:31:25.276 A:middle
converting an 8-bit image into a

00:31:25.276 --> 00:31:26.116 A:middle
1-bit image.

00:31:26.306 --> 00:31:27.446 A:middle
At the same time, you can

00:31:27.446 --> 00:31:29.146 A:middle
specify a dithering algorithm.

00:31:29.736 --> 00:31:30.886 A:middle
In this case, we used the

00:31:30.966 --> 00:31:32.526 A:middle
Atkinson dithering algorithm.

00:31:33.016 --> 00:31:37.646 A:middle
Color quantization, we used the

00:31:37.646 --> 00:31:39.706 A:middle
quantization level to create a

00:31:39.706 --> 00:31:41.536 A:middle
lookup table for the RGB

00:31:41.536 --> 00:31:43.976 A:middle
channel, and we call

00:31:44.076 --> 00:31:46.596 A:middle
vImageTableLookUp to apply this

00:31:46.596 --> 00:31:48.806 A:middle
table lookup to RGB channels to

00:31:48.966 --> 00:31:50.476 A:middle
limit the number of colors on

00:31:50.476 --> 00:31:50.816 A:middle
the screen.

00:31:52.106 --> 00:31:55.606 A:middle
Those are the four additional

00:31:55.606 --> 00:31:56.796 A:middle
effects I wanted to show you,

00:31:57.106 --> 00:31:59.416 A:middle
and I think now is a good time

00:31:59.416 --> 00:32:00.986 A:middle
to move onto the next topic.

00:31:59.416 --> 00:32:00.986 A:middle
to move onto the next topic.

00:32:01.616 --> 00:32:05.446 A:middle
LINPACK Benchmark.

00:32:06.076 --> 00:32:07.866 A:middle
We talked about the

00:32:07.866 --> 00:32:09.426 A:middle
functionality of Accelerate.

00:32:09.986 --> 00:32:12.026 A:middle
We talk about how easy it is to

00:32:12.026 --> 00:32:13.616 A:middle
use in Accelerate in your apps.

00:32:14.456 --> 00:32:16.456 A:middle
We haven't talked about how fast

00:32:16.456 --> 00:32:17.766 A:middle
Accelerate really is.

00:32:18.676 --> 00:32:20.026 A:middle
And LINPACK Benchmark is a

00:32:20.026 --> 00:32:23.326 A:middle
perfect tool to do that.

00:32:23.526 --> 00:32:24.706 A:middle
What is LINPACK Benchmark?

00:32:25.796 --> 00:32:26.826 A:middle
Basically, it's trying to

00:32:26.826 --> 00:32:28.956 A:middle
measure how fast you can solve a

00:32:28.956 --> 00:32:30.446 A:middle
linear system on your machine.

00:32:31.816 --> 00:32:32.586 A:middle
There are actually three

00:32:32.586 --> 00:32:34.526 A:middle
different LINPACK Benchmarks.

00:32:34.686 --> 00:32:36.136 A:middle
The first one is solving a

00:32:36.136 --> 00:32:37.916 A:middle
100-by-100 linear system.

00:32:38.516 --> 00:32:40.086 A:middle
The second one is solving a

00:32:40.086 --> 00:32:41.356 A:middle
1000-by-1000.

00:32:41.706 --> 00:32:44.526 A:middle
The last one, which is the most

00:32:44.526 --> 00:32:46.286 A:middle
interesting one, that's the one

00:32:46.286 --> 00:32:48.236 A:middle
we're going to use today, is no

00:32:48.236 --> 00:32:48.776 A:middle
holds barred.

00:32:49.216 --> 00:32:50.856 A:middle
You can solve as large a system

00:32:50.856 --> 00:32:53.486 A:middle
you want to fully utilize every

00:32:53.486 --> 00:32:54.906 A:middle
last bit of the computational

00:32:54.906 --> 00:32:55.996 A:middle
power on your machine.

00:32:56.496 --> 00:32:59.136 A:middle
Let's see the performance of

00:32:59.436 --> 00:33:01.646 A:middle
iPhone X using Accelerate.

00:32:59.436 --> 00:33:01.646 A:middle
iPhone X using Accelerate.

00:33:02.816 --> 00:33:04.376 A:middle
The performance is measured in

00:33:04.376 --> 00:33:08.226 A:middle
gigaflops, for double precisions

00:33:08.226 --> 00:33:11.696 A:middle
catch up with iPhone 5S, iPhone

00:33:11.696 --> 00:33:18.906 A:middle
6, iPhone 6S, iPhone 7, iPhone X

00:33:18.906 --> 00:33:21.786 A:middle
comes in around 28.7 gigaflops.

00:33:22.346 --> 00:33:23.456 A:middle
That's double precision.

00:33:23.906 --> 00:33:25.346 A:middle
Let's look at single precision.

00:33:26.776 --> 00:33:32.086 A:middle
Again, we run out of space, we

00:33:32.086 --> 00:33:33.646 A:middle
have to shrink to try to make it

00:33:33.686 --> 00:33:34.736 A:middle
come closer.

00:33:36.226 --> 00:33:40.796 A:middle
IPhone X comes in at 68

00:33:40.796 --> 00:33:41.526 A:middle
gigaflops.

00:33:42.776 --> 00:33:44.936 A:middle
Now you might be thinking, this

00:33:44.936 --> 00:33:46.416 A:middle
is not that surprising.

00:33:47.246 --> 00:33:48.826 A:middle
However, it improves over time,

00:33:48.826 --> 00:33:50.816 A:middle
so the performance improves over

00:33:50.816 --> 00:33:53.296 A:middle
time as well, but in fact,

00:33:53.756 --> 00:33:55.156 A:middle
that's only half of the story.

00:33:55.586 --> 00:33:57.496 A:middle
When there is a micro

00:33:57.496 --> 00:33:58.676 A:middle
architecture change to have

00:33:58.676 --> 00:34:00.316 A:middle
additional computational power

00:33:58.676 --> 00:34:00.316 A:middle
additional computational power

00:34:00.316 --> 00:34:02.146 A:middle
into a machine, you need the

00:34:02.146 --> 00:34:03.456 A:middle
matching [inaudible] to fully

00:34:03.456 --> 00:34:05.086 A:middle
utilize this additional

00:34:05.086 --> 00:34:05.956 A:middle
computational power.

00:34:06.726 --> 00:34:07.936 A:middle
And that is where we come in.

00:34:09.016 --> 00:34:11.056 A:middle
Remember, this is the same

00:34:11.056 --> 00:34:12.786 A:middle
LINPACK Benchmark executable

00:34:13.275 --> 00:34:15.076 A:middle
running on all five generations

00:34:15.076 --> 00:34:15.976 A:middle
of iPhones.

00:34:16.505 --> 00:34:17.496 A:middle
They all got the best

00:34:17.496 --> 00:34:19.005 A:middle
performance using Accelerate

00:34:20.326 --> 00:34:22.806 A:middle
without changing a bit.

00:34:23.386 --> 00:34:24.656 A:middle
The same is also true for your

00:34:24.656 --> 00:34:25.076 A:middle
apps.

00:34:25.636 --> 00:34:27.545 A:middle
If you use Accelerate in your

00:34:27.545 --> 00:34:29.315 A:middle
apps, you'll get the best

00:34:29.315 --> 00:34:32.795 A:middle
performance automatically on all

00:34:32.795 --> 00:34:34.096 A:middle
the architectures we support.

00:34:35.416 --> 00:34:38.786 A:middle
Moreover, Accelerate supports

00:34:39.016 --> 00:34:40.386 A:middle
across platforms.

00:34:41.065 --> 00:34:43.525 A:middle
Accelerate works on macOS, iOS,

00:34:43.806 --> 00:34:45.456 A:middle
tvOS, watchOS.

00:34:47.315 --> 00:34:48.996 A:middle
So let's say if tomorrow Apple

00:34:48.996 --> 00:34:49.946 A:middle
comes out with a new

00:34:49.946 --> 00:34:51.996 A:middle
architecture or new platform,

00:34:52.485 --> 00:34:53.436 A:middle
you don't have to worry about

00:34:53.436 --> 00:34:53.636 A:middle
it.

00:34:54.505 --> 00:34:56.606 A:middle
All you need to do, the most

00:34:56.606 --> 00:34:58.596 A:middle
you'll ever need to do is just

00:34:58.596 --> 00:35:00.256 A:middle
to rebuild your apps, link

00:34:58.596 --> 00:35:00.256 A:middle
to rebuild your apps, link

00:35:00.256 --> 00:35:01.406 A:middle
against Accelerate.

00:35:01.806 --> 00:35:03.306 A:middle
You will automatically get the

00:35:03.306 --> 00:35:05.706 A:middle
best performance on the latest

00:35:05.776 --> 00:35:07.036 A:middle
release platform or

00:35:07.036 --> 00:35:07.606 A:middle
architecture.

00:35:08.096 --> 00:35:14.866 A:middle
Just as a summary, we talk about

00:35:14.866 --> 00:35:16.446 A:middle
Accelerate supports a wide

00:35:16.446 --> 00:35:18.026 A:middle
variety of functionalities.

00:35:18.816 --> 00:35:20.166 A:middle
More than likely, you will find

00:35:20.226 --> 00:35:21.036 A:middle
something you need in

00:35:21.036 --> 00:35:21.706 A:middle
Accelerate.

00:35:22.106 --> 00:35:23.936 A:middle
If you need something that's not

00:35:23.936 --> 00:35:25.616 A:middle
available, please feel free to

00:35:25.616 --> 00:35:27.036 A:middle
file feature requests.

00:35:27.426 --> 00:35:29.126 A:middle
We constantly look at this

00:35:29.126 --> 00:35:31.056 A:middle
feature request, evaluate them,

00:35:31.136 --> 00:35:32.246 A:middle
and then put into builds.

00:35:32.846 --> 00:35:34.666 A:middle
Actually, some of our best

00:35:34.666 --> 00:35:36.696 A:middle
features come from feature

00:35:36.696 --> 00:35:37.286 A:middle
requests.

00:35:38.716 --> 00:35:40.576 A:middle
Accelerate is easy to use.

00:35:40.986 --> 00:35:42.646 A:middle
Most of the time it's just one

00:35:42.646 --> 00:35:43.916 A:middle
function call and the job is

00:35:43.916 --> 00:35:44.106 A:middle
done.

00:35:45.516 --> 00:35:47.566 A:middle
It's fast and energy efficient,

00:35:48.216 --> 00:35:50.226 A:middle
so your app is more responsive

00:35:50.506 --> 00:35:52.516 A:middle
and the battery life is longer.

00:35:53.866 --> 00:35:55.486 A:middle
Accelerate is portable across

00:35:55.486 --> 00:35:57.336 A:middle
platforms and architectures.

00:35:57.636 --> 00:35:59.196 A:middle
You get the best performance on

00:35:59.196 --> 00:36:01.676 A:middle
all the platforms we support and

00:35:59.196 --> 00:36:01.676 A:middle
all the platforms we support and

00:36:01.716 --> 00:36:02.906 A:middle
all the architectures we

00:36:02.906 --> 00:36:05.326 A:middle
support, and the best part is,

00:36:05.476 --> 00:36:07.776 A:middle
you don't have to change your

00:36:08.676 --> 00:36:08.796 A:middle
code.

00:36:09.126 --> 00:36:10.526 A:middle
For more information, you can go

00:36:10.526 --> 00:36:12.376 A:middle
to our online documentation at

00:36:12.376 --> 00:36:15.266 A:middle
developer.apple.com, and all our

00:36:15.706 --> 00:36:17.506 A:middle
demo apps, simple code, and

00:36:17.536 --> 00:36:18.556 A:middle
session material will be

00:36:18.556 --> 00:36:19.616 A:middle
available online.

00:36:20.646 --> 00:36:22.266 A:middle
We have a lab session tomorrow

00:36:22.266 --> 00:36:23.486 A:middle
afternoon at 2.

00:36:24.236 --> 00:36:25.196 A:middle
I look forward to seeing you

00:36:25.196 --> 00:36:26.036 A:middle
guys there.

00:36:26.036 --> 00:36:27.956 A:middle
If you have any questions or you

00:36:27.956 --> 00:36:28.956 A:middle
want to learn more about

00:36:28.956 --> 00:36:31.106 A:middle
Accelerate, I'd love to see you

00:36:31.106 --> 00:36:31.286 A:middle
there.

00:36:33.116 --> 00:36:34.716 A:middle
That's all for our presentation

00:36:34.716 --> 00:36:35.096 A:middle
today.

00:36:35.096 --> 00:36:36.176 A:middle
Thank you all for coming.

00:36:36.376 --> 00:36:36.976 A:middle
Have a great day.

00:36:37.516 --> 00:36:40.500 A:middle
[ Applause ]
