WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:00:08.416 --> 00:00:09.326 A:middle
&gt;&gt; Good morning.

00:00:10.266 --> 00:00:12.406 A:middle
My name is Jon Lee.

00:00:12.406 --> 00:00:15.576 A:middle
I am a manager on the
Safari and WebKit team.

00:00:16.356 --> 00:00:18.936 A:middle
This is Session 614 and
you are here to learn

00:00:18.936 --> 00:00:23.126 A:middle
about Implementing OS X Push
Notifications for Websites.

00:00:23.896 --> 00:00:28.526 A:middle
You know, since iOS 3 and
OS X Lion, you've been able

00:00:28.526 --> 00:00:32.375 A:middle
to integrate push notifications
into your native apps.

00:00:32.546 --> 00:00:34.576 A:middle
And boy, do users love them.

00:00:34.876 --> 00:00:40.026 A:middle
Apple has sent over 7.4 trillion
push notifications to users.

00:00:40.436 --> 00:00:43.096 A:middle
So, clearly, users love
getting push notifications

00:00:43.396 --> 00:00:44.396 A:middle
on their devices.

00:00:45.046 --> 00:00:45.706 A:middle
So why is that?

00:00:45.706 --> 00:00:48.066 A:middle
Well, I love push notifications

00:00:48.106 --> 00:00:51.246 A:middle
because push notifications
gives me the information

00:00:51.246 --> 00:00:54.136 A:middle
that I really want to know
about and the app tells me

00:00:54.286 --> 00:00:56.326 A:middle
that information at
the best time it is

00:00:56.326 --> 00:00:57.986 A:middle
for me get it which
is immediately.

00:00:58.116 --> 00:01:00.816 A:middle
I don't have to open
up the app every time

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:01:00.816 --> 00:01:01.836 A:middle
that I want to see an update.

00:01:02.406 --> 00:01:04.556 A:middle
So, like for example I was
doing a dress rehearsal

00:01:04.556 --> 00:01:05.726 A:middle
for this session last week

00:01:05.726 --> 00:01:08.326 A:middle
and I was having some trouble
finding the conference room

00:01:08.326 --> 00:01:10.746 A:middle
that I needed to be at, and so I
was trying to go through my mail

00:01:11.116 --> 00:01:13.576 A:middle
to find those directions to
get to the conference room.

00:01:14.256 --> 00:01:17.296 A:middle
And a friend of mine actually
texted me, telling me exactly

00:01:17.296 --> 00:01:20.366 A:middle
where I needed to go and that
was great because I didn't have

00:01:20.446 --> 00:01:23.466 A:middle
to be in the messages app in
that conversation in order

00:01:23.466 --> 00:01:26.256 A:middle
to be able to know where
to go and for me to get

00:01:26.256 --> 00:01:27.416 A:middle
to my dress rehearsal on time.

00:01:28.576 --> 00:01:34.386 A:middle
Push notifications are fantastic
because even if I'm asleep

00:01:34.386 --> 00:01:37.166 A:middle
or my phone's on silent, or
it's just not a good time for me

00:01:37.166 --> 00:01:38.106 A:middle
to attend to my phone,

00:01:38.396 --> 00:01:40.076 A:middle
I know that all those
notification are going

00:01:40.076 --> 00:01:41.686 A:middle
to be grouped to in
Notifications Center

00:01:41.906 --> 00:01:43.846 A:middle
and that place is
super easy to access.

00:01:44.126 --> 00:01:49.366 A:middle
Anywhere on iOS, I can
just swipe down on my phone

00:01:49.696 --> 00:01:52.206 A:middle
and I will see that
push notifications

00:01:52.376 --> 00:01:55.436 A:middle
that were most recently posted
per app grouped together

00:01:55.696 --> 00:01:56.776 A:middle
in Notifications Center.

00:01:56.976 --> 00:01:59.666 A:middle
And this is great, not
just because I know exactly

00:01:59.666 --> 00:02:01.426 A:middle
where to go to get
my notifications,

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:02:01.876 --> 00:02:04.456 A:middle
but because seeing
the collection

00:02:04.456 --> 00:02:07.486 A:middle
of those notifications
per app kind of gives me--

00:02:07.486 --> 00:02:09.346 A:middle
it tells me a story, it
gives me some context

00:02:09.596 --> 00:02:11.246 A:middle
about what the app
is trying to tell me.

00:02:12.336 --> 00:02:15.416 A:middle
And if one of those
notifications are of interest

00:02:15.416 --> 00:02:18.046 A:middle
to me, I can just swipe on
that notification or tap on it

00:02:18.256 --> 00:02:21.706 A:middle
and iOS will take me
right back to the app

00:02:22.006 --> 00:02:24.376 A:middle
and show me more details
about that notification.

00:02:24.596 --> 00:02:28.916 A:middle
Finally, I love push
notifications because I get

00:02:28.916 --> 00:02:32.056 A:middle
to fully control when
and how I receive them.

00:02:33.206 --> 00:02:35.536 A:middle
So, like I want to install
a new app and I launch it,

00:02:35.866 --> 00:02:37.926 A:middle
I don't automatically
get subscribed

00:02:38.136 --> 00:02:41.096 A:middle
to that app's push
notifications, I get asked.

00:02:41.506 --> 00:02:45.226 A:middle
And if I accept the invitation
to get those push notifications

00:02:45.636 --> 00:02:49.336 A:middle
and the app ends up
sending me too many of them,

00:02:49.666 --> 00:02:51.096 A:middle
I have so many different
choices.

00:02:51.096 --> 00:02:54.556 A:middle
The app might provide me
some granularity over like

00:02:54.556 --> 00:02:56.836 A:middle
when I want to receive
those push notifications.

00:02:57.066 --> 00:03:00.416 A:middle
I could turn those
notifications off completely.

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:03:00.446 --> 00:03:02.056 A:middle
If it's just that
the time isn't right,

00:03:02.056 --> 00:03:03.816 A:middle
I can turn on "do not disturb"

00:03:04.136 --> 00:03:06.436 A:middle
or as a last resort
I could delete

00:03:06.436 --> 00:03:07.886 A:middle
or uninstall the
app on my phone.

00:03:09.486 --> 00:03:14.446 A:middle
So, those are the reasons that I
love push notifications for all

00:03:15.596 --> 00:03:17.286 A:middle
of the native apps
that you write.

00:03:17.956 --> 00:03:20.686 A:middle
But I bet for many of you,

00:03:20.686 --> 00:03:24.496 A:middle
not only do you have
amazing native apps,

00:03:24.766 --> 00:03:27.136 A:middle
but you also have
amazing websites.

00:03:28.526 --> 00:03:33.486 A:middle
So, new in Safari 7 on OS X
Mavericks, I'm really excited

00:03:33.486 --> 00:03:37.606 A:middle
to announce that your website
can now send push notifications

00:03:37.606 --> 00:03:38.786 A:middle
to your Mac users.

00:03:39.006 --> 00:03:41.896 A:middle
This is great because just
like push notifications

00:03:41.896 --> 00:03:44.416 A:middle
on native apps, your users
can fully control when

00:03:44.416 --> 00:03:46.946 A:middle
and how they receive
their push notifications.

00:03:47.956 --> 00:03:52.456 A:middle
And push notifications are just
the thing to put in your website

00:03:52.486 --> 00:03:54.586 A:middle
to get users to return
to your website.

00:03:54.586 --> 00:03:57.026 A:middle
And for those of you with
websites that are ad supported,

00:03:57.286 --> 00:03:58.346 A:middle
that means real revenue.

00:03:58.346 --> 00:04:02.796 A:middle
So, in this morning
session, I like to go

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:04:02.796 --> 00:04:03.466 A:middle
through the four things.

00:04:04.026 --> 00:04:08.276 A:middle
The first is to get some
background about notifications.

00:04:08.466 --> 00:04:13.186 A:middle
The second is to learn how
it works behind the scenes.

00:04:13.326 --> 00:04:14.976 A:middle
And third is to see how

00:04:14.976 --> 00:04:17.026 A:middle
to implement push
notifications for your website.

00:04:17.026 --> 00:04:20.386 A:middle
And the fourth is to talk
about some best practices.

00:04:20.966 --> 00:04:22.486 A:middle
So, let's get started.

00:04:23.426 --> 00:04:26.056 A:middle
One thing you may
not already know is

00:04:26.056 --> 00:04:28.386 A:middle
that you actually can
send notifications

00:04:28.386 --> 00:04:33.276 A:middle
to your websites on-- can send
notifications to your users

00:04:33.556 --> 00:04:36.656 A:middle
on their desktop in
Safari 6 on Mountain Lion.

00:04:36.906 --> 00:04:39.436 A:middle
They're called "Local Web
Notifications" and it's based

00:04:39.436 --> 00:04:43.456 A:middle
on the specification by the W3C
Web Notification Working Group.

00:04:43.716 --> 00:04:47.396 A:middle
Local Web Notifications and
Push Notifications are websites

00:04:47.396 --> 00:04:49.616 A:middle
that are actually
quite different

00:04:50.286 --> 00:04:52.636 A:middle
from like assistance
perspective.

00:04:52.906 --> 00:04:55.056 A:middle
So when the user goes
to your web page,

00:04:55.116 --> 00:04:57.526 A:middle
your web page will
contain some JavaScript

00:04:57.526 --> 00:05:01.036 A:middle
that actually tell Safari
to send those notifications

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:05:01.036 --> 00:05:03.266 A:middle
to the user's Notification
Center.

00:05:03.676 --> 00:05:07.336 A:middle
Whereas with push notifications,
it's actually your server,

00:05:07.336 --> 00:05:10.346 A:middle
which we call a Push Server
that send those notifications

00:05:10.346 --> 00:05:13.486 A:middle
to a service that Apple controls
called Apple Push Notification

00:05:13.486 --> 00:05:14.626 A:middle
Service or APNS.

00:05:15.316 --> 00:05:19.276 A:middle
And APNS knows how to directly
connect to your user's Mac

00:05:19.656 --> 00:05:21.286 A:middle
to send that push notification.

00:05:21.926 --> 00:05:26.136 A:middle
But more than just from
like assistance perspective,

00:05:26.456 --> 00:05:29.786 A:middle
local notifications
and push notifications

00:05:29.786 --> 00:05:33.686 A:middle
on websites are actually
managed very differently for--

00:05:33.726 --> 00:05:35.406 A:middle
on the user's Macs.

00:05:35.636 --> 00:05:40.436 A:middle
For example, a web page can only
send a notification while the

00:05:40.436 --> 00:05:42.246 A:middle
user is open to your website.

00:05:42.826 --> 00:05:45.926 A:middle
Whereas with push notifications,
they can be send at any time.

00:05:45.956 --> 00:05:48.016 A:middle
The user doesn't have
to be on your website.

00:05:48.206 --> 00:05:50.276 A:middle
The user doesn't even
have to have Safari open.

00:05:51.256 --> 00:05:55.686 A:middle
And likewise, if the user
exits out of your website

00:05:55.686 --> 00:05:58.146 A:middle
or quit Safari, all
the local notifications

00:05:58.146 --> 00:05:59.736 A:middle
that you posted actually
disappear.

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:06:00.166 --> 00:06:02.736 A:middle
Whereas with push notifications,
it doesn't matter,

00:06:02.936 --> 00:06:06.156 A:middle
they're always are right for
them for your users to see.

00:06:07.416 --> 00:06:09.966 A:middle
Next, the notifications
that get shown

00:06:09.966 --> 00:06:12.596 A:middle
on the desktop are a little--

00:06:12.596 --> 00:06:13.956 A:middle
are presented a little
bit differently.

00:06:13.956 --> 00:06:18.096 A:middle
For local notifications, because
it's Safari that's sending those

00:06:18.096 --> 00:06:20.926 A:middle
notifications that actually
gets the Safari icon,

00:06:21.366 --> 00:06:23.376 A:middle
and to give some more
detail about like

00:06:23.376 --> 00:06:25.876 A:middle
where that notification
came from, we kind of put

00:06:25.876 --> 00:06:28.426 A:middle
in the subtitle of the
notification, your domain name.

00:06:29.266 --> 00:06:31.386 A:middle
A contrast that would
push notifications

00:06:31.386 --> 00:06:34.066 A:middle
which actually use your website
icons, so there's no need

00:06:34.066 --> 00:06:37.636 A:middle
to have kind of add this extra
information, they know exactly

00:06:37.636 --> 00:06:39.596 A:middle
where that push notification
came from.

00:06:40.066 --> 00:06:43.686 A:middle
Next, local notifications end

00:06:43.916 --> 00:06:47.476 A:middle
up all being group underneath
the section for Safari,

00:06:48.686 --> 00:06:51.586 A:middle
which means that like if the
user has a lot of websites open

00:06:51.586 --> 00:06:54.556 A:middle
that are using local
notifications, they all end

00:06:55.086 --> 00:06:57.276 A:middle
up getting kind of
shuffled together

00:06:57.276 --> 00:06:59.446 A:middle
and your notification
might get lost in the mix.

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:07:00.276 --> 00:07:02.976 A:middle
Contrast that with
push notifications,

00:07:03.216 --> 00:07:07.006 A:middle
your website actually gets
its own dedicated center

00:07:07.266 --> 00:07:08.736 A:middle
in Notification Center.

00:07:08.736 --> 00:07:11.066 A:middle
So, you website is actually
treated just the same

00:07:11.066 --> 00:07:13.216 A:middle
as your apps.

00:07:14.156 --> 00:07:17.216 A:middle
Finally, when you click
on a notification,

00:07:17.666 --> 00:07:21.406 A:middle
for local notifications,
it actually takes the user

00:07:21.406 --> 00:07:23.616 A:middle
to the tab that actually
sent that notification

00:07:23.616 --> 00:07:27.206 A:middle
that makes it front most
on the user's desktop.

00:07:28.596 --> 00:07:31.126 A:middle
With push notifications,
since Safari might not have--

00:07:31.206 --> 00:07:34.676 A:middle
be actually be open, clicking
on that notification is exactly

00:07:34.676 --> 00:07:35.916 A:middle
like clicking on a link.

00:07:35.996 --> 00:07:39.486 A:middle
And so, it just opens it up
to your website to a web page

00:07:39.486 --> 00:07:44.086 A:middle
that provides more detail
about that notification.

00:07:44.936 --> 00:07:47.116 A:middle
All right, so we just
talked about the differences

00:07:47.176 --> 00:07:48.946 A:middle
between push notification--

00:07:49.006 --> 00:07:52.506 A:middle
local notifications and push
notifications for websites.

00:07:52.876 --> 00:07:55.316 A:middle
What about the difference
between push notifications

00:07:55.366 --> 00:07:58.646 A:middle
for your native apps and push
notifications for websites?

00:07:59.236 --> 00:08:00.376 A:middle
Well, you don't even
have to worry

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:08:00.376 --> 00:08:01.876 A:middle
about memorizing this table

00:08:01.876 --> 00:08:03.336 A:middle
because they're actually
the same.

00:08:03.766 --> 00:08:06.936 A:middle
We've done everything we
can from your point of view

00:08:07.086 --> 00:08:10.756 A:middle
as a developer to make
push notifications

00:08:10.756 --> 00:08:13.316 A:middle
between your native app and your
website the exact same thing.

00:08:14.106 --> 00:08:17.176 A:middle
So, just to go through it
quickly, for native apps

00:08:17.176 --> 00:08:20.506 A:middle
and websites, your push
notifications can be delivered

00:08:20.506 --> 00:08:24.046 A:middle
at any time, the Apple website
does not have to be open.

00:08:24.046 --> 00:08:27.606 A:middle
The notification gets labeled
with your app or websites' icon.

00:08:28.256 --> 00:08:33.106 A:middle
They get grouped together
based on their app or website

00:08:33.426 --> 00:08:36.076 A:middle
to their own dedicated section
and Notification Center,

00:08:36.385 --> 00:08:39.066 A:middle
and clicking on them opens up
the app or the website to take--

00:08:39.066 --> 00:08:41.956 A:middle
to give them more detail
about that notification.

00:08:43.236 --> 00:08:44.996 A:middle
So, my last thing
about background,

00:08:44.996 --> 00:08:48.126 A:middle
I just kind of wanted to talk
about how the operating system,

00:08:48.126 --> 00:08:52.046 A:middle
make sure that nobody else is
trying to forge anything you do

00:08:52.046 --> 00:08:55.626 A:middle
and talking about basically
verifying your identity.

00:08:56.586 --> 00:08:59.936 A:middle
And the best way to talk
about this with respect

00:08:59.936 --> 00:09:02.576 A:middle
to push notifications
for website is

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:09:02.576 --> 00:09:04.196 A:middle
to see how it works in apps.

00:09:04.726 --> 00:09:07.366 A:middle
So, in order for user to
have push notifications

00:09:07.366 --> 00:09:09.096 A:middle
for your apps, there are two
things that you need, right?

00:09:09.186 --> 00:09:13.176 A:middle
You need your app that you've
submitted to the App Store

00:09:13.726 --> 00:09:15.916 A:middle
and then you need your
server, your push server

00:09:15.916 --> 00:09:18.186 A:middle
that actually sends
those push notifications

00:09:18.496 --> 00:09:20.096 A:middle
to the user's devices.

00:09:20.566 --> 00:09:22.786 A:middle
So how does Apple
know that the app

00:09:23.226 --> 00:09:25.356 A:middle
and the server actually
both come from you?

00:09:25.736 --> 00:09:30.166 A:middle
Well, Apple does this through
the use of certificates.

00:09:30.386 --> 00:09:33.126 A:middle
With the private key of a
certificate that you get

00:09:33.276 --> 00:09:37.556 A:middle
from the developer portal, you
can create a digital signature

00:09:37.556 --> 00:09:41.576 A:middle
that only you can create and
that Apple verifies in order

00:09:41.576 --> 00:09:43.666 A:middle
to make sure that you
are who you say you are.

00:09:44.526 --> 00:09:48.586 A:middle
And when it's time to actually
send a push notification

00:09:48.586 --> 00:09:53.736 A:middle
to APNS, your push server uses
a second certificate but also

00:09:53.736 --> 00:09:57.856 A:middle
from the developer portal to
that-- to connect to APNS.

00:09:58.206 --> 00:10:02.616 A:middle
And when those notifications
are sent, APNS knows that--

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:10:03.046 --> 00:10:04.516 A:middle
from that certificate that you--

00:10:04.636 --> 00:10:07.936 A:middle
that the push notifications
are coming from you.

00:10:08.586 --> 00:10:16.236 A:middle
So together, Apple knows that it
is you that's controlling your

00:10:16.236 --> 00:10:20.706 A:middle
user's experience with your
app and its push notifications.

00:10:21.856 --> 00:10:24.896 A:middle
So now, what about
website identity?

00:10:25.226 --> 00:10:28.066 A:middle
You don't bundle your
website together, right?

00:10:28.066 --> 00:10:29.756 A:middle
Like anybody can
create a website

00:10:29.756 --> 00:10:31.576 A:middle
and you don't submit
your website

00:10:31.576 --> 00:10:33.276 A:middle
to a Apple Website Store.

00:10:33.666 --> 00:10:37.296 A:middle
So how does Apple
know that it is you

00:10:37.296 --> 00:10:39.306 A:middle
and that you are authorized

00:10:39.306 --> 00:10:40.936 A:middle
to actually send
push notifications?

00:10:43.576 --> 00:10:48.246 A:middle
Well, what we do is we ask your
web server to create an identity

00:10:48.246 --> 00:10:51.726 A:middle
that represents your website and
we call that a "push package".

00:10:51.966 --> 00:10:56.126 A:middle
And it's that push package
that you sign using something

00:10:56.126 --> 00:10:58.436 A:middle
that we call a website
Push Certificate

00:10:58.436 --> 00:11:01.796 A:middle
and you create your digital
signature and this signature

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:11:01.796 --> 00:11:03.616 A:middle
and the push package
gets sent to Safari

00:11:03.616 --> 00:11:06.806 A:middle
and Safari will actually
do that check to make sure

00:11:06.806 --> 00:11:10.186 A:middle
that you are authorized to
send push notifications.

00:11:10.866 --> 00:11:14.306 A:middle
And then when it's time to send
those notifications to APNS,

00:11:14.836 --> 00:11:16.746 A:middle
you use that exact
same certificate

00:11:16.746 --> 00:11:17.986 A:middle
to connect to the service.

00:11:17.986 --> 00:11:20.676 A:middle
So it's actually easier to
implement push notifications

00:11:20.866 --> 00:11:23.866 A:middle
on websites because you only
have to manage one cert whereas

00:11:23.866 --> 00:11:25.006 A:middle
with apps, you have
to manage two.

00:11:25.276 --> 00:11:31.696 A:middle
All right, so that's a
little about the background.

00:11:32.496 --> 00:11:34.826 A:middle
Let's talk about how it works.

00:11:36.486 --> 00:11:39.296 A:middle
I'm going to take your through
two important things I need

00:11:39.296 --> 00:11:39.796 A:middle
to happen.

00:11:39.976 --> 00:11:41.286 A:middle
If you understand
these two things,

00:11:41.286 --> 00:11:42.396 A:middle
you understand the feature.

00:11:43.536 --> 00:11:45.726 A:middle
The first is how users subscribe

00:11:45.776 --> 00:11:47.546 A:middle
to your website's
push notifications.

00:11:47.936 --> 00:11:52.076 A:middle
So, once you've adopted the
feature, websites that go

00:11:52.076 --> 00:11:56.176 A:middle
to your website-- users that
go to your website on Safari 7,

00:11:56.766 --> 00:12:02.116 A:middle
on Mavericks, will see an
invitation to subscribe

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:12:02.116 --> 00:12:04.856 A:middle
to your website's
push notification.

00:12:05.106 --> 00:12:07.126 A:middle
If they accept that invitation,

00:12:07.126 --> 00:12:09.606 A:middle
Safari will then
contact your server

00:12:09.646 --> 00:12:11.016 A:middle
for your service credentials.

00:12:11.136 --> 00:12:12.936 A:middle
And you're going to return
those credentials in the form

00:12:13.196 --> 00:12:15.116 A:middle
of that push package that
I talked about earlier.

00:12:16.386 --> 00:12:21.376 A:middle
Safari will then validate
the data in your push package

00:12:21.376 --> 00:12:22.616 A:middle
and verify your identity.

00:12:23.806 --> 00:12:27.386 A:middle
And if that succeeds, then
it's going to prompt the user

00:12:27.386 --> 00:12:29.816 A:middle
to confirm their subscription.

00:12:30.726 --> 00:12:33.466 A:middle
When the user confirms that
they want to subscribe,

00:12:34.066 --> 00:12:36.736 A:middle
then Safari will send
something called a device token

00:12:37.056 --> 00:12:39.896 A:middle
to your server and
tells your server

00:12:39.896 --> 00:12:41.356 A:middle
to register that device token.

00:12:41.736 --> 00:12:45.946 A:middle
And this device token is just a
string that Apple uses in order

00:12:45.946 --> 00:12:49.546 A:middle
to target that users Mac.

00:12:53.836 --> 00:12:57.346 A:middle
By the way, if the user wants to
change their and then they want

00:12:57.346 --> 00:13:00.106 A:middle
to unsubscribe from
your push notifications,

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:13:00.106 --> 00:13:01.496 A:middle
they can go Safari preferences

00:13:01.696 --> 00:13:02.956 A:middle
and they click a
little radio button

00:13:02.956 --> 00:13:05.096 A:middle
that says they deny
permission, meaning they want

00:13:05.096 --> 00:13:09.726 A:middle
to unsubscribe, and then Safari
will make that exact same call

00:13:09.726 --> 00:13:11.906 A:middle
of the device token except
this time it'll tell you

00:13:11.906 --> 00:13:14.126 A:middle
to un-register and we
expect you to delete

00:13:14.126 --> 00:13:16.236 A:middle
that device token
from your server.

00:13:16.816 --> 00:13:19.926 A:middle
OK. So that's the first.

00:13:19.926 --> 00:13:21.176 A:middle
The second thing was-- is

00:13:21.176 --> 00:13:23.046 A:middle
about delivering those
push notifications.

00:13:23.046 --> 00:13:25.246 A:middle
So, now that your server
has the device token

00:13:25.596 --> 00:13:28.106 A:middle
and the notification
itself called the

00:13:28.106 --> 00:13:29.886 A:middle
"Message Payload"
we combine them

00:13:29.996 --> 00:13:32.406 A:middle
and create what we call
notification packet

00:13:32.816 --> 00:13:35.416 A:middle
and you're going to
deliver that to APNS

00:13:35.746 --> 00:13:39.516 A:middle
over a secure protocol using
that website push certificate.

00:13:39.786 --> 00:13:43.346 A:middle
APNS looks at the device token
and knows exactly how to connect

00:13:43.346 --> 00:13:47.266 A:middle
to the users Mac and that
notification gets displayed

00:13:47.266 --> 00:13:49.046 A:middle
in the user's Notification
Center.

00:13:50.016 --> 00:13:54.076 A:middle
If the user decides to
click on that notification,

00:13:54.416 --> 00:13:57.386 A:middle
it's just like clicking on
a link, so it takes them

00:13:57.386 --> 00:14:05.356 A:middle
to a web page in Safari or the
user's default web browser.

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:14:05.526 --> 00:14:07.566 A:middle
OK. So we talked about
these two things,

00:14:07.566 --> 00:14:08.896 A:middle
let's see how they
work in action.

00:14:08.896 --> 00:14:10.596 A:middle
So I'd like to bring
up Brian Weinstein,

00:14:10.596 --> 00:14:12.106 A:middle
the engineer on the Safari team.

00:14:12.476 --> 00:14:13.106 A:middle
&gt;&gt; Thanks Jon.

00:14:13.536 --> 00:14:17.056 A:middle
Now, I am Brian Weinstein, an
engineer of the Safari team

00:14:17.406 --> 00:14:19.006 A:middle
and I'm going to show you what--

00:14:19.766 --> 00:14:22.336 A:middle
how interacting with push
notifications will work

00:14:22.336 --> 00:14:23.396 A:middle
for your users.

00:14:23.696 --> 00:14:27.856 A:middle
So, we've made up
a website to show

00:14:27.856 --> 00:14:30.606 A:middle
of this feature,
bayairlines.com.

00:14:30.966 --> 00:14:35.466 A:middle
And I have a flight to Boston
later tonight and I would

00:14:35.466 --> 00:14:38.246 A:middle
like to be updated about
information about my flight.

00:14:38.686 --> 00:14:42.986 A:middle
So, as you can see we have
a visual affordance to sign

00:14:42.986 --> 00:14:44.336 A:middle
up for push notifications

00:14:44.716 --> 00:14:48.336 A:middle
and when you click the
Subscribe button, we show--

00:14:48.526 --> 00:14:54.876 A:middle
Safari shows an alert asking
me whether or not I would

00:14:54.876 --> 00:14:56.876 A:middle
like to subscribe for
push notifications.

00:14:57.506 --> 00:15:00.876 A:middle
And it is branded
with the websites icon

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:15:01.146 --> 00:15:02.326 A:middle
and the website's name.

00:15:03.696 --> 00:15:06.396 A:middle
When I choose Allow, you can see

00:15:06.396 --> 00:15:09.576 A:middle
that the user interface
has automatically updated

00:15:09.766 --> 00:15:11.986 A:middle
to give me some preferences
for what kind

00:15:11.986 --> 00:15:14.266 A:middle
of notifications I
would like to listen to.

00:15:15.006 --> 00:15:18.686 A:middle
So, let's say I'm at the
airport, I'm having some food

00:15:18.686 --> 00:15:21.306 A:middle
and I would just like to
know when my gate changes

00:15:21.466 --> 00:15:25.206 A:middle
so I can find out if I need
to head somewhere else.

00:15:25.716 --> 00:15:27.926 A:middle
What I can do is I can
subscribe for notifications

00:15:27.926 --> 00:15:31.416 A:middle
when my boarding gate is changed
and then I can just quit Safari.

00:15:31.986 --> 00:15:35.216 A:middle
And what's so powerful about
these push notifications is

00:15:35.216 --> 00:15:38.496 A:middle
that they can be delivered
even when Safari isn't running.

00:15:39.086 --> 00:15:41.366 A:middle
And you can see that I
was given a gate change

00:15:42.286 --> 00:15:45.476 A:middle
and it gives me the new gate.

00:15:45.476 --> 00:15:48.796 A:middle
And if I want to find a little
more about that notification,

00:15:49.126 --> 00:15:52.856 A:middle
I can open up Notification
Center, select the Notification

00:15:53.176 --> 00:15:54.456 A:middle
and it will launch Safari

00:15:54.456 --> 00:15:56.286 A:middle
and give me even
more information

00:15:56.556 --> 00:15:57.876 A:middle
about my gate change.

00:15:58.146 --> 00:16:01.406 A:middle
And some other things that are
great about push notifications

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:16:01.406 --> 00:16:04.346 A:middle
for websites is that they
are first class citizens

00:16:04.856 --> 00:16:08.096 A:middle
in the rest of Mavericks UI.

00:16:08.646 --> 00:16:11.336 A:middle
So, if I open the
notifications preference pane,

00:16:11.656 --> 00:16:15.216 A:middle
you can see that Bay Airlines
is listed right alongside all

00:16:15.216 --> 00:16:17.826 A:middle
of the other apps with
your website icon.

00:16:18.556 --> 00:16:22.216 A:middle
And this is where you can change
how you can configure how your

00:16:22.216 --> 00:16:25.176 A:middle
alerts are delivered either
in better form or alert form,

00:16:25.476 --> 00:16:26.906 A:middle
and you can also look at--

00:16:27.266 --> 00:16:31.296 A:middle
you can also adjust how
many notifications you see

00:16:31.296 --> 00:16:32.456 A:middle
in Notification Center.

00:16:33.226 --> 00:16:37.806 A:middle
And if you want to change
your notification preferences

00:16:37.806 --> 00:16:40.726 A:middle
altogether in terms of
unsubscribing or subscribing,

00:16:41.186 --> 00:16:43.416 A:middle
you do that through
Safari's preferences

00:16:43.416 --> 00:16:45.986 A:middle
where every website
you signed up for--

00:16:45.986 --> 00:16:48.756 A:middle
I've signed up for
push notifications

00:16:48.756 --> 00:16:51.496 A:middle
for are listed here
and I can either Allow

00:16:51.496 --> 00:16:53.926 A:middle
or Deny push notifications
through there.

00:16:54.466 --> 00:16:56.146 A:middle
And so, that is what
push notifications

00:16:56.146 --> 00:16:57.306 A:middle
for websites looks like.

00:16:58.156 --> 00:17:00.326 A:middle
And now we're going to
learn a little bit more

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:17:00.326 --> 00:17:01.446 A:middle
about how to implement it.

00:17:01.446 --> 00:17:03.856 A:middle
And now, I'd like to
hand it back to Jon.

00:17:04.171 --> 00:17:06.171 A:middle
[applause]

00:17:06.486 --> 00:17:07.556 A:middle
&gt;&gt; So we've learned a little bit

00:17:07.556 --> 00:17:09.136 A:middle
about how it works behind
the scenes, let's figure

00:17:09.136 --> 00:17:10.586 A:middle
out how to implement it.

00:17:12.715 --> 00:17:14.185 A:middle
There are two things
that you need to do.

00:17:14.185 --> 00:17:16.486 A:middle
The first is actually
to get a certificate

00:17:16.486 --> 00:17:17.776 A:middle
from the developer portal.

00:17:17.776 --> 00:17:19.886 A:middle
And don't worry, I will
take you through every step

00:17:20.356 --> 00:17:22.256 A:middle
to get those-- that certificate.

00:17:22.256 --> 00:17:23.665 A:middle
And the second thing is you need

00:17:23.665 --> 00:17:25.955 A:middle
to add notification
support to your server.

00:17:26.266 --> 00:17:27.566 A:middle
And what do I mean by that?

00:17:27.566 --> 00:17:31.906 A:middle
Well, the server actually kind
of serves three different roles

00:17:31.906 --> 00:17:34.456 A:middle
and you need to implement
support for each of those roles.

00:17:35.676 --> 00:17:38.716 A:middle
The first is you need to ask
the user on your website,

00:17:38.716 --> 00:17:40.376 A:middle
you need to invite
them to subscribe

00:17:40.376 --> 00:17:41.576 A:middle
to your push notifications.

00:17:42.006 --> 00:17:44.286 A:middle
You need to write a web
service back end and then

00:17:44.286 --> 00:17:46.376 A:middle
when it's time you need to
send them push notifications.

00:17:46.636 --> 00:17:49.676 A:middle
But a better way to kind of
think about these three tasks is

00:17:49.676 --> 00:17:54.516 A:middle
that the first is how
your website communicates

00:17:54.516 --> 00:17:57.046 A:middle
to your users that you've
got this great feature,

00:17:57.776 --> 00:17:59.816 A:middle
the second is how
Safari communicates

00:17:59.816 --> 00:18:02.986 A:middle
with your web server, and the
third is how your web server

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:18:02.986 --> 00:18:05.846 A:middle
communicates with APNS to
deliver those notifications.

00:18:06.826 --> 00:18:10.126 A:middle
So first, let's talk about
getting that Push certificate.

00:18:11.016 --> 00:18:12.386 A:middle
Getting a push certificate,

00:18:12.386 --> 00:18:14.206 A:middle
super simple, it's
just two steps.

00:18:14.206 --> 00:18:15.826 A:middle
One, you have to
Register a put--

00:18:15.826 --> 00:18:17.396 A:middle
website Push ID and
the second it

00:18:17.436 --> 00:18:20.556 A:middle
to create a certificate
based on that push ID.

00:18:20.916 --> 00:18:22.236 A:middle
So, in the developer portal,

00:18:22.236 --> 00:18:25.486 A:middle
you go to the certificate's
identifiers and profiles page

00:18:25.656 --> 00:18:28.896 A:middle
and on the left hand side
you will see a new item

00:18:28.896 --> 00:18:31.406 A:middle
that allows you to
register a website push ID,

00:18:31.406 --> 00:18:33.976 A:middle
just click on that Plus button
in the upper right hand corner

00:18:33.976 --> 00:18:37.186 A:middle
and you'll be taken to a
form where you need to put

00:18:37.186 --> 00:18:38.396 A:middle
in two pieces of information.

00:18:38.656 --> 00:18:42.936 A:middle
Both of these pieces of
information are just names.

00:18:43.226 --> 00:18:44.856 A:middle
It's just for different
audiences.

00:18:44.856 --> 00:18:47.666 A:middle
So the first one is just
human readable description

00:18:47.666 --> 00:18:49.666 A:middle
and this description
is just for you.

00:18:49.666 --> 00:18:51.906 A:middle
It'll be used throughout
the developer portal

00:18:51.906 --> 00:18:54.186 A:middle
but Safari won't see it,
your users won't see it,

00:18:54.186 --> 00:18:55.836 A:middle
your server won't see it.

00:18:56.676 --> 00:19:00.866 A:middle
The second is how your--
how the code actually knows

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:19:00.866 --> 00:19:03.466 A:middle
about your website or can
identify your website.

00:19:03.976 --> 00:19:05.996 A:middle
And we recommend the use
a reverse domain string.

00:19:06.286 --> 00:19:07.906 A:middle
The developer portal will
make sure that it's got

00:19:07.936 --> 00:19:11.446 A:middle
that web prefix, and that's it.

00:19:11.446 --> 00:19:13.506 A:middle
We just registered the push ID.

00:19:13.636 --> 00:19:15.886 A:middle
Now, let's create
the certificate.

00:19:15.886 --> 00:19:17.196 A:middle
So, you're going
to go into settings

00:19:17.656 --> 00:19:19.746 A:middle
and you see these
detailed instructions

00:19:19.746 --> 00:19:22.486 A:middle
of creating a certificate
signing request.

00:19:23.146 --> 00:19:26.436 A:middle
And the certificates I knew in
quest will create a private key

00:19:26.436 --> 00:19:31.236 A:middle
that you will use to sign
your push package as well

00:19:31.606 --> 00:19:35.856 A:middle
as the certificate itself you'll
be creating to connect to APNS.

00:19:36.566 --> 00:19:40.226 A:middle
So, it's going to create a file,
you're to upload that file,

00:19:40.816 --> 00:19:42.156 A:middle
and you've got your certificate.

00:19:42.866 --> 00:19:47.026 A:middle
But the certificate is in
a format that actually--

00:19:47.766 --> 00:19:49.476 A:middle
that's actually not
what we need in order

00:19:49.476 --> 00:19:51.246 A:middle
to actually sign
our push package.

00:19:51.526 --> 00:19:53.326 A:middle
So for that, install
the certificate

00:19:53.326 --> 00:19:55.956 A:middle
in a keychain access.

00:19:56.056 --> 00:19:59.016 A:middle
Right click on it and you want
to export that certificate

00:19:59.446 --> 00:20:02.906 A:middle
to a P12 file, and that--

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:20:02.906 --> 00:20:06.286 A:middle
it's that representation of your
certificate that you will use

00:20:06.286 --> 00:20:08.706 A:middle
in order to sign
your push package.

00:20:09.356 --> 00:20:11.406 A:middle
OK. So now we got
the certificate.

00:20:11.406 --> 00:20:13.916 A:middle
Next, it's time to
do the fun stuff.

00:20:13.916 --> 00:20:15.456 A:middle
It's time to do some coding.

00:20:15.456 --> 00:20:19.346 A:middle
So, the first thing is to
invite your users to subscribe

00:20:19.346 --> 00:20:21.796 A:middle
to push notifications
on your website.

00:20:23.146 --> 00:20:26.936 A:middle
So we've created two
new JavaScript APIs

00:20:27.306 --> 00:20:29.056 A:middle
that you use on your webpage.

00:20:29.486 --> 00:20:32.546 A:middle
The first is to see if the user
has been asked before already

00:20:32.816 --> 00:20:35.576 A:middle
and if not, you use the second
API which is to ask them.

00:20:36.156 --> 00:20:37.536 A:middle
So, let's take a look
at the first one.

00:20:37.846 --> 00:20:40.246 A:middle
You're going to call
window.safari.

00:20:40.246 --> 00:20:43.566 A:middle
pushNotification.permission
and you're going to pass

00:20:43.566 --> 00:20:46.726 A:middle
in the website push ID which
is that push ID that you used

00:20:46.726 --> 00:20:50.046 A:middle
in order to create you website
push certificate, right?

00:20:50.576 --> 00:20:52.346 A:middle
It's a synchronous
call and it's going

00:20:52.346 --> 00:20:56.526 A:middle
to return a JavaScript object
that has a permission property

00:20:56.526 --> 00:20:58.386 A:middle
and that property can have
three different values.

00:20:58.586 --> 00:21:00.606 A:middle
The first is default which means

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:21:00.606 --> 00:21:03.076 A:middle
that the user has never
been asked before.

00:21:03.916 --> 00:21:06.466 A:middle
The second is denied, where
the user has been asked before

00:21:06.466 --> 00:21:09.166 A:middle
but they said they did
not want to subscribe.

00:21:09.166 --> 00:21:12.486 A:middle
It's when in that modal
dialog you said, "don't allow"

00:21:12.486 --> 00:21:15.136 A:middle
so the user clicked on Don't
Allow, and the third is

00:21:15.136 --> 00:21:17.766 A:middle
when they click Allow and they
confirmed their subscription

00:21:18.276 --> 00:21:21.016 A:middle
and in that case you'll see that
the permission has been granted.

00:21:21.446 --> 00:21:22.946 A:middle
And if the permission
is granted,

00:21:23.116 --> 00:21:24.266 A:middle
they'll be a second property

00:21:25.226 --> 00:21:27.246 A:middle
which contains the
user's device token.

00:21:27.246 --> 00:21:29.466 A:middle
And you can use this
device token in order

00:21:29.466 --> 00:21:33.486 A:middle
to change your website UI

00:21:33.486 --> 00:21:37.056 A:middle
to give your users some more
granularity over the kinds

00:21:37.056 --> 00:21:38.706 A:middle
of push notifications
that they receive.

00:21:39.166 --> 00:21:40.856 A:middle
So, in the demo that
we just saw,

00:21:40.856 --> 00:21:42.696 A:middle
it's like seeing the
different kinds of reminders

00:21:42.946 --> 00:21:45.676 A:middle
that Brian wanted
to get notified of.

00:21:46.236 --> 00:21:48.366 A:middle
Now let's say that the user
has never been asked before.

00:21:48.366 --> 00:21:50.386 A:middle
So the permission will be
default, that first one, right?

00:21:50.476 --> 00:21:52.906 A:middle
So, next we have to
actually request permission.

00:21:52.906 --> 00:21:55.896 A:middle
And for that, you call
window.safari.push

00:21:55.896 --> 00:21:59.356 A:middle
Notification.requestPermission,
it's an asynchronous call

00:21:59.356 --> 00:22:01.236 A:middle
and you're going to call--

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:22:01.406 --> 00:22:03.226 A:middle
you're going to pass
in four parameters.

00:22:03.536 --> 00:22:07.416 A:middle
The first is the URL to your web
service, so it's that second--

00:22:07.796 --> 00:22:09.886 A:middle
the second thing that
you have to implement.

00:22:10.326 --> 00:22:13.606 A:middle
It must be-- it must
support HTTPS

00:22:13.606 --> 00:22:17.096 A:middle
and this represents the base URL
to your web service and I'll get

00:22:17.096 --> 00:22:19.346 A:middle
into how to implement
that web service later.

00:22:20.086 --> 00:22:22.806 A:middle
The second is the push ID
which you've seen before.

00:22:23.336 --> 00:22:26.316 A:middle
The third is something
that we added for you guys

00:22:26.316 --> 00:22:30.186 A:middle
and we're calling it userInfo
which should sound familiar

00:22:30.186 --> 00:22:32.146 A:middle
for those of you
who use Cocoa APIs.

00:22:32.536 --> 00:22:36.216 A:middle
It's just simply a way
for your website to talk

00:22:36.466 --> 00:22:38.466 A:middle
to your web service
because you recognize

00:22:38.466 --> 00:22:41.386 A:middle
that you might have those
two roles implemented

00:22:41.386 --> 00:22:42.356 A:middle
on separate hardware.

00:22:43.076 --> 00:22:46.376 A:middle
It's basically just a
simple dictionary of strings

00:22:46.376 --> 00:22:48.346 A:middle
and you can put anything
in there

00:22:48.646 --> 00:22:52.436 A:middle
to help you identify the user
that's logged in to your website

00:22:52.616 --> 00:22:55.356 A:middle
or maybe some preferences
that they want in terms

00:22:55.356 --> 00:22:58.496 A:middle
of the notifications they
receive or even the language

00:22:58.496 --> 00:23:00.416 A:middle
in which they want to
receive those notifications.

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:23:00.856 --> 00:23:04.156 A:middle
Finally, you're going to
pass a callback function

00:23:04.826 --> 00:23:07.976 A:middle
that will get invoked when
the user has finally made

00:23:07.976 --> 00:23:08.536 A:middle
a decision.

00:23:08.536 --> 00:23:11.196 A:middle
Like when the modal dropped
down, a dialogue appears

00:23:11.196 --> 00:23:12.746 A:middle
and they decide one
way or the other.

00:23:13.026 --> 00:23:16.326 A:middle
We will invoke this callback and
pass in that permissions object

00:23:16.326 --> 00:23:19.596 A:middle
that you saw for the
first JavaScript API.

00:23:19.686 --> 00:23:22.326 A:middle
In the case that the user
confirms, you're going

00:23:22.326 --> 00:23:24.586 A:middle
to see the granted permission
and that device token.

00:23:25.396 --> 00:23:27.736 A:middle
In the case that they said
"no" you're just going

00:23:27.736 --> 00:23:29.786 A:middle
to see the denied permission
cause you don't need the device

00:23:29.786 --> 00:23:33.506 A:middle
token in that case.

00:23:33.676 --> 00:23:38.566 A:middle
All right, so we've asked users
on your website to subscribe.

00:23:39.936 --> 00:23:42.376 A:middle
Now, it's time to write
that web service back end.

00:23:43.776 --> 00:23:46.726 A:middle
So, let's review
how users subscribe

00:23:46.926 --> 00:23:49.436 A:middle
to your push notifications,
so bring up that diagram.

00:23:49.716 --> 00:23:52.956 A:middle
So any arrow that you
see going from Safari

00:23:53.146 --> 00:23:55.936 A:middle
to the server represents an
endpoint that you're going

00:23:56.356 --> 00:23:59.166 A:middle
to have to implement in order--

00:23:59.166 --> 00:24:01.746 A:middle
that you're going to have to
implement in your web service.

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:24:02.426 --> 00:24:07.396 A:middle
So the first is when Safari
contacts your web service

00:24:07.396 --> 00:24:08.656 A:middle
in order to get that
push package,

00:24:09.276 --> 00:24:10.696 A:middle
when that push package
has returned

00:24:10.866 --> 00:24:13.706 A:middle
and Safari will do a validation

00:24:13.706 --> 00:24:15.686 A:middle
and if anything went wrong
during that validation,

00:24:15.686 --> 00:24:17.056 A:middle
it will then contact your--

00:24:17.266 --> 00:24:21.126 A:middle
the second endpoint and
tell your what went wrong.

00:24:21.806 --> 00:24:22.966 A:middle
But if everything succeeds

00:24:22.966 --> 00:24:25.266 A:middle
and the user confirms their
subscription then it will

00:24:25.266 --> 00:24:27.626 A:middle
contact the third endpoint

00:24:27.786 --> 00:24:31.426 A:middle
where we register the device
token to your web service.

00:24:31.756 --> 00:24:34.416 A:middle
There is a fourth endpoint
that's not in this diagram

00:24:34.416 --> 00:24:37.066 A:middle
and that's when the
user changes her mind

00:24:37.066 --> 00:24:38.246 A:middle
and decides to unsubscribe.

00:24:38.326 --> 00:24:40.836 A:middle
We make a very similar call
except instead of saying

00:24:40.836 --> 00:24:43.526 A:middle
where register device token
we say un-register this

00:24:43.526 --> 00:24:44.086 A:middle
device token.

00:24:44.086 --> 00:24:47.646 A:middle
So let's talk about
that first line

00:24:47.646 --> 00:24:48.816 A:middle
about getting that push package.

00:24:49.246 --> 00:24:54.916 A:middle
You can think of this as being
Safari just calling a function,

00:24:54.916 --> 00:24:58.106 A:middle
except the function is in the
format of an HTTP request.

00:24:58.726 --> 00:25:01.016 A:middle
And this function contains
two different parameters.

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:25:01.016 --> 00:25:04.966 A:middle
The first is the websitePushID
and the second is that userInfo

00:25:04.966 --> 00:25:06.646 A:middle
from the request permission call

00:25:06.926 --> 00:25:08.896 A:middle
but serialized as
a query string.

00:25:09.256 --> 00:25:11.856 A:middle
.So for many of you that
only have one website,

00:25:11.856 --> 00:25:13.466 A:middle
you can basically ignore
the first one 'cause the

00:25:13.466 --> 00:25:15.026 A:middle
websitePushID will
always be the same.

00:25:15.546 --> 00:25:17.296 A:middle
But the second one, you
might want to pay attention

00:25:17.296 --> 00:25:20.586 A:middle
to in order to be able to
tailor the push package

00:25:20.586 --> 00:25:21.346 A:middle
that you return.

00:25:21.996 --> 00:25:24.876 A:middle
So, just to review, here's
that requestPermission call,

00:25:24.876 --> 00:25:27.476 A:middle
that third parameter, userInfo.

00:25:27.976 --> 00:25:29.556 A:middle
Here's an example
of what I could--

00:25:29.596 --> 00:25:31.106 A:middle
we could pass in for
the Bay Airlines site.

00:25:31.216 --> 00:25:34.056 A:middle
We pass in the log in
of the user as well

00:25:34.056 --> 00:25:36.956 A:middle
as their frequentFlyerID
and that will get converted

00:25:37.286 --> 00:25:40.376 A:middle
by Safari to this string,
it looks like a query string

00:25:40.376 --> 00:25:42.226 A:middle
and that will be
in the HTTP body

00:25:42.516 --> 00:25:45.156 A:middle
in the requester
your web service.

00:25:46.706 --> 00:25:50.056 A:middle
So, when this endpoint is
called, we expect your server

00:25:50.116 --> 00:25:52.546 A:middle
to create that push package
and what does that look like?

00:25:53.076 --> 00:25:58.246 A:middle
Well, if push package is nothing
more than a zipped archive

00:25:58.246 --> 00:26:00.376 A:middle
of a whole bunch
of files formatted

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:26:00.376 --> 00:26:01.846 A:middle
and structured in
a specific way.

00:26:02.076 --> 00:26:05.756 A:middle
And for those of you who have
some familiarity with Passbook,

00:26:05.756 --> 00:26:09.146 A:middle
you might recognize that
this actually follows the way

00:26:09.146 --> 00:26:11.136 A:middle
that passes are constructed.

00:26:12.246 --> 00:26:15.406 A:middle
So the first set of files are
just the icons representing

00:26:15.406 --> 00:26:16.026 A:middle
your website.

00:26:16.026 --> 00:26:18.006 A:middle
This will be used
throughout the UI

00:26:18.006 --> 00:26:20.646 A:middle
and you'll see how
they map later.

00:26:21.676 --> 00:26:25.146 A:middle
The second is a file
that we call website.json

00:26:25.146 --> 00:26:29.676 A:middle
and it's a dictionary with
information about your website.

00:26:29.826 --> 00:26:32.116 A:middle
Let's drill down a
little bit into it.

00:26:32.206 --> 00:26:33.616 A:middle
The first two you've
seen already.

00:26:34.106 --> 00:26:38.336 A:middle
It's the URL to your web service

00:26:39.066 --> 00:26:41.096 A:middle
and the second is
your websitePushID.

00:26:41.816 --> 00:26:48.326 A:middle
The third is your websiteName
and this will be used in the UI

00:26:48.326 --> 00:26:52.116 A:middle
when we ask the user to
confirm their subscription

00:26:52.116 --> 00:26:54.016 A:middle
or in Notification Center.

00:26:55.276 --> 00:26:57.956 A:middle
The fourth is what we
called allowedDomains

00:26:57.956 --> 00:27:01.126 A:middle
and it's just a list of
domains that are allowed

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:27:01.566 --> 00:27:06.006 A:middle
to request permission from
your users to subscribe

00:27:06.126 --> 00:27:08.036 A:middle
to your website's
push notifications.

00:27:08.276 --> 00:27:09.906 A:middle
So why would we add
something like this here?

00:27:09.906 --> 00:27:13.066 A:middle
Well, it's to prevent somebody
trying to spoof your website

00:27:13.066 --> 00:27:15.276 A:middle
from being able to get
those device tokens

00:27:15.516 --> 00:27:17.686 A:middle
and sent push notifications
on your behalf.

00:27:18.386 --> 00:27:22.256 A:middle
So, one way that a spoofer could
try to pretend to be you is

00:27:22.256 --> 00:27:24.696 A:middle
to take this push package
that you would normally serve

00:27:24.886 --> 00:27:26.716 A:middle
and serve that to users instead.

00:27:27.646 --> 00:27:30.756 A:middle
But what will happen is during
the verification algorithm,

00:27:30.756 --> 00:27:33.056 A:middle
Safari will take a
look at the domain

00:27:33.056 --> 00:27:35.316 A:middle
that was making the request
for the permission and compare

00:27:35.316 --> 00:27:36.896 A:middle
that against this list.

00:27:37.226 --> 00:27:38.746 A:middle
And so, in the case of
the spoofing website,

00:27:38.746 --> 00:27:41.806 A:middle
that website won't be here
so therefore Safari won't--

00:27:41.836 --> 00:27:43.756 A:middle
Safari will fail and
you'll be notified of that.

00:27:44.466 --> 00:27:47.036 A:middle
So really, this-- having this
list here is a way for you

00:27:47.036 --> 00:27:50.306 A:middle
to protect yourself against
people who are going to try to--

00:27:50.306 --> 00:27:52.446 A:middle
or going to try to forge
your notifications.

00:27:52.916 --> 00:27:57.576 A:middle
Next is what we call
an authenticationToken

00:27:58.136 --> 00:28:02.286 A:middle
and it's similar in its
purpose to userInfo.

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:28:02.846 --> 00:28:06.046 A:middle
Remember that with userInfo,
we were saying it's just a way

00:28:06.046 --> 00:28:08.596 A:middle
for your website to talk
to your web service.

00:28:09.086 --> 00:28:11.876 A:middle
This is a way for your web
service to talk back to itself

00:28:11.996 --> 00:28:14.006 A:middle
because the web service,
we don't expect

00:28:14.116 --> 00:28:15.586 A:middle
to maintain any sort of state.

00:28:15.896 --> 00:28:19.426 A:middle
So, when the user changes their
mind about their subscription

00:28:19.426 --> 00:28:22.896 A:middle
to push notifications, you need
a way to identify that user

00:28:23.086 --> 00:28:27.306 A:middle
and so you can use this
authenticationToken to do that.

00:28:27.516 --> 00:28:30.626 A:middle
Finally, we include
urlFormatString

00:28:30.626 --> 00:28:33.136 A:middle
and the reason why we
included this here is because,

00:28:33.266 --> 00:28:35.576 A:middle
like I said, like when you
click on that notification it's

00:28:35.576 --> 00:28:36.426 A:middle
like clicking on a link.

00:28:36.686 --> 00:28:39.146 A:middle
Well, so the notification
is going to have that URL.

00:28:39.706 --> 00:28:42.126 A:middle
But for many websites,
that URL is really long

00:28:42.126 --> 00:28:47.366 A:middle
and because notifications
payloads can only have a limited

00:28:47.366 --> 00:28:51.876 A:middle
size, those URLs might actually
take up all the space available,

00:28:51.876 --> 00:28:53.686 A:middle
and so you won't have any
room for your notifications.

00:28:53.686 --> 00:28:57.246 A:middle
So, we have this here as
a way for you to be able

00:28:57.246 --> 00:29:00.716 A:middle
to reduce the amount of
space that your URL needs

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:29:00.716 --> 00:29:02.296 A:middle
in the notification
and you'll see

00:29:02.296 --> 00:29:07.586 A:middle
that it's formatted very
similar to strings in Cocoa.

00:29:08.066 --> 00:29:11.676 A:middle
OK. So we just talked
about the things that kind

00:29:11.676 --> 00:29:12.836 A:middle
of describe your website.

00:29:12.836 --> 00:29:18.126 A:middle
The next two pieces are
how Safari can validate

00:29:18.126 --> 00:29:18.766 A:middle
your identify.

00:29:18.946 --> 00:29:22.306 A:middle
So the first thing is a
manifest.json, it's a dictionary

00:29:22.706 --> 00:29:24.066 A:middle
of all of the files
we just talked

00:29:24.066 --> 00:29:27.576 A:middle
about that contains
references to all the files

00:29:27.576 --> 00:29:30.126 A:middle
that we just talked about
and the SHA1 checksums.

00:29:30.666 --> 00:29:33.306 A:middle
And this is kind of
what that looks like.

00:29:33.706 --> 00:29:38.066 A:middle
As you see it, the keys are all
relative passed to those files

00:29:38.396 --> 00:29:40.436 A:middle
and then the values
are the checksums

00:29:40.436 --> 00:29:42.526 A:middle
and I've truncated them
here for readability.

00:29:42.696 --> 00:29:44.176 A:middle
So why would we do
something like this?

00:29:44.476 --> 00:29:49.756 A:middle
Well, if a spoofer try to change
your icon or change the name

00:29:49.756 --> 00:29:53.996 A:middle
of your website, when Safari
does its validation algorithm,

00:29:53.996 --> 00:29:55.916 A:middle
it's going to find
that the checksums

00:29:55.916 --> 00:29:59.136 A:middle
for those files are not going to
match what you have here, right?

00:29:59.136 --> 00:30:01.646 A:middle
So that's how we-- that's the
reason why we have this file.

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:30:02.166 --> 00:30:04.976 A:middle
And then finally,
you're going to sign

00:30:05.046 --> 00:30:07.276 A:middle
that manifest using
the private key

00:30:07.276 --> 00:30:08.686 A:middle
of your website push
certificate.

00:30:09.696 --> 00:30:12.876 A:middle
And we do this because when
the push package gets sent

00:30:12.876 --> 00:30:16.956 A:middle
to Safari, it will check the
signature against the manifest

00:30:17.096 --> 00:30:19.046 A:middle
and if they don't match,

00:30:19.386 --> 00:30:26.156 A:middle
that means that some other
developers try to sign it

00:30:26.156 --> 00:30:28.286 A:middle
with an invalid certificate.

00:30:29.786 --> 00:30:32.936 A:middle
OK. So now, that's the push
package, you zip that up

00:30:32.936 --> 00:30:34.516 A:middle
and you send that
back to Safari.

00:30:34.876 --> 00:30:37.076 A:middle
Safari will then validate kind

00:30:37.076 --> 00:30:38.926 A:middle
of checking all the
things that I talked about.

00:30:39.526 --> 00:30:43.896 A:middle
And if anything went wrong
like a file is malformed

00:30:43.896 --> 00:30:47.326 A:middle
or there is a typo
in the website.json,

00:30:47.866 --> 00:30:50.916 A:middle
we will then contact
a logging endpoint

00:30:50.916 --> 00:30:53.826 A:middle
and that's the second endpoint
to report what went wrong.

00:30:55.166 --> 00:30:58.226 A:middle
And super simple, it's what--
this is what it looks like,

00:30:58.606 --> 00:31:02.946 A:middle
and you'll notice that
the body is just formatted

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:31:02.996 --> 00:31:04.976 A:middle
like a JSON object
that contains list

00:31:04.976 --> 00:31:09.286 A:middle
of the human readable
strengths explaining

00:31:09.286 --> 00:31:10.416 A:middle
like what exactly went wrong.

00:31:10.946 --> 00:31:13.996 A:middle
But hopefully, you have a
major push package correctly

00:31:13.996 --> 00:31:17.486 A:middle
and so we prompt and confirm.

00:31:18.436 --> 00:31:21.596 A:middle
And at this point, that we
can actually see how elements

00:31:21.596 --> 00:31:23.386 A:middle
in the push package
map to the UI.

00:31:23.706 --> 00:31:27.396 A:middle
So just briefly, here's
that dialogue that Brian saw

00:31:27.396 --> 00:31:29.706 A:middle
when he clicked on that
Subscribed Button and you'll see

00:31:29.706 --> 00:31:32.806 A:middle
that the icon comes from the
icons in the push package

00:31:33.296 --> 00:31:36.406 A:middle
and the websiteName and
the website.json map

00:31:36.516 --> 00:31:39.576 A:middle
into the text asking
the user to subscribe.

00:31:40.196 --> 00:31:45.926 A:middle
OK. So now, the user
says I want your--

00:31:46.036 --> 00:31:49.046 A:middle
I want Bay Airlines push
notifications so now it's time

00:31:49.046 --> 00:31:53.466 A:middle
for Safari to send that device
token over to your web service.

00:31:53.906 --> 00:31:57.066 A:middle
And this is what
that call looks like.

00:31:57.066 --> 00:31:59.356 A:middle
There are three pieces
of information.

00:31:59.776 --> 00:32:01.956 A:middle
The first is the
deviceToken itself

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:32:01.956 --> 00:32:04.276 A:middle
and that's what you're going to
want to store in your databases.

00:32:04.556 --> 00:32:07.256 A:middle
The second is the websitePushID
which again for those of you

00:32:07.256 --> 00:32:08.916 A:middle
with just one website,
you can just ignore that.

00:32:08.916 --> 00:32:12.526 A:middle
And the third is the
authenticationToken that you put

00:32:12.526 --> 00:32:16.506 A:middle
in that push package and
that's how your web server,

00:32:16.946 --> 00:32:20.446 A:middle
your web service knows who to
associate the device token with.

00:32:20.656 --> 00:32:26.246 A:middle
If the user changes their
mind because they don't want

00:32:26.246 --> 00:32:28.186 A:middle
to subscribe to your push
notifications anymore,

00:32:28.186 --> 00:32:29.986 A:middle
we actually make a request

00:32:29.986 --> 00:32:35.296 A:middle
to the exact same endpoint
except instead we use the HTTP

00:32:35.296 --> 00:32:37.176 A:middle
Delete Method so just
look for the method

00:32:37.176 --> 00:32:39.996 A:middle
and you'll know whether
to add that device token

00:32:39.996 --> 00:32:41.186 A:middle
to your databases or remove it.

00:32:45.756 --> 00:32:46.646 A:middle
And that's it.

00:32:46.646 --> 00:32:47.926 A:middle
That's all you need
to do in order

00:32:47.926 --> 00:32:49.696 A:middle
to implement your web service.

00:32:50.886 --> 00:32:54.416 A:middle
Now, it's time to send
those push notifications.

00:32:55.556 --> 00:32:59.436 A:middle
So those of you who had
experienced implementing push

00:32:59.436 --> 00:33:02.416 A:middle
notifications for Native
Apps, we'll be happy to learn

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:33:02.416 --> 00:33:04.626 A:middle
that it works exactly the
same way for websites.

00:33:04.856 --> 00:33:07.956 A:middle
For those of you who are not
familiar, this is the format

00:33:08.016 --> 00:33:10.236 A:middle
that you send to APNS.

00:33:10.236 --> 00:33:12.466 A:middle
It looks like it's
JSON formatted,

00:33:12.746 --> 00:33:16.516 A:middle
and in that notification
you include the elements

00:33:16.516 --> 00:33:17.846 A:middle
that will be in the notification

00:33:17.846 --> 00:33:19.576 A:middle
so that includes the
title and the body.

00:33:20.366 --> 00:33:25.366 A:middle
And for those users who decide
to see your notifications

00:33:25.366 --> 00:33:26.866 A:middle
as alerts instead of banners,

00:33:27.136 --> 00:33:31.886 A:middle
then this action value
will override the title

00:33:31.886 --> 00:33:33.526 A:middle
in the Action button
in the notification.

00:33:35.286 --> 00:33:39.936 A:middle
And instead of having
custom data which you can do

00:33:39.936 --> 00:33:42.646 A:middle
with Native App Push
Notifications, we--

00:33:42.776 --> 00:33:45.786 A:middle
or you have the URL and that
URL can provide all the context

00:33:45.786 --> 00:33:47.236 A:middle
that you need in order to get--

00:33:47.236 --> 00:33:49.676 A:middle
in order to take your
users to the right detail.

00:33:49.676 --> 00:33:54.296 A:middle
So, here we've decided to
express it in terms of URL args

00:33:54.646 --> 00:33:58.516 A:middle
and the reason for that is
because we don't want you

00:33:58.516 --> 00:34:00.596 A:middle
to necessarily include the
entire URL 'cause it might be

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:34:00.596 --> 00:34:03.836 A:middle
too long and you
have a limited size

00:34:03.836 --> 00:34:04.966 A:middle
in your notification payload.

00:34:05.576 --> 00:34:08.516 A:middle
In fact, that payload
is limited to 256 bytes.

00:34:09.376 --> 00:34:10.585 A:middle
So be sure to take advantage

00:34:10.585 --> 00:34:13.656 A:middle
of that URL format string
in the push package.

00:34:14.926 --> 00:34:17.065 A:middle
And when you send
that notification,

00:34:17.065 --> 00:34:18.235 A:middle
make sure that you
always send it

00:34:18.315 --> 00:34:21.596 A:middle
to the APNS's Production
Environment.

00:34:21.596 --> 00:34:26.406 A:middle
There is no support for
pushing your notifications

00:34:26.406 --> 00:34:27.216 A:middle
to the Sandbox.

00:34:27.826 --> 00:34:32.866 A:middle
So now that we got the payload
and we have the push package

00:34:32.866 --> 00:34:35.476 A:middle
from earlier, we know now
how to construct everything.

00:34:35.476 --> 00:34:38.116 A:middle
So, in the notification
itself, the icons come

00:34:38.186 --> 00:34:41.835 A:middle
from your push package
and the title

00:34:41.835 --> 00:34:43.196 A:middle
and body come from the payload.

00:34:43.196 --> 00:34:45.946 A:middle
And for users who are
seeing your notification

00:34:46.216 --> 00:34:50.976 A:middle
as an alert will see your
Action button title override

00:34:50.976 --> 00:34:52.166 A:middle
that button.

00:34:53.295 --> 00:34:58.436 A:middle
The notification in Notification
Center will appear as such.

00:34:58.526 --> 00:35:01.306 A:middle
The header gets its
icon and website name

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:35:01.306 --> 00:35:05.306 A:middle
from your push package and the
actual notification itself comes

00:35:05.306 --> 00:35:06.396 A:middle
from the payload.

00:35:07.006 --> 00:35:10.176 A:middle
And when the user clicks
on that notification,

00:35:10.586 --> 00:35:13.516 A:middle
we combine the URL format
string from your push package

00:35:13.826 --> 00:35:18.816 A:middle
and the URL args from your
payload, combine them together

00:35:19.376 --> 00:35:23.336 A:middle
to make the final URL that takes
the user to see more details.

00:35:23.946 --> 00:35:27.486 A:middle
So, I'd like to bring Brian back

00:35:27.486 --> 00:35:30.566 A:middle
up to show you how these
all works behind the scenes.

00:35:30.846 --> 00:35:31.706 A:middle
&gt;&gt; Thanks, Jon.

00:35:32.626 --> 00:35:38.096 A:middle
So now we are going to look
at what happens when I use--

00:35:38.216 --> 00:35:40.056 A:middle
when I sign up for
push notifications

00:35:40.056 --> 00:35:41.546 A:middle
from the website's
point of view--

00:35:42.376 --> 00:35:43.736 A:middle
from the web server's
point of view.

00:35:43.946 --> 00:35:47.286 A:middle
So as you can see, we have a
terminal window open with some--

00:35:47.866 --> 00:35:51.526 A:middle
with the web service log
output from bayairlines.com

00:35:52.076 --> 00:35:54.626 A:middle
and we also-- as a little bonus,
we'll get to see what happens

00:35:54.626 --> 00:35:56.096 A:middle
if you happened to
make a mistake

00:35:56.096 --> 00:35:59.436 A:middle
in generating your push package.

00:35:59.436 --> 00:36:02.646 A:middle
So when I want to sign up
for push notifications,

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:36:03.006 --> 00:36:08.476 A:middle
I will click the
Subscribe button and some--

00:36:08.476 --> 00:36:11.486 A:middle
and there is an issue with
the web server's push package.

00:36:11.736 --> 00:36:18.286 A:middle
As you can see, Safari sends
a request to V1 push packages

00:36:18.286 --> 00:36:20.966 A:middle
and then the website
identifier and we--

00:36:20.966 --> 00:36:23.876 A:middle
and then the web server
will log some user info

00:36:24.446 --> 00:36:26.336 A:middle
and send back a push package.

00:36:26.736 --> 00:36:30.656 A:middle
But as we can see, the push
package Safari did not validate

00:36:30.656 --> 00:36:34.046 A:middle
the push package
correctly and there was a--

00:36:34.696 --> 00:36:38.976 A:middle
and we send an issue
back to V1 log saying,

00:36:39.286 --> 00:36:42.476 A:middle
"Refer URL bayairlines.com
is not

00:36:42.476 --> 00:36:43.956 A:middle
in the list of allowed domains".

00:36:44.556 --> 00:36:48.856 A:middle
So, as Jon described
from earlier in the talk,

00:36:49.356 --> 00:36:54.246 A:middle
allowed domains are-- is in the
website.json file so let's open

00:36:54.246 --> 00:36:56.426 A:middle
that up and see what's in there.

00:36:57.876 --> 00:37:02.486 A:middle
And as you can see, we have
allowed domains it's just listed

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:37:02.486 --> 00:37:04.146 A:middle
as bayairline.com.

00:37:04.676 --> 00:37:08.746 A:middle
So, we very-- we just have
a simple typo, we just need

00:37:08.746 --> 00:37:12.726 A:middle
to add an S to make it
bayairlines.com, save it,

00:37:13.596 --> 00:37:20.186 A:middle
and what the Bay Airlines web
server will do is when you--

00:37:20.186 --> 00:37:22.546 A:middle
when we try and sign up
for push notifications,

00:37:23.036 --> 00:37:26.196 A:middle
the server will automatically
generate a push package based

00:37:26.196 --> 00:37:31.216 A:middle
on the files that are-- based
on the files on the file system.

00:37:31.216 --> 00:37:33.196 A:middle
So, we don't need to
generate a new push package,

00:37:33.196 --> 00:37:34.546 A:middle
it will be done automatically.

00:37:35.316 --> 00:37:38.416 A:middle
We can just reload the
web page and try again.

00:37:39.596 --> 00:37:43.146 A:middle
And that time it works
correctly and we were given--

00:37:43.276 --> 00:37:45.656 A:middle
we were told that we
were asked for permission

00:37:45.656 --> 00:37:48.446 A:middle
to sign up for notifications.

00:37:49.696 --> 00:37:52.846 A:middle
We click Allow and you
can-- and then when we--

00:37:52.906 --> 00:37:56.756 A:middle
when the user finished signing
up for push notifications,

00:37:57.176 --> 00:38:02.506 A:middle
we sent the device token to
the Bay Airlines web server

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:38:03.096 --> 00:38:09.256 A:middle
and in the HTTP Authorize Header
we have the userInfo specified

00:38:09.256 --> 00:38:10.356 A:middle
in the push package.

00:38:11.196 --> 00:38:15.136 A:middle
Now, let's open up System
Preferences again because I want

00:38:15.136 --> 00:38:18.946 A:middle
to change my type
of alert and I want

00:38:18.946 --> 00:38:20.546 A:middle
to make it an alert
instead of a banner.

00:38:21.616 --> 00:38:27.266 A:middle
So now, let's say there's
Wi-Fi on the plane and I want

00:38:27.266 --> 00:38:30.836 A:middle
to be updated with the
weather for when I land.

00:38:31.686 --> 00:38:34.816 A:middle
So when I get notified of
weather, I want to be notified

00:38:34.816 --> 00:38:39.056 A:middle
of weather conditions
on the day of flight.

00:38:39.056 --> 00:38:41.956 A:middle
And as you can see, our
web server connected

00:38:41.956 --> 00:38:45.836 A:middle
to APNS using the
Production Environment

00:38:46.346 --> 00:38:50.236 A:middle
and deliver this message payload
giving me some more information

00:38:50.236 --> 00:38:57.226 A:middle
about the weather and it shows
up in Notification Center right

00:38:57.406 --> 00:39:00.916 A:middle
over here with-- and then
we can either just close the

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:39:00.916 --> 00:39:02.436 A:middle
notification or see more.

00:39:03.326 --> 00:39:06.286 A:middle
Now, if the user
decides to unsubscribe

00:39:06.286 --> 00:39:11.326 A:middle
from push notifications like
Bay Airlines lost their baggage

00:39:11.326 --> 00:39:17.456 A:middle
and they're never going to
fly them again, they can open

00:39:17.456 --> 00:39:22.276 A:middle
up Safari's Preferences and
switch over from Allow to Deny.

00:39:23.066 --> 00:39:26.156 A:middle
And as you can see, we
sent a delete request--

00:39:26.326 --> 00:39:30.546 A:middle
Safari sent a delete request
to the web server saying to--

00:39:30.546 --> 00:39:34.876 A:middle
telling the web server to
unsubscribe this device token

00:39:34.876 --> 00:39:37.846 A:middle
and not to send any
more push notifications

00:39:37.846 --> 00:39:38.886 A:middle
to this device token.

00:39:39.786 --> 00:39:43.506 A:middle
And if they happen to have
a great deal and you decide

00:39:43.506 --> 00:39:46.666 A:middle
to fly them again, you
can just click Allow

00:39:46.666 --> 00:39:48.836 A:middle
and we will send
back that same--

00:39:48.836 --> 00:39:53.816 A:middle
we will send back your
device token via that same--

00:39:53.816 --> 00:39:57.076 A:middle
we will send it to the web
server via that same endpoint.

00:39:57.706 --> 00:40:03.026 A:middle
So that is what your web
server will see when users sign

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:40:03.026 --> 00:40:06.246 A:middle
up for Push Notifications
or unsubscribe from them.

00:40:07.176 --> 00:40:09.116 A:middle
Now, let's hand it back to Jon.

00:40:09.596 --> 00:40:11.596 A:middle
[applause]

00:40:12.076 --> 00:40:13.246 A:middle
&gt;&gt; So, you now know
how to implement

00:40:13.246 --> 00:40:17.936 A:middle
and let's talk a little
bit about best practices.

00:40:17.936 --> 00:40:19.856 A:middle
So when it comes to
your notifications,

00:40:19.986 --> 00:40:22.996 A:middle
think about what
notifications can be most useful

00:40:23.386 --> 00:40:24.266 A:middle
to your users.

00:40:24.466 --> 00:40:26.796 A:middle
So all of you that like raise
your hands, you know what it's

00:40:26.796 --> 00:40:29.036 A:middle
like to get annoying
notifications.

00:40:29.696 --> 00:40:32.096 A:middle
Make sure that everything
that you're doing

00:40:32.356 --> 00:40:36.006 A:middle
to send notifications
to users informs them.

00:40:37.876 --> 00:40:40.726 A:middle
Remember that the push
notification service is the best

00:40:40.726 --> 00:40:42.816 A:middle
effort which means we're going
to do our best to deliver them

00:40:42.816 --> 00:40:44.466 A:middle
but there's not necessary
guaranteed

00:40:44.466 --> 00:40:45.386 A:middle
that they'll be delivered.

00:40:45.856 --> 00:40:47.366 A:middle
So think of these
push notifications

00:40:47.366 --> 00:40:50.436 A:middle
as an additional rather than a
primary means of communicating.

00:40:51.156 --> 00:40:54.816 A:middle
Next, remember to take advantage
of that URL format string.

00:40:54.816 --> 00:40:57.136 A:middle
Here is an example of
what we could have done

00:40:57.386 --> 00:40:58.686 A:middle
where the URL format string

00:40:58.686 --> 00:41:01.496 A:middle
in the push package was
something very generic

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:41:01.496 --> 00:41:04.826 A:middle
and we put the entire URL
inside the notification payload.

00:41:05.346 --> 00:41:08.686 A:middle
Well, all that-- you know,
there's a pretty long URL

00:41:08.686 --> 00:41:10.766 A:middle
and so it's taking up space
that we could be using

00:41:10.766 --> 00:41:12.816 A:middle
to actually have in
the notification.

00:41:13.156 --> 00:41:15.996 A:middle
So, taking out what's common
among all of your URLs

00:41:15.996 --> 00:41:18.666 A:middle
and putting that inside
the URL format string means

00:41:18.666 --> 00:41:19.816 A:middle
that you save some space.

00:41:20.476 --> 00:41:24.216 A:middle
In this case, well, remember

00:41:24.216 --> 00:41:27.016 A:middle
to strip the white space
base from JSON payload.

00:41:27.016 --> 00:41:31.006 A:middle
So like in that slide before
with the notification payload

00:41:31.006 --> 00:41:35.086 A:middle
that I showed you, just taking
out that white space saved

00:41:35.086 --> 00:41:36.886 A:middle
like 40 bytes or
something like that which is

00:41:36.886 --> 00:41:38.026 A:middle
like half a sentence, right?

00:41:38.186 --> 00:41:39.496 A:middle
So, remember to do that.

00:41:40.006 --> 00:41:44.526 A:middle
Next to our best practices
for your web server,

00:41:44.976 --> 00:41:48.076 A:middle
remember that when users decide
to unsubscribe and we give--

00:41:48.076 --> 00:41:49.876 A:middle
and we touched that
unsubscribe endpoint,

00:41:50.166 --> 00:41:52.596 A:middle
just remove those tokens
from your web service.

00:41:52.986 --> 00:41:57.016 A:middle
We don't want you to be
wasting your precious resources

00:41:57.396 --> 00:42:00.966 A:middle
delivering push notifications
that will never get displayed.

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:42:01.376 --> 00:42:07.576 A:middle
Remember to take advantage of
the userInfo in the JavaScript

00:42:07.856 --> 00:42:09.176 A:middle
as well as the
authenticationToken

00:42:09.176 --> 00:42:13.236 A:middle
in push package in order for you
to be able to identify the user

00:42:13.236 --> 00:42:16.846 A:middle
that wants to register for
your push notifications.

00:42:17.726 --> 00:42:20.576 A:middle
And finally, the best
practices for your website.

00:42:20.636 --> 00:42:23.036 A:middle
So, think about the kind
of service that you want

00:42:23.036 --> 00:42:24.616 A:middle
to provide your users.

00:42:24.936 --> 00:42:26.406 A:middle
If your website is the kind

00:42:26.566 --> 00:42:32.096 A:middle
that just broadcast a common
notification to all the users,

00:42:32.326 --> 00:42:34.696 A:middle
then all you need
really is a like a file

00:42:34.696 --> 00:42:37.656 A:middle
or just a single database table
nothing but device tokens.

00:42:38.106 --> 00:42:40.166 A:middle
But if you want to
provide an experience

00:42:40.216 --> 00:42:43.056 A:middle
where users can really
tailor the way

00:42:43.056 --> 00:42:47.106 A:middle
that they use push notifications
on your website, you're going

00:42:47.106 --> 00:42:51.826 A:middle
to want to communicate the
User Log in on your website

00:42:51.826 --> 00:42:56.196 A:middle
and associate that
with the device token.

00:42:56.346 --> 00:42:59.726 A:middle
Remember that this is a
feature on Safari 7 on Mavericks

00:42:59.726 --> 00:43:02.246 A:middle
so you want to check for
API ability as an example

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:43:02.246 --> 00:43:03.036 A:middle
of what that looks like.

00:43:04.456 --> 00:43:08.996 A:middle
And remember to ask users to
subscribe at the right time.

00:43:09.276 --> 00:43:12.796 A:middle
You don't know necessarily
how users have landed

00:43:12.796 --> 00:43:16.496 A:middle
on your website and
it's probably your--

00:43:16.576 --> 00:43:19.186 A:middle
and probably they're not going
to want to be asked immediately.

00:43:19.766 --> 00:43:22.876 A:middle
We recommend providing some
kind of switch that allows user

00:43:22.876 --> 00:43:26.596 A:middle
to like physically turn the--

00:43:26.596 --> 00:43:29.656 A:middle
physically turn on push
notifications on your website.

00:43:29.656 --> 00:43:31.146 A:middle
And in the Bay Airlines demo,

00:43:31.386 --> 00:43:33.086 A:middle
we did that through
a Subscribe button.

00:43:33.686 --> 00:43:37.686 A:middle
And finally, think about giving
your users some granularity.

00:43:37.936 --> 00:43:40.106 A:middle
It gives them the opportunity

00:43:40.106 --> 00:43:42.796 A:middle
to really tailor their
experience with your website.

00:43:43.056 --> 00:43:46.186 A:middle
In the Bay Airlines site,
there's multiple types

00:43:46.186 --> 00:43:48.716 A:middle
of notifications that Brian
could have subscribed to.

00:43:50.136 --> 00:43:53.336 A:middle
So for more information,
you can contact Jon Geleynse

00:43:53.336 --> 00:43:57.136 A:middle
and Paul Marcos, our
evangelists online.

00:43:57.266 --> 00:43:59.836 A:middle
There is the Local
and Push Notifications

00:43:59.836 --> 00:44:03.316 A:middle
for Developers page which
contains links to lot

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:44:03.316 --> 00:44:05.876 A:middle
of different references
that give you more details

00:44:05.876 --> 00:44:07.316 A:middle
about notifications in general.

00:44:07.316 --> 00:44:09.466 A:middle
And for those of you
which should be all of you

00:44:09.556 --> 00:44:15.546 A:middle
that have access to the preview
of the developer publications,

00:44:15.756 --> 00:44:17.756 A:middle
there is a guide called
Notifications Programming Guide

00:44:17.756 --> 00:44:19.896 A:middle
for Websites that gives
much more detail about how

00:44:19.896 --> 00:44:22.126 A:middle
to implement push
notifications for your website.

00:44:22.126 --> 00:44:25.276 A:middle
And of course, there's
always the Safari Developer

00:44:25.276 --> 00:44:26.726 A:middle
for all of us.

00:44:27.046 --> 00:44:29.376 A:middle
So, push notifications
for websites is just one

00:44:29.376 --> 00:44:31.466 A:middle
of many awesome new
features in Safari.

00:44:31.716 --> 00:44:34.586 A:middle
I recommend listening to
Tuesday's video on What's New

00:44:34.586 --> 00:44:36.656 A:middle
in Safari WebKit
for Web Developers.

00:44:37.616 --> 00:44:40.456 A:middle
And as I mentioned before that,
push package is very similar

00:44:40.676 --> 00:44:42.356 A:middle
to the way that passes are made

00:44:42.706 --> 00:44:45.346 A:middle
and I would recommend you
listening to Wednesday's talk

00:44:45.346 --> 00:44:47.446 A:middle
on Integrating Passbook
into Your Ecosystem.

00:44:47.646 --> 00:44:48.866 A:middle
It's a really interesting
to talk

00:44:48.866 --> 00:44:51.756 A:middle
about how Apple Online
Store adopted passbook

00:44:51.756 --> 00:44:53.096 A:middle
and they have some
interesting uses

00:44:53.276 --> 00:44:55.156 A:middle
for that authenticationToken.

00:44:56.096 --> 00:45:00.516 A:middle
So just in summary, I'm really
please to announce that Safari 7

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

00:45:00.516 --> 00:45:02.716 A:middle
on Mavericks now
allows your website

00:45:02.896 --> 00:45:06.396 A:middle
to send push notifications
to your users.

00:45:07.556 --> 00:45:10.606 A:middle
And we've done everything we
can to make push notifications

00:45:10.606 --> 00:45:14.196 A:middle
for your website and those for
your apps the exact same thing.

00:45:14.196 --> 00:45:19.346 A:middle
Safari knows that it is
you that is that wants

00:45:19.346 --> 00:45:22.206 A:middle
to send push notifications
to your users

00:45:22.346 --> 00:45:23.766 A:middle
because we asked your server

00:45:23.766 --> 00:45:25.316 A:middle
to create something we
called a push package

00:45:25.356 --> 00:45:28.116 A:middle
that signed using a
website push certificate.

00:45:28.116 --> 00:45:29.926 A:middle
I love push notifications

00:45:29.926 --> 00:45:32.546 A:middle
because they tell me the
information that I want to know

00:45:32.546 --> 00:45:35.316 A:middle
at the best time it is for me to
know them and I'm really excited

00:45:35.316 --> 00:45:39.146 A:middle
to see how you integrate push
notifications into your website.

00:45:40.026 --> 00:45:41.036 A:middle
Not only this is
going to be great

00:45:41.036 --> 00:45:43.366 A:middle
because your Mac users will
be able to take advantage

00:45:43.366 --> 00:45:45.596 A:middle
of this great feature when
they visit your website,

00:45:45.926 --> 00:45:48.946 A:middle
but I really believe you're
going to see increased traffic

00:45:48.946 --> 00:45:51.846 A:middle
when people return to
your website as a result

00:45:51.846 --> 00:45:53.236 A:middle
of using these push
notifications.

00:45:53.816 --> 00:45:55.846 A:middle
All right, thanks for listening.

00:45:55.846 --> 00:45:58.116 A:middle
Enjoy the rest of the WWDC
and I'll see you at the lab.

00:45:58.716 --> 00:46:03.560 A:middle
[ Applause ]

WEBVTT
X-TIMESTAMP-MAP=MPEGTS:181083,LOCAL:00:00:00.000

