WEBVTT

00:00:07.516 --> 00:00:15.500 A:middle
[ 音乐 ]

00:00:22.516 --> 00:00:27.906 A:middle
[ 掌声 ]

00:00:28.406 --> 00:00:29.736 A:middle
&gt;&gt; 大家下午好

00:00:29.736 --> 00:00:31.566 A:middle
欢迎来到我们的会场

00:00:31.566 --> 00:00:33.366 A:middle
一起看一下 用户通知的一些更新

00:00:33.986 --> 00:00:35.316 A:middle
我叫 Kritarth Jain [ 音质不清晰 ]

00:00:35.316 --> 00:00:38.066 A:middle
是 iOS 用户通知团队的一名工程师

00:00:38.066 --> 00:00:39.956 A:middle
很高兴回到 WWDC

00:00:39.956 --> 00:00:42.316 A:middle
并跟大家分享

00:00:42.316 --> 00:00:43.896 A:middle
在 iOS 12 中

00:00:43.896 --> 00:00:45.566 A:middle
你的 App 可以采用的

00:00:45.566 --> 00:00:47.036 A:middle
一些用户通知方面

00:00:47.246 --> 00:00:48.116 A:middle
非常赞的新功能

00:00:49.476 --> 00:00:51.446 A:middle
今天我们一起来看一下

00:00:51.446 --> 00:00:53.086 A:middle
幻灯片上的

00:00:53.086 --> 00:00:54.256 A:middle
几个主题

00:00:54.526 --> 00:00:57.996 A:middle
首先是分组通知

00:00:57.996 --> 00:00:59.696 A:middle
这是之前我们在 iOS 用户通知中

00:00:59.876 --> 00:01:01.476 A:middle
添加的新范例

00:00:59.876 --> 00:01:01.476 A:middle
添加的新范例

00:01:01.476 --> 00:01:02.736 A:middle
在用户的通知列表中

00:01:02.736 --> 00:01:03.646 A:middle
可以看到分组通知

00:01:04.626 --> 00:01:05.896 A:middle
然后来看一下

00:01:05.896 --> 00:01:07.546 A:middle
通知内容扩展

00:01:07.886 --> 00:01:09.106 A:middle
其中包括

00:01:09.106 --> 00:01:10.696 A:middle
现有的通知扩展

00:01:10.696 --> 00:01:13.266 A:middle
以及新增的接口

00:01:14.606 --> 00:01:15.906 A:middle
下一个主题包括

00:01:15.906 --> 00:01:17.816 A:middle
通知管理

00:01:17.816 --> 00:01:19.116 A:middle
还有针对你的 App

00:01:19.116 --> 00:01:20.916 A:middle
用户可以调整的一些

00:01:20.916 --> 00:01:22.636 A:middle
通知设置

00:01:22.636 --> 00:01:24.226 A:middle
以及你要如何处理

00:01:24.426 --> 00:01:25.366 A:middle
这些新增选项

00:01:26.556 --> 00:01:27.976 A:middle
再然后是

00:01:27.976 --> 00:01:29.936 A:middle
临时授权 这个机制

00:01:29.936 --> 00:01:31.806 A:middle
让你的 App 在一段时间内

00:01:31.806 --> 00:01:33.706 A:middle
可以给用户试发送通知

00:01:33.706 --> 00:01:35.676 A:middle
无需用户明确允许

00:01:35.676 --> 00:01:37.366 A:middle
但是也不会有声音提醒

00:01:38.596 --> 00:01:40.266 A:middle
我们最后一个主题是

00:01:40.266 --> 00:01:42.006 A:middle
重要提醒

00:01:42.006 --> 00:01:43.816 A:middle
此功能让你的 App 可以

00:01:43.816 --> 00:01:45.446 A:middle
在用户允许的情况下

00:01:46.036 --> 00:01:47.996 A:middle
忽略一些系统设定

00:01:47.996 --> 00:01:49.846 A:middle
从而给用户发送

00:01:49.846 --> 00:01:51.026 A:middle
重要的提醒

00:01:51.886 --> 00:01:53.146 A:middle
今天我们

00:01:53.146 --> 00:01:54.736 A:middle
要讲的主题不少

00:01:54.736 --> 00:01:56.316 A:middle
就让我们先来说说

00:01:56.346 --> 00:01:57.136 A:middle
分组通知

00:01:57.136 --> 00:02:01.356 A:middle
在 iOS 11 及之前版本的系统中

00:01:57.136 --> 00:02:01.356 A:middle
在 iOS 11 及之前版本的系统中

00:02:01.356 --> 00:02:02.586 A:middle
所有新的用户通知

00:02:02.586 --> 00:02:04.426 A:middle
都是在通知列表中

00:02:04.426 --> 00:02:05.816 A:middle
以时间顺序

00:02:05.816 --> 00:02:06.756 A:middle
排列显示的

00:02:07.276 --> 00:02:08.735 A:middle
这就造成多个 App 的通知

00:02:08.735 --> 00:02:10.376 A:middle
穿插显示

00:02:10.705 --> 00:02:12.006 A:middle
而用户很难

00:02:12.006 --> 00:02:13.886 A:middle
一下找到某个通知

00:02:13.886 --> 00:02:16.746 A:middle
或分流多个通知

00:02:17.796 --> 00:02:20.346 A:middle
因此从 iOS 12 起

00:02:20.346 --> 00:02:22.216 A:middle
我们决定加以改进

00:02:22.216 --> 00:02:23.676 A:middle
新增分组通知功能

00:02:23.676 --> 00:02:25.696 A:middle
现在大家可以看到

00:02:25.696 --> 00:02:27.586 A:middle
多个 App 的

00:02:27.586 --> 00:02:30.526 A:middle
各种通知都被分到了

00:02:30.526 --> 00:02:31.036 A:middle
专属于它们的分组

00:02:32.056 --> 00:02:33.616 A:middle
下面我们仔细谈谈

00:02:33.616 --> 00:02:34.866 A:middle
分组通知

00:02:36.016 --> 00:02:38.426 A:middle
所有通知

00:02:38.426 --> 00:02:39.856 A:middle
会自动进行分组

00:02:39.856 --> 00:02:41.586 A:middle
所以你不需要

00:02:41.716 --> 00:02:43.626 A:middle
任何操作

00:02:43.706 --> 00:02:44.996 A:middle
就可以使用该功能

00:02:45.406 --> 00:02:47.016 A:middle
但是如果你想

00:02:47.136 --> 00:02:49.426 A:middle
创建自定义分组

00:02:49.426 --> 00:02:51.176 A:middle
那就需要使用线程标识

00:02:51.556 --> 00:02:53.566 A:middle
线程标识

00:02:53.746 --> 00:02:55.556 A:middle
是 UN notification content 对象中

00:02:55.556 --> 00:02:55.996 A:middle
已有的属性

00:02:57.646 --> 00:02:59.096 A:middle
你们当中可能有人

00:02:59.096 --> 00:03:01.276 A:middle
给本地通知

00:02:59.096 --> 00:03:01.276 A:middle
给本地通知

00:03:01.276 --> 00:03:02.406 A:middle
加过线程标识

00:03:02.536 --> 00:03:03.636 A:middle
正如所示 你可以在

00:03:03.806 --> 00:03:05.606 A:middle
UNMutableNotificationContent

00:03:05.606 --> 00:03:06.906 A:middle
的对象中进行添加

00:03:08.056 --> 00:03:10.096 A:middle
而在远程通知的 payload 处

00:03:10.096 --> 00:03:11.876 A:middle
你也可以将

00:03:11.876 --> 00:03:13.706 A:middle
线程标识添加进去

00:03:15.756 --> 00:03:17.816 A:middle
现在你们

00:03:17.816 --> 00:03:19.696 A:middle
可能已经比较了解线程标识了

00:03:20.996 --> 00:03:23.616 A:middle
现在我们用它

00:03:23.616 --> 00:03:25.486 A:middle
将通知发送给

00:03:25.486 --> 00:03:27.126 A:middle
App 的

00:03:27.126 --> 00:03:28.976 A:middle
通知内容扩展

00:03:29.176 --> 00:03:30.406 A:middle
App 必须带有

00:03:30.406 --> 00:03:32.336 A:middle
同样的线程标识

00:03:32.336 --> 00:03:33.986 A:middle
才能根据新通知

00:03:34.026 --> 00:03:35.846 A:middle
来更新内容扩展视图

00:03:37.256 --> 00:03:39.346 A:middle
我们从 iOS 11 起

00:03:39.346 --> 00:03:41.536 A:middle
如果用户之前开启了 [ 音质不清晰 ]

00:03:41.536 --> 00:03:43.386 A:middle
我们便可以使用线程标识

00:03:43.386 --> 00:03:46.326 A:middle
对通知进行分组

00:03:47.156 --> 00:03:48.126 A:middle
可以说

00:03:48.126 --> 00:03:50.006 A:middle
我们拓展了线程标识的运用

00:03:50.006 --> 00:03:51.096 A:middle
将其覆盖所有类型的通知

00:03:52.756 --> 00:03:54.726 A:middle
那通知分组是如何实现的呢

00:03:55.446 --> 00:03:57.166 A:middle
你的设备

00:03:57.166 --> 00:03:59.676 A:middle
接收到新通知时

00:03:59.676 --> 00:04:01.556 A:middle
如果该通知不包含

00:03:59.676 --> 00:04:01.556 A:middle
如果该通知不包含

00:04:01.676 --> 00:04:03.826 A:middle
线程标识

00:04:04.246 --> 00:04:05.496 A:middle
那这条通知

00:04:05.496 --> 00:04:06.926 A:middle
会根据所属 App 进行分组

00:04:08.146 --> 00:04:09.746 A:middle
正如这个例子

00:04:09.746 --> 00:04:11.476 A:middle
所展示的

00:04:11.476 --> 00:04:13.496 A:middle
接收到的新通知

00:04:13.496 --> 00:04:14.446 A:middle
都被分到了同一组

00:04:14.446 --> 00:04:16.796 A:middle
而该分组显示的

00:04:16.796 --> 00:04:17.986 A:middle
是接收到的

00:04:17.986 --> 00:04:18.406 A:middle
最新通知

00:04:18.476 --> 00:04:20.286 A:middle
然后用户可以

00:04:20.286 --> 00:04:21.766 A:middle
轻松展开分组

00:04:21.935 --> 00:04:23.266 A:middle
来阅读现有的

00:04:23.266 --> 00:04:27.086 A:middle
所有通知

00:04:27.276 --> 00:04:28.706 A:middle
另一方面

00:04:28.706 --> 00:04:30.296 A:middle
如果通知带有

00:04:30.296 --> 00:04:32.536 A:middle
线程标识

00:04:32.536 --> 00:04:33.976 A:middle
这条通知会与

00:04:33.976 --> 00:04:35.556 A:middle
相同 App

00:04:35.556 --> 00:04:37.436 A:middle
且带有同样线程 ID 的通知

00:04:37.436 --> 00:04:38.116 A:middle
分到一组

00:04:39.246 --> 00:04:40.666 A:middle
这意味着

00:04:40.666 --> 00:04:42.296 A:middle
相同 App 可以有

00:04:42.296 --> 00:04:43.446 A:middle
多个自定义的

00:04:43.446 --> 00:04:44.596 A:middle
通知分组

00:04:44.596 --> 00:04:46.046 A:middle
通过你设置的不同的线程标识

00:04:46.046 --> 00:04:46.806 A:middle
进行区分

00:04:47.326 --> 00:04:50.346 A:middle
Messages 这个 App

00:04:50.346 --> 00:04:52.166 A:middle
是一个很好的例子

00:04:52.166 --> 00:04:53.176 A:middle
大家可以看到

00:04:53.176 --> 00:04:54.996 A:middle
这里有两个分组

00:04:55.136 --> 00:04:56.596 A:middle
当接收到新通知时

00:04:56.596 --> 00:04:57.636 A:middle
新通知会被分到

00:04:57.636 --> 00:04:58.556 A:middle
相对应的分组中

00:04:59.016 --> 00:05:02.516 A:middle
用户可以打开

00:04:59.016 --> 00:05:02.516 A:middle
用户可以打开

00:05:02.516 --> 00:05:03.906 A:middle
其中一个分组

00:05:03.906 --> 00:05:05.356 A:middle
来查看该分组中

00:05:05.396 --> 00:05:05.786 A:middle
所包含的通知

00:05:06.956 --> 00:05:07.926 A:middle
所以通过使用线程标识

00:05:07.926 --> 00:05:09.676 A:middle
messages 也可以

00:05:09.676 --> 00:05:12.276 A:middle
做到这一点

00:05:12.516 --> 00:05:14.426 A:middle
使用你的 App 的用户

00:05:14.426 --> 00:05:16.356 A:middle
也可以在每个 App 的

00:05:16.356 --> 00:05:17.636 A:middle
通知设置页面

00:05:17.956 --> 00:05:19.276 A:middle
来修改

00:05:19.276 --> 00:05:20.526 A:middle
通知分组的设置

00:05:21.426 --> 00:05:23.216 A:middle
用户有三个选项可以选择

00:05:23.696 --> 00:05:25.536 A:middle
如果用户选择自动

00:05:25.536 --> 00:05:26.756 A:middle
那他所得到的结果

00:05:26.756 --> 00:05:27.496 A:middle
我们刚刚讲过

00:05:28.836 --> 00:05:30.786 A:middle
然而用户还可以

00:05:30.786 --> 00:05:32.286 A:middle
选择只按照 App

00:05:32.286 --> 00:05:34.146 A:middle
进行分组

00:05:34.146 --> 00:05:35.156 A:middle
此时系统会忽略

00:05:35.156 --> 00:05:36.706 A:middle
线程标识

00:05:36.706 --> 00:05:38.376 A:middle
并将同一个 App 的通知

00:05:38.376 --> 00:05:39.246 A:middle
全部归为一组

00:05:39.996 --> 00:05:41.846 A:middle
如果用户想要

00:05:41.846 --> 00:05:43.926 A:middle
iOS 11 的分组方式

00:05:43.926 --> 00:05:45.596 A:middle
他们现在可以

00:05:45.596 --> 00:05:46.586 A:middle
关闭分组通知

00:05:46.586 --> 00:05:47.806 A:middle
非常简单

00:05:48.486 --> 00:05:49.926 A:middle
所以要记住

00:05:49.926 --> 00:05:50.986 A:middle
当你创建了自定义分组

00:05:50.986 --> 00:05:53.436 A:middle
这个分组

00:05:53.436 --> 00:05:55.486 A:middle
要能在用户

00:05:55.486 --> 00:05:56.516 A:middle
接收你的 App 的通知时

00:05:56.516 --> 00:05:57.246 A:middle
对用户有一定的价值

00:05:58.756 --> 00:06:00.606 A:middle
下面我们来看看

00:05:58.756 --> 00:06:00.606 A:middle
下面我们来看看

00:06:00.606 --> 00:06:01.956 A:middle
一个通知组

00:06:01.956 --> 00:06:02.186 A:middle
有哪些部分组成

00:06:03.386 --> 00:06:05.076 A:middle
这里显示的内容

00:06:05.076 --> 00:06:06.696 A:middle
是该通知组中

00:06:06.696 --> 00:06:08.106 A:middle
最新的一条通知

00:06:08.546 --> 00:06:11.996 A:middle
用户只需点击这个分组

00:06:11.996 --> 00:06:13.936 A:middle
就可以看见其中

00:06:13.936 --> 00:06:16.166 A:middle
所有的通知

00:06:16.166 --> 00:06:17.196 A:middle
通知的内容也同时展开

00:06:17.196 --> 00:06:19.086 A:middle
然后用户可以

00:06:19.086 --> 00:06:20.356 A:middle
单独处理

00:06:20.356 --> 00:06:21.216 A:middle
每一个通知

00:06:22.236 --> 00:06:23.876 A:middle
上方的两个按钮

00:06:23.876 --> 00:06:25.246 A:middle
可以让用户更好地

00:06:25.246 --> 00:06:26.956 A:middle
管理通知

00:06:26.956 --> 00:06:28.146 A:middle
比如一键合并分组

00:06:28.146 --> 00:06:29.466 A:middle
或清除该分组的所有通知

00:06:32.156 --> 00:06:34.206 A:middle
通知分组

00:06:34.206 --> 00:06:35.806 A:middle
让用户对通知的优先级管理

00:06:36.066 --> 00:06:36.646 A:middle
变得更容易

00:06:37.036 --> 00:06:38.446 A:middle
举个例子

00:06:38.746 --> 00:06:39.896 A:middle
如果用户想要

00:06:39.896 --> 00:06:41.526 A:middle
清除这些通知

00:06:41.526 --> 00:06:43.116 A:middle
只需向左滑动

00:06:43.116 --> 00:06:43.526 A:middle
然后点击清除所有即可

00:06:46.156 --> 00:06:47.916 A:middle
除去显示

00:06:47.916 --> 00:06:49.936 A:middle
通知组的内容

00:06:50.026 --> 00:06:50.986 A:middle
我们还会显示一行概略文本

00:06:51.436 --> 00:06:52.906 A:middle
这行概略文本

00:06:52.906 --> 00:06:54.886 A:middle
默认显示

00:06:54.886 --> 00:06:56.486 A:middle
该分组中包含的

00:06:56.486 --> 00:06:57.126 A:middle
通知数量

00:06:58.436 --> 00:07:00.276 A:middle
然而你也可以创建

00:06:58.436 --> 00:07:00.276 A:middle
然而你也可以创建

00:07:00.276 --> 00:07:02.046 A:middle
自定义的概略文本

00:07:02.046 --> 00:07:03.756 A:middle
让用户能

00:07:03.756 --> 00:07:05.556 A:middle
更好地理解

00:07:05.556 --> 00:07:07.906 A:middle
该通知组中的内容

00:07:09.016 --> 00:07:11.066 A:middle
我们会在下一场会议上

00:07:11.516 --> 00:07:14.276 A:middle
给大家细讲这部分的接口

00:07:14.276 --> 00:07:15.586 A:middle
并拓展更多用例

00:07:15.586 --> 00:07:17.406 A:middle
告诉大家

00:07:17.496 --> 00:07:18.236 A:middle
如何通过分组通知

00:07:18.236 --> 00:07:20.136 A:middle
创建自定义分组

00:07:22.036 --> 00:07:23.846 A:middle
现在我给大家

00:07:23.846 --> 00:07:25.156 A:middle
简单总结一下

00:07:25.156 --> 00:07:26.026 A:middle
分组通知

00:07:26.696 --> 00:07:28.126 A:middle
从 iOS 12 起

00:07:28.126 --> 00:07:29.966 A:middle
所有 App 的通知

00:07:29.966 --> 00:07:31.376 A:middle
将会被自动分组

00:07:31.886 --> 00:07:34.646 A:middle
如果想创建

00:07:34.646 --> 00:07:36.486 A:middle
自定义分组

00:07:36.486 --> 00:07:38.056 A:middle
你需要使用

00:07:38.056 --> 00:07:40.896 A:middle
线程标识

00:07:40.896 --> 00:07:42.736 A:middle
但是用户

00:07:42.736 --> 00:07:43.806 A:middle
可以改变

00:07:43.806 --> 00:07:45.166 A:middle
这一分组设定

00:07:47.096 --> 00:07:48.486 A:middle
最后就是

00:07:48.486 --> 00:07:50.716 A:middle
你可以自定义

00:07:50.716 --> 00:07:51.996 A:middle
概略文本的内容

00:07:51.996 --> 00:07:53.986 A:middle
在通知组中

00:07:53.986 --> 00:07:55.006 A:middle
展现给用户

00:07:55.256 --> 00:07:58.706 A:middle
以上就是关于

00:07:58.706 --> 00:07:59.426 A:middle
分组通知的内容

00:07:59.926 --> 00:08:01.416 A:middle
我们的下一个主题

00:07:59.926 --> 00:08:01.416 A:middle
我们的下一个主题

00:08:01.416 --> 00:08:03.016 A:middle
有关于

00:08:03.016 --> 00:08:04.706 A:middle
通知内容扩展

00:08:05.236 --> 00:08:07.466 A:middle
你们当中有些人

00:08:07.466 --> 00:08:08.606 A:middle
可能已经比较熟悉

00:08:08.606 --> 00:08:10.716 A:middle
iOS 10 中的通知内容扩展了

00:08:11.976 --> 00:08:13.726 A:middle
通知内容扩展

00:08:13.726 --> 00:08:15.776 A:middle
可以丰富

00:08:15.776 --> 00:08:17.686 A:middle
App 通知的

00:08:18.006 --> 00:08:20.076 A:middle
展现形式

00:08:20.076 --> 00:08:21.996 A:middle
这样用户看见的

00:08:21.996 --> 00:08:23.706 A:middle
是更加量身定制

00:08:23.706 --> 00:08:25.936 A:middle
交互性也更高的通知

00:08:25.936 --> 00:08:28.836 A:middle
我们来简单回顾一下

00:08:28.836 --> 00:08:29.846 A:middle
如何创建

00:08:29.846 --> 00:08:30.436 A:middle
通知内容扩展

00:08:31.336 --> 00:08:32.686 A:middle
Xcode 中提供了一个

00:08:32.686 --> 00:08:34.566 A:middle
标准模板

00:08:34.635 --> 00:08:35.746 A:middle
让你在你的 App 中

00:08:35.746 --> 00:08:39.456 A:middle
为通知内容扩展

00:08:39.456 --> 00:08:40.986 A:middle
添加一个 target

00:08:40.986 --> 00:08:42.306 A:middle
一旦你设置好 我们就为通知的 view controller

00:08:42.306 --> 00:08:44.476 A:middle
创建了一个默认的类

00:08:44.476 --> 00:08:46.296 A:middle
这个类会执行

00:08:46.296 --> 00:08:46.716 A:middle
UNNotificationContentExtension 协议

00:08:47.606 --> 00:08:49.026 A:middle
在这里 did receive notification 方法

00:08:49.026 --> 00:08:51.186 A:middle
非常重要

00:08:51.186 --> 00:08:52.516 A:middle
因为这是创建

00:08:52.516 --> 00:08:53.576 A:middle
内容扩展相关视图的

00:08:53.576 --> 00:08:55.116 A:middle
第一步

00:08:55.116 --> 00:08:57.096 A:middle
你可以用

00:08:57.096 --> 00:08:59.276 A:middle
此处的通知对象

00:08:59.276 --> 00:09:01.006 A:middle
来获取通知的相关信息

00:08:59.276 --> 00:09:01.006 A:middle
来获取通知的相关信息

00:09:01.006 --> 00:09:02.586 A:middle
然后创建你的

00:09:02.586 --> 00:09:03.126 A:middle
自定义视图

00:09:05.436 --> 00:09:07.776 A:middle
与内容扩展相关联的

00:09:07.776 --> 00:09:08.856 A:middle
info.plist 文件

00:09:08.996 --> 00:09:10.076 A:middle
让你有更多选择

00:09:11.226 --> 00:09:12.876 A:middle
这里最重要的是

00:09:12.876 --> 00:09:14.026 A:middle
类别标识

00:09:14.466 --> 00:09:16.056 A:middle
此处的类别标识

00:09:16.056 --> 00:09:17.246 A:middle
需要与你通知请求中的

00:09:17.246 --> 00:09:18.846 A:middle
类别标识

00:09:18.846 --> 00:09:20.066 A:middle
保持一致

00:09:20.476 --> 00:09:21.546 A:middle
这样系统才知道

00:09:21.546 --> 00:09:23.076 A:middle
哪个内容扩展

00:09:23.076 --> 00:09:24.566 A:middle
对应哪条通知

00:09:26.236 --> 00:09:28.546 A:middle
此外 你也可以

00:09:28.546 --> 00:09:30.516 A:middle
快速配置

00:09:30.516 --> 00:09:31.756 A:middle
内容扩展

00:09:31.756 --> 00:09:33.436 A:middle
例如设置 initial content size ratio

00:09:33.436 --> 00:09:34.936 A:middle
隐藏默认内容

00:09:34.936 --> 00:09:36.706 A:middle
以及覆盖

00:09:36.836 --> 00:09:38.576 A:middle
该内容扩展的标题

00:09:39.796 --> 00:09:41.896 A:middle
用户与这些

00:09:41.896 --> 00:09:43.526 A:middle
内容扩展产生交互的

00:09:43.526 --> 00:09:45.136 A:middle
主要方式是

00:09:45.136 --> 00:09:47.086 A:middle
通知的 action

00:09:47.086 --> 00:09:48.786 A:middle
这些 action

00:09:48.786 --> 00:09:50.836 A:middle
显示在内容扩展的内容下方

00:09:52.136 --> 00:09:53.786 A:middle
我们也来回顾一下

00:09:53.786 --> 00:09:54.716 A:middle
如何创建这些 action 吧

00:09:56.126 --> 00:09:57.976 A:middle
这一步在代码中非常简单

00:09:58.506 --> 00:10:00.216 A:middle
举个例子

00:09:58.506 --> 00:10:00.216 A:middle
举个例子

00:10:00.216 --> 00:10:01.566 A:middle
这里我们有两个 action 点赞和评论

00:10:01.566 --> 00:10:03.706 A:middle
我们为点赞创建一个简单的

00:10:03.706 --> 00:10:05.336 A:middle
UNNotificationAction

00:10:06.746 --> 00:10:08.966 A:middle
为评论创建一个文字输入 action

00:10:11.596 --> 00:10:12.836 A:middle
创建完之后

00:10:12.836 --> 00:10:14.236 A:middle
我们创建一个

00:10:14.236 --> 00:10:16.186 A:middle
新的类型

00:10:16.186 --> 00:10:17.616 A:middle
让它的类型标识

00:10:17.616 --> 00:10:19.186 A:middle
跟内容扩展的

00:10:19.186 --> 00:10:20.256 A:middle
保持一致

00:10:20.256 --> 00:10:23.216 A:middle
然后我们提交

00:10:23.216 --> 00:10:27.656 A:middle
这两个新创建的 action

00:10:27.656 --> 00:10:29.476 A:middle
建立好这个类型之后

00:10:29.476 --> 00:10:30.406 A:middle
我们就可以调用

00:10:30.406 --> 00:10:32.576 A:middle
与我们的 class 关联的

00:10:32.576 --> 00:10:34.436 A:middle
UNNotificationCenter 对象的

00:10:34.436 --> 00:10:35.876 A:middle
setNotificationCategories

00:10:36.176 --> 00:10:38.766 A:middle
赋予它我们创建的新类型

00:10:40.856 --> 00:10:43.276 A:middle
通过这个简单方法

00:10:43.276 --> 00:10:44.266 A:middle
下次用户碰到

00:10:44.266 --> 00:10:46.226 A:middle
你的内容扩展时

00:10:46.226 --> 00:10:47.486 A:middle
用户可以通过这些 action

00:10:47.486 --> 00:10:49.066 A:middle
与你的通知内容

00:10:49.066 --> 00:10:50.526 A:middle
进行交互

00:10:51.636 --> 00:10:53.216 A:middle
下面我们看一下

00:10:53.216 --> 00:10:54.856 A:middle
如何处理从这些 action 中

00:10:54.856 --> 00:10:55.516 A:middle
得到的响应

00:10:55.996 --> 00:10:57.306 A:middle
有两种方式

00:10:58.636 --> 00:11:00.116 A:middle
第一个

00:10:58.636 --> 00:11:00.116 A:middle
第一个

00:11:00.116 --> 00:11:02.206 A:middle
你可以在 App 关联的

00:11:02.206 --> 00:11:03.366 A:middle
AppDelegate（App 委托）中进行处理

00:11:03.366 --> 00:11:05.386 A:middle
App 需要执行

00:11:05.386 --> 00:11:07.836 A:middle
UNUserNotificationCenter 的授权协议

00:11:08.626 --> 00:11:09.716 A:middle
在这里

00:11:09.716 --> 00:11:11.206 A:middle
UserNotificationCenter

00:11:11.206 --> 00:11:12.906 A:middle
接收到响应

00:11:12.906 --> 00:11:15.496 A:middle
其中包括

00:11:15.496 --> 00:11:17.176 A:middle
请求的信息

00:11:17.516 --> 00:11:18.716 A:middle
和用户行为的

00:11:18.716 --> 00:11:20.046 A:middle
通知请求

00:11:21.346 --> 00:11:22.916 A:middle
然而内容扩展

00:11:23.176 --> 00:11:24.826 A:middle
也可以让你

00:11:24.946 --> 00:11:26.946 A:middle
拦截这个 action 的响应

00:11:26.946 --> 00:11:28.906 A:middle
这样你就可以运用内容扩展

00:11:28.906 --> 00:11:30.026 A:middle
来更新视图

00:11:30.026 --> 00:11:31.906 A:middle
并创建一个更具交互性的

00:11:31.906 --> 00:11:32.806 A:middle
动态用户体验

00:11:33.586 --> 00:11:35.986 A:middle
在这个示例中

00:11:35.986 --> 00:11:37.506 A:middle
我们输入了 did receive response 方法

00:11:38.366 --> 00:11:39.416 A:middle
并对点赞这个动作

00:11:39.416 --> 00:11:41.056 A:middle
进行检测

00:11:42.006 --> 00:11:44.196 A:middle
然后我们用新的 label

00:11:44.306 --> 00:11:45.956 A:middle
更新 UI

00:11:45.956 --> 00:11:46.886 A:middle
也更新 App 状态

00:11:48.476 --> 00:11:50.146 A:middle
最后调用 completion

00:11:50.146 --> 00:11:51.376 A:middle
设为 do not dismiss

00:11:51.956 --> 00:11:53.266 A:middle
如果你想要在此处

00:11:53.266 --> 00:11:54.476 A:middle
忽略内容扩展视图

00:11:54.696 --> 00:11:56.486 A:middle
那么你只需将

00:11:56.486 --> 00:11:57.646 A:middle
传送给 completion 的

00:11:57.646 --> 00:12:00.796 A:middle
参数设为 dismiss 或

00:11:57.646 --> 00:12:00.796 A:middle
参数设为 dismiss 或

00:12:00.796 --> 00:12:02.586 A:middle
dismiss and forward

00:12:02.586 --> 00:12:03.896 A:middle
后者会将响应发送给

00:12:03.896 --> 00:12:05.176 A:middle
AppDelegate（App 委托）

00:12:05.176 --> 00:12:07.676 A:middle
这个功能创建完毕后

00:12:07.676 --> 00:12:09.396 A:middle
我们可以看到

00:12:09.396 --> 00:12:10.776 A:middle
当用户点赞时

00:12:11.136 --> 00:12:13.206 A:middle
内容扩展

00:12:13.206 --> 00:12:14.446 A:middle
可以即时得到更新

00:12:14.966 --> 00:12:16.516 A:middle
这种方式增强了

00:12:16.516 --> 00:12:17.946 A:middle
用户交互

00:12:17.946 --> 00:12:18.846 A:middle
他们也可以得到

00:12:18.846 --> 00:12:19.886 A:middle
即时反馈

00:12:21.116 --> 00:12:22.566 A:middle
但是如果观察

00:12:22.626 --> 00:12:23.966 A:middle
内容扩展的当前状态

00:12:23.966 --> 00:12:26.576 A:middle
我们会发现一些

00:12:26.576 --> 00:12:28.106 A:middle
冗余的信息

00:12:28.996 --> 00:12:30.526 A:middle
用户点赞后

00:12:30.526 --> 00:12:32.136 A:middle
再保留

00:12:32.136 --> 00:12:33.506 A:middle
点赞这个 action

00:12:33.506 --> 00:12:34.416 A:middle
就没有意义了

00:12:36.236 --> 00:12:38.206 A:middle
通常来说

00:12:38.206 --> 00:12:39.416 A:middle
通知 action

00:12:39.416 --> 00:12:40.176 A:middle
有一定局限

00:12:41.606 --> 00:12:43.506 A:middle
通知不太具有动态

00:12:43.606 --> 00:12:45.316 A:middle
也无法根据

00:12:45.316 --> 00:12:46.646 A:middle
内容扩展的场景

00:12:46.646 --> 00:12:47.226 A:middle
进行更新

00:12:48.696 --> 00:12:51.046 A:middle
还有就是这些情况

00:12:51.046 --> 00:12:52.846 A:middle
与通知的类型有关联

00:12:52.846 --> 00:12:54.336 A:middle
而通知的类型在创建 App 时

00:12:54.586 --> 00:12:55.726 A:middle
必须定义好

00:12:56.946 --> 00:12:58.526 A:middle
我们想解决这个问题

00:12:58.526 --> 00:13:00.396 A:middle
所以新增了一个

00:12:58.526 --> 00:13:00.396 A:middle
所以新增了一个

00:13:00.396 --> 00:13:02.326 A:middle
通知 action 的接口

00:13:02.326 --> 00:13:04.206 A:middle
有了这个接口

00:13:04.206 --> 00:13:05.496 A:middle
我们就将通知 action

00:13:05.496 --> 00:13:06.666 A:middle
纳入

00:13:06.666 --> 00:13:08.736 A:middle
NSExtensionContext

00:13:08.736 --> 00:13:09.596 A:middle
从而绑定内容扩展

00:13:10.686 --> 00:13:12.356 A:middle
这个接口

00:13:12.576 --> 00:13:14.146 A:middle
让你可以访问

00:13:14.146 --> 00:13:15.626 A:middle
现阶段面向用户的

00:13:15.626 --> 00:13:17.626 A:middle
通知 action

00:13:17.626 --> 00:13:19.526 A:middle
也可以通过

00:13:19.526 --> 00:13:20.766 A:middle
为内容扩展建立

00:13:20.766 --> 00:13:25.556 A:middle
全新的通知 action 数组进行替换

00:13:25.556 --> 00:13:27.016 A:middle
我们再来看示例

00:13:27.076 --> 00:13:28.826 A:middle
如果用户点赞后

00:13:28.826 --> 00:13:30.476 A:middle
我们想将点赞的 action

00:13:30.476 --> 00:13:32.546 A:middle
替换成撤销点赞的 action

00:13:32.546 --> 00:13:33.896 A:middle
怎么让用户可以对刚才的操作

00:13:33.896 --> 00:13:36.776 A:middle
进行反向操作呢

00:13:36.956 --> 00:13:39.226 A:middle
我们看一下

00:13:39.226 --> 00:13:40.356 A:middle
如何用新的接口

00:13:40.356 --> 00:13:41.286 A:middle
进行设置

00:13:41.376 --> 00:13:42.816 A:middle
我们回到 did receive response 方法

00:13:42.816 --> 00:13:44.206 A:middle
再一次识别

00:13:44.626 --> 00:13:46.296 A:middle
点赞行为

00:13:46.296 --> 00:13:47.716 A:middle
并更新我们的 App 状态

00:13:48.916 --> 00:13:51.216 A:middle
这一次我们还创建了

00:13:51.216 --> 00:13:53.446 A:middle
一个新的撤销点赞的 action

00:13:53.446 --> 00:13:55.476 A:middle
给它添加一个独有的标识和标题

00:13:56.056 --> 00:13:59.816 A:middle
我们可以再看一下

00:13:59.816 --> 00:14:01.436 A:middle
现有的 action

00:13:59.816 --> 00:14:01.436 A:middle
现有的 action

00:14:01.436 --> 00:14:02.956 A:middle
这样就可以提取

00:14:02.956 --> 00:14:04.606 A:middle
评论的 action

00:14:04.606 --> 00:14:06.056 A:middle
而不用再次创建

00:14:07.276 --> 00:14:09.276 A:middle
然后我们创建一个

00:14:09.276 --> 00:14:10.326 A:middle
新 action 的数组

00:14:10.326 --> 00:14:13.526 A:middle
将数组设为

00:14:13.606 --> 00:14:14.936 A:middle
通知 action 的变量就可以了

00:14:17.456 --> 00:14:19.536 A:middle
这步完成后

00:14:19.536 --> 00:14:21.656 A:middle
用户点赞之后

00:14:21.656 --> 00:14:23.666 A:middle
UI 会自动变化

00:14:23.786 --> 00:14:26.236 A:middle
展示新的 action

00:14:26.236 --> 00:14:27.416 A:middle
然后用户可以再在

00:14:27.416 --> 00:14:28.356 A:middle
两个 action 中进行选择

00:14:28.566 --> 00:14:29.796 A:middle
这取决于你如何

00:14:29.796 --> 00:14:30.956 A:middle
在内容扩展中

00:14:30.956 --> 00:14:31.486 A:middle
处理状态

00:14:32.596 --> 00:14:34.726 A:middle
这个接口

00:14:34.726 --> 00:14:36.026 A:middle
还有其他多个用法

00:14:36.516 --> 00:14:38.696 A:middle
例如

00:14:38.696 --> 00:14:40.446 A:middle
在 did receive notification 方法中

00:14:40.446 --> 00:14:41.486 A:middle
你可以在

00:14:41.486 --> 00:14:43.116 A:middle
创建内容扩展视图的同时

00:14:43.116 --> 00:14:44.306 A:middle
创建你的 action

00:14:45.036 --> 00:14:46.306 A:middle
这意味着

00:14:46.306 --> 00:14:47.916 A:middle
你的通知请求

00:14:47.916 --> 00:14:49.826 A:middle
在定义

00:14:49.826 --> 00:14:51.386 A:middle
通知的 action 时

00:14:51.386 --> 00:14:53.016 A:middle
不再与类型绑定在一起

00:14:53.016 --> 00:14:57.126 A:middle
现在你还可以

00:14:57.126 --> 00:14:58.956 A:middle
展示二级 action

00:14:58.956 --> 00:15:00.846 A:middle
只要将当前 action 替换掉就可以了

00:14:58.956 --> 00:15:00.846 A:middle
只要将当前 action 替换掉就可以了

00:15:01.236 --> 00:15:03.306 A:middle
例如

00:15:03.306 --> 00:15:05.326 A:middle
如果首发 action 是评分

00:15:05.326 --> 00:15:07.046 A:middle
下面你就可以建立一个

00:15:07.046 --> 00:15:08.406 A:middle
包含不同评分类型的二级列表

00:15:08.406 --> 00:15:10.366 A:middle
以供用户选择

00:15:12.156 --> 00:15:14.556 A:middle
如果你认为

00:15:14.556 --> 00:15:16.176 A:middle
内容扩展没有必要

00:15:16.176 --> 00:15:17.746 A:middle
再显示这些 action 了

00:15:17.746 --> 00:15:19.316 A:middle
你可以

00:15:19.316 --> 00:15:20.716 A:middle
将它们去掉

00:15:21.106 --> 00:15:26.476 A:middle
这就是通知动作的新接口

00:15:26.796 --> 00:15:28.456 A:middle
我们认为

00:15:28.456 --> 00:15:30.706 A:middle
这可以大大增强

00:15:30.706 --> 00:15:32.316 A:middle
你的内容扩展的

00:15:32.316 --> 00:15:33.986 A:middle
用户体验

00:15:33.986 --> 00:15:39.036 A:middle
因为现在你可以 展示给用户多个选择

00:15:39.216 --> 00:15:40.576 A:middle
我们来看下一个主题

00:15:40.576 --> 00:15:41.806 A:middle
内容扩展的

00:15:41.806 --> 00:15:42.676 A:middle
用户交互

00:15:43.836 --> 00:15:45.796 A:middle
到目前为止

00:15:45.796 --> 00:15:47.726 A:middle
通知 action 很重要

00:15:48.036 --> 00:15:51.146 A:middle
因为 iOS 11 以前

00:15:51.146 --> 00:15:53.166 A:middle
我们不允许在

00:15:53.256 --> 00:15:56.196 A:middle
内容扩展视图中进行用户交互

00:15:56.416 --> 00:15:57.486 A:middle
我们收到了

00:15:57.486 --> 00:15:58.536 A:middle
很多相关反馈

00:15:58.906 --> 00:16:00.706 A:middle
而我现在很高兴地宣布

00:15:58.906 --> 00:16:00.706 A:middle
而我现在很高兴地宣布

00:16:00.836 --> 00:16:01.846 A:middle
我们在 iOS 12 中

00:16:01.846 --> 00:16:03.126 A:middle
去掉了这项限制

00:16:04.516 --> 00:16:07.546 A:middle
[ 掌声 ]

00:16:08.046 --> 00:16:09.636 A:middle
现在你在内容扩展中

00:16:09.636 --> 00:16:11.826 A:middle
可以选择

00:16:11.826 --> 00:16:13.456 A:middle
通过点触

00:16:13.456 --> 00:16:16.286 A:middle
接收用户交互

00:16:16.286 --> 00:16:17.786 A:middle
设置这个功能也很简单

00:16:18.046 --> 00:16:20.096 A:middle
你只需在

00:16:20.096 --> 00:16:22.446 A:middle
info.plist 文件中

00:16:22.446 --> 00:16:23.326 A:middle
增添一个键值项

00:16:23.766 --> 00:16:26.556 A:middle
也就是

00:16:26.556 --> 00:16:29.446 A:middle
UNNotificationExtensionUser

00:16:29.446 --> 00:16:30.386 A:middle
InteractionEnabled

00:16:32.586 --> 00:16:34.436 A:middle
再来看示例

00:16:34.696 --> 00:16:36.576 A:middle
如果我们想要

00:16:36.576 --> 00:16:38.416 A:middle
去掉点赞这个 action

00:16:38.416 --> 00:16:40.556 A:middle
将其改成

00:16:40.556 --> 00:16:42.626 A:middle
融于视图的

00:16:42.626 --> 00:16:43.326 A:middle
UI 点触交互

00:16:44.316 --> 00:16:45.506 A:middle
我们再次配置

00:16:45.506 --> 00:16:48.376 A:middle
info.plist 文件

00:16:48.376 --> 00:16:49.776 A:middle
我们可以回到内容扩展视图

00:16:50.126 --> 00:16:51.976 A:middle
创建自定义按钮

00:16:51.976 --> 00:16:53.366 A:middle
来接收点赞

00:16:54.716 --> 00:16:56.396 A:middle
我们在私有方法中添加了一个 target

00:16:56.396 --> 00:16:59.806 A:middle
在这个函数中

00:16:59.806 --> 00:17:02.016 A:middle
我们更新了 UI

00:16:59.806 --> 00:17:02.016 A:middle
我们更新了 UI

00:17:02.016 --> 00:17:03.806 A:middle
还有 App 的状态

00:17:05.316 --> 00:17:06.886 A:middle
这里需要注意

00:17:06.886 --> 00:17:07.986 A:middle
由于你在执行

00:17:07.986 --> 00:17:09.915 A:middle
自定义的交互

00:17:09.915 --> 00:17:11.886 A:middle
你要负责处理

00:17:11.886 --> 00:17:13.626 A:middle
所有用户的 action

00:17:13.626 --> 00:17:14.846 A:middle
response

00:17:14.846 --> 00:17:15.316 A:middle
和 callback

00:17:17.976 --> 00:17:20.546 A:middle
这部分完成后

00:17:20.546 --> 00:17:21.556 A:middle
用户看到你的内容扩展时

00:17:21.556 --> 00:17:23.215 A:middle
就可以看见

00:17:23.215 --> 00:17:24.556 A:middle
这个点赞按钮

00:17:24.556 --> 00:17:26.705 A:middle
它是 UI 中的一部分

00:17:26.705 --> 00:17:28.666 A:middle
用户可以即时点击按钮 完成交互

00:17:33.126 --> 00:17:35.536 A:middle
这个就是我们为

00:17:35.536 --> 00:17:37.096 A:middle
内容扩展添加的新功能

00:17:37.396 --> 00:17:38.746 A:middle
有了这个功能

00:17:38.746 --> 00:17:40.076 A:middle
再加上通知 action

00:17:40.076 --> 00:17:41.686 A:middle
还有用户交互点触

00:17:41.686 --> 00:17:44.966 A:middle
你就可以利用这一组

00:17:44.966 --> 00:17:46.646 A:middle
丰富的工具

00:17:46.646 --> 00:17:48.336 A:middle
给你的 App 通知的用户

00:17:48.336 --> 00:17:49.986 A:middle
带来更具交互性的

00:17:49.986 --> 00:17:50.416 A:middle
动态内容扩展体验

00:17:52.516 --> 00:17:54.346 A:middle
接下来是

00:17:54.346 --> 00:17:55.636 A:middle
通过通知内容扩展

00:17:55.636 --> 00:17:56.906 A:middle
启动 App

00:17:58.536 --> 00:18:01.146 A:middle
现在 即使没有点触位置

00:17:58.536 --> 00:18:01.146 A:middle
现在 即使没有点触位置

00:18:01.146 --> 00:18:03.216 A:middle
用户只需点击

00:18:03.216 --> 00:18:04.706 A:middle
内容扩展视图

00:18:04.916 --> 00:18:07.126 A:middle
就可以轻松打开 App

00:18:08.036 --> 00:18:09.786 A:middle
用户也可以点击

00:18:10.046 --> 00:18:12.116 A:middle
通知左上角的

00:18:12.596 --> 00:18:14.126 A:middle
App 图标

00:18:14.226 --> 00:18:15.966 A:middle
或者你可以创建一个

00:18:15.966 --> 00:18:17.786 A:middle
foreground action

00:18:17.786 --> 00:18:19.266 A:middle
让用户打开 App

00:18:20.936 --> 00:18:22.926 A:middle
那我们如何能

00:18:22.926 --> 00:18:24.646 A:middle
自定义启动 App 的控制呢

00:18:25.986 --> 00:18:27.056 A:middle
如果你想通过代码启动

00:18:27.056 --> 00:18:28.306 A:middle
要怎么做呢

00:18:29.206 --> 00:18:30.746 A:middle
使用 NSExtensionContext

00:18:30.746 --> 00:18:33.136 A:middle
的一个新接口

00:18:33.136 --> 00:18:34.656 A:middle
就可以做到这点

00:18:34.656 --> 00:18:36.476 A:middle
这个接口是 performNotification

00:18:36.476 --> 00:18:40.936 A:middle
DefaultAction

00:18:40.936 --> 00:18:42.546 A:middle
那么 default action 是什么呢

00:18:43.156 --> 00:18:45.006 A:middle
刚才说过 default action

00:18:45.006 --> 00:18:47.046 A:middle
可以启动 App

00:18:47.046 --> 00:18:48.036 A:middle
但是同时

00:18:48.036 --> 00:18:49.776 A:middle
会在 App 委托

00:18:49.776 --> 00:18:51.826 A:middle
调用 UserNotificationCenter 的

00:18:51.826 --> 00:18:52.656 A:middle
did receive response 方法

00:18:54.066 --> 00:18:55.416 A:middle
UNNotificationResponse 的对象

00:18:55.416 --> 00:18:56.876 A:middle
记录用户

00:18:56.876 --> 00:18:58.316 A:middle
是从哪条通知

00:18:58.316 --> 00:19:00.536 A:middle
点进来的

00:18:58.316 --> 00:19:00.536 A:middle
点进来的

00:19:00.536 --> 00:19:02.476 A:middle
这样你就可以根据通知

00:19:02.686 --> 00:19:03.416 A:middle
更新 App 状态

00:19:04.696 --> 00:19:06.256 A:middle
这里使用的

00:19:06.256 --> 00:19:08.766 A:middle
标识符是 UNNotificationDefault

00:19:08.766 --> 00:19:09.746 A:middle
ActionIdentifier

00:19:10.246 --> 00:19:12.846 A:middle
让我们通过示例

00:19:12.956 --> 00:19:14.316 A:middle
看一下如何设置

00:19:14.316 --> 00:19:15.806 A:middle
自定义的启动控制

00:19:17.096 --> 00:19:19.226 A:middle
现在我们创建了 UI 按钮

00:19:19.226 --> 00:19:21.626 A:middle
以显示所有评论

00:19:22.656 --> 00:19:25.736 A:middle
然后与我们的私有功能

00:19:25.736 --> 00:19:26.386 A:middle
进行绑定

00:19:27.496 --> 00:19:28.796 A:middle
在这个功能里

00:19:28.796 --> 00:19:29.546 A:middle
我们只需调用

00:19:29.546 --> 00:19:30.456 A:middle
PerformNotification

00:19:30.456 --> 00:19:31.036 A:middle
DefaultAction

00:19:31.826 --> 00:19:33.576 A:middle
这样的话

00:19:33.576 --> 00:19:35.186 A:middle
此功能就可以

00:19:35.186 --> 00:19:36.446 A:middle
在内容扩展的代码中

00:19:36.446 --> 00:19:37.586 A:middle
自动调用

00:19:37.586 --> 00:19:40.526 A:middle
这个方法

00:19:40.726 --> 00:19:42.676 A:middle
这部分是关于启动 App 的内容

00:19:43.476 --> 00:19:48.336 A:middle
如何解除内容扩展视图呢

00:19:48.546 --> 00:19:49.926 A:middle
我们再来看看

00:19:49.926 --> 00:19:51.046 A:middle
现在用户可以如何实现这一点

00:19:51.636 --> 00:19:52.866 A:middle
用户可以点击

00:19:52.866 --> 00:19:54.566 A:middle
右上角的退出按钮

00:19:55.896 --> 00:19:57.846 A:middle
或者你可以

00:19:57.846 --> 00:19:59.346 A:middle
自定义通知 action

00:19:59.676 --> 00:20:01.126 A:middle
同样可以退出

00:19:59.676 --> 00:20:01.126 A:middle
同样可以退出

00:20:01.126 --> 00:20:02.086 A:middle
内容扩展视图

00:20:02.736 --> 00:20:04.056 A:middle
我们之前讲过如何创建

00:20:04.056 --> 00:20:05.706 A:middle
那就是向 completion block

00:20:05.706 --> 00:20:06.456 A:middle
传递退出请求

00:20:08.456 --> 00:20:10.476 A:middle
如果我们想

00:20:10.476 --> 00:20:12.326 A:middle
通过自定义按钮

00:20:12.326 --> 00:20:14.006 A:middle
退出视图

00:20:14.006 --> 00:20:15.006 A:middle
我们如何通过代码实现呢

00:20:15.436 --> 00:20:16.986 A:middle
假设用户点击

00:20:16.986 --> 00:20:18.146 A:middle
点赞按钮

00:20:18.146 --> 00:20:19.646 A:middle
视图会退出

00:20:19.646 --> 00:20:21.276 A:middle
因为我们认为用户已经完成

00:20:21.276 --> 00:20:22.046 A:middle
与内容扩展的交互

00:20:23.436 --> 00:20:25.266 A:middle
为了实现这一点

00:20:25.266 --> 00:20:26.616 A:middle
我们设了一个新接口

00:20:26.616 --> 00:20:27.826 A:middle
dismissNotification

00:20:27.826 --> 00:20:29.306 A:middle
ContentExtension

00:20:29.306 --> 00:20:30.446 A:middle
它归属 NSExtensionContext

00:20:32.896 --> 00:20:35.046 A:middle
让我们回到创建点赞按钮处

00:20:35.046 --> 00:20:36.556 A:middle
这一次

00:20:36.986 --> 00:20:39.836 A:middle
我们一同调用

00:20:39.966 --> 00:20:41.376 A:middle
退出内容扩展视图的

00:20:41.376 --> 00:20:42.866 A:middle
新功能

00:20:44.676 --> 00:20:46.816 A:middle
创建好后

00:20:46.816 --> 00:20:47.816 A:middle
当用户触发点赞

00:20:47.816 --> 00:20:49.526 A:middle
内容扩展的视图

00:20:49.526 --> 00:20:52.776 A:middle
会直接退出

00:20:52.826 --> 00:20:53.986 A:middle
需要注意的一点是

00:20:53.986 --> 00:20:56.156 A:middle
调用这个方法

00:20:56.156 --> 00:20:57.746 A:middle
并不会撤回

00:20:57.876 --> 00:20:59.146 A:middle
推送给用户的通知

00:20:59.836 --> 00:21:01.816 A:middle
如果你想要撤回通知

00:20:59.836 --> 00:21:01.816 A:middle
如果你想要撤回通知

00:21:01.816 --> 00:21:04.236 A:middle
就需要使用现有的接口

00:21:04.236 --> 00:21:05.356 A:middle
移除已发送的通知

00:21:05.356 --> 00:21:06.696 A:middle
你需要使用标识符

00:21:06.696 --> 00:21:07.916 A:middle
才能使用这个功能

00:21:09.696 --> 00:21:11.296 A:middle
现在让我们总结一下

00:21:11.296 --> 00:21:13.266 A:middle
今天介绍的

00:21:13.266 --> 00:21:14.486 A:middle
所有通知内容扩展的

00:21:14.486 --> 00:21:15.926 A:middle
新接口

00:21:18.536 --> 00:21:20.506 A:middle
首先是

00:21:20.506 --> 00:21:22.166 A:middle
通知 action

00:21:22.376 --> 00:21:23.356 A:middle
你可以访问

00:21:23.356 --> 00:21:25.016 A:middle
通知 action

00:21:25.016 --> 00:21:26.686 A:middle
也可以在你的

00:21:26.686 --> 00:21:27.656 A:middle
内容扩展代码中

00:21:27.656 --> 00:21:28.646 A:middle
将其动态替换掉

00:21:28.846 --> 00:21:34.456 A:middle
你现在可以选择 在内容扩展视图中

00:21:34.456 --> 00:21:35.886 A:middle
创建可点触的

00:21:35.886 --> 00:21:36.666 A:middle
用户交互体验

00:21:36.666 --> 00:21:42.116 A:middle
你还可以通过内容扩展的代码

00:21:42.116 --> 00:21:44.926 A:middle
自动启动 App

00:21:44.926 --> 00:21:46.196 A:middle
或退出

00:21:46.196 --> 00:21:48.086 A:middle
内容扩展视图

00:21:48.266 --> 00:21:49.936 A:middle
你需要根据内容扩展的

00:21:50.056 --> 00:21:52.576 A:middle
用户体验需求进行选择

00:21:52.896 --> 00:21:56.316 A:middle
这些就是

00:21:56.316 --> 00:21:57.876 A:middle
内容扩展的

00:21:57.876 --> 00:21:59.436 A:middle
几个新的接口

00:21:59.436 --> 00:22:01.366 A:middle
希望使用后

00:21:59.436 --> 00:22:01.366 A:middle
希望使用后

00:22:01.366 --> 00:22:02.476 A:middle
可以帮助大家

00:22:02.546 --> 00:22:03.806 A:middle
增强内容扩展的

00:22:03.806 --> 00:22:04.096 A:middle
用户体验

00:22:04.096 --> 00:22:06.726 A:middle
这些就是通知内容扩展的

00:22:06.726 --> 00:22:07.276 A:middle
相关内容

00:22:07.866 --> 00:22:09.836 A:middle
我们今天的

00:22:09.836 --> 00:22:11.316 A:middle
下一个主题是

00:22:11.316 --> 00:22:12.986 A:middle
通知管理

00:22:12.986 --> 00:22:14.376 A:middle
现在欢迎

00:22:14.376 --> 00:22:15.576 A:middle
我的同事 Teja 上台

00:22:15.776 --> 00:22:15.976 A:middle
谢谢大家

00:22:16.516 --> 00:22:22.556 A:middle
[ 掌声 ]

00:22:23.056 --> 00:22:23.946 A:middle
&gt;&gt; 谢谢你 Kritarth

00:22:24.136 --> 00:22:24.946 A:middle
大家好

00:22:25.416 --> 00:22:27.206 A:middle
我是 Teja Kondapalli

00:22:27.206 --> 00:22:29.026 A:middle
我也是 iOS 通知团队的

00:22:29.026 --> 00:22:30.146 A:middle
一名工程师

00:22:30.546 --> 00:22:31.746 A:middle
下面由我

00:22:31.796 --> 00:22:33.216 A:middle
给大家介绍几个

00:22:33.216 --> 00:22:34.396 A:middle
新的接口

00:22:35.126 --> 00:22:36.546 A:middle
第一个是

00:22:36.916 --> 00:22:38.476 A:middle
通知管理

00:22:39.256 --> 00:22:40.896 A:middle
但是在我深入讲解前

00:22:40.896 --> 00:22:42.916 A:middle
我想先介绍几个

00:22:42.916 --> 00:22:46.396 A:middle
面向用户的功能

00:22:46.396 --> 00:22:47.776 A:middle
给大家一些背景知识

00:22:47.776 --> 00:22:48.756 A:middle
然后再让我们深入了解这些接口

00:22:53.136 --> 00:22:54.606 A:middle
现在 用户手机上的

00:22:54.776 --> 00:22:55.546 A:middle
App 越来越多

00:22:56.026 --> 00:22:59.166 A:middle
通知是用户与 App 产生交互的

00:22:59.166 --> 00:23:00.426 A:middle
主要方式

00:22:59.166 --> 00:23:00.426 A:middle
主要方式

00:23:00.536 --> 00:23:02.516 A:middle
然而通常

00:23:02.686 --> 00:23:04.356 A:middle
用户会陷入这样一种情况

00:23:05.176 --> 00:23:07.446 A:middle
那就是通知过多

00:23:07.766 --> 00:23:09.026 A:middle
筛选

00:23:09.076 --> 00:23:10.846 A:middle
重要通知

00:23:10.846 --> 00:23:11.096 A:middle
变得非常困难

00:23:11.646 --> 00:23:14.756 A:middle
为了减负

00:23:14.756 --> 00:23:16.726 A:middle
有些用户认为

00:23:17.046 --> 00:23:18.386 A:middle
播客的通知

00:23:19.076 --> 00:23:20.706 A:middle
无需在锁屏处显示

00:23:21.476 --> 00:23:22.966 A:middle
如果想要进行调整

00:23:23.606 --> 00:23:24.546 A:middle
用户需要

00:23:24.586 --> 00:23:25.896 A:middle
打开设置

00:23:25.896 --> 00:23:28.506 A:middle
在通知里

00:23:29.426 --> 00:23:30.776 A:middle
找到播客

00:23:30.776 --> 00:23:31.316 A:middle
再修改设置

00:23:32.786 --> 00:23:33.976 A:middle
我们想要缓解这个状况

00:23:34.616 --> 00:23:37.146 A:middle
所以在 iOS 12 中

00:23:37.146 --> 00:23:39.936 A:middle
新增了管理视图

00:23:39.936 --> 00:23:41.936 A:middle
用户可以直接

00:23:41.936 --> 00:23:43.836 A:middle
在接收通知的地方

00:23:43.836 --> 00:23:45.886 A:middle
调整通知设置

00:23:46.026 --> 00:23:46.976 A:middle
无需到设置中调整

00:23:51.206 --> 00:23:52.586 A:middle
有三个简单的方式

00:23:52.626 --> 00:23:53.936 A:middle
可以进入通知管理视图

00:23:54.436 --> 00:23:55.826 A:middle
第一个我们刚才已经看过

00:23:56.476 --> 00:23:57.536 A:middle
你只需将通知向左滑

00:23:57.536 --> 00:23:59.676 A:middle
点击管理

00:24:00.416 --> 00:24:02.126 A:middle
管理视图就会出现

00:24:03.776 --> 00:24:07.196 A:middle
第二个方式

00:24:07.196 --> 00:24:08.956 A:middle
打开通知组

00:24:08.956 --> 00:24:10.706 A:middle
点击右上角

00:24:10.706 --> 00:24:12.066 A:middle
你也可以打开管理视图

00:24:12.596 --> 00:24:15.676 A:middle
第三种方式会出现在

00:24:15.676 --> 00:24:16.386 A:middle
列表中

00:24:17.146 --> 00:24:18.616 A:middle
这取决于用户与

00:24:18.616 --> 00:24:19.476 A:middle
通知之间的交互

00:24:19.476 --> 00:24:21.006 A:middle
用户有时会看到

00:24:21.006 --> 00:24:22.566 A:middle
管理建议

00:24:22.616 --> 00:24:24.446 A:middle
就像这个一样

00:24:24.446 --> 00:24:25.676 A:middle
会询问用户是否保留

00:24:25.926 --> 00:24:27.226 A:middle
播客的通知

00:24:27.886 --> 00:24:29.496 A:middle
在这里

00:24:29.496 --> 00:24:31.346 A:middle
用户可以点击管理

00:24:31.346 --> 00:24:32.086 A:middle
进入管理视图

00:24:32.686 --> 00:24:35.456 A:middle
下面我们来仔细看一下

00:24:35.456 --> 00:24:36.196 A:middle
管理视图

00:24:36.866 --> 00:24:38.626 A:middle
非常明显

00:24:38.626 --> 00:24:40.436 A:middle
用户可以自行

00:24:40.436 --> 00:24:41.606 A:middle
在这个视图中直接修改

00:24:41.916 --> 00:24:43.216 A:middle
通知设置

00:24:44.136 --> 00:24:45.906 A:middle
如果用户想要

00:24:45.906 --> 00:24:47.976 A:middle
在设置里

00:24:47.976 --> 00:24:50.146 A:middle
做更详细的修改

00:24:50.146 --> 00:24:52.146 A:middle
可以通过设置按钮

00:24:52.146 --> 00:24:53.356 A:middle
更快地打开

00:24:53.356 --> 00:24:55.446 A:middle
设置程序

00:24:56.106 --> 00:24:58.676 A:middle
在这处视图

00:24:58.676 --> 00:24:59.896 A:middle
有一些操作用户可以直接操作

00:24:59.946 --> 00:25:04.046 A:middle
一个是 通知静音

00:24:59.946 --> 00:25:04.046 A:middle
一个是 通知静音

00:25:04.046 --> 00:25:05.676 A:middle
这个对于大家来说

00:25:05.676 --> 00:25:06.276 A:middle
可能比较陌生

00:25:07.446 --> 00:25:08.746 A:middle
有时管理视图

00:25:08.906 --> 00:25:12.816 A:middle
会显示优先发送

00:25:12.816 --> 00:25:16.746 A:middle
我们来看看 这是什么

00:25:16.746 --> 00:25:18.486 A:middle
在 iOS 中

00:25:18.486 --> 00:25:19.846 A:middle
有很多设置用户都可以修改

00:25:19.846 --> 00:25:21.686 A:middle
对于比较玩得转的用户来说

00:25:21.686 --> 00:25:22.896 A:middle
这是一大优点

00:25:23.296 --> 00:25:24.756 A:middle
他们可以自行修改设置

00:25:24.756 --> 00:25:27.326 A:middle
精确到细节

00:25:27.326 --> 00:25:29.576 A:middle
但是对于普通用户来说

00:25:29.576 --> 00:25:31.046 A:middle
我们就需要

00:25:31.046 --> 00:25:32.706 A:middle
协助他们

00:25:32.706 --> 00:25:34.516 A:middle
将通知设置分成

00:25:34.516 --> 00:25:35.076 A:middle
两大类

00:25:36.016 --> 00:25:37.436 A:middle
一是

00:25:37.566 --> 00:25:39.486 A:middle
优先发送的通知

00:25:39.536 --> 00:25:40.796 A:middle
二是静音发送的通知

00:25:43.056 --> 00:25:46.676 A:middle
我们比较熟悉优先发送的通知

00:25:47.076 --> 00:25:48.016 A:middle
这类通知

00:25:48.016 --> 00:25:48.426 A:middle
出现在我们的锁屏上

00:25:49.926 --> 00:25:50.996 A:middle
出现在

00:25:50.996 --> 00:25:51.416 A:middle
Notification Center

00:25:52.076 --> 00:25:53.486 A:middle
也会以横幅的形式出现

00:25:54.226 --> 00:25:56.376 A:middle
或在 App 图标上生成角标

00:25:56.376 --> 00:25:59.296 A:middle
也有声音提示

00:25:59.466 --> 00:26:00.806 A:middle
静音发送的通知

00:25:59.466 --> 00:26:00.806 A:middle
静音发送的通知

00:26:00.806 --> 00:26:02.966 A:middle
只会显示在

00:26:02.966 --> 00:26:04.556 A:middle
Notification Center 中

00:26:04.556 --> 00:26:08.156 A:middle
并且没有声音提示

00:26:08.346 --> 00:26:09.876 A:middle
在管理视图中

00:26:09.876 --> 00:26:12.066 A:middle
除了可以设置

00:26:12.066 --> 00:26:13.506 A:middle
优先发送通知

00:26:13.886 --> 00:26:15.176 A:middle
和静音通知

00:26:15.176 --> 00:26:17.666 A:middle
用户还可以

00:26:17.696 --> 00:26:20.226 A:middle
选择关闭通知

00:26:21.636 --> 00:26:23.806 A:middle
我知道现在大家

00:26:23.806 --> 00:26:25.146 A:middle
担心用户会关闭

00:26:25.146 --> 00:26:26.406 A:middle
你的 App 通知

00:26:26.406 --> 00:26:29.166 A:middle
所以我们

00:26:29.166 --> 00:26:31.526 A:middle
增加了一步确认

00:26:31.526 --> 00:26:33.126 A:middle
以防用户误点

00:26:33.806 --> 00:26:35.476 A:middle
用户在这里

00:26:35.766 --> 00:26:36.996 A:middle
也可以关闭通知

00:26:37.426 --> 00:26:39.636 A:middle
我们还新增了一个接口

00:26:39.636 --> 00:26:41.536 A:middle
可以在确认窗口添加

00:26:41.906 --> 00:26:44.386 A:middle
另一个选项

00:26:44.386 --> 00:26:46.166 A:middle
播客就使用了这个接口

00:26:46.706 --> 00:26:48.476 A:middle
所以这里显示去播客中设置

00:26:49.556 --> 00:26:52.176 A:middle
这个地方

00:26:52.176 --> 00:26:54.286 A:middle
链接到播客 App 内部的

00:26:54.326 --> 00:26:56.776 A:middle
自定义设置视图

00:26:56.776 --> 00:26:59.256 A:middle
用户可以更细致地设置

00:26:59.256 --> 00:27:01.106 A:middle
想要接收哪个播客

00:26:59.256 --> 00:27:01.106 A:middle
想要接收哪个播客

00:27:01.106 --> 00:27:02.696 A:middle
的通知

00:27:04.056 --> 00:27:06.096 A:middle
当你的 App 通知

00:27:06.096 --> 00:27:07.456 A:middle
数量越来越多

00:27:07.456 --> 00:27:09.536 A:middle
类型越来越丰富时

00:27:09.536 --> 00:27:13.776 A:middle
让用户可以细致地

00:27:13.776 --> 00:27:15.986 A:middle
管理什么通知是重要的

00:27:15.986 --> 00:27:17.886 A:middle
对他们来说很重要

00:27:21.476 --> 00:27:23.816 A:middle
这个链接也可以

00:27:23.966 --> 00:27:26.086 A:middle
从系统设置访问

00:27:26.336 --> 00:27:27.886 A:middle
只需进入你的 App 的

00:27:27.886 --> 00:27:28.256 A:middle
通知设置就可以找到

00:27:28.486 --> 00:27:30.046 A:middle
对于播客来说

00:27:30.376 --> 00:27:31.456 A:middle
这个链接在页面的下方

00:27:31.856 --> 00:27:34.296 A:middle
名称是播客通知设置

00:27:34.796 --> 00:27:37.356 A:middle
下面我们看看

00:27:37.356 --> 00:27:37.606 A:middle
这些如何在代码中实现

00:27:38.196 --> 00:27:41.256 A:middle
在 UNUserNotificationCenter

00:27:41.436 --> 00:27:43.256 A:middle
Delegate 这个 class 中

00:27:43.356 --> 00:27:45.906 A:middle
我们新增了一个委托方法

00:27:46.566 --> 00:27:48.986 A:middle
也就是 openSettingsFor notification

00:27:49.816 --> 00:27:51.316 A:middle
只要你执行

00:27:51.316 --> 00:27:53.296 A:middle
这个委托方法

00:27:53.296 --> 00:27:54.866 A:middle
刚才我们提到

00:27:54.866 --> 00:27:56.206 A:middle
管理视图和系统设置中

00:27:56.206 --> 00:27:57.926 A:middle
管理视图的链接

00:27:57.926 --> 00:28:00.266 A:middle
系统会自动将其扩充

00:27:57.926 --> 00:28:00.266 A:middle
系统会自动将其扩充

00:28:00.846 --> 00:28:03.206 A:middle
所以当用户点击

00:28:03.206 --> 00:28:04.456 A:middle
这些链接时

00:28:04.456 --> 00:28:06.816 A:middle
就会调用这个委托方法

00:28:06.986 --> 00:28:09.426 A:middle
重要的是

00:28:09.426 --> 00:28:10.696 A:middle
调用这个委托方法时

00:28:10.696 --> 00:28:12.096 A:middle
你必须立即给用户展示

00:28:12.096 --> 00:28:13.856 A:middle
可以在 App 内

00:28:13.856 --> 00:28:15.906 A:middle
调整通知设置的

00:28:15.906 --> 00:28:19.106 A:middle
管理视图

00:28:19.366 --> 00:28:22.246 A:middle
有人可能注意到

00:28:22.246 --> 00:28:23.626 A:middle
我们给这个方法增加了一个参数

00:28:23.626 --> 00:28:25.766 A:middle
叫做 notification

00:28:26.236 --> 00:28:27.726 A:middle
链接在不同地方触发

00:28:27.726 --> 00:28:29.126 A:middle
会有不同影响

00:28:29.126 --> 00:28:31.686 A:middle
如果是在某个管理视图

00:28:31.686 --> 00:28:33.306 A:middle
链接会包含

00:28:33.566 --> 00:28:35.006 A:middle
该 notification 参数的值

00:28:35.996 --> 00:28:37.496 A:middle
如果在

00:28:37.496 --> 00:28:39.176 A:middle
系统设置中触发

00:28:39.176 --> 00:28:41.546 A:middle
则 notification 参数的值为空

00:28:41.546 --> 00:28:43.366 A:middle
你可以在这个委托方法

00:28:43.366 --> 00:28:44.466 A:middle
被调用时

00:28:44.466 --> 00:28:46.366 A:middle
显示合适的

00:28:46.366 --> 00:28:47.756 A:middle
通知设置

00:28:48.286 --> 00:28:52.066 A:middle
这些就是

00:28:52.066 --> 00:28:53.316 A:middle
通知管理部分的内容

00:28:53.726 --> 00:28:56.266 A:middle
对于用户来说

00:28:56.616 --> 00:28:57.726 A:middle
这是一个新的方式

00:28:57.726 --> 00:28:58.986 A:middle
可以设置重点发送或静音发送

00:28:59.306 --> 00:29:02.246 A:middle
关闭通知

00:28:59.306 --> 00:29:02.246 A:middle
关闭通知

00:29:02.246 --> 00:29:04.346 A:middle
甚至可以在 App 中

00:29:04.346 --> 00:29:09.293 A:middle
更细致地进行设置

00:29:09.616 --> 00:29:12.106 A:middle
为了鼓励用户

00:29:12.246 --> 00:29:15.616 A:middle
持续接收你的通知

00:29:15.616 --> 00:29:16.976 A:middle
我们认为很重要的一点是

00:29:16.976 --> 00:29:18.576 A:middle
你的通知

00:29:18.956 --> 00:29:19.406 A:middle
要切题

00:29:20.596 --> 00:29:23.276 A:middle
我们也鼓励大家

00:29:23.426 --> 00:29:24.826 A:middle
使用线程标识

00:29:24.826 --> 00:29:26.276 A:middle
在适当的时候

00:29:26.276 --> 00:29:26.986 A:middle
将通知分组

00:29:28.036 --> 00:29:29.046 A:middle
这可以帮助用户

00:29:29.156 --> 00:29:31.706 A:middle
更好地管理通知列表

00:29:32.136 --> 00:29:33.556 A:middle
也确保他们

00:29:33.556 --> 00:29:35.186 A:middle
看到你的 App 通知时

00:29:35.276 --> 00:29:36.526 A:middle
不会觉得无从下手

00:29:37.716 --> 00:29:40.406 A:middle
我们还认为

00:29:40.486 --> 00:29:41.786 A:middle
如果你的 App

00:29:41.786 --> 00:29:43.496 A:middle
会发送多个类型的通知

00:29:43.496 --> 00:29:44.996 A:middle
你最好能在 App 中

00:29:44.996 --> 00:29:47.706 A:middle
提供自定义设置视图

00:29:47.706 --> 00:29:48.986 A:middle
这样用户可以

00:29:48.986 --> 00:29:50.566 A:middle
更细致地管理

00:29:50.566 --> 00:29:52.686 A:middle
哪种通知对他们最重要

00:29:54.046 --> 00:29:55.036 A:middle
以上就是

00:29:55.036 --> 00:29:56.216 A:middle
通知管理

00:29:57.046 --> 00:29:59.226 A:middle
下面我想介绍的

00:29:59.226 --> 00:30:00.496 A:middle
一个比较大的功能

00:29:59.226 --> 00:30:00.496 A:middle
一个比较大的功能

00:30:00.496 --> 00:30:01.986 A:middle
就是临时授权

00:30:02.566 --> 00:30:08.736 A:middle
现在 如果一个用户安装了你的 App

00:30:08.736 --> 00:30:10.606 A:middle
在他开始接收通知前

00:30:10.656 --> 00:30:12.396 A:middle
必须回应

00:30:12.396 --> 00:30:13.586 A:middle
这样的一个提示

00:30:14.856 --> 00:30:15.686 A:middle
提示会询问用户

00:30:15.686 --> 00:30:16.906 A:middle
是否想接收通知

00:30:17.606 --> 00:30:19.366 A:middle
这最大的问题是

00:30:19.366 --> 00:30:21.596 A:middle
现在用户

00:30:22.146 --> 00:30:23.326 A:middle
无法判断

00:30:23.526 --> 00:30:25.126 A:middle
App 会发送哪种通知

00:30:25.186 --> 00:30:26.676 A:middle
所以他们也不知道

00:30:26.676 --> 00:30:27.876 A:middle
是否想要接收

00:30:29.026 --> 00:30:31.906 A:middle
在 iOS 12 中

00:30:32.106 --> 00:30:34.136 A:middle
我们新增了临时授权

00:30:34.136 --> 00:30:36.356 A:middle
你的 App 会自动

00:30:36.356 --> 00:30:38.346 A:middle
试发送通知

00:30:39.376 --> 00:30:41.126 A:middle
这可以帮助你的用户

00:30:41.126 --> 00:30:43.046 A:middle
更好地判断

00:30:43.046 --> 00:30:44.156 A:middle
他们是否需要

00:30:44.156 --> 00:30:45.336 A:middle
这些通知

00:30:46.046 --> 00:30:48.366 A:middle
你可以选择使用这个功能

00:30:48.366 --> 00:30:51.256 A:middle
使用后

00:30:51.256 --> 00:30:52.586 A:middle
你的用户就不会收到

00:30:52.586 --> 00:30:53.196 A:middle
我们刚才看到的授权提示了

00:30:53.816 --> 00:30:56.686 A:middle
相反 你的通知

00:30:56.686 --> 00:30:57.896 A:middle
会开始自动推送

00:30:58.546 --> 00:31:00.946 A:middle
但是这些通知

00:30:58.546 --> 00:31:00.946 A:middle
但是这些通知

00:31:00.946 --> 00:31:04.076 A:middle
都没有声音提示

00:31:04.076 --> 00:31:08.416 A:middle
并且 静音发送的通知

00:31:08.466 --> 00:31:10.496 A:middle
只会显示在 Notifications Center

00:31:10.606 --> 00:31:11.586 A:middle
这些通知是无声的

00:31:15.656 --> 00:31:17.796 A:middle
通过临时授权

00:31:17.976 --> 00:31:19.546 A:middle
发送的通知

00:31:19.916 --> 00:31:23.246 A:middle
都会带有这样的提示

00:31:23.846 --> 00:31:26.976 A:middle
在接收了几条通知后

00:31:27.966 --> 00:31:29.666 A:middle
可以帮助用户决定

00:31:29.666 --> 00:31:31.596 A:middle
是否要继续接收

00:31:31.596 --> 00:31:32.736 A:middle
这些通知

00:31:32.736 --> 00:31:35.236 A:middle
还是决定

00:31:35.236 --> 00:31:39.746 A:middle
关闭通知

00:31:40.926 --> 00:31:42.226 A:middle
在确认关闭的位置

00:31:42.226 --> 00:31:44.056 A:middle
如果你创建了

00:31:44.056 --> 00:31:46.076 A:middle
自定义设置

00:31:46.076 --> 00:31:47.346 A:middle
在这里它依然会出现

00:31:49.176 --> 00:31:50.956 A:middle
我们来看看

00:31:50.956 --> 00:31:51.246 A:middle
如何通过代码实现

00:31:52.426 --> 00:31:53.826 A:middle
在你通常

00:31:53.826 --> 00:31:55.746 A:middle
请求授权的位置

00:31:56.596 --> 00:32:00.226 A:middle
除了请求的 option

00:31:56.596 --> 00:32:00.226 A:middle
除了请求的 option

00:32:00.356 --> 00:32:04.366 A:middle
你还可以添加一个限定 option

00:32:04.366 --> 00:32:05.436 A:middle
.provisional

00:32:06.176 --> 00:32:09.806 A:middle
添加这个以后

00:32:10.036 --> 00:32:11.546 A:middle
你的 App

00:32:11.546 --> 00:32:13.246 A:middle
自动加入通知试发送

00:32:14.786 --> 00:32:16.126 A:middle
大家需要注意

00:32:16.356 --> 00:32:19.656 A:middle
除 .provisional option 外

00:32:19.656 --> 00:32:21.036 A:middle
你还需要有

00:32:21.036 --> 00:32:22.826 A:middle
其他的 option

00:32:23.626 --> 00:32:24.796 A:middle
这是因为如果用户

00:32:24.796 --> 00:32:25.856 A:middle
决定继续接收

00:32:25.856 --> 00:32:27.826 A:middle
你的通知

00:32:27.826 --> 00:32:28.896 A:middle
系统必须知道

00:32:28.896 --> 00:32:31.736 A:middle
你想如何发送

00:32:31.856 --> 00:32:32.536 A:middle
是否要角标 声音 还是作为提醒

00:32:33.186 --> 00:32:36.386 A:middle
这就是临时授权

00:32:36.526 --> 00:32:38.236 A:middle
它是自动的

00:32:38.236 --> 00:32:40.156 A:middle
通知试发送

00:32:40.156 --> 00:32:41.546 A:middle
可以帮助你的用户

00:32:41.546 --> 00:32:43.616 A:middle
更好地决定

00:32:43.616 --> 00:32:45.116 A:middle
是否要继续接收你的通知

00:32:46.466 --> 00:32:49.716 A:middle
同样 为了鼓励用户

00:32:49.716 --> 00:32:51.586 A:middle
继续接收

00:32:51.626 --> 00:32:53.266 A:middle
你的通知内容

00:32:53.266 --> 00:32:56.066 A:middle
一定要与你的 App 相关

00:32:57.226 --> 00:33:01.356 A:middle
并且要记住一点

00:32:57.226 --> 00:33:01.356 A:middle
并且要记住一点

00:33:01.406 --> 00:33:03.506 A:middle
使用 .provisional 作为预选项时

00:33:03.766 --> 00:33:05.206 A:middle
还需要有其他

00:33:05.206 --> 00:33:05.846 A:middle
你请求的 option

00:33:06.806 --> 00:33:07.836 A:middle
这就是临时授权

00:33:07.836 --> 00:33:09.426 A:middle
的全部内容

00:33:10.016 --> 00:33:14.816 A:middle
我想介绍的

00:33:14.816 --> 00:33:16.396 A:middle
最后一个大的功能

00:33:16.396 --> 00:33:17.456 A:middle
就是重要提醒

00:33:18.096 --> 00:33:23.906 A:middle
通常在我参加会议

00:33:23.906 --> 00:33:25.906 A:middle
或有重要的事情时

00:33:25.966 --> 00:33:26.086 A:middle
我的手机是这样的

00:33:26.506 --> 00:33:27.936 A:middle
大家可以看到

00:33:27.936 --> 00:33:29.026 A:middle
我开启了免打扰模式

00:33:29.736 --> 00:33:31.156 A:middle
或者 我至少会

00:33:31.156 --> 00:33:32.606 A:middle
关闭铃声

00:33:32.606 --> 00:33:34.476 A:middle
这样我接收通知时

00:33:34.836 --> 00:33:35.616 A:middle
就不会有声音提示

00:33:36.506 --> 00:33:38.326 A:middle
通常来说 这样很好

00:33:39.346 --> 00:33:42.836 A:middle
但是我可能会错过

00:33:42.836 --> 00:33:44.626 A:middle
非常重要的通知

00:33:44.626 --> 00:33:46.666 A:middle
就像这个 这是一条

00:33:46.666 --> 00:33:47.526 A:middle
与健康相关的通知

00:33:48.016 --> 00:33:49.326 A:middle
我的血糖仪提醒我

00:33:49.606 --> 00:33:51.336 A:middle
我的血糖过低

00:33:51.336 --> 00:33:53.456 A:middle
这样的通知

00:33:53.456 --> 00:33:54.746 A:middle
我会希望能及时看到

00:33:55.996 --> 00:33:58.156 A:middle
这样的场景

00:33:58.156 --> 00:34:00.396 A:middle
让我们意识到

00:33:58.156 --> 00:34:00.396 A:middle
让我们意识到

00:34:00.396 --> 00:34:02.556 A:middle
我们需要一类新的通知

00:34:02.556 --> 00:34:04.686 A:middle
我们将它称为重要提醒

00:34:05.596 --> 00:34:08.025 A:middle
重要提醒是

00:34:08.025 --> 00:34:09.626 A:middle
医药 健康

00:34:10.706 --> 00:34:12.176 A:middle
家庭 安全

00:34:12.176 --> 00:34:13.005 A:middle
或公共安全

00:34:14.286 --> 00:34:16.406 A:middle
相关的通知

00:34:16.766 --> 00:34:18.446 A:middle
重要提醒的关键

00:34:19.106 --> 00:34:21.616 A:middle
在于需要用户

00:34:21.616 --> 00:34:22.976 A:middle
马上做出回应

00:34:26.235 --> 00:34:27.716 A:middle
重要提醒

00:34:27.746 --> 00:34:30.065 A:middle
可以忽略

00:34:30.166 --> 00:34:31.516 A:middle
免打扰模式

00:34:31.516 --> 00:34:34.186 A:middle
和铃声静音

00:34:34.186 --> 00:34:35.936 A:middle
发出声音提示 你甚至可以

00:34:35.936 --> 00:34:36.315 A:middle
自己设置提示音

00:34:37.406 --> 00:34:38.616 A:middle
但是这也意味着

00:34:38.616 --> 00:34:40.896 A:middle
重要提醒会产生干扰

00:34:40.896 --> 00:34:42.795 A:middle
因为这一点

00:34:43.106 --> 00:34:44.806 A:middle
我们认为不能允许所有的 App

00:34:44.806 --> 00:34:47.996 A:middle
发送重要提醒

00:34:49.626 --> 00:34:51.266 A:middle
想要发送重要提醒

00:34:51.266 --> 00:34:53.096 A:middle
首先你需要

00:34:53.096 --> 00:34:55.436 A:middle
申请授权

00:34:55.436 --> 00:34:56.315 A:middle
你可以登录

00:34:56.315 --> 00:34:58.176 A:middle
developer.apple 的网站申请

00:34:59.776 --> 00:35:01.236 A:middle
重要提醒

00:34:59.776 --> 00:35:01.236 A:middle
重要提醒

00:35:01.236 --> 00:35:03.556 A:middle
是这个样子

00:35:03.556 --> 00:35:05.446 A:middle
有一个独特的图标

00:35:05.446 --> 00:35:06.156 A:middle
表示其重要性

00:35:06.706 --> 00:35:08.976 A:middle
接收重要提醒时 还会有声音提示

00:35:12.336 --> 00:35:14.126 A:middle
在通知设置中

00:35:14.196 --> 00:35:16.626 A:middle
重要提醒 可单独进行设置

00:35:17.996 --> 00:35:22.126 A:middle
这表示 用户可以允许某个 App

00:35:22.126 --> 00:35:24.456 A:middle
发送重要提醒

00:35:24.456 --> 00:35:26.276 A:middle
但是不允许接收该 App

00:35:26.276 --> 00:35:27.386 A:middle
其他类型的通知

00:35:27.926 --> 00:35:32.306 A:middle
接收重要提醒之前

00:35:32.306 --> 00:35:33.936 A:middle
用户需要

00:35:33.936 --> 00:35:35.866 A:middle
通过这样的

00:35:35.866 --> 00:35:37.416 A:middle
一个提示

00:35:37.416 --> 00:35:39.216 A:middle
询问他们

00:35:39.216 --> 00:35:41.046 A:middle
是否想要接收某个 App 的

00:35:41.046 --> 00:35:42.266 A:middle
重要提醒

00:35:43.576 --> 00:35:47.196 A:middle
所以 在发送重要提醒前

00:35:47.196 --> 00:35:48.576 A:middle
你当然需要获得授权

00:35:49.266 --> 00:35:50.536 A:middle
当你的

00:35:50.536 --> 00:35:53.166 A:middle
授权申请通过后

00:35:53.166 --> 00:35:54.356 A:middle
在你通常请求授权

00:35:54.356 --> 00:35:56.586 A:middle
请求授权的位置

00:35:56.586 --> 00:35:58.366 A:middle
除了其他

00:35:58.366 --> 00:36:00.916 A:middle
需要请求的 option

00:35:58.366 --> 00:36:00.916 A:middle
需要请求的 option

00:36:00.916 --> 00:36:02.146 A:middle
你还可以请求

00:36:02.146 --> 00:36:04.096 A:middle
.criticalAlert option

00:36:05.126 --> 00:36:07.696 A:middle
用户会先看到提示

00:36:13.046 --> 00:36:14.116 A:middle
下面我们看看

00:36:14.116 --> 00:36:15.646 A:middle
如何创建和发送重要提醒

00:36:15.646 --> 00:36:17.596 A:middle
其实重要提醒

00:36:17.596 --> 00:36:18.926 A:middle
和普通通知的

00:36:18.926 --> 00:36:19.696 A:middle
原理相近

00:36:20.376 --> 00:36:21.726 A:middle
可以看到

00:36:21.726 --> 00:36:23.476 A:middle
我创建了一个通知

00:36:23.476 --> 00:36:25.576 A:middle
带有标题 主体 和类型标识

00:36:25.576 --> 00:36:26.986 A:middle
但是最独特的一点是

00:36:26.986 --> 00:36:28.536 A:middle
重要提醒

00:36:28.536 --> 00:36:29.136 A:middle
有声音提示

00:36:29.596 --> 00:36:31.046 A:middle
所以我需要设置

00:36:31.046 --> 00:36:32.166 A:middle
重要提醒的提示音

00:36:32.806 --> 00:36:35.346 A:middle
大家可以看到

00:36:35.346 --> 00:36:37.286 A:middle
我设置的是

00:36:37.286 --> 00:36:38.926 A:middle
重要提醒的默认提示音

00:36:38.926 --> 00:36:39.456 A:middle
由框架提供

00:36:40.186 --> 00:36:43.756 A:middle
我还可以自定义提示音

00:36:44.716 --> 00:36:46.726 A:middle
还可以自定义

00:36:46.816 --> 00:36:48.006 A:middle
提示音量

00:36:48.996 --> 00:36:52.896 A:middle
当然

00:36:52.896 --> 00:36:54.926 A:middle
重要提醒也可以是推送通知

00:36:55.326 --> 00:36:57.356 A:middle
这样所有的这些信息

00:36:57.356 --> 00:36:59.826 A:middle
可以在 push payload 中进行创建

00:37:01.106 --> 00:37:02.746 A:middle
这就是重要提醒

00:37:03.356 --> 00:37:07.266 A:middle
它是新类型的通知

00:37:07.306 --> 00:37:09.796 A:middle
需要用户及时回应

00:37:10.376 --> 00:37:12.666 A:middle
重要提醒会产生干扰

00:37:12.666 --> 00:37:14.656 A:middle
所以你需要得到授权 才可以发送

00:37:18.496 --> 00:37:20.226 A:middle
这就是今天要给大家介绍的

00:37:20.226 --> 00:37:22.396 A:middle
所有新的接口

00:37:23.036 --> 00:37:24.486 A:middle
我来很快给大家总结一下

00:37:24.816 --> 00:37:25.996 A:middle
今天的主要内容

00:37:26.656 --> 00:37:30.656 A:middle
我们介绍了如何

00:37:30.756 --> 00:37:32.356 A:middle
使用线程标识对通知分组

00:37:32.356 --> 00:37:35.136 A:middle
对通知分组

00:37:35.136 --> 00:37:36.576 A:middle
以帮助用户

00:37:36.576 --> 00:37:38.706 A:middle
更好地管理通知列表

00:37:38.896 --> 00:37:40.206 A:middle
我们介绍了

00:37:40.206 --> 00:37:42.116 A:middle
通知内容扩展的

00:37:42.116 --> 00:37:44.046 A:middle
全新接口

00:37:44.046 --> 00:37:45.366 A:middle
可以让你的通知

00:37:45.366 --> 00:37:47.676 A:middle
变得更具交互性

00:37:48.256 --> 00:37:51.176 A:middle
我们还谈到

00:37:51.176 --> 00:37:52.796 A:middle
如何在你的 App 中

00:37:52.796 --> 00:37:54.746 A:middle
创建自定义设置视图

00:37:54.746 --> 00:37:57.256 A:middle
让用户可以更精细地

00:37:57.256 --> 00:37:59.626 A:middle
筛选想要保留

00:37:59.626 --> 00:38:02.926 A:middle
哪些通知

00:37:59.626 --> 00:38:02.926 A:middle
哪些通知

00:38:03.096 --> 00:38:04.496 A:middle
再然后是

00:38:04.496 --> 00:38:06.086 A:middle
临时授权

00:38:06.146 --> 00:38:07.306 A:middle
让你的 App

00:38:07.306 --> 00:38:08.876 A:middle
可以自动试发送通知

00:38:09.626 --> 00:38:10.806 A:middle
这样你的用户

00:38:10.806 --> 00:38:13.196 A:middle
可以更好地决定

00:38:13.196 --> 00:38:14.146 A:middle
是否要保留

00:38:14.146 --> 00:38:15.386 A:middle
你的通知

00:38:15.956 --> 00:38:18.416 A:middle
最后我们介绍了

00:38:18.456 --> 00:38:20.546 A:middle
重要提醒

00:38:20.546 --> 00:38:22.606 A:middle
这是新的一类通知

00:38:22.976 --> 00:38:24.566 A:middle
需要用户采取

00:38:24.566 --> 00:38:25.976 A:middle
及时回应

00:38:25.976 --> 00:38:26.686 A:middle
还会产生干扰

00:38:27.446 --> 00:38:29.236 A:middle
我们希望你们可以利用好

00:38:29.306 --> 00:38:31.506 A:middle
这些非常棒的接口

00:38:31.506 --> 00:38:33.236 A:middle
给你们的用户

00:38:33.236 --> 00:38:34.556 A:middle
带来更好的通知用户体验

00:38:35.556 --> 00:38:36.886 A:middle
有关本次会议的

00:38:36.886 --> 00:38:37.976 A:middle
所有信息

00:38:37.976 --> 00:38:39.206 A:middle
可以在会议页面看到

00:38:39.206 --> 00:38:40.776 A:middle
developer.apple.com

00:38:41.136 --> 00:38:42.726 A:middle
我们的会议号码是 710

00:38:43.406 --> 00:38:45.096 A:middle
接下来还有一次会议

00:38:45.096 --> 00:38:46.636 A:middle
在三号大厅举行

00:38:46.966 --> 00:38:48.136 A:middle
内容是如何使用

00:38:48.196 --> 00:38:50.096 A:middle
分组通知

00:38:50.096 --> 00:38:52.136 A:middle
我们会帮助大家决定

00:38:52.136 --> 00:38:54.346 A:middle
如何将你的通知分组最有效

00:38:54.736 --> 00:38:56.336 A:middle
我们有两个通知实验议程

00:38:56.686 --> 00:38:58.176 A:middle
一个在今天 一个在明天

00:38:58.426 --> 00:38:59.636 A:middle
你可以向我们团队的

00:38:59.636 --> 00:39:01.396 A:middle
工程师询问

00:38:59.636 --> 00:39:01.396 A:middle
工程师询问

00:39:01.396 --> 00:39:03.456 A:middle
任何相关问题

00:39:03.456 --> 00:39:05.416 A:middle
周五上午

00:39:05.416 --> 00:39:06.806 A:middle
我们还有一场非常有趣的会议

00:39:06.806 --> 00:39:08.166 A:middle
叫做如何设计通知

00:39:08.656 --> 00:39:11.726 A:middle
讲者是我们的设计师

00:39:11.726 --> 00:39:13.526 A:middle
他们帮助我们设计了所有的这些

00:39:13.566 --> 00:39:14.566 A:middle
到时候他们会介绍

00:39:14.916 --> 00:39:16.716 A:middle
通知的最佳使用方法

00:39:17.466 --> 00:39:18.976 A:middle
感谢大家 祝大家顺利

00:39:19.508 --> 00:39:21.508 A:middle
[ 掌声 ]
