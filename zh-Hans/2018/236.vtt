WEBVTT

00:00:06.516 --> 00:00:15.500 A:middle
[ 音乐 ]

00:00:18.286 --> 00:00:19.366 A:middle
&gt;&gt; 大家好 我的名字是 Chris

00:00:19.366 --> 00:00:20.976 A:middle
Fleizach 让我们谈谈如何

00:00:20.976 --> 00:00:22.846 A:middle
使用 AVSpeechSynthesis

00:00:22.846 --> 00:00:23.856 A:middle
让 iOS 说话

00:00:25.536 --> 00:00:26.646 A:middle
今天要讨论的问题有

00:00:26.826 --> 00:00:28.126 A:middle
什么是 AVSpeechSynthesis

00:00:28.126 --> 00:00:29.316 A:middle
以及我们为什么使用它

00:00:30.066 --> 00:00:31.876 A:middle
我们来谈谈一些基础知识

00:00:32.456 --> 00:00:33.416 A:middle
我们将讨论

00:00:33.416 --> 00:00:35.566 A:middle
如何选择正确的声音 以及一些属性

00:00:35.566 --> 00:00:38.416 A:middle
如速率 音调和音量

00:00:38.416 --> 00:00:39.376 A:middle
最后是属性字符串

00:00:41.256 --> 00:00:44.126 A:middle
AVSpeechSynthesis 是一个

00:00:44.126 --> 00:00:45.836 A:middle
可以在你的 iOS 设备上

00:00:45.836 --> 00:00:47.776 A:middle
生成计算机合成语音的 API

00:00:48.216 --> 00:00:49.156 A:middle
它有很多用途

00:00:49.866 --> 00:00:51.446 A:middle
例如 你可能希望

00:00:51.446 --> 00:00:52.786 A:middle
在你的 App 中发布公告

00:00:53.696 --> 00:00:54.566 A:middle
你可能正在创建

00:00:54.566 --> 00:00:56.826 A:middle
一个不可见的界面

00:00:57.466 --> 00:00:58.886 A:middle
或者你可能正在开发

00:00:58.886 --> 00:01:00.306 A:middle
一个教育 App

00:00:58.886 --> 00:01:00.306 A:middle
一个教育 App

00:01:00.306 --> 00:01:02.246 A:middle
合成语音可以为学习材料

00:01:02.246 --> 00:01:04.215 A:middle
起到很好的巩固作用

00:01:05.546 --> 00:01:07.236 A:middle
一个具体的例子 使用合成语音

00:01:07.236 --> 00:01:08.866 A:middle
在锻炼期间可以

00:01:08.866 --> 00:01:11.496 A:middle
有效地传达信息更新音频

00:01:12.846 --> 00:01:17.026 A:middle
关于综合和辅助功能的提示

00:01:17.666 --> 00:01:19.286 A:middle
语音合成是

00:01:19.286 --> 00:01:20.816 A:middle
一个能帮助各种残障人士的

00:01:20.816 --> 00:01:22.586 A:middle
强大工具

00:01:22.586 --> 00:01:23.956 A:middle
例如 有认知障碍的用户

00:01:23.956 --> 00:01:25.806 A:middle
体会到的信息输出

00:01:25.806 --> 00:01:28.046 A:middle
可以得到加强

00:01:28.556 --> 00:01:29.776 A:middle
有发声障碍的用户

00:01:29.776 --> 00:01:31.386 A:middle
可以使用语音合成

00:01:31.386 --> 00:01:33.336 A:middle
来帮他们说话

00:01:33.906 --> 00:01:36.206 A:middle
有视觉障碍的用户可以使用语音合成

00:01:36.206 --> 00:01:38.336 A:middle
来了解界面的内容

00:01:39.666 --> 00:01:41.076 A:middle
但需要注意的是

00:01:41.076 --> 00:01:42.376 A:middle
它不是“旁白”或

00:01:42.376 --> 00:01:44.736 A:middle
其他屏幕阅读技术的替代品

00:01:44.946 --> 00:01:46.656 A:middle
例如 合成语音可能

00:01:46.656 --> 00:01:48.576 A:middle
会与“旁白”重叠发声

00:01:49.446 --> 00:01:50.846 A:middle
并且大部分合成语音都

00:01:50.846 --> 00:01:52.626 A:middle
不可用于任何

00:01:52.626 --> 00:01:54.366 A:middle
连接的设备如盲文设备

00:01:55.886 --> 00:01:56.816 A:middle
相反 你应该通过使用

00:01:56.816 --> 00:01:58.026 A:middle
UIAccessibility API

00:01:58.026 --> 00:02:01.876 A:middle
让你的 App 易于使用

00:01:58.026 --> 00:02:01.876 A:middle
让你的 App 易于使用

00:02:02.076 --> 00:02:03.736 A:middle
好的 让我们来看看基础知识

00:02:04.066 --> 00:02:05.216 A:middle
第一步 创建一个

00:02:05.216 --> 00:02:06.426 A:middle
AVSpeechSynthesizer

00:02:06.816 --> 00:02:08.306 A:middle
你可以使用这个代码片段

00:02:08.735 --> 00:02:10.356 A:middle
有一点需要注意的是

00:02:10.356 --> 00:02:11.276 A:middle
你要确保它

00:02:11.276 --> 00:02:12.876 A:middle
在语音结束之前一直存在

00:02:13.486 --> 00:02:14.836 A:middle
如果合成器超出范围

00:02:14.836 --> 00:02:17.456 A:middle
则任何正在进行的合成将被取消

00:02:18.116 --> 00:02:20.296 A:middle
现在我们已经创建了

00:02:20.296 --> 00:02:21.606 A:middle
一个语音合成 接下来的工作就是

00:02:21.606 --> 00:02:22.576 A:middle
创建一个发声（utterance）

00:02:23.296 --> 00:02:25.236 A:middle
然后再把它分发到合成器中

00:02:26.416 --> 00:02:28.016 A:middle
所以 在这个例子中 我们用字符串 “Hello”

00:02:28.016 --> 00:02:28.926 A:middle
创建了一个发声

00:02:28.926 --> 00:02:30.816 A:middle
然后用 speak() 方法

00:02:31.406 --> 00:02:32.406 A:middle
把它分发出去

00:02:32.966 --> 00:02:36.486 A:middle
一个关于音频会话的提示

00:02:36.956 --> 00:02:39.416 A:middle
当 AVSpeechSynthesis

00:02:39.416 --> 00:02:41.496 A:middle
被 speak() 方法激活时

00:02:41.496 --> 00:02:43.546 A:middle
音频会话将自动设置为有效

00:02:44.526 --> 00:02:45.706 A:middle
如果你想与其他音频混合使用

00:02:45.706 --> 00:02:47.256 A:middle
可以在 AVAudioSession 中

00:02:47.256 --> 00:02:48.966 A:middle
使用 setCategory() 方法

00:02:48.966 --> 00:02:51.356 A:middle
并设置为 mixWithOthers

00:02:52.086 --> 00:02:53.266 A:middle
如果你想要回避其他音频

00:02:53.266 --> 00:02:55.816 A:middle
以便你的合成语音

00:02:55.936 --> 00:02:59.276 A:middle
成为主要内容 降低其他音频的音量

00:02:59.276 --> 00:03:01.086 A:middle
可以使用 duckOthers 选项

00:02:59.276 --> 00:03:01.086 A:middle
可以使用 duckOthers 选项

00:03:02.506 --> 00:03:04.436 A:middle
另外需要注意的是

00:03:04.436 --> 00:03:05.706 A:middle
音频会话在语音完成前

00:03:05.706 --> 00:03:07.436 A:middle
不会被设置为无效

00:03:07.926 --> 00:03:10.146 A:middle
这是因为它是一个共享会话

00:03:10.146 --> 00:03:13.436 A:middle
如果有其他音频同时播放

00:03:13.436 --> 00:03:15.336 A:middle
我们不会想让它停止

00:03:15.726 --> 00:03:17.576 A:middle
因此 如果你想将

00:03:17.576 --> 00:03:18.826 A:middle
音频会话设置为无效

00:03:18.826 --> 00:03:19.566 A:middle
你只能自己设置

00:03:20.766 --> 00:03:23.386 A:middle
在 AVSpeechSynthesis 中

00:03:23.386 --> 00:03:24.736 A:middle
有一些回调方法

00:03:24.736 --> 00:03:26.386 A:middle
可以帮助告知

00:03:26.386 --> 00:03:27.716 A:middle
发声的生命周期

00:03:28.566 --> 00:03:31.516 A:middle
这些是合成器委托协议中的可选方法

00:03:32.116 --> 00:03:33.656 A:middle
例如 你可以知道

00:03:33.656 --> 00:03:36.116 A:middle
语音何时开始 何时结束

00:03:36.606 --> 00:03:38.746 A:middle
甚至是说出的字符范围

00:03:39.406 --> 00:03:40.506 A:middle
你还可以知道语音何时

00:03:40.506 --> 00:03:41.686 A:middle
暂停或继续

00:03:43.146 --> 00:03:45.426 A:middle
我们以这个代码片段作为例子

00:03:45.426 --> 00:03:47.226 A:middle
你可以将你的

00:03:47.226 --> 00:03:49.036 A:middle
合成器委托设置到一个对象上

00:03:49.036 --> 00:03:50.586 A:middle
然后实现这些方法

00:03:50.586 --> 00:03:51.926 A:middle
例如 didStart

00:03:51.926 --> 00:03:53.506 A:middle
在这种情况下

00:03:53.506 --> 00:03:55.886 A:middle
会返回你的发声

00:03:55.886 --> 00:03:58.586 A:middle
didFinish 也会做

00:03:58.586 --> 00:03:59.976 A:middle
同样的事情

00:03:59.976 --> 00:04:01.736 A:middle
而 willSpeakRangeOfSpeechString

00:03:59.976 --> 00:04:01.736 A:middle
而 willSpeakRangeOfSpeechString

00:04:02.166 --> 00:04:03.186 A:middle
则会返回一个 NSRange

00:04:03.226 --> 00:04:04.636 A:middle
然后你可以

00:04:04.636 --> 00:04:06.966 A:middle
把它转换成一个字符串范围

00:04:06.966 --> 00:04:08.306 A:middle
并借助它打印输出到控制台

00:04:09.486 --> 00:04:12.606 A:middle
现在我们来做一个小演示

00:04:15.166 --> 00:04:17.046 A:middle
&gt;&gt; 你好 我的朋友们

00:04:17.426 --> 00:04:19.346 A:middle
我在 iPhone 里面

00:04:19.836 --> 00:04:24.116 A:middle
&gt;&gt; 很好 这些就是

00:04:24.116 --> 00:04:25.316 A:middle
AVSpeechSynthesis 的基础

00:04:25.596 --> 00:04:27.286 A:middle
如你所见

00:04:27.286 --> 00:04:28.386 A:middle
这非常简单

00:04:29.246 --> 00:04:30.766 A:middle
下一个话题是你如何

00:04:30.766 --> 00:04:31.746 A:middle
选择正确的声音

00:04:31.986 --> 00:04:33.236 A:middle
系统内置了许多种声音

00:04:33.236 --> 00:04:34.716 A:middle
每种支持的语言都有一个声音

00:04:36.096 --> 00:04:37.516 A:middle
需要注意的是这个 API

00:04:37.516 --> 00:04:39.446 A:middle
无法使用 Siri 的声音

00:04:40.726 --> 00:04:42.356 A:middle
但是 用户可以下载

00:04:42.356 --> 00:04:43.766 A:middle
更高质量的声音

00:04:43.766 --> 00:04:44.716 A:middle
当这些声音被下载时

00:04:44.716 --> 00:04:46.856 A:middle
它们将出现在声音列表中

00:04:48.466 --> 00:04:50.846 A:middle
你既可以通过标识符

00:04:50.956 --> 00:04:52.706 A:middle
也可以通过语言来选择声音

00:04:53.246 --> 00:04:54.386 A:middle
如果你通过语言选择声音

00:04:54.386 --> 00:04:55.486 A:middle
则会选择

00:04:55.486 --> 00:04:56.606 A:middle
用户的默认声音

00:04:57.776 --> 00:04:58.736 A:middle
我们该怎么做呢

00:04:59.166 --> 00:05:00.356 A:middle
首先声明一个发声

00:04:59.166 --> 00:05:00.356 A:middle
首先声明一个发声

00:05:00.356 --> 00:05:01.406 A:middle
然后使用

00:05:01.406 --> 00:05:02.506 A:middle
AVSpeechSynthesisVoice

00:05:02.506 --> 00:05:03.886 A:middle
设置声音属性

00:05:04.236 --> 00:05:07.286 A:middle
如果想用

00:05:07.286 --> 00:05:09.296 A:middle
标识符初始化器

00:05:09.296 --> 00:05:10.896 A:middle
你可以获得所有的语音声音

00:05:11.536 --> 00:05:13.266 A:middle
这其实是一个语音声音对象数组

00:05:13.266 --> 00:05:15.116 A:middle
然后 比如

00:05:15.116 --> 00:05:16.546 A:middle
选择第一个声音对象

00:05:16.546 --> 00:05:17.626 A:middle
然后传入

00:05:17.626 --> 00:05:18.126 A:middle
标识符属性

00:05:18.986 --> 00:05:22.136 A:middle
以下是一些

00:05:22.256 --> 00:05:24.586 A:middle
iOS 默认支持的一些语言

00:05:26.816 --> 00:05:30.026 A:middle
现在让我们来谈谈

00:05:30.026 --> 00:05:31.096 A:middle
你可以在 AVSpeechSynthesizer 上

00:05:31.096 --> 00:05:32.116 A:middle
用到的一些属性

00:05:32.686 --> 00:05:34.096 A:middle
使用速率属性

00:05:34.526 --> 00:05:36.336 A:middle
可以控制语音速率

00:05:36.336 --> 00:05:37.406 A:middle
范围是 0 到 1

00:05:38.226 --> 00:05:40.856 A:middle
这能让语音

00:05:40.856 --> 00:05:42.496 A:middle
变慢或者变快

00:05:43.166 --> 00:05:44.626 A:middle
在 [0,.5] 这个区间内

00:05:44.626 --> 00:05:47.686 A:middle
语音速率会从 0 倍速增长到 1 倍速

00:05:48.326 --> 00:05:50.206 A:middle
这意味着如果你传入 “.5” 这个值

00:05:50.516 --> 00:05:51.776 A:middle
你会得到默认的

00:05:51.776 --> 00:05:52.396 A:middle
正常语音速率

00:05:53.736 --> 00:05:55.606 A:middle
如果你想加快速度

00:05:55.606 --> 00:05:58.066 A:middle
你可以将把数值设为 .5 到 1 之间的值

00:05:58.066 --> 00:05:59.806 A:middle
这样可以将语音

00:05:59.806 --> 00:06:01.296 A:middle
从正常的 1 倍语速

00:05:59.806 --> 00:06:01.296 A:middle
从正常的 1 倍语速

00:06:01.296 --> 00:06:02.216 A:middle
加速到最高 4 倍

00:06:03.096 --> 00:06:04.666 A:middle
为此 你可以创建一个

00:06:04.666 --> 00:06:05.926 A:middle
语音发声 然后将

00:06:05.926 --> 00:06:09.056 A:middle
速率设置为浮点值

00:06:09.056 --> 00:06:10.366 A:middle
或者可以使用一些常量

00:06:10.666 --> 00:06:13.526 A:middle
来把速率设置为默认速率 最高速率 或最低速率

00:06:14.006 --> 00:06:16.836 A:middle
我们来谈谈音高和音量

00:06:17.396 --> 00:06:18.316 A:middle
这些也是

00:06:18.316 --> 00:06:19.446 A:middle
你可以在语音发声中设置的属性

00:06:19.926 --> 00:06:23.076 A:middle
音高控制声音的高低

00:06:23.166 --> 00:06:25.986 A:middle
音量控制语音本身的音量

00:06:27.166 --> 00:06:28.496 A:middle
因此 例如 我们可以

00:06:28.496 --> 00:06:30.146 A:middle
将音高设置得非常高

00:06:30.666 --> 00:06:31.786 A:middle
这时把值设为“1”

00:06:32.396 --> 00:06:33.706 A:middle
将音量设置得较低

00:06:33.706 --> 00:06:35.286 A:middle
这时把值设为“.25”

00:06:35.986 --> 00:06:37.116 A:middle
请注意 降低语音音量

00:06:37.116 --> 00:06:38.996 A:middle
不会影响系统音量

00:06:41.016 --> 00:06:43.466 A:middle
最后 我们来讨论

00:06:43.466 --> 00:06:44.616 A:middle
属性字符串

00:06:45.666 --> 00:06:46.936 A:middle
属性字符串允许我们

00:06:46.936 --> 00:06:48.716 A:middle
使用不用的属性

00:06:48.816 --> 00:06:49.866 A:middle
来自定义语音声音

00:06:50.446 --> 00:06:52.136 A:middle
我想讨论的一个可用属性

00:06:52.136 --> 00:06:53.896 A:middle
是 IPA 符号

00:06:54.296 --> 00:06:58.256 A:middle
IPA 代表 International Phonetic

00:06:58.256 --> 00:07:00.796 A:middle
Alphabet（国际音标） 它我们能够自定义

00:06:58.256 --> 00:07:00.796 A:middle
Alphabet（国际音标） 它我们能够自定义

00:07:00.796 --> 00:07:03.266 A:middle
某些特有名称 名词等是如何发音的

00:07:04.966 --> 00:07:06.766 A:middle
它在这些语言中都可用

00:07:09.516 --> 00:07:10.886 A:middle
这是一个例子

00:07:10.886 --> 00:07:11.566 A:middle
可以大概展示一下它的样子

00:07:11.766 --> 00:07:15.286 A:middle
要按我们习惯的方式来说 iPhone

00:07:15.286 --> 00:07:16.836 A:middle
你要使用此 IPA 符号

00:07:18.176 --> 00:07:19.756 A:middle
现在的问题是

00:07:19.756 --> 00:07:21.406 A:middle
如何生成这个 IPA 符号呢

00:07:21.406 --> 00:07:23.346 A:middle
用键盘输入并不容易

00:07:24.076 --> 00:07:26.306 A:middle
一种方法是

00:07:26.446 --> 00:07:28.126 A:middle
使用辅助功能中的

00:07:28.126 --> 00:07:29.306 A:middle
发音编辑器

00:07:29.816 --> 00:07:30.886 A:middle
当你前往“设置”-“通用”

00:07:30.886 --> 00:07:33.046 A:middle
“辅助功能”-“语音”

00:07:33.046 --> 00:07:33.836 A:middle
你会发现

00:07:33.836 --> 00:07:36.056 A:middle
“发音”并找到这样的界面

00:07:36.746 --> 00:07:37.946 A:middle
你可以输入

00:07:37.946 --> 00:07:41.066 A:middle
你想纠正发音的短语

00:07:41.066 --> 00:07:42.666 A:middle
轻点麦克风按钮

00:07:42.666 --> 00:07:43.136 A:middle
然后读出来

00:07:44.246 --> 00:07:45.796 A:middle
完成之后 你将

00:07:45.796 --> 00:07:47.516 A:middle
看到可能的几个

00:07:47.516 --> 00:07:48.686 A:middle
变体选项

00:07:48.686 --> 00:07:50.346 A:middle
当你点击它们时

00:07:50.346 --> 00:07:51.036 A:middle
它会大声朗读出来

00:07:51.316 --> 00:07:53.656 A:middle
你可以选择听起来正确的那个 然后

00:07:53.656 --> 00:07:55.876 A:middle
将你获得的这个值复制到

00:07:55.876 --> 00:07:56.366 A:middle
你的代码中

00:07:57.006 --> 00:07:58.136 A:middle
那么让我们看看这是如何做到的

00:07:58.636 --> 00:08:00.966 A:middle
首先 我们创建一个属性字符串

00:07:58.636 --> 00:08:00.966 A:middle
首先 我们创建一个属性字符串

00:08:00.966 --> 00:08:03.836 A:middle
然后我们可以

00:08:03.836 --> 00:08:05.026 A:middle
用我们从“设置”中获得的值

00:08:05.026 --> 00:08:07.236 A:middle
为 accessibilitySpeechIPANotation

00:08:07.236 --> 00:08:09.256 A:middle
添加属性

00:08:10.996 --> 00:08:12.686 A:middle
最后 我们可以用

00:08:12.686 --> 00:08:17.116 A:middle
属性字符串创建一个语音发声

00:08:17.246 --> 00:08:20.116 A:middle
总而言之 AVSpeechSynthesis

00:08:20.116 --> 00:08:23.336 A:middle
是增强你 App 体验的好方法

00:08:23.336 --> 00:08:24.266 A:middle
前提是你要在合适的时间添加语音

00:08:24.766 --> 00:08:26.476 A:middle
有多种语言和声音可用

00:08:26.476 --> 00:08:29.126 A:middle
并且可以自定义

00:08:29.936 --> 00:08:31.336 A:middle
最后 你还可以使用 IPA

00:08:31.336 --> 00:08:33.056 A:middle
符号属性

00:08:33.056 --> 00:08:35.106 A:middle
来为单词自定义发音

00:08:38.356 --> 00:08:40.226 A:middle
若要获取更多信息

00:08:40.226 --> 00:08:43.366 A:middle
请访问本章节的网址（URL） 感谢观看
