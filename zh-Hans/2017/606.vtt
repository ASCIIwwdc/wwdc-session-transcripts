WEBVTT

00:00:23.066 --> 00:00:23.696 A:middle
&gt;&gt; 早上好  [ 鼓掌 ]

00:00:25.036 --> 00:00:27.876 A:middle
谢谢 欢迎来到

00:00:27.876 --> 00:00:29.496 A:middle
屏幕录制和直播

00:00:29.496 --> 00:00:30.046 A:middle
介绍会

00:00:30.576 --> 00:00:32.336 A:middle
我叫 Johnny Trenh

00:00:32.336 --> 00:00:33.506 A:middle
是苹果 ReplayKit 团队的

00:00:33.676 --> 00:00:34.796 A:middle
软件工程师

00:00:35.966 --> 00:00:37.926 A:middle
今天 我的同事

00:00:37.996 --> 00:00:39.776 A:middle
Alexander Subbotin 和我

00:00:39.776 --> 00:00:41.646 A:middle
非常高兴能和各位讲一讲

00:00:41.646 --> 00:00:42.826 A:middle
今年我们为

00:00:42.826 --> 00:00:44.276 A:middle
ReplayKit 设计的新功能

00:00:45.666 --> 00:00:46.866 A:middle
有很多要说的

00:00:46.866 --> 00:00:47.956 A:middle
所以我们直接开始吧

00:00:50.616 --> 00:00:52.896 A:middle
ReplayKit 是一个框架

00:00:52.896 --> 00:00:54.686 A:middle
让开发者可以

00:00:54.686 --> 00:00:57.476 A:middle
把音频 视频

00:00:57.786 --> 00:00:59.756 A:middle
和麦克风内容

00:00:59.756 --> 00:01:01.546 A:middle
录制成电影文件

00:00:59.756 --> 00:01:01.546 A:middle
录制成电影文件

00:01:01.546 --> 00:01:04.706 A:middle
使得用户可以查看 编辑

00:01:04.706 --> 00:01:05.566 A:middle
保存或者分享

00:01:05.566 --> 00:01:05.836 A:middle
给其他人

00:01:08.286 --> 00:01:10.326 A:middle
ReplayKit 同样也支持

00:01:10.326 --> 00:01:10.966 A:middle
直播

00:01:11.546 --> 00:01:12.956 A:middle
对于 App 生成的内容

00:01:12.956 --> 00:01:15.446 A:middle
ReplayKit 提供

00:01:15.446 --> 00:01:17.476 A:middle
所有必要的工具

00:01:17.476 --> 00:01:19.346 A:middle
来把 App 的音频

00:01:19.346 --> 00:01:21.996 A:middle
视频和麦克风内容

00:01:21.996 --> 00:01:23.046 A:middle
流式传输到直播扩展

00:01:24.456 --> 00:01:25.846 A:middle
对于执行了直播扩展

00:01:25.846 --> 00:01:28.416 A:middle
的 App 来说

00:01:28.416 --> 00:01:30.136 A:middle
ReplayKit 有

00:01:30.136 --> 00:01:31.986 A:middle
简单的 Xcode 模板

00:01:31.986 --> 00:01:33.746 A:middle
来帮助你的 App

00:01:33.836 --> 00:01:37.576 A:middle
流式传输 ReplayKit 内容

00:01:37.666 --> 00:01:39.856 A:middle
ReplayKit 可以录制高清的

00:01:39.856 --> 00:01:42.016 A:middle
音频和视频

00:01:42.016 --> 00:01:43.886 A:middle
而且需要较小的性能损耗

00:01:43.926 --> 00:01:45.116 A:middle
和电量损耗

00:01:46.126 --> 00:01:47.826 A:middle
隐私对我们来说很重要

00:01:47.826 --> 00:01:50.396 A:middle
所以无论是录制

00:01:50.396 --> 00:01:51.946 A:middle
还是直播

00:01:52.026 --> 00:01:54.056 A:middle
都有隐私保护措施

00:01:54.056 --> 00:01:55.806 A:middle
例如用户许可

00:01:55.806 --> 00:01:57.676 A:middle
而且所有录制文件和样本

00:01:57.676 --> 00:01:58.646 A:middle
都有专属系统 UI

00:02:01.286 --> 00:02:02.956 A:middle
自从 ReplayKit 发布

00:02:02.956 --> 00:02:04.486 A:middle
我们从全世界的

00:02:04.486 --> 00:02:06.026 A:middle
开发者那里 看到很多

00:02:06.026 --> 00:02:06.926 A:middle
很棒的应用

00:02:07.836 --> 00:02:09.395 A:middle
一些 App 比如 Galaxy on Fire

00:02:09.395 --> 00:02:11.886 A:middle
Vainglory Call of Champions

00:02:11.886 --> 00:02:14.186 A:middle
和 Modern Combat 5

00:02:14.496 --> 00:02:16.716 A:middle
都使用 ReplayKit

00:02:16.716 --> 00:02:18.466 A:middle
录制和

00:02:18.466 --> 00:02:20.296 A:middle
向世界各地直播

00:02:20.296 --> 00:02:20.716 A:middle
其用户的体验

00:02:23.606 --> 00:02:25.356 A:middle
去年我们介绍了

00:02:25.356 --> 00:02:26.586 A:middle
ReplayKit 直播

00:02:26.766 --> 00:02:28.356 A:middle
而我可以很骄傲地说

00:02:28.356 --> 00:02:30.116 A:middle
现在移动流媒体中的

00:02:30.116 --> 00:02:31.786 A:middle
很多领军企业

00:02:31.786 --> 00:02:32.166 A:middle
都在使用 ReplayKit

00:02:33.796 --> 00:02:36.496 A:middle
我们的支持率 采用率

00:02:36.536 --> 00:02:37.556 A:middle
和从开发者那里得到的反馈

00:02:37.556 --> 00:02:39.056 A:middle
都很棒

00:02:39.866 --> 00:02:41.036 A:middle
所以今年

00:02:41.166 --> 00:02:42.376 A:middle
我们很高兴能给你们介绍

00:02:43.886 --> 00:02:44.676 A:middle
ReplayKit 2

00:02:45.816 --> 00:02:47.956 A:middle
我们对 ReplayKit 2 的目标是

00:02:47.956 --> 00:02:49.906 A:middle
所有用户和 App 都可以

00:02:50.126 --> 00:02:51.516 A:middle
使用 ReplayKit

00:02:52.616 --> 00:02:54.306 A:middle
我们设计了新的功能

00:02:54.336 --> 00:02:55.976 A:middle
让 ReplayKit 不局限于

00:02:55.976 --> 00:02:58.466 A:middle
游戏领域 让所有的开发者

00:02:58.546 --> 00:03:00.866 A:middle
都可以录制

00:02:58.546 --> 00:03:00.866 A:middle
都可以录制

00:03:00.866 --> 00:03:02.576 A:middle
并向世界各地直播

00:03:02.576 --> 00:03:02.956 A:middle
他们用户的体验

00:03:03.476 --> 00:03:05.946 A:middle
为了做到这一点

00:03:05.946 --> 00:03:08.486 A:middle
首先 我要介绍

00:03:08.486 --> 00:03:09.196 A:middle
App 内屏幕捕捉

00:03:10.506 --> 00:03:12.006 A:middle
我们已经见识过

00:03:12.006 --> 00:03:13.826 A:middle
用户用 ReplayKit 做出的

00:03:13.826 --> 00:03:15.086 A:middle
非常好的内容

00:03:16.326 --> 00:03:17.666 A:middle
在 ReplayKit 2 里

00:03:17.666 --> 00:03:19.636 A:middle
我们加入了 App 内屏幕捕捉

00:03:19.636 --> 00:03:21.506 A:middle
这个强大的新 API

00:03:21.506 --> 00:03:23.586 A:middle
让你可以

00:03:23.826 --> 00:03:25.426 A:middle
直接通过 ReplayKit

00:03:25.426 --> 00:03:28.316 A:middle
访问 App 自己的

00:03:28.436 --> 00:03:30.196 A:middle
音频 视频

00:03:30.196 --> 00:03:30.906 A:middle
和麦克风内容

00:03:31.416 --> 00:03:35.636 A:middle
我们对 ReplayKit 2 的目标是

00:03:35.636 --> 00:03:36.976 A:middle
让 ReplayKit 可以在所有 App 中

00:03:36.976 --> 00:03:37.626 A:middle
使用

00:03:38.506 --> 00:03:40.026 A:middle
所以我们让

00:03:40.026 --> 00:03:42.086 A:middle
ReplayKit 现在适用于

00:03:42.086 --> 00:03:43.826 A:middle
iOS 的所有 App

00:03:44.736 --> 00:03:47.096 A:middle
以前 为了使用 ReplayKit

00:03:47.096 --> 00:03:48.746 A:middle
或者使用一个用

00:03:48.746 --> 00:03:50.646 A:middle
ReplayKit 的 App 你必须要用

00:03:50.646 --> 00:03:50.926 A:middle
我们的 API

00:03:51.566 --> 00:03:54.936 A:middle
但是现在 用户可以

00:03:54.936 --> 00:03:57.376 A:middle
直接通过控制中心里的

00:03:57.376 --> 00:03:59.326 A:middle
屏幕录制按钮

00:03:59.326 --> 00:04:00.736 A:middle
录制并播出他们

00:03:59.326 --> 00:04:00.736 A:middle
录制并播出他们

00:04:00.906 --> 00:04:03.856 A:middle
整体 iOS 的屏幕体验

00:04:04.026 --> 00:04:06.006 A:middle
ReplayKit 2 还有一个创新

00:04:06.006 --> 00:04:08.186 A:middle
就是可以把 App 和

00:04:08.366 --> 00:04:09.876 A:middle
一个特定的流媒体服务

00:04:09.876 --> 00:04:10.376 A:middle
配对

00:04:11.696 --> 00:04:14.636 A:middle
开发者可以

00:04:14.636 --> 00:04:16.296 A:middle
从 App 内部

00:04:16.296 --> 00:04:17.896 A:middle
完美地集合

00:04:17.896 --> 00:04:18.625 A:middle
整个流媒体解决方案

00:04:20.676 --> 00:04:22.826 A:middle
去年 我们提供了

00:04:22.826 --> 00:04:24.116 A:middle
ReplayKit 的前摄像头支持

00:04:24.896 --> 00:04:26.906 A:middle
今年 在 ReplayKit 2 里

00:04:26.906 --> 00:04:28.306 A:middle
我们加入了快速镜头切换

00:04:28.306 --> 00:04:29.826 A:middle
这样你就可以通过

00:04:29.826 --> 00:04:31.516 A:middle
前摄像头和

00:04:31.786 --> 00:04:33.486 A:middle
后摄像头来添加

00:04:33.486 --> 00:04:33.976 A:middle
视频评论

00:04:36.456 --> 00:04:37.906 A:middle
有很多新的东西

00:04:37.906 --> 00:04:39.056 A:middle
要介绍

00:04:39.056 --> 00:04:40.126 A:middle
所以让我们

00:04:40.126 --> 00:04:42.526 A:middle
直接开始说

00:04:42.526 --> 00:04:43.206 A:middle
App 内屏幕捕捉

00:04:44.616 --> 00:04:46.036 A:middle
App 内屏幕捕捉

00:04:46.126 --> 00:04:48.226 A:middle
是个强大的新 API

00:04:48.226 --> 00:04:50.496 A:middle
让你可以直接通过

00:04:50.536 --> 00:04:53.236 A:middle
ReplayKit 访问

00:04:53.556 --> 00:04:55.156 A:middle
App 自己的音频视频

00:04:55.156 --> 00:04:55.846 A:middle
和麦克风内容

00:04:56.926 --> 00:04:58.786 A:middle
这个新 API 可以让

00:04:58.786 --> 00:05:00.496 A:middle
用户得到全新的体验

00:04:58.786 --> 00:05:00.496 A:middle
用户得到全新的体验

00:05:00.496 --> 00:05:01.906 A:middle
这在以前

00:05:01.906 --> 00:05:02.276 A:middle
是做不到的

00:05:03.256 --> 00:05:05.086 A:middle
在介绍 App 内屏幕捕捉之前

00:05:05.086 --> 00:05:06.346 A:middle
让我们

00:05:06.346 --> 00:05:07.316 A:middle
先来看一下

00:05:08.006 --> 00:05:09.756 A:middle
现在 App 是如何用

00:05:09.756 --> 00:05:11.096 A:middle
ReplayKit 录像的

00:05:14.056 --> 00:05:15.236 A:middle
当前情况下

00:05:15.236 --> 00:05:17.326 A:middle
使用 ReplayKit 的 App

00:05:17.326 --> 00:05:18.526 A:middle
会调入 RPScreenRecorder

00:05:18.526 --> 00:05:19.886 A:middle
打开屏幕录制单例

00:05:20.536 --> 00:05:22.886 A:middle
然后在屏幕录制单例

00:05:22.886 --> 00:05:24.686 A:middle
选择开始录制

00:05:24.686 --> 00:05:26.696 A:middle
这个时候

00:05:26.696 --> 00:05:27.916 A:middle
回放 Daemon 程序会开始

00:05:27.916 --> 00:05:29.436 A:middle
捕捉 App 的

00:05:29.436 --> 00:05:31.586 A:middle
音频视频和麦克风内容

00:05:31.586 --> 00:05:33.886 A:middle
为这个 App 专门

00:05:33.886 --> 00:05:35.106 A:middle
创建并管理

00:05:35.106 --> 00:05:35.656 A:middle
一个电影文件

00:05:37.436 --> 00:05:39.156 A:middle
当你在屏幕录制单例

00:05:39.156 --> 00:05:40.356 A:middle
点击停止录制

00:05:40.766 --> 00:05:42.176 A:middle
回放 Daemon 程序会和

00:05:42.176 --> 00:05:43.476 A:middle
分享和预览扩展沟通

00:05:43.476 --> 00:05:45.776 A:middle
并实例化

00:05:45.776 --> 00:05:47.126 A:middle
RPPreviewViewController

00:05:47.976 --> 00:05:48.666 A:middle
我们会将

00:05:48.666 --> 00:05:50.296 A:middle
RPPreviewViewController

00:05:50.296 --> 00:05:51.626 A:middle
传回给你的 App

00:05:51.626 --> 00:05:52.886 A:middle
然后你才能展示给你的用户

00:05:53.326 --> 00:05:55.706 A:middle
让他们查看 编辑

00:05:55.776 --> 00:05:57.116 A:middle
保存和分享

00:05:57.116 --> 00:05:58.236 A:middle
他们刚刚在你的 App 里

00:05:58.236 --> 00:05:58.806 A:middle
录制的样本

00:06:01.616 --> 00:06:02.716 A:middle
使用新的 App 内屏幕捕捉功能

00:06:02.716 --> 00:06:04.186 A:middle
当你在录制时

00:06:04.186 --> 00:06:06.036 A:middle
首先会调入

00:06:06.036 --> 00:06:07.266 A:middle
RPScreenRecorder

00:06:07.266 --> 00:06:08.536 A:middle
打开屏幕录制单例

00:06:09.276 --> 00:06:11.036 A:middle
然后

00:06:11.036 --> 00:06:12.236 A:middle
在屏幕录制单例

00:06:12.236 --> 00:06:13.746 A:middle
点击开始捕捉

00:06:13.746 --> 00:06:15.186 A:middle
这时回放 Daemon 程序会

00:06:15.186 --> 00:06:16.706 A:middle
开始捕捉 App 的

00:06:16.706 --> 00:06:19.096 A:middle
音频视频和麦克风

00:06:19.096 --> 00:06:19.526 A:middle
内容

00:06:20.076 --> 00:06:22.136 A:middle
替代了原来专门

00:06:22.136 --> 00:06:23.716 A:middle
给你的 App 所创建和管理的

00:06:23.716 --> 00:06:25.866 A:middle
一个电影文件

00:06:25.866 --> 00:06:27.366 A:middle
ReplayKit 现在会把这些

00:06:27.366 --> 00:06:28.896 A:middle
音视频样本 直接发回给

00:06:28.896 --> 00:06:29.736 A:middle
RPScreenRecorder

00:06:30.346 --> 00:06:33.826 A:middle
这时会调入一个捕捉处理器 Block

00:06:33.826 --> 00:06:35.406 A:middle
我们会把音频和视频文件

00:06:35.406 --> 00:06:37.116 A:middle
直接发送给

00:06:37.116 --> 00:06:38.446 A:middle
你的 App 进程

00:06:39.706 --> 00:06:41.926 A:middle
App 可以直接通过 ReplayKit

00:06:41.926 --> 00:06:44.786 A:middle
访问自己的

00:06:44.936 --> 00:06:46.556 A:middle
音频视频和

00:06:46.556 --> 00:06:47.256 A:middle
麦克风样本

00:06:49.376 --> 00:06:51.366 A:middle
直接从 ReplayKit

00:06:51.366 --> 00:06:52.936 A:middle
访问 App 的

00:06:52.936 --> 00:06:54.346 A:middle
音视频文件

00:06:54.346 --> 00:06:55.456 A:middle
可以让你

00:06:55.456 --> 00:06:58.096 A:middle
更灵活也更好地掌控

00:06:58.096 --> 00:07:00.126 A:middle
用户创建的

00:06:58.096 --> 00:07:00.126 A:middle
用户创建的

00:07:00.126 --> 00:07:00.546 A:middle
内容

00:07:01.806 --> 00:07:03.636 A:middle
和录制一样

00:07:03.636 --> 00:07:05.216 A:middle
App 内屏幕捕捉

00:07:05.576 --> 00:07:08.226 A:middle
可以以较小的性能损耗

00:07:08.226 --> 00:07:10.166 A:middle
和电量损耗

00:07:10.166 --> 00:07:11.206 A:middle
捕捉到高清的音视频

00:07:12.296 --> 00:07:14.186 A:middle
再重申一次

00:07:14.186 --> 00:07:16.166 A:middle
我们很重视隐私

00:07:16.166 --> 00:07:17.386 A:middle
所以 App 内屏幕捕捉

00:07:17.386 --> 00:07:19.466 A:middle
有隐私保护措施

00:07:19.466 --> 00:07:21.736 A:middle
例如用户许可

00:07:21.736 --> 00:07:22.816 A:middle
和样本专用的系统 UI

00:07:24.656 --> 00:07:26.696 A:middle
这个 API 很简单

00:07:26.696 --> 00:07:27.096 A:middle
也很小

00:07:27.216 --> 00:07:28.316 A:middle
那我们现在来

00:07:28.316 --> 00:07:30.606 A:middle
快速看一下

00:07:30.876 --> 00:07:32.766 A:middle
StartCapture 有两个 Blocks

00:07:32.766 --> 00:07:34.786 A:middle
captureHandlerBlock

00:07:35.026 --> 00:07:36.476 A:middle
和 completionHandlerBlock

00:07:37.866 --> 00:07:39.246 A:middle
每次 ReplayKit

00:07:39.246 --> 00:07:41.196 A:middle
准备把样本送还给 App 时

00:07:41.196 --> 00:07:42.566 A:middle
captureHandlerBlock

00:07:42.566 --> 00:07:43.506 A:middle
都会被调用

00:07:44.386 --> 00:07:45.236 A:middle
我们为你提供

00:07:45.236 --> 00:07:46.926 A:middle
一个 CMSampleBuffer 参考

00:07:46.926 --> 00:07:49.356 A:middle
一个 RPSampleBufferType

00:07:49.356 --> 00:07:49.596 A:middle
和一个 NS Error

00:07:50.696 --> 00:07:52.166 A:middle
当 startCapture 完成时

00:07:52.166 --> 00:07:53.936 A:middle
completionHandlerBlock 被调用

00:07:53.936 --> 00:07:55.846 A:middle
并提供

00:07:55.846 --> 00:07:57.306 A:middle
NS Error 指示

00:07:57.306 --> 00:07:58.496 A:middle
startCapture 中

00:07:58.496 --> 00:08:00.046 A:middle
是否出现错误

00:07:58.496 --> 00:08:00.046 A:middle
是否出现错误

00:08:01.286 --> 00:08:02.886 A:middle
stopCapture 也会调入

00:08:02.886 --> 00:08:04.076 A:middle
一个 completionHandler

00:08:04.076 --> 00:08:05.616 A:middle
会回传给你 NS Error

00:08:05.966 --> 00:08:07.696 A:middle
为你指示 stopCapture 中

00:08:07.696 --> 00:08:08.626 A:middle
是否出现

00:08:08.626 --> 00:08:09.366 A:middle
错误

00:08:10.566 --> 00:08:11.566 A:middle
让我们来看一下

00:08:11.566 --> 00:08:12.446 A:middle
实例中如何

00:08:12.446 --> 00:08:12.976 A:middle
操作

00:08:15.106 --> 00:08:16.476 A:middle
在我们这个例子里

00:08:16.476 --> 00:08:18.256 A:middle
我要把

00:08:18.256 --> 00:08:19.656 A:middle
ReplayKit 给我的样本

00:08:19.656 --> 00:08:21.576 A:middle
用 AVAssetWriter

00:08:21.576 --> 00:08:23.126 A:middle
将一个简单的电影文件

00:08:23.276 --> 00:08:24.436 A:middle
写到盘里

00:08:25.126 --> 00:08:27.026 A:middle
有一个方法

00:08:27.026 --> 00:08:28.226 A:middle
叫 didPressCaptureButton

00:08:28.736 --> 00:08:30.326 A:middle
在里面

00:08:30.326 --> 00:08:31.656 A:middle
只要把屏幕录制单例

00:08:31.656 --> 00:08:33.265 A:middle
从 RPScreenRecorder 拿来

00:08:33.956 --> 00:08:35.416 A:middle
然后 调用 startCapture

00:08:35.416 --> 00:08:37.265 A:middle
给它提供

00:08:37.265 --> 00:08:38.746 A:middle
captureHandlerBlock

00:08:38.746 --> 00:08:39.726 A:middle
和 completionHandlerBlock

00:08:40.616 --> 00:08:41.936 A:middle
还记得么 我要用 AVAssetWriter

00:08:41.936 --> 00:08:43.645 A:middle
把我们拿到的样本

00:08:43.645 --> 00:08:44.866 A:middle
写成电影文件

00:08:45.146 --> 00:08:46.406 A:middle
所以知道如何

00:08:46.406 --> 00:08:47.716 A:middle
处理这些样本

00:08:47.716 --> 00:08:48.356 A:middle
是很重要的

00:08:49.006 --> 00:08:50.896 A:middle
让我们再来看一下

00:08:50.976 --> 00:08:51.736 A:middle
captureHandler

00:08:53.876 --> 00:08:56.206 A:middle
每次 ReplayKit 准备给 App

00:08:56.206 --> 00:08:58.566 A:middle
传回一个样本时

00:08:58.566 --> 00:09:00.036 A:middle
captureHandler

00:08:58.566 --> 00:09:00.036 A:middle
captureHandler

00:09:00.036 --> 00:09:00.966 A:middle
都会被调用

00:09:01.616 --> 00:09:02.346 A:middle
我们会为你提供

00:09:02.346 --> 00:09:04.246 A:middle
CMSampleBuffer 参考

00:09:04.246 --> 00:09:06.526 A:middle
RPSampleBufferType

00:09:06.566 --> 00:09:06.836 A:middle
和 NS Error

00:09:08.046 --> 00:09:09.376 A:middle
因为我要把这些样本

00:09:09.376 --> 00:09:10.766 A:middle
用 AVAssetWriter 写成

00:09:10.766 --> 00:09:12.786 A:middle
简单的电影文件

00:09:12.786 --> 00:09:13.926 A:middle
知道我从 ReplayKit

00:09:13.996 --> 00:09:15.456 A:middle
得到的是哪种类型的样本

00:09:15.456 --> 00:09:16.136 A:middle
是很重要的

00:09:16.936 --> 00:09:18.476 A:middle
我们在

00:09:18.476 --> 00:09:20.996 A:middle
RPSampleType 这有个开关

00:09:20.996 --> 00:09:21.476 A:middle
可以做到这点

00:09:22.866 --> 00:09:24.206 A:middle
如果有个 sampleBufferType

00:09:24.206 --> 00:09:25.906 A:middle
是视频

00:09:25.906 --> 00:09:27.356 A:middle
只要把样本附加到

00:09:27.356 --> 00:09:28.466 A:middle
AVAssetWriter

00:09:28.466 --> 00:09:29.166 A:middle
的视频输入

00:09:30.036 --> 00:09:31.396 A:middle
如果有个 sampleBufferType

00:09:31.396 --> 00:09:32.956 A:middle
是音频 只要把样本附加到

00:09:32.956 --> 00:09:35.266 A:middle
AVAssetWriter 的

00:09:35.266 --> 00:09:35.976 A:middle
音频输入

00:09:36.436 --> 00:09:38.136 A:middle
最后 如果有个

00:09:38.136 --> 00:09:39.076 A:middle
sampleBufferType

00:09:39.076 --> 00:09:40.576 A:middle
是麦克风 只要把样本附加到

00:09:40.576 --> 00:09:42.096 A:middle
AVAssetWriter 的

00:09:42.446 --> 00:09:43.486 A:middle
麦克风输入

00:09:44.276 --> 00:09:46.086 A:middle
就像这样

00:09:46.086 --> 00:09:48.316 A:middle
我可以处理

00:09:48.316 --> 00:09:49.926 A:middle
要从 ReplayKit 拿到的

00:09:50.136 --> 00:09:50.786 A:middle
样本的所有类型

00:09:51.516 --> 00:09:52.906 A:middle
我还要用 AVAssetWriter

00:09:52.906 --> 00:09:54.496 A:middle
把他们写成一个简单的

00:09:54.496 --> 00:09:55.276 A:middle
电影文件到盘上

00:09:56.726 --> 00:09:57.826 A:middle
让我们再来看一下

00:09:57.826 --> 00:09:58.896 A:middle
completionHandler

00:10:02.046 --> 00:10:03.466 A:middle
像录制一样

00:10:03.466 --> 00:10:05.026 A:middle
我们希望用户知道

00:10:05.226 --> 00:10:06.676 A:middle
捕捉进程

00:10:06.676 --> 00:10:08.076 A:middle
已经开始 或者

00:10:08.076 --> 00:10:08.466 A:middle
正在进行

00:10:08.826 --> 00:10:10.366 A:middle
所以在 completionHandler 里

00:10:10.616 --> 00:10:11.956 A:middle
我们调用

00:10:11.956 --> 00:10:13.246 A:middle
updateCaptureButton

00:10:13.246 --> 00:10:14.286 A:middle
带有我们从 completionHandler 中

00:10:14.496 --> 00:10:15.476 A:middle
得到的 error 代码

00:10:15.926 --> 00:10:17.426 A:middle
这样我就可以更新 UI

00:10:17.426 --> 00:10:19.926 A:middle
并且告诉我的用户

00:10:19.926 --> 00:10:21.176 A:middle
捕捉进程开始了

00:10:21.826 --> 00:10:22.956 A:middle
就这么简单

00:10:23.246 --> 00:10:24.166 A:middle
这就是 要开始使用

00:10:24.166 --> 00:10:24.886 A:middle
这个强大的新 API 时

00:10:24.886 --> 00:10:24.976 A:middle
要做的所有事情

00:10:28.096 --> 00:10:29.816 A:middle
我们花点时间

00:10:29.816 --> 00:10:31.386 A:middle
重温一下 App 内屏幕捕捉

00:10:31.386 --> 00:10:32.616 A:middle
如何工作

00:10:33.076 --> 00:10:35.126 A:middle
我想提醒你

00:10:35.126 --> 00:10:37.406 A:middle
你的 App 现在可以

00:10:37.406 --> 00:10:40.286 A:middle
直接通过 ReplayKit

00:10:40.346 --> 00:10:41.406 A:middle
访问它自己的音频 视频

00:10:41.406 --> 00:10:41.976 A:middle
和麦克风内容

00:10:45.046 --> 00:10:46.586 A:middle
在我们的例子里

00:10:46.586 --> 00:10:48.156 A:middle
我们用 AVAssetWriter 把这些样本

00:10:48.156 --> 00:10:50.256 A:middle
做成简单的电影文件

00:10:50.256 --> 00:10:52.056 A:middle
但其实你还可以做很多别的

00:10:52.756 --> 00:10:54.466 A:middle
现在你的 App

00:10:54.466 --> 00:10:55.856 A:middle
可以访问自己的音频

00:10:55.856 --> 00:10:58.726 A:middle
和视频样本

00:10:58.726 --> 00:11:00.596 A:middle
你可以在在这个 App 里

00:10:58.726 --> 00:11:00.596 A:middle
你可以在在这个 App 里

00:11:00.596 --> 00:11:01.416 A:middle
创建并管理视频

00:11:04.046 --> 00:11:05.656 A:middle
你甚至可以创建一个

00:11:05.656 --> 00:11:07.096 A:middle
个性化视频编辑器

00:11:07.096 --> 00:11:08.336 A:middle
并把它和

00:11:08.336 --> 00:11:09.706 A:middle
用户体验

00:11:09.706 --> 00:11:10.166 A:middle
完美集合

00:11:12.056 --> 00:11:14.576 A:middle
再次重申  ReplayKit 2 的目标

00:11:14.576 --> 00:11:16.126 A:middle
是让 ReplayKit 适用所有的 App

00:11:16.126 --> 00:11:17.736 A:middle
而不仅仅是游戏

00:11:19.026 --> 00:11:20.716 A:middle
我这有同一个

00:11:20.716 --> 00:11:22.606 A:middle
生产力 App

00:11:22.686 --> 00:11:23.976 A:middle
在两个不同 iOS 设备上运行

00:11:24.546 --> 00:11:27.256 A:middle
我现在可以访问

00:11:27.256 --> 00:11:29.186 A:middle
App 的音频

00:11:29.186 --> 00:11:31.266 A:middle
和视频样本

00:11:31.316 --> 00:11:33.176 A:middle
像直播一样 我可以

00:11:33.176 --> 00:11:34.996 A:middle
自己编码这些样本

00:11:34.996 --> 00:11:36.406 A:middle
并发送给我自己的服务器

00:11:37.656 --> 00:11:39.556 A:middle
我可以把 App 的

00:11:39.626 --> 00:11:41.366 A:middle
屏幕捕捉

00:11:41.646 --> 00:11:43.436 A:middle
分享给

00:11:43.436 --> 00:11:45.926 A:middle
在其他设备上运行的

00:11:45.926 --> 00:11:46.486 A:middle
App 的其他实例

00:11:47.766 --> 00:11:49.276 A:middle
这在以前是不可能的

00:11:49.276 --> 00:11:50.936 A:middle
但现在 有了 App 间屏幕捕捉

00:11:50.936 --> 00:11:51.806 A:middle
就可以了

00:11:53.276 --> 00:11:54.406 A:middle
这些只是

00:11:54.406 --> 00:11:55.826 A:middle
用 App 间屏幕捕捉

00:11:55.826 --> 00:11:57.536 A:middle
创建新用户体验的

00:11:57.536 --> 00:11:58.396 A:middle
一些例子

00:11:58.626 --> 00:12:00.106 A:middle
我们很希望看到

00:11:58.626 --> 00:12:00.106 A:middle
我们很希望看到

00:12:00.106 --> 00:12:00.916 A:middle
开发者们还有什么别的

00:12:00.916 --> 00:12:00.983 A:middle
创新

00:12:05.046 --> 00:12:06.956 A:middle
我们对 ReplayKit 2 的目标是

00:12:06.956 --> 00:12:08.996 A:middle
让 ReplayKit 适用于所有 App

00:12:08.996 --> 00:12:10.656 A:middle
而不仅仅是游戏

00:12:11.416 --> 00:12:13.616 A:middle
因此

00:12:13.616 --> 00:12:15.686 A:middle
我想介绍一下

00:12:15.686 --> 00:12:16.756 A:middle
iOS 屏幕录制和直播

00:12:17.836 --> 00:12:19.106 A:middle
iOS 屏幕录制和直播

00:12:19.106 --> 00:12:21.266 A:middle
是一个很棒的新的

00:12:21.266 --> 00:12:22.766 A:middle
用户功能

00:12:22.766 --> 00:12:25.666 A:middle
让用户可以录制和直播

00:12:25.666 --> 00:12:27.386 A:middle
整个 iOS 屏幕体验

00:12:29.206 --> 00:12:30.206 A:middle
让我们来看看

00:12:30.206 --> 00:12:31.036 A:middle
如何使用

00:12:31.036 --> 00:12:31.396 A:middle
这个新功能

00:12:33.456 --> 00:12:35.326 A:middle
要使用 iOS 屏幕录制和直播

00:12:35.326 --> 00:12:36.596 A:middle
首先要

00:12:36.596 --> 00:12:37.866 A:middle
启用控制中心的

00:12:37.866 --> 00:12:39.446 A:middle
屏幕录制按钮

00:12:40.426 --> 00:12:41.466 A:middle
我们直接进入

00:12:41.466 --> 00:12:43.406 A:middle
设置

00:12:43.406 --> 00:12:43.686 A:middle
控制中心

00:12:44.446 --> 00:12:46.236 A:middle
我们可以看到

00:12:46.236 --> 00:12:47.756 A:middle
所有控制中心的

00:12:47.756 --> 00:12:48.326 A:middle
支持按钮

00:12:49.136 --> 00:12:50.426 A:middle
只需要添加

00:12:50.426 --> 00:12:52.566 A:middle
屏幕录制按钮

00:12:52.566 --> 00:12:53.136 A:middle
然后进入控制中心

00:12:54.196 --> 00:12:55.556 A:middle
就这样

00:12:55.556 --> 00:12:57.156 A:middle
你现在已经可以

00:12:57.156 --> 00:12:58.546 A:middle
分享整个

00:12:58.546 --> 00:12:59.186 A:middle
iOS 屏幕体验了

00:12:59.716 --> 00:13:00.856 A:middle
[ 鼓掌 ] 谢谢

00:12:59.716 --> 00:13:00.856 A:middle
[ 鼓掌 ] 谢谢

00:13:01.086 --> 00:13:05.016 A:middle
要开始 iOS 屏幕录制

00:13:05.016 --> 00:13:06.386 A:middle
只需要点击

00:13:06.386 --> 00:13:07.486 A:middle
屏幕录制按钮

00:13:08.876 --> 00:13:10.536 A:middle
你现在就在录制

00:13:10.536 --> 00:13:12.406 A:middle
整个 iOS 屏幕体验了

00:13:13.056 --> 00:13:14.746 A:middle
这个状态栏

00:13:14.746 --> 00:13:16.286 A:middle
和屏幕录制按钮

00:13:16.286 --> 00:13:17.376 A:middle
会通过显示录制指示器

00:13:17.376 --> 00:13:19.346 A:middle
和当前录制的

00:13:19.346 --> 00:13:21.346 A:middle
运行时间

00:13:21.346 --> 00:13:22.516 A:middle
告诉你

00:13:22.516 --> 00:13:22.876 A:middle
现在正在录制

00:13:24.196 --> 00:13:26.776 A:middle
要停止录制

00:13:26.776 --> 00:13:28.016 A:middle
你只需要再次点击

00:13:28.016 --> 00:13:28.356 A:middle
屏幕录制按钮

00:13:29.826 --> 00:13:30.746 A:middle
录制停止后

00:13:30.746 --> 00:13:32.356 A:middle
会出现一个

00:13:32.466 --> 00:13:34.396 A:middle
通知 告诉你

00:13:34.396 --> 00:13:36.026 A:middle
刚才录制的内容

00:13:36.026 --> 00:13:37.756 A:middle
被保存到

00:13:37.756 --> 00:13:38.906 A:middle
相册里了

00:13:39.926 --> 00:13:41.756 A:middle
点击这个横幅

00:13:41.756 --> 00:13:42.756 A:middle
可以直接进入相册

00:13:42.756 --> 00:13:44.096 A:middle
在那里你可以

00:13:44.096 --> 00:13:45.776 A:middle
查看 编辑 或者分享

00:13:45.776 --> 00:13:46.846 A:middle
刚刚录制的内容

00:13:48.996 --> 00:13:52.686 A:middle
你还可以 3D Touch

00:13:52.686 --> 00:13:53.776 A:middle
屏幕录制按钮

00:13:53.886 --> 00:13:55.536 A:middle
然后直接进入

00:13:55.536 --> 00:13:57.626 A:middle
扩展视图

00:13:57.696 --> 00:13:58.996 A:middle
可以设置麦克风

00:13:58.996 --> 00:14:01.036 A:middle
开始录制

00:13:58.996 --> 00:14:01.036 A:middle
开始录制

00:14:01.036 --> 00:14:04.026 A:middle
或者停止录制

00:14:06.716 --> 00:14:08.316 A:middle
假设

00:14:08.316 --> 00:14:09.416 A:middle
我刚下载了一个

00:14:09.416 --> 00:14:10.856 A:middle
直播 App

00:14:10.856 --> 00:14:12.016 A:middle
支持 ReplayKit 直播

00:14:13.056 --> 00:14:14.576 A:middle
我想用这个

00:14:14.656 --> 00:14:16.916 A:middle
直播 App

00:14:16.916 --> 00:14:18.976 A:middle
分享我的完整 iOS 屏幕体验

00:14:19.756 --> 00:14:20.536 A:middle
其实很简单

00:14:20.536 --> 00:14:21.946 A:middle
你只需要

00:14:21.946 --> 00:14:24.216 A:middle
3D Touch

00:14:24.216 --> 00:14:25.256 A:middle
屏幕录制按钮

00:14:26.126 --> 00:14:27.716 A:middle
进入扩展视图

00:14:27.716 --> 00:14:29.846 A:middle
所有在此设备上

00:14:29.846 --> 00:14:30.836 A:middle
安装的

00:14:30.836 --> 00:14:32.456 A:middle
支持 ReplayKit 直播

00:14:32.456 --> 00:14:33.976 A:middle
的 App

00:14:33.976 --> 00:14:34.316 A:middle
都会显示

00:14:35.256 --> 00:14:36.846 A:middle
你只需要选择

00:14:36.846 --> 00:14:39.116 A:middle
想要的服务

00:14:39.256 --> 00:14:40.316 A:middle
然后点击开始直播

00:14:41.876 --> 00:14:43.596 A:middle
你现在就在向

00:14:43.596 --> 00:14:46.536 A:middle
全世界直播

00:14:46.536 --> 00:14:47.486 A:middle
你的 iOS 屏幕体验

00:14:48.856 --> 00:14:50.956 A:middle
和录制一样

00:14:50.956 --> 00:14:52.076 A:middle
屏幕录制按钮的

00:14:52.076 --> 00:14:53.996 A:middle
状态栏

00:14:53.996 --> 00:14:55.376 A:middle
会通过录制指示器

00:14:55.376 --> 00:14:57.116 A:middle
被选中的直播服务

00:14:57.116 --> 00:14:58.876 A:middle
和目前直播的时间

00:14:58.876 --> 00:15:00.266 A:middle
来显示

00:14:58.876 --> 00:15:00.266 A:middle
来显示

00:15:00.266 --> 00:15:02.016 A:middle
直播正在

00:15:02.016 --> 00:15:03.046 A:middle
进行中

00:15:04.576 --> 00:15:05.966 A:middle
要停止直播

00:15:06.016 --> 00:15:07.646 A:middle
只需要点击停止直播

00:15:07.646 --> 00:15:07.926 A:middle
按键

00:15:09.126 --> 00:15:12.296 A:middle
现在 你可以录一个视频

00:15:12.296 --> 00:15:13.846 A:middle
教你的祖父母

00:15:13.846 --> 00:15:14.926 A:middle
如何用 FaceTime

00:15:15.926 --> 00:15:17.636 A:middle
你甚至可以制作一个视频

00:15:17.876 --> 00:15:19.086 A:middle
教你的父母

00:15:19.086 --> 00:15:19.996 A:middle
怎么发送邮件

00:15:20.746 --> 00:15:22.166 A:middle
或者

00:15:22.166 --> 00:15:23.596 A:middle
你可以录一个视频

00:15:23.596 --> 00:15:25.986 A:middle
教你的孩子们怎么在 iTunes 里

00:15:25.986 --> 00:15:28.216 A:middle
找到他们喜欢的节目和电影

00:15:28.986 --> 00:15:30.926 A:middle
分享你完整的

00:15:30.926 --> 00:15:32.626 A:middle
iOS 屏幕体验

00:15:32.626 --> 00:15:33.226 A:middle
就是这么容易

00:15:33.776 --> 00:15:35.856 A:middle
iOS 屏幕录制和直播

00:15:35.856 --> 00:15:37.696 A:middle
用使用 ReplayKit

00:15:37.696 --> 00:15:39.766 A:middle
的 App

00:15:39.766 --> 00:15:40.656 A:middle
创建新的

00:15:40.656 --> 00:15:41.136 A:middle
用户体验

00:15:41.536 --> 00:15:42.866 A:middle
让我们来看看

00:15:42.866 --> 00:15:46.886 A:middle
一些很棒的实践

00:15:46.886 --> 00:15:47.826 A:middle
当使用 ReplayKit 时

00:15:47.826 --> 00:15:49.276 A:middle
iOS 屏幕录制和直播

00:15:49.276 --> 00:15:50.056 A:middle
有优先权

00:15:50.316 --> 00:15:51.806 A:middle
如果你的 App

00:15:51.886 --> 00:15:53.136 A:middle
正在使用 ReplayKit

00:15:53.136 --> 00:15:55.266 A:middle
录制或者直播

00:15:55.266 --> 00:15:56.816 A:middle
这时用户启动

00:15:56.816 --> 00:15:58.776 A:middle
iOS 屏幕录制和直播

00:15:58.776 --> 00:16:00.956 A:middle
RPScreenRecorderDelegate

00:15:58.776 --> 00:16:00.956 A:middle
RPScreenRecorderDelegate

00:16:00.956 --> 00:16:02.816 A:middle
会通知你的 App

00:16:02.816 --> 00:16:03.546 A:middle
进程被

00:16:03.546 --> 00:16:04.106 A:middle
打断了

00:16:05.136 --> 00:16:07.786 A:middle
在这种情况下

00:16:07.786 --> 00:16:09.646 A:middle
录制会被废弃

00:16:09.646 --> 00:16:11.546 A:middle
你需要更新 UI

00:16:11.546 --> 00:16:12.326 A:middle
并通知用户

00:16:12.796 --> 00:16:15.016 A:middle
iOS 屏幕录制和直播

00:16:15.016 --> 00:16:17.096 A:middle
是个很好的功能

00:16:17.506 --> 00:16:19.876 A:middle
我们希望用户和

00:16:19.876 --> 00:16:21.496 A:middle
开发者可以用它创造

00:16:21.496 --> 00:16:23.336 A:middle
更多新的 iOS 内容

00:16:23.836 --> 00:16:25.956 A:middle
为了更好地帮助你们

00:16:25.956 --> 00:16:27.626 A:middle
Alexander Subbotin

00:16:27.626 --> 00:16:29.026 A:middle
会上台来

00:16:29.026 --> 00:16:30.476 A:middle
和你们讲讲

00:16:30.476 --> 00:16:31.896 A:middle
如何用 ReplayKit 直播

00:16:33.516 --> 00:16:35.636 A:middle
[ 鼓掌 ]

00:16:36.136 --> 00:16:36.716 A:middle
&gt;&gt; 谢谢 Johnny

00:16:38.006 --> 00:16:38.496 A:middle
早上好

00:16:39.196 --> 00:16:40.696 A:middle
我叫 Alexander Subbotin

00:16:40.916 --> 00:16:43.536 A:middle
很高兴能在这里

00:16:43.746 --> 00:16:45.126 A:middle
和你们分享

00:16:45.126 --> 00:16:46.886 A:middle
我们直播 API 的

00:16:46.886 --> 00:16:46.976 A:middle
更多细节

00:16:49.856 --> 00:16:52.526 A:middle
ReplayKit 让 App

00:16:52.806 --> 00:16:54.556 A:middle
可以直接从

00:16:54.556 --> 00:16:55.886 A:middle
你的 iOS 和 tvOS 设备

00:16:55.956 --> 00:16:58.686 A:middle
把内容流式传输到

00:16:59.776 --> 00:17:00.516 A:middle
第三方直播服务

00:16:59.776 --> 00:17:00.516 A:middle
第三方直播服务

00:17:00.516 --> 00:17:01.926 A:middle
在 iOS 你可以用

00:17:01.926 --> 00:17:03.746 A:middle
麦克风和相机

00:17:03.746 --> 00:17:05.246 A:middle
添加声音和视频评论

00:17:06.026 --> 00:17:07.286 A:middle
所有的内容都

00:17:07.326 --> 00:17:08.866 A:middle
很安全

00:17:08.866 --> 00:17:11.016 A:middle
并且无法从你使用的

00:17:11.016 --> 00:17:11.915 A:middle
直播服务访问

00:17:15.276 --> 00:17:17.326 A:middle
这是一个直播如何工作的

00:17:17.425 --> 00:17:19.226 A:middle
高层图

00:17:20.386 --> 00:17:22.086 A:middle
左边

00:17:22.086 --> 00:17:24.566 A:middle
一个玩家想

00:17:24.566 --> 00:17:27.386 A:middle
把他的游戏 Tower Dash

00:17:27.386 --> 00:17:29.296 A:middle
在叫 Mobcrush 的直播服务中

00:17:29.436 --> 00:17:30.046 A:middle
直播

00:17:31.876 --> 00:17:33.746 A:middle
Tower Dash 与

00:17:33.746 --> 00:17:35.486 A:middle
ReplayKit API 沟通

00:17:35.486 --> 00:17:36.146 A:middle
开启直播

00:17:37.416 --> 00:17:40.026 A:middle
一旦开启

00:17:40.026 --> 00:17:41.716 A:middle
ReplayKit 会呈现一些 UI

00:17:41.716 --> 00:17:43.086 A:middle
让用户可以 ping 命令

00:17:43.086 --> 00:17:43.586 A:middle
直播服务

00:17:44.006 --> 00:17:45.836 A:middle
在这里就是

00:17:45.976 --> 00:17:46.556 A:middle
Mobcrush

00:17:48.216 --> 00:17:49.696 A:middle
直播开始了

00:17:49.696 --> 00:17:52.046 A:middle
直播进行时

00:17:52.396 --> 00:17:55.256 A:middle
ReplayKit 会把

00:17:55.256 --> 00:17:57.566 A:middle
音频和视频样本

00:17:57.566 --> 00:17:59.366 A:middle
提供给 Mobcrush App 扩展

00:17:59.366 --> 00:18:02.016 A:middle
它可以直接对接

00:17:59.366 --> 00:18:02.016 A:middle
它可以直接对接

00:18:02.016 --> 00:18:03.616 A:middle
直播服务和

00:18:03.616 --> 00:18:05.346 A:middle
在网上看直播的

00:18:05.346 --> 00:18:07.066 A:middle
全世界的观众

00:18:10.176 --> 00:18:12.296 A:middle
这就是一个如何实现直播

00:18:12.296 --> 00:18:13.376 A:middle
的图例

00:18:13.636 --> 00:18:16.046 A:middle
我想把它

00:18:16.046 --> 00:18:17.986 A:middle
分成几个部分

00:18:17.986 --> 00:18:20.666 A:middle
来给你们讲解

00:18:21.336 --> 00:18:23.396 A:middle
因为如果你是客户端 App 开发员

00:18:23.396 --> 00:18:25.306 A:middle
或者是游戏开发员

00:18:26.246 --> 00:18:29.236 A:middle
你只需要

00:18:29.236 --> 00:18:30.656 A:middle
提供一些 ViewController

00:18:30.656 --> 00:18:33.646 A:middle
开启直播

00:18:33.646 --> 00:18:35.066 A:middle
和几个其他简单的步骤

00:18:38.196 --> 00:18:39.786 A:middle
但是我知道

00:18:39.786 --> 00:18:42.136 A:middle
这个屋子里的有些人是

00:18:42.136 --> 00:18:43.006 A:middle
直播服务开发员

00:18:43.216 --> 00:18:45.216 A:middle
所以我会

00:18:45.216 --> 00:18:47.716 A:middle
讲解整个步骤

00:18:47.716 --> 00:18:49.356 A:middle
告诉你如何

00:18:49.356 --> 00:18:50.636 A:middle
实现这些扩展

00:18:53.276 --> 00:18:54.656 A:middle
首先从客户端开始

00:18:54.656 --> 00:18:56.566 A:middle
客户端 App

00:18:56.566 --> 00:18:58.186 A:middle
都要做什么

00:18:59.116 --> 00:19:01.606 A:middle
我们有一个简单的 API

00:18:59.116 --> 00:19:01.606 A:middle
我们有一个简单的 API

00:19:02.876 --> 00:19:04.856 A:middle
包含在

00:19:04.856 --> 00:19:05.676 A:middle
这三个类里

00:19:06.936 --> 00:19:07.406 A:middle
包括

00:19:07.706 --> 00:19:09.396 A:middle
BroadcastActivityViewController

00:19:10.216 --> 00:19:12.406 A:middle
这个类是用来

00:19:12.406 --> 00:19:13.916 A:middle
发起直播

00:19:13.916 --> 00:19:15.866 A:middle
并显示这个 built UI

00:19:15.866 --> 00:19:16.826 A:middle
让你可以选择

00:19:16.826 --> 00:19:17.306 A:middle
直播服务

00:19:18.616 --> 00:19:22.346 A:middle
RPBroadcastController

00:19:22.946 --> 00:19:24.956 A:middle
让你可以在代码里管理直播

00:19:24.956 --> 00:19:26.956 A:middle
你可以连接到 UI

00:19:26.956 --> 00:19:29.206 A:middle
使得用户可以

00:19:29.206 --> 00:19:30.916 A:middle
开始 停止 暂停 或者恢复

00:19:30.916 --> 00:19:31.826 A:middle
直播

00:19:32.286 --> 00:19:32.816 A:middle
另外

00:19:32.816 --> 00:19:34.776 A:middle
RPBroadcastControllerDelegate

00:19:34.776 --> 00:19:37.216 A:middle
是内部的

00:19:37.216 --> 00:19:38.326 A:middle
是直播中不同事件的

00:19:38.326 --> 00:19:39.866 A:middle
专用的部分

00:19:39.866 --> 00:19:41.306 A:middle
直播有可能会停止

00:19:41.306 --> 00:19:43.236 A:middle
可能发生错误

00:19:43.756 --> 00:19:46.566 A:middle
或者直播扩展

00:19:46.566 --> 00:19:47.996 A:middle
要给客户端 App 提供

00:19:47.996 --> 00:19:49.626 A:middle
一些信息

00:19:49.626 --> 00:19:51.106 A:middle
这时 delegate 就会告诉

00:19:51.106 --> 00:19:51.516 A:middle
用户

00:19:53.476 --> 00:19:55.776 A:middle
那么 这部分

00:19:56.046 --> 00:19:57.176 A:middle
我就不多讲了

00:19:57.176 --> 00:19:59.606 A:middle
因为去年

00:20:00.056 --> 00:20:02.046 A:middle
在 ReplayKit 直播课程里

00:20:02.046 --> 00:20:03.636 A:middle
我们深入地讲解了

00:20:03.636 --> 00:20:04.226 A:middle
这个 API

00:20:04.846 --> 00:20:06.366 A:middle
如果你还没有采用这个 API

00:20:06.366 --> 00:20:09.976 A:middle
请到 App 里

00:20:09.976 --> 00:20:11.316 A:middle
找到去年课程的链接

00:20:11.316 --> 00:20:13.486 A:middle
那里可以了解更多

00:20:13.486 --> 00:20:15.106 A:middle
关于这个开发者 API 的内容

00:20:19.776 --> 00:20:21.906 A:middle
现在我们来说一说

00:20:21.906 --> 00:20:24.686 A:middle
方程式中第二个部分

00:20:24.806 --> 00:20:26.416 A:middle
直播服务的

00:20:26.416 --> 00:20:26.946 A:middle
开发者

00:20:27.556 --> 00:20:28.686 A:middle
如何集成你的服务

00:20:28.686 --> 00:20:31.626 A:middle
使得你可以流式传输

00:20:31.626 --> 00:20:33.486 A:middle
玩家 游戏

00:20:33.486 --> 00:20:35.616 A:middle
和其他 App 创造的

00:20:35.616 --> 00:20:36.366 A:middle
内容

00:20:41.496 --> 00:20:44.436 A:middle
答案就是

00:20:44.436 --> 00:20:45.086 A:middle
这三个扩展

00:20:46.936 --> 00:20:49.856 A:middle
第一个是

00:20:49.856 --> 00:20:52.136 A:middle
Broadcast Setup 扩展

00:20:52.136 --> 00:20:54.306 A:middle
它会显示

00:20:54.306 --> 00:20:56.146 A:middle
一些 UI

00:20:56.146 --> 00:20:57.776 A:middle
让用户输入

00:20:57.926 --> 00:20:59.656 A:middle
信息

00:20:59.656 --> 00:21:02.026 A:middle
你可能想让用户

00:20:59.656 --> 00:21:02.026 A:middle
你可能想让用户

00:21:02.026 --> 00:21:05.076 A:middle
给直播命名

00:21:05.076 --> 00:21:07.056 A:middle
输入凭证

00:21:07.056 --> 00:21:08.716 A:middle
或者其他一些细节

00:21:09.236 --> 00:21:12.676 A:middle
第二个是

00:21:13.016 --> 00:21:14.566 A:middle
Broadcast Upload 扩展

00:21:14.766 --> 00:21:16.926 A:middle
这个扩展的功能是

00:21:16.926 --> 00:21:19.816 A:middle
接收 ReplayKit 提供的

00:21:19.816 --> 00:21:21.856 A:middle
媒体样本

00:21:21.856 --> 00:21:25.306 A:middle
并编码

00:21:26.396 --> 00:21:27.836 A:middle
创建一个视频流

00:21:27.836 --> 00:21:30.526 A:middle
并上载到线上服务

00:21:31.066 --> 00:21:33.746 A:middle
每个扩展都是

00:21:33.746 --> 00:21:36.526 A:middle
和直播 App 同时

00:21:36.526 --> 00:21:37.996 A:middle
安装在你的设备上的

00:21:37.996 --> 00:21:38.296 A:middle
分别的二进制

00:21:38.666 --> 00:21:40.576 A:middle
你可以安装到 Mobcrush

00:21:40.666 --> 00:21:42.546 A:middle
你也可以把 Setup 扩展

00:21:42.546 --> 00:21:44.316 A:middle
和 Upload 扩展

00:21:44.316 --> 00:21:44.926 A:middle
安装在你的设备上

00:21:44.926 --> 00:21:48.136 A:middle
每个扩展

00:21:48.136 --> 00:21:50.176 A:middle
独立于 Mobcrush

00:21:50.176 --> 00:21:51.476 A:middle
运行自己的进程

00:21:51.476 --> 00:21:54.256 A:middle
包含扩展和 Tower Dash

00:21:54.256 --> 00:21:55.266 A:middle
来发起直播

00:21:55.266 --> 00:21:56.206 A:middle
一般来说有三个进程

00:21:56.206 --> 00:21:58.166 A:middle
Mobcrush 的包容 App

00:21:58.166 --> 00:22:01.176 A:middle
的进程

00:21:58.166 --> 00:22:01.176 A:middle
的进程

00:22:01.176 --> 00:22:01.836 A:middle
从未被启用

00:22:05.136 --> 00:22:06.316 A:middle
为了帮助你开始

00:22:06.316 --> 00:22:07.656 A:middle
开发新的直播扩展

00:22:07.656 --> 00:22:09.926 A:middle
我们给这两种扩展都

00:22:09.926 --> 00:22:11.896 A:middle
提供很简单的

00:22:11.896 --> 00:22:12.976 A:middle
Xcode 模板

00:22:12.976 --> 00:22:16.376 A:middle
只需要给 Xcode 工程

00:22:16.376 --> 00:22:17.866 A:middle
添加两个扩展

00:22:17.866 --> 00:22:18.546 A:middle
就好了

00:22:19.116 --> 00:22:22.846 A:middle
现在来讲讲

00:22:22.846 --> 00:22:24.446 A:middle
具体如何编码

00:22:25.226 --> 00:22:26.426 A:middle
从 Setup 扩展

00:22:26.426 --> 00:22:26.916 A:middle
开始

00:22:29.646 --> 00:22:31.316 A:middle
我刚才说过

00:22:31.316 --> 00:22:32.936 A:middle
Setup 扩展的目的是

00:22:32.936 --> 00:22:35.516 A:middle
显示 UI

00:22:35.886 --> 00:22:36.716 A:middle
让用户输入直播的名字

00:22:36.716 --> 00:22:37.316 A:middle
或其他内容

00:22:38.286 --> 00:22:39.716 A:middle
但是它还有另外一个

00:22:39.836 --> 00:22:40.806 A:middle
重要的功能

00:22:43.106 --> 00:22:44.586 A:middle
它可以获取

00:22:44.586 --> 00:22:45.986 A:middle
客户 App 的一些重要信息

00:22:45.986 --> 00:22:47.866 A:middle
比如 BundleID

00:22:47.866 --> 00:22:49.836 A:middle
App 的名字

00:22:49.836 --> 00:22:50.686 A:middle
和图标

00:22:51.896 --> 00:22:53.906 A:middle
它可以上载这些信息

00:22:53.906 --> 00:22:55.166 A:middle
到直播服务

00:22:55.166 --> 00:22:56.536 A:middle
这样直播服务

00:22:56.536 --> 00:22:58.166 A:middle
就可以给观众

00:22:58.166 --> 00:23:00.976 A:middle
创建一个体验

00:22:58.166 --> 00:23:00.976 A:middle
创建一个体验

00:23:00.976 --> 00:23:02.496 A:middle
当用户登上网站时

00:23:02.496 --> 00:23:04.336 A:middle
他知道

00:23:04.336 --> 00:23:05.876 A:middle
这是大家玩 Tower Dash 的地方

00:23:06.106 --> 00:23:07.336 A:middle
有 Tower Dash 的图标

00:23:08.996 --> 00:23:12.436 A:middle
尽管这个扩展

00:23:12.436 --> 00:23:14.026 A:middle
可以从直播服务

00:23:14.026 --> 00:23:16.156 A:middle
申请一个在网站上

00:23:16.156 --> 00:23:17.426 A:middle
直播的 URL

00:23:17.426 --> 00:23:20.056 A:middle
并重新分享给 App

00:23:20.056 --> 00:23:22.716 A:middle
这样玩家就可以

00:23:22.716 --> 00:23:24.186 A:middle
发送给朋友

00:23:24.186 --> 00:23:25.726 A:middle
并获得更多关注

00:23:30.196 --> 00:23:31.436 A:middle
执行这个 UI 的

00:23:31.436 --> 00:23:33.176 A:middle
ViewController

00:23:33.176 --> 00:23:34.636 A:middle
用一个叫 extensionContext 的属性

00:23:34.636 --> 00:23:36.046 A:middle
和 ReplayKit 沟通

00:23:36.046 --> 00:23:38.086 A:middle
这个属性的类

00:23:38.496 --> 00:23:39.446 A:middle
是 NSExtensionContext

00:23:39.486 --> 00:23:42.126 A:middle
的一个分类

00:23:42.126 --> 00:23:43.686 A:middle
还有两个由 ReplayKit

00:23:43.776 --> 00:23:44.906 A:middle
添加的功能

00:23:45.326 --> 00:23:45.966 A:middle
第一个是

00:23:45.966 --> 00:23:47.736 A:middle
loadBroadcastingApplicationInfo

00:23:47.736 --> 00:23:48.646 A:middle
第二个是

00:23:48.826 --> 00:23:50.236 A:middle
completeRequest 带有

00:23:50.236 --> 00:23:52.436 A:middle
broadcastURL 和 setupInfo

00:23:54.636 --> 00:23:57.066 A:middle
第一个

00:23:57.066 --> 00:23:58.696 A:middle
用来获取

00:23:58.696 --> 00:23:59.976 A:middle
App 的名字和图标

00:23:59.976 --> 00:24:01.246 A:middle
这有一个例子

00:23:59.976 --> 00:24:01.246 A:middle
这有一个例子

00:24:01.246 --> 00:24:03.346 A:middle
告诉你们如何做

00:24:03.346 --> 00:24:04.146 A:middle
并把信息传递给

00:24:04.146 --> 00:24:05.076 A:middle
直播进程

00:24:07.486 --> 00:24:10.666 A:middle
直播服务

00:24:10.666 --> 00:24:13.556 A:middle
得到这些信息时

00:24:13.826 --> 00:24:15.576 A:middle
就可以识别直播进程

00:24:15.576 --> 00:24:17.566 A:middle
创建通道

00:24:17.566 --> 00:24:20.046 A:middle
创造像这样

00:24:20.046 --> 00:24:21.916 A:middle
简单而直观的

00:24:22.136 --> 00:24:22.746 A:middle
用户体验

00:24:23.156 --> 00:24:24.556 A:middle
观众到 App 上

00:24:24.556 --> 00:24:26.886 A:middle
可以看到 App 的

00:24:26.926 --> 00:24:27.846 A:middle
图标和名字

00:24:32.436 --> 00:24:34.676 A:middle
当你上载完这个图标

00:24:34.676 --> 00:24:36.866 A:middle
并收集了所有

00:24:36.866 --> 00:24:37.896 A:middle
开始直播

00:24:37.896 --> 00:24:40.206 A:middle
所需信息之后

00:24:40.206 --> 00:24:41.876 A:middle
就该调入第二个

00:24:41.876 --> 00:24:44.246 A:middle
completeRequest 带有

00:24:44.246 --> 00:24:46.026 A:middle
broadcastURL 和 setupInfo

00:24:47.136 --> 00:24:48.766 A:middle
broadcastURL

00:24:48.766 --> 00:24:49.806 A:middle
对客户端 App 来说

00:24:49.806 --> 00:24:51.306 A:middle
可以作为

00:24:51.306 --> 00:24:54.276 A:middle
broadcastController 的属性

00:24:54.476 --> 00:24:56.926 A:middle
setupInfo 是你在扩展中

00:24:56.926 --> 00:24:58.586 A:middle
创建的一个字典

00:24:58.586 --> 00:25:00.146 A:middle
当直播开始时

00:24:58.586 --> 00:25:00.146 A:middle
当直播开始时

00:25:00.146 --> 00:25:01.836 A:middle
所有从用户那

00:25:01.836 --> 00:25:03.386 A:middle
收集到的信息

00:25:03.386 --> 00:25:04.746 A:middle
都放进字典

00:25:04.746 --> 00:25:06.266 A:middle
并传送至上载扩展

00:25:07.096 --> 00:25:08.786 A:middle
你应该随时给

00:25:08.786 --> 00:25:10.096 A:middle
用户提供

00:25:10.096 --> 00:25:11.456 A:middle
停止直播的选项

00:25:11.456 --> 00:25:12.326 A:middle
你只需要用以前的

00:25:12.326 --> 00:25:14.516 A:middle
extensionContext 的

00:25:14.516 --> 00:25:16.066 A:middle
cancelRequest 方法

00:25:17.926 --> 00:25:20.266 A:middle
现在我们讲讲

00:25:20.266 --> 00:25:20.886 A:middle
Upload 扩展

00:25:21.836 --> 00:25:24.666 A:middle
我说过 它的功能是

00:25:25.046 --> 00:25:27.446 A:middle
接收 ReplayKit 实时传送的

00:25:27.446 --> 00:25:29.346 A:middle
媒体信息

00:25:30.686 --> 00:25:32.616 A:middle
编码 创建一个视频流

00:25:32.616 --> 00:25:35.196 A:middle
并上载到

00:25:35.196 --> 00:25:36.126 A:middle
直播服务

00:25:39.736 --> 00:25:41.786 A:middle
如果你用 Xcode 模板

00:25:41.786 --> 00:25:43.516 A:middle
创新一个新的 Upload 扩展

00:25:43.516 --> 00:25:44.746 A:middle
你会在你的 Xcode project 里

00:25:44.746 --> 00:25:46.196 A:middle
发现一个这样的

00:25:46.196 --> 00:25:47.986 A:middle
sampleHandler 类

00:25:47.986 --> 00:25:49.996 A:middle
它可以重写一些功能

00:25:49.996 --> 00:25:51.076 A:middle
管理

00:25:51.076 --> 00:25:53.656 A:middle
直播开始 停止

00:25:53.816 --> 00:25:54.846 A:middle
暂停或者恢复

00:25:55.136 --> 00:25:57.016 A:middle
还有一个功能叫

00:25:57.246 --> 00:25:59.706 A:middle
processSampleBuffer

00:25:59.706 --> 00:26:01.026 A:middle
要管理

00:25:59.706 --> 00:26:01.026 A:middle
要管理

00:26:01.026 --> 00:26:03.276 A:middle
引入的媒体样本

00:26:03.276 --> 00:26:04.146 A:middle
就要重写它

00:26:04.766 --> 00:26:06.226 A:middle
这就是最

00:26:06.226 --> 00:26:06.706 A:middle
奇妙的地方

00:26:06.706 --> 00:26:08.126 A:middle
你在这里编码

00:26:08.126 --> 00:26:08.856 A:middle
和上载

00:26:11.556 --> 00:26:15.806 A:middle
当直播开始时

00:26:15.956 --> 00:26:18.826 A:middle
ReplayKit 通知扩展

00:26:18.826 --> 00:26:20.356 A:middle
要向它提供

00:26:20.356 --> 00:26:23.936 A:middle
媒体样本

00:26:23.936 --> 00:26:25.516 A:middle
ReplayKit 使用一个叫

00:26:25.516 --> 00:26:27.706 A:middle
broadcastStarted with setupInfo

00:26:28.406 --> 00:26:28.956 A:middle
的功能来完成这个

00:26:29.026 --> 00:26:30.986 A:middle
这有个例子告诉你

00:26:30.986 --> 00:26:33.146 A:middle
你接收到一个 setupInfo

00:26:33.146 --> 00:26:35.266 A:middle
作为功能的变元

00:26:35.266 --> 00:26:37.166 A:middle
你可以从字典里

00:26:37.166 --> 00:26:38.876 A:middle
提取直播的名字

00:26:38.876 --> 00:26:40.206 A:middle
并传输到

00:26:40.206 --> 00:26:42.406 A:middle
直播进程

00:26:42.406 --> 00:26:43.796 A:middle
或者 万一直播从已经

00:26:43.796 --> 00:26:45.076 A:middle
控制中心开始了

00:26:45.076 --> 00:26:46.566 A:middle
你可以让直播进程

00:26:46.566 --> 00:26:46.936 A:middle
知道这一点

00:26:47.086 --> 00:26:51.676 A:middle
现在 我们来了解一下

00:26:51.946 --> 00:26:53.256 A:middle
processSampleBuffer 功能

00:26:53.656 --> 00:26:55.546 A:middle
ReplayKit 给扩展

00:26:55.546 --> 00:26:56.706 A:middle
提供三种类型的

00:26:56.706 --> 00:26:57.256 A:middle
媒体样本

00:26:59.456 --> 00:27:01.186 A:middle
从屏幕捕捉的

00:26:59.456 --> 00:27:01.186 A:middle
从屏幕捕捉的

00:27:01.186 --> 00:27:01.716 A:middle
视频样本

00:27:02.226 --> 00:27:03.976 A:middle
从 App 捕捉的音频样本

00:27:03.976 --> 00:27:05.426 A:middle
这就是你的 App 刚刚

00:27:05.426 --> 00:27:07.216 A:middle
直播的

00:27:07.216 --> 00:27:07.846 A:middle
音频样本

00:27:07.846 --> 00:27:09.686 A:middle
还有从麦克风捕捉的

00:27:09.686 --> 00:27:10.526 A:middle
音频样本

00:27:10.526 --> 00:27:14.236 A:middle
你可以使用任意一种技术

00:27:14.236 --> 00:27:16.066 A:middle
来编码这个媒体

00:27:16.066 --> 00:27:17.976 A:middle
但是为了更实用

00:27:17.976 --> 00:27:20.016 A:middle
我们提供一个低级 API

00:27:20.016 --> 00:27:21.536 A:middle
叫 VideoToolbox

00:27:21.536 --> 00:27:22.626 A:middle
它是一个框架

00:27:22.626 --> 00:27:25.756 A:middle
让硬件可以

00:27:25.756 --> 00:27:27.356 A:middle
加速编码

00:27:27.356 --> 00:27:27.816 A:middle
和解码

00:27:29.826 --> 00:27:32.196 A:middle
所有的样本都去到

00:27:32.196 --> 00:27:33.826 A:middle
Upload 扩展

00:27:33.826 --> 00:27:35.646 A:middle
被 processSampleBuffer 功能管理

00:27:39.076 --> 00:27:40.986 A:middle
这个功能会编码

00:27:40.986 --> 00:27:42.296 A:middle
并上载媒体样本

00:27:43.236 --> 00:27:44.566 A:middle
在这个例子里

00:27:44.566 --> 00:27:45.586 A:middle
我们要告诉你如何用

00:27:45.586 --> 00:27:48.166 A:middle
VideoToolbox 来编码

00:27:48.166 --> 00:27:48.616 A:middle
视频样本

00:27:50.536 --> 00:27:51.776 A:middle
在实际代码中

00:27:51.776 --> 00:27:53.676 A:middle
你还需要执行回叫

00:27:53.676 --> 00:27:55.346 A:middle
来接收编码数据

00:27:55.346 --> 00:27:56.286 A:middle
等等

00:27:57.126 --> 00:27:58.506 A:middle
但是在这 我想说一下

00:27:58.506 --> 00:28:00.596 A:middle
VideoToolbox

00:27:58.506 --> 00:28:00.596 A:middle
VideoToolbox

00:28:00.596 --> 00:28:02.286 A:middle
因为它对你在 App 扩展中

00:28:02.286 --> 00:28:03.936 A:middle
进行视频处理时

00:28:03.936 --> 00:28:05.146 A:middle
非常重要

00:28:05.146 --> 00:28:07.136 A:middle
因为 App 扩展

00:28:07.136 --> 00:28:09.306 A:middle
跟编程 App 比

00:28:09.306 --> 00:28:10.756 A:middle
内存限制低很多

00:28:11.706 --> 00:28:13.086 A:middle
能够有硬件

00:28:13.146 --> 00:28:15.326 A:middle
快速视频编码

00:28:15.326 --> 00:28:17.526 A:middle
对 ReplayKit 上载扩展

00:28:17.526 --> 00:28:19.186 A:middle
非常重要

00:28:19.496 --> 00:28:21.136 A:middle
今年 有一个好消息

00:28:21.136 --> 00:28:24.036 A:middle
VideoToolbox 现在

00:28:24.036 --> 00:28:25.626 A:middle
也可以在 tvOS 使用

00:28:25.786 --> 00:28:27.006 A:middle
所以 你为两个平台

00:28:27.006 --> 00:28:28.776 A:middle
都可以创建

00:28:28.776 --> 00:28:29.956 A:middle
优化的高效的扩展

00:28:36.046 --> 00:28:37.076 A:middle
这是一个关于

00:28:37.166 --> 00:28:39.756 A:middle
直播如何运作的高层图

00:28:39.756 --> 00:28:41.296 A:middle
谁执行哪个部分

00:28:43.576 --> 00:28:44.916 A:middle
如果你是游戏开发员

00:28:44.916 --> 00:28:46.366 A:middle
或者客户端 App 开发员

00:28:46.366 --> 00:28:48.036 A:middle
你只需要考虑

00:28:48.036 --> 00:28:50.266 A:middle
展示 ViewController

00:28:50.266 --> 00:28:52.546 A:middle
开始或者停止

00:28:52.546 --> 00:28:56.686 A:middle
直播

00:28:56.686 --> 00:28:59.116 A:middle
你可以执行这个 API

00:28:59.116 --> 00:29:00.786 A:middle
并等进程结束就好了

00:28:59.116 --> 00:29:00.786 A:middle
并等进程结束就好了

00:29:01.996 --> 00:29:03.786 A:middle
如果你是

00:29:03.786 --> 00:29:05.666 A:middle
直播服务开发员

00:29:05.666 --> 00:29:07.036 A:middle
你要做的更多一点

00:29:07.766 --> 00:29:10.566 A:middle
你需要接收这些样本

00:29:10.566 --> 00:29:12.766 A:middle
编码它们 并上载到

00:29:12.766 --> 00:29:13.746 A:middle
直播服务

00:29:17.576 --> 00:29:19.916 A:middle
结束这部分之前

00:29:19.916 --> 00:29:21.486 A:middle
还有一点

00:29:21.486 --> 00:29:23.166 A:middle
需要讲一讲

00:29:23.816 --> 00:29:25.496 A:middle
到目前为止

00:29:25.496 --> 00:29:28.626 A:middle
我们都假设所有的数据

00:29:28.626 --> 00:29:30.386 A:middle
都从 App 流向

00:29:30.386 --> 00:29:32.236 A:middle
线上服务

00:29:32.636 --> 00:29:34.336 A:middle
但是其实也有可能

00:29:34.336 --> 00:29:36.886 A:middle
数据会从线上服务

00:29:36.886 --> 00:29:39.706 A:middle
流回到

00:29:39.706 --> 00:29:40.546 A:middle
App

00:29:40.636 --> 00:29:42.116 A:middle
它可以是观众的反馈

00:29:42.116 --> 00:29:43.826 A:middle
比如观众的评论

00:29:43.826 --> 00:29:45.716 A:middle
或者点赞

00:29:45.716 --> 00:29:47.556 A:middle
或者其他任何数据

00:29:49.776 --> 00:29:51.866 A:middle
为此 我们提供一个 API

00:29:51.866 --> 00:29:53.776 A:middle
帮助你从扩展中

00:29:53.776 --> 00:29:55.246 A:middle
把这些信息

00:29:55.246 --> 00:29:55.976 A:middle
传输到客户 App

00:29:58.476 --> 00:30:01.366 A:middle
你只需要把这些数据

00:29:58.476 --> 00:30:01.366 A:middle
你只需要把这些数据

00:30:01.366 --> 00:30:02.926 A:middle
放到字典里

00:30:02.926 --> 00:30:03.866 A:middle
并从你的扩展中

00:30:04.656 --> 00:30:06.466 A:middle
使用这个叫

00:30:06.466 --> 00:30:07.326 A:middle
updateServiceInfo 的功能

00:30:07.326 --> 00:30:08.626 A:middle
这个字典

00:30:08.626 --> 00:30:10.196 A:middle
对 App 来说可以当作

00:30:10.196 --> 00:30:11.546 A:middle
broadcastController 的

00:30:11.546 --> 00:30:12.146 A:middle
一个属性

00:30:12.376 --> 00:30:13.596 A:middle
这个属性的名字叫

00:30:13.796 --> 00:30:16.536 A:middle
serviceInfo

00:30:16.536 --> 00:30:19.136 A:middle
而且是可以通过 KVO 观察的

00:30:19.136 --> 00:30:21.276 A:middle
所以你可以监控并适时的

00:30:21.276 --> 00:30:22.036 A:middle
更新 UI

00:30:23.346 --> 00:30:24.756 A:middle
这就是关于直播 API

00:30:25.166 --> 00:30:27.086 A:middle
的全部

00:30:27.086 --> 00:30:29.916 A:middle
用这些信息

00:30:29.916 --> 00:30:32.536 A:middle
你可以创建新的

00:30:32.536 --> 00:30:34.576 A:middle
产品

00:30:34.576 --> 00:30:35.706 A:middle
如果你从控制中心

00:30:35.706 --> 00:30:37.116 A:middle
创建了直播

00:30:37.176 --> 00:30:38.686 A:middle
你就可以创建第三方屏幕镜像

00:30:38.686 --> 00:30:41.796 A:middle
视频分享

00:30:41.796 --> 00:30:43.156 A:middle
或者在视频会议中

00:30:43.156 --> 00:30:43.756 A:middle
分享屏幕

00:30:46.086 --> 00:30:47.766 A:middle
谢谢

00:30:47.766 --> 00:30:48.976 A:middle
有请 Johnny 回到

00:30:48.976 --> 00:30:49.336 A:middle
台上

00:30:50.516 --> 00:30:54.396 A:middle
[ 鼓掌 ]

00:30:54.896 --> 00:30:55.996 A:middle
&gt;&gt; 谢谢 Alexander

00:30:56.356 --> 00:30:58.656 A:middle
就像 Alexander 说的

00:30:58.656 --> 00:31:00.626 A:middle
现在的直播 App

00:30:58.656 --> 00:31:00.626 A:middle
现在的直播 App

00:31:00.626 --> 00:31:02.606 A:middle
你需要

00:31:02.606 --> 00:31:04.346 A:middle
给用户提供一个

00:31:04.346 --> 00:31:05.586 A:middle
RPBroadcastActivityViewController

00:31:05.586 --> 00:31:07.066 A:middle
让他们选择

00:31:07.066 --> 00:31:08.526 A:middle
一个公共服务

00:31:08.526 --> 00:31:09.986 A:middle
来直播你的 App

00:31:10.916 --> 00:31:12.966 A:middle
有的时候也许

00:31:12.966 --> 00:31:14.536 A:middle
你不想把你的 App

00:31:14.536 --> 00:31:15.486 A:middle
直播到公共服务

00:31:15.846 --> 00:31:17.856 A:middle
有的时候 你希望

00:31:17.856 --> 00:31:19.506 A:middle
你的 App 使用

00:31:19.506 --> 00:31:20.676 A:middle
你的直播服务

00:31:21.326 --> 00:31:23.016 A:middle
用 ReplayKit 2

00:31:23.016 --> 00:31:24.386 A:middle
和直播配对

00:31:24.386 --> 00:31:24.896 A:middle
你可以做到

00:31:25.766 --> 00:31:27.806 A:middle
直播配对让你可以

00:31:27.886 --> 00:31:29.526 A:middle
完全在你的 App 里

00:31:29.526 --> 00:31:31.576 A:middle
完美地集合

00:31:31.776 --> 00:31:32.706 A:middle
你的整个

00:31:32.706 --> 00:31:33.266 A:middle
流媒体解决方案

00:31:35.076 --> 00:31:36.586 A:middle
我们这有

00:31:36.586 --> 00:31:38.186 A:middle
预算 App

00:31:38.186 --> 00:31:39.466 A:middle
和会议 App

00:31:39.466 --> 00:31:40.676 A:middle
支持 ReplayKit 直播

00:31:40.676 --> 00:31:42.946 A:middle
并执行了

00:31:42.946 --> 00:31:44.016 A:middle
一个直播扩展

00:31:44.976 --> 00:31:46.996 A:middle
我想要把预算 App

00:31:46.996 --> 00:31:48.996 A:middle
单独流式传输到

00:31:48.996 --> 00:31:50.096 A:middle
会议 App 的

00:31:50.096 --> 00:31:51.126 A:middle
直播扩展

00:31:51.726 --> 00:31:53.246 A:middle
因此 我要开启

00:31:53.246 --> 00:31:54.796 A:middle
直播配对

00:31:55.646 --> 00:31:57.666 A:middle
预算 App 要

00:31:57.666 --> 00:31:59.126 A:middle
在 RPActivityViewController 类

00:31:59.126 --> 00:32:00.526 A:middle
加载

00:31:59.126 --> 00:32:00.526 A:middle
加载

00:32:00.706 --> 00:32:02.526 A:middle
优先的扩展

00:32:03.646 --> 00:32:05.076 A:middle
我们会从

00:32:05.076 --> 00:32:06.316 A:middle
RPBroadcastActivityViewController

00:32:06.316 --> 00:32:07.806 A:middle
得到一个实例

00:32:07.806 --> 00:32:09.016 A:middle
和一般直播开启

00:32:09.016 --> 00:32:11.626 A:middle
差不多

00:32:11.626 --> 00:32:13.156 A:middle
但这是直播配对和

00:32:13.156 --> 00:32:14.766 A:middle
一般的直播开始

00:32:14.766 --> 00:32:15.436 A:middle
的主要区别

00:32:15.916 --> 00:32:17.346 A:middle
因为当你

00:32:17.386 --> 00:32:19.586 A:middle
展示 ViewController 时

00:32:19.586 --> 00:32:21.306 A:middle
用户不再会

00:32:21.406 --> 00:32:22.486 A:middle
看到一个选项

00:32:22.486 --> 00:32:24.796 A:middle
让他们选择一个公共服务

00:32:24.796 --> 00:32:26.726 A:middle
而是会看到一个提示

00:32:26.726 --> 00:32:28.156 A:middle
告诉他们

00:32:28.156 --> 00:32:30.066 A:middle
你的 App 要用

00:32:30.116 --> 00:32:32.076 A:middle
某个特定的直播服务

00:32:32.566 --> 00:32:34.316 A:middle
在这里 预算 App

00:32:34.316 --> 00:32:35.156 A:middle
想要流式传输到

00:32:35.156 --> 00:32:36.276 A:middle
会议 App 的

00:32:36.276 --> 00:32:37.366 A:middle
直播服务

00:32:38.076 --> 00:32:39.596 A:middle
当用户选择同意

00:32:40.536 --> 00:32:41.966 A:middle
ReplayKit 会立刻

00:32:41.966 --> 00:32:43.216 A:middle
开启配对直播扩展

00:32:43.216 --> 00:32:45.046 A:middle
让用户输入

00:32:45.046 --> 00:32:47.166 A:middle
任何对直播进程

00:32:47.166 --> 00:32:48.446 A:middle
很重要的

00:32:48.446 --> 00:32:48.796 A:middle
信息

00:32:50.086 --> 00:32:51.196 A:middle
当用户输入完

00:32:51.196 --> 00:32:52.766 A:middle
信息后

00:32:54.076 --> 00:32:55.696 A:middle
ReplayKit 会开始

00:32:55.906 --> 00:32:58.046 A:middle
对配对直播扩展

00:32:58.046 --> 00:32:59.016 A:middle
进行直播

00:32:59.446 --> 00:33:00.966 A:middle
就这样 预算 App

00:32:59.446 --> 00:33:00.966 A:middle
就这样 预算 App

00:33:00.966 --> 00:33:03.046 A:middle
现在就在

00:33:03.046 --> 00:33:04.886 A:middle
单独流式传输到

00:33:04.886 --> 00:33:05.836 A:middle
它的配对直播扩展

00:33:06.366 --> 00:33:08.916 A:middle
让我们来看看

00:33:08.916 --> 00:33:10.196 A:middle
直播配对 API

00:33:10.936 --> 00:33:13.876 A:middle
直播配对 API

00:33:13.876 --> 00:33:14.546 A:middle
很简单

00:33:15.506 --> 00:33:16.936 A:middle
它是

00:33:16.986 --> 00:33:18.386 A:middle
RPBroadcastActivityViewController

00:33:18.386 --> 00:33:19.566 A:middle
的一个新类方法

00:33:19.566 --> 00:33:21.046 A:middle
叫 loadwithPreferredExtension

00:33:21.896 --> 00:33:23.256 A:middle
我们会给你提供一个

00:33:23.256 --> 00:33:23.496 A:middle
broadcastActivityViewController

00:33:23.496 --> 00:33:25.046 A:middle
的实例

00:33:25.136 --> 00:33:26.346 A:middle
用来展示给

00:33:26.346 --> 00:33:26.926 A:middle
你的用户

00:33:28.026 --> 00:33:29.276 A:middle
让我们直接来看一下

00:33:29.276 --> 00:33:30.806 A:middle
关于如何让预算 App

00:33:30.806 --> 00:33:32.066 A:middle
仿效

00:33:32.066 --> 00:33:34.066 A:middle
直播配对

00:33:34.736 --> 00:33:34.886 A:middle
的更多细节

00:33:35.046 --> 00:33:36.366 A:middle
这有个方法

00:33:36.576 --> 00:33:38.266 A:middle
叫 didPressBroadcastPairButton

00:33:38.826 --> 00:33:40.536 A:middle
在里面

00:33:40.536 --> 00:33:40.816 A:middle
我只需要

00:33:40.816 --> 00:33:42.936 A:middle
在 RPBroadcastActivity ViewController 类

00:33:42.936 --> 00:33:44.756 A:middle
调入

00:33:44.756 --> 00:33:45.316 A:middle
LoadwithPreferredExtension

00:33:45.976 --> 00:33:47.206 A:middle
我们会得到一个

00:33:47.206 --> 00:33:48.956 A:middle
RPBroadcastActivityViewController

00:33:48.956 --> 00:33:49.966 A:middle
的实例

00:33:50.316 --> 00:33:52.106 A:middle
当我们

00:33:52.106 --> 00:33:54.456 A:middle
给用户显示一个提醒

00:33:54.456 --> 00:33:55.746 A:middle
告诉他们

00:33:55.746 --> 00:33:57.086 A:middle
我的 App 希望使用

00:33:57.086 --> 00:33:58.936 A:middle
某一个特定的直播服务时

00:33:59.616 --> 00:34:01.286 A:middle
一旦用户同意

00:33:59.616 --> 00:34:01.286 A:middle
一旦用户同意

00:34:01.286 --> 00:34:02.386 A:middle
ReplayKit 会处理剩下的事情

00:34:02.536 --> 00:34:05.166 A:middle
并开启配对的

00:34:05.166 --> 00:34:05.836 A:middle
直播扩展

00:34:09.235 --> 00:34:10.636 A:middle
直播配对

00:34:10.636 --> 00:34:11.826 A:middle
是为了让

00:34:11.826 --> 00:34:13.356 A:middle
直播 App

00:34:13.356 --> 00:34:15.136 A:middle
和直播服务

00:34:15.136 --> 00:34:15.576 A:middle
紧密配对

00:34:16.065 --> 00:34:18.576 A:middle
所以开启一个

00:34:18.576 --> 00:34:20.226 A:middle
直播配对进程

00:34:20.226 --> 00:34:22.106 A:middle
开发者要提供

00:34:22.106 --> 00:34:23.596 A:middle
一个 bundleID

00:34:23.596 --> 00:34:24.056 A:middle
给直播扩展

00:34:25.085 --> 00:34:26.926 A:middle
用户也需要

00:34:26.926 --> 00:34:28.746 A:middle
通过提示同意直播配对

00:34:28.746 --> 00:34:30.346 A:middle
每次当你想开启

00:34:30.416 --> 00:34:32.096 A:middle
直播配对进程时

00:34:32.096 --> 00:34:33.235 A:middle
提示都会出现

00:34:35.065 --> 00:34:37.036 A:middle
直播配对让你可以

00:34:37.036 --> 00:34:38.906 A:middle
在你的 App 里

00:34:38.906 --> 00:34:40.565 A:middle
完美集合你的

00:34:40.565 --> 00:34:41.386 A:middle
整个流媒体解决方案

00:34:43.896 --> 00:34:46.005 A:middle
我们现在知道了

00:34:46.005 --> 00:34:47.726 A:middle
以用户评论录制回放和直播

00:34:47.726 --> 00:34:49.716 A:middle
对于吸引新用户

00:34:49.716 --> 00:34:51.746 A:middle
到你的 App

00:34:51.746 --> 00:34:53.656 A:middle
和围绕 App

00:34:53.656 --> 00:34:55.036 A:middle
创建一个社区

00:34:55.036 --> 00:34:55.835 A:middle
是非常有用的

00:34:56.856 --> 00:34:57.996 A:middle
这是为什么 去年我们

00:34:57.996 --> 00:34:59.476 A:middle
引入了 ReplayKit

00:34:59.476 --> 00:35:00.086 A:middle
前置摄像头支持

00:34:59.476 --> 00:35:00.086 A:middle
前置摄像头支持

00:35:00.466 --> 00:35:01.846 A:middle
这也是为什么 今年

00:35:01.846 --> 00:35:03.826 A:middle
我们为 ReplayKit 2 引入了

00:35:03.826 --> 00:35:07.246 A:middle
快速摄像头转换

00:35:07.366 --> 00:35:09.256 A:middle
这让你可以在

00:35:09.256 --> 00:35:11.586 A:middle
RPScreenRecorder 的

00:35:11.586 --> 00:35:13.196 A:middle
cameraPreviewView 里

00:35:13.196 --> 00:35:15.006 A:middle
改变摄像头来源

00:35:15.006 --> 00:35:16.606 A:middle
选择前置摄像头或者

00:35:16.606 --> 00:35:16.946 A:middle
后置摄像头

00:35:18.066 --> 00:35:19.606 A:middle
RPScreenRecorder 里的

00:35:19.606 --> 00:35:21.406 A:middle
cameraPreviewView

00:35:21.406 --> 00:35:23.356 A:middle
是 UIView 的一个子类

00:35:23.356 --> 00:35:24.656 A:middle
所以可以添加到几乎任何 App

00:35:25.936 --> 00:35:27.656 A:middle
开发者要负责

00:35:27.656 --> 00:35:29.846 A:middle
让用户调出或者取消

00:35:29.846 --> 00:35:31.476 A:middle
cameraPreviewViewcamera

00:35:31.646 --> 00:35:33.126 A:middle
的 UI 元素

00:35:33.126 --> 00:35:35.566 A:middle
以及让用户转换

00:35:35.566 --> 00:35:36.806 A:middle
cameraPreviewView 的UI元素

00:35:37.836 --> 00:35:39.156 A:middle
让我们看一看

00:35:39.156 --> 00:35:40.546 A:middle
快速摄像头转换

00:35:40.546 --> 00:35:40.856 A:middle
的 API

00:35:42.376 --> 00:35:43.836 A:middle
快速摄像头转换

00:35:43.836 --> 00:35:45.236 A:middle
的 API 很简单

00:35:45.536 --> 00:35:47.266 A:middle
它包含 RPScreenRecorder 里的

00:35:47.266 --> 00:35:48.756 A:middle
一个新的属性

00:35:48.756 --> 00:35:50.966 A:middle
叫 cameraPosition

00:35:50.966 --> 00:35:52.486 A:middle
用来记录 sharedRecorder 单例

00:35:52.536 --> 00:35:54.016 A:middle
的目前摄像头位置

00:35:54.956 --> 00:35:56.826 A:middle
CameraPosition 是一个

00:35:56.906 --> 00:35:58.886 A:middle
列举 RPCameraPosition

00:35:59.076 --> 00:36:01.196 A:middle
包含 RPCameraPosition front

00:35:59.076 --> 00:36:01.196 A:middle
包含 RPCameraPosition front

00:36:01.346 --> 00:36:03.256 A:middle
和 RPCameraPosition back

00:36:03.256 --> 00:36:04.486 A:middle
分别用于前置摄像头

00:36:04.486 --> 00:36:05.556 A:middle
和后置摄像头

00:36:06.516 --> 00:36:07.536 A:middle
现在我们直接通过

00:36:07.536 --> 00:36:08.756 A:middle
一个例子来看一下 如何开始

00:36:08.756 --> 00:36:12.156 A:middle
使用快速摄像头转换

00:36:12.296 --> 00:36:13.936 A:middle
看 照片在小屏幕上

00:36:13.936 --> 00:36:15.806 A:middle
看起来好多了

00:36:16.426 --> 00:36:17.656 A:middle
我们这有一个功能

00:36:17.656 --> 00:36:18.456 A:middle
叫 showPreviewView

00:36:19.036 --> 00:36:20.356 A:middle
在里面 我们只需要

00:36:20.356 --> 00:36:21.546 A:middle
在 RPScreenRecorder

00:36:21.546 --> 00:36:23.256 A:middle
抓取这个 sharedRecorder 单例

00:36:23.756 --> 00:36:25.056 A:middle
然后 我要从

00:36:25.056 --> 00:36:26.826 A:middle
sharedRecorder 单例

00:36:26.826 --> 00:36:28.296 A:middle
抓取 cameraPreviewView

00:36:28.696 --> 00:36:29.856 A:middle
因为 sharedRecorder 单例

00:36:29.856 --> 00:36:32.126 A:middle
和它的 cameraView

00:36:32.126 --> 00:36:33.856 A:middle
是 UIView 的一个子类

00:36:33.856 --> 00:36:35.396 A:middle
我只要把把它作为 subview

00:36:35.396 --> 00:36:36.676 A:middle
添加到我 App 的 view 里

00:36:37.476 --> 00:36:38.926 A:middle
就这样 我们现在

00:36:38.926 --> 00:36:40.786 A:middle
在使用 cameraPreviewView

00:36:40.786 --> 00:36:42.646 A:middle
和前摄像头

00:36:42.646 --> 00:36:43.426 A:middle
来录制视频评论

00:36:44.366 --> 00:36:45.626 A:middle
现在让我们看看

00:36:45.626 --> 00:36:46.836 A:middle
如何使用

00:36:46.836 --> 00:36:47.406 A:middle
快速摄像头转换

00:36:49.156 --> 00:36:50.676 A:middle
有一个方法

00:36:50.676 --> 00:36:52.066 A:middle
叫 didPressCameraSwitch

00:36:52.326 --> 00:36:53.786 A:middle
再一次 我要从

00:36:53.786 --> 00:36:55.896 A:middle
RPScreenRecorder 抓取

00:36:55.896 --> 00:36:56.846 A:middle
sharedRecorder 单例

00:36:57.526 --> 00:36:58.876 A:middle
我很想知道

00:36:58.876 --> 00:37:00.326 A:middle
现在的 cameraPosition

00:36:58.876 --> 00:37:00.326 A:middle
现在的 cameraPosition

00:37:00.326 --> 00:37:00.576 A:middle
是什么

00:37:00.736 --> 00:37:01.876 A:middle
在我们的这个方法里

00:37:02.336 --> 00:37:03.356 A:middle
我们要看一下

00:37:03.356 --> 00:37:04.616 A:middle
现在的 cameraPosition 是什么

00:37:04.896 --> 00:37:06.096 A:middle
无论是什么

00:37:06.096 --> 00:37:07.236 A:middle
我都要把它换成相反的

00:37:07.486 --> 00:37:09.116 A:middle
我们可以看到

00:37:09.116 --> 00:37:10.196 A:middle
sharedRecorder 的

00:37:10.196 --> 00:37:11.456 A:middle
cameraPosition 使用的是

00:37:11.456 --> 00:37:12.996 A:middle
RPCameraPosition.front

00:37:13.456 --> 00:37:14.536 A:middle
只需要把

00:37:14.536 --> 00:37:16.336 A:middle
shareRecorder 的 cameraPosition

00:37:16.436 --> 00:37:18.086 A:middle
设为 RPCameraPosition.back

00:37:18.876 --> 00:37:20.516 A:middle
这样 我们的 PreviewView

00:37:20.516 --> 00:37:21.556 A:middle
使用的就是

00:37:21.556 --> 00:37:23.096 A:middle
后摄像头了

00:37:23.936 --> 00:37:26.506 A:middle
就这么容易

00:37:26.506 --> 00:37:28.306 A:middle
这么快

00:37:29.566 --> 00:37:31.756 A:middle
快速摄像头转换

00:37:31.756 --> 00:37:33.616 A:middle
让你可以给用户提供

00:37:33.616 --> 00:37:35.126 A:middle
更多的工具

00:37:35.126 --> 00:37:36.936 A:middle
让他们可以用

00:37:36.936 --> 00:37:37.966 A:middle
在你的 App 里制作的内容

00:37:37.966 --> 00:37:38.546 A:middle
来创造更多的视频评论

00:37:40.616 --> 00:37:42.956 A:middle
我们今天讲了很多

00:37:43.216 --> 00:37:44.336 A:middle
所以让我们来

00:37:44.336 --> 00:37:45.106 A:middle
回顾一下

00:37:45.656 --> 00:37:47.686 A:middle
在 ReplayKit 2 里

00:37:47.956 --> 00:37:49.676 A:middle
我们介绍了 App 内视频捕捉

00:37:49.676 --> 00:37:51.556 A:middle
是一个强大的新 API

00:37:51.556 --> 00:37:53.826 A:middle
让你可以直接

00:37:53.826 --> 00:37:55.776 A:middle
从 ReplayKit 访问

00:37:56.186 --> 00:37:58.066 A:middle
你的 App 的音频

00:37:58.156 --> 00:37:59.236 A:middle
视频和麦克风内容

00:38:00.816 --> 00:38:02.506 A:middle
用 iOS 屏幕录制和直播

00:38:02.506 --> 00:38:04.736 A:middle
用户可以直接从

00:38:04.956 --> 00:38:07.236 A:middle
控制中心

00:38:07.236 --> 00:38:09.176 A:middle
录制和直播他们的整个

00:38:09.176 --> 00:38:09.746 A:middle
iOS 屏幕体验

00:38:11.626 --> 00:38:13.046 A:middle
我们介绍了直播配对

00:38:13.256 --> 00:38:15.026 A:middle
让你可以在自己的 App 里

00:38:15.026 --> 00:38:16.566 A:middle
集合整个

00:38:16.566 --> 00:38:17.976 A:middle
流媒体解决方案

00:38:19.766 --> 00:38:21.756 A:middle
最后 用快速摄像头转换

00:38:21.756 --> 00:38:23.166 A:middle
你将有更多的工具

00:38:23.166 --> 00:38:24.996 A:middle
提供给你的用户

00:38:25.126 --> 00:38:26.596 A:middle
来创造更多吸引人的

00:38:26.596 --> 00:38:27.106 A:middle
视频评论

00:38:28.856 --> 00:38:30.256 A:middle
想了解更多关于今天课程的内容

00:38:30.256 --> 00:38:31.546 A:middle
请访问

00:38:31.546 --> 00:38:33.036 A:middle
developer.apple.com

00:38:33.096 --> 00:38:34.856 A:middle
我们是第 606 课程

00:38:35.316 --> 00:38:36.286 A:middle
希望你们享受

00:38:36.356 --> 00:38:37.076 A:middle
WWDC

00:38:37.396 --> 00:38:37.716 A:middle
谢谢
