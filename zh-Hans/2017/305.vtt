WEBVTT

00:00:17.784 --> 00:00:19.219 align:middle line:10%
<c.magenta>大家下午好</c>

00:00:19.286 --> 00:00:23.357 align:middle line:10%
<c.magenta>（STOREKIT收条验证</c>
<c.magenta>与订阅进阶知识）</c>

00:00:23.423 --> 00:00:26.760 align:middle line:90%,end
<c.magenta>我是Pete Hare</c>
<c.magenta>是App Store团队成员</c>

00:00:27.294 --> 00:00:30.364 align:middle line:90%,end
<c.magenta>你们可能来自于不同的群体</c>

00:00:30.430 --> 00:00:34.101 align:middle line:90%,end
<c.magenta>想要更多地了解</c>
<c.magenta>如何将程序内购买</c>

00:00:34.168 --> 00:00:35.836 align:middle line:90%,end
<c.magenta>集成到你的应用之中</c>

00:00:35.903 --> 00:00:38.338 align:middle line:90%,end
<c.magenta>并且安全和可靠地做到这一点</c>

00:00:38.605 --> 00:00:41.208 align:middle line:90%,end
<c.magenta>或许你们想了解订阅</c>

00:00:41.275 --> 00:00:44.611 align:middle line:90%,end
<c.magenta>并且想知道</c>
<c.magenta>服务器环境中的</c>

00:00:44.678 --> 00:00:47.347 align:middle line:90%,end
<c.magenta>跨平台订阅状态维护流程</c>

00:00:47.414 --> 00:00:48.348 align:middle line:90%,end
<c.magenta>诸如此类</c>

00:00:48.882 --> 00:00:52.319 align:middle line:90%,end
<c.magenta>无论你身处哪个群体</c>
<c.magenta>程序内购买都代表</c>

00:00:52.386 --> 00:00:54.955 align:middle line:90%,end
<c.magenta>你和用户之间的信任</c>

00:00:55.389 --> 00:00:59.359 align:middle line:90%,end
<c.magenta>当用户花钱购买数字内容或服务时</c>

00:00:59.426 --> 00:01:03.931 align:middle line:90%,end
<c.magenta>他们相信你能够</c>

00:00:59.426 --> 00:01:03.931 align:middle line:90%,end
<c.magenta>他们相信你能够</c>

00:01:03.997 --> 00:01:05.632 align:middle line:90%,end
<c.magenta>安全可靠地交付这些服务和内容</c>

00:01:06.533 --> 00:01:09.536 align:middle line:90%,end
<c.magenta>今天我会讨论这方面的一些技术</c>

00:01:09.603 --> 00:01:12.506 align:middle line:90%,end
<c.magenta>首先 我们会详细讨论收条验证</c>

00:01:12.573 --> 00:01:15.242 align:middle line:90%,end
<c.magenta>今天上午的演讲已经简要讲到这个主题</c>

00:01:15.309 --> 00:01:17.911 align:middle line:90%,end
<c.magenta>我们将会详细介绍</c>

00:01:17.978 --> 00:01:19.079 align:middle line:90%,end
<c.magenta>如何在用户的设备在完成这些工作</c>

00:01:19.680 --> 00:01:22.616 align:middle line:90%,end
<c.magenta>我们还会讨论如何维护订阅状态</c>

00:01:22.683 --> 00:01:25.452 align:middle line:90%,end
<c.magenta>尤其是在服务器上</c>
<c.magenta>以及如何根据订阅状态</c>

00:01:25.519 --> 00:01:28.422 align:middle line:90%,end
<c.magenta>更新不同的平台</c>

00:01:29.556 --> 00:01:32.359 align:middle line:90%,end
<c.magenta>最后我们会简单讲述</c>
<c.magenta>沙盒环境下的开发</c>

00:01:32.426 --> 00:01:35.028 align:middle line:90%,end
<c.magenta>在进行开发时</c>
<c.magenta>如何使用这些技术</c>

00:01:35.095 --> 00:01:37.231 align:middle line:90%,end
<c.magenta>而不必自己花钱</c>

00:01:38.465 --> 00:01:39.466 align:middle line:90%,end
<c.magenta>让我们来看这张图</c>

00:01:39.533 --> 00:01:41.034 align:middle line:90%,end
<c.magenta>在今天上午的演讲上</c>
<c.magenta>我们见过这张图</c>

00:01:41.101 --> 00:01:43.270 align:middle line:90%,end
<c.magenta>这是程序内购买流程</c>

00:01:43.337 --> 00:01:45.038 align:middle line:90%,end
<c.magenta>你需要在程序中实现这个流程</c>

00:01:45.105 --> 00:01:47.875 align:middle line:90%,end
<c.magenta>以销售程序内购买物品</c>

00:01:48.342 --> 00:01:49.343 align:middle line:90%,end
<c.magenta>在这个演讲中</c>

00:01:49.409 --> 00:01:52.012 align:middle line:90%,end
<c.magenta>我们将重点讨论最后三个环节</c>

00:01:52.079 --> 00:01:54.381 align:middle line:90%,end
<c.magenta>我将它们称为处理交易</c>

00:01:54.448 --> 00:01:56.683 align:middle line:90%,end
<c.magenta>StoreKit发送一个交易给你时</c>

00:01:56.750 --> 00:01:59.820 align:middle line:90%,end
<c.magenta>用户付款之后</c>
<c.magenta>你需要处理交易</c>

00:01:59.887 --> 00:02:03.490 align:middle line:90%,end
<c.magenta>然后交付用户所购买的内容</c>

00:01:59.887 --> 00:02:03.490 align:middle line:90%,end
<c.magenta>然后交付用户所购买的内容</c>

00:02:03.657 --> 00:02:05.893 align:middle line:90%,end
<c.magenta>现在我将扩展这些步骤</c>

00:02:05.959 --> 00:02:09.663 align:middle line:90%,end
<c.magenta>我将引入一个附加层</c>
<c.magenta>也就是将你的服务器加入进来</c>

00:02:10.531 --> 00:02:12.866 align:middle line:90%,end
<c.magenta>本演讲的内容就是这些</c>

00:02:12.933 --> 00:02:15.936 align:middle line:90%,end
<c.magenta>流程是这样的</c>
<c.magenta>首先我们收到一个交易</c>

00:02:16.303 --> 00:02:18.705 align:middle line:90%,end
<c.magenta>这个交易通过StoreKit</c>
<c.magenta>到达用户设备</c>

00:02:19.339 --> 00:02:22.042 align:middle line:90%,end
<c.magenta>然后你选择是否</c>

00:02:22.109 --> 00:02:24.745 align:middle line:90%,end
<c.magenta>想要在用户的设备或服务器上验证收条</c>

00:02:26.713 --> 00:02:30.050 align:middle line:90%,end
<c.magenta>然后 你检查收条的内容</c>

00:02:30.384 --> 00:02:32.619 align:middle line:90%,end
<c.magenta>解锁内容或者</c>
<c.magenta>在内容的基础上</c>

00:02:32.686 --> 00:02:34.588 align:middle line:90%,end
<c.magenta>更新订阅状态</c>

00:02:34.855 --> 00:02:36.290 align:middle line:90%,end
<c.magenta>此流程的最后一步是</c>

00:02:36.356 --> 00:02:39.860 align:middle line:90%,end
<c.magenta>回到用户的设备上完结交易</c>

00:02:40.861 --> 00:02:44.131 align:middle line:90%,end
<c.magenta>现在你注意到</c>
<c.magenta>这个流程的第一和最后部分</c>

00:02:44.198 --> 00:02:45.933 align:middle line:90%,end
<c.magenta>在设备级别上完成</c>

00:02:45.999 --> 00:02:48.602 align:middle line:90%,end
<c.magenta>我们不允许交易进入服务器级别</c>

00:02:48.669 --> 00:02:49.570 align:middle line:90%,end
<c.magenta>这一点很重要</c>

00:02:49.636 --> 00:02:52.673 align:middle line:90%,end
<c.magenta>即使你使用服务端流程</c>
<c.magenta>进行收条验证</c>

00:02:52.739 --> 00:02:55.442 align:middle line:90%,end
<c.magenta>也必须确保</c>
<c.magenta>在用户的设备上</c>

00:02:55.509 --> 00:02:56.777 align:middle line:90%,end
<c.magenta>接收和完结交易</c>

00:02:58.745 --> 00:03:00.347 align:middle line:90%,end
<c.magenta>今天上午</c>

00:02:58.745 --> 00:03:00.347 align:middle line:90%,end
<c.magenta>今天上午</c>

00:03:00.414 --> 00:03:02.549 align:middle line:90%,end
<c.magenta>我们讨论了四种</c>
<c.magenta>不同类型的程序内购买</c>

00:03:03.050 --> 00:03:05.919 align:middle line:90%,end
<c.magenta>如果你处理消费类产品或非消费类产品</c>

00:03:05.986 --> 00:03:07.855 align:middle line:90%,end
<c.magenta>你将需要执行这样的流程</c>

00:03:07.921 --> 00:03:09.590 align:middle line:90%,end
<c.magenta>这是在设备上执行的流程</c>

00:03:09.656 --> 00:03:12.326 align:middle line:90%,end
<c.magenta>你在设备上检查收条和解锁内容</c>

00:03:12.392 --> 00:03:15.996 align:middle line:90%,end
<c.magenta>而不会发送任何内容到服务器</c>
<c.magenta>或处理网络请求</c>

00:03:16.563 --> 00:03:17.865 align:middle line:90%,end
<c.magenta>如果你处理订阅、</c>

00:03:17.931 --> 00:03:19.800 align:middle line:90%,end
<c.magenta>尤其是自动续约订阅</c>

00:03:19.867 --> 00:03:22.269 align:middle line:90%,end
<c.magenta>你将需要</c>

00:03:22.336 --> 00:03:24.538 align:middle line:90%,end
<c.magenta>在服务器上保留状态</c>

00:03:24.605 --> 00:03:28.041 align:middle line:90%,end
<c.magenta>你需要服务器能够更新多台设备</c>

00:03:28.575 --> 00:03:31.245 align:middle line:90%,end
<c.magenta>当然你可以使用这些技术</c>

00:03:31.912 --> 00:03:33.981 align:middle line:90%,end
<c.magenta>但无论哪些方法</c>
<c.magenta>流程都起始于同一个步骤</c>

00:03:34.047 --> 00:03:36.683 align:middle line:90%,end
<c.magenta>也就是在设备上接收交易</c>

00:03:36.750 --> 00:03:40.187 align:middle line:90%,end
<c.magenta>让我们来看每个步骤</c>

00:03:43.123 --> 00:03:45.659 align:middle line:90%,end
<c.magenta>这是我的应用的生命周期起点</c>

00:03:46.159 --> 00:03:48.328 align:middle line:90%,end
<c.magenta>我们创建应用方法</c>

00:03:48.395 --> 00:03:49.830 align:middle line:90%,end
<c.magenta>此方法含有did finish launching参数</c>

00:03:49.897 --> 00:03:51.798 align:middle line:90%,end
<c.magenta>并且注册一个</c>
<c.magenta>SKPaymentQueue</c>

00:03:51.865 --> 00:03:53.500 align:middle line:90%,end
<c.magenta>交易观察器</c>

00:03:53.567 --> 00:03:56.270 align:middle line:90%,end
<c.magenta>需要在程序生命周期的早期</c>

00:03:56.336 --> 00:03:58.939 align:middle line:90%,end
<c.magenta>注册这个交易观察器</c>
<c.magenta>然后你通过StoreKit</c>

00:03:59.006 --> 00:04:01.642 align:middle line:90%,end
<c.magenta>接收经过更新的交易</c>

00:03:59.006 --> 00:04:01.642 align:middle line:90%,end
<c.magenta>接收经过更新的交易</c>

00:04:01.975 --> 00:04:03.777 align:middle line:90%,end
<c.magenta>这里我增加AppDelegate</c>

00:04:03.844 --> 00:04:05.946 align:middle line:90%,end
<c.magenta>作为支付观察器</c>

00:04:06.013 --> 00:04:08.849 align:middle line:90%,end
<c.magenta>你也可以添加一个单独的控制器对象</c>

00:04:09.116 --> 00:04:10.984 align:middle line:90%,end
<c.magenta>重要的是</c>
<c.magenta>必须在程序生命周期的早期</c>

00:04:11.051 --> 00:04:12.753 align:middle line:90%,end
<c.magenta>完成这些工作</c>

00:04:12.819 --> 00:04:16.890 align:middle line:90%,end
<c.magenta>注册之后 就可以</c>

00:04:16.957 --> 00:04:18.992 align:middle line:90%,end
<c.magenta>开始通过更新交易回调</c>
<c.magenta>接收交易</c>

00:04:19.526 --> 00:04:23.197 align:middle line:90%,end
<c.magenta>就是交易观察器中的</c>
<c.magenta>更新交易回调</c>

00:04:23.897 --> 00:04:26.800 align:middle line:90%,end
<c.magenta>你收到一个交易数组</c>
<c.magenta>可以迭代这个数组</c>

00:04:26.900 --> 00:04:29.336 align:middle line:90%,end
<c.magenta>可以检查每个交易的</c>
<c.magenta>交易状态</c>

00:04:29.403 --> 00:04:31.538 align:middle line:90%,end
<c.magenta>你需要查看处于购买状态的交易</c>

00:04:31.605 --> 00:04:34.675 align:middle line:90%,end
<c.magenta>StoreKit认为</c>

00:04:34.741 --> 00:04:37.811 align:middle line:90%,end
<c.magenta>你可以验证交易</c>
<c.magenta>然后解锁内容</c>

00:04:37.878 --> 00:04:40.814 align:middle line:90%,end
<c.magenta>它告诉用户已经付款</c>

00:04:42.749 --> 00:04:44.818 align:middle line:90%,end
<c.magenta>获得处于购买状态的交易之后</c>

00:04:44.885 --> 00:04:47.654 align:middle line:90%,end
<c.magenta>你准备进行这个图表中的下一步处理</c>

00:04:47.855 --> 00:04:51.358 align:middle line:90%,end
<c.magenta>让我们首先来看</c>
<c.magenta>如何在用户设备上</c>

00:04:51.425 --> 00:04:52.893 align:middle line:90%,end
<c.magenta>进行收条验证</c>

00:04:53.260 --> 00:04:54.828 align:middle line:90%,end
<c.magenta>那么收条是什么？</c>

00:04:54.895 --> 00:04:56.196 align:middle line:90%,end
<c.magenta>今天上午我们已经讲过</c>

00:04:56.263 --> 00:04:57.698 align:middle line:90%,end
<c.magenta>但你们一些人可能没参加那个演讲</c>

00:04:57.764 --> 00:04:59.433 align:middle line:90%,end
<c.magenta>收条就像是文件</c>

00:04:59.499 --> 00:05:01.468 align:middle line:90%,end
<c.magenta>就像百货商店开出的收据一样</c>

00:04:59.499 --> 00:05:01.468 align:middle line:90%,end
<c.magenta>就像百货商店开出的收据一样</c>

00:05:01.535 --> 00:05:04.571 align:middle line:90%,end
<c.magenta>它是购买凭据</c>

00:05:04.638 --> 00:05:07.107 align:middle line:90%,end
<c.magenta>表明用户确实已经购买</c>
<c.magenta>他们想要购买的内容</c>

00:05:07.174 --> 00:05:10.577 align:middle line:90%,end
<c.magenta>这是一个程序收条</c>
<c.magenta>这是一个可信的</c>

00:05:10.644 --> 00:05:14.248 align:middle line:90%,end
<c.magenta>程序内购买凭证</c>

00:05:14.915 --> 00:05:17.251 align:middle line:90%,end
<c.magenta>这个收条存储在设备上</c>

00:05:17.551 --> 00:05:20.254 align:middle line:90%,end
<c.magenta>由App Store签发</c>

00:05:21.021 --> 00:05:24.858 align:middle line:90%,end
<c.magenta>它相当于一个可检验的文件</c>
<c.magenta>意味着你可以使用证书</c>

00:05:24.925 --> 00:05:27.861 align:middle line:90%,end
<c.magenta>检查此文件是否确实由Apple签发</c>

00:05:27.928 --> 00:05:30.764 align:middle line:90%,end
<c.magenta>并且放在用户设备上</c>
<c.magenta>以确保其真实性</c>

00:05:32.065 --> 00:05:34.434 align:middle line:90%,end
<c.magenta>最后 它只能在设备上</c>
<c.magenta>用于你的程序</c>

00:05:34.902 --> 00:05:36.370 align:middle line:90%,end
<c.magenta>这意味着不能</c>
<c.magenta>跨设备共享</c>

00:05:36.436 --> 00:05:38.472 align:middle line:90%,end
<c.magenta>或者与其它程序共享</c>

00:05:39.640 --> 00:05:42.910 align:middle line:90%,end
<c.magenta>在收条验证方面</c>
<c.magenta>需要使用流程</c>

00:05:42.976 --> 00:05:44.678 align:middle line:90%,end
<c.magenta>确保此文件是可信文件</c>

00:05:44.745 --> 00:05:47.080 align:middle line:90%,end
<c.magenta>而不是某个人的假文件</c>

00:05:47.147 --> 00:05:48.081 align:middle line:90%,end
<c.magenta>这有两种方法</c>

00:05:48.148 --> 00:05:50.851 align:middle line:90%,end
<c.magenta>可以在设备上验证</c>

00:05:51.351 --> 00:05:53.954 align:middle line:90%,end
<c.magenta>也可以发送到服务器</c>

00:05:54.021 --> 00:05:55.889 align:middle line:90%,end
<c.magenta>使用服务器对服务器验证方法</c>

00:05:56.690 --> 00:05:58.992 align:middle line:90%,end
<c.magenta>需要指出的是</c>
<c.magenta>如果在用户设备上验证</c>

00:05:59.059 --> 00:06:01.128 align:middle line:90%,end
<c.magenta>一定不能直接在用户设备上</c>

00:05:59.059 --> 00:06:01.128 align:middle line:90%,end
<c.magenta>一定不能直接在用户设备上</c>

00:06:01.195 --> 00:06:02.930 align:middle line:10%
<c.magenta>使用在线验证</c>

00:06:02.996 --> 00:06:05.399 align:middle line:10%
<c.magenta>因为这不是安全的验证方法</c>

00:06:05.465 --> 00:06:07.134 align:middle line:10%
<c.magenta>如果在设备上验证</c>

00:06:07.201 --> 00:06:09.803 align:middle line:10%
<c.magenta>你需要使用</c>
<c.magenta>我们即将介绍的方法</c>

00:06:10.871 --> 00:06:14.374 align:middle line:10%
<c.magenta>收条看上去是什么样的？</c>
<c.magenta>让我们来看实际文件</c>

00:06:15.776 --> 00:06:16.910 align:middle line:90%,end
<c.magenta>收条文件</c>

00:06:17.277 --> 00:06:19.580 align:middle line:90%,end
<c.magenta>我们获得程序的所有购买信息</c>

00:06:19.646 --> 00:06:20.781 align:middle line:90%,end
<c.magenta>包括所有程序内购买</c>

00:06:20.848 --> 00:06:24.017 align:middle line:90%,end
<c.magenta>另外还有证书和签名</c>

00:06:24.084 --> 00:06:27.187 align:middle line:90%,end
<c.magenta>用于创建文件</c>
<c.magenta>以检查真实性</c>

00:06:27.254 --> 00:06:29.957 align:middle line:90%,end
<c.magenta>此文件存储在程序捆绑包内</c>

00:06:30.023 --> 00:06:33.660 align:middle line:90%,end
<c.magenta>我们提供一个API</c>
<c.magenta>用于获取此文件</c>

00:06:34.328 --> 00:06:35.596 align:middle line:90%,end
<c.magenta>它是一个单文件</c>

00:06:35.829 --> 00:06:38.465 align:middle line:90%,end
<c.magenta>含有程序的所有购买数据</c>

00:06:38.532 --> 00:06:40.801 align:middle line:90%,end
<c.magenta>和已经发生的程序内购买</c>

00:06:40.868 --> 00:06:44.805 align:middle line:90%,end
<c.magenta>包括一个签名</c>
<c.magenta>用于检查真实性</c>

00:06:44.872 --> 00:06:46.607 align:middle line:90%,end
<c.magenta>确保它是Apple签发的</c>

00:06:47.808 --> 00:06:50.310 align:middle line:90%,end
<c.magenta>此文件基于一系列的工业标准</c>

00:06:50.377 --> 00:06:51.612 align:middle line:90%,end
<c.magenta>它使用公钥加密标准</c>

00:06:51.678 --> 00:06:55.249 align:middle line:90%,end
<c.magenta>进行签名</c>

00:06:56.116 --> 00:06:58.552 align:middle line:90%,end
<c.magenta>使用ASN.1数据编码方法进行编码</c>

00:06:58.619 --> 00:07:01.321 align:middle line:90%,end
<c.magenta>不要对这些缩写术语感到困惑</c>

00:06:58.619 --> 00:07:01.321 align:middle line:90%,end
<c.magenta>不要对这些缩写术语感到困惑</c>

00:07:01.388 --> 00:07:03.590 align:middle line:90%,end
<c.magenta>它们都是公开标准</c>

00:07:03.657 --> 00:07:05.626 align:middle line:90%,end
<c.magenta>可以在网上</c>

00:07:05.692 --> 00:07:07.828 align:middle line:90%,end
<c.magenta>找到许多的相关信息</c>

00:07:08.195 --> 00:07:11.665 align:middle line:90%,end
<c.magenta>你可能熟悉的一种加密技术</c>
<c.magenta>是OpenSSL</c>

00:07:11.732 --> 00:07:12.966 align:middle line:90%,end
<c.magenta>OpenSSL是一个框架</c>

00:07:13.033 --> 00:07:16.803 align:middle line:90%,end
<c.magenta>不仅提供安全网页传输隧道功能</c>

00:07:16.870 --> 00:07:18.305 align:middle line:90%,end
<c.magenta>且能从ASN.1数据负载中</c>

00:07:18.372 --> 00:07:21.375 align:middle line:90%,end
<c.magenta>读取数据编码</c>

00:07:21.441 --> 00:07:24.711 align:middle line:90%,end
<c.magenta>并且在这样的密文容器上检查签名</c>

00:07:25.546 --> 00:07:28.081 align:middle line:90%,end
<c.magenta>当然 你可以使用</c>
<c.magenta>OpenSSL预构建解决方案</c>

00:07:28.148 --> 00:07:31.552 align:middle line:90%,end
<c.magenta>也可以直接读取特定的数据</c>

00:07:31.618 --> 00:07:34.454 align:middle line:90%,end
<c.magenta>你和你的公司应该</c>
<c.magenta>自行选择合适的解决方案</c>

00:07:34.521 --> 00:07:38.559 align:middle line:90%,end
<c.magenta>你可以看到 在安全方面</c>
<c.magenta>尤其是这种验证</c>

00:07:38.625 --> 00:07:41.061 align:middle line:90%,end
<c.magenta>并不是二项选择</c>
<c.magenta>不是安全与不安全</c>

00:07:41.128 --> 00:07:42.429 align:middle line:90%,end
<c.magenta>安全是一种程度</c>

00:07:42.496 --> 00:07:45.465 align:middle line:90%,end
<c.magenta>你必须自己决定</c>
<c.magenta>你所需要的安全程度</c>

00:07:45.532 --> 00:07:47.734 align:middle line:90%,end
<c.magenta>来验证这些购买</c>

00:07:48.936 --> 00:07:52.239 align:middle line:90%,end
<c.magenta>无论哪种方法 首先都需要</c>
<c.magenta>读取这个文件的加密数据</c>

00:07:52.306 --> 00:07:54.541 align:middle line:90%,end
<c.magenta>你可以使用前面提到的API</c>

00:07:54.608 --> 00:07:58.478 align:middle line:90%,end
<c.magenta>即Bundle.AppStoreReceiptURL API</c>

00:07:59.112 --> 00:08:02.816 align:middle line:90%,end
<c.magenta>它提供一个URL</c>
<c.magenta>可以通过它传递数据对象</c>

00:07:59.112 --> 00:08:02.816 align:middle line:90%,end
<c.magenta>它提供一个URL</c>
<c.magenta>可以通过它传递数据对象</c>

00:08:02.883 --> 00:08:06.220 align:middle line:90%,end
<c.magenta>你可以读取收条对象的加密二进制数据</c>

00:08:06.286 --> 00:08:10.958 align:middle line:90%,end
<c.magenta>加密二进制数据现已读取到内存之中</c>

00:08:13.527 --> 00:08:15.596 align:middle line:90%,end
<c.magenta>一点提示</c>
<c.magenta>如果你要使用OpenSSL</c>

00:08:15.662 --> 00:08:17.064 align:middle line:90%,end
<c.magenta>在本演讲中</c>

00:08:17.130 --> 00:08:18.866 align:middle line:90%,end
<c.magenta>不会介绍OpenSSL使用流程</c>

00:08:19.566 --> 00:08:21.702 align:middle line:90%,end
<c.magenta>但你们该知道</c>
<c.magenta>iOS不含OpenSSL</c>

00:08:22.169 --> 00:08:24.872 align:middle line:90%,end
<c.magenta>你必须自己创建并且加入到你的程序</c>

00:08:25.205 --> 00:08:28.308 align:middle line:90%,end
<c.magenta>你应该将它作为程序的静态库</c>

00:08:28.375 --> 00:08:30.511 align:middle line:90%,end
<c.magenta>而不是动态库</c>

00:08:30.844 --> 00:08:33.246 align:middle line:90%,end
<c.magenta>如果使用动态库</c>

00:08:33.313 --> 00:08:37.484 align:middle line:90%,end
<c.magenta>很容易被其它人调换为伪造的动态库</c>

00:08:37.551 --> 00:08:40.386 align:middle line:90%,end
<c.magenta>而影响程序二进制代码中的</c>
<c.magenta>实际方法的执行</c>

00:08:40.453 --> 00:08:43.423 align:middle line:90%,end
<c.magenta>静态库意味着</c>

00:08:43.490 --> 00:08:45.325 align:middle line:90%,end
<c.magenta>二进制数据封装在你的程序之内</c>

00:08:45.392 --> 00:08:48.228 align:middle line:90%,end
<c.magenta>其他人难以撰改</c>
<c.magenta>和调换你的OpenSSL实例</c>

00:08:49.463 --> 00:08:51.064 align:middle line:90%,end
<c.magenta>在证书检查方面</c>

00:08:51.131 --> 00:08:52.699 align:middle line:90%,end
<c.magenta>你可以从Apple网站</c>
<c.magenta>下载Apple Root证书</c>

00:08:52.766 --> 00:08:55.369 align:middle line:90%,end
<c.magenta>这是官方证书</c>

00:08:55.435 --> 00:08:57.504 align:middle line:90%,end
<c.magenta>可以使得这个证书执行检查</c>

00:08:57.571 --> 00:09:01.508 align:middle line:90%,end
<c.magenta>使用OpenSSL查看</c>
<c.magenta>证书是否是真实的Apple证书</c>

00:08:57.571 --> 00:09:01.508 align:middle line:90%,end
<c.magenta>使用OpenSSL查看</c>
<c.magenta>证书是否是真实的Apple证书</c>

00:09:01.775 --> 00:09:04.845 align:middle line:90%,end
<c.magenta>如果绑定到程序中</c>

00:09:04.912 --> 00:09:07.014 align:middle line:90%,end
<c.magenta>应该注意</c>

00:09:07.080 --> 00:09:09.983 align:middle line:90%,end
<c.magenta>加入到捆绑程序中的</c>
<c.magenta>证书的有效日期</c>

00:09:10.984 --> 00:09:12.753 align:middle line:90%,end
<c.magenta>这方面网上有很多的文档</c>

00:09:12.819 --> 00:09:14.888 align:middle line:90%,end
<c.magenta>事实上 几年前我们有一个演讲</c>

00:09:14.955 --> 00:09:18.058 align:middle line:90%,end
<c.magenta>实时演示如何使用OpenSSL</c>

00:09:18.125 --> 00:09:19.660 align:middle line:90%,end
<c.magenta>并进行验证</c>

00:09:19.726 --> 00:09:21.461 align:middle line:90%,end
<c.magenta>这个过程比较简单</c>

00:09:21.528 --> 00:09:24.064 align:middle line:90%,end
<c.magenta>希望你们观看以前的</c>

00:09:24.131 --> 00:09:26.400 align:middle line:90%,end
<c.magenta>收条验证演讲视频</c>

00:09:28.035 --> 00:09:30.537 align:middle line:90%,end
<c.magenta>在现成解决方案方面</c>
<c.magenta>我相信你们已经</c>

00:09:30.604 --> 00:09:34.074 align:middle line:90%,end
<c.magenta>尝试过集成程序内购买</c>
<c.magenta>而且曾经访问Get Hub</c>

00:09:34.141 --> 00:09:37.811 align:middle line:90%,end
<c.magenta>以找到一个现成的解决方案</c>
<c.magenta>为你完成这些验证工作</c>

00:09:38.612 --> 00:09:41.114 align:middle line:90%,end
<c.magenta>请记住 当你下载现成解决方案时</c>

00:09:41.181 --> 00:09:42.783 align:middle line:90%,end
<c.magenta>虽然获得便利 但也会有所让步</c>

00:09:43.851 --> 00:09:47.387 align:middle line:90%,end
<c.magenta>重复使用这样的代码</c>
<c.magenta>有可能产生错误和漏洞</c>

00:09:47.454 --> 00:09:51.658 align:middle line:90%,end
<c.magenta>对于StoreKit等</c>
<c.magenta>交易处理API来说尤其如此</c>

00:09:52.092 --> 00:09:54.061 align:middle line:90%,end
<c.magenta>你能想象全国的珠宝商</c>

00:09:54.127 --> 00:09:55.996 align:middle line:90%,end
<c.magenta>都使用同一把钥匙打开其保险箱吗？</c>

00:09:56.063 --> 00:09:59.032 align:middle line:90%,end
<c.magenta>只要这把锁有一个缺陷被发现</c>

00:09:59.099 --> 00:10:00.667 align:middle line:90%,end
<c.magenta>全国的珠宝商的</c>

00:09:59.099 --> 00:10:00.667 align:middle line:90%,end
<c.magenta>全国的珠宝商的</c>

00:10:00.734 --> 00:10:03.971 align:middle line:90%,end
<c.magenta>财产安全都会受到威胁</c>

00:10:04.705 --> 00:10:06.306 align:middle line:90%,end
<c.magenta>对你们来说</c>
<c.magenta>很重要的一点是</c>

00:10:06.373 --> 00:10:07.841 align:middle line:90%,end
<c.magenta>应该知道这样做的风险</c>

00:10:07.908 --> 00:10:11.778 align:middle line:90%,end
<c.magenta>请记住 当你们使用StoreKit</c>
<c.magenta>进行这些集成时</c>

00:10:11.845 --> 00:10:12.813 align:middle line:90%,end
<c.magenta>这关系到你的收入流</c>

00:10:12.880 --> 00:10:15.816 align:middle line:90%,end
<c.magenta>开发现成解决方案的人</c>

00:10:15.883 --> 00:10:18.986 align:middle line:90%,end
<c.magenta>并不像你自己一样</c>
<c.magenta>关心你的财产安全</c>

00:10:22.656 --> 00:10:25.259 align:middle line:90%,end
<c.magenta>当你验证实际证书</c>

00:10:25.325 --> 00:10:28.161 align:middle line:90%,end
<c.magenta>以签名收条时</c>
<c.magenta>有一些小技巧可供参考</c>

00:10:28.529 --> 00:10:31.298 align:middle line:90%,end
<c.magenta>你不必实际检查</c>
<c.magenta>用于签名收条的</c>

00:10:31.365 --> 00:10:32.966 align:middle line:90%,end
<c.magenta>证书的有效日期</c>

00:10:34.535 --> 00:10:35.369 align:middle line:90%,end
<c.magenta>我的意思是</c>

00:10:35.435 --> 00:10:38.372 align:middle line:90%,end
<c.magenta>如果收条是特定时间加密的</c>

00:10:38.438 --> 00:10:39.506 align:middle line:90%,end
<c.magenta>比如说两年前</c>

00:10:39.573 --> 00:10:42.643 align:middle line:90%,end
<c.magenta>然后有人使用当时有效的证书</c>
<c.magenta>签名这个收条</c>

00:10:42.709 --> 00:10:45.078 align:middle line:90%,end
<c.magenta>那么证书应该在稍后不久过期</c>

00:10:45.145 --> 00:10:47.414 align:middle line:90%,end
<c.magenta>证书已经过期</c>

00:10:47.481 --> 00:10:50.217 align:middle line:90%,end
<c.magenta>并不会使收条失效</c>

00:10:50.284 --> 00:10:51.351 align:middle line:90%,end
<c.magenta>在这里 重要的一点</c>

00:10:51.418 --> 00:10:54.054 align:middle line:90%,end
<c.magenta>并不是证书是否仍然有效</c>

00:10:54.121 --> 00:10:56.023 align:middle line:90%,end
<c.magenta>真正重要的是</c>

00:10:56.089 --> 00:10:57.791 align:middle line:90%,end
<c.magenta>在生成收条时 证书是否有效</c>

00:10:57.858 --> 00:11:01.361 align:middle line:90%,end
<c.magenta>应该将证书日期与</c>

00:10:57.858 --> 00:11:01.361 align:middle line:90%,end
<c.magenta>应该将证书日期与</c>

00:11:01.428 --> 00:11:03.063 align:middle line:90%,end
<c.magenta>收条内的购买日期比较</c>

00:11:03.130 --> 00:11:05.199 align:middle line:90%,end
<c.magenta>确保在签名之时证书是有效的</c>

00:11:07.134 --> 00:11:09.136 align:middle line:90%,end
<c.magenta>让我们来看收条的实际内容</c>

00:11:09.203 --> 00:11:11.705 align:middle line:90%,end
<c.magenta>这是ASN.1编码内容</c>

00:11:12.072 --> 00:11:14.341 align:middle line:90%,end
<c.magenta>它是一系列的类型和值</c>

00:11:14.608 --> 00:11:15.442 align:middle line:90%,end
<c.magenta>很像词典</c>

00:11:15.509 --> 00:11:18.545 align:middle line:90%,end
<c.magenta>可以把它视为词典</c>
<c.magenta>所含有的键值和值</c>

00:11:18.745 --> 00:11:20.647 align:middle line:90%,end
<c.magenta>可以读取</c>

00:11:20.714 --> 00:11:22.049 align:middle line:90%,end
<c.magenta>这些不同类型的值</c>

00:11:22.583 --> 00:11:25.419 align:middle line:90%,end
<c.magenta>现在你已经检查</c>
<c.magenta>实际文件是否已经</c>

00:11:25.485 --> 00:11:27.454 align:middle line:90%,end
<c.magenta>使用正确的Apple证书进行签名</c>

00:11:27.988 --> 00:11:31.658 align:middle line:90%,end
<c.magenta>你需要确定进行签名的程序</c>

00:11:31.725 --> 00:11:33.994 align:middle line:90%,end
<c.magenta>就是用户运行的程序</c>
<c.magenta>我们应该如何做呢？</c>

00:11:34.962 --> 00:11:37.130 align:middle line:90%,end
<c.magenta>为了确定此收条用于此程序</c>

00:11:37.197 --> 00:11:38.932 align:middle line:90%,end
<c.magenta>可以使用两种类型的属性</c>

00:11:38.999 --> 00:11:40.200 align:middle line:90%,end
<c.magenta>即类型2和3</c>

00:11:40.267 --> 00:11:43.070 align:middle line:90%,end
<c.magenta>它们含有此收条的适用程序的</c>
<c.magenta>捆绑包标识符</c>

00:11:43.136 --> 00:11:45.739 align:middle line:90%,end
<c.magenta>和捆绑包版本</c>

00:11:46.640 --> 00:11:49.710 align:middle line:90%,end
<c.magenta>你需要将这两个特定属性</c>

00:11:49.776 --> 00:11:52.179 align:middle line:90%,end
<c.magenta>与程序内的硬编码值进行比较</c>

00:11:52.479 --> 00:11:54.047 align:middle line:90%,end
<c.magenta>重要的一点是</c>
<c.magenta>这里应该使用硬编码值</c>

00:11:54.114 --> 00:11:56.016 align:middle line:90%,end
<c.magenta>原因前面我们已经讲过</c>

00:11:56.850 --> 00:11:59.753 align:middle line:90%,end
<c.magenta>这是一个info.plist文件</c>
<c.magenta>其它人很容易使用虚假值</c>

00:11:59.820 --> 00:12:02.589 align:middle line:90%,end
<c.magenta>替换这个plist文件</c>
<c.magenta>以区配虚假收条</c>

00:11:59.820 --> 00:12:02.589 align:middle line:90%,end
<c.magenta>替换这个plist文件</c>
<c.magenta>以区配虚假收条</c>

00:12:02.656 --> 00:12:06.760 align:middle line:90%,end
<c.magenta>相比之下 替换内容</c>
<c.magenta>以匹配硬编码值要困难得多</c>

00:12:07.828 --> 00:12:10.030 align:middle line:90%,end
<c.magenta>将这两个类型</c>
<c.magenta>与硬编码值进行比较</c>

00:12:10.097 --> 00:12:11.231 align:middle line:90%,end
<c.magenta>如果它们匹配 则一切正常</c>

00:12:11.298 --> 00:12:14.301 align:middle line:90%,end
<c.magenta>现在你已经确认程序是正确的</c>

00:12:14.902 --> 00:12:17.070 align:middle line:90%,end
<c.magenta>接下来的步骤是</c>
<c.magenta>检查用户使用的设备</c>

00:12:17.137 --> 00:12:19.072 align:middle line:90%,end
<c.magenta>是否与文件匹配</c>

00:12:19.373 --> 00:12:23.143 align:middle line:90%,end
<c.magenta>我们使用类型4和5</c>
<c.magenta>过程相似 但是这次</c>

00:12:23.210 --> 00:12:25.379 align:middle line:90%,end
<c.magenta>需要检查是的第5个属性</c>

00:12:26.046 --> 00:12:29.583 align:middle line:90%,end
<c.magenta>第5个属性实际上</c>
<c.magenta>是前三个值的SHA-1哈希值</c>

00:12:29.650 --> 00:12:31.752 align:middle line:90%,end
<c.magenta>这是捆绑包ID和</c>
<c.magenta>设备ID的SHA-1值</c>

00:12:31.818 --> 00:12:35.255 align:middle line:90%,end
<c.magenta>我们提供API读取设备ID</c>

00:12:35.889 --> 00:12:37.257 align:middle line:90%,end
<c.magenta>第三个是非透明值</c>

00:12:37.324 --> 00:12:40.194 align:middle line:90%,end
<c.magenta>它实际上是类型4中的属性</c>

00:12:40.260 --> 00:12:41.762 align:middle line:90%,end
<c.magenta>我们这样做的原因是</c>

00:12:41.828 --> 00:12:43.330 align:middle line:90%,end
<c.magenta>它使用加密技术</c>

00:12:43.397 --> 00:12:46.800 align:middle line:90%,end
<c.magenta>允许SHA-1哈希值随时间变化</c>

00:12:46.867 --> 00:12:49.436 align:middle line:90%,end
<c.magenta>即使捆绑包ID</c>
<c.magenta>和设备ID并不变化</c>

00:12:49.570 --> 00:12:51.939 align:middle line:90%,end
<c.magenta>从而增加过程安全性</c>

00:12:52.739 --> 00:12:56.577 align:middle line:90%,end
<c.magenta>因此 这个SHA-1值</c>
<c.magenta>对于程序和设备来说是唯一的</c>

00:12:57.277 --> 00:12:59.880 align:middle line:90%,end
<c.magenta>你要做的是</c>
<c.magenta>使用你自己的硬编码值</c>

00:12:59.947 --> 00:13:02.516 align:middle line:90%,end
<c.magenta>创建这个SHA-1值</c>

00:12:59.947 --> 00:13:02.516 align:middle line:90%,end
<c.magenta>创建这个SHA-1值</c>

00:13:02.583 --> 00:13:04.751 align:middle line:90%,end
<c.magenta>然后将它与类型5的值进行比较</c>

00:13:04.818 --> 00:13:06.887 align:middle line:90%,end
<c.magenta>如果匹配 则一切正常</c>

00:13:06.954 --> 00:13:09.156 align:middle line:90%,end
<c.magenta>这样你就确定</c>
<c.magenta>用户所使用的设备</c>

00:13:09.223 --> 00:13:10.991 align:middle line:90%,end
<c.magenta>就是收条的目标设备</c>

00:13:12.759 --> 00:13:14.661 align:middle line:90%,end
<c.magenta>现在你已经完成这三项检查</c>

00:13:15.662 --> 00:13:17.898 align:middle line:90%,end
<c.magenta>这个过程就是</c>
<c.magenta>在设备上验证收条</c>

00:13:17.965 --> 00:13:19.933 align:middle line:90%,end
<c.magenta>现在你知道这是一个可信文件</c>

00:13:20.000 --> 00:13:22.202 align:middle line:90%,end
<c.magenta>可以从它读取更多信息</c>

00:13:22.269 --> 00:13:23.971 align:middle line:90%,end
<c.magenta>让我们来看下面的步骤</c>

00:13:24.371 --> 00:13:27.207 align:middle line:90%,end
<c.magenta>即更新和检查</c>
<c.magenta>收条内的程序内购买</c>

00:13:27.274 --> 00:13:29.676 align:middle line:90%,end
<c.magenta>的状态和内容</c>

00:13:31.044 --> 00:13:34.248 align:middle line:90%,end
<c.magenta>让我们回过来看</c>
<c.magenta>收条内的数据</c>

00:13:34.982 --> 00:13:38.051 align:middle line:90%,end
<c.magenta>收条含有一个特定的类型</c>
<c.magenta>即类型17</c>

00:13:38.118 --> 00:13:42.623 align:middle line:90%,end
<c.magenta>用户在设备上</c>
<c.magenta>进行的每次交易都有一个这样的类型</c>

00:13:43.123 --> 00:13:48.929 align:middle line:90%,end
<c.magenta>在每个类型17中 实际数据是</c>
<c.magenta>另外一个ASN.1编码容器</c>

00:13:50.030 --> 00:13:53.100 align:middle line:90%,end
<c.magenta>在这个容器内</c>
<c.magenta>一组类型和值</c>

00:13:53.166 --> 00:13:56.069 align:middle line:90%,end
<c.magenta>与特定的交易相关联</c>

00:13:56.136 --> 00:13:59.940 align:middle line:90%,end
<c.magenta>这样我们获得数量、</c>
<c.magenta>产品标识符和交易ID等数据</c>

00:14:00.007 --> 00:14:01.642 align:middle line:90%,end
<c.magenta>你可以使用这些值</c>

00:14:01.708 --> 00:14:05.179 align:middle line:90%,end
<c.magenta>来检查是否确实存在这样的交易</c>

00:14:05.812 --> 00:14:08.148 align:middle line:90%,end
<c.magenta>我特别要指出的是类型1708</c>

00:14:08.215 --> 00:14:11.618 align:middle line:90%,end
<c.magenta>如果你处理自动续约订阅</c>
<c.magenta>这个类型很重要</c>

00:14:11.818 --> 00:14:14.788 align:middle line:90%,end
<c.magenta>它含有特定交易的</c>

00:14:14.855 --> 00:14:16.190 align:middle line:90%,end
<c.magenta>结算截止日期</c>

00:14:16.490 --> 00:14:18.759 align:middle line:90%,end
<c.magenta>稍后我们将会讨论订阅</c>

00:14:19.560 --> 00:14:22.596 align:middle line:90%,end
<c.magenta>如果想要了解</c>
<c.magenta>所有不同的类型</c>

00:14:22.663 --> 00:14:26.333 align:middle line:90%,end
<c.magenta>建议你们观看</c>
<c.magenta>“收条验证编程指南”演讲</c>

00:14:26.400 --> 00:14:30.504 align:middle line:90%,end
<c.magenta>我们介绍了收条中</c>
<c.magenta>包含的所有不同类型</c>

00:14:32.039 --> 00:14:34.208 align:middle line:90%,end
<c.magenta>现在你可以读出这些交易信息</c>

00:14:34.908 --> 00:14:37.177 align:middle line:90%,end
<c.magenta>你可以使用这些信息</c>
<c.magenta>来核实它们是否与</c>

00:14:37.544 --> 00:14:39.646 align:middle line:90%,end
<c.magenta>StoreKit告诉你的</c>
<c.magenta>用户购买内容一致</c>

00:14:39.780 --> 00:14:41.715 align:middle line:90%,end
<c.magenta>你要做的是通过这个</c>
<c.magenta>updatedTransaction调用</c>

00:14:41.782 --> 00:14:45.018 align:middle line:90%,end
<c.magenta>获取交易信息值</c>

00:14:45.085 --> 00:14:48.422 align:middle line:10%
<c.magenta>将这些值与收条内的值进行比较</c>

00:14:48.488 --> 00:14:50.224 align:middle line:10%
<c.magenta>你可以使用交易ID、</c>

00:14:50.290 --> 00:14:53.994 align:middle line:10%
<c.magenta>购买日期 用户所购买产品</c>
<c.magenta>的产品标识</c>

00:14:54.061 --> 00:14:56.830 align:middle line:10%
<c.magenta>如果你确认交易匹配</c>

00:14:56.897 --> 00:14:59.900 align:middle line:10%
<c.magenta>将会获得一个文件</c>
<c.magenta>证明用户确实购买了所述产品</c>

00:14:59.967 --> 00:15:01.468 align:middle line:10%
<c.magenta>而且已经进行支付</c>

00:14:59.967 --> 00:15:01.468 align:middle line:10%
<c.magenta>而且已经进行支付</c>

00:15:01.535 --> 00:15:04.505 align:middle line:10%
<c.magenta>你可以信任StoreKit</c>
<c.magenta>告知给你的交易</c>

00:15:06.039 --> 00:15:08.909 align:middle line:10%
<c.magenta>当你处理订阅时</c>
<c.magenta>一些常见的问题是</c>

00:15:08.976 --> 00:15:11.011 align:middle line:90%,end
<c.magenta>“我的用户是否具有有效的订阅？”</c>

00:15:12.312 --> 00:15:15.115 align:middle line:90%,end
<c.magenta>这里需要注意的是</c>
<c.magenta>有效收条并不等同于</c>

00:15:15.182 --> 00:15:17.518 align:middle line:90%,end
<c.magenta>获得订阅用户</c>

00:15:17.651 --> 00:15:19.353 align:middle line:90%,end
<c.magenta>有时候这会让人感到困惑</c>

00:15:19.419 --> 00:15:20.487 align:middle line:90%,end
<c.magenta>如果你可以验证收条</c>

00:15:20.554 --> 00:15:22.789 align:middle line:90%,end
<c.magenta>这并不意味着用户已经进行支付</c>

00:15:22.890 --> 00:15:24.291 align:middle line:90%,end
<c.magenta>每个应用都有收条</c>

00:15:24.358 --> 00:15:27.427 align:middle line:90%,end
<c.magenta>它含有任何原始应用购买相关信息</c>

00:15:27.494 --> 00:15:28.662 align:middle line:90%,end
<c.magenta>甚至免费应用也是如此</c>

00:15:29.029 --> 00:15:31.098 align:middle line:90%,end
<c.magenta>收条内的数据</c>
<c.magenta>这些交易信息</c>

00:15:31.164 --> 00:15:33.634 align:middle line:90%,end
<c.magenta>向你告诉用户的订阅状态</c>

00:15:34.935 --> 00:15:36.904 align:middle line:90%,end
<c.magenta>我们如何找出订阅状态呢？</c>

00:15:37.437 --> 00:15:39.139 align:middle line:90%,end
<c.magenta>你可以获取这些交易信息</c>

00:15:39.206 --> 00:15:42.843 align:middle line:90%,end
<c.magenta>按照原始交易ID字段对它们分组</c>

00:15:43.310 --> 00:15:45.879 align:middle line:90%,end
<c.magenta>交易ID字段含有</c>

00:15:45.946 --> 00:15:48.615 align:middle line:90%,end
<c.magenta>用户的特定自动续约订阅的</c>
<c.magenta>首次交易ID</c>

00:15:48.682 --> 00:15:51.685 align:middle line:90%,end
<c.magenta>可以将它视为订阅ID</c>

00:15:51.752 --> 00:15:54.855 align:middle line:90%,end
<c.magenta>用于引用和分组这些交易</c>

00:15:55.622 --> 00:15:57.391 align:middle line:90%,end
<c.magenta>你可以抓取这些交易信息</c>

00:15:57.457 --> 00:16:00.360 align:middle line:90%,end
<c.magenta>并可以查看即将过期的交易</c>

00:15:57.457 --> 00:16:00.360 align:middle line:90%,end
<c.magenta>并可以查看即将过期的交易</c>

00:16:00.460 --> 00:16:03.830 align:middle line:90%,end
<c.magenta>这表示已经发生的最新交易</c>

00:16:03.897 --> 00:16:05.933 align:middle line:90%,end
<c.magenta>如果找到截止日期</c>

00:16:05.999 --> 00:16:08.435 align:middle line:90%,end
<c.magenta>表示用户的计费期还没有结束</c>

00:16:08.502 --> 00:16:09.837 align:middle line:90%,end
<c.magenta>而且他们具有有效的订阅</c>

00:16:10.137 --> 00:16:12.973 align:middle line:90%,end
<c.magenta>如果你找到过去的截止日期</c>

00:16:13.040 --> 00:16:15.342 align:middle line:90%,end
<c.magenta>则表示从那时起没有发生任何交易</c>

00:16:15.409 --> 00:16:17.644 align:middle line:90%,end
<c.magenta>用户的订阅已经过期</c>

00:16:18.212 --> 00:16:21.114 align:middle line:90%,end
<c.magenta>如果你找到截止日期数据</c>

00:16:21.181 --> 00:16:23.150 align:middle line:10%
<c.magenta>你可以发送接收刷新属性</c>

00:16:24.084 --> 00:16:27.321 align:middle line:10%
<c.magenta>获取最新的收条副本</c>
<c.magenta>进行再次确认</c>

00:16:27.387 --> 00:16:29.890 align:middle line:10%
<c.magenta>然后你可以</c>

00:16:29.957 --> 00:16:32.926 align:middle line:10%
<c.magenta>重复收条验证步骤</c>

00:16:32.993 --> 00:16:35.229 align:middle line:10%
<c.magenta>了解是否发生过任何新交易</c>

00:16:36.330 --> 00:16:38.498 align:middle line:10%
<c.magenta>在设备上维护</c>
<c.magenta>订阅状态时</c>

00:16:38.565 --> 00:16:40.334 align:middle line:90%,end
<c.magenta>需要注意一点</c>

00:16:40.400 --> 00:16:44.071 align:middle line:90%,end
<c.magenta>前面我们讲过截止日期</c>
<c.magenta>和购买日期</c>

00:16:44.137 --> 00:16:46.473 align:middle line:90%,end
<c.magenta>如果你在设备进行这些操作</c>

00:16:46.540 --> 00:16:49.910 align:middle line:90%,end
<c.magenta>你仅需要将这些日期</c>
<c.magenta>与系统日期进行比较</c>

00:16:49.977 --> 00:16:52.546 align:middle line:90%,end
<c.magenta>用户可能会回调系统时间</c>

00:16:52.613 --> 00:16:55.315 align:middle line:90%,end
<c.magenta>让他们仍然处于有效订阅期</c>

00:16:56.750 --> 00:16:58.151 align:middle line:90%,end
<c.magenta>并没有办法防止他们这样做</c>

00:16:58.218 --> 00:17:00.921 align:middle line:90%,end
<c.magenta>如果你遇到这样的问题</c>

00:16:58.218 --> 00:17:00.921 align:middle line:90%,end
<c.magenta>如果你遇到这样的问题</c>

00:17:00.988 --> 00:17:03.090 align:middle line:90%,end
<c.magenta>可能需要使用服务端解决方案</c>

00:17:03.156 --> 00:17:05.925 align:middle line:90%,end
<c.magenta>可能需要在服务器上验证收条</c>

00:17:05.992 --> 00:17:09.396 align:middle line:90%,end
<c.magenta>或者至少从服务器</c>
<c.magenta>获取时间和日期以进行检查</c>

00:17:11.265 --> 00:17:12.833 align:middle line:90%,end
<c.magenta>如我前面所述</c>

00:17:12.900 --> 00:17:14.001 align:middle line:90%,end
<c.magenta>当收条不存在或无效时</c>

00:17:14.067 --> 00:17:16.435 align:middle line:90%,end
<c.magenta>或者你要搜索额外的交易</c>

00:17:16.502 --> 00:17:18.839 align:middle line:90%,end
<c.magenta>可以发送刷新请求</c>
<c.magenta>获取最新的收条信息</c>

00:17:19.039 --> 00:17:21.974 align:middle line:90%,end
<c.magenta>这需要发送网络请求</c>
<c.magenta>因为这会从App Store</c>

00:17:22.041 --> 00:17:26.146 align:middle line:90%,end
<c.magenta>取回新收条</c>
<c.magenta>而且这需要用户签名</c>

00:17:26.213 --> 00:17:27.347 align:middle line:90%,end
<c.magenta>因此你应该十分注意</c>

00:17:27.414 --> 00:17:28.749 align:middle line:90%,end
<c.magenta>避免频繁地这样做</c>

00:17:28.815 --> 00:17:31.552 align:middle line:90%,end
<c.magenta>应该避免持续性的验证和刷新</c>

00:17:31.618 --> 00:17:33.554 align:middle line:90%,end
<c.magenta>如果你进行前面所述的操作</c>

00:17:33.620 --> 00:17:36.690 align:middle line:90%,end
<c.magenta>即查找截止日期</c>
<c.magenta>应该确保如果未发现截止日期</c>

00:17:36.757 --> 00:17:39.860 align:middle line:90%,end
<c.magenta>不会持续地提交收条刷新请求</c>

00:17:39.927 --> 00:17:42.462 align:middle line:90%,end
<c.magenta>因为这会反复提示用户登录</c>

00:17:42.529 --> 00:17:45.699 align:middle line:90%,end
<c.magenta>只应该发送一次请求</c>

00:17:45.766 --> 00:17:47.501 align:middle line:10%
<c.magenta>代码看起来是这样的</c>

00:17:47.801 --> 00:17:50.504 align:middle line:10%
<c.magenta>你创建一个</c>
<c.magenta>SKReceiptRefreshRequest对象</c>

00:17:50.571 --> 00:17:52.339 align:middle line:10%
<c.magenta>为它设置委托</c>

00:17:52.406 --> 00:17:53.707 align:middle line:10%
<c.magenta>然后使用start方法启动</c>

00:17:55.442 --> 00:17:57.578 align:middle line:90%,end
<c.magenta>在mac iOS上</c>
<c.magenta>如果你开发Mac程序</c>

00:17:57.811 --> 00:18:00.781 align:middle line:90%,end
<c.magenta>应该遵循同样的原则</c>
<c.magenta>你可以这样做</c>

00:17:57.811 --> 00:18:00.781 align:middle line:90%,end
<c.magenta>应该遵循同样的原则</c>
<c.magenta>你可以这样做</c>

00:18:01.315 --> 00:18:03.750 align:middle line:90%,end
<c.magenta>这会发送网格请求</c>

00:18:03.817 --> 00:18:05.786 align:middle line:90%,end
<c.magenta>并且要求用户登录</c>

00:18:05.853 --> 00:18:07.487 align:middle line:90%,end
<c.magenta>但是在本例中</c>
<c.magenta>情况略有不同</c>

00:18:07.554 --> 00:18:11.458 align:middle line:90%,end
<c.magenta>你要做的是</c>
<c.magenta>使用代码173退出程序</c>

00:18:12.092 --> 00:18:14.661 align:middle line:10%
<c.magenta>看起来是这样的</c>
<c.magenta>这会退出你的程序</c>

00:18:14.728 --> 00:18:16.129 align:middle line:90%,end
<c.magenta>在后台触发StoreKit</c>

00:18:16.196 --> 00:18:17.931 align:middle line:90%,end
<c.magenta>并且下载新收条</c>

00:18:17.998 --> 00:18:22.069 align:middle line:90%,end
<c.magenta>到Mac计算机上</c>
<c.magenta>提示用户登录并重新启动你的程序</c>

00:18:23.670 --> 00:18:26.039 align:middle line:90%,end
<c.magenta>现在我们来看</c>

00:18:26.106 --> 00:18:29.009 align:middle line:90%,end
<c.magenta>恢复交易与刷新收条的不同之处</c>

00:18:29.076 --> 00:18:32.479 align:middle line:90%,end
<c.magenta>有时候这会让人感到困惑</c>
<c.magenta>这是两个不同的API</c>

00:18:33.046 --> 00:18:36.250 align:middle line:90%,end
<c.magenta>关于恢复完整交易的API</c>

00:18:36.316 --> 00:18:38.485 align:middle line:90%,end
<c.magenta>我们已在今天上午</c>
<c.magenta>“StoreKit新特性”演讲中讨论</c>

00:18:38.552 --> 00:18:41.221 align:middle line:90%,end
<c.magenta>这一个SK支付队列API</c>

00:18:41.889 --> 00:18:45.192 align:middle line:90%,end
<c.magenta>收条刷新请求是你创建的一个实例</c>

00:18:45.259 --> 00:18:46.960 align:middle line:90%,end
<c.magenta>你使用start方法启动它</c>

00:18:47.060 --> 00:18:48.829 align:middle line:90%,end
<c.magenta>它们的功能略有不同</c>

00:18:48.896 --> 00:18:53.233 align:middle line:90%,end
<c.magenta>恢复完整交易</c>
<c.magenta>将会通过更新交易回调方法</c>

00:18:53.300 --> 00:18:55.169 align:middle line:90%,end
<c.magenta>取回用户的所有已完成交易</c>

00:18:55.235 --> 00:18:59.239 align:middle line:90%,end
<c.magenta>让你能够进行处理</c>

00:18:59.840 --> 00:19:01.708 align:middle line:90%,end
<c.magenta>收条更新请求</c>

00:18:59.840 --> 00:19:01.708 align:middle line:90%,end
<c.magenta>收条更新请求</c>

00:19:01.775 --> 00:19:04.278 align:middle line:90%,end
<c.magenta>实际上是取回新收条文件</c>

00:19:04.344 --> 00:19:08.515 align:middle line:90%,end
<c.magenta>此文件是加密二进制代码</c>
<c.magenta>让你能够检查其内容</c>

00:19:09.483 --> 00:19:11.952 align:middle line:90%,end
<c.magenta>这两个操作返回的结果</c>
<c.magenta>也略有不同</c>

00:19:12.019 --> 00:19:14.655 align:middle line:90%,end
<c.magenta>当你恢复完整交易时</c>

00:19:14.721 --> 00:19:16.623 align:middle line:90%,end
<c.magenta>仅恢复非消费性产品</c>

00:19:16.690 --> 00:19:18.659 align:middle line:90%,end
<c.magenta>和自动续约订阅产品</c>

00:19:19.760 --> 00:19:23.230 align:middle line:10%
<c.magenta>收条刷新请求</c>
<c.magenta>不仅获取这两种产品</c>

00:19:23.297 --> 00:19:26.900 align:middle line:10%
<c.magenta>而且包含收条中的</c>
<c.magenta>任何非续约订阅条目</c>

00:19:27.267 --> 00:19:29.002 align:middle line:10%
<c.magenta>你会注意到</c>

00:19:29.069 --> 00:19:31.371 align:middle line:10%
<c.magenta>这两种类型的请求</c>
<c.magenta>都不取回消费性产品交易</c>

00:19:31.438 --> 00:19:34.174 align:middle line:10%
<c.magenta>如果你处理消费性产品购买</c>

00:19:34.241 --> 00:19:36.910 align:middle line:10%
<c.magenta>它们只会出现</c>
<c.magenta>更新交易之中</c>

00:19:36.977 --> 00:19:39.246 align:middle line:10%
<c.magenta>和购买时的收条之中</c>

00:19:39.313 --> 00:19:42.783 align:middle line:10%
<c.magenta>因此 你可以检查消费性产品</c>

00:19:42.850 --> 00:19:45.319 align:middle line:10%
<c.magenta>但是这两种调用不会取回它</c>

00:19:46.153 --> 00:19:48.422 align:middle line:90%,end
<c.magenta>关于收条处理的另一个技巧是</c>

00:19:48.488 --> 00:19:49.957 align:middle line:90%,end
<c.magenta>如果你想要切换到订阅产品</c>

00:19:50.023 --> 00:19:51.225 align:middle line:90%,end
<c.magenta>你可能有一个付费应用</c>

00:19:51.291 --> 00:19:53.760 align:middle line:90%,end
<c.magenta>想要把它切换到订阅模式</c>

00:19:53.827 --> 00:19:57.865 align:middle line:90%,end
<c.magenta>可以在程序收条中</c>
<c.magenta>找到这个类型19值</c>

00:19:58.599 --> 00:20:00.534 align:middle line:90%,end
<c.magenta>它包含原始程序版本</c>

00:19:58.599 --> 00:20:00.534 align:middle line:90%,end
<c.magenta>它包含原始程序版本</c>

00:20:00.601 --> 00:20:04.171 align:middle line:90%,end
<c.magenta>可以使用</c>
<c.magenta>这个用户下载的程序版本</c>

00:20:04.238 --> 00:20:06.773 align:middle line:90%,end
<c.magenta>以了解你是否应该需要</c>

00:20:06.840 --> 00:20:09.877 align:middle line:90%,end
<c.magenta>在付费程序或订阅模式</c>
<c.magenta>的基础上提供内容</c>

00:20:09.943 --> 00:20:12.279 align:middle line:90%,end
<c.magenta>我们知道</c>
<c.magenta>对于付费程序来说</c>

00:20:12.346 --> 00:20:15.115 align:middle line:90%,end
<c.magenta>如果突然终止付费使用的功能</c>
<c.magenta>将会极大地影响用户体验</c>

00:20:15.182 --> 00:20:16.216 align:middle line:90%,end
<c.magenta>对于订阅模式</c>

00:20:16.283 --> 00:20:20.521 align:middle line:90%,end
<c.magenta>可以使用类型19</c>
<c.magenta>来提供相关信息</c>

00:20:21.555 --> 00:20:23.891 align:middle line:10%
<c.magenta>这个步骤是在设备上检查交易</c>

00:20:23.957 --> 00:20:26.827 align:middle line:10%
<c.magenta>和确认订阅状态</c>

00:20:27.094 --> 00:20:28.996 align:middle line:10%
<c.magenta>在这个步骤之后</c>
<c.magenta>你就可以完结交易</c>

00:20:29.062 --> 00:20:31.431 align:middle line:10%
<c.magenta>你向用户提供内容</c>

00:20:31.498 --> 00:20:33.433 align:middle line:10%
<c.magenta>更新订阅</c>

00:20:33.500 --> 00:20:35.569 align:middle line:10%
<c.magenta>当完结交易时</c>

00:20:36.537 --> 00:20:38.338 align:middle line:90%,end
<c.magenta>你应该记住</c>
<c.magenta>需要完结这个流程中的</c>

00:20:38.405 --> 00:20:39.706 align:middle line:90%,end
<c.magenta>所有交易</c>

00:20:39.773 --> 00:20:42.576 align:middle line:90%,end
<c.magenta>但是仅应该</c>
<c.magenta>在向用户提供内容之后这样做</c>

00:20:43.544 --> 00:20:46.380 align:middle line:90%,end
<c.magenta>也许你正在下载</c>
<c.magenta>与程序内购买相关的内容</c>

00:20:46.446 --> 00:20:48.515 align:middle line:90%,end
<c.magenta>应该确保下载完成之后</c>

00:20:48.582 --> 00:20:50.751 align:middle line:90%,end
<c.magenta>再完结交易</c>

00:20:51.485 --> 00:20:54.555 align:middle line:90%,end
<c.magenta>对于所有自动续约订阅交易来说</c>
<c.magenta>也是如此</c>

00:20:54.621 --> 00:20:55.889 align:middle line:90%,end
<c.magenta>对于在每个结算周期结束时</c>

00:20:55.956 --> 00:20:57.658 align:middle line:90%,end
<c.magenta>发生的可续约交易</c>

00:20:57.724 --> 00:21:00.727 align:middle line:90%,end
<c.magenta>你仍然需要完结所有这些交易</c>
<c.magenta>并处理它们</c>

00:20:57.724 --> 00:21:00.727 align:middle line:90%,end
<c.magenta>你仍然需要完结所有这些交易</c>
<c.magenta>并处理它们</c>

00:21:00.994 --> 00:21:03.997 align:middle line:90%,end
<c.magenta>如果你不这样做</c>
<c.magenta>支付操作实际上停留在支付队列中</c>

00:21:04.064 --> 00:21:06.466 align:middle line:90%,end
<c.magenta>将会重复出现在更新交易回调之中</c>

00:21:06.533 --> 00:21:09.336 align:middle line:90%,end
<c.magenta>直到你处理它并完结交易</c>

00:21:10.370 --> 00:21:13.006 align:middle line:90%,end
<c.magenta>关于订阅结算重试</c>
<c.magenta>我们有一个特定的逻辑</c>

00:21:13.073 --> 00:21:15.542 align:middle line:90%,end
<c.magenta>如果你不使用自动续约订阅</c>

00:21:15.609 --> 00:21:17.845 align:middle line:90%,end
<c.magenta>很重要的一点是</c>
<c.magenta>你必须完结这些交易</c>

00:21:17.911 --> 00:21:20.047 align:middle line:90%,end
<c.magenta>这样 如果出现任何类型的结算错误</c>

00:21:20.113 --> 00:21:22.282 align:middle line:90%,end
<c.magenta>我们的订阅结算重试逻辑</c>

00:21:22.349 --> 00:21:24.351 align:middle line:90%,end
<c.magenta>可以继续尝试</c>
<c.magenta>并且向用户的信用卡收费</c>

00:21:24.551 --> 00:21:26.053 align:middle line:90%,end
<c.magenta>这一点很重要</c>

00:21:26.119 --> 00:21:28.455 align:middle line:90%,end
<c.magenta>它让我们能够知道</c>
<c.magenta>所有交易的状态</c>

00:21:29.056 --> 00:21:31.758 align:middle line:10%
<c.magenta>API是这样的</c>
<c.magenta>只有一行代码</c>

00:21:31.825 --> 00:21:34.161 align:middle line:10%
<c.magenta>在流程开始时</c>
<c.magenta>在SKPaymentQueue默认队列上</c>

00:21:34.228 --> 00:21:37.564 align:middle line:10%
<c.magenta>可以将我们收到的交易对象</c>

00:21:37.631 --> 00:21:40.000 align:middle line:10%
<c.magenta>传递给交易完结处理方法</c>

00:21:43.203 --> 00:21:45.973 align:middle line:90%,end
<c.magenta>关于用户设备上的收条验证</c>

00:21:46.039 --> 00:21:48.275 align:middle line:90%,end
<c.magenta>和内容更新流程就是这些</c>

00:21:48.342 --> 00:21:50.277 align:middle line:90%,end
<c.magenta>让我们来看</c>
<c.magenta>在服务端环境中</c>

00:21:50.344 --> 00:21:51.778 align:middle line:90%,end
<c.magenta>这是如何工作的</c>

00:21:52.145 --> 00:21:54.681 align:middle line:10%
<c.magenta>为此 让我们来看一个例子</c>

00:21:56.250 --> 00:22:01.255 align:middle line:10%
<c.magenta>假设有一个用户在使用你的程序</c>

00:21:56.250 --> 00:22:01.255 align:middle line:10%
<c.magenta>假设有一个用户在使用你的程序</c>

00:22:01.321 --> 00:22:03.790 align:middle line:10%
<c.magenta>而且你有一台服务器</c>
<c.magenta>在后台提供支持</c>

00:22:03.857 --> 00:22:06.393 align:middle line:10%
<c.magenta>流程开始时</c>
<c.magenta>在更新交易回调中</c>

00:22:06.460 --> 00:22:09.396 align:middle line:10%
<c.magenta>接收交易</c>

00:22:09.463 --> 00:22:11.999 align:middle line:10%
<c.magenta>然后 你使用前面所述的API</c>

00:22:12.065 --> 00:22:13.700 align:middle line:10%
<c.magenta>读取二进制收条数据</c>

00:22:13.800 --> 00:22:16.170 align:middle line:10%
<c.magenta>此时数据仍然经过编码</c>
<c.magenta>我们还没有使用证书或其它内容</c>

00:22:16.236 --> 00:22:17.771 align:middle line:10%
<c.magenta>进行检查</c>

00:22:17.838 --> 00:22:19.273 align:middle line:10%
<c.magenta>与设备上的操作不同的是</c>

00:22:19.339 --> 00:22:23.644 align:middle line:10%
<c.magenta>我们要做的是获取二进制编码收条数据</c>
<c.magenta>将它发送到你的服务器</c>

00:22:24.945 --> 00:22:28.282 align:middle line:10%
<c.magenta>然后 你可以</c>
<c.magenta>使用这个检查收条URL</c>

00:22:28.348 --> 00:22:30.817 align:middle line:10%
<c.magenta>建立与服务器之间的连接</c>

00:22:31.185 --> 00:22:33.287 align:middle line:10%
<c.magenta>将二进制数据传输到</c>
<c.magenta>App Store</c>

00:22:33.353 --> 00:22:36.590 align:middle line:10%
<c.magenta>现在App Store完成后续工作</c>
<c.magenta>包括检查证书</c>

00:22:36.657 --> 00:22:38.258 align:middle line:10%
<c.magenta>和验证所有相关信息</c>

00:22:38.325 --> 00:22:40.827 align:middle line:10%
<c.magenta>并且返回收条有效性状态</c>

00:22:40.894 --> 00:22:43.897 align:middle line:10%
<c.magenta>说明它是否是可信的文件</c>

00:22:45.632 --> 00:22:47.701 align:middle line:90%,end
<c.magenta>这些处理工作使用文本格式</c>

00:22:47.768 --> 00:22:49.136 align:middle line:90%,end
<c.magenta>回应信息位于JSON之中</c>

00:22:49.503 --> 00:22:53.040 align:middle line:90%,end
<c.magenta>它返回一个状态</c>
<c.magenta>说明收条是否有效</c>

00:22:53.106 --> 00:22:55.342 align:middle line:10%
<c.magenta>但是这里需要指出的是</c>
<c.magenta>前面我说过</c>

00:22:55.542 --> 00:22:58.579 align:middle line:10%
<c.magenta>不应该直接在用户设备上</c>
<c.magenta>使用这项技术</c>

00:22:58.645 --> 00:23:00.047 align:middle line:10%
<c.magenta>只有在你的服务器</c>
<c.magenta>与App Store之间的通道上</c>

00:22:58.645 --> 00:23:00.047 align:middle line:10%
<c.magenta>只有在你的服务器</c>
<c.magenta>与App Store之间的通道上</c>

00:23:00.113 --> 00:23:01.748 align:middle line:10%
<c.magenta>进行这些处理才是安全的</c>

00:23:04.685 --> 00:23:07.221 align:middle line:90%,end
<c.magenta>应该在你的服务器上验证收条</c>

00:23:07.287 --> 00:23:09.823 align:middle line:90%,end
<c.magenta>这比用户设备上的操作简单一些</c>

00:23:10.490 --> 00:23:12.559 align:middle line:10%
<c.magenta>让我们来看</c>
<c.magenta>在这种情况下</c>

00:23:12.626 --> 00:23:15.662 align:middle line:10%
<c.magenta>你如何解锁内容</c>
<c.magenta>并检查交易</c>

00:23:18.065 --> 00:23:19.032 align:middle line:10%
<c.magenta>让我们来再看这个例子</c>

00:23:19.099 --> 00:23:22.202 align:middle line:10%
<c.magenta>假设你已经</c>
<c.magenta>发送二进制数据到你的服务器</c>

00:23:22.469 --> 00:23:24.972 align:middle line:10%
<c.magenta>已经建立与App Store之间</c>
<c.magenta>的连接</c>

00:23:25.038 --> 00:23:26.940 align:middle line:10%
<c.magenta>发送二进制数据到App Store</c>

00:23:27.641 --> 00:23:29.776 align:middle line:10%
<c.magenta>不仅App Store</c>

00:23:29.843 --> 00:23:31.945 align:middle line:10%
<c.magenta>返回收条的有效性状态</c>

00:23:32.346 --> 00:23:35.282 align:middle line:10%
<c.magenta>而且这个回应信息</c>
<c.magenta>还包含</c>

00:23:35.349 --> 00:23:38.252 align:middle line:10%
<c.magenta>最新程序收条的编码版本</c>

00:23:38.418 --> 00:23:41.321 align:middle line:10%
<c.magenta>这是JSON中的解码版本</c>
<c.magenta>你可以查看</c>

00:23:41.388 --> 00:23:42.756 align:middle line:10%
<c.magenta>所有交易信息</c>

00:23:42.823 --> 00:23:45.492 align:middle line:10%
<c.magenta>与用户设备上的解密信息相同</c>

00:23:45.559 --> 00:23:48.462 align:middle line:10%
<c.magenta>只是这次它们位于</c>

00:23:48.529 --> 00:23:50.864 align:middle line:10%
<c.magenta>App Store发送的JSON数据负载之中</c>
<c.magenta>你可以检查所有交易</c>

00:23:50.931 --> 00:23:53.800 align:middle line:10%
<c.magenta>决定是否解锁内容</c>

00:23:53.867 --> 00:23:57.037 align:middle line:10%
<c.magenta>然后在用户设备上完结交易</c>

00:23:57.337 --> 00:23:59.406 align:middle line:10%
<c.magenta>这特别有用</c>
<c.magenta>因为你们可以</c>

00:23:59.473 --> 00:24:01.241 align:middle line:10%
<c.magenta>在服务器关联的其它平台上</c>

00:23:59.473 --> 00:24:01.241 align:middle line:10%
<c.magenta>在服务器关联的其它平台上</c>

00:24:01.308 --> 00:24:03.610 align:middle line:10%
<c.magenta>更新状态</c>

00:24:04.678 --> 00:24:07.281 align:middle line:90%,end
<c.magenta>流程就是这样的</c>
<c.magenta>只是这次使用文本格式</c>

00:24:07.347 --> 00:24:09.583 align:middle line:90%,end
<c.magenta>但是这里重要的一点是</c>
<c.magenta>如果使用此技术</c>

00:24:09.650 --> 00:24:11.952 align:middle line:90%,end
<c.magenta>应该告诉设备</c>

00:24:12.019 --> 00:24:13.487 align:middle line:90%,end
<c.magenta>仍然需要完结交易</c>

00:24:18.325 --> 00:24:21.762 align:middle line:90%,end
<c.magenta>我们再次回答</c>
<c.magenta>解锁订阅功能的问题</c>

00:24:21.828 --> 00:24:24.097 align:middle line:90%,end
<c.magenta>我的用户是否有</c>
<c.magenta>一个活跃的订阅？</c>

00:24:24.831 --> 00:24:27.768 align:middle line:90%,end
<c.magenta>这实际上是相同的流程</c>
<c.magenta>因为我们说过</c>

00:24:27.835 --> 00:24:29.002 align:middle line:90%,end
<c.magenta>此收条包含所有相同的信息</c>

00:24:29.069 --> 00:24:32.072 align:middle line:90%,end
<c.magenta>你可以按照原始交易ID</c>
<c.magenta>分组收条中的交易</c>

00:24:32.139 --> 00:24:35.843 align:middle line:90%,end
<c.magenta>就是这个订阅ID字段</c>

00:24:36.009 --> 00:24:37.578 align:middle line:90%,end
<c.magenta>你需要找到</c>

00:24:37.644 --> 00:24:39.379 align:middle line:90%,end
<c.magenta>具有最近截止日期的交易</c>

00:24:39.446 --> 00:24:41.114 align:middle line:90%,end
<c.magenta>如果截止日期是未来日期</c>

00:24:41.181 --> 00:24:44.618 align:middle line:90%,end
<c.magenta>表示用户仍然存于有效订阅状态</c>

00:24:45.185 --> 00:24:46.520 align:middle line:90%,end
<c.magenta>如果截止日期不是未来日期</c>

00:24:46.587 --> 00:24:47.754 align:middle line:90%,end
<c.magenta>而是位于过去</c>

00:24:47.821 --> 00:24:50.791 align:middle line:90%,end
<c.magenta>则意味着订阅已经过期</c>

00:24:51.091 --> 00:24:52.526 align:middle line:90%,end
<c.magenta>这是收条的最新副本</c>

00:24:52.593 --> 00:24:55.395 align:middle line:90%,end
<c.magenta>因此你不能在服务器上</c>

00:24:55.462 --> 00:24:58.131 align:middle line:90%,end
<c.magenta>进行收条刷新请求</c>
<c.magenta>你已经获得最新的副本</c>

00:24:59.433 --> 00:25:03.136 align:middle line:10%
<c.magenta>现在 我们已经在这些信息基础上</c>
<c.magenta>解锁内容</c>

00:24:59.433 --> 00:25:03.136 align:middle line:10%
<c.magenta>现在 我们已经在这些信息基础上</c>
<c.magenta>解锁内容</c>

00:25:03.203 --> 00:25:05.806 align:middle line:10%
<c.magenta>前面我说过</c>
<c.magenta>仍然应该记得</c>

00:25:05.873 --> 00:25:07.241 align:middle line:10%
<c.magenta>在用户设备上完结交易</c>

00:25:07.474 --> 00:25:09.676 align:middle line:10%
<c.magenta>在本演讲中</c>
<c.magenta>你将会经常听到我说完结交易</c>

00:25:09.743 --> 00:25:12.412 align:middle line:10%
<c.magenta>这是一个很重要的知识点</c>

00:25:13.981 --> 00:25:16.683 align:middle line:10%
<c.magenta>现在让我们来详细讨论订阅</c>

00:25:16.750 --> 00:25:19.853 align:middle line:10%
<c.magenta>这些方案已经应用</c>
<c.magenta>在所有程序内购买类型之中</c>

00:25:20.087 --> 00:25:22.689 align:middle line:10%
<c.magenta>接下来我们讨论维护订阅状态</c>

00:25:22.756 --> 00:25:25.292 align:middle line:10%
<c.magenta>尤其是使用服务侧流程</c>

00:25:27.094 --> 00:25:28.996 align:middle line:10%
<c.magenta>在本例中</c>

00:25:29.630 --> 00:25:33.433 align:middle line:10%
<c.magenta>更新被发送到用户设备的交易调用</c>

00:25:33.500 --> 00:25:35.736 align:middle line:10%
<c.magenta>用户可以读取二进制收条数据</c>

00:25:35.802 --> 00:25:37.337 align:middle line:10%
<c.magenta>到用户设备的内存之中</c>

00:25:37.404 --> 00:25:40.307 align:middle line:10%
<c.magenta>它们发送信息到你的服务器</c>

00:25:41.175 --> 00:25:43.410 align:middle line:10%
<c.magenta>这次 我们准备使用稍微不同的技术</c>

00:25:43.477 --> 00:25:45.846 align:middle line:10%
<c.magenta>这是一个现实世界例子</c>

00:25:45.913 --> 00:25:49.116 align:middle line:10%
<c.magenta>我们将会在你的服务器上</c>
<c.magenta>复制二进制收条数据</c>

00:25:49.183 --> 00:25:52.686 align:middle line:10%
<c.magenta>同时发送数据副本</c>

00:25:52.753 --> 00:25:55.489 align:middle line:10%
<c.magenta>到App Store</c>
<c.magenta>以实现我们刚才看到的数据</c>

00:25:55.556 --> 00:25:57.991 align:middle line:10%
<c.magenta>将会返回最近的收条副本</c>

00:25:58.058 --> 00:26:00.994 align:middle line:10%
<c.magenta>我们可以使用同样的技术</c>
<c.magenta>在不同设备上</c>

00:25:58.058 --> 00:26:00.994 align:middle line:10%
<c.magenta>我们可以使用同样的技术</c>
<c.magenta>在不同设备上</c>

00:26:01.061 --> 00:26:02.829 align:middle line:10%
<c.magenta>完结交易和更新内容</c>

00:26:03.163 --> 00:26:07.634 align:middle line:10%
<c.magenta>在本例中 我们处理</c>
<c.magenta>一个自动续约订阅</c>

00:26:07.701 --> 00:26:10.103 align:middle line:10%
<c.magenta>假设用户离线一段时间</c>

00:26:10.170 --> 00:26:14.107 align:middle line:10%
<c.magenta>停止使用你的应用几天</c>

00:26:14.174 --> 00:26:15.475 align:middle line:90%,end
<c.magenta>可能会发生这样的情况</c>

00:26:15.542 --> 00:26:18.011 align:middle line:90%,end
<c.magenta>如果发生这样的情况</c>

00:26:18.078 --> 00:26:21.048 align:middle line:90%,end
<c.magenta>而且用户正好在此期间</c>
<c.magenta>在后台续约他们的订阅</c>

00:26:21.114 --> 00:26:22.549 align:middle line:90%,end
<c.magenta>信用卡被扣费</c>

00:26:22.816 --> 00:26:25.018 align:middle line:10%
<c.magenta>因此在某个地方发生新交易</c>

00:26:25.752 --> 00:26:26.620 align:middle line:90%,end
<c.magenta>但是你并不知情</c>

00:26:26.687 --> 00:26:28.989 align:middle line:10%
<c.magenta>然后用户重新连接到你的网站</c>

00:26:30.257 --> 00:26:32.659 align:middle line:10%
<c.magenta>服务器并没有收到</c>

00:26:32.726 --> 00:26:35.562 align:middle line:10%
<c.magenta>在后台发生的交易的任何信息</c>

00:26:36.029 --> 00:26:37.497 align:middle line:10%
<c.magenta>为了从服务的角度</c>

00:26:37.564 --> 00:26:39.199 align:middle line:10%
<c.magenta>获得这些信息</c>

00:26:39.833 --> 00:26:42.402 align:middle line:10%
<c.magenta>我们在服务器上</c>
<c.magenta>保留二进制收条数据</c>

00:26:42.469 --> 00:26:44.638 align:middle line:10%
<c.magenta>可以将数据视为令牌</c>

00:26:44.705 --> 00:26:46.940 align:middle line:10%
<c.magenta>可以通过相同的请求</c>

00:26:47.007 --> 00:26:48.075 align:middle line:10%
<c.magenta>将它发送回App Store</c>

00:26:49.743 --> 00:26:51.979 align:middle line:10%
<c.magenta>前面我说过它不仅包含</c>

00:26:52.045 --> 00:26:53.013 align:middle line:10%
<c.magenta>编码收条数据</c>

00:26:53.080 --> 00:26:56.216 align:middle line:10%
<c.magenta>而且实际上是</c>
<c.magenta>应用收条的最近副本</c>

00:26:56.283 --> 00:26:59.186 align:middle line:10%
<c.magenta>因此 这个最近副本将包含后台发生的</c>

00:26:59.253 --> 00:27:00.988 align:middle line:10%
<c.magenta>任何新交易</c>

00:26:59.253 --> 00:27:00.988 align:middle line:10%
<c.magenta>任何新交易</c>

00:27:01.054 --> 00:27:03.757 align:middle line:10%
<c.magenta>你可以发现已经发生的交易</c>

00:27:03.824 --> 00:27:06.927 align:middle line:10%
<c.magenta>而且相应地</c>
<c.magenta>让用户再次访问你的网站</c>

00:27:07.761 --> 00:27:10.631 align:middle line:90%,end
<c.magenta>然后 你可能想要</c>
<c.magenta>在多个设备上解锁内容</c>

00:27:11.064 --> 00:27:13.166 align:middle line:90%,end
<c.magenta>但你必须记住</c>
<c.magenta>当用户重新使用他们的设备</c>

00:27:13.233 --> 00:27:15.802 align:middle line:90%,end
<c.magenta>重新上线时</c>

00:27:16.170 --> 00:27:19.840 align:middle line:90%,end
<c.magenta>将会通过更新交易调用</c>
<c.magenta>接受交易</c>

00:27:20.140 --> 00:27:21.475 align:middle line:90%,end
<c.magenta>对此你仍然需要进行处理</c>

00:27:21.542 --> 00:27:23.310 align:middle line:90%,end
<c.magenta>而且应该完结交易</c>

00:27:23.377 --> 00:27:26.113 align:middle line:90%,end
<c.magenta>我们建议应该将这作为一个机会</c>

00:27:26.180 --> 00:27:29.383 align:middle line:90%,end
<c.magenta>在你的服务器上</c>
<c.magenta>更新二进制收条数据</c>

00:27:29.850 --> 00:27:32.219 align:middle line:90%,end
<c.magenta>你可能想要</c>

00:27:32.286 --> 00:27:33.687 align:middle line:90%,end
<c.magenta>为你程序关联用户的账户</c>

00:27:34.054 --> 00:27:35.722 align:middle line:90%,end
<c.magenta>应该记住</c>

00:27:35.789 --> 00:27:36.790 align:middle line:90%,end
<c.magenta>重新在设备上完结交易</c>

00:27:36.857 --> 00:27:39.126 align:middle line:10%
<c.magenta>因此 即使你的服务器</c>
<c.magenta>已经知道这个交易</c>

00:27:39.193 --> 00:27:40.928 align:middle line:10%
<c.magenta>也应该完成这个流程</c>

00:27:40.994 --> 00:27:43.630 align:middle line:10%
<c.magenta>并且按照前面所说的方法</c>
<c.magenta>完结交易</c>

00:27:44.264 --> 00:27:46.200 align:middle line:10%
<c.magenta>对于这项技术</c>
<c.magenta>我们在这里所做的事情是</c>

00:27:46.266 --> 00:27:48.769 align:middle line:90%,end
<c.magenta>将收条数据视为令牌</c>

00:27:48.836 --> 00:27:50.871 align:middle line:90%,end
<c.magenta>把它存储在你的服务器上</c>

00:27:50.938 --> 00:27:52.773 align:middle line:90%,end
<c.magenta>用它来执行多个请求</c>

00:27:53.173 --> 00:27:56.210 align:middle line:90%,end
<c.magenta>这些二进制数据</c>
<c.magenta>可以反复使用</c>

00:27:57.411 --> 00:27:59.580 align:middle line:90%,end
<c.magenta>可以用于在不同设备和平台上</c>

00:27:59.646 --> 00:28:01.481 align:middle line:90%,end
<c.magenta>传播订阅状态</c>

00:27:59.646 --> 00:28:01.481 align:middle line:90%,end
<c.magenta>传播订阅状态</c>

00:28:01.548 --> 00:28:04.351 align:middle line:90%,end
<c.magenta>但是仍然要记住</c>
<c.magenta>你必须处理</c>

00:28:04.418 --> 00:28:06.019 align:middle line:90%,end
<c.magenta>所有更新交易调用</c>

00:28:06.086 --> 00:28:07.821 align:middle line:90%,end
<c.magenta>这意味着</c>

00:28:07.888 --> 00:28:10.257 align:middle line:90%,end
<c.magenta>对于每个结算期的所有续约交易</c>

00:28:10.324 --> 00:28:12.526 align:middle line:10%
<c.magenta>必须完结这些交易</c>

00:28:15.462 --> 00:28:17.464 align:middle line:10%
<c.magenta>现在你可以想象</c>

00:28:17.531 --> 00:28:19.166 align:middle line:10%
<c.magenta>如果你要处理</c>
<c.magenta>一个自动续约订阅</c>

00:28:19.233 --> 00:28:21.935 align:middle line:10%
<c.magenta>尤其是 如果它具有较短的结算期</c>

00:28:22.002 --> 00:28:24.404 align:middle line:10%
<c.magenta>这个交易收条可能变得很大</c>

00:28:24.471 --> 00:28:27.875 align:middle line:10%
<c.magenta>所有订阅交易都会出现在收条上</c>

00:28:28.408 --> 00:28:30.811 align:middle line:90%,end
<c.magenta>随着时间的推移</c>
<c.magenta>这个文件可能变得很大</c>

00:28:31.211 --> 00:28:33.180 align:middle line:90%,end
<c.magenta>我们听说 你们很多人</c>

00:28:33.247 --> 00:28:35.315 align:middle line:90%,end
<c.magenta>只关心最近的交易</c>

00:28:35.382 --> 00:28:37.718 align:middle line:90%,end
<c.magenta>前面我一直在说</c>
<c.magenta>检查最近的截止日期</c>

00:28:37.784 --> 00:28:40.153 align:middle line:90%,end
<c.magenta>你们很多人仅关心最近的交易</c>

00:28:40.220 --> 00:28:44.091 align:middle line:90%,end
<c.magenta>因此我们增强这个端点</c>
<c.magenta>加入一个新查询参数</c>

00:28:44.157 --> 00:28:48.462 align:middle line:90%,end
<c.magenta>这个参数是</c>
<c.magenta>exclude-old-transactions</c>

00:28:48.762 --> 00:28:50.197 align:middle line:90%,end
<c.magenta>如果将它设置为真</c>

00:28:51.498 --> 00:28:53.834 align:middle line:90%,end
<c.magenta>验证收条端点将返回</c>

00:28:53.901 --> 00:28:56.503 align:middle line:90%,end
<c.magenta>每个订阅的最近交易</c>

00:28:56.570 --> 00:28:59.306 align:middle line:90%,end
<c.magenta>从而极大地减少</c>

00:28:59.373 --> 00:29:01.975 align:middle line:90%,end
<c.magenta>从验证收条端点</c>
<c.magenta>返回的数据负载量</c>

00:28:59.373 --> 00:29:01.975 align:middle line:90%,end
<c.magenta>从验证收条端点</c>
<c.magenta>返回的数据负载量</c>

00:29:02.042 --> 00:29:04.912 align:middle line:90%,end
<c.magenta>不仅节省网络流量</c>

00:29:04.978 --> 00:29:07.814 align:middle line:90%,end
<c.magenta>而且节省服务器处理时间</c>

00:29:07.881 --> 00:29:09.883 align:middle line:90%,end
<c.magenta>因此不需要处理大量的交易数据</c>

00:29:09.950 --> 00:29:12.586 align:middle line:90%,end
<c.magenta>看上去数据量并不多</c>
<c.magenta>但是 如果处理数以千计</c>

00:29:12.653 --> 00:29:14.955 align:middle line:90%,end
<c.magenta>甚至百万计的用户请求</c>

00:29:15.022 --> 00:29:16.590 align:middle line:90%,end
<c.magenta>将可以节省大量的时间</c>

00:29:16.657 --> 00:29:18.559 align:middle line:90%,end
<c.magenta>对于处理这些应用的开发者来说</c>

00:29:18.625 --> 00:29:20.427 align:middle line:90%,end
<c.magenta>这是极大的改进</c>

00:29:22.296 --> 00:29:24.264 align:middle line:90%,end
<c.magenta>状态轮询技术…</c>

00:29:26.900 --> 00:29:27.734 align:middle line:90%,end
<c.magenta>谢谢</c>

00:29:29.536 --> 00:29:33.040 align:middle line:10%
<c.magenta>此技术十分适合于</c>
<c.magenta>用作服务器端工具</c>

00:29:33.106 --> 00:29:35.876 align:middle line:10%
<c.magenta>我们来看这张图</c>

00:29:36.376 --> 00:29:39.279 align:middle line:10%
<c.magenta>你会注意到</c>
<c.magenta>这个更新和完结交易流程</c>

00:29:39.346 --> 00:29:41.415 align:middle line:10%
<c.magenta>因为仍然很重要的一点是</c>

00:29:41.481 --> 00:29:45.352 align:middle line:10%
<c.magenta>你需要在用户设备上</c>
<c.magenta>处理发生的所有交易</c>

00:29:48.021 --> 00:29:51.191 align:middle line:10%
<c.magenta>我们来看订阅</c>

00:29:57.364 --> 00:30:01.401 align:middle line:90%,end
<c.magenta>我们打开自动续约订阅</c>

00:29:57.364 --> 00:30:01.401 align:middle line:90%,end
<c.magenta>我们打开自动续约订阅</c>

00:30:01.468 --> 00:30:03.971 align:middle line:90%,end
<c.magenta>你们很多人都采用并且实现这个技术</c>

00:30:04.037 --> 00:30:05.339 align:middle line:90%,end
<c.magenta>我们听到一些反馈意见</c>

00:30:05.606 --> 00:30:09.343 align:middle line:90%,end
<c.magenta>我们尝试通过</c>
<c.magenta>iTunes Connect报告</c>

00:30:09.409 --> 00:30:12.079 align:middle line:90%,end
<c.magenta>提供用户信息</c>
<c.magenta>和用户行为方面的信息</c>

00:30:12.145 --> 00:30:14.381 align:middle line:90%,end
<c.magenta>你可以发现</c>
<c.magenta>获取了多少截止日期</c>

00:30:14.448 --> 00:30:17.184 align:middle line:90%,end
<c.magenta>但是你们有很多问题</c>

00:30:17.251 --> 00:30:19.553 align:middle line:90%,end
<c.magenta>直到现在才能够得到解答</c>

00:30:20.020 --> 00:30:22.489 align:middle line:90%,end
<c.magenta>特别是关于用户的问题</c>
<c.magenta>那么有哪些问题呢？</c>

00:30:22.556 --> 00:30:25.459 align:middle line:90%,end
<c.magenta>比如 为何发生特定用户的订阅过期？</c>

00:30:25.526 --> 00:30:28.262 align:middle line:90%,end
<c.magenta>将会在计费期结束时</c>

00:30:28.328 --> 00:30:29.997 align:middle line:90%,end
<c.magenta>续约用户的订阅吗？</c>

00:30:31.098 --> 00:30:33.700 align:middle line:10%
<c.magenta>在计费期末会降级用户吗？</c>

00:30:33.767 --> 00:30:35.068 align:middle line:10%
<c.magenta>用户是否选择</c>

00:30:35.135 --> 00:30:37.538 align:middle line:10%
<c.magenta>他们已有的订阅？</c>

00:30:38.405 --> 00:30:40.274 align:middle line:10%
<c.magenta>他们是否已经请求</c>
<c.magenta>通过AppleCare退款？</c>

00:30:40.340 --> 00:30:41.441 align:middle line:10%
<c.magenta>其中的原因是什么？</c>

00:30:41.508 --> 00:30:44.745 align:middle line:10%
<c.magenta>他们是否遇到问题</c>
<c.magenta>或者确实想要这样做？</c>

00:30:45.279 --> 00:30:47.748 align:middle line:10%
<c.magenta>他们是否同意我的涨价？</c>

00:30:48.148 --> 00:30:50.817 align:middle line:10%
<c.magenta>他们会在计费期结束时终止订阅吗？</c>

00:30:50.884 --> 00:30:52.419 align:middle line:10%
<c.magenta>我如何提前知道这些信息？</c>

00:30:52.486 --> 00:30:54.288 align:middle line:90%,end
<c.magenta>或者更简单地</c>

00:30:54.354 --> 00:30:56.623 align:middle line:90%,end
<c.magenta>我需要向用户告知</c>
<c.magenta>哪些订阅相关信息？</c>

00:30:56.690 --> 00:30:58.559 align:middle line:90%,end
<c.magenta>如何有效地</c>

00:30:58.625 --> 00:31:01.495 align:middle line:90%,end
<c.magenta>向他们告知这些信息</c>

00:30:58.625 --> 00:31:01.495 align:middle line:90%,end
<c.magenta>向他们告知这些信息</c>

00:31:01.562 --> 00:31:03.730 align:middle line:90%,end
<c.magenta>为什么所有这些问题都很重要呢？</c>

00:31:04.965 --> 00:31:07.501 align:middle line:90%,end
<c.magenta>很明显 这是为了保证良好的用户体验</c>

00:31:07.568 --> 00:31:10.604 align:middle line:90%,end
<c.magenta>这些问题之所以重要 是因为</c>

00:31:12.639 --> 00:31:15.409 align:middle line:90%,end
<c.magenta>它们关系到</c>

00:31:15.475 --> 00:31:18.645 align:middle line:90%,end
<c.magenta>用户是否会续约他们的订阅</c>

00:31:18.712 --> 00:31:22.249 align:middle line:90%,end
<c.magenta>因此应该保证良好的用户体验</c>

00:31:22.316 --> 00:31:26.186 align:middle line:90%,end
<c.magenta>必须尽量减少订阅障碍</c>

00:31:26.486 --> 00:31:29.256 align:middle line:90%,end
<c.magenta>订阅障碍会导致订阅者减少</c>

00:31:29.356 --> 00:31:31.491 align:middle line:90%,end
<c.magenta>当你失去订阅者时</c>

00:31:31.558 --> 00:31:33.594 align:middle line:90%,end
<c.magenta>就会失去收入</c>

00:31:33.694 --> 00:31:35.596 align:middle line:90%,end
<c.magenta>不仅会造成收入损失</c>

00:31:35.662 --> 00:31:38.832 align:middle line:90%,end
<c.magenta>而且造成用户招揽成本损失</c>

00:31:39.967 --> 00:31:43.303 align:middle line:90%,end
<c.magenta>我们可以从两个方面</c>
<c.magenta>来思考访问障碍</c>

00:31:43.370 --> 00:31:45.739 align:middle line:90%,end
<c.magenta>首先是非自主性障碍</c>

00:31:45.806 --> 00:31:48.809 align:middle line:90%,end
<c.magenta>也就是说 用户并没有自主地退订</c>

00:31:48.876 --> 00:31:52.379 align:middle line:90%,end
<c.magenta>比如信用卡过期</c>
<c.magenta>这是一种非自主性行为</c>

00:31:52.813 --> 00:31:53.814 align:middle line:90%,end
<c.magenta>现在…</c>

00:31:54.281 --> 00:31:56.783 align:middle line:90%,end
<c.magenta>很多用户都属于这一种情况</c>

00:31:57.651 --> 00:31:59.319 align:middle line:90%,end
<c.magenta>然后是自主性订阅障碍</c>

00:31:59.386 --> 00:32:02.723 align:middle line:90%,end
<c.magenta>在这种情况下</c>
<c.magenta>用户选择在你的程序中退订</c>

00:31:59.386 --> 00:32:02.723 align:middle line:90%,end
<c.magenta>在这种情况下</c>
<c.magenta>用户选择在你的程序中退订</c>

00:32:02.923 --> 00:32:04.925 align:middle line:90%,end
<c.magenta>也许他们请求</c>
<c.magenta>从AppleCare获得退款</c>

00:32:04.992 --> 00:32:07.661 align:middle line:90%,end
<c.magenta>或者在设置中关闭续约</c>

00:32:08.829 --> 00:32:11.265 align:middle line:90%,end
<c.magenta>我们想要为你们提供新工具</c>

00:32:11.331 --> 00:32:12.332 align:middle line:90%,end
<c.magenta>以处理这两种障碍</c>

00:32:12.399 --> 00:32:14.434 align:middle line:90%,end
<c.magenta>我们想到了一些很好的方法</c>

00:32:14.501 --> 00:32:18.138 align:middle line:90%,end
<c.magenta>我们推出一些新工具</c>
<c.magenta>帮助减少订阅障碍</c>

00:32:18.338 --> 00:32:19.173 align:middle line:90%,end
<c.magenta>让我们来看这些工具</c>

00:32:19.239 --> 00:32:21.642 align:middle line:90%,end
<c.magenta>让我们来再看一个例子</c>

00:32:22.509 --> 00:32:25.479 align:middle line:10%
<c.magenta>假设一个用户订阅你的服务</c>

00:32:25.546 --> 00:32:27.748 align:middle line:10%
<c.magenta>这是一个视频订阅服务</c>

00:32:28.515 --> 00:32:31.018 align:middle line:10%
<c.magenta>你使用状态轮询技术</c>

00:32:31.084 --> 00:32:34.821 align:middle line:10%
<c.magenta>轮询App Store</c>

00:32:34.888 --> 00:32:37.090 align:middle line:10%
<c.magenta>活跃用户</c>

00:32:37.157 --> 00:32:38.192 align:middle line:10%
<c.magenta>的最新订阅状态</c>

00:32:38.725 --> 00:32:40.961 align:middle line:10%
<c.magenta>然后用户离线几天</c>

00:32:41.962 --> 00:32:44.898 align:middle line:10%
<c.magenta>在这段时间内</c>
<c.magenta>将续约他们的订阅</c>

00:32:44.965 --> 00:32:46.300 align:middle line:10%
<c.magenta>这类似于前面的例子</c>

00:32:46.366 --> 00:32:49.536 align:middle line:10%
<c.magenta>但是 这次我们假设</c>
<c.magenta>用户的信用卡过期</c>

00:32:49.603 --> 00:32:51.738 align:middle line:10%
<c.magenta>App Store未能扣费</c>

00:32:51.972 --> 00:32:55.309 align:middle line:10%
<c.magenta>因此发生结算错误</c>
<c.magenta>然后用户重新上线</c>

00:32:55.375 --> 00:32:59.546 align:middle line:10%
<c.magenta>进入你的网站</c>
<c.magenta>想要继续观看视频</c>

00:32:59.613 --> 00:33:01.815 align:middle line:10%
<c.magenta>这时 你的服务器</c>

00:32:59.613 --> 00:33:01.815 align:middle line:10%
<c.magenta>这时 你的服务器</c>

00:33:01.882 --> 00:33:02.950 align:middle line:10%
<c.magenta>使用前面讲过的状态轮询技术</c>

00:33:03.517 --> 00:33:06.753 align:middle line:10%
<c.magenta>App Store将会告知</c>
<c.magenta>未发生交易</c>

00:33:06.820 --> 00:33:08.755 align:middle line:10%
<c.magenta>因为发生了结算错误</c>

00:33:08.822 --> 00:33:10.657 align:middle line:10%
<c.magenta>这时服务器</c>

00:33:10.724 --> 00:33:14.061 align:middle line:10%
<c.magenta>将通知网站</c>
<c.magenta>订阅已经过期</c>

00:33:14.127 --> 00:33:16.063 align:middle line:10%
<c.magenta>但这位可怜的用户</c>
<c.magenta>并没有做错什么事情</c>

00:33:16.129 --> 00:33:17.698 align:middle line:10%
<c.magenta>他的信用卡过期了</c>

00:33:17.764 --> 00:33:20.234 align:middle line:90%,end
<c.magenta>因此他更换信用卡</c>

00:33:20.300 --> 00:33:21.969 align:middle line:10%
<c.magenta>在App Store上</c>

00:33:22.035 --> 00:33:23.103 align:middle line:10%
<c.magenta>更新他的信用卡信息</c>

00:33:23.203 --> 00:33:25.172 align:middle line:10%
<c.magenta>App Store</c>
<c.magenta>使用新的信用卡信息</c>

00:33:25.239 --> 00:33:27.608 align:middle line:10%
<c.magenta>成功进行扣费</c>

00:33:27.841 --> 00:33:30.043 align:middle line:10%
<c.magenta>然后用户重新回到你的网站</c>

00:33:30.110 --> 00:33:32.679 align:middle line:10%
<c.magenta>想要观看视频</c>

00:33:33.113 --> 00:33:34.014 align:middle line:90%,end
<c.magenta>但是情况不妙</c>

00:33:34.948 --> 00:33:37.618 align:middle line:10%
<c.magenta>这时你的服务器并不知道</c>

00:33:37.684 --> 00:33:39.953 align:middle line:90%,end
<c.magenta>已经发生交易</c>

00:33:40.020 --> 00:33:42.256 align:middle line:90%,end
<c.magenta>不知道信用卡已经扣费</c>

00:33:42.322 --> 00:33:44.958 align:middle line:90%,end
<c.magenta>如果你是用户</c>

00:33:45.025 --> 00:33:47.561 align:middle line:90%,end
<c.magenta>你想尽办法更新</c>
<c.magenta>你的信用卡信息</c>

00:33:47.628 --> 00:33:50.397 align:middle line:90%,end
<c.magenta>看到钱被划走</c>

00:33:50.464 --> 00:33:52.165 align:middle line:90%,end
<c.magenta>但是你的订阅状态</c>

00:33:52.232 --> 00:33:53.567 align:middle line:90%,end
<c.magenta>并没有更新</c>

00:33:53.967 --> 00:33:57.271 align:middle line:10%
<c.magenta>你很可能会退订</c>
<c.magenta>并且直接请求退款</c>

00:33:57.337 --> 00:33:59.339 align:middle line:10%
<c.magenta>这种情况经常发生</c>

00:33:59.406 --> 00:34:01.508 align:middle line:10%
<c.magenta>为了解决这个问题</c>
<c.magenta>我们在App Store中</c>

00:33:59.406 --> 00:34:01.508 align:middle line:10%
<c.magenta>为了解决这个问题</c>
<c.magenta>我们在App Store中</c>

00:34:01.575 --> 00:34:04.645 align:middle line:10%
<c.magenta>引入新的服务器-服务器通知</c>

00:34:10.150 --> 00:34:12.886 align:middle line:90%,end
<c.magenta>让我们来看解决方案</c>

00:34:13.320 --> 00:34:15.489 align:middle line:10%
<c.magenta>用户收到信息</c>

00:34:15.556 --> 00:34:16.723 align:middle line:10%
<c.magenta>提示发生结算错误</c>

00:34:17.024 --> 00:34:19.458 align:middle line:10%
<c.magenta>于是他们更新信用卡信息</c>

00:34:19.525 --> 00:34:21.495 align:middle line:10%
<c.magenta>这次 利用新通知</c>

00:34:21.562 --> 00:34:24.364 align:middle line:10%
<c.magenta>在App Store</c>
<c.magenta>对信用卡扣费之后</c>

00:34:24.431 --> 00:34:26.766 align:middle line:10%
<c.magenta>立即通知你的服务器</c>

00:34:26.833 --> 00:34:28.768 align:middle line:10%
<c.magenta>告知发生了新交易</c>

00:34:28.835 --> 00:34:30.603 align:middle line:10%
<c.magenta>你可以使用这个交易数据</c>

00:34:30.670 --> 00:34:32.505 align:middle line:10%
<c.magenta>立即解锁用户</c>

00:34:32.572 --> 00:34:36.443 align:middle line:10%
<c.magenta>让用户能够访问网站</c>
<c.magenta>从而确保良好的用户体验</c>

00:34:36.510 --> 00:34:39.012 align:middle line:10%
<c.magenta>对于在服务器上</c>
<c.magenta>处理订阅的开发者来说</c>

00:34:39.079 --> 00:34:40.947 align:middle line:10%
<c.magenta>这非常方便实用</c>

00:34:41.181 --> 00:34:42.315 align:middle line:90%,end
<c.magenta>让我们来看</c>

00:34:42.382 --> 00:34:45.686 align:middle line:90%,end
<c.magenta>你已获得</c>
<c.magenta>iTunes Connect中的状态URL</c>

00:34:45.752 --> 00:34:47.788 align:middle line:90%,end
<c.magenta>你可以为服务器输入一个URL</c>

00:34:48.554 --> 00:34:49.590 align:middle line:90%,end
<c.magenta>你的服务器不必</c>

00:34:49.656 --> 00:34:52.125 align:middle line:90%,end
<c.magenta>遵守应用传输安全要求</c>

00:34:52.860 --> 00:34:55.629 align:middle line:90%,end
<c.magenta>如果需要遵守安全要求</c>

00:34:55.963 --> 00:34:58.966 align:middle line:90%,end
<c.magenta>可发送http端口到你的服务器</c>
<c.magenta>用于获取访问状态变更信息</c>

00:34:59.032 --> 00:35:01.034 align:middle line:90%,end
<c.magenta>我们发送的这些URL和端口</c>
<c.magenta>用于哪些事件？</c>

00:34:59.032 --> 00:35:01.034 align:middle line:90%,end
<c.magenta>我们发送的这些URL和端口</c>
<c.magenta>用于哪些事件？</c>

00:35:01.134 --> 00:35:04.238 align:middle line:90%,end
<c.magenta>它们用于任何初次订阅购买</c>

00:35:05.772 --> 00:35:07.941 align:middle line:90%,end
<c.magenta>如果AppleCare取消订阅</c>

00:35:08.008 --> 00:35:10.644 align:middle line:90%,end
<c.magenta>如果用户获得退款</c>
<c.magenta>你将会收到通知</c>

00:35:11.245 --> 00:35:13.013 align:middle line:90%,end
<c.magenta>对于任何订阅降级</c>
<c.magenta>也会执行这样的流程</c>

00:35:13.080 --> 00:35:15.282 align:middle line:90%,end
<c.magenta>因此任何时候</c>
<c.magenta>用户选择降级他们的订阅时</c>

00:35:15.349 --> 00:35:18.252 align:middle line:90%,end
<c.magenta>相应地你可以在服务器上</c>
<c.magenta>发现这一情况</c>

00:35:18.318 --> 00:35:19.686 align:middle line:90%,end
<c.magenta>并更新订阅状态</c>

00:35:20.487 --> 00:35:23.690 align:middle line:10%
<c.magenta>我们继续使用刚才的例子</c>
<c.magenta>当成功续约</c>

00:35:23.757 --> 00:35:25.726 align:middle line:10%
<c.magenta>或重新购买已到期的订阅时</c>

00:35:25.792 --> 00:35:27.661 align:middle line:10%
<c.magenta>可以立即解锁用户</c>

00:35:27.728 --> 00:35:29.630 align:middle line:10%
<c.magenta>让他们能够访问订阅内容</c>

00:35:30.964 --> 00:35:33.834 align:middle line:10%
<c.magenta>通知负载数据</c>

00:35:33.901 --> 00:35:36.603 align:middle line:10%
<c.magenta>包括实际交易的</c>

00:35:36.670 --> 00:35:38.372 align:middle line:10%
<c.magenta>最近交易数据</c>

00:35:39.206 --> 00:35:40.407 align:middle line:90%,end
<c.magenta>因此 当你这样做时</c>

00:35:40.474 --> 00:35:44.077 align:middle line:90%,end
<c.magenta>不需要像以前那样</c>
<c.magenta>频繁地轮询验证收条</c>

00:35:44.745 --> 00:35:47.381 align:middle line:90%,end
<c.magenta>你可能仍然需要</c>
<c.magenta>使用轮询调用验证收条</c>

00:35:47.447 --> 00:35:50.050 align:middle line:90%,end
<c.magenta>但是做法需要更聪明一些</c>

00:35:50.384 --> 00:35:53.453 align:middle line:90%,end
<c.magenta>也许App Store通知</c>
<c.magenta>未能到达你的服务器</c>

00:35:53.687 --> 00:35:56.823 align:middle line:90%,end
<c.magenta>你可能仍然需要</c>
<c.magenta>利用此通知来获取</c>

00:35:56.890 --> 00:35:58.458 align:middle line:90%,end
<c.magenta>订阅状态信息</c>

00:35:58.525 --> 00:36:00.494 align:middle line:90%,end
<c.magenta>但是你可以做得更聪明一些</c>

00:35:58.525 --> 00:36:00.494 align:middle line:90%,end
<c.magenta>但是你可以做得更聪明一些</c>

00:36:00.561 --> 00:36:04.231 align:middle line:90%,end
<c.magenta>也许你可以在用户</c>
<c.magenta>订阅到期前一天或当天查询</c>

00:36:04.298 --> 00:36:06.767 align:middle line:90%,end
<c.magenta>而不是每五钟查询一次</c>

00:36:07.534 --> 00:36:09.336 align:middle line:10%
<c.magenta>这些功能将会于今年晚些时候发布</c>

00:36:09.403 --> 00:36:11.205 align:middle line:10%
<c.magenta>我们认为这将会极大地</c>

00:36:11.271 --> 00:36:14.308 align:middle line:10%
<c.magenta>减少用户可能遇到的订阅障碍</c>

00:36:17.778 --> 00:36:20.714 align:middle line:90%,end
<c.magenta>让我们再来看刚才提到的问题</c>

00:36:21.515 --> 00:36:23.183 align:middle line:90%,end
<c.magenta>新通知功能</c>

00:36:23.250 --> 00:36:24.952 align:middle line:90%,end
<c.magenta>将使用我们刚才介绍的技术</c>

00:36:25.018 --> 00:36:26.353 align:middle line:90%,end
<c.magenta>极大地减少订阅障碍</c>

00:36:26.420 --> 00:36:30.023 align:middle line:10%
<c.magenta>但是我们还有很多信息</c>
<c.magenta>提供给开发者</c>

00:36:31.525 --> 00:36:34.228 align:middle line:10%
<c.magenta>尤其是有效期结束前的</c>
<c.magenta>用户相关信息</c>

00:36:34.294 --> 00:36:37.564 align:middle line:10%
<c.magenta>为了让你们能够访问这些信息</c>

00:36:37.631 --> 00:36:41.268 align:middle line:10%
<c.magenta>今天我们宣布</c>
<c.magenta>在验证收条端点中加入一些新字段</c>

00:36:41.535 --> 00:36:42.669 align:middle line:90%,end
<c.magenta>这些字段</c>

00:36:42.736 --> 00:36:44.371 align:middle line:90%,end
<c.magenta>将为你提供</c>

00:36:44.438 --> 00:36:47.407 align:middle line:90%,end
<c.magenta>用户信息和关键性</c>
<c.magenta>订阅事件信息</c>

00:36:47.474 --> 00:36:49.776 align:middle line:90%,end
<c.magenta>因此如果用户</c>
<c.magenta>在设置中关闭自动续订</c>

00:36:49.843 --> 00:36:53.413 align:middle line:90%,end
<c.magenta>你将会提前知道</c>
<c.magenta>用户将在本付费期结束后</c>

00:36:53.480 --> 00:36:54.414 align:middle line:90%,end
<c.magenta>停止订阅</c>

00:36:54.481 --> 00:36:57.784 align:middle line:90%,end
<c.magenta>也可以知道</c>
<c.magenta>用户取消订阅或接收退款</c>

00:36:58.118 --> 00:36:59.987 align:middle line:90%,end
<c.magenta>而不继续订阅</c>

00:37:00.053 --> 00:37:02.089 align:middle line:90%,end
<c.magenta>因此你可以提前</c>
<c.magenta>采取应对措施</c>

00:37:02.155 --> 00:37:05.058 align:middle line:90%,end
<c.magenta>并且根据这些信息</c>
<c.magenta>做出重要的业务决策</c>

00:37:05.158 --> 00:37:07.094 align:middle line:90%,end
<c.magenta>让我们来看加入的新字段</c>

00:37:08.262 --> 00:37:11.098 align:middle line:90%,end
<c.magenta>这是相同的请求</c>
<c.magenta>验证收条端点</c>

00:37:11.398 --> 00:37:13.333 align:middle line:90%,end
<c.magenta>现在我们加入一个自动续约状态</c>

00:37:13.767 --> 00:37:17.271 align:middle line:90%,end
<c.magenta>当用户选择关闭自动订阅续约时</c>

00:37:17.337 --> 00:37:18.939 align:middle line:90%,end
<c.magenta>你可以在他们的订阅</c>

00:37:19.006 --> 00:37:21.508 align:middle line:90%,end
<c.magenta>到期之前知道这一信息</c>

00:37:22.242 --> 00:37:24.178 align:middle line:90%,end
<c.magenta>我们还加入一个自动续约设置</c>

00:37:24.344 --> 00:37:27.347 align:middle line:90%,end
<c.magenta>如果用户选择降级</c>
<c.magenta>或更改他们的订阅设置</c>

00:37:27.414 --> 00:37:29.316 align:middle line:90%,end
<c.magenta>你可以知道他们的操作</c>

00:37:29.383 --> 00:37:32.419 align:middle line:90%,end
<c.magenta>并且了解特定付费期结束时的情况</c>

00:37:32.819 --> 00:37:34.454 align:middle line:90%,end
<c.magenta>我们还加入价格同意状态</c>

00:37:34.521 --> 00:37:37.324 align:middle line:90%,end
<c.magenta>如果你想对特定用户群</c>
<c.magenta>提高价格</c>

00:37:37.391 --> 00:37:39.660 align:middle line:90%,end
<c.magenta>你可以这样做</c>
<c.magenta>让我们来看一个例子</c>

00:37:39.726 --> 00:37:42.663 align:middle line:90%,end
<c.magenta>也许80%的用户不同意提价</c>

00:37:42.729 --> 00:37:44.131 align:middle line:90%,end
<c.magenta>他们可能会</c>

00:37:44.198 --> 00:37:45.399 align:middle line:90%,end
<c.magenta>在付费期结束时退订</c>

00:37:45.465 --> 00:37:46.567 align:middle line:90%,end
<c.magenta>在以前 你并不知道</c>

00:37:46.633 --> 00:37:48.035 align:middle line:90%,end
<c.magenta>多少用户将会退订</c>

00:37:48.101 --> 00:37:50.637 align:middle line:90%,end
<c.magenta>现在你可以根据这些信息</c>
<c.magenta>进行重要的业务决策</c>

00:37:50.737 --> 00:37:53.040 align:middle line:90%,end
<c.magenta>也许你会决定不提价</c>

00:37:53.106 --> 00:37:55.475 align:middle line:90%,end
<c.magenta>因为你可能会流失过多的订阅者</c>

00:37:57.211 --> 00:37:59.713 align:middle line:90%,end
<c.magenta>我们还增加一个订阅结算重试标记</c>

00:38:00.013 --> 00:38:03.083 align:middle line:90%,end
<c.magenta>当用户由于结算错误</c>
<c.magenta>而需要重新结算时</c>

00:38:03.150 --> 00:38:06.420 align:middle line:90%,end
<c.magenta>比如前面讲过的信用卡问题</c>

00:38:06.486 --> 00:38:09.823 align:middle line:90%,end
<c.magenta>你可以看到用户将会具有此标记</c>

00:38:09.890 --> 00:38:13.293 align:middle line:90%,end
<c.magenta>稍后我们将会演示</c>
<c.magenta>如何使用这些字段</c>

00:38:14.461 --> 00:38:17.598 align:middle line:90%,end
<c.magenta>另外还有终止原因</c>
<c.magenta>为什么用户终止订阅</c>

00:38:17.664 --> 00:38:19.867 align:middle line:90%,end
<c.magenta>是因为结算错误还是其它原因？</c>

00:38:19.933 --> 00:38:22.669 align:middle line:90%,end
<c.magenta>现在你可以知道这些信息</c>

00:38:23.403 --> 00:38:25.539 align:middle line:90%,end
<c.magenta>我们还加入取消原因</c>

00:38:25.906 --> 00:38:29.309 align:middle line:90%,end
<c.magenta>在以前 如果用户</c>
<c.magenta>获得AppleCare退款</c>

00:38:29.376 --> 00:38:31.144 align:middle line:90%,end
<c.magenta>你可能会猜想原因</c>

00:38:31.211 --> 00:38:34.815 align:middle line:90%,end
<c.magenta>现在你可以知道用户是否</c>
<c.magenta>遇到程序或程序内购买问题</c>

00:38:34.882 --> 00:38:38.785 align:middle line:90%,end
<c.magenta>还是因为某些个人原因</c>
<c.magenta>而导致用户获得退款</c>

00:38:40.020 --> 00:38:41.121 align:middle line:90%,end
<c.magenta>让我们来看一些例子</c>

00:38:41.188 --> 00:38:43.190 align:middle line:90%,end
<c.magenta>了解如何使用这些字段</c>

00:38:43.257 --> 00:38:45.492 align:middle line:90%,end
<c.magenta>来消除或减少订阅障碍</c>

00:38:45.559 --> 00:38:47.961 align:middle line:90%,end
<c.magenta>首先 让我们来看非自主性终止</c>

00:38:48.362 --> 00:38:51.598 align:middle line:90%,end
<c.magenta>在这种情况下</c>
<c.magenta>用户并没有选择退订</c>

00:38:51.899 --> 00:38:54.801 align:middle line:90%,end
<c.magenta>我们可以通过很多途径</c>
<c.magenta>来处理非自主性终止</c>

00:38:54.868 --> 00:38:57.604 align:middle line:90%,end
<c.magenta>我们需要采取办法</c>

00:38:57.671 --> 00:39:01.408 align:middle line:90%,end
<c.magenta>我们可以将重试付费时间延长为</c>

00:38:57.671 --> 00:39:01.408 align:middle line:90%,end
<c.magenta>我们可以将重试付费时间延长为</c>

00:39:01.475 --> 00:39:03.076 align:middle line:90%,end
<c.magenta>自现在起的60天</c>

00:39:03.477 --> 00:39:06.947 align:middle line:90%,end
<c.magenta>在以前如果发生结算问题</c>

00:39:07.014 --> 00:39:09.449 align:middle line:90%,end
<c.magenta>我们仅尝试</c>
<c.magenta>在几个小时之内重试信用卡扣款</c>

00:39:09.516 --> 00:39:12.252 align:middle line:90%,end
<c.magenta>现在我们延长到最多60天</c>

00:39:12.419 --> 00:39:15.656 align:middle line:90%,end
<c.magenta>我们认为这可以挽回很多的退订</c>

00:39:16.223 --> 00:39:17.558 align:middle line:90%,end
<c.magenta>在你们这边</c>

00:39:17.624 --> 00:39:19.493 align:middle line:90%,end
<c.magenta>可以做很多事情来应对这些情况</c>

00:39:20.961 --> 00:39:23.463 align:middle line:90%,end
<c.magenta>你可以使用终止原因字段</c>

00:39:23.530 --> 00:39:26.366 align:middle line:90%,end
<c.magenta>和订阅重试标记</c>
<c.magenta>来做一些重要的事情</c>

00:39:26.767 --> 00:39:29.303 align:middle line:90%,end
<c.magenta>我希望你们</c>

00:39:29.469 --> 00:39:32.306 align:middle line:90%,end
<c.magenta>记住本演讲中的三个要点</c>

00:39:32.372 --> 00:39:34.608 align:middle line:90%,end
<c.magenta>并且实施我将要讲述的三个步骤</c>

00:39:34.675 --> 00:39:37.678 align:middle line:90%,end
<c.magenta>这样你将会极大地</c>
<c.magenta>减少非自主性订阅障碍</c>

00:39:37.878 --> 00:39:41.949 align:middle line:90%,end
<c.magenta>首先 你可以使用这两个字段</c>
<c.magenta>为用户提供消息</c>

00:39:42.049 --> 00:39:43.817 align:middle line:90%,end
<c.magenta>如果你看到</c>
<c.magenta>他们发生结算错误</c>

00:39:43.884 --> 00:39:46.787 align:middle line:90%,end
<c.magenta>你可以告诉他们</c>
<c.magenta>让他们在App Store中</c>

00:39:46.854 --> 00:39:47.921 align:middle line:90%,end
<c.magenta>更新结算信息</c>

00:39:48.655 --> 00:39:49.723 align:middle line:90%,end
<c.magenta>第二</c>

00:39:50.357 --> 00:39:52.659 align:middle line:90%,end
<c.magenta>你可以为需要重试结算的用户</c>

00:39:52.726 --> 00:39:54.494 align:middle line:90%,end
<c.magenta>继续提供经过降级的或暂时性的体验</c>

00:39:54.561 --> 00:39:56.663 align:middle line:90%,end
<c.magenta>如果你看到他们需要重试结算</c>

00:39:56.730 --> 00:39:59.533 align:middle line:90%,end
<c.magenta>也许你可以允许他们</c>
<c.magenta>访问你的视频目录</c>

00:39:59.600 --> 00:40:00.901 align:middle line:90%,end
<c.magenta>但是不能观看视频</c>

00:39:59.600 --> 00:40:00.901 align:middle line:90%,end
<c.magenta>但是不能观看视频</c>

00:40:01.134 --> 00:40:04.238 align:middle line:90%,end
<c.magenta>这就是为他们提供临时性的体验</c>

00:40:04.304 --> 00:40:07.975 align:middle line:90%,end
<c.magenta>第三</c>
<c.magenta>使用这些新服务器通知</c>

00:40:08.041 --> 00:40:11.745 align:middle line:90%,end
<c.magenta>使用验证收条端点</c>
<c.magenta>或任何其它技术 在订购续约之后</c>

00:40:11.812 --> 00:40:13.981 align:middle line:90%,end
<c.magenta>立即解锁用户</c>

00:40:14.448 --> 00:40:17.484 align:middle line:90%,end
<c.magenta>这看上很容易理解</c>

00:40:17.551 --> 00:40:20.621 align:middle line:90%,end
<c.magenta>如果你做好这三件事</c>

00:40:20.687 --> 00:40:23.624 align:middle line:90%,end
<c.magenta>将可以挽回许多非自主性订阅终止</c>

00:40:25.092 --> 00:40:27.227 align:middle line:90%,end
<c.magenta>对于自主性订阅终止</c>
<c.magenta>同样可以采取措施</c>

00:40:27.294 --> 00:40:30.931 align:middle line:90%,end
<c.magenta>当用户自主地选择退订时</c>

00:40:30.998 --> 00:40:33.467 align:middle line:90%,end
<c.magenta>也可以使用这些信息</c>
<c.magenta>帮助你留住用户</c>

00:40:33.767 --> 00:40:36.170 align:middle line:90%,end
<c.magenta>现在我们加入一个终止原因字段</c>

00:40:36.236 --> 00:40:39.606 align:middle line:90%,end
<c.magenta>你可以使用此字段</c>
<c.magenta>为特定用户提供消息</c>

00:40:40.140 --> 00:40:41.942 align:middle line:90%,end
<c.magenta>假设一个用户取消订阅</c>

00:40:42.409 --> 00:40:45.479 align:middle line:90%,end
<c.magenta>你可能会想</c>
<c.magenta>“让我们想办法把用户拉回来”</c>

00:40:46.213 --> 00:40:47.948 align:middle line:90%,end
<c.magenta>你可能会降低价格</c>

00:40:48.015 --> 00:40:50.651 align:middle line:90%,end
<c.magenta>用户仍然终止订阅</c>
<c.magenta>因为他们并不认可价格</c>

00:40:50.717 --> 00:40:53.320 align:middle line:90%,end
<c.magenta>你可以推出更有吸引力的选项</c>

00:40:53.387 --> 00:40:55.889 align:middle line:90%,end
<c.magenta>因为你知道是价格原因</c>

00:40:55.956 --> 00:40:57.624 align:middle line:90%,end
<c.magenta>导致用户退订</c>

00:40:57.691 --> 00:41:00.027 align:middle line:90%,end
<c.magenta>在这些例子中 你已经了解</c>

00:40:57.691 --> 00:41:00.027 align:middle line:90%,end
<c.magenta>在这些例子中 你已经了解</c>

00:41:00.093 --> 00:41:02.663 align:middle line:90%,end
<c.magenta>如何使用这些字段</c>
<c.magenta>进行重要的业务决策</c>

00:41:02.729 --> 00:41:06.033 align:middle line:90%,end
<c.magenta>帮助调整用户互动方式</c>
<c.magenta>减少订阅障碍</c>

00:41:07.634 --> 00:41:09.403 align:middle line:90%,end
<c.magenta>这些新字段和服务器通知</c>

00:41:09.469 --> 00:41:11.405 align:middle line:90%,end
<c.magenta>将于今年末发布</c>

00:41:11.471 --> 00:41:14.775 align:middle line:90%,end
<c.magenta>我们认为 这将会</c>
<c.magenta>为所有用户带来更好的体验</c>

00:41:14.842 --> 00:41:17.678 align:middle line:90%,end
<c.magenta>帮助你提高订阅量</c>

00:41:25.052 --> 00:41:28.956 align:middle line:10%
<c.magenta>你还可以使用另一组工具</c>

00:41:29.022 --> 00:41:30.490 align:middle line:10%
<c.magenta>进行服务端订阅管理</c>

00:41:30.557 --> 00:41:32.659 align:middle line:10%
<c.magenta>和状态轮询</c>

00:41:32.926 --> 00:41:35.929 align:middle line:10%
<c.magenta>当然 你仍然需要在用户设备上</c>

00:41:35.996 --> 00:41:38.565 align:middle line:10%
<c.magenta>使用这个交易更新和完结流程</c>

00:41:39.867 --> 00:41:41.034 align:middle line:10%
<c.magenta>我们讨论了订阅</c>

00:41:41.101 --> 00:41:43.237 align:middle line:10%
<c.magenta>我还要简单讨论免费试用</c>

00:41:44.805 --> 00:41:47.107 align:middle line:90%,end
<c.magenta>免费试用是指用户可以开始订阅</c>

00:41:47.174 --> 00:41:49.142 align:middle line:90%,end
<c.magenta>但是不需要付款</c>

00:41:49.209 --> 00:41:52.579 align:middle line:90%,end
<c.magenta>只有在免费期结束后</c>
<c.magenta>才会进行收费</c>

00:41:53.614 --> 00:41:57.618 align:middle line:90%,end
<c.magenta>我们看到过这样的复杂表格</c>

00:41:57.684 --> 00:42:00.254 align:middle line:10%
<c.magenta>每个订阅周期</c>

00:41:57.684 --> 00:42:00.254 align:middle line:10%
<c.magenta>每个订阅周期</c>

00:42:00.320 --> 00:42:01.855 align:middle line:10%
<c.magenta>都有一定的免费试用期</c>

00:42:01.922 --> 00:42:04.391 align:middle line:10%
<c.magenta>你必须根据</c>
<c.magenta>你为用户提供的订阅周期</c>

00:42:04.458 --> 00:42:06.460 align:middle line:10%
<c.magenta>选择免费试用期</c>

00:42:06.527 --> 00:42:09.263 align:middle line:10%
<c.magenta>现在我们进行更改</c>
<c.magenta>让它变得更简单</c>

00:42:09.329 --> 00:42:11.832 align:middle line:10%
<c.magenta>现在你可以为任何订阅周期</c>

00:42:11.899 --> 00:42:13.233 align:middle line:10%
<c.magenta>设置任何免费试用期</c>

00:42:13.300 --> 00:42:15.435 align:middle line:10%
<c.magenta>我们认为这是一项重要的改进</c>

00:42:15.502 --> 00:42:18.372 align:middle line:10%
<c.magenta>这里也包括两个新免费试用期</c>

00:42:18.438 --> 00:42:20.574 align:middle line:10%
<c.magenta>它们是三天试用期和两周试用期</c>

00:42:20.641 --> 00:42:23.644 align:middle line:10%
<c.magenta>你可以为用户提供</c>
<c.magenta>这两个新试用期</c>

00:42:25.846 --> 00:42:27.748 align:middle line:10%
<c.magenta>关于在服务器上维护订阅状态</c>

00:42:27.814 --> 00:42:29.816 align:middle line:10%
<c.magenta>和管理自动续约订阅</c>

00:42:29.883 --> 00:42:30.884 align:middle line:10%
<c.magenta>就是这些</c>

00:42:30.951 --> 00:42:34.221 align:middle line:90%,end
<c.magenta>现在我想谈谈沙盒环境下的开发</c>

00:42:34.288 --> 00:42:37.224 align:middle line:90%,end
<c.magenta>你们可以在开发时</c>
<c.magenta>使用这些技术</c>

00:42:37.624 --> 00:42:38.992 align:middle line:90%,end
<c.magenta>什么是沙盒？</c>

00:42:39.660 --> 00:42:42.329 align:middle line:90%,end
<c.magenta>这并不是在用户设备上</c>

00:42:42.396 --> 00:42:45.465 align:middle line:90%,end
<c.magenta>对你的程序使用沙盒</c>
<c.magenta>来防止访问程序资源</c>

00:42:45.532 --> 00:42:47.167 align:middle line:90%,end
<c.magenta>这个特定的沙盒</c>

00:42:47.234 --> 00:42:51.271 align:middle line:90%,end
<c.magenta>是我们提供给你们的测试环境</c>
<c.magenta>用于测试程序内购买</c>

00:42:51.505 --> 00:42:53.507 align:middle line:90%,end
<c.magenta>在用于签名程序的证书基础上</c>

00:42:53.574 --> 00:42:55.576 align:middle line:90%,end
<c.magenta>选择沙盒</c>

00:42:55.809 --> 00:42:58.612 align:middle line:90%,end
<c.magenta>这样StoreKit就知道</c>
<c.magenta>是否处于沙盒模式</c>

00:42:58.679 --> 00:43:01.114 align:middle line:10%
<c.magenta>如果你在Xcode中</c>
<c.magenta>开发和运行你的应用</c>

00:42:58.679 --> 00:43:01.114 align:middle line:10%
<c.magenta>如果你在Xcode中</c>
<c.magenta>开发和运行你的应用</c>

00:43:01.181 --> 00:43:02.983 align:middle line:10%
<c.magenta>将使用你的开发者证书进行签名</c>

00:43:03.050 --> 00:43:06.320 align:middle line:10%
<c.magenta>StoreKit知道它需要</c>
<c.magenta>与沙盒环境通信</c>

00:43:07.087 --> 00:43:09.389 align:middle line:10%
<c.magenta>当然 若你使用App Store</c>
<c.magenta>分发你的应用</c>

00:43:09.456 --> 00:43:12.059 align:middle line:10%
<c.magenta>StoreKit就会知道</c>
<c.magenta>需要在你用于签名应用的证书基础上</c>

00:43:12.125 --> 00:43:14.761 align:middle line:10%
<c.magenta>与生产环境通信</c>

00:43:15.662 --> 00:43:17.030 align:middle line:10%
<c.magenta>你如何知道</c>

00:43:17.097 --> 00:43:19.366 align:middle line:10%
<c.magenta>当你开发应用时</c>
<c.magenta>你处于哪个环境？</c>

00:43:20.601 --> 00:43:23.103 align:middle line:90%,end
<c.magenta>当你在你的应用中</c>
<c.magenta>进行程序内购买时</c>

00:43:23.170 --> 00:43:26.240 align:middle line:10%
<c.magenta>你获得这个新支付表格</c>
<c.magenta>在今天上午的演讲上我们已经见过</c>

00:43:26.773 --> 00:43:29.109 align:middle line:10%
<c.magenta>这表示你处于沙盒模式</c>

00:43:29.176 --> 00:43:30.878 align:middle line:10%
<c.magenta>这告诉你</c>

00:43:30.944 --> 00:43:33.914 align:middle line:10%
<c.magenta>将会发生沙盒支付</c>

00:43:33.981 --> 00:43:36.350 align:middle line:10%
<c.magenta>并不会进行真正的付款</c>

00:43:37.951 --> 00:43:39.887 align:middle line:10%
<c.magenta>沙盒与生产环境的主要区别</c>

00:43:39.953 --> 00:43:41.622 align:middle line:10%
<c.magenta>当然也是最大的区别是</c>

00:43:41.688 --> 00:43:43.924 align:middle line:10%
<c.magenta>这里不会发生真正的付款</c>

00:43:43.991 --> 00:43:45.959 align:middle line:90%,end
<c.magenta>不会产生实际扣费</c>

00:43:46.026 --> 00:43:48.996 align:middle line:90%,end
<c.magenta>并不会从你的信用卡</c>

00:43:49.062 --> 00:43:49.897 align:middle line:90%,end
<c.magenta>扣取费用</c>

00:43:50.397 --> 00:43:51.798 align:middle line:90%,end
<c.magenta>进行服务器到服务器验证时</c>

00:43:51.865 --> 00:43:53.700 align:middle line:90%,end
<c.magenta>有一个不同的端点</c>

00:43:53.767 --> 00:43:56.703 align:middle line:90%,end
<c.magenta>我们为验证收条端点</c>
<c.magenta>提供一个不同的URL</c>

00:43:57.104 --> 00:43:59.706 align:middle line:90%,end
<c.magenta>你还可以在沙盒环境中</c>
<c.magenta>请求过期和作废的证书</c>

00:43:59.773 --> 00:44:03.110 align:middle line:90%,end
<c.magenta>以不同的方式进行处理</c>

00:43:59.773 --> 00:44:03.110 align:middle line:90%,end
<c.magenta>以不同的方式进行处理</c>

00:44:03.977 --> 00:44:04.978 align:middle line:90%,end
<c.magenta>另一个不同点是</c>

00:44:05.045 --> 00:44:08.215 align:middle line:90%,end
<c.magenta>可自动续约订阅的时间约束</c>

00:44:08.348 --> 00:44:10.951 align:middle line:90%,end
<c.magenta>因此 你不必等待一整年</c>
<c.magenta>来获得订阅续约</c>

00:44:11.018 --> 00:44:14.388 align:middle line:90%,end
<c.magenta>以测试你的方案</c>
<c.magenta>我们可以跟踪这些时间间隔</c>

00:44:14.454 --> 00:44:17.257 align:middle line:10%
<c.magenta>缩略规则是沙盒中的一小时</c>

00:44:17.324 --> 00:44:19.660 align:middle line:10%
<c.magenta>相当于现实世界中的一年</c>

00:44:19.726 --> 00:44:21.595 align:middle line:10%
<c.magenta>这就是沙盒中的</c>

00:44:21.662 --> 00:44:24.031 align:middle line:10%
<c.magenta>各种不同订阅时间比例关系</c>

00:44:25.165 --> 00:44:26.099 align:middle line:10%
<c.magenta>当你处于沙盒环境中</c>

00:44:26.166 --> 00:44:27.835 align:middle line:10%
<c.magenta>我们做的另一件事情是</c>

00:44:27.901 --> 00:44:30.838 align:middle line:10%
<c.magenta>如果你订阅一个自动续约订阅服务</c>

00:44:30.904 --> 00:44:35.375 align:middle line:90%,end
<c.magenta>每八小时窗口的</c>
<c.magenta>续约订阅次数最多不超过八次</c>

00:44:36.476 --> 00:44:37.811 align:middle line:90%,end
<c.magenta>然后就会过期</c>

00:44:37.878 --> 00:44:41.114 align:middle line:90%,end
<c.magenta>因此你会遇到用户订阅过期的情况</c>

00:44:41.181 --> 00:44:44.084 align:middle line:90%,end
<c.magenta>然后在你的应用中</c>
<c.magenta>进行相应的处理</c>

00:44:45.552 --> 00:44:47.487 align:middle line:90%,end
<c.magenta>在设置这种测试环境时</c>

00:44:47.554 --> 00:44:49.323 align:middle line:90%,end
<c.magenta>将通过iTunes Connect</c>
<c.magenta>完成设置</c>

00:44:49.423 --> 00:44:51.358 align:middle line:90%,end
<c.magenta>你在iTunes Connect中</c>
<c.magenta>创建测试用户</c>

00:44:51.425 --> 00:44:52.993 align:middle line:90%,end
<c.magenta>然后使用已经准备开始销售的</c>

00:44:53.060 --> 00:44:54.628 align:middle line:90%,end
<c.magenta>程序内购买产品</c>

00:44:54.695 --> 00:44:57.064 align:middle line:90%,end
<c.magenta>然后使用Xcode生成</c>
<c.magenta>并签名你的应用</c>

00:44:57.130 --> 00:44:59.867 align:middle line:90%,end
<c.magenta>使用开发者证书</c>
<c.magenta>进行生成和签名</c>

00:44:59.933 --> 00:45:02.302 align:middle line:90%,end
<c.magenta>然后在你的应用内</c>
<c.magenta>购买你的产品</c>

00:44:59.933 --> 00:45:02.302 align:middle line:90%,end
<c.magenta>然后在你的应用内</c>
<c.magenta>购买你的产品</c>

00:45:02.369 --> 00:45:03.971 align:middle line:90%,end
<c.magenta>当提示你登录时</c>

00:45:04.037 --> 00:45:06.473 align:middle line:90%,end
<c.magenta>你能使用在iTunes Connect中</c>
<c.magenta>创建的测试用户</c>

00:45:06.540 --> 00:45:08.141 align:middle line:90%,end
<c.magenta>进行登录</c>

00:45:08.909 --> 00:45:10.944 align:middle line:90%,end
<c.magenta>请注意</c>
<c.magenta>如果你开发Mac程序</c>

00:45:11.378 --> 00:45:13.146 align:middle line:10%
<c.magenta>你需要在Finder中</c>
<c.magenta>启动你的程序一次</c>

00:45:13.213 --> 00:45:16.116 align:middle line:10%
<c.magenta>以确保取回收条</c>

00:45:16.550 --> 00:45:19.286 align:middle line:90%,end
<c.magenta>这是因为前面</c>
<c.magenta>我们讲到的exit代码</c>

00:45:19.353 --> 00:45:23.090 align:middle line:90%,end
<c.magenta>在Mac计算机上</c>
<c.magenta>exit 173代码…</c>

00:45:23.156 --> 00:45:25.292 align:middle line:90%,end
<c.magenta>如果你首次在Xcode中</c>
<c.magenta>生成和运行程序</c>

00:45:25.359 --> 00:45:28.228 align:middle line:90%,end
<c.magenta>你需要确保在Finder中</c>
<c.magenta>启动二进制程序</c>

00:45:28.295 --> 00:45:31.899 align:middle line:90%,end
<c.magenta>使StoreKit能够捕获</c>
<c.magenta>exit代码并进行合适的处理</c>

00:45:33.433 --> 00:45:34.868 align:middle line:90%,end
<c.magenta>对于在服务器上使用沙盒</c>

00:45:34.935 --> 00:45:36.937 align:middle line:90%,end
<c.magenta>前面我说过</c>
<c.magenta>我们为验证收条URL</c>

00:45:37.004 --> 00:45:38.972 align:middle line:90%,end
<c.magenta>提供一个不同的端点</c>

00:45:39.039 --> 00:45:40.707 align:middle line:10%
<c.magenta>在开发环境中</c>
<c.magenta>它看起来是这样的</c>

00:45:40.774 --> 00:45:42.910 align:middle line:10%
<c.magenta>你们将具有</c>
<c.magenta>开发者签名应用</c>

00:45:42.976 --> 00:45:44.945 align:middle line:10%
<c.magenta>可能与测试服务器通信</c>

00:45:45.012 --> 00:45:47.381 align:middle line:10%
<c.magenta>测试服务器</c>
<c.magenta>可能通过不同的URL</c>

00:45:47.447 --> 00:45:48.749 align:middle line:10%
<c.magenta>与App Store沙盒通信</c>

00:45:49.583 --> 00:45:50.884 align:middle line:10%
<c.magenta>在生产中</c>
<c.magenta>你会遇到这样的情况</c>

00:45:50.951 --> 00:45:53.687 align:middle line:10%
<c.magenta>你的生产应用</c>
<c.magenta>与你的生产服务器通信</c>

00:45:53.754 --> 00:45:56.056 align:middle line:10%
<c.magenta>然后与生产App Store</c>
<c.magenta>服务器通信</c>

00:45:56.123 --> 00:45:59.159 align:middle line:10%
<c.magenta>但是在特定情况下</c>
<c.magenta>可能存在不匹配</c>

00:45:59.860 --> 00:46:01.962 align:middle line:10%
<c.magenta>这是当你的应用处于应用审查状态时</c>

00:45:59.860 --> 00:46:01.962 align:middle line:10%
<c.magenta>这是当你的应用处于应用审查状态时</c>

00:46:02.963 --> 00:46:03.931 align:middle line:10%
<c.magenta>为什么不匹配？</c>

00:46:03.997 --> 00:46:07.267 align:middle line:10%
<c.magenta>因为应用审查团队</c>
<c.magenta>实际上使用沙盒用户</c>

00:46:07.334 --> 00:46:09.570 align:middle line:10%
<c.magenta>测试你的程序内购买</c>

00:46:09.970 --> 00:46:10.871 align:middle line:10%
<c.magenta>因此看上去是这样的</c>

00:46:10.938 --> 00:46:14.608 align:middle line:10%
<c.magenta>你的生产签名应用</c>
<c.magenta>与你的生产服务器通信</c>

00:46:14.675 --> 00:46:16.910 align:middle line:10%
<c.magenta>但是你需要检查</c>
<c.magenta>沙盒用户的交易</c>

00:46:17.277 --> 00:46:19.847 align:middle line:10%
<c.magenta>以通过应用审查</c>

00:46:19.913 --> 00:46:22.349 align:middle line:10%
<c.magenta>那么 如何处理这种不匹配？</c>

00:46:22.583 --> 00:46:24.251 align:middle line:10%
<c.magenta>我们提供一个方法</c>

00:46:25.052 --> 00:46:27.321 align:middle line:10%
<c.magenta>首先 当你处于生产环境中时</c>

00:46:28.121 --> 00:46:30.891 align:middle line:10%
<c.magenta>请首先尝试生产</c>
<c.magenta>App Store URL</c>

00:46:31.325 --> 00:46:33.026 align:middle line:10%
<c.magenta>如果收条是用于沙盒环境的</c>

00:46:33.093 --> 00:46:36.230 align:middle line:10%
<c.magenta>你将收到一个错误代码21007</c>

00:46:36.630 --> 00:46:41.268 align:middle line:10%
<c.magenta>这表示你需要</c>
<c.magenta>尝试App Store沙盒</c>

00:46:41.335 --> 00:46:43.437 align:middle line:90%,end
<c.magenta>因此你可以将收条</c>
<c.magenta>保存在你的生产环境中</c>

00:46:43.504 --> 00:46:46.106 align:middle line:90%,end
<c.magenta>这意味着你的应用</c>
<c.magenta>能够通过应用审查</c>

00:46:46.173 --> 00:46:47.608 align:middle line:90%,end
<c.magenta>而不会发生问题</c>

00:46:49.576 --> 00:46:52.179 align:middle line:90%,end
<c.magenta>在新的服务器到服务器通知方面</c>

00:46:52.246 --> 00:46:53.447 align:middle line:90%,end
<c.magenta>处理方法略有不同</c>

00:46:53.514 --> 00:46:57.251 align:middle line:90%,end
<c.magenta>在iTunes Connect中</c>
<c.magenta>我们其实并没单独的URL用于沙盒</c>

00:46:57.317 --> 00:46:58.886 align:middle line:90%,end
<c.magenta>或用于你自己的测试服务器</c>

00:46:59.720 --> 00:47:03.657 align:middle line:90%,end
<c.magenta>我们使用通知的实际数据负载中的</c>
<c.magenta>参数处理这种沙盒机制</c>

00:46:59.720 --> 00:47:03.657 align:middle line:90%,end
<c.magenta>我们使用通知的实际数据负载中的</c>
<c.magenta>参数处理这种沙盒机制</c>

00:47:03.724 --> 00:47:06.360 align:middle line:90%,end
<c.magenta>有一个环境键值</c>

00:47:06.426 --> 00:47:10.197 align:middle line:90%,end
<c.magenta>告诉你通知</c>
<c.magenta>是用于沙盒环境中的订阅</c>

00:47:10.264 --> 00:47:12.099 align:middle line:90%,end
<c.magenta>还是用于生产环境中的订阅</c>

00:47:14.001 --> 00:47:15.969 align:middle line:90%,end
<c.magenta>关于沙盒环境下的开发就是这些</c>

00:47:16.036 --> 00:47:19.439 align:middle line:90%,end
<c.magenta>今天我们讲了很多的内容</c>

00:47:19.573 --> 00:47:21.341 align:middle line:90%,end
<c.magenta>让我们进行回顾</c>

00:47:21.408 --> 00:47:23.377 align:middle line:90%,end
<c.magenta>我们详细讨论了收条验证</c>

00:47:23.443 --> 00:47:26.246 align:middle line:90%,end
<c.magenta>如何在用户设备上验证</c>
<c.magenta>如何检查收条文件</c>

00:47:26.313 --> 00:47:29.216 align:middle line:90%,end
<c.magenta>以确保真实性</c>
<c.magenta>以及如何读取收条中的交易信息</c>

00:47:29.550 --> 00:47:32.152 align:middle line:90%,end
<c.magenta>然后讨论了</c>
<c.magenta>在服务器环境中</c>

00:47:32.219 --> 00:47:33.320 align:middle line:90%,end
<c.magenta>维护订阅状态</c>

00:47:33.387 --> 00:47:37.257 align:middle line:90%,end
<c.magenta>如何更新设备</c>
<c.magenta>处理验证收条端点</c>

00:47:37.958 --> 00:47:40.928 align:middle line:90%,end
<c.magenta>我们引入新的通知功能</c>

00:47:40.994 --> 00:47:43.997 align:middle line:90%,end
<c.magenta>以解锁用户</c>
<c.magenta>并挽回大量的非自主性退订</c>

00:47:44.064 --> 00:47:46.500 align:middle line:90%,end
<c.magenta>为用户提供更好的体验</c>

00:47:47.134 --> 00:47:48.902 align:middle line:90%,end
<c.magenta>我们还引入新的收条字段</c>

00:47:48.969 --> 00:47:51.839 align:middle line:90%,end
<c.magenta>可以根据用户的交易信息</c>

00:47:51.905 --> 00:47:55.275 align:middle line:90%,end
<c.magenta>做出更好的业务决策</c>
<c.magenta>而且能够更直接地向用户发送信息</c>

00:47:55.542 --> 00:47:58.111 align:middle line:90%,end
<c.magenta>请记住三个简单的步骤</c>
<c.magenta>以保留订阅者</c>

00:47:58.278 --> 00:47:59.847 align:middle line:90%,end
<c.magenta>这三个步骤帮助你取得成功</c>

00:48:00.247 --> 00:48:03.350 align:middle line:90%,end
<c.magenta>如果你完成这三个步骤</c>

00:48:03.417 --> 00:48:05.085 align:middle line:90%,end
<c.magenta>将会为你挽回大量的非自主性退订</c>

00:48:05.152 --> 00:48:06.520 align:middle line:90%,end
<c.magenta>今年末这些新字段开始启用后</c>

00:48:06.587 --> 00:48:08.455 align:middle line:90%,end
<c.magenta>请执行这些步骤</c>

00:48:08.522 --> 00:48:10.490 align:middle line:90%,end
<c.magenta>最后我们讨论了沙盒开发</c>

00:48:10.557 --> 00:48:13.093 align:middle line:90%,end
<c.magenta>你能够在沙盒环境中</c>
<c.magenta>使用这些技术</c>

00:48:13.160 --> 00:48:14.962 align:middle line:90%,end
<c.magenta>有关本演讲的更多信息</c>

00:48:15.028 --> 00:48:18.398 align:middle line:90%,end
<c.magenta>请观看幻灯片</c>
<c.magenta>请访问这个链接 演讲305</c>

00:48:18.465 --> 00:48:20.734 align:middle line:90%,end
<c.magenta>可以在开发者网站上</c>
<c.magenta>观看这个视频</c>

00:48:21.335 --> 00:48:23.737 align:middle line:90%,end
<c.magenta>本周我们举行了一些相关的演讲</c>

00:48:23.804 --> 00:48:25.105 align:middle line:90%,end
<c.magenta>现在快到周末了</c>

00:48:25.205 --> 00:48:28.041 align:middle line:90%,end
<c.magenta>今天下午我们仍然会在这里</c>

00:48:28.108 --> 00:48:30.677 align:middle line:90%,end
<c.magenta>这里有整个企业的客户端和</c>

00:48:30.744 --> 00:48:33.814 align:middle line:90%,end
<c.magenta>服务器端的工程师</c>

00:48:33.881 --> 00:48:34.882 align:middle line:90%,end
<c.magenta>聚集在StoreKit实验室</c>

00:48:34.948 --> 00:48:36.783 align:middle line:90%,end
<c.magenta>今天下午和明天下午</c>

00:48:36.850 --> 00:48:39.753 align:middle line:90%,end
<c.magenta>欢迎大家前来提问</c>

00:48:39.820 --> 00:48:40.921 align:middle line:90%,end
<c.magenta>我们将解答你们的问题</c>

00:48:40.988 --> 00:48:43.624 align:middle line:90%,end
<c.magenta>并且讨论</c>
<c.magenta>你应该如何构建你的解决方案</c>

00:48:43.857 --> 00:48:45.659 align:middle line:90%,end
<c.magenta>感谢大家今天来参加演讲</c>

00:48:45.726 --> 00:48:47.261 align:middle line:90%,end
<c.magenta>谢谢大家 下午过得愉快</c>
