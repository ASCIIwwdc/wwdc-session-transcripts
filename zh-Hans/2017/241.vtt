WEBVTT

00:00:07.516 --> 00:00:18.500 A:middle
[掌声]

00:00:20.276 --> 00:00:20.966 A:middle
&gt;&gt; 上午好

00:00:21.016 --> 00:00:22.226 A:middle
[掌声]

00:00:22.226 --> 00:00:22.826 A:middle
太棒了

00:00:23.126 --> 00:00:24.216 A:middle
非常感谢

00:00:25.256 --> 00:00:27.136 A:middle
那么  欢迎参加今天的讲坛

00:00:27.346 --> 00:00:29.226 A:middle
对 iOS 版 PDFKit 的介绍

00:00:29.886 --> 00:00:31.206 A:middle
过去这 12 个月里

00:00:31.206 --> 00:00:32.566 A:middle
我们做了许多改动

00:00:32.566 --> 00:00:34.126 A:middle
我们特别激动地想让大家

00:00:34.126 --> 00:00:35.186 A:middle
看到所有的改动

00:00:35.186 --> 00:00:35.906 A:middle
所有的重大改进

00:00:36.546 --> 00:00:37.886 A:middle
但在开始前

00:00:37.886 --> 00:00:38.726 A:middle
先介绍一下自己

00:00:38.756 --> 00:00:39.786 A:middle
我叫 Jeremy Bridon

00:00:39.786 --> 00:00:40.926 A:middle
是 Apple 的软件工程师

00:00:40.926 --> 00:00:42.326 A:middle
负责核心图形的工作

00:00:42.366 --> 00:00:42.696 A:middle
然后

00:00:42.926 --> 00:00:44.256 A:middle
&gt;&gt; 我是 Nicki Brower

00:00:44.256 --> 00:00:45.616 A:middle
也是 Apple 的软件工程师

00:00:45.876 --> 00:00:46.276 A:middle
&gt;&gt; 真棒

00:00:47.606 --> 00:00:47.926 A:middle
好

00:00:48.346 --> 00:00:49.456 A:middle
今天我们有

00:00:49.456 --> 00:00:50.566 A:middle
很多东西想讲

00:00:50.566 --> 00:00:51.326 A:middle
不过首先要讲的

00:00:51.326 --> 00:00:52.956 A:middle
还是 PDF 文件格式

00:00:52.956 --> 00:00:53.516 A:middle
本身

00:00:54.006 --> 00:00:55.396 A:middle
然后我们会

00:00:55.396 --> 00:00:56.826 A:middle
留些时间讨论一下

00:00:57.116 --> 00:00:59.216 A:middle
整个框架  接着

00:00:59.216 --> 00:01:00.526 A:middle
讨论一下文档页面

00:00:59.216 --> 00:01:00.526 A:middle
讨论一下文档页面

00:01:00.526 --> 00:01:02.256 A:middle
和这个框架

00:01:02.256 --> 00:01:02.626 A:middle
用到的 annotation 模型

00:01:03.146 --> 00:01:04.556 A:middle
最后我们会深入地

00:01:04.556 --> 00:01:06.016 A:middle
讲一下 annotation

00:01:06.406 --> 00:01:07.666 A:middle
那么  annotation 是我们

00:01:07.666 --> 00:01:09.016 A:middle
在今年改动最多的一块

00:01:09.016 --> 00:01:10.016 A:middle
听取了像你们一样的

00:01:10.016 --> 00:01:10.986 A:middle
开发者的很多意见

00:01:11.256 --> 00:01:12.396 A:middle
所以在今年

00:01:12.396 --> 00:01:13.766 A:middle
我们想要多花些心思

00:01:13.766 --> 00:01:14.386 A:middle
好好解释一下这部分

00:01:15.196 --> 00:01:17.196 A:middle
最后为了各位开发者们

00:01:17.196 --> 00:01:18.326 A:middle
不论是老手还是新手

00:01:18.326 --> 00:01:19.886 A:middle
我们会讨论一下最佳实践

00:01:19.926 --> 00:01:21.276 A:middle
也就是我们建议大家使用的做法

00:01:22.126 --> 00:01:22.496 A:middle
好

00:01:23.526 --> 00:01:24.976 A:middle
让我们先来聊一下

00:01:24.976 --> 00:01:27.896 A:middle
PDF 文件格式的规范说明

00:01:28.136 --> 00:01:30.446 A:middle
1300 页根本没法

00:01:30.446 --> 00:01:32.516 A:middle
让人看完和弄懂

00:01:32.516 --> 00:01:33.786 A:middle
PDF 文件格式的原理

00:01:33.786 --> 00:01:35.436 A:middle
对吧大家都是应用开发者

00:01:35.436 --> 00:01:36.266 A:middle
我们希望大家不必为

00:01:36.346 --> 00:01:37.906 A:middle
细致入微的规范操心

00:01:37.906 --> 00:01:39.486 A:middle
照样能够开发出

00:01:39.566 --> 00:01:40.476 A:middle
厉害的应用来

00:01:41.036 --> 00:01:42.236 A:middle
于是我们就设计了

00:01:42.236 --> 00:01:43.526 A:middle
一套出色的框架

00:01:43.526 --> 00:01:45.606 A:middle
让大家不用读完那些规范

00:01:45.606 --> 00:01:46.686 A:middle
就能发挥出 PDF 的强大力量

00:01:47.136 --> 00:01:48.376 A:middle
我们全读完了

00:01:48.376 --> 00:01:50.026 A:middle
所以大家就不用读了

00:01:50.446 --> 00:01:51.706 A:middle
那么首先

00:01:51.706 --> 00:01:52.096 A:middle
为什么要用 PDF

00:01:52.176 --> 00:01:53.946 A:middle
这么说好了

00:01:53.946 --> 00:01:55.226 A:middle
PDF 是种通用的商务格式

00:01:55.416 --> 00:01:57.106 A:middle
它的使用很广泛

00:01:57.106 --> 00:01:58.666 A:middle
医疗界  金融界  政府

00:01:58.766 --> 00:02:01.086 A:middle
商务都有应用

00:01:58.766 --> 00:02:01.086 A:middle
商务都有应用

00:02:01.086 --> 00:02:02.136 A:middle
PDF 如此普及是因为

00:02:02.136 --> 00:02:04.076 A:middle
它确实有些很出色的特性

00:02:04.076 --> 00:02:05.906 A:middle
比如可靠的加密功能

00:02:06.006 --> 00:02:07.656 A:middle
还有灵活多变的权限模型

00:02:07.956 --> 00:02:09.036 A:middle
这些确实出色的地方

00:02:09.036 --> 00:02:10.205 A:middle
对各位开发者来说

00:02:10.205 --> 00:02:12.076 A:middle
十分适用  也能满足

00:02:12.076 --> 00:02:13.396 A:middle
商务需要

00:02:14.166 --> 00:02:15.626 A:middle
PDF 还有一个

00:02:15.626 --> 00:02:17.176 A:middle
很厉害的地方

00:02:17.176 --> 00:02:17.536 A:middle
就是它的交互模型

00:02:17.616 --> 00:02:19.056 A:middle
对吧  它不只是一份

00:02:19.096 --> 00:02:20.466 A:middle
静态文档打印出来

00:02:20.466 --> 00:02:21.106 A:middle
就被你忘在一边

00:02:21.106 --> 00:02:22.826 A:middle
它的电子版文档

00:02:22.826 --> 00:02:24.606 A:middle
可以做到全面的交互

00:02:24.606 --> 00:02:25.886 A:middle
所以我要向大家

00:02:25.886 --> 00:02:26.906 A:middle
介绍几款工具让大家

00:02:26.906 --> 00:02:28.346 A:middle
能在我们的平台上

00:02:28.346 --> 00:02:29.016 A:middle
做到与 PDF 文档的交互

00:02:29.826 --> 00:02:31.706 A:middle
当然如果要做

00:02:31.706 --> 00:02:32.766 A:middle
PDF 文档的交互

00:02:32.876 --> 00:02:34.326 A:middle
最棒的效果就是

00:02:34.326 --> 00:02:35.506 A:middle
电子版是什么样

00:02:35.506 --> 00:02:37.006 A:middle
印刷成实体版后

00:02:37.006 --> 00:02:37.726 A:middle
还是什么样

00:02:38.186 --> 00:02:39.926 A:middle
但是当中涉及的规格

00:02:39.926 --> 00:02:41.416 A:middle
实在太复杂还有

00:02:41.416 --> 00:02:42.506 A:middle
很多细节要考虑

00:02:42.766 --> 00:02:44.356 A:middle
如今我们要如何

00:02:44.356 --> 00:02:45.056 A:middle
处理这些问题呢

00:02:45.446 --> 00:02:45.776 A:middle
Nicki

00:02:46.566 --> 00:02:48.266 A:middle
&gt;&gt; 好的

00:02:48.516 --> 00:02:49.636 A:middle
所以我们很看重 PDF

00:02:49.636 --> 00:02:51.226 A:middle
希望能把它

00:02:51.226 --> 00:02:51.996 A:middle
涵盖在我们的应用中

00:02:52.336 --> 00:02:52.936 A:middle
那要怎么做呢

00:02:53.596 --> 00:02:54.886 A:middle
我们已经为大家

00:02:54.886 --> 00:02:56.356 A:middle
做好了一套解决方案

00:02:56.356 --> 00:02:57.496 A:middle
而且是套比较底层的方案

00:02:57.496 --> 00:02:58.996 A:middle
用的是 CoreGraphics PDF 框架

00:02:59.586 --> 00:03:00.756 A:middle
这套框架很了不起

00:02:59.586 --> 00:03:00.756 A:middle
这套框架很了不起

00:03:00.756 --> 00:03:02.016 A:middle
因为它有一套基于 PDF 规格的

00:03:02.016 --> 00:03:03.366 A:middle
一对一绘制模型

00:03:03.856 --> 00:03:05.556 A:middle
能让你读写和

00:03:05.556 --> 00:03:07.736 A:middle
编辑文档它还有

00:03:07.736 --> 00:03:09.146 A:middle
PDF 压制器

00:03:09.146 --> 00:03:10.156 A:middle
PDF 渲染器

00:03:10.156 --> 00:03:10.736 A:middle
不用你自己创建

00:03:11.476 --> 00:03:12.486 A:middle
不过它也有

00:03:12.486 --> 00:03:12.716 A:middle
一些局限

00:03:13.186 --> 00:03:14.406 A:middle
它不含任何

00:03:14.406 --> 00:03:15.926 A:middle
AppKit 基元

00:03:15.926 --> 00:03:17.076 A:middle
这意味着你没法

00:03:17.076 --> 00:03:18.176 A:middle
与文档实时交互

00:03:18.676 --> 00:03:20.116 A:middle
意味着不支持文本选取

00:03:20.316 --> 00:03:22.346 A:middle
不支持搜索结果高亮

00:03:22.346 --> 00:03:23.586 A:middle
不支持 annotation 交互

00:03:23.586 --> 00:03:24.886 A:middle
也不提供任何

00:03:24.886 --> 00:03:25.856 A:middle
可访问性支持

00:03:26.216 --> 00:03:27.946 A:middle
这时候就要靠

00:03:27.946 --> 00:03:28.166 A:middle
PDFKit 了

00:03:28.616 --> 00:03:30.516 A:middle
所以 PDFKit 的构建基于

00:03:30.516 --> 00:03:32.006 A:middle
CoreGraphics 框架

00:03:32.006 --> 00:03:33.936 A:middle
但它同时整合了 AppKit

00:03:33.936 --> 00:03:35.106 A:middle
可以让你与文档

00:03:35.106 --> 00:03:35.596 A:middle
进行实时互动

00:03:36.086 --> 00:03:37.926 A:middle
然后在今年我们在针对

00:03:37.926 --> 00:03:40.166 A:middle
iOS 平台开发不光是 AppKit

00:03:40.296 --> 00:03:41.356 A:middle
也包括 UIKit

00:03:41.756 --> 00:03:43.326 A:middle
所以现在你能更轻松地

00:03:43.326 --> 00:03:45.456 A:middle
打开修改绘制 PDF 文档

00:03:45.456 --> 00:03:46.576 A:middle
而且还能

00:03:46.576 --> 00:03:47.226 A:middle
添加交互

00:03:47.226 --> 00:03:48.806 A:middle
你可以选取文本

00:03:48.806 --> 00:03:49.906 A:middle
可以与 annotation 交互

00:03:50.016 --> 00:03:51.776 A:middle
我还想特别指出

00:03:51.776 --> 00:03:53.836 A:middle
在今年我们下了

00:03:53.836 --> 00:03:54.836 A:middle
很大功夫来改进

00:03:54.836 --> 00:03:55.836 A:middle
可访问性支持

00:03:56.426 --> 00:03:58.346 A:middle
所以只要使用 PDFKit

00:03:58.346 --> 00:04:00.516 A:middle
就能做到文本朗读文本提取

00:03:58.346 --> 00:04:00.516 A:middle
就能做到文本朗读文本提取

00:04:00.786 --> 00:04:01.956 A:middle
能够填写表格

00:04:01.956 --> 00:04:03.336 A:middle
全部是免费功能

00:04:04.696 --> 00:04:05.236 A:middle
好

00:04:05.236 --> 00:04:06.016 A:middle
我们再来看一下

00:04:06.016 --> 00:04:06.976 A:middle
PDFKit 现在的进展

00:04:09.876 --> 00:04:11.496 A:middle
在 Mac 上可以看到

00:04:11.496 --> 00:04:13.246 A:middle
Preview 和 Safari 都有用到它

00:04:13.246 --> 00:04:14.846 A:middle
这也是我们的主要客户

00:04:14.846 --> 00:04:16.166 A:middle
但在各种平台上

00:04:16.166 --> 00:04:16.406 A:middle
都有我们的身影

00:04:16.836 --> 00:04:18.946 A:middle
我刚才就提到了 iOS

00:04:18.995 --> 00:04:20.326 A:middle
大家可以看到 iBooks

00:04:20.326 --> 00:04:22.125 A:middle
Mail 和 QuickLooks 都在用它

00:04:22.125 --> 00:04:23.446 A:middle
希望台下各位开发的应用

00:04:23.446 --> 00:04:24.546 A:middle
也能出现在我们的

00:04:24.546 --> 00:04:25.686 A:middle
客户名单中

00:04:26.676 --> 00:04:27.856 A:middle
我们再来看一下

00:04:27.886 --> 00:04:28.836 A:middle
我们这套框架的概览

00:04:29.396 --> 00:04:30.706 A:middle
PDFKit 里所有的分类

00:04:30.706 --> 00:04:32.286 A:middle
全部可以分为

00:04:32.286 --> 00:04:32.856 A:middle
三个类别

00:04:33.256 --> 00:04:34.716 A:middle
分别是 View  Document

00:04:34.716 --> 00:04:36.766 A:middle
和 Support

00:04:36.766 --> 00:04:38.596 A:middle
每一种类别都有

00:04:38.596 --> 00:04:39.306 A:middle
自己的一组类

00:04:39.446 --> 00:04:41.536 A:middle
比如说 View

00:04:41.536 --> 00:04:43.606 A:middle
就有 PDFView 和 PDFThumbnailView

00:04:43.906 --> 00:04:45.646 A:middle
鉴于我们支持不同的平台

00:04:45.646 --> 00:04:47.446 A:middle
这意味着在 Mac OS 上

00:04:47.446 --> 00:04:48.656 A:middle
会变成 NSView  在 iOS 上

00:04:48.746 --> 00:04:49.276 A:middle
会变成 UIView

00:04:49.756 --> 00:04:51.216 A:middle
对于 Document 包含的类有

00:04:51.216 --> 00:04:52.436 A:middle
PDFDocument PDFPage

00:04:52.436 --> 00:04:54.086 A:middle
和PDFAnnotation 我们会在

00:04:54.086 --> 00:04:54.676 A:middle
稍后具体讲解

00:04:55.476 --> 00:04:56.626 A:middle
我们还有一组

00:04:56.626 --> 00:04:57.116 A:middle
归在 Support 下的类

00:04:57.456 --> 00:04:58.326 A:middle
其中包括

00:04:58.326 --> 00:05:00.646 A:middle
PDFSelection 用于完成我刚才提到的

00:04:58.326 --> 00:05:00.646 A:middle
PDFSelection 用于完成我刚才提到的

00:05:00.646 --> 00:05:02.486 A:middle
PDF 文本选取 PDFOutline 用于

00:05:02.486 --> 00:05:03.706 A:middle
创建内容的目录

00:05:04.166 --> 00:05:06.906 A:middle
PDFAction 用于URL跳转

00:05:06.906 --> 00:05:07.246 A:middle
还有其他的一些

00:05:08.066 --> 00:05:09.706 A:middle
不过实际应用时

00:05:09.706 --> 00:05:10.906 A:middle
其实只要其中4种

00:05:10.906 --> 00:05:12.636 A:middle
核心类别就能做到

00:05:12.866 --> 00:05:13.796 A:middle
你想要的大部分功能

00:05:13.796 --> 00:05:15.326 A:middle
那就是 PDFView

00:05:15.326 --> 00:05:16.486 A:middle
PDFDocument  PDFPage

00:05:16.486 --> 00:05:17.000 A:middle
还有 PDFAnnotation

00:05:18.606 --> 00:05:21.946 A:middle
不过为了进一步简化

00:05:21.946 --> 00:05:23.646 A:middle
要创建一个基础框架的应用

00:05:23.646 --> 00:05:25.426 A:middle
来显示 PDF 和支持交互

00:05:25.426 --> 00:05:26.746 A:middle
真正需要你熟悉的

00:05:26.746 --> 00:05:28.596 A:middle
只有 PDFView

00:05:28.596 --> 00:05:29.326 A:middle
下面 Jeremy 会为大家

00:05:29.326 --> 00:05:29.660 A:middle
讲解它的用法

00:05:32.516 --> 00:05:40.016 A:middle
[掌声]

00:05:40.516 --> 00:05:41.056 A:middle
&gt;&gt; 讲得很棒

00:05:41.486 --> 00:05:42.386 A:middle
非常感谢 Nicki

00:05:42.936 --> 00:05:43.396 A:middle
好

00:05:43.396 --> 00:05:44.826 A:middle
所以我们想要强调

00:05:44.966 --> 00:05:47.226 A:middle
通过对 PDFKit 的很多

00:05:47.226 --> 00:05:48.786 A:middle
简单运用你能轻而易举地

00:05:49.076 --> 00:05:51.166 A:middle
发挥出 PDF 的强大力量

00:05:51.566 --> 00:05:53.176 A:middle
也就是说

00:05:53.176 --> 00:05:53.686 A:middle
我这里有个演示应用

00:05:53.686 --> 00:05:54.916 A:middle
是一个桌面程序

00:05:55.196 --> 00:05:56.296 A:middle
它的代码十分简单

00:05:56.296 --> 00:05:57.626 A:middle
就是一个 View Controller

00:05:57.626 --> 00:05:58.866 A:middle
和一个 View 就这两个

00:05:59.476 --> 00:06:00.506 A:middle
在 View Controller 的

00:05:59.476 --> 00:06:00.506 A:middle
在 View Controller 的

00:06:00.506 --> 00:06:01.606 A:middle
源码中我们

00:06:01.606 --> 00:06:01.896 A:middle
可以看到

00:06:01.896 --> 00:06:03.366 A:middle
这里只有三段代码

00:06:03.366 --> 00:06:03.966 A:middle
需要我们注意

00:06:04.586 --> 00:06:06.126 A:middle
第一段是用父 bounds 为

00:06:06.126 --> 00:06:08.256 A:middle
PDFView 创建一个实例

00:06:08.256 --> 00:06:09.176 A:middle
我们知道这会填满

00:06:09.176 --> 00:06:10.146 A:middle
Startup 中的相应窗口

00:06:10.726 --> 00:06:12.176 A:middle
然后使用 autoresizingMask

00:06:12.176 --> 00:06:13.786 A:middle
确保显示画面始终会

00:06:13.946 --> 00:06:15.566 A:middle
填满窗口这样在我们

00:06:15.566 --> 00:06:16.796 A:middle
调整窗口大小时显示画面

00:06:16.796 --> 00:06:17.326 A:middle
也会一直跟着变化

00:06:17.856 --> 00:06:19.446 A:middle
最后才是一段真正的

00:06:19.446 --> 00:06:21.686 A:middle
PDFKit 代码

00:06:21.686 --> 00:06:22.846 A:middle
就是 allowDragging  (允许拖动)

00:06:23.246 --> 00:06:24.906 A:middle
也就是说

00:06:24.906 --> 00:06:26.786 A:middle
当我打开这个程序时

00:06:26.786 --> 00:06:29.086 A:middle
我可以拖动放下我的 PDF 文件

00:06:29.086 --> 00:06:31.476 A:middle
比如现在就是在桌面上操作

00:06:31.476 --> 00:06:32.896 A:middle
整个过程完全支持交互

00:06:32.896 --> 00:06:35.076 A:middle
外观感觉性能

00:06:35.136 --> 00:06:37.326 A:middle
都和 Preview Safari 一样

00:06:37.326 --> 00:06:38.786 A:middle
也和其他所有的

00:06:38.786 --> 00:06:39.606 A:middle
第一方应用一样

00:06:40.136 --> 00:06:41.356 A:middle
这里我要说的是

00:06:41.466 --> 00:06:42.746 A:middle
它免费支持文本选取

00:06:42.866 --> 00:06:44.166 A:middle
它有查看器不用多说

00:06:44.166 --> 00:06:45.476 A:middle
如果拉到目录这里

00:06:45.476 --> 00:06:46.286 A:middle
我们可以看到

00:06:46.286 --> 00:06:46.776 A:middle
它全面支持交互

00:06:46.916 --> 00:06:47.816 A:middle
我可以点击一下

00:06:47.816 --> 00:06:48.216 A:middle
就直接跳转

00:06:48.536 --> 00:06:49.676 A:middle
我也可以右击

00:06:49.676 --> 00:06:51.556 A:middle
然后可以改变排列格式

00:06:51.556 --> 00:06:52.866 A:middle
也可以改变许多其他选项

00:06:52.866 --> 00:06:54.396 A:middle
我可以复制文本搜索文本

00:06:55.336 --> 00:06:56.636 A:middle
最厉害的是

00:06:56.636 --> 00:06:57.816 A:middle
所有这些特性

00:06:57.816 --> 00:06:59.446 A:middle
你们这些开发者全都能用

00:06:59.596 --> 00:07:00.756 A:middle
大家可以通过编程

00:06:59.596 --> 00:07:00.756 A:middle
大家可以通过编程

00:07:00.756 --> 00:07:01.996 A:middle
驾驭这些改进

00:07:03.286 --> 00:07:05.766 A:middle
好

00:07:06.326 --> 00:07:07.666 A:middle
我前面对 PDFView 的介绍

00:07:07.666 --> 00:07:08.806 A:middle
比较笼统  现在让我

00:07:08.866 --> 00:07:10.166 A:middle
再多讲些细节

00:07:10.566 --> 00:07:12.596 A:middle
PDFViewer 全面支持自定义

00:07:12.596 --> 00:07:14.186 A:middle
但又简单易用

00:07:14.756 --> 00:07:15.546 A:middle
而且我所说的

00:07:15.546 --> 00:07:16.756 A:middle
全面支持自定义是指

00:07:16.756 --> 00:07:17.636 A:middle
你可以改动页面布局

00:07:17.636 --> 00:07:19.636 A:middle
方向页面内边距

00:07:19.916 --> 00:07:21.076 A:middle
还可以改动很多其他元素

00:07:21.076 --> 00:07:22.536 A:middle
比如缩放选项和

00:07:22.536 --> 00:07:23.106 A:middle
缩放行为

00:07:23.666 --> 00:07:25.006 A:middle
它也很适合进行

00:07:25.006 --> 00:07:26.916 A:middle
视图到内容

00:07:26.916 --> 00:07:28.186 A:middle
和内容到视图的

00:07:28.186 --> 00:07:28.696 A:middle
坐标转换

00:07:29.086 --> 00:07:30.606 A:middle
也就是说当你用手指

00:07:30.606 --> 00:07:31.866 A:middle
操作 iOS  并且轻点了一下

00:07:32.006 --> 00:07:33.716 A:middle
PDFView 时我们其实会

00:07:33.716 --> 00:07:35.026 A:middle
对这下轻点进行转换

00:07:35.026 --> 00:07:35.846 A:middle
找出它在文档中和

00:07:35.976 --> 00:07:37.606 A:middle
在你触击页面中的

00:07:37.606 --> 00:07:38.116 A:middle
精确方位

00:07:39.746 --> 00:07:41.496 A:middle
我前面还提到

00:07:41.816 --> 00:07:43.346 A:middle
它简单易用

00:07:43.346 --> 00:07:44.156 A:middle
那么我给大家

00:07:44.156 --> 00:07:45.306 A:middle
看个简单直观的例子

00:07:45.306 --> 00:07:46.606 A:middle
看要如何将一个文档

00:07:46.606 --> 00:07:47.276 A:middle
在 PDFView 里进行设定

00:07:47.596 --> 00:07:49.216 A:middle
在这里我们用一个 URL

00:07:49.216 --> 00:07:51.546 A:middle
来初始化一个文档

00:07:51.546 --> 00:07:52.746 A:middle
然后将这个文档

00:07:52.746 --> 00:07:53.436 A:middle
赋给 View

00:07:53.796 --> 00:07:55.506 A:middle
其余的工作由我们代劳

00:07:55.956 --> 00:07:57.136 A:middle
无论这个文档的

00:07:57.136 --> 00:07:58.486 A:middle
内容是什么我们都会

00:07:58.486 --> 00:07:59.296 A:middle
用 PDFView 显示出来

00:08:00.856 --> 00:08:02.596 A:middle
前面又讲了

00:08:02.596 --> 00:08:03.416 A:middle
更多的显示设置

00:08:03.416 --> 00:08:04.506 A:middle
我想再给大家

00:08:04.506 --> 00:08:05.566 A:middle
看几个枚举

00:08:05.926 --> 00:08:07.856 A:middle
PDFDisplayMode 特别厉害

00:08:07.856 --> 00:08:09.016 A:middle
你可以改变

00:08:09.286 --> 00:08:11.006 A:middle
文档在你的 PDFView

00:08:11.006 --> 00:08:11.756 A:middle
里面的设置

00:08:12.326 --> 00:08:13.636 A:middle
它的第一个值

00:08:13.636 --> 00:08:14.976 A:middle
是 singlePage 当然就是

00:08:14.976 --> 00:08:15.796 A:middle
一次只能看一个页面

00:08:16.206 --> 00:08:17.446 A:middle
此外还有

00:08:17.446 --> 00:08:19.156 A:middle
singlePageContinuous 意思是

00:08:19.156 --> 00:08:20.826 A:middle
在垂直方向上

00:08:20.826 --> 00:08:21.986 A:middle
连续显示页面

00:08:22.556 --> 00:08:24.046 A:middle
此外还有 twoUp 模式

00:08:24.046 --> 00:08:24.946 A:middle
可以让你做出这种

00:08:24.996 --> 00:08:26.706 A:middle
iBooks 的样式和效果

00:08:26.706 --> 00:08:27.936 A:middle
当然也有

00:08:27.936 --> 00:08:29.496 A:middle
twoUpContinuous

00:08:29.496 --> 00:08:29.976 A:middle
选择很多

00:08:30.986 --> 00:08:33.366 A:middle
接下来我们在 2017 年

00:08:33.366 --> 00:08:34.546 A:middle
新推出了 PDFDisplayDirection

00:08:34.546 --> 00:08:35.546 A:middle
所以大家在考虑

00:08:35.546 --> 00:08:36.746 A:middle
连续显示模式时

00:08:36.785 --> 00:08:37.876 A:middle
不必拘泥于垂直方向

00:08:37.876 --> 00:08:39.706 A:middle
也可以使用水平方向

00:08:39.706 --> 00:08:40.876 A:middle
当然这个特性目前

00:08:40.916 --> 00:08:41.765 A:middle
在两个平台上都有提供

00:08:42.706 --> 00:08:44.746 A:middle
我们今年还专门针对 iOS

00:08:44.746 --> 00:08:46.356 A:middle
推出了 View Pagification

00:08:46.696 --> 00:08:47.876 A:middle
也就是说我们想让大家

00:08:47.876 --> 00:08:49.226 A:middle
在自己的应用中也能呈现

00:08:49.226 --> 00:08:50.866 A:middle
iBooks 的外观和效果

00:08:50.866 --> 00:08:52.426 A:middle
要做到这一点

00:08:52.426 --> 00:08:53.086 A:middle
只要开启这个特性就好

00:08:53.596 --> 00:08:54.516 A:middle
所以你可以将手指

00:08:54.516 --> 00:08:55.666 A:middle
放在设备上左右滑动

00:08:55.666 --> 00:08:56.846 A:middle
它会即时响应

00:08:56.846 --> 00:08:58.296 A:middle
为你切换不同页面

00:08:58.736 --> 00:08:59.756 A:middle
最厉害的地方

00:08:59.816 --> 00:09:00.306 A:middle
在下面的底栏

00:08:59.816 --> 00:09:00.306 A:middle
在下面的底栏

00:09:00.526 --> 00:09:01.406 A:middle
我们拉近看一下

00:09:02.206 --> 00:09:04.226 A:middle
通过 PDFThumbnailView

00:09:04.346 --> 00:09:06.036 A:middle
我们可为文档本身

00:09:06.036 --> 00:09:07.036 A:middle
提供 Rich Scrubber 功能

00:09:07.166 --> 00:09:08.596 A:middle
当你在这条板刷上

00:09:08.656 --> 00:09:10.306 A:middle
移动手指时它会激活

00:09:10.306 --> 00:09:11.416 A:middle
你手指触到的各个页面

00:09:11.416 --> 00:09:13.106 A:middle
然后在 PDFView 中

00:09:13.106 --> 00:09:14.726 A:middle
更新相应的活动页面

00:09:14.996 --> 00:09:16.606 A:middle
当然如果你用 PDFView

00:09:16.606 --> 00:09:18.496 A:middle
处理这项页面变化

00:09:18.496 --> 00:09:19.236 A:middle
它也会予以执行

00:09:19.236 --> 00:09:20.046 A:middle
对 ThumbnailView 进行更新

00:09:21.296 --> 00:09:23.316 A:middle
ThumbnailView 并不

00:09:23.316 --> 00:09:24.486 A:middle
仅限于水平显示

00:09:24.696 --> 00:09:26.106 A:middle
你也可以

00:09:26.106 --> 00:09:26.996 A:middle
将它设置成垂直显示

00:09:27.566 --> 00:09:30.416 A:middle
那么我们说了很多

00:09:30.416 --> 00:09:31.646 A:middle
PDFView 的特性  现在再来

00:09:31.646 --> 00:09:32.856 A:middle
聊一下核心数据结构

00:09:32.856 --> 00:09:34.736 A:middle
文档页面

00:09:34.736 --> 00:09:36.026 A:middle
和注解模型

00:09:36.206 --> 00:09:38.996 A:middle
PDFDocument 其实

00:09:38.996 --> 00:09:40.126 A:middle
就是一个文档没有别的

00:09:40.126 --> 00:09:41.766 A:middle
而文档就是

00:09:41.766 --> 00:09:43.916 A:middle
多个 PDFPage 的组合

00:09:43.916 --> 00:09:45.376 A:middle
PDFPage 非常厉害

00:09:45.376 --> 00:09:46.796 A:middle
就是它保存着

00:09:47.096 --> 00:09:47.756 A:middle
你文件里的所有内容

00:09:48.026 --> 00:09:49.506 A:middle
你在屏幕上看到的

00:09:49.536 --> 00:09:50.716 A:middle
全都保存在 PDFPage 中

00:09:51.066 --> 00:09:52.526 A:middle
PDFPage的功能十分丰富

00:09:52.526 --> 00:09:53.846 A:middle
因为它也保存着

00:09:54.016 --> 00:09:55.546 A:middle
你能在屏幕上看到的

00:09:55.546 --> 00:09:56.216 A:middle
所有注解

00:09:57.416 --> 00:09:59.376 A:middle
所以文档由页面组成

00:09:59.376 --> 00:10:01.566 A:middle
页面包含内容和注解

00:09:59.376 --> 00:10:01.566 A:middle
页面包含内容和注解

00:10:01.566 --> 00:10:03.216 A:middle
而要实际创建一个文档

00:10:03.216 --> 00:10:04.326 A:middle
你可以让它自行初始化

00:10:04.326 --> 00:10:05.746 A:middle
然后你自己从头写起

00:10:05.746 --> 00:10:07.386 A:middle
也可以用一个 URL

00:10:07.386 --> 00:10:07.976 A:middle
对它进行初始化

00:10:08.046 --> 00:10:10.086 A:middle
但在你生成一个文档后

00:10:10.086 --> 00:10:11.296 A:middle
你就可以修改

00:10:11.296 --> 00:10:11.766 A:middle
它所包含的页面

00:10:12.056 --> 00:10:13.746 A:middle
可以追加交换插入

00:10:13.746 --> 00:10:14.516 A:middle
移除页面

00:10:15.406 --> 00:10:16.696 A:middle
PDFDocument 也很强大

00:10:16.696 --> 00:10:17.976 A:middle
因为它能让你

00:10:17.976 --> 00:10:19.496 A:middle
解密文档

00:10:19.496 --> 00:10:20.746 A:middle
还能用加密方式

00:10:20.746 --> 00:10:21.356 A:middle
保存文档

00:10:21.606 --> 00:10:22.546 A:middle
我们为你开放了

00:10:22.546 --> 00:10:24.036 A:middle
打开和保存的

00:10:24.036 --> 00:10:25.276 A:middle
全面加密功能

00:10:25.766 --> 00:10:26.966 A:middle
还能让你查看

00:10:26.966 --> 00:10:28.256 A:middle
自己对文档

00:10:28.256 --> 00:10:28.836 A:middle
都有哪些权限

00:10:29.026 --> 00:10:30.166 A:middle
你在解锁后

00:10:30.206 --> 00:10:31.326 A:middle
一定要注意检查

00:10:31.396 --> 00:10:32.686 A:middle
你都可以对文档

00:10:32.686 --> 00:10:33.316 A:middle
进行哪些操作

00:10:34.016 --> 00:10:35.156 A:middle
你也可以通过它

00:10:35.156 --> 00:10:36.366 A:middle
获取文档的属性

00:10:36.366 --> 00:10:37.386 A:middle
你可以得知

00:10:37.386 --> 00:10:38.676 A:middle
它的创建者是谁

00:10:38.676 --> 00:10:39.886 A:middle
在什么时候创建的

00:10:39.886 --> 00:10:40.606 A:middle
是用什么工具创建的

00:10:41.136 --> 00:10:42.666 A:middle
最后有个很棒的功能

00:10:42.666 --> 00:10:43.726 A:middle
如果你想在任何时候

00:10:43.726 --> 00:10:45.086 A:middle
搜索文档

00:10:45.086 --> 00:10:46.466 A:middle
或者一系列的文档

00:10:46.466 --> 00:10:46.696 A:middle
完全没问题

00:10:46.896 --> 00:10:48.656 A:middle
PDFDocument 包含一系列的 API

00:10:48.656 --> 00:10:49.886 A:middle
专门实现这项功能

00:10:50.346 --> 00:10:52.416 A:middle
我来给大家看个

00:10:52.536 --> 00:10:53.896 A:middle
完整的例子在前面

00:10:53.896 --> 00:10:55.306 A:middle
其实也看到过

00:10:55.306 --> 00:10:56.706 A:middle
就是在一个视图里

00:10:56.706 --> 00:10:58.296 A:middle
设定一个文档但我想让

00:10:58.296 --> 00:10:59.626 A:middle
大家看到清晰的路径

00:10:59.626 --> 00:11:00.926 A:middle
我们要检查你的 Bundle

00:10:59.626 --> 00:11:00.926 A:middle
我们要检查你的 Bundle

00:11:01.026 --> 00:11:01.986 A:middle
从而完成文档的初始化

00:11:01.986 --> 00:11:03.296 A:middle
这里有没有

00:11:03.296 --> 00:11:03.666 A:middle
我们要的 PDF 文件呢

00:11:03.666 --> 00:11:05.536 A:middle
如果有就继续执行

00:11:05.536 --> 00:11:06.776 A:middle
试着将 PDF 文档初始化

00:11:06.776 --> 00:11:08.816 A:middle
初始化成功后

00:11:08.816 --> 00:11:09.566 A:middle
就将它赋给 View

00:11:09.796 --> 00:11:11.106 A:middle
其余的工作

00:11:11.146 --> 00:11:11.456 A:middle
由我们替你搞定

00:11:11.776 --> 00:11:13.716 A:middle
再举几个例子

00:11:13.716 --> 00:11:15.186 A:middle
如果想要保存文件

00:11:15.186 --> 00:11:16.076 A:middle
整段代码也是直截了当

00:11:16.076 --> 00:11:17.736 A:middle
只要记得在调用方法时

00:11:17.766 --> 00:11:18.816 A:middle
使用新的文件路径

00:11:19.486 --> 00:11:20.766 A:middle
比如说你想要使用

00:11:20.766 --> 00:11:22.316 A:middle
加密宽度  保存这段代码

00:11:22.316 --> 00:11:23.156 A:middle
也非常直接

00:11:23.276 --> 00:11:25.706 A:middle
用一个附带选项的 write(to:)

00:11:25.706 --> 00:11:26.496 A:middle
这个选项是个字典

00:11:26.496 --> 00:11:28.006 A:middle
我们会通过它

00:11:28.006 --> 00:11:29.346 A:middle
在头文件里将特设的

00:11:29.776 --> 00:11:31.046 A:middle
枚举变量与你设定的

00:11:31.046 --> 00:11:31.266 A:middle
密码进行匹配

00:11:31.666 --> 00:11:32.576 A:middle
在这里我用完全的

00:11:32.576 --> 00:11:33.696 A:middle
所有者权限保存文档

00:11:33.696 --> 00:11:34.916 A:middle
你只有使用我的密码

00:11:34.916 --> 00:11:36.576 A:middle
“Apple” 才能打开它

00:11:36.576 --> 00:11:39.116 A:middle
再举几个例子

00:11:39.116 --> 00:11:40.746 A:middle
如果你想要检索一个页面

00:11:40.746 --> 00:11:43.286 A:middle
我们用的是一种基数0索引系统

00:11:43.536 --> 00:11:44.676 A:middle
也就是说第一个页面

00:11:44.676 --> 00:11:46.346 A:middle
对应的索引键是0 第二个页面

00:11:46.346 --> 00:11:47.646 A:middle
对应的索引键是1 依此类推

00:11:47.826 --> 00:11:49.506 A:middle
因此要检索第一个页面很简单

00:11:49.506 --> 00:11:51.676 A:middle
只要使用 .page(at:)

00:11:51.676 --> 00:11:52.576 A:middle
并且提供索引键

00:11:53.266 --> 00:11:54.516 A:middle
第二个例子是如果你想

00:11:54.516 --> 00:11:55.976 A:middle
插入一个页面可以用

00:11:55.976 --> 00:11:57.556 A:middle
insert(at:) 加索引来实现

00:11:58.276 --> 00:11:59.756 A:middle
如果你想要交换页面

00:11:59.756 --> 00:12:01.096 A:middle
只要提供两个索引键

00:11:59.756 --> 00:12:01.096 A:middle
只要提供两个索引键

00:12:01.876 --> 00:12:03.196 A:middle
最后如果你想要

00:12:03.196 --> 00:12:04.986 A:middle
移除页面也是同样

00:12:04.986 --> 00:12:05.376 A:middle
告诉我们索引键就好

00:12:05.376 --> 00:12:06.896 A:middle
当你对文档做了改动

00:12:06.896 --> 00:12:07.976 A:middle
并将它保存到外部磁盘

00:12:07.976 --> 00:12:09.756 A:middle
我们也会负责搞定

00:12:09.756 --> 00:12:10.000 A:middle
完整文档的构建

00:12:11.866 --> 00:12:13.296 A:middle
我前面讲到了

00:12:13.296 --> 00:12:14.486 A:middle
加密保存但让我

00:12:14.486 --> 00:12:15.886 A:middle
给大家看个完美的例子

00:12:15.886 --> 00:12:16.916 A:middle
关于打开文件的

00:12:17.266 --> 00:12:18.916 A:middle
这里是我在用给定的 URL

00:12:18.946 --> 00:12:20.736 A:middle
初始化一个 PDF 文档

00:12:20.736 --> 00:12:22.096 A:middle
我要做的第一件事

00:12:22.096 --> 00:12:23.976 A:middle
就是检查文档

00:12:23.976 --> 00:12:25.236 A:middle
是否使用了加密

00:12:25.526 --> 00:12:26.916 A:middle
如果是没关系

00:12:26.916 --> 00:12:28.266 A:middle
我会尝试把它解密

00:12:28.266 --> 00:12:29.476 A:middle
我在使用 unlockwithPassword

00:12:29.476 --> 00:12:31.406 A:middle
这个方法来解密

00:12:31.896 --> 00:12:32.906 A:middle
没有成功

00:12:32.906 --> 00:12:33.806 A:middle
这很好

00:12:34.286 --> 00:12:35.196 A:middle
我还要再做一件事

00:12:35.196 --> 00:12:36.016 A:middle
就是要检查

00:12:36.016 --> 00:12:37.746 A:middle
我的身份

00:12:37.746 --> 00:12:38.656 A:middle
和我的权限

00:12:39.586 --> 00:12:41.186 A:middle
我说的身份是指

00:12:41.186 --> 00:12:42.686 A:middle
PDF 文档这个文件格式

00:12:42.726 --> 00:12:44.036 A:middle
有个很厉害的思路

00:12:44.036 --> 00:12:45.006 A:middle
就是你其实可以用

00:12:45.006 --> 00:12:46.486 A:middle
两个密码来解锁文档

00:12:46.696 --> 00:12:48.006 A:middle
你可以有个所有者密码

00:12:48.006 --> 00:12:49.276 A:middle
对文档拥有

00:12:49.276 --> 00:12:49.826 A:middle
完全的权限

00:12:49.826 --> 00:12:51.386 A:middle
你可以复制粘贴分享

00:12:51.616 --> 00:12:53.566 A:middle
打印出来也可能

00:12:53.566 --> 00:12:54.886 A:middle
你只有有限权限

00:12:54.886 --> 00:12:55.626 A:middle
比如可能是用户身份

00:12:55.926 --> 00:12:57.256 A:middle
这个有限身份

00:12:57.256 --> 00:12:58.526 A:middle
可能会给你不同的权限

00:12:58.886 --> 00:13:01.426 A:middle
也许可以让你复制

00:12:58.886 --> 00:13:01.426 A:middle
也许可以让你复制

00:13:01.426 --> 00:13:02.736 A:middle
也许可以让你打印

00:13:02.736 --> 00:13:04.166 A:middle
具体情况不一定

00:13:04.266 --> 00:13:05.736 A:middle
对于应用开发者来说

00:13:05.736 --> 00:13:07.036 A:middle
在解锁文档时检查权限

00:13:07.376 --> 00:13:08.486 A:middle
是至关重要的一步

00:13:08.776 --> 00:13:10.506 A:middle
因为 PDFKit

00:13:10.506 --> 00:13:11.986 A:middle
会对你强制执行

00:13:11.986 --> 00:13:12.176 A:middle
这些权限

00:13:12.586 --> 00:13:13.796 A:middle
所以如果你打开了一个文档

00:13:13.836 --> 00:13:15.236 A:middle
但是却不能复制

00:13:15.236 --> 00:13:16.826 A:middle
这种用户体验实在很糟

00:13:16.826 --> 00:13:18.256 A:middle
你会十分困惑为什么

00:13:18.256 --> 00:13:18.346 A:middle
你无法复制它

00:13:18.676 --> 00:13:19.726 A:middle
所以你可以先行检查

00:13:19.726 --> 00:13:21.026 A:middle
然后也许通知用户一下

00:13:21.026 --> 00:13:22.716 A:middle
嗨  这个文档已经解锁

00:13:22.906 --> 00:13:24.276 A:middle
但用的是用户密码

00:13:24.416 --> 00:13:25.276 A:middle
所以你没有完全权限

00:13:25.276 --> 00:13:26.396 A:middle
如果你愿意提供

00:13:26.396 --> 00:13:27.436 A:middle
所有者密码

00:13:27.726 --> 00:13:28.966 A:middle
我们可以试着再解锁一次

00:13:28.966 --> 00:13:30.216 A:middle
这样一来

00:13:30.216 --> 00:13:30.586 A:middle
你就能复制它了

00:13:32.136 --> 00:13:33.726 A:middle
当你解锁文档后

00:13:33.726 --> 00:13:35.136 A:middle
系统会返回一个布尔值

00:13:35.366 --> 00:13:36.826 A:middle
但是在文档和其他类

00:13:36.826 --> 00:13:38.396 A:middle
执行上述操作时也有一些

00:13:38.396 --> 00:13:40.606 A:middle
会发出提示然后调用

00:13:40.606 --> 00:13:41.596 A:middle
可选用的授权

00:13:42.026 --> 00:13:43.426 A:middle
还是来举几个例子

00:13:43.646 --> 00:13:44.686 A:middle
当你解锁一个文档时

00:13:44.686 --> 00:13:45.846 A:middle
我们会显示一条

00:13:45.846 --> 00:13:47.066 A:middle
文档已解锁的提示

00:13:47.446 --> 00:13:48.446 A:middle
这个动作可由

00:13:48.446 --> 00:13:49.426 A:middle
用户触发因为我们有

00:13:49.426 --> 00:13:51.316 A:middle
默认密码来解锁视图

00:13:51.946 --> 00:13:53.236 A:middle
但同样在你保存文档时

00:13:53.236 --> 00:13:54.426 A:middle
也许你希望代码中

00:13:54.426 --> 00:13:55.536 A:middle
能有其他监测模块

00:13:55.536 --> 00:13:56.546 A:middle
探知到你的动作

00:13:56.816 --> 00:13:58.206 A:middle
提示就可以帮你

00:13:58.206 --> 00:13:59.026 A:middle
做到这一点

00:13:59.126 --> 00:14:00.646 A:middle
你还可以执行可选的

00:13:59.126 --> 00:14:00.646 A:middle
你还可以执行可选的

00:14:00.646 --> 00:14:01.656 A:middle
任何一种授权  它们通常

00:14:01.756 --> 00:14:02.956 A:middle
都有固定的权限匹配

00:14:03.016 --> 00:14:04.376 A:middle
它们的函数调用

00:14:04.376 --> 00:14:04.666 A:middle
也差不多是一样的

00:14:05.816 --> 00:14:06.176 A:middle
好

00:14:07.046 --> 00:14:08.306 A:middle
那么我们聊了很多页面

00:14:08.486 --> 00:14:09.546 A:middle
哦  抱歉是聊了很多

00:14:09.546 --> 00:14:10.836 A:middle
文档的部分现在我们再来

00:14:10.876 --> 00:14:11.406 A:middle
聊聊页面

00:14:12.056 --> 00:14:13.666 A:middle
页面可从文档中

00:14:13.666 --> 00:14:14.796 A:middle
获取也可初始化为

00:14:14.796 --> 00:14:15.986 A:middle
空白页  也许你

00:14:15.986 --> 00:14:17.516 A:middle
提供的是个新文档

00:14:17.516 --> 00:14:18.796 A:middle
也可能是用一张图像

00:14:18.796 --> 00:14:19.536 A:middle
初始化之后的结果

00:14:19.536 --> 00:14:20.746 A:middle
这是个很有用的功能

00:14:20.746 --> 00:14:22.106 A:middle
如果你想要把一组图像

00:14:22.106 --> 00:14:23.806 A:middle
转换为一个 PDF

00:14:23.806 --> 00:14:24.266 A:middle
文档的话

00:14:24.516 --> 00:14:25.826 A:middle
等下我会给大家看个例子

00:14:26.296 --> 00:14:28.076 A:middle
此外  PDFPage 的

00:14:28.076 --> 00:14:29.496 A:middle
强大之处还在于它也是

00:14:29.496 --> 00:14:30.646 A:middle
Annotations 的容器

00:14:30.646 --> 00:14:31.766 A:middle
当你与 Annotations

00:14:31.826 --> 00:14:32.906 A:middle
交互或者想要

00:14:32.906 --> 00:14:35.366 A:middle
修改 Annotations 时就要在

00:14:35.366 --> 00:14:35.986 A:middle
PDFPage 中执行

00:14:36.726 --> 00:14:38.166 A:middle
最后 PDFPage 还有很多的

00:14:38.166 --> 00:14:39.426 A:middle
自定义图形如果你想要

00:14:39.426 --> 00:14:40.466 A:middle
修改页面的尺寸

00:14:40.516 --> 00:14:42.306 A:middle
方向或者想要

00:14:42.306 --> 00:14:43.716 A:middle
在内容中绘制

00:14:43.716 --> 00:14:45.196 A:middle
自定义图形只要使用

00:14:45.196 --> 00:14:46.156 A:middle
PDFPage 就能实现

00:14:46.886 --> 00:14:48.796 A:middle
它也在 API 中提供非常

00:14:48.796 --> 00:14:50.606 A:middle
强大的文本选取功能

00:14:51.186 --> 00:14:52.216 A:middle
我来给大家看个例子

00:14:54.266 --> 00:14:55.746 A:middle
首先让我们用一张图像

00:14:55.746 --> 00:14:57.576 A:middle
创建一个 PDFPage

00:14:57.576 --> 00:14:59.596 A:middle
我会使用 UIImage 来实现

00:14:59.596 --> 00:15:01.116 A:middle
并且初始化一张图像

00:14:59.596 --> 00:15:01.116 A:middle
并且初始化一张图像

00:15:01.156 --> 00:15:02.466 A:middle
接着我再来

00:15:02.466 --> 00:15:03.986 A:middle
用一张图像生成

00:15:03.986 --> 00:15:04.356 A:middle
一个 PDFPage 实例

00:15:04.826 --> 00:15:06.406 A:middle
这里厉害的地方在于

00:15:06.456 --> 00:15:08.056 A:middle
如果图像含有

00:15:08.056 --> 00:15:09.876 A:middle
特殊内容比如使用了

00:15:09.876 --> 00:15:11.436 A:middle
P3 广色域我们就会

00:15:11.516 --> 00:15:13.006 A:middle
用 P3 色域创建

00:15:13.006 --> 00:15:14.746 A:middle
它的页面以及

00:15:14.746 --> 00:15:15.206 A:middle
整个文档

00:15:15.676 --> 00:15:17.376 A:middle
还有一个独到之处就是

00:15:17.376 --> 00:15:19.286 A:middle
PDFPage 的默认尺寸是 US letter

00:15:19.286 --> 00:15:20.266 A:middle
但你可以随意重设

00:15:20.266 --> 00:15:21.876 A:middle
这个尺寸但在你

00:15:21.876 --> 00:15:22.856 A:middle
用图像来初始化它时

00:15:22.856 --> 00:15:24.146 A:middle
我们会始终尽力

00:15:24.146 --> 00:15:25.586 A:middle
在文档中保留

00:15:25.586 --> 00:15:26.966 A:middle
图像的原始比例

00:15:29.186 --> 00:15:30.736 A:middle
如果你想要从一个 PDFPage 中

00:15:30.736 --> 00:15:31.736 A:middle
提取一个字符串内容

00:15:31.736 --> 00:15:33.236 A:middle
只需要调用 string 方法

00:15:33.236 --> 00:15:34.016 A:middle
就能做到

00:15:34.396 --> 00:15:36.036 A:middle
但如果你想要从文档中

00:15:36.106 --> 00:15:37.196 A:middle
获取大量文本则可以

00:15:37.196 --> 00:15:38.826 A:middle
使用 attributedString

00:15:38.826 --> 00:15:40.096 A:middle
自从我们对可访问性

00:15:40.096 --> 00:15:41.356 A:middle
做了改进后

00:15:41.356 --> 00:15:42.826 A:middle
它现在的功能非常强大

00:15:44.256 --> 00:15:45.636 A:middle
此外我前面也提到过

00:15:45.636 --> 00:15:47.216 A:middle
还有这些非常强大的

00:15:47.246 --> 00:15:48.166 A:middle
文本提取 API

00:15:48.226 --> 00:15:49.636 A:middle
我给大家看两个例子

00:15:50.096 --> 00:15:51.406 A:middle
第一个是假设你想要

00:15:51.406 --> 00:15:52.836 A:middle
选取特定字符

00:15:52.836 --> 00:15:54.136 A:middle
范围内的文本

00:15:54.456 --> 00:15:56.316 A:middle
您可通过 PDFPage 的

00:15:56.316 --> 00:15:57.956 A:middle
一个方法来实现叫做

00:15:57.956 --> 00:15:58.366 A:middle
Selection(for:[range])

00:15:58.656 --> 00:16:00.506 A:middle
在这里我们会选取

00:15:58.656 --> 00:16:00.506 A:middle
在这里我们会选取

00:16:00.506 --> 00:16:01.816 A:middle
第 10 个字符总共

00:16:01.876 --> 00:16:02.286 A:middle
选取 5 个字符

00:16:02.616 --> 00:16:03.736 A:middle
我们会提取出这个字符串

00:16:03.736 --> 00:16:04.746 A:middle
你可以使用 PDFSelection

00:16:04.746 --> 00:16:05.936 A:middle
进行多种几何转换

00:16:05.936 --> 00:16:07.036 A:middle
从而找出它在

00:16:07.306 --> 00:16:09.096 A:middle
页面上的视觉位置

00:16:09.716 --> 00:16:11.456 A:middle
但我们也有办法

00:16:11.456 --> 00:16:12.796 A:middle
基于几何形状

00:16:12.796 --> 00:16:13.476 A:middle
提取文本

00:16:13.766 --> 00:16:15.146 A:middle
因此如果你提供的是

00:16:15.146 --> 00:16:16.626 A:middle
一个长方形而非一段文本

00:16:16.906 --> 00:16:18.086 A:middle
我们也可以提取出

00:16:18.086 --> 00:16:19.386 A:middle
相应的 PDF 选取文本

00:16:19.386 --> 00:16:20.316 A:middle
你可以对它进行多种操作

00:16:21.236 --> 00:16:22.356 A:middle
不过我想再说回

00:16:22.406 --> 00:16:23.366 A:middle
attributedString

00:16:24.016 --> 00:16:25.536 A:middle
我写了一个非常简单的

00:16:25.536 --> 00:16:27.326 A:middle
桌面应用在左侧

00:16:27.326 --> 00:16:28.466 A:middle
就跟前面的演示一样

00:16:28.466 --> 00:16:30.046 A:middle
是支持拖放的 PDFView

00:16:30.406 --> 00:16:31.376 A:middle
在右侧是一个

00:16:31.376 --> 00:16:32.226 A:middle
富文本视图

00:16:33.006 --> 00:16:34.166 A:middle
在这里我要拖动和

00:16:34.166 --> 00:16:36.526 A:middle
放下一小张用户手册

00:16:36.526 --> 00:16:37.916 A:middle
然后在左侧我要

00:16:37.916 --> 00:16:39.146 A:middle
提取和打印出

00:16:39.146 --> 00:16:39.856 A:middle
attributedString

00:16:40.496 --> 00:16:41.886 A:middle
这里的厉害之处在于

00:16:41.886 --> 00:16:43.706 A:middle
我们能尽最大可能

00:16:43.706 --> 00:16:45.176 A:middle
保留完整内容的

00:16:45.176 --> 00:16:47.786 A:middle
文本定位文本顺序字体

00:16:47.876 --> 00:16:49.766 A:middle
颜色粗体或细体以及其他的

00:16:49.766 --> 00:16:50.646 A:middle
属性

00:16:51.006 --> 00:16:52.226 A:middle
这一点格外重要

00:16:52.226 --> 00:16:54.026 A:middle
因为这一切都会

00:16:54.026 --> 00:16:55.676 A:middle
显示给可访问性系统

00:16:55.676 --> 00:16:57.406 A:middle
Mac OS 和 iOS

00:16:57.406 --> 00:16:57.626 A:middle
都支持这套系统

00:16:58.066 --> 00:17:00.226 A:middle
也就是说只要使用

00:16:58.066 --> 00:17:00.226 A:middle
也就是说只要使用

00:17:00.226 --> 00:17:01.876 A:middle
PDFView 你便可免费获得

00:17:01.876 --> 00:17:03.526 A:middle
上述的所有可访问性改进

00:17:03.526 --> 00:17:05.036 A:middle
而且两个平台均可支持

00:17:06.796 --> 00:17:07.096 A:middle
好

00:17:07.766 --> 00:17:08.925 A:middle
那么我们在 2017 年

00:17:08.925 --> 00:17:11.406 A:middle
还新增了一个功能

00:17:11.406 --> 00:17:13.626 A:middle
就是指定显示框尺寸的

00:17:13.626 --> 00:17:14.496 A:middle
PDFPage 方法 Thumbnail(of:[size])

00:17:14.935 --> 00:17:15.925 A:middle
很多时候你可能会发现

00:17:15.925 --> 00:17:17.776 A:middle
你有一个 PDF 文档

00:17:17.776 --> 00:17:19.346 A:middle
而你想做的

00:17:19.415 --> 00:17:20.586 A:middle
并不复杂

00:17:20.586 --> 00:17:22.006 A:middle
你只是想要显示

00:17:22.006 --> 00:17:22.856 A:middle
一个页面预览

00:17:23.656 --> 00:17:25.406 A:middle
凭借这个新方法

00:17:25.406 --> 00:17:26.806 A:middle
我们可以代你搞定这一切

00:17:26.806 --> 00:17:28.246 A:middle
同样我们也支持

00:17:28.246 --> 00:17:28.566 A:middle
P3 色域

00:17:28.566 --> 00:17:29.856 A:middle
因此如果您的文档中

00:17:29.856 --> 00:17:31.466 A:middle
有任何一种复杂元素

00:17:31.466 --> 00:17:32.836 A:middle
采用了广色域

00:17:32.836 --> 00:17:34.596 A:middle
我们会确保 UI 图像或

00:17:34.596 --> 00:17:36.066 A:middle
NS 图像这类元素同样

00:17:36.066 --> 00:17:38.116 A:middle
使用 P3 色域生成

00:17:38.596 --> 00:17:39.456 A:middle
另一个厉害的地方是

00:17:39.456 --> 00:17:40.886 A:middle
它会追踪给定边界内

00:17:40.886 --> 00:17:42.006 A:middle
文档的合适尺寸

00:17:42.006 --> 00:17:43.426 A:middle
同时保留原始比例

00:17:44.496 --> 00:17:46.146 A:middle
不过最后这个参数显示框

00:17:46.146 --> 00:17:47.166 A:middle
是做什么用的呢

00:17:47.536 --> 00:17:49.696 A:middle
要解释清楚这个枚举变量

00:17:49.746 --> 00:17:51.016 A:middle
我就要简单解释一下

00:17:51.176 --> 00:17:53.256 A:middle
PDF 内容为图像时的

00:17:53.356 --> 00:17:53.846 A:middle
工作原理

00:17:54.996 --> 00:17:56.576 A:middle
那么我们先从

00:17:56.576 --> 00:17:57.766 A:middle
笛卡尔坐标空间开始

00:17:57.836 --> 00:17:59.486 A:middle
这是内容的坐标空间

00:17:59.486 --> 00:18:01.256 A:middle
所有的 PDFPage

00:17:59.486 --> 00:18:01.256 A:middle
所有的 PDFPage

00:18:01.256 --> 00:18:01.676 A:middle
都是在这个空间里绘制

00:18:01.676 --> 00:18:03.406 A:middle
所以我们的原点是 00

00:18:03.406 --> 00:18:04.956 A:middle
X 的正半轴向右延伸

00:18:05.196 --> 00:18:07.346 A:middle
Y 的正半轴向上延伸

00:18:07.346 --> 00:18:08.346 A:middle
我现在输入一小段字符串

00:18:08.346 --> 00:18:09.646 A:middle
我会输入

00:18:09.646 --> 00:18:10.006 A:middle
你好圣何塞

00:18:10.836 --> 00:18:12.246 A:middle
我要把这个字符串

00:18:12.246 --> 00:18:13.956 A:middle
放到一个页面上

00:18:13.956 --> 00:18:14.606 A:middle
所以它会有个位置

00:18:14.606 --> 00:18:15.426 A:middle
我要把它放到页面上

00:18:15.426 --> 00:18:16.656 A:middle
而页面本身

00:18:16.656 --> 00:18:17.556 A:middle
当然也有个尺寸

00:18:17.816 --> 00:18:18.986 A:middle
于是我们现在有了

00:18:18.986 --> 00:18:20.346 A:middle
所有的几何特性

00:18:21.116 --> 00:18:22.836 A:middle
但是我遇到了一个问题

00:18:22.836 --> 00:18:23.966 A:middle
问题就是

00:18:24.096 --> 00:18:24.476 A:middle
它没有居中

00:18:24.696 --> 00:18:27.356 A:middle
对吧我们可以重新绘制

00:18:27.356 --> 00:18:28.666 A:middle
整个内容

00:18:28.666 --> 00:18:29.876 A:middle
但这不是好主意

00:18:29.876 --> 00:18:30.366 A:middle
成本也很高

00:18:30.366 --> 00:18:32.056 A:middle
没人想要重新发出和

00:18:32.056 --> 00:18:34.236 A:middle
重新绘制以上所有的

00:18:34.236 --> 00:18:35.866 A:middle
绘制命令来

00:18:35.866 --> 00:18:36.346 A:middle
重新生成一个 PDF 文档

00:18:36.876 --> 00:18:37.876 A:middle
所以我们要利用

00:18:37.876 --> 00:18:39.326 A:middle
PDF 的强大功能

00:18:39.326 --> 00:18:40.376 A:middle
利用我之前提到的

00:18:40.376 --> 00:18:41.866 A:middle
枚举变量

00:18:42.396 --> 00:18:43.326 A:middle
我们还是使用这个 PDFPage

00:18:43.326 --> 00:18:45.246 A:middle
然后为本来的

00:18:45.506 --> 00:18:46.926 A:middle
那个显示框设定框架

00:18:46.926 --> 00:18:48.496 A:middle
让它轻微

00:18:48.496 --> 00:18:48.976 A:middle
偏移

00:18:49.276 --> 00:18:50.376 A:middle
之所以要偏移是因为

00:18:50.376 --> 00:18:51.916 A:middle
我们要让圣何塞居中

00:18:52.446 --> 00:18:54.766 A:middle
我也不太喜欢

00:18:54.766 --> 00:18:55.906 A:middle
横向页面我想把它

00:18:55.906 --> 00:18:57.106 A:middle
转成垂直的同样

00:18:57.106 --> 00:18:58.496 A:middle
我不用重新发出任何

00:18:58.496 --> 00:18:59.616 A:middle
绘制命令就能做到这一点

00:18:59.616 --> 00:19:00.906 A:middle
我只要设定一下框架特性

00:18:59.616 --> 00:19:00.906 A:middle
我只要设定一下框架特性

00:19:02.436 --> 00:19:04.656 A:middle
那么为什么我可以

00:19:04.656 --> 00:19:06.666 A:middle
不改变内容

00:19:06.666 --> 00:19:07.856 A:middle
就变为使用 PDFPage 的

00:19:07.856 --> 00:19:08.296 A:middle
几何特性呢

00:19:08.296 --> 00:19:09.426 A:middle
除了在保存文件时

00:19:09.426 --> 00:19:10.676 A:middle
可以节省些时间外

00:19:10.676 --> 00:19:11.716 A:middle
这么做还有什么好处呢

00:19:12.196 --> 00:19:14.236 A:middle
真正的好处是 PDF

00:19:14.236 --> 00:19:15.816 A:middle
在现实世界里

00:19:15.816 --> 00:19:16.106 A:middle
是需要印刷的

00:19:16.456 --> 00:19:17.646 A:middle
这意味着有时候

00:19:17.646 --> 00:19:18.766 A:middle
你其实想要为

00:19:18.806 --> 00:19:20.616 A:middle
同样的内容生成

00:19:20.616 --> 00:19:21.126 A:middle
多个 PDFPage

00:19:21.956 --> 00:19:23.596 A:middle
至少在涉及这样的

00:19:23.596 --> 00:19:25.486 A:middle
内容时你应该考虑

00:19:25.486 --> 00:19:26.126 A:middle
使用 PDFPage

00:19:26.126 --> 00:19:27.036 A:middle
完成绘制后

00:19:27.036 --> 00:19:28.546 A:middle
你应该将它看成是

00:19:28.546 --> 00:19:29.356 A:middle
内容的视图入口

00:19:29.686 --> 00:19:32.186 A:middle
内容的边框只有一个

00:19:32.186 --> 00:19:33.246 A:middle
但是在内容里

00:19:33.246 --> 00:19:34.936 A:middle
可以有若干个

00:19:34.936 --> 00:19:35.406 A:middle
视图入口或页面

00:19:35.766 --> 00:19:37.126 A:middle
至于我们这么做的原因

00:19:37.126 --> 00:19:38.826 A:middle
大家看一下它的四角

00:19:39.526 --> 00:19:39.806 A:middle
对吧

00:19:39.946 --> 00:19:41.396 A:middle
在纸质印刷环境中

00:19:41.466 --> 00:19:42.276 A:middle
如果你想要用专业的方式

00:19:42.276 --> 00:19:43.576 A:middle
进行印刷通常情况下

00:19:43.576 --> 00:19:44.686 A:middle
都会经过数次印刷

00:19:44.846 --> 00:19:46.616 A:middle
每一次印刷

00:19:46.616 --> 00:19:47.576 A:middle
都会另外叠加

00:19:47.616 --> 00:19:48.646 A:middle
一层油墨

00:19:48.646 --> 00:19:50.516 A:middle
而这个过程要做到完美

00:19:50.516 --> 00:19:51.426 A:middle
就需要某种

00:19:51.426 --> 00:19:51.776 A:middle
校准方法

00:19:52.216 --> 00:19:53.316 A:middle
现在我们利用四角处的

00:19:53.316 --> 00:19:54.756 A:middle
光学校准字符

00:19:54.756 --> 00:19:56.426 A:middle
创建了这个页面

00:19:56.526 --> 00:19:57.856 A:middle
这样在印刷过程中

00:19:57.856 --> 00:19:58.886 A:middle
就可以完美铺墨了

00:20:00.226 --> 00:20:01.616 A:middle
这也是我们会设置

00:20:01.616 --> 00:20:01.976 A:middle
这些枚举值的原因所在

00:20:02.616 --> 00:20:03.846 A:middle
现在我给大家看的

00:20:03.846 --> 00:20:05.026 A:middle
是电子版对应的枚举值是

00:20:05.026 --> 00:20:05.616 A:middle
cropBox

00:20:05.686 --> 00:20:07.196 A:middle
这是 PDFKit 的默认赋值

00:20:07.556 --> 00:20:08.626 A:middle
我们也放出了

00:20:08.766 --> 00:20:09.846 A:middle
纸质版也就是我们

00:20:09.846 --> 00:20:11.696 A:middle
将会做成印刷品的版本

00:20:11.696 --> 00:20:12.476 A:middle
对应的枚举值是 mediaBox

00:20:12.826 --> 00:20:14.106 A:middle
此外还有三个赋值

00:20:14.106 --> 00:20:15.676 A:middle
可供大家运用

00:20:15.676 --> 00:20:16.746 A:middle
也不要忘记这个功能的

00:20:16.746 --> 00:20:18.586 A:middle
真正厉害之处在于

00:20:18.586 --> 00:20:19.776 A:middle
你对一个边框所做的任何修改

00:20:19.776 --> 00:20:20.736 A:middle
由于你实际修改的是内容

00:20:20.736 --> 00:20:22.036 A:middle
都会同时显示在

00:20:22.036 --> 00:20:22.866 A:middle
这两个页面上

00:20:23.576 --> 00:20:25.026 A:middle
好

00:20:25.466 --> 00:20:27.416 A:middle
现在让我们来说一下

00:20:27.416 --> 00:20:28.686 A:middle
自定义 PDFPage 绘制

00:20:28.686 --> 00:20:29.556 A:middle
我们聊了很多如何改变

00:20:29.556 --> 00:20:30.606 A:middle
各种设置的话题  但绘制内容的

00:20:30.606 --> 00:20:31.846 A:middle
实际情况又是怎样的呢

00:20:32.616 --> 00:20:33.936 A:middle
这个过程分为简单的三步

00:20:34.236 --> 00:20:35.936 A:middle
第一步就是  针对

00:20:35.936 --> 00:20:37.276 A:middle
一个 PDF 文档我们要设定一个

00:20:37.276 --> 00:20:38.726 A:middle
PDFDocument 的 delegate (权限)

00:20:39.046 --> 00:20:39.856 A:middle
而这么做的原因

00:20:39.856 --> 00:20:42.096 A:middle
就是第二步

00:20:42.096 --> 00:20:43.396 A:middle
这个 delegate 应该用

00:20:43.396 --> 00:20:44.386 A:middle
classForPage 来实现

00:20:44.386 --> 00:20:46.306 A:middle
我们要返回一个

00:20:46.366 --> 00:20:48.016 A:middle
我们已经实现的子类

00:20:48.016 --> 00:20:49.476 A:middle
用来定义我们想要的

00:20:49.476 --> 00:20:50.666 A:middle
PDFPage 绘制方法

00:20:51.166 --> 00:20:52.046 A:middle
在这个例子中我将说

00:20:52.046 --> 00:20:53.956 A:middle
请使用我的自定义子类

00:20:53.956 --> 00:20:55.756 A:middle
WatermarkPage 来绘制

00:20:56.576 --> 00:20:58.516 A:middle
第三步也是最后一步

00:20:58.516 --> 00:20:59.846 A:middle
我们需要完全重写

00:20:59.846 --> 00:21:01.766 A:middle
PDFPage 子类的

00:20:59.846 --> 00:21:01.766 A:middle
PDFPage 子类的

00:21:01.766 --> 00:21:02.136 A:middle
draw 方法

00:21:02.406 --> 00:21:03.426 A:middle
所以我们要使用的绘制方法

00:21:03.466 --> 00:21:05.136 A:middle
是内容边框

00:21:05.496 --> 00:21:07.276 A:middle
我会在讲座的最后

00:21:07.376 --> 00:21:08.330 A:middle
给大家看一个完整的例子

00:21:15.456 --> 00:21:16.000 A:middle
非常棒

00:21:18.796 --> 00:21:18.946 A:middle
好的

00:21:19.126 --> 00:21:21.746 A:middle
现在我有一个 iOS 模拟器

00:21:21.746 --> 00:21:23.076 A:middle
运行着一个示例应用

00:21:23.076 --> 00:21:24.526 A:middle
是我三个设定的实施体现

00:21:25.106 --> 00:21:26.636 A:middle
在这个应用里我只能

00:21:26.636 --> 00:21:27.676 A:middle
在各个方向上拉动

00:21:27.676 --> 00:21:30.236 A:middle
就跟正常的 PDFView 一样

00:21:30.236 --> 00:21:31.076 A:middle
但是我想用这个应用

00:21:31.076 --> 00:21:31.646 A:middle
做些不一样的事情

00:21:31.776 --> 00:21:33.106 A:middle
我想对它说

00:21:33.106 --> 00:21:34.186 A:middle
我们在处理非常敏感的

00:21:34.186 --> 00:21:35.816 A:middle
文档每当我的某个用户

00:21:35.816 --> 00:21:37.506 A:middle
打开这些文档时

00:21:37.926 --> 00:21:38.746 A:middle
我们必须追踪他们

00:21:38.776 --> 00:21:40.926 A:middle
我们必须知道用户X

00:21:40.926 --> 00:21:43.106 A:middle
看过了这个内容他会不会

00:21:43.106 --> 00:21:44.776 A:middle
泄露出去

00:21:44.776 --> 00:21:45.776 A:middle
我们就会知道是谁泄露的

00:21:46.086 --> 00:21:47.596 A:middle
那我们的目的就是

00:21:47.596 --> 00:21:49.426 A:middle
在每个单页的顶部

00:21:49.426 --> 00:21:51.316 A:middle
绘制某个自定义标识符

00:21:51.316 --> 00:21:52.386 A:middle
就可以通过上面那三个步骤来实现

00:21:52.456 --> 00:21:54.406 A:middle
那么第一步

00:21:54.406 --> 00:21:55.806 A:middle
如果我们打开 ViewController

00:21:56.386 --> 00:21:57.266 A:middle
在前面会需要几行代码

00:21:57.266 --> 00:21:58.686 A:middle
来设置 PDFView

00:21:58.806 --> 00:21:59.836 A:middle
不过核心的一步在这里

00:22:00.276 --> 00:22:01.446 A:middle
我们要把 delegate(权限)

00:22:01.446 --> 00:22:02.016 A:middle
设置给自己

00:22:02.016 --> 00:22:03.156 A:middle
我们要把权限

00:22:03.156 --> 00:22:03.946 A:middle
设置给 ViewController

00:22:04.366 --> 00:22:05.736 A:middle
而这么做的原因

00:22:05.736 --> 00:22:07.496 A:middle
在第二步我们要声明

00:22:07.496 --> 00:22:08.776 A:middle
就像前面在侧栏中看到的

00:22:08.776 --> 00:22:09.666 A:middle
我们要把 watermarkPage

00:22:09.666 --> 00:22:11.256 A:middle
声明为 PDFPage 的子类

00:22:11.306 --> 00:22:13.026 A:middle
而它的返回结果就是

00:22:13.026 --> 00:22:14.196 A:middle
我们想要的自定义绘制器

00:22:15.096 --> 00:22:18.006 A:middle
最后一步也就是第三步

00:22:18.006 --> 00:22:20.076 A:middle
我们这里在重写 draw 函数

00:22:20.076 --> 00:22:21.326 A:middle
用 box to context 来绘制

00:22:21.326 --> 00:22:22.836 A:middle
然后将我们所有的

00:22:22.836 --> 00:22:24.166 A:middle
自定义图形放进去

00:22:24.996 --> 00:22:26.496 A:middle
在今天上台之前

00:22:26.496 --> 00:22:27.666 A:middle
我把这些代码改成了注释

00:22:27.666 --> 00:22:28.586 A:middle
好让大家看到

00:22:28.586 --> 00:22:30.456 A:middle
它原本是什么样子

00:22:30.456 --> 00:22:31.636 A:middle
现在我给大家看一下

00:22:31.636 --> 00:22:32.406 A:middle
改写后的样子

00:22:33.196 --> 00:22:34.656 A:middle
在这段代码里我先是

00:22:34.656 --> 00:22:36.506 A:middle
调用了 super.draw 然后绘制了

00:22:36.506 --> 00:22:37.836 A:middle
我自定义的图形

00:22:37.836 --> 00:22:38.626 A:middle
我这么做当然是有原因的

00:22:39.446 --> 00:22:40.736 A:middle
当我执行这段

00:22:40.736 --> 00:22:42.376 A:middle
修改后的代码时

00:22:42.376 --> 00:22:44.136 A:middle
所有页面都会被添加上

00:22:44.136 --> 00:22:44.476 A:middle
这个图形内容

00:22:44.736 --> 00:22:45.836 A:middle
这里漂亮的地方在于

00:22:45.836 --> 00:22:47.386 A:middle
如果我打算保存文档

00:22:47.386 --> 00:22:48.896 A:middle
或者打印文档我刚才加入的

00:22:48.896 --> 00:22:50.156 A:middle
自定义图形肯定会

00:22:50.156 --> 00:22:51.626 A:middle
出现在文档里

00:22:52.386 --> 00:22:53.306 A:middle
但我想重申一下

00:22:53.436 --> 00:22:55.636 A:middle
这里的顺序非常重要

00:22:55.636 --> 00:22:57.136 A:middle
因为我们尊重绘制器的算法

00:22:57.136 --> 00:22:58.836 A:middle
也就是说无论你先

00:22:58.836 --> 00:22:59.906 A:middle
绘制的是什么  如果你先

00:22:59.906 --> 00:23:01.506 A:middle
绘制原始内容然后绘制

00:22:59.906 --> 00:23:01.506 A:middle
绘制原始内容然后绘制

00:23:01.506 --> 00:23:02.836 A:middle
你的自定义内容

00:23:03.096 --> 00:23:04.336 A:middle
你的自定义内容就会

00:23:04.336 --> 00:23:04.696 A:middle
出现在最上层

00:23:05.296 --> 00:23:06.596 A:middle
如果颠倒顺序先绘制

00:23:06.596 --> 00:23:08.116 A:middle
你的自定义内容然后再

00:23:08.116 --> 00:23:09.906 A:middle
调用 super.draw 就会是

00:23:09.906 --> 00:23:11.146 A:middle
原始内容在最上层

00:23:11.606 --> 00:23:12.846 A:middle
所以在你添加自定义绘制时

00:23:12.846 --> 00:23:13.766 A:middle
一定要记得这一点

00:23:13.766 --> 00:23:13.976 A:middle
好

00:23:17.316 --> 00:23:19.596 A:middle
那么我们已经讲到了 PDFView

00:23:19.596 --> 00:23:22.596 A:middle
PDFDocument PDFPage 的很多内容

00:23:22.596 --> 00:23:23.646 A:middle
现在应该再来讲讲

00:23:23.806 --> 00:23:24.486 A:middle
Annotations 了

00:23:24.736 --> 00:23:25.076 A:middle
Nicki

00:23:25.706 --> 00:23:26.500 A:middle
&gt;&gt; 好的太棒了

00:23:27.516 --> 00:23:31.396 A:middle
[掌声]

00:23:31.896 --> 00:23:32.316 A:middle
&gt;&gt; 好的

00:23:32.316 --> 00:23:33.736 A:middle
我们来讲一下我的最爱

00:23:33.776 --> 00:23:35.086 A:middle
Annotations

00:23:35.156 --> 00:23:36.996 A:middle
首先我们经常提到

00:23:36.996 --> 00:23:38.096 A:middle
Annotations 这个词

00:23:38.096 --> 00:23:38.736 A:middle
什么是 Annotations 呢

00:23:39.226 --> 00:23:40.456 A:middle
Annotations 是一些

00:23:40.456 --> 00:23:41.776 A:middle
可以让我们添加到 PDF 文档中的

00:23:41.876 --> 00:23:42.966 A:middle
交互性图形元素

00:23:43.806 --> 00:23:45.216 A:middle
它可以是线条正方形

00:23:45.216 --> 00:23:47.676 A:middle
这类简单的东西但也有

00:23:47.676 --> 00:23:48.906 A:middle
很多其他形式的注解

00:23:48.906 --> 00:23:51.036 A:middle
比如高亮下划线

00:23:51.436 --> 00:23:53.346 A:middle
圆圈链接甚至是

00:23:53.346 --> 00:23:54.656 A:middle
小程序  都是交互性的

00:23:54.656 --> 00:23:55.386 A:middle
表单元素

00:23:56.076 --> 00:23:58.386 A:middle
我们前面提过

00:23:58.386 --> 00:23:59.616 A:middle
PDFAnnotation 是

00:23:59.616 --> 00:24:00.396 A:middle
PDFPage 的一个子类

00:23:59.616 --> 00:24:00.396 A:middle
PDFPage 的一个子类

00:24:00.876 --> 00:24:01.936 A:middle
所以每当你创建一个

00:24:01.936 --> 00:24:03.816 A:middle
注解时你都是

00:24:03.816 --> 00:24:05.146 A:middle
在对 PDFPage 进行增减

00:24:05.456 --> 00:24:06.846 A:middle
然后如果你的页面

00:24:06.846 --> 00:24:08.696 A:middle
是在 PDFView 里每当你更新

00:24:08.696 --> 00:24:10.006 A:middle
这段注解的属性时

00:24:10.236 --> 00:24:11.696 A:middle
我们也会为你实时

00:24:11.696 --> 00:24:12.856 A:middle
更新在视图里

00:24:14.086 --> 00:24:15.726 A:middle
PDFKit 最新添加的

00:24:15.726 --> 00:24:16.986 A:middle
是对 Annotations 的

00:24:16.986 --> 00:24:17.366 A:middle
全局支持

00:24:17.546 --> 00:24:18.616 A:middle
好吧  这是什么

00:24:19.226 --> 00:24:20.446 A:middle
我前面给大家

00:24:20.446 --> 00:24:22.126 A:middle
看过的所有 Annotations

00:24:22.126 --> 00:24:24.256 A:middle
PDFKit 都可以支持

00:24:24.256 --> 00:24:25.486 A:middle
我这句话的意思是

00:24:25.486 --> 00:24:26.946 A:middle
我们为这些类型的注解

00:24:26.946 --> 00:24:27.956 A:middle
定义了我们的原生渲染方式

00:24:28.046 --> 00:24:29.276 A:middle
但这并不代表

00:24:29.276 --> 00:24:31.006 A:middle
你就只能创建

00:24:31.006 --> 00:24:32.006 A:middle
这些类型的注解

00:24:32.536 --> 00:24:33.716 A:middle
有了我们的全局支持

00:24:33.716 --> 00:24:34.926 A:middle
你可以按你的想法任意创建

00:24:35.256 --> 00:24:36.966 A:middle
因为 PDF 规范

00:24:37.466 --> 00:24:39.366 A:middle
对注解的定义只是

00:24:39.366 --> 00:24:40.766 A:middle
一本键值对应的字典

00:24:40.826 --> 00:24:42.256 A:middle
于是我们就延伸了一下

00:24:42.256 --> 00:24:44.006 A:middle
在 PDFKit 里也加入了同样的东西

00:24:44.396 --> 00:24:46.466 A:middle
比如说 PDF 规范

00:24:46.466 --> 00:24:47.746 A:middle
允许为它添加扩展类

00:24:47.746 --> 00:24:49.336 A:middle
定义各种各样的新注解

00:24:49.336 --> 00:24:50.196 A:middle
哪怕是我们没见过的

00:24:50.896 --> 00:24:52.256 A:middle
比如说 GPSAnnotation

00:24:52.516 --> 00:24:53.766 A:middle
它可以包含某种

00:24:53.766 --> 00:24:54.936 A:middle
属性坐标

00:24:54.936 --> 00:24:56.806 A:middle
维度经度

00:24:56.806 --> 00:24:58.196 A:middle
有了对它们的全局支持

00:24:58.196 --> 00:24:59.976 A:middle
我们可以继续将这些值

00:24:59.976 --> 00:25:01.786 A:middle
设置成我们的字典

00:24:59.976 --> 00:25:01.786 A:middle
设置成我们的字典

00:25:01.786 --> 00:25:02.656 A:middle
做到所见即所得

00:25:03.266 --> 00:25:04.546 A:middle
不管你具体设置的是怎么

00:25:04.546 --> 00:25:05.886 A:middle
我们都会在你写下后加以执行

00:25:05.886 --> 00:25:06.756 A:middle
把它编写到文件里

00:25:06.866 --> 00:25:08.906 A:middle
哪怕 PDFKit 没有

00:25:08.906 --> 00:25:10.436 A:middle
明确定义你仍可以

00:25:10.436 --> 00:25:11.356 A:middle
把它保存为

00:25:11.356 --> 00:25:12.106 A:middle
PDFDocument 的一部分

00:25:12.516 --> 00:25:14.926 A:middle
我们今年的新改进是

00:25:14.926 --> 00:25:16.426 A:middle
为这个类添加了扩展

00:25:16.426 --> 00:25:18.206 A:middle
我们把它叫作

00:25:18.206 --> 00:25:18.766 A:middle
PDFAnnotationUtilities

00:25:19.346 --> 00:25:20.866 A:middle
它包含一组

00:25:20.866 --> 00:25:22.176 A:middle
类别方法能让

00:25:22.176 --> 00:25:24.056 A:middle
设置和获取

00:25:24.056 --> 00:25:25.856 A:middle
各类注解的属性

00:25:25.856 --> 00:25:27.496 A:middle
变得更容易

00:25:27.626 --> 00:25:28.856 A:middle
无论是我们提供支持的注解

00:25:28.856 --> 00:25:30.086 A:middle
还是各类注解的通用属性

00:25:30.086 --> 00:25:32.006 A:middle
比如颜色

00:25:32.006 --> 00:25:32.376 A:middle
或者边框样式

00:25:32.866 --> 00:25:34.636 A:middle
我们再来看一下

00:25:34.636 --> 00:25:35.966 A:middle
我们的注解

00:25:35.966 --> 00:25:37.816 A:middle
但是把重点放在其中一个上

00:25:37.816 --> 00:25:38.426 A:middle
一条直线的注解

00:25:39.456 --> 00:25:40.916 A:middle
我们都知道注解

00:25:40.916 --> 00:25:42.456 A:middle
就是一堆属性的组合

00:25:42.456 --> 00:25:43.196 A:middle
每当我更改这些属性

00:25:43.196 --> 00:25:45.136 A:middle
比如在这里我就是

00:25:45.136 --> 00:25:46.576 A:middle
更改了直线的两端样式

00:25:46.576 --> 00:25:47.506 A:middle
和边框样式

00:25:47.806 --> 00:25:48.816 A:middle
我们可以让简单的

00:25:48.816 --> 00:25:50.086 A:middle
直线注解呈现出

00:25:50.086 --> 00:25:50.336 A:middle
6 种不同的样子

00:25:51.326 --> 00:25:52.306 A:middle
那么我们来看一下

00:25:52.306 --> 00:25:53.456 A:middle
具体如何设置这些属性

00:25:54.416 --> 00:25:55.686 A:middle
一条直线要有起点

00:25:55.686 --> 00:25:57.296 A:middle
还有终点所以我们使用

00:25:57.296 --> 00:25:58.686 A:middle
setValue 在字典里

00:25:58.686 --> 00:26:00.606 A:middle
设置这两点用 linePoints

00:25:58.686 --> 00:26:00.606 A:middle
设置这两点用 linePoints

00:26:00.606 --> 00:26:01.356 A:middle
来设置 forAnnotationKey

00:26:02.566 --> 00:26:03.826 A:middle
我们还要设置直线的两端样式

00:26:03.826 --> 00:26:05.306 A:middle
想让它一端是箭头的尾部

00:26:05.306 --> 00:26:06.316 A:middle
一端是箭头的头部

00:26:06.316 --> 00:26:08.176 A:middle
然后我们还要

00:26:08.176 --> 00:26:08.526 A:middle
更改颜色

00:26:08.886 --> 00:26:09.936 A:middle
把它变成红色

00:26:10.546 --> 00:26:12.036 A:middle
但是记得我刚才

00:26:12.036 --> 00:26:13.386 A:middle
提过的类别方法吗

00:26:13.386 --> 00:26:14.426 A:middle
让我们直接用它们

00:26:14.426 --> 00:26:15.606 A:middle
来实现以上的效果

00:26:16.766 --> 00:26:17.116 A:middle
来

00:26:17.116 --> 00:26:18.416 A:middle
我们还是要设置

00:26:18.416 --> 00:26:19.486 A:middle
起终点两端样式

00:26:19.536 --> 00:26:20.466 A:middle
还有颜色

00:26:20.466 --> 00:26:22.486 A:middle
我们来对比一下两种方式

00:26:22.806 --> 00:26:24.186 A:middle
确实类别方法这边

00:26:24.186 --> 00:26:25.416 A:middle
似乎要多写上几行代码

00:26:25.416 --> 00:26:26.746 A:middle
但是它非常清晰地

00:26:26.746 --> 00:26:27.246 A:middle
表达了我们在做的事情

00:26:27.296 --> 00:26:28.836 A:middle
当我们为字典设值时

00:26:28.836 --> 00:26:30.606 A:middle
其实是在模仿规范的做法

00:26:30.606 --> 00:26:31.906 A:middle
而规范有时会

00:26:31.906 --> 00:26:32.746 A:middle
有点教人费解

00:26:32.746 --> 00:26:34.836 A:middle
用一个数字数组

00:26:34.836 --> 00:26:36.236 A:middle
或者一个字符串数组

00:26:36.236 --> 00:26:37.386 A:middle
定义直线的两端及其样式

00:26:38.286 --> 00:26:39.996 A:middle
实在感觉很费解

00:26:40.456 --> 00:26:41.606 A:middle
而使用类别方法

00:26:41.606 --> 00:26:42.806 A:middle
可以清晰地看到

00:26:42.806 --> 00:26:44.526 A:middle
你在定义起点终点

00:26:44.526 --> 00:26:45.806 A:middle
两端和边框样式

00:26:45.806 --> 00:26:46.066 A:middle
以及颜色

00:26:46.596 --> 00:26:48.606 A:middle
这多少能让事情

00:26:49.356 --> 00:26:49.506 A:middle
变得简单点

00:26:49.616 --> 00:26:50.756 A:middle
好我们来创建

00:26:50.756 --> 00:26:51.386 A:middle
一个注解

00:26:51.516 --> 00:26:53.156 A:middle
我们的初始化方法支持

00:26:53.186 --> 00:26:55.086 A:middle
三个属性边界 (bound) 类型

00:26:55.086 --> 00:26:56.156 A:middle
还有字典属性

00:26:56.636 --> 00:26:58.256 A:middle
只需要用到其中的两个

00:26:58.556 --> 00:26:59.746 A:middle
边界我们需要知道

00:26:59.746 --> 00:27:00.746 A:middle
它在页面中的具体位置

00:26:59.746 --> 00:27:00.746 A:middle
它在页面中的具体位置

00:27:01.136 --> 00:27:01.936 A:middle
然后是类型

00:27:02.276 --> 00:27:03.426 A:middle
在这里我们要创建

00:27:03.426 --> 00:27:04.306 A:middle
一个正方形的注解

00:27:05.026 --> 00:27:06.346 A:middle
这些属性参数我们现在

00:27:06.346 --> 00:27:07.396 A:middle
先暂时留空

00:27:07.396 --> 00:27:10.176 A:middle
等下我再来讲

00:27:10.286 --> 00:27:11.886 A:middle
好我们来设置几个属性

00:27:11.886 --> 00:27:12.906 A:middle
我们要为它设置个颜色

00:27:12.906 --> 00:27:13.936 A:middle
我们已经知道该怎么做了

00:27:14.376 --> 00:27:15.476 A:middle
但是我们也要设置边框

00:27:15.476 --> 00:27:17.016 A:middle
这里我想

00:27:17.016 --> 00:27:19.356 A:middle
简单讲一下

00:27:19.486 --> 00:27:19.706 A:middle
这个 PDFBorder 对象

00:27:19.926 --> 00:27:21.486 A:middle
注解字典只是

00:27:21.486 --> 00:27:23.316 A:middle
一个键值对应的字典

00:27:23.316 --> 00:27:24.916 A:middle
但其中的的一些值

00:27:24.946 --> 00:27:26.696 A:middle
也可以做成字典

00:27:26.696 --> 00:27:28.036 A:middle
所以大家不必去翻

00:27:28.036 --> 00:27:29.146 A:middle
规范查找自己

00:27:29.146 --> 00:27:30.086 A:middle
应该如何构建

00:27:30.086 --> 00:27:31.446 A:middle
这个边框字典值

00:27:31.706 --> 00:27:32.866 A:middle
我们已经为大家

00:27:32.866 --> 00:27:34.036 A:middle
创建了一个支持类

00:27:34.086 --> 00:27:34.746 A:middle
就是 PDFBorder

00:27:35.576 --> 00:27:37.556 A:middle
我们要设置直线宽度

00:27:37.556 --> 00:27:39.056 A:middle
赋给我们的注解边框属性

00:27:39.146 --> 00:27:40.536 A:middle
接着将它加入到页面中

00:27:40.536 --> 00:27:41.316 A:middle
最后写出来

00:27:41.316 --> 00:27:42.006 A:middle
大概就是这样

00:27:42.346 --> 00:27:43.386 A:middle
就是一个简单的正方形

00:27:43.736 --> 00:27:45.126 A:middle
在我们页面的左下角

00:27:45.126 --> 00:27:45.756 A:middle
并且是红色的

00:27:46.316 --> 00:27:48.806 A:middle
我们再来看一下

00:27:48.806 --> 00:27:50.266 A:middle
属性参数

00:27:50.266 --> 00:27:51.466 A:middle
我们能做的就是

00:27:51.466 --> 00:27:53.156 A:middle
可以事先为属性

00:27:53.156 --> 00:27:53.706 A:middle
指定一个字典

00:27:54.216 --> 00:27:55.046 A:middle
我们再来创建

00:27:55.046 --> 00:27:56.556 A:middle
一条直线  我们已经

00:27:56.556 --> 00:27:57.856 A:middle
知道这需要直线的两点

00:27:57.856 --> 00:27:59.626 A:middle
两端样式颜色

00:27:59.626 --> 00:28:00.036 A:middle
现在再加上边框

00:27:59.626 --> 00:28:00.036 A:middle
现在再加上边框

00:28:00.656 --> 00:28:01.546 A:middle
所以我们在

00:28:01.546 --> 00:28:03.786 A:middle
进行直线注解时

00:28:03.786 --> 00:28:05.216 A:middle
不再用 nil 来设置属性

00:28:05.216 --> 00:28:06.406 A:middle
而是使用我们的

00:28:06.406 --> 00:28:07.316 A:middle
字典 lineAttributes

00:28:08.036 --> 00:28:09.136 A:middle
将它加入页面后

00:28:09.136 --> 00:28:09.926 A:middle
出来的效果大概

00:28:09.926 --> 00:28:10.196 A:middle
是这样

00:28:10.806 --> 00:28:12.286 A:middle
这是一条直线始于原点

00:28:12.286 --> 00:28:14.046 A:middle
向着右上方延伸

00:28:14.046 --> 00:28:15.986 A:middle
一头带一个箭头

00:28:15.986 --> 00:28:17.296 A:middle
颜色是红色

00:28:17.426 --> 00:28:21.026 A:middle
我想简单讲一下

00:28:21.026 --> 00:28:22.276 A:middle
一个很好用的

00:28:22.276 --> 00:28:23.266 A:middle
注解属性

00:28:23.516 --> 00:28:24.486 A:middle
就是 Action 属性

00:28:24.736 --> 00:28:26.496 A:middle
PDFAction 跟 PDFBorder 一样

00:28:26.496 --> 00:28:28.246 A:middle
是个字典的包装

00:28:28.246 --> 00:28:30.366 A:middle
所以你可以实现多种操作

00:28:30.366 --> 00:28:32.416 A:middle
比如跳转至某个 URL

00:28:32.416 --> 00:28:34.306 A:middle
这里我们创建了一个 URL

00:28:34.306 --> 00:28:36.026 A:middle
用它来创建一个 PDFAction URL 对象

00:28:36.146 --> 00:28:37.256 A:middle
然后将它赋给

00:28:37.256 --> 00:28:37.956 A:middle
我们的注解

00:28:38.156 --> 00:28:39.196 A:middle
在这里就是这个

00:28:39.196 --> 00:28:40.036 A:middle
LinkAnnotation

00:28:40.596 --> 00:28:42.116 A:middle
不过我们还可以做些别的

00:28:42.116 --> 00:28:43.426 A:middle
比如跳转至文档中

00:28:43.426 --> 00:28:43.986 A:middle
某个特定的点

00:28:44.596 --> 00:28:46.116 A:middle
要做到这点可以使用

00:28:46.116 --> 00:28:47.276 A:middle
页面和一个给定点创建

00:28:47.276 --> 00:28:49.196 A:middle
一个 PDFDestination 对象

00:28:49.196 --> 00:28:50.926 A:middle
再用它来创建我们的 PDFActionGoto 动作

00:28:50.926 --> 00:28:53.076 A:middle
然后同样是设为

00:28:53.076 --> 00:28:53.746 A:middle
我们的 Action 属性

00:28:54.456 --> 00:28:57.176 A:middle
好我们再来讲一下小部件 (widget)

00:28:57.936 --> 00:28:59.206 A:middle
小部件同样是我们的

00:28:59.206 --> 00:29:00.806 A:middle
一种交互性表单元素

00:28:59.206 --> 00:29:00.806 A:middle
一种交互性表单元素

00:29:00.806 --> 00:29:02.006 A:middle
但是它们的创建方法

00:29:02.006 --> 00:29:03.236 A:middle
有点令人费解所以我来

00:29:03.236 --> 00:29:03.936 A:middle
为大家拆分讲解一下

00:29:04.026 --> 00:29:05.886 A:middle
我们设计了各种各样的

00:29:05.886 --> 00:29:06.346 A:middle
小部件

00:29:06.426 --> 00:29:08.696 A:middle
有文本小部件按钮小部件

00:29:08.696 --> 00:29:09.496 A:middle
还有选项小部件

00:29:09.966 --> 00:29:11.776 A:middle
好让 PDFKit 知道要将

00:29:11.776 --> 00:29:13.036 A:middle
什么类型的小部件和交互元素

00:29:13.036 --> 00:29:14.276 A:middle
添加到你的 PDF 文档中

00:29:14.616 --> 00:29:15.476 A:middle
你需要让我们知道

00:29:15.846 --> 00:29:17.056 A:middle
这要通过我们的 widgetFieldType 属性

00:29:17.056 --> 00:29:18.616 A:middle
来控制是做一个

00:29:18.616 --> 00:29:19.766 A:middle
文本按钮还是选项

00:29:21.536 --> 00:29:22.626 A:middle
不仅如此我们有些子类型

00:29:22.626 --> 00:29:24.036 A:middle
还能提供更多选择

00:29:24.526 --> 00:29:25.816 A:middle
比如说按钮它可以是

00:29:25.816 --> 00:29:27.616 A:middle
单选按钮复选框或者

00:29:27.616 --> 00:29:29.116 A:middle
推送按钮具体靠我们的

00:29:29.116 --> 00:29:30.346 A:middle
widgetControlType 属性

00:29:30.346 --> 00:29:30.776 A:middle
来控制

00:29:32.196 --> 00:29:33.666 A:middle
对于选项小部件

00:29:33.666 --> 00:29:34.066 A:middle
也是一样

00:29:34.556 --> 00:29:36.176 A:middle
这里是一个列表框

00:29:36.176 --> 00:29:38.176 A:middle
视图就像一个表格或者

00:29:38.176 --> 00:29:39.386 A:middle
类似于下拉菜单的组合框

00:29:39.526 --> 00:29:40.966 A:middle
这可以通过我们的

00:29:40.966 --> 00:29:42.026 A:middle
isListChoice 属性来实现

00:29:42.486 --> 00:29:44.036 A:middle
它的默认类型为

00:29:44.306 --> 00:29:45.886 A:middle
列表框  但是我想

00:29:45.886 --> 00:29:46.656 A:middle
让大家知道

00:29:46.656 --> 00:29:47.216 A:middle
还有另外两种类型

00:29:47.886 --> 00:29:50.176 A:middle
让我们直接来

00:29:50.176 --> 00:29:50.416 A:middle
创建一个小部件看看

00:29:50.416 --> 00:29:51.686 A:middle
我们要创建一个

00:29:51.686 --> 00:29:52.016 A:middle
文本小部件

00:29:52.686 --> 00:29:54.236 A:middle
所以我们的子类型

00:29:54.576 --> 00:29:56.326 A:middle
就是小部件接着在我们

00:29:56.326 --> 00:29:57.366 A:middle
开始设置属性时  我们知道

00:29:57.366 --> 00:29:58.286 A:middle
我们得要指定 widgetFieldType

00:29:58.286 --> 00:29:59.156 A:middle
那我们就将它

00:29:59.156 --> 00:29:59.646 A:middle
设为 text

00:29:59.746 --> 00:30:00.636 A:middle
然后我们会设定另外的

00:29:59.746 --> 00:30:00.636 A:middle
然后我们会设定另外的

00:30:00.636 --> 00:30:00.976 A:middle
几个属性

00:30:01.376 --> 00:30:03.146 A:middle
我们设定了背景颜色

00:30:03.376 --> 00:30:05.246 A:middle
字体字符串值

00:30:05.246 --> 00:30:06.606 A:middle
然后将它添加至页面

00:30:06.606 --> 00:30:07.736 A:middle
出来的效果大概

00:30:07.736 --> 00:30:08.026 A:middle
就是这样

00:30:08.026 --> 00:30:10.076 A:middle
我们将这个文本小部件

00:30:10.076 --> 00:30:11.366 A:middle
放在了页面中央处

00:30:11.366 --> 00:30:13.136 A:middle
蓝色背景显示的字符串为

00:30:13.176 --> 00:30:15.016 A:middle
WWDC2017

00:30:15.656 --> 00:30:16.746 A:middle
如果这一切是在视图里

00:30:16.746 --> 00:30:17.796 A:middle
每当我轻点它

00:30:17.796 --> 00:30:19.056 A:middle
或者单击它时

00:30:19.056 --> 00:30:19.596 A:middle
它会全面支持交互

00:30:22.066 --> 00:30:23.836 A:middle
好我们来看一个

00:30:23.876 --> 00:30:26.016 A:middle
现实世界中

00:30:26.016 --> 00:30:26.416 A:middle
使用小部件的例子

00:30:27.226 --> 00:30:28.656 A:middle
我已经先写了一个

00:30:28.766 --> 00:30:30.966 A:middle
生成了一个 PDF 内容是

00:30:30.966 --> 00:30:32.266 A:middle
一份问卷调查并为它

00:30:32.266 --> 00:30:33.626 A:middle
添加了一些交互表单元素

00:30:34.156 --> 00:30:35.786 A:middle
我们来看看

00:30:35.786 --> 00:30:36.186 A:middle
最后的结果是什么样

00:30:36.976 --> 00:30:37.686 A:middle
就是这个

00:30:37.686 --> 00:30:39.856 A:middle
有几行文本栏附带

00:30:39.916 --> 00:30:41.876 A:middle
蓝色背景然后是

00:30:42.106 --> 00:30:43.476 A:middle
按钮使用我指定的

00:30:43.476 --> 00:30:45.146 A:middle
灰色背景鉴于我们都是

00:30:45.146 --> 00:30:46.796 A:middle
小部件魔法师我们都知道

00:30:46.796 --> 00:30:48.346 A:middle
我们的文本栏应该设为

00:30:48.346 --> 00:30:50.146 A:middle
widgetFieldType 文本

00:30:50.146 --> 00:30:51.266 A:middle
按钮也是 widgetFieldType 按钮

00:30:51.526 --> 00:30:53.176 A:middle
不仅如此我们的

00:30:53.176 --> 00:30:54.416 A:middle
按钮还会使用适当的

00:30:54.416 --> 00:30:56.826 A:middle
widgetControlType 集合

00:30:57.376 --> 00:30:58.446 A:middle
所以我们能看到单选按钮

00:30:58.746 --> 00:31:00.976 A:middle
复选按钮还有一个推送按钮

00:30:58.746 --> 00:31:00.976 A:middle
复选按钮还有一个推送按钮

00:31:00.976 --> 00:31:01.896 A:middle
在下面用来

00:31:01.896 --> 00:31:03.426 A:middle
重置我的整个

00:31:03.426 --> 00:31:03.726 A:middle
表单

00:31:04.206 --> 00:31:05.546 A:middle
不过这个 PDF 上

00:31:05.546 --> 00:31:06.776 A:middle
有几处地方

00:31:06.876 --> 00:31:07.496 A:middle
也不太对

00:31:07.646 --> 00:31:09.426 A:middle
例如当我准备输入

00:31:09.426 --> 00:31:12.686 A:middle
一个日期 6月9日

00:31:12.686 --> 00:31:13.456 A:middle
你能看到它并没有

00:31:13.456 --> 00:31:14.726 A:middle
显示出我想要的间隔样式

00:31:15.186 --> 00:31:16.256 A:middle
并且我可以输入

00:31:16.256 --> 00:31:18.066 A:middle
更多的字符比 PDF 告诉我

00:31:18.116 --> 00:31:19.236 A:middle
应该输入的字符数

00:31:19.236 --> 00:31:19.526 A:middle
要多很多

00:31:19.906 --> 00:31:20.996 A:middle
这是不行的

00:31:21.546 --> 00:31:22.596 A:middle
此外当我选择单选

00:31:22.596 --> 00:31:24.396 A:middle
按钮时我也可以同时

00:31:24.396 --> 00:31:25.056 A:middle
把两个都选上

00:31:25.056 --> 00:31:26.126 A:middle
这并不是单选按钮

00:31:26.126 --> 00:31:27.146 A:middle
应有的动作

00:31:28.186 --> 00:31:29.546 A:middle
最后我放在最下方的

00:31:29.546 --> 00:31:31.366 A:middle
按钮在我单击时

00:31:31.366 --> 00:31:32.436 A:middle
它一点反应也没有

00:31:32.886 --> 00:31:33.936 A:middle
那好让我们接着来

00:31:33.936 --> 00:31:35.896 A:middle
修改所有这些问题

00:31:36.066 --> 00:31:37.466 A:middle
我们先来看日期栏

00:31:37.506 --> 00:31:38.766 A:middle
记得出现的问题

00:31:38.766 --> 00:31:39.186 A:middle
是什么

00:31:39.186 --> 00:31:40.346 A:middle
问题是间隔样式

00:31:40.346 --> 00:31:41.496 A:middle
和我们可以输入的

00:31:41.496 --> 00:31:41.786 A:middle
字符个数

00:31:42.026 --> 00:31:43.276 A:middle
那么我们先从简单的

00:31:43.276 --> 00:31:44.416 A:middle
那个开始也就是

00:31:44.416 --> 00:31:44.966 A:middle
输入字符的个数

00:31:45.586 --> 00:31:47.246 A:middle
这要通过我们的 maximumLength

00:31:47.246 --> 00:31:47.876 A:middle
属性来实现

00:31:48.046 --> 00:31:49.936 A:middle
我们将它设为 5

00:31:49.936 --> 00:31:51.696 A:middle
月份 2 个字符斜线1个字符

00:31:51.696 --> 00:31:51.976 A:middle
日子 2 个字符

00:31:51.976 --> 00:31:53.526 A:middle
接下来是间隔样式

00:31:53.526 --> 00:31:55.116 A:middle
这个问题看上去有点难

00:31:55.646 --> 00:31:56.916 A:middle
但实际上凭借 PDFKit

00:31:56.916 --> 00:31:57.516 A:middle
这一点都不难

00:31:57.886 --> 00:31:58.946 A:middle
只需要我们设定

00:31:58.946 --> 00:32:00.366 A:middle
一个属性也就是我们的

00:31:58.946 --> 00:32:00.366 A:middle
一个属性也就是我们的

00:32:00.366 --> 00:32:01.566 A:middle
hasComb 属性

00:32:02.436 --> 00:32:04.136 A:middle
这个属性的用途是

00:32:04.136 --> 00:32:06.096 A:middle
被设定后会将我们的

00:32:06.096 --> 00:32:07.656 A:middle
文本小部件切割为

00:32:07.656 --> 00:32:10.076 A:middle
几个部分或者几处间隔

00:32:10.206 --> 00:32:11.426 A:middle
数量就等于我们的

00:32:11.426 --> 00:32:12.346 A:middle
maximumLength 字段的赋值

00:32:12.576 --> 00:32:14.906 A:middle
这个属性仅可配合

00:32:14.996 --> 00:32:16.676 A:middle
maximumLength 使用

00:32:17.116 --> 00:32:17.446 A:middle
好

00:32:17.536 --> 00:32:18.216 A:middle
一个问题搞定

00:32:18.286 --> 00:32:19.416 A:middle
接着是单选按钮

00:32:20.746 --> 00:32:22.206 A:middle
这里的问题是

00:32:22.206 --> 00:32:23.336 A:middle
它们的动作不像个

00:32:23.336 --> 00:32:23.706 A:middle
单选按钮

00:32:25.056 --> 00:32:26.806 A:middle
我们所有的小部件

00:32:26.806 --> 00:32:27.916 A:middle
都已经有了自己的

00:32:27.916 --> 00:32:29.296 A:middle
标识符具体是用我们的

00:32:29.296 --> 00:32:30.756 A:middle
fieldname 属性来控制

00:32:31.246 --> 00:32:32.426 A:middle
所以如果你想把小部件

00:32:32.426 --> 00:32:33.786 A:middle
聚合在一起就需要它们

00:32:33.786 --> 00:32:34.596 A:middle
使用相同的字段名

00:32:35.046 --> 00:32:37.266 A:middle
我们来试试看

00:32:37.336 --> 00:32:38.636 A:middle
我们将“是”按钮设为

00:32:38.636 --> 00:32:39.266 A:middle
问题1

00:32:39.846 --> 00:32:41.616 A:middle
然后我们的“否”按钮

00:32:41.616 --> 00:32:42.206 A:middle
也设为问题1

00:32:43.456 --> 00:32:44.296 A:middle
这里我要说一下

00:32:44.296 --> 00:32:45.206 A:middle
这里的名称用什么都没关系

00:32:45.206 --> 00:32:46.676 A:middle
唯一重要的就是

00:32:46.676 --> 00:32:47.596 A:middle
让两者使用同一个名称

00:32:48.036 --> 00:32:49.506 A:middle
但当我运行这段代码

00:32:49.506 --> 00:32:50.916 A:middle
并且选中一个单选按钮后

00:32:50.916 --> 00:32:52.156 A:middle
结果却是所有选项全部激活

00:32:52.156 --> 00:32:53.486 A:middle
或者全部关闭

00:32:53.486 --> 00:32:55.116 A:middle
这是因为我们不知道...

00:32:55.116 --> 00:32:55.676 A:middle
我们没有一个办法来

00:32:55.676 --> 00:32:57.246 A:middle
区分“是”按钮

00:32:57.246 --> 00:32:58.016 A:middle
和“否”按钮

00:32:58.066 --> 00:32:59.856 A:middle
它们需要各自设定

00:32:59.856 --> 00:33:01.406 A:middle
只属于自己的

00:32:59.856 --> 00:33:01.406 A:middle
只属于自己的

00:33:01.406 --> 00:33:02.036 A:middle
子标识符

00:33:02.646 --> 00:33:04.186 A:middle
要实现这一点只需要设置一下

00:33:04.186 --> 00:33:05.126 A:middle
buttonWidgetStateString

00:33:05.126 --> 00:33:05.556 A:middle
属性

00:33:06.406 --> 00:33:08.186 A:middle
我们这就来加上去

00:33:08.186 --> 00:33:09.526 A:middle
将我们的“是”按钮设为“是”

00:33:09.656 --> 00:33:12.046 A:middle
“否”按钮设为“否”

00:33:12.616 --> 00:33:13.696 A:middle
同样具体用什么字符串

00:33:13.696 --> 00:33:14.566 A:middle
都无所谓

00:33:15.006 --> 00:33:17.646 A:middle
我也可以这个用 “Nicki”

00:33:17.736 --> 00:33:18.616 A:middle
这个用 “Brower”

00:33:19.676 --> 00:33:20.756 A:middle
唯一重要的就是

00:33:20.756 --> 00:33:21.106 A:middle
给他们不同的值

00:33:21.656 --> 00:33:22.916 A:middle
现在我们已经用 fieldName

00:33:22.916 --> 00:33:24.516 A:middle
属性将它们聚合在一起

00:33:24.516 --> 00:33:25.906 A:middle
但我们也用了

00:33:25.906 --> 00:33:27.356 A:middle
buttonWidgetStateString 属性

00:33:27.356 --> 00:33:28.136 A:middle
来区分它们

00:33:28.636 --> 00:33:32.146 A:middle
最后一个问题

00:33:32.146 --> 00:33:32.886 A:middle
我们的重置按钮

00:33:33.526 --> 00:33:35.636 A:middle
同样我们希望它能将

00:33:35.636 --> 00:33:37.086 A:middle
整个表单恢复到

00:33:37.086 --> 00:33:37.426 A:middle
初始状态

00:33:38.086 --> 00:33:40.016 A:middle
就像 PDFActionURL

00:33:40.016 --> 00:33:41.866 A:middle
和 PDFActionGoto 我们也有

00:33:41.866 --> 00:33:43.366 A:middle
PDFActionResetForm 可以用

00:33:44.016 --> 00:33:45.916 A:middle
我们现在就来创建它

00:33:47.416 --> 00:33:49.966 A:middle
这个动作的运行原理是

00:33:49.966 --> 00:33:51.476 A:middle
获取一个字符串数组

00:33:52.196 --> 00:33:53.396 A:middle
这些字符串就是字段名

00:33:53.396 --> 00:33:54.896 A:middle
就像我们为单选按钮

00:33:54.896 --> 00:33:56.856 A:middle
设置的那些那样

00:33:56.856 --> 00:33:58.046 A:middle
它的默认行为是

00:33:58.046 --> 00:33:59.376 A:middle
在执行这个动作后

00:33:59.376 --> 00:34:00.986 A:middle
它会重置所有与

00:33:59.376 --> 00:34:00.986 A:middle
它会重置所有与

00:34:00.986 --> 00:34:03.016 A:middle
我给定的字段名字符串数组

00:34:03.016 --> 00:34:03.886 A:middle
相关联的小部件

00:34:04.346 --> 00:34:05.486 A:middle
但是我并不想一个个地

00:34:05.486 --> 00:34:06.586 A:middle
为我所有的小部件

00:34:06.586 --> 00:34:07.616 A:middle
指定和区分这些字段名

00:34:07.616 --> 00:34:08.856 A:middle
这对我来说

00:34:08.856 --> 00:34:09.005 A:middle
太繁琐了

00:34:09.005 --> 00:34:10.466 A:middle
所以我要用某种方式

00:34:10.466 --> 00:34:12.326 A:middle
修改这个动作的行为

00:34:12.326 --> 00:34:13.366 A:middle
我的做法就是将

00:34:13.366 --> 00:34:14.795 A:middle
fieldsIncludedAreClear 属性

00:34:14.795 --> 00:34:15.766 A:middle
设为 false

00:34:16.246 --> 00:34:18.136 A:middle
就这样只用了一行代码

00:34:18.136 --> 00:34:19.346 A:middle
我就实现了两个

00:34:19.346 --> 00:34:19.676 A:middle
不同的目的

00:34:20.426 --> 00:34:21.826 A:middle
现在我已经将行为

00:34:21.826 --> 00:34:23.196 A:middle
修改成在我按下...

00:34:23.196 --> 00:34:25.126 A:middle
在我执行这个动作时

00:34:25.126 --> 00:34:27.036 A:middle
不在我列表内的小部件

00:34:27.036 --> 00:34:28.266 A:middle
会被清空

00:34:28.266 --> 00:34:29.966 A:middle
此外我还没有将任何

00:34:29.966 --> 00:34:30.346 A:middle
小部件设置到我的列表

00:34:30.906 --> 00:34:31.946 A:middle
所以现在当我执行这段时

00:34:32.266 --> 00:34:33.576 A:middle
我文档里的所有小部件

00:34:33.576 --> 00:34:34.716 A:middle
都会被清空这正是

00:34:34.716 --> 00:34:35.266 A:middle
我想要的效果

00:34:35.516 --> 00:34:37.366 A:middle
当然接下来我们就要

00:34:37.366 --> 00:34:38.456 A:middle
为我们的按钮设置 action 属性

00:34:38.456 --> 00:34:40.255 A:middle
就这样就只需要

00:34:40.255 --> 00:34:40.985 A:middle
这三行代码

00:34:41.436 --> 00:34:43.516 A:middle
现在让我们重新运行

00:34:43.516 --> 00:34:44.706 A:middle
重新填写一个

00:34:44.706 --> 00:34:45.726 A:middle
一切功能完备的

00:34:45.726 --> 00:34:46.416 A:middle
问卷调查

00:34:47.056 --> 00:34:49.326 A:middle
好了我们来输入姓名

00:34:49.966 --> 00:34:52.505 A:middle
Nicki Brower 日期

00:34:52.505 --> 00:34:53.926 A:middle
6 月 9 日

00:34:54.406 --> 00:34:55.606 A:middle
我们看到了想要的

00:34:55.606 --> 00:34:57.426 A:middle
间隔样式我不知道大家

00:34:57.426 --> 00:34:58.386 A:middle
能否听见但我正在按动按钮

00:34:58.386 --> 00:34:59.496 A:middle
我也无法继续输入

00:34:59.496 --> 00:35:01.496 A:middle
超过规定数量的字符

00:34:59.496 --> 00:35:01.496 A:middle
超过规定数量的字符

00:35:01.496 --> 00:35:02.586 A:middle
就像我们想要的那样

00:35:03.356 --> 00:35:04.096 A:middle
您以前曾参加过

00:35:04.096 --> 00:35:04.856 A:middle
音乐节吗

00:35:04.986 --> 00:35:06.516 A:middle
“否”等等“是”我去过

00:35:07.346 --> 00:35:08.176 A:middle
您曾参加过以下

00:35:08.176 --> 00:35:09.296 A:middle
哪个音乐节

00:35:09.436 --> 00:35:10.776 A:middle
我去过 iFestival

00:35:10.776 --> 00:35:12.946 A:middle
Swiftopia 但没去过 Applepalooza

00:35:14.016 --> 00:35:15.436 A:middle
请给出一条针对音乐节的

00:35:15.436 --> 00:35:17.046 A:middle
改进建议

00:35:17.916 --> 00:35:21.026 A:middle
所有的音乐节都应该

00:35:21.026 --> 00:35:21.366 A:middle
能免费参加

00:35:21.366 --> 00:35:23.816 A:middle
我还想说明一下

00:35:23.816 --> 00:35:25.346 A:middle
我们的文本小部件默认

00:35:25.346 --> 00:35:26.926 A:middle
为单行  但如何你想让它

00:35:26.926 --> 00:35:28.116 A:middle
变成多行并且附带

00:35:28.116 --> 00:35:29.186 A:middle
自动换行就像我这个这样

00:35:29.186 --> 00:35:30.736 A:middle
所有这些只需要设置一个

00:35:30.736 --> 00:35:31.906 A:middle
简单的类别方法

00:35:31.906 --> 00:35:32.216 A:middle
就能做到

00:35:32.856 --> 00:35:34.436 A:middle
现在有了这个 PDF

00:35:34.436 --> 00:35:35.696 A:middle
我可以保存它  它会记下

00:35:35.696 --> 00:35:36.806 A:middle
我想要的所有数据值

00:35:36.806 --> 00:35:38.176 A:middle
我可以将它发送给别人

00:35:38.176 --> 00:35:39.186 A:middle
他们也能看到我的数据值

00:35:39.666 --> 00:35:41.886 A:middle
或者我想要的话还可以

00:35:41.886 --> 00:35:43.336 A:middle
接着清空我的整个 PDF

00:35:43.576 --> 00:35:45.326 A:middle
使用最下方的

00:35:45.326 --> 00:35:45.916 A:middle
“清除”按钮即可

00:35:46.346 --> 00:35:47.716 A:middle
所以我按一下它一切就又

00:35:47.716 --> 00:35:48.856 A:middle
回归到一开始的样子

00:35:49.896 --> 00:35:51.226 A:middle
这也是我们想要

00:35:51.226 --> 00:35:51.636 A:middle
看到的行为

00:35:52.346 --> 00:35:53.586 A:middle
那么我给大家看了 PDFKit

00:35:53.586 --> 00:35:54.996 A:middle
它的使用方法并不难不管是

00:35:55.036 --> 00:35:57.126 A:middle
生成简单的 PDF 还是添加小部件

00:35:57.126 --> 00:35:58.276 A:middle
现在你有了一个完全

00:35:58.276 --> 00:35:59.366 A:middle
支持交互的 PDF 可以

00:35:59.366 --> 00:36:00.396 A:middle
随意分享给任何人

00:35:59.366 --> 00:36:00.396 A:middle
随意分享给任何人

00:36:00.496 --> 00:36:02.126 A:middle
我不知道大家有什么想法

00:36:02.126 --> 00:36:03.666 A:middle
我个人是觉得它挺好用的

00:36:03.666 --> 00:36:04.976 A:middle
那么我们继续下一环节

00:36:05.516 --> 00:36:08.436 A:middle
[掌声]

00:36:08.936 --> 00:36:09.726 A:middle
那么接下来交回给

00:36:09.726 --> 00:36:10.686 A:middle
Jeremy 他会为大家

00:36:10.686 --> 00:36:11.976 A:middle
介绍几种最佳实践

00:36:16.416 --> 00:36:16.856 A:middle
&gt;&gt; 真棒

00:36:17.316 --> 00:36:18.476 A:middle
谢谢你 Nicki

00:36:19.276 --> 00:36:21.116 A:middle
所以在今年 Annotations 经过了

00:36:21.116 --> 00:36:22.596 A:middle
大幅改进我们也修正了

00:36:23.006 --> 00:36:24.956 A:middle
PDFKit 中的许多问题

00:36:24.956 --> 00:36:26.376 A:middle
还大幅改进了

00:36:26.376 --> 00:36:27.276 A:middle
其他的功能

00:36:27.696 --> 00:36:29.096 A:middle
根据我们的经验

00:36:29.096 --> 00:36:30.076 A:middle
我们很想为大家

00:36:30.076 --> 00:36:30.936 A:middle
提供几条建议

00:36:30.936 --> 00:36:32.326 A:middle
供大家借鉴用来优化

00:36:32.326 --> 00:36:33.196 A:middle
你们的代码

00:36:33.786 --> 00:36:35.346 A:middle
那么几条建议

00:36:35.346 --> 00:36:35.816 A:middle
直接入正题

00:36:36.216 --> 00:36:38.076 A:middle
对于你想在运行时生成的

00:36:38.076 --> 00:36:40.396 A:middle
任何一种交互元素

00:36:40.396 --> 00:36:41.786 A:middle
或复杂图形

00:36:41.786 --> 00:36:42.346 A:middle
全部使用 annotation

00:36:42.686 --> 00:36:44.256 A:middle
我们投入了很大心力

00:36:44.256 --> 00:36:45.576 A:middle
来优化这些图形

00:36:45.576 --> 00:36:46.696 A:middle
所以非常推荐大家

00:36:46.696 --> 00:36:47.276 A:middle
善加利用

00:36:47.656 --> 00:36:48.746 A:middle
当然如果你想要

00:36:48.746 --> 00:36:50.516 A:middle
修改 PDFAnnotation

00:36:50.986 --> 00:36:51.956 A:middle
不妨善加利用

00:36:51.956 --> 00:36:53.786 A:middle
PDFAnnotationUtilities 类别的

00:36:53.786 --> 00:36:54.866 A:middle
类扩展

00:36:55.266 --> 00:36:56.536 A:middle
其中的原因就如 Nicki 所说

00:36:56.536 --> 00:36:57.736 A:middle
是因为这些都属于

00:36:57.736 --> 00:36:58.536 A:middle
静态类型函数

00:36:58.816 --> 00:37:00.046 A:middle
你不用再担心

00:36:58.816 --> 00:37:00.046 A:middle
你不用再担心

00:37:00.046 --> 00:37:01.196 A:middle
一个直线点其实是

00:37:01.236 --> 00:37:01.696 A:middle
一个由多个点组成的数组

00:37:01.696 --> 00:37:03.046 A:middle
实际上一个直线点

00:37:03.146 --> 00:37:05.186 A:middle
就是一个 CG 点一对 CG 点

00:37:05.516 --> 00:37:06.396 A:middle
这个概念非常清晰

00:37:07.026 --> 00:37:08.546 A:middle
最后如果你想要完成

00:37:08.546 --> 00:37:10.506 A:middle
自定义 PDFPage 绘制

00:37:10.506 --> 00:37:12.186 A:middle
就需要让你的代码

00:37:12.376 --> 00:37:13.246 A:middle
做到线程安全

00:37:13.566 --> 00:37:14.786 A:middle
这同样是因为

00:37:14.786 --> 00:37:15.976 A:middle
我们投入了很多心力

00:37:15.976 --> 00:37:17.576 A:middle
来优化 PDFKit 让它

00:37:17.576 --> 00:37:19.086 A:middle
尽可能地快速绘制

00:37:19.086 --> 00:37:20.256 A:middle
我们希望能够好好利用

00:37:20.256 --> 00:37:21.236 A:middle
我们的不同平台用到的

00:37:21.236 --> 00:37:21.486 A:middle
所有核心

00:37:21.926 --> 00:37:23.216 A:middle
鉴于我们有许多平台

00:37:23.216 --> 00:37:25.146 A:middle
采用多核设计完全有可能

00:37:25.146 --> 00:37:26.766 A:middle
出现两个线程同时

00:37:26.766 --> 00:37:28.316 A:middle
在主视图中绘制 PDFPage

00:37:28.316 --> 00:37:30.396 A:middle
和在缩略图中绘制 PDFPage

00:37:30.396 --> 00:37:31.766 A:middle
的情况

00:37:32.186 --> 00:37:33.276 A:middle
所以一定要确保

00:37:33.276 --> 00:37:33.846 A:middle
你的代码线程安全

00:37:34.296 --> 00:37:35.636 A:middle
出于同样原因在你

00:37:35.636 --> 00:37:37.386 A:middle
执行自定义 PDFPage 绘制时

00:37:37.386 --> 00:37:39.116 A:middle
确保你在恰当的时点

00:37:39.116 --> 00:37:40.556 A:middle
调用 super

00:37:40.686 --> 00:37:41.796 A:middle
如果你想让你的图形

00:37:41.796 --> 00:37:43.236 A:middle
覆盖在现有内容的上方

00:37:43.536 --> 00:37:44.896 A:middle
先调用 super 然后再执行

00:37:44.896 --> 00:37:45.896 A:middle
你的自定义绘制代码

00:37:46.236 --> 00:37:47.216 A:middle
或者你想把自定义图形

00:37:47.216 --> 00:37:48.396 A:middle
叠压在内容的下方

00:37:48.426 --> 00:37:50.306 A:middle
那就先执行你的代码

00:37:50.306 --> 00:37:51.966 A:middle
最后再来执行

00:37:51.966 --> 00:37:52.456 A:middle
super

00:37:53.146 --> 00:37:54.706 A:middle
接着我们建议不要

00:37:54.816 --> 00:37:57.056 A:middle
在今后应用中做的事

00:37:57.136 --> 00:37:58.976 A:middle
由于 PDFView 在两个平台上

00:37:58.976 --> 00:38:00.166 A:middle
分别以 UIView 和 NSView 为基础

00:37:58.976 --> 00:38:00.166 A:middle
分别以 UIView 和 NSView 为基础

00:38:00.166 --> 00:38:02.426 A:middle
这些视图类让你

00:38:02.426 --> 00:38:04.166 A:middle
可以调用一个叫作

00:38:04.166 --> 00:38:06.006 A:middle
setNeedsDisplay 的方法

00:38:06.006 --> 00:38:07.386 A:middle
或者它的一些变种

00:38:07.666 --> 00:38:08.536 A:middle
这个方法的调用成本

00:38:08.536 --> 00:38:10.096 A:middle
其实非常高  因为这会

00:38:10.096 --> 00:38:11.936 A:middle
一次性地刷新所有内容

00:38:12.036 --> 00:38:12.576 A:middle
成本是很高的

00:38:12.926 --> 00:38:13.816 A:middle
所以尽量别用它

00:38:13.816 --> 00:38:14.876 A:middle
同样如果你想要

00:38:14.876 --> 00:38:15.956 A:middle
使用自定义图形不妨

00:38:15.956 --> 00:38:16.576 A:middle
考虑 annotation

00:38:17.276 --> 00:38:19.266 A:middle
最后不要同时在

00:38:19.266 --> 00:38:20.866 A:middle
不同的线程中修改

00:38:20.866 --> 00:38:21.446 A:middle
PDFPage 的属性

00:38:21.736 --> 00:38:23.806 A:middle
一个很好的例子就是

00:38:23.806 --> 00:38:25.356 A:middle
不要在旋转 PDFPage 的同时

00:38:25.356 --> 00:38:26.676 A:middle
又去绘制缩略图

00:38:27.016 --> 00:38:28.406 A:middle
在这类情况下

00:38:28.526 --> 00:38:30.406 A:middle
可能会出现一些

00:38:30.546 --> 00:38:31.446 A:middle
未定义的视觉效果

00:38:32.116 --> 00:38:33.596 A:middle
最后专门针对

00:38:33.596 --> 00:38:35.266 A:middle
Mac OS 平台尽量不要

00:38:35.266 --> 00:38:36.936 A:middle
使用已弃用的

00:38:36.936 --> 00:38:37.346 A:middle
绘制方法

00:38:37.786 --> 00:38:39.076 A:middle
这里的原因可以一直

00:38:39.076 --> 00:38:40.586 A:middle
追溯到多线程绘制的问题

00:38:40.966 --> 00:38:42.236 A:middle
总之我们搭建了这些

00:38:42.236 --> 00:38:43.456 A:middle
非常复杂的上下文

00:38:43.456 --> 00:38:44.286 A:middle
好让大家可以绘制出

00:38:44.286 --> 00:38:45.916 A:middle
漂亮的图形我们也希望

00:38:45.916 --> 00:38:46.816 A:middle
能将这些上下文

00:38:46.896 --> 00:38:47.746 A:middle
清晰地传达给你们

00:38:47.746 --> 00:38:48.976 A:middle
这些新命名就是

00:38:48.976 --> 00:38:49.326 A:middle
出于这样的目的

00:38:49.636 --> 00:38:50.836 A:middle
以前的命名方式表达的

00:38:50.886 --> 00:38:52.316 A:middle
上下文很模糊而我们想让

00:38:52.316 --> 00:38:53.366 A:middle
大家尽量避免

00:38:53.366 --> 00:38:53.806 A:middle
这种问题

00:38:54.516 --> 00:38:56.096 A:middle
以上就是我们给大家的

00:38:56.096 --> 00:38:56.836 A:middle
几条小建议

00:38:57.866 --> 00:38:59.366 A:middle
但再说回 PDFKit

00:38:59.366 --> 00:39:01.076 A:middle
我们想要强调

00:38:59.366 --> 00:39:01.076 A:middle
我们想要强调

00:39:01.226 --> 00:39:02.626 A:middle
如今应用开发者对于 PDF 处理

00:39:02.626 --> 00:39:04.186 A:middle
真的非常容易上手

00:39:04.186 --> 00:39:05.956 A:middle
他们可以只是用 PDFView

00:39:05.956 --> 00:39:07.226 A:middle
查看一个文档也可以

00:39:07.226 --> 00:39:08.906 A:middle
完全创建一个全新的文档

00:39:09.156 --> 00:39:10.216 A:middle
又或者使用现有的文档

00:39:10.216 --> 00:39:11.266 A:middle
为它添加一些

00:39:11.266 --> 00:39:12.226 A:middle
新的内容

00:39:12.866 --> 00:39:15.176 A:middle
要读取修改保存这些文件

00:39:15.306 --> 00:39:16.886 A:middle
也十分容易

00:39:16.886 --> 00:39:17.796 A:middle
你还可以用 PDF 规范

00:39:17.796 --> 00:39:19.596 A:middle
支持的最新加密方法

00:39:19.596 --> 00:39:20.886 A:middle
来保存文件

00:39:21.706 --> 00:39:22.966 A:middle
当然在你使用最新的

00:39:22.966 --> 00:39:24.416 A:middle
PDF 规范保存这些文件时

00:39:24.416 --> 00:39:26.026 A:middle
也可以用这些

00:39:26.026 --> 00:39:27.236 A:middle
非常强大的表单字段小部件

00:39:27.236 --> 00:39:28.746 A:middle
来创建这些文件

00:39:28.746 --> 00:39:30.046 A:middle
这意味着将有支持完全交互的

00:39:30.046 --> 00:39:31.266 A:middle
表单供你填写

00:39:31.266 --> 00:39:32.866 A:middle
满足你的企业需要

00:39:32.986 --> 00:39:34.406 A:middle
或者你的任何其他需要

00:39:35.346 --> 00:39:37.106 A:middle
最后通过使用 PDFView

00:39:37.106 --> 00:39:38.626 A:middle
别忘了还能让你

00:39:38.686 --> 00:39:40.186 A:middle
获得具备充分可访问性的改进

00:39:40.186 --> 00:39:41.396 A:middle
这是我们这一年里

00:39:41.396 --> 00:39:43.136 A:middle
在两个平台上的努力成果

00:39:43.496 --> 00:39:44.916 A:middle
如果你的用户有任何

00:39:44.916 --> 00:39:46.646 A:middle
可访问性方面的需要就可以

00:39:46.646 --> 00:39:48.136 A:middle
方便地利用这项成果

00:39:48.136 --> 00:39:49.106 A:middle
你也不用担心

00:39:49.106 --> 00:39:50.226 A:middle
任何自定义的编写程序

00:39:50.906 --> 00:39:51.906 A:middle
我和 Nicki 想要

00:39:51.906 --> 00:39:53.216 A:middle
真心地感谢各位

00:39:53.216 --> 00:39:53.956 A:middle
参加今天的讲坛

00:39:54.016 --> 00:39:55.166 A:middle
大家若有任何问题

00:39:55.166 --> 00:39:56.216 A:middle
[掌声] 谢谢

00:39:56.436 --> 00:39:57.776 A:middle
请查看我们的网站

00:39:57.776 --> 00:39:58.786 A:middle
或者直接来讲台这里

00:39:58.786 --> 00:39:59.796 A:middle
我们很愿意解答

00:39:59.796 --> 00:40:00.306 A:middle
任何问题

00:39:59.796 --> 00:40:00.306 A:middle
任何问题

00:40:00.616 --> 00:40:02.336 A:middle
祝大家在 WWDC 上玩得开心

00:40:02.336 --> 00:40:02.926 A:middle
再次感谢
