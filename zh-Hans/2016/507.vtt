WEBVTT

00:00:20.087 --> 00:00:23.323
<c.magenta>制造非凡的音频效果</c>

00:00:23.457 --> 00:00:25.893
<c.magenta>音频效果最佳实践和API指南</c>

00:00:26.226 --> 00:00:27.060
<c.magenta>好</c>

00:00:28.962 --> 00:00:30.163
<c.magenta>下午好</c>

00:00:30.998 --> 00:00:34.334
<c.magenta>多少人想开发一款</c>
<c.magenta>音频效果特别棒的应用</c>

00:00:34.401 --> 00:00:35.903
<c.magenta>但觉得可能会很困难？</c>

00:00:36.803 --> 00:00:38.605
<c.magenta>或者 多少人想要更多地</c>

00:00:38.672 --> 00:00:40.774
<c.magenta>关注应用程序</c>
<c.magenta>整体的用户体验</c>

00:00:40.841 --> 00:00:43.010
<c.magenta>但最终在音频上</c>
<c.magenta>多花费了一点时间？</c>

00:00:43.777 --> 00:00:46.180
<c.magenta>我们一直以来都在努力</c>
<c.magenta>帮助你轻松解决这些问题</c>

00:00:46.580 --> 00:00:49.449
<c.magenta>我叫Saleem</c>
<c.magenta>Core Audio团队的技术人员</c>

00:00:49.516 --> 00:00:51.018
<c.magenta>欢迎大家来到今天</c>

00:00:51.084 --> 00:00:53.420
<c.magenta>关于制造非凡音频效果的</c>
<c.magenta>会议环节</c>

00:00:54.521 --> 00:00:57.191
<c.magenta>让我们整体看下</c>
<c.magenta>今天我们为大家准备了什么</c>

00:00:58.759 --> 00:01:00.961
<c.magenta>我们会先开始介绍</c>
<c.magenta>AVFoundation框架</c>

00:00:58.759 --> 00:01:00.961
<c.magenta>我们会先开始介绍</c>
<c.magenta>AVFoundation框架</c>

00:01:01.261 --> 00:01:04.230
<c.magenta>我们有种类广泛的</c>
<c.magenta>高层API</c>

00:01:04.665 --> 00:01:06.800
<c.magenta>可以让你轻松</c>
<c.magenta>播放和录制音频</c>

00:01:08.101 --> 00:01:12.739
<c.magenta>对于更高级的用例 我们提供</c>
<c.magenta>AudioToolbox框架</c>

00:01:13.607 --> 00:01:15.642
<c.magenta>你可能听说过</c>
<c.magenta>AudioUnits</c>

00:01:15.709 --> 00:01:17.778
<c.magenta>这些是基本的</c>
<c.magenta>组成模块</c>

00:01:19.246 --> 00:01:22.349
<c.magenta>如果你必须使用</c>
<c.magenta>MIDI设备或MIDI数据</c>

00:01:22.416 --> 00:01:23.951
<c.magenta>我们还提供CoreMIDI框架</c>

00:01:24.952 --> 00:01:27.521
<c.magenta>对于游戏开发</c>
<c.magenta>我们提供OpenAL</c>

00:01:29.790 --> 00:01:31.658
<c.magenta>在过去两年里</c>
<c.magenta>我们也一直在添加</c>

00:01:31.725 --> 00:01:33.694
<c.magenta>很多新的API和功能</c>

00:01:34.261 --> 00:01:35.896
<c.magenta>你可以看到</c>
<c.magenta>你可以通过很多方法</c>

00:01:35.963 --> 00:01:37.931
<c.magenta>在你的应用中</c>
<c.magenta>使用音频</c>

00:01:38.265 --> 00:01:40.434
<c.magenta>所以 我们今天的目标是</c>
<c.magenta>指导你</c>

00:01:40.501 --> 00:01:43.670
<c.magenta>针对你的应用需求</c>
<c.magenta>选择正确的API</c>

00:01:44.071 --> 00:01:47.307
<c.magenta>但不必担心 我们也有</c>
<c.magenta>一些新东西与大家分享</c>

00:01:50.277 --> 00:01:51.645
<c.magenta>所以 按今天的日程表</c>

00:01:51.712 --> 00:01:55.048
<c.magenta>我们会先了解我们几个平台的</c>
<c.magenta>一些基本的设置步骤</c>

00:01:55.816 --> 00:01:58.752
<c.magenta>然后 我们会直接深入了解</c>
<c.magenta>一些简单和高级的播放</c>

00:01:58.819 --> 00:02:00.153
<c.magenta>和录制情景</c>

00:01:58.819 --> 00:02:00.153
<c.magenta>和录制情景</c>

00:02:00.921 --> 00:02:02.890
<c.magenta>我们会简要讨论下多声道音频</c>

00:02:03.790 --> 00:02:06.693
<c.magenta>在随后的介绍中</c>
<c.magenta>我们将了解下实时音频</c>

00:02:07.127 --> 00:02:10.297
<c.magenta>以及你制造自己音频效果、</c>
<c.magenta>乐器和生成器的方法</c>

00:02:10.364 --> 00:02:11.798
<c.magenta>最后以MIDI的介绍结尾</c>

00:02:12.266 --> 00:02:13.500
<c.magenta>好 让我们开始吧</c>

00:02:15.936 --> 00:02:20.274
<c.magenta>iOS、watchOS和tvOS</c>
<c.magenta>都有相当丰富的音频功能</c>

00:02:20.340 --> 00:02:22.209
<c.magenta>以及众多写入功能</c>

00:02:22.676 --> 00:02:27.114
<c.magenta>这样 用户才能拨打电话</c>
<c.magenta>播放音频、玩游戏</c>

00:02:27.314 --> 00:02:29.016
<c.magenta>和使用各种提高效率的应用</c>

00:02:29.082 --> 00:02:32.386
<c.magenta>用户可以同时</c>
<c.magenta>或独立进行这些操作</c>

00:02:33.287 --> 00:02:36.657
<c.magenta>所以操作系统管理了</c>
<c.magenta>大量默认的音频行为</c>

00:02:36.723 --> 00:02:39.560
<c.magenta>以便提供一致的</c>
<c.magenta>用户体验</c>

00:02:41.395 --> 00:02:44.665
<c.magenta>让我们通过图表了解为什么</c>
<c.magenta>音频是一种基于管理的服务</c>

00:02:46.433 --> 00:02:47.701
<c.magenta>所以 你拥有一件设备</c>

00:02:48.468 --> 00:02:51.138
<c.magenta>设备有若干的</c>
<c.magenta>输入和输入</c>

00:02:53.140 --> 00:02:55.075
<c.magenta>然后 有操作系统</c>

00:02:55.909 --> 00:02:59.246
<c.magenta>操作系统可能包含大量应用</c>
<c.magenta>有些应用使用音频</c>

00:03:00.147 --> 00:03:01.949
<c.magenta>最后 这里是你的应用</c>

00:03:03.951 --> 00:03:07.287
<c.magenta>所以AVAudioSession是</c>
<c.magenta>你的开发者界面</c>

00:03:07.387 --> 00:03:09.957
<c.magenta>你可以通过该界面</c>
<c.magenta>向系统表达你的应用需求</c>

00:03:11.024 --> 00:03:13.360
<c.magenta>让我们了解下这方面的</c>
<c.magenta>详细内容</c>

00:03:16.163 --> 00:03:19.266
<c.magenta>类别表达</c>
<c.magenta>应用的高级别需求</c>

00:03:19.800 --> 00:03:21.902
<c.magenta>我们提供模式和类别选项</c>

00:03:21.969 --> 00:03:25.205
<c.magenta>可以帮助你进一步定制</c>
<c.magenta>和专门设计你的应用</c>

00:03:28.175 --> 00:03:30.611
<c.magenta>如果你喜欢一些</c>
<c.magenta>更高级的用例</c>

00:03:30.677 --> 00:03:33.046
<c.magenta>比如输入选择</c>
<c.magenta>你可能需要能够选择</c>

00:03:33.113 --> 00:03:35.782
<c.magenta>iPhone的前置麦克风</c>
<c.magenta>而不是底部麦克风</c>

00:03:36.483 --> 00:03:38.051
<c.magenta>如果你处理的是</c>
<c.magenta>多声道音频</c>

00:03:38.118 --> 00:03:40.654
<c.magenta>以及tvOS上的多声道内容</c>
<c.magenta>你可能对声道数</c>

00:03:40.721 --> 00:03:42.189
<c.magenta>这样的东西感兴趣</c>

00:03:43.156 --> 00:03:45.692
<c.magenta>如果你将USB音频设备</c>
<c.magenta>连接到iPhone</c>

00:03:45.759 --> 00:03:47.995
<c.magenta>你可能对采样率</c>
<c.magenta>这样的东西感兴趣</c>

00:03:52.666 --> 00:03:56.303
<c.magenta>所以 当你的应用准备好</c>
<c.magenta>经配置可使用音频时</c>

00:03:56.570 --> 00:03:58.705
<c.magenta>它会通知系统</c>
<c.magenta>应用会话</c>

00:03:59.573 --> 00:04:01.575
<c.magenta>该过程会配置</c>
<c.magenta>设备的硬件</c>

00:03:59.573 --> 00:04:01.575
<c.magenta>该过程会配置</c>
<c.magenta>设备的硬件</c>

00:04:01.642 --> 00:04:03.310
<c.magenta>从而满足你应用的需求</c>

00:04:03.577 --> 00:04:07.214
<c.magenta>并且实际可能对系统中</c>
<c.magenta>其它音频应用造成干扰</c>

00:04:07.381 --> 00:04:09.950
<c.magenta>或者相互混杂 或者</c>
<c.magenta>降低其它音频应用的音量</c>

00:04:14.054 --> 00:04:17.591
<c.magenta>了解下AVAudioSession</c>
<c.magenta>的一些基本使用步骤</c>

00:04:18.024 --> 00:04:20.459
<c.magenta>第一步是</c>
<c.magenta>注册以获取通知</c>

00:04:21.361 --> 00:04:24.364
<c.magenta>三种最重要的通知是</c>
<c.magenta>中断通知</c>

00:04:24.431 --> 00:04:27.634
<c.magenta>路径变更通知以及</c>
<c.magenta>mediaServicesWereReset通知</c>

00:04:28.902 --> 00:04:32.172
<c.magenta>你可以在激活会话之前</c>
<c.magenta>注册以接收这些通知</c>

00:04:32.239 --> 00:04:34.775
<c.magenta>通过几张幻灯片</c>
<c.magenta>我将展示如何管理通知</c>

00:04:37.244 --> 00:04:39.580
<c.magenta>接下来 基于</c>
<c.magenta>你应用的高级别需求</c>

00:04:39.646 --> 00:04:42.549
<c.magenta>你将需要设置适当的</c>
<c.magenta>类别模式和选项</c>

00:04:43.250 --> 00:04:45.018
<c.magenta>那么 让我们看几个例子</c>

00:04:46.854 --> 00:04:48.889
<c.magenta>假如 我正在开发</c>
<c.magenta>一款提高效率的应用</c>

00:04:48.956 --> 00:04:51.425
<c.magenta>在这个应用中</c>
<c.magenta>我想要在用户保存文档时</c>

00:04:51.491 --> 00:04:53.193
<c.magenta>播放简单的声音</c>

00:04:53.961 --> 00:04:56.496
<c.magenta>这里 我们知道音频</c>
<c.magenta>能够增强体验</c>

00:04:56.563 --> 00:04:58.332
<c.magenta>但却不是必要的</c>

00:04:58.699 --> 00:05:01.401
<c.magenta>在这种情况下 我想</c>
<c.magenta>使用AmbientCategory</c>

00:04:58.699 --> 00:05:01.401
<c.magenta>在这种情况下 我想</c>
<c.magenta>使用AmbientCategory</c>

00:05:02.669 --> 00:05:04.938
<c.magenta>这个类别遵循振铃开关</c>

00:05:05.472 --> 00:05:07.441
<c.magenta>音频不在后台播放</c>

00:05:07.708 --> 00:05:09.343
<c.magenta>而始终与其它应用音频混杂</c>

00:05:12.679 --> 00:05:16.149
<c.magenta>若我在开发播客应用</c>
<c.magenta>我应该使用PlaybackCategory</c>

00:05:17.317 --> 00:05:18.652
<c.magenta>SpokenAudio模式</c>

00:05:19.586 --> 00:05:21.722
<c.magenta>这里 我们能看到</c>
<c.magenta>这个应用位置将干扰</c>

00:05:21.822 --> 00:05:23.690
<c.magenta>系统上的其它应用</c>

00:05:25.559 --> 00:05:28.562
<c.magenta>现在 如果你希望音频继续</c>
<c.magenta>在后台播放</c>

00:05:28.629 --> 00:05:32.199
<c.magenta>你也需要在info.plist中</c>
<c.magenta>指定后台音频键</c>

00:05:32.399 --> 00:05:34.668
<c.magenta>这本质上也是</c>
<c.magenta>会话属性</c>

00:05:34.735 --> 00:05:36.904
<c.magenta>只不过是通过</c>
<c.magenta>不同的方式表达</c>

00:05:39.907 --> 00:05:41.041
<c.magenta>而对于导航应用</c>

00:05:41.108 --> 00:05:43.777
<c.magenta>让我们了解一下如何配置</c>
<c.magenta>导航提示</c>

00:05:44.378 --> 00:05:46.680
<c.magenta>你应使用</c>
<c.magenta>PlaybackCategory</c>

00:05:47.447 --> 00:05:48.749
<c.magenta>以及DefaultMode</c>

00:05:49.183 --> 00:05:51.285
<c.magenta>这里有几个</c>
<c.magenta>相关的选项</c>

00:05:51.485 --> 00:05:54.087
<c.magenta>你应同时使用</c>
<c.magenta>InterruptSpokenAudio</c>

00:05:54.154 --> 00:05:56.990
<c.magenta>AndMixWithOthers</c>
<c.magenta>以及duckOthers</c>

00:05:57.758 --> 00:06:00.127
<c.magenta>所以 如果你正在收听</c>
<c.magenta>播客 同时进行导航</c>

00:05:57.758 --> 00:06:00.127
<c.magenta>所以 如果你正在收听</c>
<c.magenta>播客 同时进行导航</c>

00:06:00.194 --> 00:06:02.329
<c.magenta>就会出现导航提示</c>
<c.magenta>表明</c>

00:06:02.396 --> 00:06:03.997
<c.magenta>500英尺后左转</c>

00:06:04.064 --> 00:06:06.600
<c.magenta>提示实际上会中断播客应用</c>

00:06:07.367 --> 00:06:08.836
<c.magenta>如果你在听音乐</c>

00:06:08.936 --> 00:06:12.039
<c.magenta>提示会降低音乐音量</c>
<c.magenta>并混杂在音乐中</c>

00:06:13.740 --> 00:06:17.144
<c.magenta>对于这种应用 你也应</c>
<c.magenta>使用后台音频键</c>

00:06:20.714 --> 00:06:24.051
<c.magenta>接下来 让我们看看如何</c>
<c.magenta>对会话激活进行管理</c>

00:06:25.786 --> 00:06:27.554
<c.magenta>所以 激活意味着什么？</c>

00:06:27.754 --> 00:06:29.890
<c.magenta>激活你的会话 会通知系统</c>

00:06:29.957 --> 00:06:32.759
<c.magenta>配置硬件</c>
<c.magenta>以适应应用的需求</c>

00:06:33.794 --> 00:06:35.896
<c.magenta>比如</c>
<c.magenta>我有一个应用</c>

00:06:35.963 --> 00:06:37.831
<c.magenta>类别为PlayAndRecord</c>

00:06:38.465 --> 00:06:41.235
<c.magenta>当我激活我的会话</c>
<c.magenta>系统会配置硬件</c>

00:06:41.301 --> 00:06:43.470
<c.magenta>使用输入和输出</c>

00:06:46.907 --> 00:06:49.510
<c.magenta>现在 如果我</c>
<c.magenta>在使用音乐应用听音乐时</c>

00:06:49.576 --> 00:06:51.178
<c.magenta>激活会话 会怎么样？</c>

00:06:51.645 --> 00:06:55.048
<c.magenta>这里 我们可以看到</c>
<c.magenta>系统当前状态设置为仅播放</c>

00:06:56.083 --> 00:06:57.718
<c.magenta>所以 当我激活会话时</c>

00:06:58.252 --> 00:07:02.689
<c.magenta>我通知系统 针对输入</c>
<c.magenta>和输出进行硬件配置</c>

00:06:58.252 --> 00:07:02.689
<c.magenta>我通知系统 针对输入</c>
<c.magenta>和输出进行硬件配置</c>

00:07:03.457 --> 00:07:05.826
<c.magenta>而且 既然我</c>
<c.magenta>处在不可混杂的应用位置</c>

00:07:05.893 --> 00:07:07.427
<c.magenta>我中断了音乐应用</c>

00:07:10.264 --> 00:07:12.799
<c.magenta>所以 比如我的应用</c>
<c.magenta>进行了快速录音</c>

00:07:12.866 --> 00:07:15.135
<c.magenta>一旦完成 我就停用会话</c>

00:07:16.136 --> 00:07:19.206
<c.magenta>如果我选择通知其它应用</c>
<c.magenta>我已经停用会话</c>

00:07:19.273 --> 00:07:21.775
<c.magenta>我们将看到</c>
<c.magenta>音乐应用恢复播放</c>

00:07:25.279 --> 00:07:28.849
<c.magenta>接下来 让我们看下如何</c>
<c.magenta>处理我们注册接收的通知</c>

00:07:31.084 --> 00:07:33.420
<c.magenta>我们首先看一下</c>
<c.magenta>中断通知</c>

00:07:33.487 --> 00:07:35.422
<c.magenta>我们会研究一个案例</c>
<c.magenta>案例中 你的应用</c>

00:07:35.489 --> 00:07:37.291
<c.magenta>没有播放UI</c>

00:07:37.858 --> 00:07:40.194
<c.magenta>首先获取</c>
<c.magenta>interruptionType</c>

00:07:40.761 --> 00:07:42.763
<c.magenta>如果这是</c>
<c.magenta>中断的开始</c>

00:07:43.197 --> 00:07:44.932
<c.magenta>你的会话已经停用</c>

00:07:45.799 --> 00:07:47.935
<c.magenta>所以播放器已经暂停</c>

00:07:48.001 --> 00:07:51.171
<c.magenta>你将利用这段时间</c>
<c.magenta>更新你的任何内部状态</c>

00:07:52.940 --> 00:07:54.741
<c.magenta>如果你收到结束中断</c>

00:07:55.342 --> 00:07:57.244
<c.magenta>你会去激活会话</c>

00:07:57.511 --> 00:08:00.514
<c.magenta>启动播放器</c>
<c.magenta>同时更新内部状态</c>

00:07:57.511 --> 00:08:00.514
<c.magenta>启动播放器</c>
<c.magenta>同时更新内部状态</c>

00:08:01.949 --> 00:08:05.419
<c.magenta>我们看下这个过程在拥有</c>
<c.magenta>播放UI的应用中有什么不同</c>

00:08:07.621 --> 00:08:09.690
<c.magenta>你接收开始中断的</c>
<c.magenta>通知</c>

00:08:09.857 --> 00:08:12.860
<c.magenta>你的会话停用</c>
<c.magenta>你更新内部状态</c>

00:08:13.293 --> 00:08:14.962
<c.magenta>而且这次要同时更新UI</c>

00:08:15.229 --> 00:08:17.331
<c.magenta>如果你有播放/暂停按钮</c>

00:08:17.397 --> 00:08:20.200
<c.magenta>这种情况下 你应接着</c>
<c.magenta>将按钮设置为“播放”</c>

00:08:22.369 --> 00:08:24.705
<c.magenta>现在 当你接收到</c>
<c.magenta>结束中断通知</c>

00:08:25.038 --> 00:08:27.941
<c.magenta>你应该查看并了解</c>
<c.magenta>shouldResume选项是否提交进来</c>

00:08:28.509 --> 00:08:31.812
<c.magenta>如果已经提交进来 那么你</c>
<c.magenta>可以继续激活你的会话</c>

00:08:32.011 --> 00:08:34.815
<c.magenta>开始播放 同时更新</c>
<c.magenta>内部状态和UI</c>

00:08:35.515 --> 00:08:36.517
<c.magenta>如果没有提交进来</c>

00:08:36.582 --> 00:08:39.686
<c.magenta>你应等到用户</c>
<c.magenta>明确地恢复播放后</c>

00:08:42.655 --> 00:08:45.792
<c.magenta>应特别注意的是</c>
<c.magenta>你的中断不一定是配对的</c>

00:08:45.859 --> 00:08:49.396
<c.magenta>所以 不是每个开始中断</c>
<c.magenta>随后都匹配一个结束中断</c>

00:08:49.963 --> 00:08:53.800
<c.magenta>一个例子就是</c>
<c.magenta>彼此中断的媒体播放器应用</c>

00:08:57.471 --> 00:08:59.740
<c.magenta>现在 让我们看下</c>
<c.magenta>如何处理路径变更</c>

00:09:00.674 --> 00:09:02.910
<c.magenta>路径变更的</c>
<c.magenta>发生原因有很多：</c>

00:09:03.277 --> 00:09:06.847
<c.magenta>可能是连接设备变化了</c>
<c.magenta>可能是类别变化了</c>

00:09:07.214 --> 00:09:09.850
<c.magenta>可能是你选择了</c>
<c.magenta>不同的数据源或端口</c>

00:09:10.651 --> 00:09:13.320
<c.magenta>首先要获取</c>
<c.magenta>routeChangeReason</c>

00:09:15.389 --> 00:09:18.859
<c.magenta>如果你得到的原因是</c>
<c.magenta>媒体播放器应用中</c>

00:09:18.926 --> 00:09:20.427
<c.magenta>原有设备不可用</c>

00:09:20.494 --> 00:09:22.563
<c.magenta>此时你应停止播放</c>

00:09:22.629 --> 00:09:26.600
<c.magenta>这种情况的一个例子是</c>
<c.magenta>如果你的用户使用耳机</c>

00:09:26.667 --> 00:09:28.001
<c.magenta>收听音乐然后拔下耳机</c>

00:09:28.068 --> 00:09:30.504
<c.magenta>他们不会想</c>
<c.magenta>让音乐立即通过</c>

00:09:30.804 --> 00:09:32.272
<c.magenta>扬声器恢复播放</c>

00:09:34.675 --> 00:09:37.978
<c.magenta>对于更高级的用例 若你</c>
<c.magenta>收到oldDeviceUnavailable</c>

00:09:38.045 --> 00:09:40.681
<c.magenta>或newDeviceAvailable</c>
<c.magenta>routeChangeReason</c>

00:09:40.747 --> 00:09:43.450
<c.magenta>你可能需要在特定会话属性</c>
<c.magenta>应用到你的应用时</c>

00:09:43.517 --> 00:09:45.185
<c.magenta>重新评估这些属性</c>

00:09:48.388 --> 00:09:50.958
<c.magenta>最后 让我们看下</c>
<c.magenta>如何处理设置了通知的</c>

00:09:51.024 --> 00:09:52.693
<c.magenta>媒体服务</c>

00:09:53.393 --> 00:09:56.029
<c.magenta>这种通知很少发生</c>
<c.magenta>但也确实会收到</c>

00:09:56.096 --> 00:09:58.332
<c.magenta>因为我们不能确保</c>
<c.magenta>demon程序永远运行</c>

00:09:59.766 --> 00:10:01.201
<c.magenta>这里需要特别注意的是</c>

00:09:59.766 --> 00:10:01.201
<c.magenta>这里需要特别注意的是</c>

00:10:01.268 --> 00:10:04.605
<c.magenta>你的AVAudioSession</c>
<c.magenta>sharedInstance仍有效</c>

00:10:06.006 --> 00:10:08.976
<c.magenta>你将需要重置</c>
<c.magenta>类别模式和其它选项</c>

00:10:11.011 --> 00:10:13.413
<c.magenta>你也需要破坏和重建</c>
<c.magenta>你的播放器对象</c>

00:10:13.480 --> 00:10:15.082
<c.magenta>如AVAudioEngine</c>

00:10:15.616 --> 00:10:18.085
<c.magenta>远程I/O</c>
<c.magenta>以及其它播放器对象</c>

00:10:19.653 --> 00:10:22.856
<c.magenta>我们提供在设备上</c>
<c.magenta>进行此测试的途径</c>

00:10:22.923 --> 00:10:25.726
<c.magenta>路径是设置——开发者</c>
<c.magenta>——重设媒体服务</c>

00:10:29.830 --> 00:10:32.633
<c.magenta>好 大致重述下</c>
<c.magenta>使用AVAudioSession的</c>

00:10:32.699 --> 00:10:34.868
<c.magenta>四大步骤</c>
<c.magenta>基本步骤</c>

00:10:34.935 --> 00:10:36.603
<c.magenta>你注册以接收通知</c>

00:10:36.670 --> 00:10:39.306
<c.magenta>你设置适当的</c>
<c.magenta>类别模式和选项</c>

00:10:39.373 --> 00:10:41.208
<c.magenta>你对会话激活进行管理</c>

00:10:41.408 --> 00:10:43.110
<c.magenta>并且处理各种通知</c>

00:10:43.477 --> 00:10:45.312
<c.magenta>让我们了解下今年的</c>
<c.magenta>一些新内容</c>

00:10:46.713 --> 00:10:49.416
<c.magenta>今年的新内容中 我们添加了</c>
<c.magenta>两个新的类别选项：</c>

00:10:49.483 --> 00:10:53.487
<c.magenta>将allowAirPlay和allowBluetoothA2DP</c>
<c.magenta>添加到PlayAndRecord类别</c>

00:10:55.122 --> 00:10:58.425
<c.magenta>所以 这意味着你现在可以</c>
<c.magenta>在使用蓝牙或AirPlay终端</c>

00:10:58.492 --> 00:11:00.360
<c.magenta>播放时 同时使用麦克风</c>

00:10:58.492 --> 00:11:00.360
<c.magenta>播放时 同时使用麦克风</c>

00:11:02.095 --> 00:11:03.830
<c.magenta>如果这是你应用的用例</c>

00:11:03.897 --> 00:11:06.733
<c.magenta>继续操作 设置</c>
<c.magenta>类别和选项</c>

00:11:06.800 --> 00:11:08.235
<c.magenta>然后允许用户从</c>

00:11:08.302 --> 00:11:11.672
<c.magenta>MPVolumeView或</c>
<c.magenta> “控制中心”中选择路径</c>

00:11:15.209 --> 00:11:17.344
<c.magenta>我们同时为</c>
<c.magenta>AVAudioSessionPortDescription</c>

00:11:17.411 --> 00:11:19.446
<c.magenta>上的VoIP应用添加了新属性</c>

00:11:19.513 --> 00:11:21.782
<c.magenta>可以决定当前路径</c>
<c.magenta>是否已经激活</c>

00:11:21.849 --> 00:11:23.851
<c.magenta>硬件语音处理</c>

00:11:24.751 --> 00:11:27.487
<c.magenta>所以 如果你的用户</c>
<c.magenta>连接到拥有硬件语音处理的</c>

00:11:27.721 --> 00:11:30.991
<c.magenta>CarPlay系统或</c>
<c.magenta>蓝牙免提耳机</c>

00:11:31.391 --> 00:11:34.795
<c.magenta>你可以使用该属性禁用</c>
<c.magenta>你的软件语音处理功能</c>

00:11:34.862 --> 00:11:36.830
<c.magenta>这样你就不会对音频</c>
<c.magenta>重复处理了</c>

00:11:39.066 --> 00:11:42.503
<c.magenta>如果你已经使用Apple的</c>
<c.magenta>内置语音处理输入/输出设备</c>

00:11:42.569 --> 00:11:44.238
<c.magenta>你无需担心这一点</c>

00:11:45.205 --> 00:11:47.908
<c.magenta>今年新内容中 我们也引进了</c>
<c.magenta>CallKit框架</c>

00:11:48.175 --> 00:11:51.211
<c.magenta>为使你了解如何使用</c>
<c.magenta>CallKit增强你的VoIP应用</c>

00:11:51.278 --> 00:11:52.679
<c.magenta>本周早些时候</c>
<c.magenta>安排了场演讲</c>

00:11:52.746 --> 00:11:55.349
<c.magenta>如果你错过了</c>
<c.magenta>可以到网上收看</c>

00:11:58.018 --> 00:12:00.220
<c.magenta>所以 这只是</c>
<c.magenta>AVAudioSession的概况</c>

00:11:58.018 --> 00:12:00.220
<c.magenta>所以 这只是</c>
<c.magenta>AVAudioSession的概况</c>

00:12:00.287 --> 00:12:02.823
<c.magenta>在之前的演讲中 我们</c>
<c.magenta>对此话题进行了许多深入介绍</c>

00:12:02.890 --> 00:12:06.727
<c.magenta>所以 我们鼓励你到网上查看</c>
<c.magenta>之前的视频和编程指南</c>

00:12:09.763 --> 00:12:10.697
<c.magenta>好 我们继续</c>

00:12:11.098 --> 00:12:14.034
<c.magenta>AVAudioSession适用于</c>
<c.magenta>你平台的情况下 你完成设置</c>

00:12:14.234 --> 00:12:17.771
<c.magenta>现在 我们看下如何在应用中</c>
<c.magenta>进行简单的音频播放和录制</c>

00:12:19.873 --> 00:12:21.942
<c.magenta>我们先看一下</c>
<c.magenta>AVFoundation框架</c>

00:12:22.476 --> 00:12:24.978
<c.magenta>这里有很多级别</c>
<c.magenta>可以处理这种任务</c>

00:12:25.045 --> 00:12:26.647
<c.magenta>我们有AVAudioPlayer</c>

00:12:26.813 --> 00:12:29.650
<c.magenta>AVAudioRecorder</c>
<c.magenta>以及AVPlayer等级别</c>

00:12:32.352 --> 00:12:35.455
<c.magenta>AVAudioPlayer是文件中</c>
<c.magenta>播放音频的最简单方法</c>

00:12:36.056 --> 00:12:38.325
<c.magenta>我们支持各种格式</c>

00:12:39.359 --> 00:12:41.762
<c.magenta>我们提供所有</c>
<c.magenta>基本的播放操作</c>

00:12:42.462 --> 00:12:44.264
<c.magenta>我们同时支持</c>
<c.magenta>一些高级的操作</c>

00:12:44.331 --> 00:12:45.866
<c.magenta>比如 设置音量</c>

00:12:46.166 --> 00:12:48.202
<c.magenta>你可以按照声道获得计量</c>

00:12:48.268 --> 00:12:51.038
<c.magenta>你可以循环播放</c>
<c.magenta>调整播放速度</c>

00:12:51.405 --> 00:12:53.173
<c.magenta>进行立体声调制</c>

00:12:54.575 --> 00:12:57.778
<c.magenta>如果你使用iOS或tvOS</c>
<c.magenta>你可以进行声道分配</c>

00:13:00.747 --> 00:13:03.050
<c.magenta>如果你有多个文件</c>
<c.magenta>要进行播放</c>

00:13:03.116 --> 00:13:05.652
<c.magenta>你可以使用多个</c>
<c.magenta>AVAudioPlayer对象</c>

00:13:05.719 --> 00:13:07.788
<c.magenta>也可以同步你的播放</c>

00:13:09.957 --> 00:13:12.426
<c.magenta>今年新内容中</c>
<c.magenta>加入了一种方法 可以允许你</c>

00:13:12.492 --> 00:13:14.962
<c.magenta>在特定时间内</c>
<c.magenta>逐渐降到某个音量</c>

00:13:18.298 --> 00:13:22.035
<c.magenta>看下代码示例 了解你在应用中</c>
<c.magenta>如何使用AVAudioPlayer</c>

00:13:22.970 --> 00:13:26.373
<c.magenta>比如 我还是在开发和构建</c>
<c.magenta>一个简单的提高效率的应用</c>

00:13:26.440 --> 00:13:27.908
<c.magenta>我想要</c>
<c.magenta>在用户保存文档时</c>

00:13:27.975 --> 00:13:29.643
<c.magenta>播放确认音频</c>

00:13:30.410 --> 00:13:35.616
<c.magenta>这种情况下 我有AVAudioPlayer</c>
<c.magenta>和链接到我级别中资源的URL</c>

00:13:37.117 --> 00:13:41.054
<c.magenta>在设置功能中 我继续操作</c>
<c.magenta>使用我URL的内容</c>

00:13:41.388 --> 00:13:45.392
<c.magenta>创建AVAudioPlayer对象</c>
<c.magenta>同时我准备好播放器进行播放</c>

00:13:47.528 --> 00:13:50.697
<c.magenta>在saveDocument功能中</c>
<c.magenta>我可能进行一些工作</c>

00:13:50.764 --> 00:13:52.566
<c.magenta>了解下文档是否</c>
<c.magenta>保存成功</c>

00:13:52.633 --> 00:13:54.868
<c.magenta>如果已保存 我只需播放文件</c>

00:13:55.068 --> 00:13:56.069
<c.magenta>非常简单</c>

00:13:58.605 --> 00:14:00.340
<c.magenta>现在 让我们看下</c>
<c.magenta>AVAudioRecorder</c>

00:13:58.605 --> 00:14:00.340
<c.magenta>现在 让我们看下</c>
<c.magenta>AVAudioRecorder</c>

00:14:01.742 --> 00:14:04.111
<c.magenta>这是将音频录制到文件的</c>
<c.magenta>最简单方法</c>

00:14:04.745 --> 00:14:06.713
<c.magenta>你可以录制指定的时长</c>

00:14:06.780 --> 00:14:09.616
<c.magenta>或者录制到</c>
<c.magenta>用户明确要求停止的时候</c>

00:14:09.816 --> 00:14:12.186
<c.magenta>你基于声道</c>
<c.magenta>获得计量</c>

00:14:12.452 --> 00:14:14.922
<c.magenta>我们支持各种编码格式</c>

00:14:16.256 --> 00:14:19.960
<c.magenta>所以 要设置格式 我们使用</c>
<c.magenta>Recorder Settings Dictionary</c>

00:14:20.093 --> 00:14:21.628
<c.magenta>这是由键组成的字典</c>

00:14:21.695 --> 00:14:25.465
<c.magenta>包含的键列表可使你</c>
<c.magenta>设置各种格式参数</c>

00:14:25.532 --> 00:14:28.268
<c.magenta>例如采样率和声道数</c>

00:14:28.569 --> 00:14:30.137
<c.magenta>若你使用Linear PCM数据</c>

00:14:30.204 --> 00:14:32.773
<c.magenta>你可以调整位深度</c>
<c.magenta>和字节顺序等</c>

00:14:32.840 --> 00:14:34.441
<c.magenta>如果你使用编码格式</c>

00:14:34.508 --> 00:14:36.710
<c.magenta>你可以调整质量</c>
<c.magenta>和比特率等</c>

00:14:37.244 --> 00:14:40.314
<c.magenta>让我们看下代码示例 了解如何使用</c>
<c.magenta>AVAudioRecorder</c>

00:14:42.683 --> 00:14:45.719
<c.magenta>所以 我首先做的是</c>
<c.magenta>创建格式设置</c>

00:14:46.119 --> 00:14:49.356
<c.magenta>这里 我创建了一个</c>
<c.magenta>比特率相当高的AAC文件</c>

00:14:50.557 --> 00:14:54.494
<c.magenta>然后 我要做的是创建</c>
<c.magenta>AVAudioRecorder对象</c>

00:14:54.995 --> 00:14:56.997
<c.magenta>包含指向文件位置的URL</c>

00:14:57.564 --> 00:14:59.499
<c.magenta>以及我刚刚定义的</c>
<c.magenta>格式设置</c>

00:15:01.935 --> 00:15:04.538
<c.magenta>在这个例子中</c>
<c.magenta>有一个简单的按钮</c>

00:15:04.605 --> 00:15:06.306
<c.magenta>我可以用它来切换</c>
<c.magenta>录音机的状态</c>

00:15:06.473 --> 00:15:09.343
<c.magenta>所以我按下这个按钮时</c>
<c.magenta>如果录音机正在录制</c>

00:15:09.476 --> 00:15:11.111
<c.magenta>我接着操作 停止录制</c>

00:15:11.478 --> 00:15:13.080
<c.magenta>我开始录制</c>

00:15:13.146 --> 00:15:16.617
<c.magenta>我可以使用录音机的</c>
<c.magenta>内置仪表向UI提供反馈</c>

00:15:19.253 --> 00:15:20.988
<c.magenta>最后让我们看下AVPlayer</c>

00:15:22.389 --> 00:15:26.260
<c.magenta>AVPlayer不仅适用于本地文件</c>
<c.magenta>而且适用于流媒体内容</c>

00:15:26.994 --> 00:15:29.363
<c.magenta>你拥有所有的标准控件</c>

00:15:30.531 --> 00:15:32.399
<c.magenta>我们同时提供你可以直接</c>

00:15:32.466 --> 00:15:35.102
<c.magenta>使用的内置用户界面</c>
<c.magenta>比如AVPlayerView</c>

00:15:35.169 --> 00:15:36.870
<c.magenta>以及AVPlayerViewController</c>

00:15:38.372 --> 00:15:40.707
<c.magenta>AVPlayer也适用于</c>
<c.magenta>视频内容</c>

00:15:40.774 --> 00:15:43.510
<c.magenta>今年 我们在AVPlayer中</c>
<c.magenta>添加了若干新功能</c>

00:15:43.577 --> 00:15:45.512
<c.magenta>如果想了解我们做出的改进</c>

00:15:45.579 --> 00:15:48.415
<c.magenta>你可查看AVFoundation</c>
<c.magenta>Playback的新进展</c>

00:15:48.482 --> 00:15:50.851
<c.magenta>如果你错过了那部分</c>
<c.magenta>你可以到网上进行观看</c>

00:15:53.787 --> 00:15:54.888
<c.magenta>高级播放和录制</c>

00:15:54.955 --> 00:15:58.258
<c.magenta>好 目前我们已经了解了</c>
<c.magenta>一些非常简单的</c>

00:15:58.325 --> 00:15:59.826
<c.magenta>播放和录制案例</c>

00:16:00.427 --> 00:16:02.663
<c.magenta>现在 让我们看一下</c>
<c.magenta>一些更高级的用例</c>

00:16:04.364 --> 00:16:07.968
<c.magenta>高级用例不仅包括</c>
<c.magenta>从文件中播放音频</c>

00:16:08.035 --> 00:16:10.237
<c.magenta>而且包括处理</c>
<c.magenta>缓冲音频数据</c>

00:16:12.773 --> 00:16:15.275
<c.magenta>你可能感兴趣的是</c>
<c.magenta>音频处理</c>

00:16:15.342 --> 00:16:18.312
<c.magenta>应用特定的音效</c>
<c.magenta>以及将多个来源的音频混合</c>

00:16:20.147 --> 00:16:22.416
<c.magenta>或者你可能对</c>
<c.magenta>实施3D音效感兴趣</c>

00:16:23.917 --> 00:16:27.521
<c.magenta>这方面的应用案例包括</c>
<c.magenta>开发经典的卡拉OK应用</c>

00:16:28.488 --> 00:16:31.225
<c.magenta>开发具有超高音效的</c>
<c.magenta>DJ应用</c>

00:16:31.558 --> 00:16:34.261
<c.magenta>或者开发一款让用户</c>
<c.magenta>完全沉浸其中的游戏</c>

00:16:36.196 --> 00:16:37.664
<c.magenta>对于这种高级用例</c>

00:16:37.731 --> 00:16:41.134
<c.magenta>我们在AVFoundation中有</c>
<c.magenta>叫AVAudioEngine的级别</c>

00:16:43.036 --> 00:16:45.038
<c.magenta>AVAudioEngine</c>
<c.magenta>是一款强大</c>

00:16:45.105 --> 00:16:47.674
<c.magenta>功能丰富的Objective-C</c>
<c.magenta>和Swift API</c>

00:16:49.810 --> 00:16:51.378
<c.magenta>它是一种实时音频系统</c>

00:16:51.912 --> 00:16:53.914
<c.magenta>可以通过向你提供</c>
<c.magenta>非实时界面</c>

00:16:53.981 --> 00:16:56.350
<c.magenta>简化实时音频的处理工作</c>

00:16:57.484 --> 00:17:00.721
<c.magenta>所以 处理实时音频</c>
<c.magenta>涉及很多复杂的操作</c>

00:16:57.484 --> 00:17:00.721
<c.magenta>所以 处理实时音频</c>
<c.magenta>涉及很多复杂的操作</c>

00:17:00.787 --> 00:17:02.856
<c.magenta>而AVAudioEngine可以</c>
<c.magenta>使你的代码更加简单</c>

00:17:04.992 --> 00:17:07.094
<c.magenta>AVAudioEngine管理</c>
<c.magenta>一个节点图表</c>

00:17:07.327 --> 00:17:09.663
<c.magenta>这些节点使你</c>
<c.magenta>得以播放和录制音频</c>

00:17:10.329 --> 00:17:12.031
<c.magenta>你可以以各种方式</c>
<c.magenta>连接这些节点</c>

00:17:12.098 --> 00:17:14.800
<c.magenta>从而形成多个不同的</c>
<c.magenta>处理链条</c>

00:17:15.769 --> 00:17:16.837
<c.magenta>并进行混音</c>

00:17:17.804 --> 00:17:21.407
<c.magenta>你也可以在处理链条的</c>
<c.magenta>任意一点捕获音频</c>

00:17:22.108 --> 00:17:25.045
<c.magenta>我们提供一个专门的节点</c>
<c.magenta>可以使你实现音频的空间化</c>

00:17:27.414 --> 00:17:30.684
<c.magenta>那么 让我们看一下根本的</c>
<c.magenta>组成部分——AVAudioNode</c>

00:17:31.985 --> 00:17:33.453
<c.magenta>我们有三类节点</c>

00:17:34.354 --> 00:17:36.924
<c.magenta>我们有源节点</c>
<c.magenta>可以提供用于呈现的数据</c>

00:17:37.724 --> 00:17:39.459
<c.magenta>例如你的PlayerNode</c>

00:17:39.526 --> 00:17:42.095
<c.magenta>InputNode或者抽样单位</c>

00:17:43.764 --> 00:17:46.466
<c.magenta>我们有处理节点</c>
<c.magenta>可以使你处理音频数据</c>

00:17:46.700 --> 00:17:50.704
<c.magenta>所以 你客户处理的效果包括</c>
<c.magenta>延迟、失真以及混音</c>

00:17:52.773 --> 00:17:55.642
<c.magenta>我们有目标节点</c>

00:17:55.709 --> 00:17:57.744
<c.magenta>即你图表中的</c>
<c.magenta>终端节点</c>

00:17:57.811 --> 00:18:00.247
<c.magenta>它与输出硬件</c>
<c.magenta>直接连接</c>

00:17:57.811 --> 00:18:00.247
<c.magenta>它与输出硬件</c>
<c.magenta>直接连接</c>

00:18:02.716 --> 00:18:04.251
<c.magenta>让我们看一下设置示例</c>

00:18:05.452 --> 00:18:07.821
<c.magenta>比如 我正在构建</c>
<c.magenta>一款经典的卡拉OK应用</c>

00:18:09.690 --> 00:18:11.692
<c.magenta>在这个例子中</c>
<c.magenta>我有三个源节点</c>

00:18:11.758 --> 00:18:14.361
<c.magenta>我使用InputNode</c>
<c.magenta>捕获用户声音</c>

00:18:14.895 --> 00:18:17.297
<c.magenta>使用PlayerNode</c>
<c.magenta>播放伴奏曲</c>

00:18:18.332 --> 00:18:20.767
<c.magenta>使用另一个PlayerNode</c>
<c.magenta>播放其它音效</c>

00:18:20.834 --> 00:18:22.736
<c.magenta>和对用户使用的反馈</c>

00:18:24.304 --> 00:18:25.739
<c.magenta>对于处理节点</c>

00:18:25.806 --> 00:18:28.742
<c.magenta>我可能会对用户声音</c>
<c.magenta>应用特定的EQ</c>

00:18:30.077 --> 00:18:31.879
<c.magenta>然后我会使用混音器</c>

00:18:31.945 --> 00:18:34.281
<c.magenta>将三个源合成为</c>
<c.magenta>单个输出内容</c>

00:18:35.148 --> 00:18:37.951
<c.magenta>然后这单个输出内容</c>
<c.magenta>将通过OutputNode播放</c>

00:18:38.018 --> 00:18:39.620
<c.magenta>然后传递到输出硬件</c>

00:18:41.522 --> 00:18:44.391
<c.magenta>我也可以捕获用户的声音</c>
<c.magenta>并进行一定的分析</c>

00:18:44.491 --> 00:18:47.461
<c.magenta>从而了解安装TapBlock后</c>
<c.magenta>他们的表现情况</c>

00:18:48.362 --> 00:18:51.231
<c.magenta>然后基于此</c>
<c.magenta>我可以无条件地安排</c>

00:18:51.298 --> 00:18:53.934
<c.magenta>播放出这些反馈队列</c>

00:18:56.170 --> 00:18:58.572
<c.magenta>现在 让我们看一下</c>
<c.magenta>游戏设置示例</c>

00:19:00.274 --> 00:19:03.043
<c.magenta>这里主要相关节点是</c>
<c.magenta>EnvironmentNode</c>

00:19:03.110 --> 00:19:04.845
<c.magenta>它可以模拟3D空间</c>

00:19:05.078 --> 00:19:07.347
<c.magenta>并将相连的源空间化</c>

00:19:07.447 --> 00:19:09.283
<c.magenta>引擎设置示例</c>
<c.magenta>游戏</c>

00:19:09.349 --> 00:19:13.153
<c.magenta>在这个例子中 我使用InputNode</c>
<c.magenta>以及PlayerNode作为源</c>

00:19:14.855 --> 00:19:17.057
<c.magenta>你也可以调整你源上的</c>
<c.magenta>各种3D混音属性</c>

00:19:17.124 --> 00:19:20.627
<c.magenta>比如位置和闭塞</c>

00:19:21.395 --> 00:19:24.064
<c.magenta>而对于EnvironmentNode</c>
<c.magenta>你也可以在那里调整属性</c>

00:19:24.131 --> 00:19:28.001
<c.magenta>如listenerPosition</c>
<c.magenta>以及其它混响参数</c>

00:19:30.571 --> 00:19:33.674
<c.magenta>所以 该3D空间然后</c>
<c.magenta>可以与伴奏曲混合</c>

00:19:33.740 --> 00:19:35.375
<c.magenta>然后通过输出设备播放</c>

00:19:38.946 --> 00:19:39.847
<c.magenta>核心级别</c>

00:19:39.913 --> 00:19:42.182
<c.magenta>在进一步</c>
<c.magenta>介绍AVAudioEngine前</c>

00:19:42.249 --> 00:19:44.484
<c.magenta>我想再介绍下</c>
<c.magenta>Engine广泛使用的</c>

00:19:44.551 --> 00:19:46.353
<c.magenta>一些根本的核心级别</c>

00:19:47.387 --> 00:19:49.323
<c.magenta>我从AVAudioFormat开始</c>

00:19:50.958 --> 00:19:53.560
<c.magenta>AVAudioFormat</c>
<c.magenta>描述音频文件或音频流中的</c>

00:19:53.627 --> 00:19:55.429
<c.magenta>数据格式</c>

00:19:56.096 --> 00:19:59.199
<c.magenta>所以我们有标准格式</c>
<c.magenta>通用格式</c>

00:19:59.266 --> 00:20:00.868
<c.magenta>以及压缩格式</c>

00:19:59.266 --> 00:20:00.868
<c.magenta>以及压缩格式</c>

00:20:01.735 --> 00:20:04.404
<c.magenta>该级别也包含</c>
<c.magenta>AVAudioChannelLayout</c>

00:20:04.571 --> 00:20:07.341
<c.magenta>你在处理多声道音频时</c>
<c.magenta>可能会用到</c>

00:20:07.474 --> 00:20:11.144
<c.magenta>它是我们的现代界面 连接到</c>
<c.magenta>AudioStreamBasicDescription结构</c>

00:20:11.211 --> 00:20:13.013
<c.magenta>以及AudioChannelLayout结构</c>

00:20:15.349 --> 00:20:16.917
<c.magenta>现在 让我们看下</c>
<c.magenta>AVAudioBuffer</c>

00:20:16.984 --> 00:20:18.719
<c.magenta>AVAudioBuffer</c>
<c.magenta>核心级别</c>

00:20:18.852 --> 00:20:20.587
<c.magenta>该级别有两个子级别</c>

00:20:20.654 --> 00:20:24.291
<c.magenta>AVAudioPCMBuffer</c>
<c.magenta>可用于缓冲PCM数据</c>

00:20:24.625 --> 00:20:26.727
<c.magenta>包括AVAudioCompressBuffer</c>

00:20:26.793 --> 00:20:29.162
<c.magenta>可用来缓冲压缩音频数据</c>

00:20:30.163 --> 00:20:32.499
<c.magenta>这两个级别均提供</c>
<c.magenta>现代界面 连接到我们的</c>

00:20:32.566 --> 00:20:35.769
<c.magenta>AudioBufferList</c>
<c.magenta>以及AudioStreamPacketDescription</c>

00:20:38.005 --> 00:20:39.706
<c.magenta>让我们看一下AVAudioFile</c>

00:20:40.641 --> 00:20:43.710
<c.magenta>该级别允许你</c>
<c.magenta>从任何支持的格式进行读写</c>

00:20:44.678 --> 00:20:47.447
<c.magenta>允许你将数据读入</c>
<c.magenta>PCM缓存并从PCM缓存</c>

00:20:47.514 --> 00:20:49.716
<c.magenta>将数据写入文件</c>

00:20:49.850 --> 00:20:53.453
<c.magenta>这样 它可以透明化地</c>
<c.magenta>处理任何编码和解码</c>

00:20:55.322 --> 00:20:59.426
<c.magenta>它现在取代我们的AudioFile</c>
<c.magenta>和ExtAudioFile API</c>

00:21:00.260 --> 00:21:02.563
<c.magenta>最后 让我们看下</c>
<c.magenta>AVAudioConverter</c>

00:21:03.163 --> 00:21:05.566
<c.magenta>AVAUDIO转换器</c>
<c.magenta>核心级别</c>

00:21:05.632 --> 00:21:07.801
<c.magenta>该级别处理音频格式转换</c>

00:21:08.335 --> 00:21:12.606
<c.magenta>所以 你可以在两种</c>
<c.magenta>PCM数据格式间转换</c>

00:21:14.575 --> 00:21:17.978
<c.magenta>也可以在PCM以及</c>
<c.magenta>压缩音频格式间转换</c>

00:21:18.912 --> 00:21:21.281
<c.magenta>其中 转换器帮你</c>
<c.magenta>进行编码和解码</c>

00:21:23.317 --> 00:21:26.220
<c.magenta>这一级别取代我们的</c>
<c.magenta>AudioConverter API</c>

00:21:28.455 --> 00:21:29.990
<c.magenta>今年新内容中 我们也添加了</c>

00:21:30.057 --> 00:21:32.593
<c.magenta>最小相位</c>
<c.magenta>采样速率转换器算法</c>

00:21:35.095 --> 00:21:38.498
<c.magenta>所以 你可以看到</c>
<c.magenta>当与音频数据相连时</c>

00:21:38.565 --> 00:21:40.300
<c.magenta>所有核心级别能很好地协作</c>

00:21:42.536 --> 00:21:46.373
<c.magenta>让我们看下这些级别然后怎样与</c>
<c.magenta>AVAudioEngine交互</c>

00:21:48.809 --> 00:21:53.413
<c.magenta>若你观察AVAudioNode发现</c>
<c.magenta>它有输入和输出AVAudio格式</c>

00:21:55.382 --> 00:21:58.852
<c.magenta>如果你观察PlayerNode</c>
<c.magenta>它可以通过AVAudioFile</c>

00:21:58.919 --> 00:22:01.989
<c.magenta>或AVAudioPCMBuffer</c>
<c.magenta>使连接到Engine</c>

00:21:58.919 --> 00:22:01.989
<c.magenta>或AVAudioPCMBuffer</c>
<c.magenta>使连接到Engine</c>

00:22:05.092 --> 00:22:08.762
<c.magenta>如果你安装NodeTap</c>
<c.magenta>该部分以PCM缓存的形式</c>

00:22:08.829 --> 00:22:10.831
<c.magenta>向你提供音频数据</c>

00:22:11.064 --> 00:22:12.366
<c.magenta>你可以使用它进行分析</c>

00:22:12.432 --> 00:22:15.736
<c.magenta>或者你可以使用AVAudio文件</c>
<c.magenta>将它保存在文件中</c>

00:22:17.804 --> 00:22:19.339
<c.magenta>如果你处理的是</c>
<c.magenta>压缩流</c>

00:22:19.406 --> 00:22:21.275
<c.magenta>你可以将它分解为</c>
<c.magenta>压缩缓存</c>

00:22:21.341 --> 00:22:24.845
<c.magenta>用AVAudioConverter</c>
<c.magenta>将它转换为PCM缓存</c>

00:22:24.912 --> 00:22:27.447
<c.magenta>然后通过PlayerNode</c>
<c.magenta>将它提供给Engine</c>

00:22:32.486 --> 00:22:36.356
<c.magenta>今年新内容中我们为Watch带来了</c>
<c.magenta>AVAudioEngine子集</c>

00:22:37.090 --> 00:22:40.093
<c.magenta>与此同时 我们也添加了</c>
<c.magenta>AVAudioSession子集</c>

00:22:40.160 --> 00:22:42.262
<c.magenta>以及你刚刚看到的</c>
<c.magenta>所有核心级别</c>

00:22:43.864 --> 00:22:45.866
<c.magenta>我相信你一定想</c>
<c.magenta>看一下演示</c>

00:22:46.633 --> 00:22:47.835
<c.magenta>我们为你准备了演示</c>

00:22:48.769 --> 00:22:52.372
<c.magenta>我们直接使用SceneKit</c>
<c.magenta>和AVAudioEngine开发了简单的游戏</c>

00:22:53.407 --> 00:22:56.677
<c.magenta>在这个游戏中 我的举动是</c>
<c.magenta>将小行星发射到太空</c>

00:22:56.910 --> 00:22:58.912
<c.magenta>在屏幕底端</c>
<c.magenta>有一团火焰</c>

00:22:58.979 --> 00:23:02.082
<c.magenta>我可以使用Watch的</c>
<c.magenta>数码表冠控制火焰</c>

00:22:58.979 --> 00:23:02.082
<c.magenta>我可以使用Watch的</c>
<c.magenta>数码表冠控制火焰</c>

00:23:02.783 --> 00:23:04.618
<c.magenta>现在 如果行星</c>
<c.magenta>接触到火焰</c>

00:23:04.685 --> 00:23:06.587
<c.magenta>就会播放特别大的</c>
<c.magenta>爆炸声</c>

00:23:07.221 --> 00:23:08.388
<c.magenta>所以 让我们来看看</c>

00:23:09.056 --> 00:23:11.625
<c.magenta>演示WATCHOS上的</c>
<c.magenta>AVAUDIOENGINE</c>

00:23:27.875 --> 00:23:30.177
<c.magenta>我肯定这个游戏</c>
<c.magenta>违背了基本的物理定律</c>

00:23:30.244 --> 00:23:33.514
<c.magenta>因为它在太空中播放音频</c>
<c.magenta>对吧？这是不可能的</c>

00:23:36.817 --> 00:23:40.320
<c.magenta>好 那让我快速看一下游戏中的</c>
<c.magenta>AVAudioEngine代码</c>

00:23:42.322 --> 00:23:44.625
<c.magenta>在我的级别中</c>
<c.magenta>我有AVAudioEngine</c>

00:23:44.892 --> 00:23:46.360
<c.magenta>我有两个PlayerNode</c>

00:23:46.493 --> 00:23:48.195
<c.magenta>一个播放爆炸声</c>

00:23:48.328 --> 00:23:50.030
<c.magenta>一个播放发射声</c>

00:23:51.698 --> 00:23:54.368
<c.magenta>我也有连接到</c>
<c.magenta>我音频资源的URL</c>

00:23:56.637 --> 00:24:00.207
<c.magenta>在这个例子中 我使用</c>
<c.magenta>缓存向引擎提供数据</c>

00:23:56.637 --> 00:24:00.207
<c.magenta>在这个例子中 我使用</c>
<c.magenta>缓存向引擎提供数据</c>

00:24:03.744 --> 00:24:05.145
<c.magenta>让我们看下如何</c>
<c.magenta>设置引擎</c>

00:24:06.480 --> 00:24:09.383
<c.magenta>首先要做的是</c>
<c.magenta>附加我的PlayerNode</c>

00:24:09.449 --> 00:24:12.352
<c.magenta>所以 我触摸explosionPlayer</c>
<c.magenta>和launchPlayer</c>

00:24:13.854 --> 00:24:15.722
<c.magenta>接下来 我将使用核心级别</c>

00:24:15.789 --> 00:24:19.193
<c.magenta>我将从我资产的URL</c>
<c.magenta>创建一个AVAudio文件</c>

00:24:19.793 --> 00:24:21.695
<c.magenta>然后</c>
<c.magenta>我将创建一个PCM缓存</c>

00:24:21.762 --> 00:24:24.965
<c.magenta>我将把文件中的数据</c>
<c.magenta>读入PCM缓存</c>

00:24:25.532 --> 00:24:28.535
<c.magenta>之所以能这样做是</c>
<c.magenta>因为我的音频文件非常短</c>

00:24:31.205 --> 00:24:33.240
<c.magenta>接下来 我继续操作</c>
<c.magenta>连接源节点</c>

00:24:33.307 --> 00:24:36.243
<c.magenta>以及引擎的主要混音器</c>

00:24:39.479 --> 00:24:43.250
<c.magenta>所以 当游戏即将开始时</c>
<c.magenta>我接着开启引擎</c>

00:24:43.317 --> 00:24:44.751
<c.magenta>并开启播放器</c>

00:24:45.786 --> 00:24:49.790
<c.magenta>当发射小行星时</c>
<c.magenta>我只是安排launchBuffer</c>

00:24:49.857 --> 00:24:51.491
<c.magenta>在launchPlayer上播放</c>

00:24:52.693 --> 00:24:54.595
<c.magenta>当小行星接触到火焰时</c>

00:24:54.661 --> 00:24:58.465
<c.magenta>只需安排explosionBuffer</c>
<c.magenta>在explosionPlayer上播放</c>

00:24:59.633 --> 00:25:00.968
<c.magenta>这样 只需几行代码</c>

00:24:59.633 --> 00:25:00.968
<c.magenta>这样 只需几行代码</c>

00:25:01.034 --> 00:25:03.270
<c.magenta>我就能为</c>
<c.magenta>watchOS上的游戏</c>

00:25:03.337 --> 00:25:05.072
<c.magenta>创造非常丰富的音频体验</c>

00:25:06.106 --> 00:25:07.474
<c.magenta>这只是个简单的例子</c>

00:25:07.541 --> 00:25:09.710
<c.magenta>我们非常期待能看到</c>
<c.magenta>你制造的效果</c>

00:25:12.079 --> 00:25:13.247
<c.magenta>多声道音频</c>

00:25:13.313 --> 00:25:17.317
<c.magenta>结束AVAudioEngine介绍</c>
<c.magenta>之前 我要谈论下多声道音频</c>

00:25:18.218 --> 00:25:20.621
<c.magenta>具体的是 它如何与</c>
<c.magenta>tvOS关联的</c>

00:25:22.322 --> 00:25:24.725
<c.magenta>去年十月 我们发布了tvOS</c>

00:25:24.791 --> 00:25:26.860
<c.magenta>以及第四代Apple TV</c>

00:25:27.261 --> 00:25:30.497
<c.magenta>所以这是在全球开发者大会上</c>
<c.magenta>我们首次可以谈论该话题</c>

00:25:30.931 --> 00:25:33.834
<c.magenta>有关Apple TV上音频</c>
<c.magenta>有趣的一点是</c>

00:25:33.901 --> 00:25:37.271
<c.magenta>很多用户已经连接到</c>
<c.magenta>多声道硬件</c>

00:25:37.471 --> 00:25:39.840
<c.magenta>这是因为很多家庭影院系统</c>
<c.magenta>已经支持</c>

00:25:39.907 --> 00:25:42.910
<c.magenta>5.1或7.1环绕立体声系统</c>

00:25:43.243 --> 00:25:46.880
<c.magenta>今天 我只是想略微展示下</c>
<c.magenta>你怎样使用AVAudioEngine</c>

00:25:47.247 --> 00:25:48.615
<c.magenta>来呈现多声道音频</c>

00:25:50.651 --> 00:25:53.153
<c.magenta>首先 让我们回顾下</c>
<c.magenta>AVAudioSession的设置</c>

00:25:54.588 --> 00:25:57.558
<c.magenta>我首先设置我的类别</c>
<c.magenta>和其他选项</c>

00:25:57.624 --> 00:26:00.460
<c.magenta>然后激活会话</c>
<c.magenta>以便配置硬件</c>

00:25:57.624 --> 00:26:00.460
<c.magenta>然后激活会话</c>
<c.magenta>以便配置硬件</c>

00:26:00.527 --> 00:26:02.362
<c.magenta>满足我的应用需求</c>

00:26:03.964 --> 00:26:06.800
<c.magenta>现在 按照我想使用的</c>
<c.magenta>呈现格式</c>

00:26:06.900 --> 00:26:09.369
<c.magenta>我首先需要查看</c>
<c.magenta>当前路径是否支持该格式</c>

00:26:09.503 --> 00:26:12.739
<c.magenta>要查看这一点</c>
<c.magenta>我需要查看我想要的声道数</c>

00:26:12.806 --> 00:26:15.876
<c.magenta>是否小于或等于</c>
<c.magenta>最大输出声道数</c>

00:26:16.176 --> 00:26:19.847
<c.magenta>如果是 那么我可以继续</c>
<c.magenta>设置我想要的输出声道数</c>

00:26:22.049 --> 00:26:25.252
<c.magenta>接着 我可以从会话中</c>
<c.magenta>查询得到实际的声道数</c>

00:26:25.319 --> 00:26:26.987
<c.magenta>然后使用它继续操作</c>

00:26:29.189 --> 00:26:33.193
<c.magenta>或者 我可以查看当前端口上</c>
<c.magenta>的ChannelDescription阵列</c>

00:26:34.161 --> 00:26:37.064
<c.magenta>每个ChannelDescription</c>
<c.magenta>向我提供一个channelLabel</c>

00:26:37.464 --> 00:26:38.498
<c.magenta>和一个channelNumber</c>

00:26:39.366 --> 00:26:42.269
<c.magenta>所以 我可以使用该信息</c>
<c.magenta>了解确切的格式</c>

00:26:42.336 --> 00:26:45.539
<c.magenta>以及如何将内容映射到</c>
<c.magenta>连接的硬件上</c>

00:26:47.441 --> 00:26:49.776
<c.magenta>现在我们换回</c>
<c.magenta>AVAudioEngine设置话题</c>

00:26:51.178 --> 00:26:52.446
<c.magenta>这里有两个用例</c>

00:26:52.513 --> 00:26:56.149
<c.magenta>第一个用例是</c>
<c.magenta>如果你已经拥有多声道内容</c>

00:26:57.684 --> 00:26:59.953
<c.magenta>第二个用例是</c>
<c.magenta>如果你拥有单声道内容</c>

00:27:00.020 --> 00:27:01.188
<c.magenta>并且想对它空间化</c>

00:27:01.255 --> 00:27:03.223
<c.magenta>这通常是为游戏准备的</c>

00:27:04.992 --> 00:27:06.426
<c.magenta>所以 在第一个用例中</c>

00:27:07.895 --> 00:27:10.864
<c.magenta>我拥有多声道内容</c>
<c.magenta>以及多声道硬件</c>

00:27:11.532 --> 00:27:13.367
<c.magenta>我只需获得硬件格式</c>

00:27:13.433 --> 00:27:16.570
<c.magenta>我将它设置为我的混音器</c>
<c.magenta>和我的OutputNode间的连接</c>

00:27:16.970 --> 00:27:19.540
<c.magenta>在源端</c>
<c.magenta>我获得了内容格式</c>

00:27:19.606 --> 00:27:22.743
<c.magenta>并将它设置为我的</c>
<c.magenta>SourceNode和混音器间连接</c>

00:27:23.243 --> 00:27:26.113
<c.magenta>这里混音器为你</c>
<c.magenta>处理声道映射</c>

00:27:29.349 --> 00:27:32.119
<c.magenta>现在 在第二个用例中</c>
<c.magenta>我们有一堆单声道源</c>

00:27:32.452 --> 00:27:35.022
<c.magenta>我们将使用EnvironmentNode</c>
<c.magenta>对其空间化</c>

00:27:36.456 --> 00:27:38.659
<c.magenta>跟之前一样</c>
<c.magenta>我们获取硬件格式</c>

00:27:38.825 --> 00:27:42.162
<c.magenta>但在设置兼容格式前</c>
<c.magenta>我们必须将其映射到</c>

00:27:42.229 --> 00:27:44.231
<c.magenta>EnvironmentNode</c>
<c.magenta>支持的格式</c>

00:27:45.265 --> 00:27:48.802
<c.magenta>要了解支持的格式列表</c>
<c.magenta>你可以查询我们的网上文件</c>

00:27:49.436 --> 00:27:51.672
<c.magenta>所以 我设置好兼容格式</c>

00:27:51.905 --> 00:27:55.209
<c.magenta>现在 在源端</c>
<c.magenta>像之前一样 我获得内容格式</c>

00:27:55.309 --> 00:27:59.046
<c.magenta>并将其设置为我的播放器和</c>
<c.magenta>EnvironmentNode之间的连接</c>

00:28:00.113 --> 00:28:05.018
<c.magenta>最后 我也必须将</c>
<c.magenta>多声道呈现算法设置为</c>

00:28:05.085 --> 00:28:08.288
<c.magenta>SoundField 它目前受</c>
<c.magenta>EnvironmentNode支持</c>

00:28:09.756 --> 00:28:13.026
<c.magenta>此时 我可以启动引擎</c>
<c.magenta>开始播放</c>

00:28:13.360 --> 00:28:16.663
<c.magenta>然后调整我们支持的</c>
<c.magenta>所有各种3D混音属性</c>

00:28:19.967 --> 00:28:20.868
<c.magenta>好 简单回顾下</c>

00:28:21.268 --> 00:28:25.005
<c.magenta>AVAudioEngine是功能</c>
<c.magenta>丰富强大的API</c>

00:28:26.840 --> 00:28:28.976
<c.magenta>它简化了实时音频的</c>
<c.magenta>处理工作</c>

00:28:30.844 --> 00:28:34.114
<c.magenta>它使你能够处理</c>
<c.magenta>多声道音频和3D音频</c>

00:28:35.015 --> 00:28:36.250
<c.magenta>现在 你可以在Watch上</c>

00:28:36.316 --> 00:28:38.552
<c.magenta>开发具有丰富音频体验的游戏</c>

00:28:40.120 --> 00:28:44.157
<c.magenta>它取代了我们的</c>
<c.magenta>AUGraph和OpenAL API</c>

00:28:44.758 --> 00:28:47.127
<c.magenta>我们在之前演讲中</c>
<c.magenta>简要介绍了Engine</c>

00:28:47.194 --> 00:28:50.597
<c.magenta>我们鼓励你尽量</c>
<c.magenta>了解与此相关的内容</c>

00:28:51.365 --> 00:28:53.600
<c.magenta>现在 我要将舞台</c>
<c.magenta>交给我的同事Doug</c>

00:28:53.667 --> 00:28:54.768
<c.magenta>让他接着介绍</c>

00:28:55.035 --> 00:28:55.869
<c.magenta>Doug？</c>

00:29:01.175 --> 00:29:02.276
<c.magenta>谢谢 Saleem</c>

00:29:02.843 --> 00:29:07.181
<c.magenta>好 我想在此继续介绍</c>
<c.magenta>音频API</c>

00:29:07.681 --> 00:29:12.486
<c.magenta>我们介绍AVAudioEngine</c>
<c.magenta>时顺便说到了实时音频</c>

00:29:13.353 --> 00:29:14.922
<c.magenta>Saleem强调</c>

00:29:15.656 --> 00:29:19.259
<c.magenta>尽管音频处理</c>
<c.magenta>在实时环境中发生</c>

00:29:19.493 --> 00:29:22.262
<c.magenta>我们却是在非实时</c>
<c.magenta>环境中进行控制</c>

00:29:22.329 --> 00:29:24.331
<c.magenta>这就是操作简化的本质</c>

00:29:24.698 --> 00:29:26.733
<c.magenta>但有的时候</c>
<c.magenta>你实际想要</c>

00:29:26.800 --> 00:29:30.337
<c.magenta>在实时过程或环境下工作</c>

00:29:30.604 --> 00:29:32.272
<c.magenta>所以 我想进一步介绍下这点</c>

00:29:32.606 --> 00:29:34.608
<c.magenta>那么 什么是实时音频</c>

00:29:34.741 --> 00:29:37.511
<c.magenta>有的用例中</c>
<c.magenta>我们需要实时操作</c>

00:29:37.578 --> 00:29:40.080
<c.magenta>这种用例的特点是</c>
<c.magenta>低延迟</c>

00:29:42.216 --> 00:29:44.718
<c.magenta>可能我所熟悉的</c>
<c.magenta>我们平台上</c>

00:29:44.785 --> 00:29:47.321
<c.magenta>最早的应用例子是</c>
<c.magenta>音乐应用</c>

00:29:47.888 --> 00:29:51.525
<c.magenta>比如</c>
<c.magenta>当用户按下MIDI键盘上的</c>

00:29:51.592 --> 00:29:54.127
<c.magenta>一个键时</c>
<c.magenta>你可能正在合成声音</c>

00:29:54.795 --> 00:29:56.563
<c.magenta>我们想要尽量减少</c>

00:29:56.630 --> 00:30:00.067
<c.magenta>从按下MIDI音符到</c>
<c.magenta>播放音符的时间</c>

00:29:56.630 --> 00:30:00.067
<c.magenta>从按下MIDI音符到</c>
<c.magenta>播放音符的时间</c>

00:30:00.534 --> 00:30:04.338
<c.magenta>我们有像吉他踏板</c>
<c.magenta>一样的实时音频效果</c>

00:30:05.272 --> 00:30:09.009
<c.magenta>我们想要尽量减少</c>
<c.magenta>从吉他音频</c>

00:30:09.076 --> 00:30:11.144
<c.magenta>输入进电脑</c>

00:30:12.012 --> 00:30:15.782
<c.magenta>到我们在电脑中处理音频</c>
<c.magenta>应用延迟、变形</c>

00:30:15.849 --> 00:30:17.818
<c.magenta>然后将音频发回到扩音器</c>
<c.magenta>所花费的时间</c>

00:30:18.218 --> 00:30:21.989
<c.magenta>所以这种情况下我们需要</c>
<c.magenta>低延迟以实现乐器的快速响应</c>

00:30:22.623 --> 00:30:26.226
<c.magenta>电话也具有</c>
<c.magenta>要求低延迟的特征</c>

00:30:26.894 --> 00:30:29.963
<c.magenta>我们都曾经跟其他国家的</c>
<c.magenta>人打电话</c>

00:30:30.030 --> 00:30:31.932
<c.magenta>而且经历过高延迟的情况</c>

00:30:31.999 --> 00:30:33.800
<c.magenta>高延迟在电话中是不好的</c>

00:30:34.134 --> 00:30:36.003
<c.magenta>我们进行很多信号处理</c>

00:30:36.103 --> 00:30:37.704
<c.magenta>我们需要降低延迟</c>

00:30:38.438 --> 00:30:41.675
<c.magenta>同样 在游戏引擎中</c>
<c.magenta>我们也希望降低延迟</c>

00:30:42.209 --> 00:30:45.946
<c.magenta>用户在进行操作</c>
<c.magenta>与控制杆等交互</c>

00:30:46.480 --> 00:30:48.982
<c.magenta>我们想要尽快产生相应声音</c>

00:30:49.049 --> 00:30:51.318
<c.magenta>有时候我们想要</c>
<c.magenta>在声音呈现时</c>

00:30:51.385 --> 00:30:52.653
<c.magenta>控制这些声音</c>

00:30:53.053 --> 00:30:55.756
<c.magenta>或者 也许我们就</c>
<c.magenta>已经有了游戏引擎</c>

00:30:56.256 --> 00:31:00.093
<c.magenta>在所有这些案例中</c>
<c.magenta>我们都需要写出能够</c>

00:30:56.256 --> 00:31:00.093
<c.magenta>在所有这些案例中</c>
<c.magenta>我们都需要写出能够</c>

00:31:00.327 --> 00:31:01.562
<c.magenta>在实时环境中运行的代码</c>

00:31:02.596 --> 00:31:06.366
<c.magenta>在这种实时环境中</c>

00:31:07.768 --> 00:31:10.437
<c.magenta>我们受到约束的</c>

00:31:10.504 --> 00:31:13.173
<c.magenta>一个主要特征是</c>
<c.magenta>我们的操作是有时限的</c>

00:31:14.174 --> 00:31:16.410
<c.magenta>对吧？每隔几毫秒</c>

00:31:16.476 --> 00:31:20.080
<c.magenta>系统都会叫醒我们</c>
<c.magenta>要求我们发出</c>

00:31:20.147 --> 00:31:22.216
<c.magenta>持续同样短暂时间的声音</c>

00:31:22.716 --> 00:31:26.353
<c.magenta>也许 我们能够完成任务</c>
<c.magenta>产生无缝对接的音频</c>

00:31:26.854 --> 00:31:30.257
<c.magenta>也许 我们任务失败</c>
<c.magenta>花费过长时间产生音频</c>

00:31:30.824 --> 00:31:32.893
<c.magenta>因而输出内容产生缺陷</c>

00:31:32.960 --> 00:31:35.395
<c.magenta>用户听到的是故障的声音</c>

00:31:36.029 --> 00:31:40.234
<c.magenta>我们制造音频所能使用的</c>
<c.magenta>时间间隔很短</c>

00:31:40.300 --> 00:31:43.203
<c.magenta>我们的期限通常</c>
<c.magenta>短至3毫秒</c>

00:31:43.270 --> 00:31:46.707
<c.magenta>而iOS中默认的</c>
<c.magenta>20毫秒</c>

00:31:46.773 --> 00:31:50.544
<c.magenta>也仍然是非常紧张的期限</c>

00:31:51.545 --> 00:31:55.182
<c.magenta>所以 在这样的环境中</c>
<c.magenta>我们必须特别小心自己的操作</c>

00:31:56.083 --> 00:31:59.653
<c.magenta>我们不能停滞</c>
<c.magenta>我们不能分配内存</c>

00:31:59.753 --> 00:32:01.522
<c.magenta>我们不能使用互斥体</c>

00:31:59.753 --> 00:32:01.522
<c.magenta>我们不能使用互斥体</c>

00:32:01.588 --> 00:32:04.258
<c.magenta>我们不能访问文件系统</c>
<c.magenta>或者套接字</c>

00:32:04.658 --> 00:32:05.659
<c.magenta>我们不能记录</c>

00:32:05.993 --> 00:32:10.130
<c.magenta>我们甚至不能调用分派</c>
<c.magenta>“async”因为它会分配续延</c>

00:32:10.898 --> 00:32:14.067
<c.magenta>我们必须小心不要</c>
<c.magenta>与Objective-C</c>

00:32:14.134 --> 00:32:18.539
<c.magenta>Swift运行时交互 因为</c>
<c.magenta>它们二者并不完全实时安全</c>

00:32:18.605 --> 00:32:21.808
<c.magenta>有些情况下 它们也会</c>
<c.magenta>采取互斥体</c>

00:32:22.776 --> 00:32:25.846
<c.magenta>这是部分列表</c>
<c.magenta>还有其它操作我们不能做</c>

00:32:25.913 --> 00:32:27.814
<c.magenta>你要问自己</c>
<c.magenta>最重要的事情是</c>

00:32:28.148 --> 00:32:32.119
<c.magenta>我进行的操作</c>
<c.magenta>分配内存或使用互斥体吗？</c>

00:32:32.186 --> 00:32:35.289
<c.magenta>如果答案是“是”</c>
<c.magenta>那操作就不是实时安全的</c>

00:32:36.056 --> 00:32:37.424
<c.magenta>那么 我们能做什么呢</c>

00:32:37.491 --> 00:32:39.927
<c.magenta>过会儿 我会</c>
<c.magenta>向大家展示这方面的例子</c>

00:32:41.428 --> 00:32:47.167
<c.magenta>不过 首先 我想只是</c>
<c.magenta>讨论下如何管理</c>

00:32:47.234 --> 00:32:50.337
<c.magenta>打包实时音频组件的问题</c>

00:32:50.704 --> 00:32:53.774
<c.magenta>我们通过叫做Audio Unit的</c>
<c.magenta>API集实现打包</c>

00:32:54.474 --> 00:32:58.545
<c.magenta>所以 这是我们打包的方式</c>

00:32:58.612 --> 00:33:00.948
<c.magenta>而对于你 关于此问题</c>
<c.magenta>作为其他开发者</c>

00:32:58.612 --> 00:33:00.948
<c.magenta>而对于你 关于此问题</c>
<c.magenta>作为其他开发者</c>

00:33:01.014 --> 00:33:03.383
<c.magenta>你可以通过它打包你</c>
<c.magenta>在其它应用中会再次使用的</c>

00:33:03.450 --> 00:33:06.386
<c.magenta>信号处理和模块</c>

00:33:06.753 --> 00:33:11.358
<c.magenta>而且它也提供一个API</c>
<c.magenta>可以管理</c>

00:33:11.425 --> 00:33:15.629
<c.magenta>你非实时环境</c>
<c.magenta>和实时呈现环境之间的</c>

00:33:15.696 --> 00:33:17.631
<c.magenta>转变和交互</c>

00:33:19.333 --> 00:33:22.269
<c.magenta>所以 作为应用开发者</c>
<c.magenta>你可以托管Audio Unit</c>

00:33:23.270 --> 00:33:25.706
<c.magenta>这意味着你可以允许</c>
<c.magenta>用户选择一个单元</c>

00:33:25.772 --> 00:33:30.043
<c.magenta>或者你可以简单的使用指向</c>
<c.magenta>系统内置单元的硬编码引用</c>

00:33:31.044 --> 00:33:33.514
<c.magenta>你也可以构建</c>
<c.magenta>自己的Audio Unit</c>

00:33:34.147 --> 00:33:37.017
<c.magenta>可以将它们构建为</c>
<c.magenta>应用扩展或插件</c>

00:33:37.651 --> 00:33:41.755
<c.magenta>你也可以简单地</c>
<c.magenta>私下对你的应用</c>

00:33:41.822 --> 00:33:42.856
<c.magenta>注册一个Audio Unit</c>

00:33:42.923 --> 00:33:46.593
<c.magenta>这样很有用 比如</c>
<c.magenta>如果你有一些小块的</c>

00:33:46.660 --> 00:33:48.495
<c.magenta>信号处理想要在</c>

00:33:48.562 --> 00:33:51.064
<c.magenta>AVAudioEngine</c>
<c.magenta>环境中使用</c>

00:33:54.301 --> 00:33:56.136
<c.magenta>所以 在Audio Unit下</c>

00:33:56.203 --> 00:33:59.039
<c.magenta>我们有更根本的API</c>

00:33:59.273 --> 00:34:00.874
<c.magenta>叫做音频组件</c>

00:33:59.273 --> 00:34:00.874
<c.magenta>叫做音频组件</c>

00:34:02.075 --> 00:34:06.380
<c.magenta>这是AudioToolbox</c>
<c.magenta>框架内的一组API</c>

00:34:07.114 --> 00:34:11.585
<c.magenta>框架维护了系统上</c>
<c.magenta>所有组件的记录</c>

00:34:11.652 --> 00:34:13.053
<c.magenta>AUDIO UNITS：组件</c>

00:34:13.120 --> 00:34:16.822
<c.magenta>每个组件都有一种类型</c>
<c.magenta>子类型以及制造商</c>

00:34:16.889 --> 00:34:18.292
<c.magenta>这些是包含4个字符的代码</c>

00:34:18.725 --> 00:34:22.295
<c.magenta>它们作为发现并注册</c>
<c.magenta>组件的键</c>

00:34:24.063 --> 00:34:27.568
<c.magenta>有很多种不同的</c>
<c.magenta>音频组件类型</c>

00:34:28.168 --> 00:34:33.739
<c.magenta>两种主要的类型是Audio</c>
<c.magenta>Units和Audio Codecs</c>

00:34:34.373 --> 00:34:37.077
<c.magenta>但在Audio Unit中</c>
<c.magenta>我们又有输入/输出单元</c>

00:34:37.143 --> 00:34:38.846
<c.magenta>生成器、效果、乐器</c>

00:34:39.279 --> 00:34:41.949
<c.magenta>转换器以及混音器</c>

00:34:42.315 --> 00:34:45.319
<c.magenta>在codecs编码解码器中</c>
<c.magenta>我们又有编码器和解码器</c>

00:34:45.585 --> 00:34:48.255
<c.magenta>在macOS上</c>
<c.magenta>我们还有音频文件组件</c>

00:34:51.725 --> 00:34:55.161
<c.magenta>关于组件的实施</c>

00:34:56.029 --> 00:34:59.299
<c.magenta>组件的实施</c>
<c.magenta>有很多不同的方法</c>

00:34:59.366 --> 00:35:02.069
<c.magenta>有一些是如果你用它</c>
<c.magenta>写代码时需要了解的</c>

00:34:59.366 --> 00:35:02.069
<c.magenta>有一些是如果你用它</c>
<c.magenta>写代码时需要了解的</c>

00:35:02.135 --> 00:35:03.837
<c.magenta>而另外一些 不过是背景知识</c>

00:35:04.738 --> 00:35:08.942
<c.magenta>现在创建组件</c>
<c.magenta>最好的方法</c>

00:35:09.009 --> 00:35:12.646
<c.magenta>若是Audio Unit 最好是</c>
<c.magenta>创建Audio Unit应用扩展</c>

00:35:13.280 --> 00:35:19.152
<c.magenta>通过10.11和9.0版本</c>
<c.magenta>我们去年对此进行了介绍</c>

00:35:20.153 --> 00:35:21.488
<c.magenta>所以 那些是应用扩展</c>

00:35:21.555 --> 00:35:25.526
<c.magenta>而那之前 Audio Units是</c>
<c.magenta>打包在组件捆绑包里的</c>

00:35:25.592 --> 00:35:27.294
<c.magenta>audio codecs等也是如此</c>

00:35:28.862 --> 00:35:31.064
<c.magenta>那大概要回溯到</c>
<c.magenta>Mac OS 10.1了</c>

00:35:33.367 --> 00:35:38.939
<c.magenta>有趣的是 音频组件也包括</c>
<c.magenta>iOS上应用间的音频节点</c>

00:35:39.373 --> 00:35:41.775
<c.magenta>节点应用使用</c>

00:35:42.109 --> 00:35:45.779
<c.magenta>组件子类型和制造商密钥</c>
<c.magenta>进行注册</c>

00:35:46.446 --> 00:35:49.683
<c.magenta>主应用程序通过Audio</c>
<c.magenta>Component Manager</c>

00:35:50.250 --> 00:35:51.952
<c.magenta>发现</c>
<c.magenta>节点应用程序</c>

00:35:53.720 --> 00:35:56.390
<c.magenta>最终 你能够注册</c>
<c.magenta>——像我之前提到的——</c>

00:35:56.456 --> 00:35:59.860
<c.magenta>你能够注册自己的组件</c>
<c.magenta>以便用于你自己的应用程序</c>

00:36:00.527 --> 00:36:03.897
<c.magenta>只是补充下</c>
<c.magenta>有一些Apple内置组件</c>

00:36:04.331 --> 00:36:07.000
<c.magenta>在iOS上 它们连接到</c>
<c.magenta>AudioToolbox</c>

00:36:09.002 --> 00:36:12.639
<c.magenta>所以 以上就是</c>
<c.magenta>组件实施的情况</c>

00:36:12.840 --> 00:36:16.510
<c.magenta>现在 这里 我要将焦点</c>
<c.magenta>仅仅集中到一种组件——</c>

00:36:16.743 --> 00:36:18.545
<c.magenta>音频输入/输出单元</c>

00:36:18.712 --> 00:36:19.913
<c.magenta>这是Audio Unit</c>

00:36:19.980 --> 00:36:21.849
<c.magenta>音频输入/输出单元</c>
<c.magenta>最常用</c>

00:36:21.915 --> 00:36:25.752
<c.magenta>如果你只使用一种组件</c>
<c.magenta>这很可能就是</c>

00:36:25.819 --> 00:36:27.254
<c.magenta>你会使用的组件</c>

00:36:28.121 --> 00:36:31.425
<c.magenta>其中的原因是</c>
<c.magenta>这是连接到系统基本</c>

00:36:31.491 --> 00:36:34.528
<c.magenta>音频输入/输出路径的</c>
<c.magenta>首选界面</c>

00:36:35.329 --> 00:36:39.867
<c.magenta>现在 在macOS上 该基本</c>
<c.magenta>路径位于Core Audio框架</c>

00:36:40.300 --> 00:36:41.602
<c.magenta>我们称之为Audio HAL</c>

00:36:42.402 --> 00:36:44.204
<c.magenta>这是非常低级别的界面</c>

00:36:44.638 --> 00:36:48.942
<c.magenta>比如 它能使客户处理</c>
<c.magenta>在多声道设备上</c>

00:36:49.009 --> 00:36:51.011
<c.magenta>有趣的流媒体类型</c>

00:36:52.045 --> 00:36:56.283
<c.magenta>所以通过音频</c>
<c.magenta>输入/输出单元</c>

00:36:56.650 --> 00:36:58.585
<c.magenta>能够非常轻松地</c>
<c.magenta>处理Audio HAL界面</c>

00:37:00.087 --> 00:37:04.491
<c.magenta>在iOS上 你甚至不需要</c>
<c.magenta>Core Audio框架的访问权限</c>

00:37:04.558 --> 00:37:05.792
<c.magenta>在那里 它不是公共的</c>

00:37:05.959 --> 00:37:08.262
<c.magenta>你必须使用</c>
<c.magenta>音频输入/输出单元</c>

00:37:08.695 --> 00:37:13.267
<c.magenta>作为你将音频输入</c>
<c.magenta>和输出系统的低级别方式</c>

00:37:15.369 --> 00:37:17.538
<c.magenta>我们现在音频输入/输出</c>

00:37:18.405 --> 00:37:21.608
<c.magenta>单元的首选界面是</c>
<c.magenta>AUAudioUnit</c>

00:37:21.675 --> 00:37:23.443
<c.magenta>及AudioToolbox框架</c>

00:37:24.178 --> 00:37:26.980
<c.magenta>如果你使用</c>
<c.magenta>我们的API已经有一段时间</c>

00:37:27.347 --> 00:37:31.218
<c.magenta>你熟悉第2版Audio Units</c>
<c.magenta>它是macOS上AUHAL系统</c>

00:37:31.285 --> 00:37:36.423
<c.magenta>以及iOS和Watch上</c>
<c.magenta>AURemoteIO系统的</c>

00:37:36.490 --> 00:37:38.492
<c.magenta>一部分——</c>

00:37:39.059 --> 00:37:41.328
<c.magenta>实际上 我不确定</c>
<c.magenta>Watch上有没有</c>

00:37:41.395 --> 00:37:46.333
<c.magenta>不过不论如何</c>
<c.magenta>AUAudioUnit是你连接到</c>

00:37:46.567 --> 00:37:48.936
<c.magenta>低级别I/O机制的全新现代界面</c>

00:37:50.604 --> 00:37:53.473
<c.magenta>所以 我要向你展示使用</c>

00:37:53.540 --> 00:37:58.912
<c.magenta>AUAudioUnit</c>
<c.magenta>进行AudioIO操作的情况</c>

00:37:59.379 --> 00:38:02.049
<c.magenta>所以 这里</c>
<c.magenta>我用Swift写好了</c>

00:37:59.379 --> 00:38:02.049
<c.magenta>所以 这里</c>
<c.magenta>我用Swift写好了</c>

00:38:02.850 --> 00:38:04.551
<c.magenta>产生方波的简单程序</c>

00:38:06.220 --> 00:38:08.622
<c.magenta>这是我的信号处理</c>

00:38:08.689 --> 00:38:12.226
<c.magenta>像之前提到的 我要</c>
<c.magenta>展示你在这儿可以做什么</c>

00:38:12.893 --> 00:38:16.363
<c.magenta>所以 这个波形信号发生器</c>
<c.magenta>向你展示</c>

00:38:16.697 --> 00:38:21.168
<c.magenta>你基本上可以读取内存</c>
<c.magenta>写入内容并进行数学运算</c>

00:38:21.902 --> 00:38:24.238
<c.magenta>这是这里进行的</c>
<c.magenta>所有操作</c>

00:38:24.304 --> 00:38:27.975
<c.magenta>即产生最简单的</c>
<c.magenta>波形 ——方波——</c>

00:38:28.208 --> 00:38:30.911
<c.magenta>至少从计算机的</c>
<c.magenta>角度来说最简单</c>

00:38:31.879 --> 00:38:34.414
<c.magenta>所以 这种级别叫做</c>
<c.magenta>SquareWaveGenerator</c>

00:38:35.549 --> 00:38:39.853
<c.magenta>让我们看看如何使用AUAudioUnit</c>
<c.magenta>播放SqaureWaveGenerator</c>

00:38:41.755 --> 00:38:45.125
<c.magenta>首先 我们创建</c>
<c.magenta>一条音频组件描述</c>

00:38:46.093 --> 00:38:49.363
<c.magenta>这条描述告诉我们寻找</c>
<c.magenta>哪个组件</c>

00:38:50.130 --> 00:38:51.331
<c.magenta>类型是输出</c>

00:38:51.465 --> 00:38:55.135
<c.magenta>子类型是我根据</c>
<c.magenta>平台在这里做出的选择——</c>

00:38:55.602 --> 00:38:57.471
<c.magenta>RemoteIO或</c>
<c.magenta>HalOutput</c>

00:38:58.172 --> 00:39:01.842
<c.magenta>这里有Apple制造商</c>
<c.magenta>以及一些未使用的标记</c>

00:38:58.172 --> 00:39:01.842
<c.magenta>这里有Apple制造商</c>
<c.magenta>以及一些未使用的标记</c>

00:39:02.910 --> 00:39:06.947
<c.magenta>然后我可以使用组件描述</c>
<c.magenta>创建AUAudioUnit</c>

00:39:08.081 --> 00:39:09.816
<c.magenta>这样我就能得到想要的单元</c>

00:39:11.418 --> 00:39:15.722
<c.magenta>现在 打开了</c>
<c.magenta>我可以开始配置</c>

00:39:16.557 --> 00:39:19.626
<c.magenta>这里我要做的</c>
<c.magenta>第一件事是搞清楚</c>

00:39:19.693 --> 00:39:23.197
<c.magenta>系统上有多少音频声道</c>

00:39:23.263 --> 00:39:27.801
<c.magenta>这可以使用多种方法通过iOS上的</c>
<c.magenta>AVAudioSession实现</c>

00:39:28.368 --> 00:39:32.372
<c.magenta>不过 最简单和便捷的是</c>

00:39:32.439 --> 00:39:36.376
<c.magenta>你可以简单地查询</c>

00:39:36.810 --> 00:39:39.346
<c.magenta>输入/输出单元的</c>
<c.magenta>outputBusses</c>

00:39:39.746 --> 00:39:45.052
<c.magenta>而outputBus[0]是</c>
<c.magenta>输出指向的流</c>

00:39:45.652 --> 00:39:48.488
<c.magenta>所以我将获取它的格式</c>
<c.magenta>那是我的硬件格式</c>

00:39:48.956 --> 00:39:52.693
<c.magenta>那么 这个硬件格式</c>
<c.magenta>可能是比较奇异的东西</c>

00:39:52.759 --> 00:39:55.329
<c.magenta>比如 它可能显示惰性</c>

00:39:56.830 --> 00:39:59.633
<c.magenta>我不知道</c>
<c.magenta>是不是要处理它</c>

00:39:59.700 --> 00:40:01.802
<c.magenta>所以我只是创建</c>
<c.magenta>一个renderFormat</c>

00:39:59.700 --> 00:40:01.802
<c.magenta>所以我只是创建</c>
<c.magenta>一个renderFormat</c>

00:40:01.869 --> 00:40:04.905
<c.magenta>这是具有相同采样率的</c>
<c.magenta>标准格式</c>

00:40:05.405 --> 00:40:07.074
<c.magenta>以及一些声道</c>

00:40:08.242 --> 00:40:13.347
<c.magenta>为快速简单起见</c>
<c.magenta>我只呈现两个波段</c>

00:40:13.413 --> 00:40:15.482
<c.magenta>而不论</c>
<c.magenta>硬件声道数是多少</c>

00:40:16.316 --> 00:40:18.118
<c.magenta>好 那就是我的</c>
<c.magenta>renderFormat</c>

00:40:18.352 --> 00:40:20.954
<c.magenta>现在 我可以告诉I/O单元</c>

00:40:21.321 --> 00:40:25.058
<c.magenta>这是我想要在</c>
<c.magenta>inputBus[0]上给你的格式</c>

00:40:25.559 --> 00:40:29.997
<c.magenta>完成该操作后 该单元</c>
<c.magenta>现会把我的renderFormat</c>

00:40:30.163 --> 00:40:31.365
<c.magenta>转换成hardwareFormat</c>

00:40:31.965 --> 00:40:33.967
<c.magenta>在该例中 在我的MacBook上</c>

00:40:34.034 --> 00:40:37.971
<c.magenta>该单元会获取</c>
<c.magenta>该去交错的浮点</c>

00:40:38.372 --> 00:40:41.775
<c.magenta>并将其转换成</c>
<c.magenta>交错浮点缓冲器</c>

00:40:43.577 --> 00:40:47.481
<c.magenta>好 接下来 我将</c>
<c.magenta>构建我的方波生成器</c>

00:40:48.248 --> 00:40:51.051
<c.magenta>如果你是像我一样的</c>
<c.magenta>音乐和数学迷</c>

00:40:51.585 --> 00:40:54.788
<c.magenta>你知道代码中有A440</c>
<c.magenta>该数值乘以</c>

00:40:54.855 --> 00:40:58.225
<c.magenta>1.5后增长20%</c>

00:40:59.693 --> 00:41:02.062
<c.magenta>所以 我将在</c>
<c.magenta>左声道呈现A</c>

00:40:59.693 --> 00:41:02.062
<c.magenta>所以 我将在</c>
<c.magenta>左声道呈现A</c>

00:41:02.129 --> 00:41:04.231
<c.magenta>右声道呈现E</c>

00:41:05.365 --> 00:41:08.836
<c.magenta>这里是</c>
<c.magenta>会在实时环境中运行的代码</c>

00:41:12.039 --> 00:41:13.774
<c.magenta>其中有很多参数</c>

00:41:13.941 --> 00:41:16.143
<c.magenta>而实际上我只需要</c>
<c.magenta>其中的几个</c>

00:41:16.210 --> 00:41:20.113
<c.magenta>我只需要frameCount</c>
<c.magenta>和rawBufferList</c>

00:41:20.914 --> 00:41:25.452
<c.magenta>rawBufferList是一种</c>
<c.magenta>高难度的低级别C结构</c>

00:41:25.886 --> 00:41:32.893
<c.magenta>我可以使用SDK上的覆盖</c>
<c.magenta>在Swift语言中对其重包装</c>

00:41:32.993 --> 00:41:35.329
<c.magenta>这样拿走了</c>
<c.magenta>音频bufferList</c>

00:41:35.896 --> 00:41:39.333
<c.magenta>让它看起来像是</c>
<c.magenta>矢量或数组/阵列</c>

00:41:40.767 --> 00:41:42.603
<c.magenta>将rawBufferList转换成</c>

00:41:42.669 --> 00:41:46.039
<c.magenta>不错的Swift包装后</c>
<c.magenta>我可以查询它的数量</c>

00:41:46.540 --> 00:41:50.344
<c.magenta>如果我得到至少一个缓冲器</c>
<c.magenta>那么 我就能呈现左声道</c>

00:41:50.844 --> 00:41:53.614
<c.magenta>如果我得到至少两个缓冲器</c>
<c.magenta>我就能够呈现右声道</c>

00:41:54.248 --> 00:41:56.850
<c.magenta>这就是我现在</c>
<c.magenta>要做的所有工作</c>

00:41:56.917 --> 00:41:59.453
<c.magenta>当然 波形信号发生器内</c>
<c.magenta>还有更多的工作要做</c>

00:41:59.520 --> 00:42:01.522
<c.magenta>不过上述就是</c>
<c.magenta>实时环境下的所有工作</c>

00:41:59.520 --> 00:42:01.522
<c.magenta>不过上述就是</c>
<c.magenta>实时环境下的所有工作</c>

00:42:02.656 --> 00:42:05.626
<c.magenta>所以 现在 我都设置好了</c>
<c.magenta>准备好呈现了</c>

00:42:06.026 --> 00:42:07.861
<c.magenta>我会告诉I/O单元</c>

00:42:08.629 --> 00:42:11.565
<c.magenta>进行所有必要的分配</c>
<c.magenta>以便开始呈现</c>

00:42:12.099 --> 00:42:14.201
<c.magenta>然后I/O单元</c>
<c.magenta>实际会让硬件</c>

00:42:14.735 --> 00:42:16.603
<c.magenta>运行3秒 然后停止</c>

00:42:16.670 --> 00:42:18.539
<c.magenta>这个简单的程序到此结束</c>

00:42:23.243 --> 00:42:24.912
<c.magenta>这就是AUAudioUnit</c>

00:42:26.180 --> 00:42:30.450
<c.magenta>接下来 我要简单讲一下</c>
<c.magenta>其它一些Audio Unit</c>

00:42:30.984 --> 00:42:35.022
<c.magenta>我们有效果 可以获取</c>
<c.magenta>音频输入 产生音频输出</c>

00:42:35.455 --> 00:42:38.659
<c.magenta>有乐器 可以获取</c>
<c.magenta>类似MIDI的东西作为输入</c>

00:42:39.059 --> 00:42:40.727
<c.magenta>同时也能产生音频输出</c>

00:42:41.195 --> 00:42:44.531
<c.magenta>有生成器 能够产生</c>
<c.magenta>音频输出</c>

00:42:44.665 --> 00:42:48.602
<c.magenta>而不输入任何东西</c>
<c.magenta>除了一些可能的参数控制</c>

00:42:48.902 --> 00:42:52.906
<c.magenta>如果我要将我的方波生成器</c>
<c.magenta>重新打包为Audio Unit</c>

00:42:53.006 --> 00:42:54.508
<c.magenta>我会做成生成器</c>

00:42:57.644 --> 00:43:00.314
<c.magenta>要托管这些</c>
<c.magenta>种类的Audio Unit</c>

00:42:57.644 --> 00:43:00.314
<c.magenta>要托管这些</c>
<c.magenta>种类的Audio Unit</c>

00:43:00.380 --> 00:43:02.482
<c.magenta>你也可以使用AUAudioUnit</c>

00:43:03.584 --> 00:43:07.354
<c.magenta>你可以使用单独的部分</c>
<c.magenta>向它提供输入</c>

00:43:07.588 --> 00:43:10.157
<c.magenta>这跟你在I/O单元上</c>
<c.magenta>看到的</c>

00:43:10.224 --> 00:43:12.826
<c.magenta>输出供应块非常相似</c>

00:43:13.660 --> 00:43:16.163
<c.magenta>你可以将这些单元</c>
<c.magenta>呈现部分连接起来</c>

00:43:16.230 --> 00:43:18.265
<c.magenta>创建你自己的</c>
<c.magenta>定制化类型</c>

00:43:18.966 --> 00:43:21.902
<c.magenta>你可以使用参数</c>
<c.magenta>控制这些单元</c>

00:43:23.203 --> 00:43:26.306
<c.magenta>而且 很多单元</c>
<c.magenta>尤其是第三方单元</c>

00:43:26.874 --> 00:43:28.542
<c.magenta>都有很好的用户界面</c>

00:43:28.609 --> 00:43:31.011
<c.magenta>作为主应用程序</c>
<c.magenta>你可以获取</c>

00:43:31.078 --> 00:43:34.815
<c.magenta>audio unit视图</c>
<c.magenta>在你的应用程序中显示</c>

00:43:34.882 --> 00:43:36.450
<c.magenta>并让用户与其交互</c>

00:43:39.786 --> 00:43:41.889
<c.magenta>若你想</c>
<c.magenta>编写自己的Audio Unit</c>

00:43:43.991 --> 00:43:46.627
<c.magenta>我首先的做法很简单</c>
<c.magenta>就是在应用的环境中</c>

00:43:46.693 --> 00:43:48.428
<c.magenta>构建Audio Unit</c>

00:43:48.695 --> 00:43:53.467
<c.magenta>这样你可以进行调试</c>
<c.magenta>而无需担心流程间的通信问题</c>

00:43:53.534 --> 00:43:54.668
<c.magenta>全部在一个过程中完成</c>

00:43:55.068 --> 00:43:57.504
<c.magenta>你首先</c>
<c.magenta>将AUAudioUnit划入子级别</c>

00:43:58.071 --> 00:44:02.276
<c.magenta>使用AUAudioUnit的</c>
<c.magenta>这一级别方法将其注册为组件</c>

00:43:58.071 --> 00:44:02.276
<c.magenta>使用AUAudioUnit的</c>
<c.magenta>这一级别方法将其注册为组件</c>

00:44:02.976 --> 00:44:04.244
<c.magenta>然后你可以对其进行调试</c>

00:44:05.279 --> 00:44:06.780
<c.magenta>一旦完成——</c>

00:44:06.914 --> 00:44:09.116
<c.magenta>如果你确定了</c>
<c.magenta>要将其作为</c>

00:44:09.683 --> 00:44:11.285
<c.magenta>Audio Unit扩展分布</c>

00:44:11.652 --> 00:44:14.755
<c.magenta>你就可以采取同样的</c>
<c.magenta>AUAudioUnit子级别</c>

00:44:15.422 --> 00:44:17.591
<c.magenta>你可以对其微调</c>
<c.magenta>和进一步修饰</c>

00:44:18.325 --> 00:44:21.028
<c.magenta>不过然后你将需要</c>
<c.magenta>多花一点功夫</c>

00:44:21.361 --> 00:44:23.764
<c.magenta>将其打包为</c>
<c.magenta>Audio Unit扩展</c>

00:44:24.398 --> 00:44:27.434
<c.magenta>所以 你就获得一个扩展程序</c>
<c.magenta>你可以把它嵌入某个应用程序</c>

00:44:27.501 --> 00:44:29.803
<c.magenta>也可以在App Store</c>
<c.magenta>出售该应用程序</c>

00:44:33.707 --> 00:44:35.776
<c.magenta>好 我想邀请</c>
<c.magenta>我的同事Torrey</c>

00:44:35.843 --> 00:44:39.346
<c.magenta>向你展示下Audio Unit扩展</c>
<c.magenta>的一些威力</c>

00:44:39.680 --> 00:44:41.682
<c.magenta>过去一年</c>
<c.magenta>我们一些开发者使用它</c>

00:44:41.748 --> 00:44:42.883
<c.magenta>做了不少很酷的事情</c>

00:44:43.684 --> 00:44:44.751
<c.magenta>大家可好？ </c>

00:44:45.552 --> 00:44:46.753
<c.magenta>参加WWDC可开心？</c>

00:44:48.188 --> 00:44:49.056
<c.magenta>好</c>

00:44:50.724 --> 00:44:51.959
<c.magenta>让我们制造些声响吧</c>

00:44:52.693 --> 00:44:54.695
<c.magenta>我会从这儿开始 启动——</c>

00:44:54.761 --> 00:44:56.630
<c.magenta>首先</c>
<c.magenta>我的乐器在这儿</c>

00:44:56.697 --> 00:45:00.567
<c.magenta>这是我的iPad Pro</c>
<c.magenta>我首先启动Arturia iSEM</c>

00:44:56.697 --> 00:45:00.567
<c.magenta>这是我的iPad Pro</c>
<c.magenta>我首先启动Arturia iSEM</c>

00:45:01.268 --> 00:45:03.170
<c.magenta>这是非常强大的合成器应用</c>

00:45:03.237 --> 00:45:06.006
<c.magenta>这里是我喜欢的</c>
<c.magenta>合成喇叭声音</c>

00:45:11.845 --> 00:45:15.349
<c.magenta>我很喜欢这个声音 我想把它</c>
<c.magenta>放到我正在编辑的曲目中</c>

00:45:15.449 --> 00:45:19.019
<c.magenta>这个将作为我们的Audio</c>
<c.magenta>Unit插件应用</c>

00:45:19.520 --> 00:45:21.688
<c.magenta>现在 我要启动GarageBand</c>

00:45:21.755 --> 00:45:24.591
<c.magenta>它将作为我们的Audio Unit</c>
<c.magenta>主应用程序</c>

00:45:25.192 --> 00:45:28.595
<c.magenta>现在GarageBand中</c>
<c.magenta>有个我正编辑的sick beat</c>

00:45:28.662 --> 00:45:31.565
<c.magenta>我将它命名为WWDC Demo</c>

00:45:32.366 --> 00:45:33.333
<c.magenta>让我们听一下</c>

00:45:43.577 --> 00:45:46.780
<c.magenta>好 接下来我们看一下</c>
<c.magenta>辞句部分</c>

00:45:55.088 --> 00:45:57.925
<c.magenta>接着 我们将处理</c>
<c.magenta>和声部分</c>

00:45:57.991 --> 00:45:59.960
<c.magenta>这应该是歌曲的</c>
<c.magenta>高潮部分</c>

00:46:00.027 --> 00:46:02.262
<c.magenta>我希望多一点动感</c>
<c.magenta>多一点张力</c>

00:46:02.696 --> 00:46:05.265
<c.magenta>让我们通过Audio Unit</c>
<c.magenta>制造这种效果</c>

00:46:06.800 --> 00:46:08.235
<c.magenta>我将在这里添加一个新曲目</c>

00:46:09.069 --> 00:46:12.105
<c.magenta>添加新乐器 我会看到</c>
<c.magenta>这里有Audio Unit选项</c>

00:46:12.973 --> 00:46:15.309
<c.magenta>如果我选择它 接下来我会</c>
<c.magenta>在这里看到系统上</c>

00:46:15.375 --> 00:46:16.910
<c.magenta>寄存</c>
<c.magenta>所有的Audio Unit</c>

00:46:17.244 --> 00:46:21.648
<c.magenta>我看到的是Arturia iSEM</c>
<c.magenta>因为我在家里练习这个</c>

00:46:22.983 --> 00:46:25.185
<c.magenta>选择iSEM</c>
<c.magenta>GarageBand现在将</c>

00:46:25.252 --> 00:46:28.555
<c.magenta>在这里显示屏幕上的</c>
<c.magenta>MIDI控制器以供我使用</c>

00:46:28.922 --> 00:46:32.693
<c.magenta>它有完整的尺度变化</c>
<c.magenta>以及琶音器 就在这里</c>

00:46:32.759 --> 00:46:35.462
<c.magenta>我会充分利用这些工具</c>
<c.magenta>因为我很喜欢动感的音乐</c>

00:46:35.863 --> 00:46:39.366
<c.magenta>在这里的左边</c>
<c.magenta>你可以看到音调/修正滚轮</c>

00:46:39.433 --> 00:46:41.001
<c.magenta>你甚至可以修改速度</c>

00:46:41.335 --> 00:46:44.104
<c.magenta>Audio Unit在这里</c>
<c.magenta>向我提供的视图</c>

00:46:44.171 --> 00:46:45.339
<c.magenta>其实我可做小的调整</c>

00:46:45.839 --> 00:46:48.442
<c.magenta>而现在 我要在这里</c>
<c.magenta>录制一小段音频</c>

00:46:48.509 --> 00:46:50.544
<c.magenta>然后看一下它</c>
<c.magenta>在整个曲子中的效果</c>

00:46:50.611 --> 00:46:51.478
<c.magenta>那么——</c>

00:47:04.825 --> 00:47:06.093
<c.magenta>好了 不错</c>

00:47:08.262 --> 00:47:10.063
<c.magenta>让我们听一下它</c>
<c.magenta>在整个曲子中的效果</c>

00:47:14.201 --> 00:47:16.270
<c.magenta>好了</c>
<c.magenta>这就是我想要的张力</c>

00:47:16.970 --> 00:47:20.374
<c.magenta>现在 让我进行更深入的介绍</c>
<c.magenta>向大家展示我进行的操作</c>

00:47:22.576 --> 00:47:23.977
<c.magenta>我会在这里进行编辑</c>

00:47:25.379 --> 00:47:28.182
<c.magenta>我会更仔细地</c>
<c.magenta>观察循环曲目</c>

00:47:29.082 --> 00:47:31.084
<c.magenta>这里 我希望大家</c>
<c.magenta>注意两点</c>

00:47:31.185 --> 00:47:33.887
<c.magenta>第一点是</c>
<c.magenta>这些是MIDI事件</c>

00:47:33.987 --> 00:47:36.456
<c.magenta>使用跨应用音频与将</c>
<c.magenta>Audio Unit作为插件使用</c>

00:47:36.523 --> 00:47:40.527
<c.magenta>的不同点是</c>
<c.magenta>你实际可以在这里看到</c>

00:47:40.594 --> 00:47:42.663
<c.magenta>MIDI音符 </c>
<c.magenta>这就使事后的编辑更简单</c>

00:47:43.063 --> 00:47:45.799
<c.magenta>我希望大家在这里</c>
<c.magenta>注意的另外一点是</c>

00:47:45.866 --> 00:47:47.968
<c.magenta>你可以在这里</c>
<c.magenta>看到单个MIDI音符</c>

00:47:48.035 --> 00:47:50.971
<c.magenta>但是之前你看到的是</c>
<c.magenta>我弹奏巨大粗厚的和弦</c>

00:47:51.371 --> 00:47:53.340
<c.magenta>这是因为我利用了</c>

00:47:53.407 --> 00:47:55.709
<c.magenta>GarageBand内置的</c>
<c.magenta>琶音器</c>

00:47:55.776 --> 00:47:57.244
<c.magenta>所以我才得到了这些单个音符</c>

00:47:57.311 --> 00:47:59.112
<c.magenta>如果愿意</c>
<c.magenta>我可以随意更改</c>

00:47:59.179 --> 00:48:00.981
<c.magenta>使音符听起来</c>
<c.magenta>更人性化</c>

00:47:59.179 --> 00:48:00.981
<c.magenta>使音符听起来</c>
<c.magenta>更人性化</c>

00:48:01.315 --> 00:48:03.450
<c.magenta>不过我对曲子现在的效果</c>
<c.magenta>已经很满意</c>

00:48:04.751 --> 00:48:08.021
<c.magenta>这里 我最后要向大家显示的</c>
<c.magenta>实际是 首先</c>

00:48:08.088 --> 00:48:12.092
<c.magenta>我会将这个复制到</c>
<c.magenta>临近的单元格</c>

00:48:13.727 --> 00:48:18.265
<c.magenta>我之前跟你提过</c>
<c.magenta>这里提供的Audio Unit视图</c>

00:48:18.532 --> 00:48:20.300
<c.magenta>实际是交互式的</c>

00:48:20.367 --> 00:48:21.835
<c.magenta>它不仅是外观漂亮的图片</c>

00:48:21.935 --> 00:48:24.505
<c.magenta>所以 如果你喜欢探索</c>
<c.magenta>你甚至可以尝试</c>

00:48:24.571 --> 00:48:26.874
<c.magenta>为朋友演奏一曲</c>

00:48:32.012 --> 00:48:33.180
<c.magenta>略微提高音量</c>

00:49:32.840 --> 00:49:33.707
<c.magenta>让我们收尾</c>

00:50:01.335 --> 00:50:02.503
<c.magenta>我的演示就到这里</c>

00:50:05.305 --> 00:50:07.774
<c.magenta>我想感激大家所付出的</c>
<c.magenta>时间和精力</c>

00:50:07.841 --> 00:50:10.043
<c.magenta>始终感谢大家写出炫酷的应用</c>

00:50:11.178 --> 00:50:13.146
<c.magenta>演示</c>
<c.magenta>Audio Unit扩展</c>

00:50:14.982 --> 00:50:15.883
<c.magenta>谢谢Torrey</c>

00:50:16.250 --> 00:50:19.653
<c.magenta>好 这里简单回顾下</c>

00:50:20.854 --> 00:50:24.124
<c.magenta>你能看到我们去年</c>
<c.magenta>关于Audio Unit扩展的介绍</c>

00:50:24.191 --> 00:50:28.028
<c.magenta>其中更详细地介绍了</c>
<c.magenta>API的构造</c>

00:50:28.095 --> 00:50:29.429
<c.magenta>这里我们只是想向你展示</c>

00:50:29.496 --> 00:50:31.431
<c.magenta>由于Audio Unit炫酷的功能</c>
<c.magenta>人们利用它都做了什么</c>

00:50:33.667 --> 00:50:37.871
<c.magenta>好 说到MIDI</c>
<c.magenta>我们看到GarageBand怎样</c>

00:50:37.938 --> 00:50:39.673
<c.magenta>将Torrey的演奏录制成MIDI</c>

00:50:40.707 --> 00:50:42.910
<c.magenta>我们的系统中</c>
<c.magenta>有很多API是</c>

00:50:42.976 --> 00:50:46.246
<c.magenta>使用MIDI通信的</c>
<c.magenta>而要在什么时候使用</c>

00:50:46.313 --> 00:50:48.282
<c.magenta>哪些API并不总是很清楚</c>

00:50:48.982 --> 00:50:51.952
<c.magenta>所以我希望能够</c>
<c.magenta>帮助大家稍稍澄清这一点</c>

00:50:53.754 --> 00:50:56.723
<c.magenta>现在 你可能就有</c>
<c.magenta>一个标准的MIDI文件</c>

00:50:57.591 --> 00:51:00.294
<c.magenta>比如 难听的手机铃声</c>

00:50:57.591 --> 00:51:00.294
<c.magenta>比如 难听的手机铃声</c>

00:51:00.427 --> 00:51:03.630
<c.magenta>不过MIDI文件</c>
<c.magenta>在音乐教学中十分有用</c>

00:51:03.830 --> 00:51:07.768
<c.magenta>我可以获得我想学习</c>
<c.magenta>乐曲的MIDI文件</c>

00:51:07.835 --> 00:51:09.336
<c.magenta>我可以看到所有的音符</c>

00:51:10.003 --> 00:51:12.105
<c.magenta>若你有一个MIDI文件 你可用</c>
<c.magenta>AVAudioSequencer</c>

00:51:12.172 --> 00:51:13.707
<c.magenta>播放该文件</c>

00:51:14.007 --> 00:51:17.244
<c.magenta>这样会在AVAudioEngine</c>
<c.magenta>环境中播放文件</c>

00:51:19.246 --> 00:51:21.815
<c.magenta>如果你想要控制</c>
<c.magenta>软件合成器</c>

00:51:22.282 --> 00:51:24.818
<c.magenta>如我们看到GarageBand</c>
<c.magenta>控制iSEM的情形</c>

00:51:25.419 --> 00:51:28.555
<c.magenta>能使用的最好的API是</c>
<c.magenta>AUAudioUnit</c>

00:51:29.590 --> 00:51:31.892
<c.magenta>而且如果你想要</c>
<c.magenta>AUAudioUnit回放到</c>

00:51:31.959 --> 00:51:35.863
<c.magenta>AVAudioEngine</c>
<c.magenta>你可以使用AVAudioMIDIInstrument</c>

00:51:39.032 --> 00:51:40.667
<c.magenta>现在 有MIDI核心框架</c>

00:51:40.734 --> 00:51:42.769
<c.magenta>人们经常认为</c>
<c.magenta>该框架会做一些</c>

00:51:43.036 --> 00:51:44.505
<c.magenta>其它较高级别的任务</c>

00:51:44.571 --> 00:51:48.475
<c.magenta>但实际上 它是非常</c>
<c.magenta>底层的API</c>

00:51:48.542 --> 00:51:50.744
<c.magenta>基本上只是用于</c>
<c.magenta>与MIDI硬件通信</c>

00:51:50.878 --> 00:51:53.747
<c.magenta>比如 外部USB的</c>
<c.magenta>MIDI接口</c>

00:51:54.181 --> 00:51:55.749
<c.magenta>或者蓝牙MIDI键盘</c>

00:51:56.283 --> 00:51:58.218
<c.magenta>我们也提供MIDI网络驱动</c>

00:51:59.019 --> 00:52:03.190
<c.magenta>你可以使用它发送原始</c>
<c.magenta>MIDI消息 比如在iPad</c>

00:51:59.019 --> 00:52:03.190
<c.magenta>你可以使用它发送原始</c>
<c.magenta>MIDI消息 比如在iPad</c>

00:52:03.257 --> 00:52:04.758
<c.magenta>和MacBook之间发送</c>

00:52:06.360 --> 00:52:09.029
<c.magenta>你也可以使用核心</c>
<c.magenta>MIDI框架</c>

00:52:09.096 --> 00:52:10.964
<c.magenta>在流程之间实时发送MIDI</c>

00:52:12.065 --> 00:52:15.769
<c.magenta>这有时会涉及一个灰色地带</c>

00:52:15.836 --> 00:52:19.039
<c.magenta>人们会问：“好吧 我该使用</c>
<c.magenta>核心MIDI在我的</c>

00:52:19.106 --> 00:52:23.110
<c.magenta>排序器</c>
<c.magenta>以及正在收听MIDI和</c>

00:52:23.177 --> 00:52:25.245
<c.magenta>合成的应用之间通信吗？”</c>

00:52:25.746 --> 00:52:29.082
<c.magenta>我会说那可能不是</c>
<c.magenta>适合于这种情况的API</c>

00:52:29.149 --> 00:52:31.318
<c.magenta>如果你正在同时</c>
<c.magenta>使用MIDI和音频</c>

00:52:31.618 --> 00:52:33.520
<c.magenta>我会使用AUAudioUnit</c>

00:52:33.887 --> 00:52:36.089
<c.magenta>情况应该是</c>
<c.magenta>当你在两个应用中</c>

00:52:36.156 --> 00:52:39.560
<c.magenta>或者一个应用的两个实体中</c>

00:52:39.626 --> 00:52:42.629
<c.magenta>操作纯MIDI时——</c>
<c.magenta>或许其中一个是来自</c>

00:52:42.696 --> 00:52:43.797
<c.magenta>另一开发者的静态库</c>

00:52:44.665 --> 00:52:48.702
<c.magenta>在上述情况下 你可以</c>
<c.magenta>将核心MIDI用于流程间</c>

00:52:48.802 --> 00:52:50.871
<c.magenta>或实体间的实时MIDI</c>

00:52:52.539 --> 00:52:56.510
<c.magenta>这里就到了我们</c>
<c.magenta>音频API长篇介绍的尾声</c>

00:52:57.277 --> 00:53:00.047
<c.magenta>我们从应用程序开始</c>
<c.magenta>——在底端是</c>

00:52:57.277 --> 00:53:00.047
<c.magenta>我们从应用程序开始</c>
<c.magenta>——在底端是</c>

00:53:00.113 --> 00:53:03.584
<c.magenta>CoreAudio框架</c>
<c.magenta>和驱动</c>

00:53:04.418 --> 00:53:07.721
<c.magenta>介绍了AVAudioEngine</c>
<c.magenta>如何用AVAudioSession</c>

00:53:07.788 --> 00:53:11.358
<c.magenta>在我们除了macOS之外的</c>
<c.magenta>所有平台上完成设置</c>

00:53:11.992 --> 00:53:14.127
<c.magenta>我们介绍了你可以怎样</c>
<c.magenta>使用AVAudioPlayer</c>

00:53:14.194 --> 00:53:16.630
<c.magenta>及AVAudioRecorder</c>
<c.magenta>从文件中</c>

00:53:16.697 --> 00:53:18.098
<c.magenta>进行简单的播放和录制操作</c>

00:53:18.732 --> 00:53:21.735
<c.magenta>或者如果你的文件</c>
<c.magenta>或网络流媒体涉及视频</c>

00:53:21.802 --> 00:53:23.103
<c.magenta>你可以使用AVPlayer</c>

00:53:23.971 --> 00:53:27.074
<c.magenta>AVAudioEngine是</c>
<c.magenta>构建复杂处理图表的</c>

00:53:27.374 --> 00:53:30.210
<c.magenta>优质高级别界面</c>

00:53:30.444 --> 00:53:32.579
<c.magenta>可以处理很多问题</c>

00:53:32.646 --> 00:53:36.884
<c.magenta>你通常无需使用</c>
<c.magenta>任何较低级别的API</c>

00:53:37.251 --> 00:53:41.788
<c.magenta>不过如果使用了 我们介绍了</c>
<c.magenta>AudioToolbox中的</c>

00:53:42.256 --> 00:53:45.192
<c.magenta>AUAudioUnit 它可以让你</c>
<c.magenta>直接与I/O循环</c>

00:53:46.193 --> 00:53:50.964
<c.magenta>与第三方或与你自己的乐器</c>
<c.magenta>效果和生成器通信</c>

00:53:51.598 --> 00:53:54.401
<c.magenta>最后 我们简要介绍了</c>
<c.magenta>核心MIDI框架</c>

00:53:56.570 --> 00:53:58.639
<c.magenta>我今天在此的介绍结束了</c>

00:53:59.773 --> 00:54:02.009
<c.magenta>你可以访问此链接</c>
<c.magenta>了解更多信息</c>

00:53:59.773 --> 00:54:02.009
<c.magenta>你可以访问此链接</c>
<c.magenta>了解更多信息</c>

00:54:02.676 --> 00:54:04.811
<c.magenta>我们在此提供了</c>
<c.magenta>很多相关介绍</c>

00:54:05.245 --> 00:54:06.113
<c.magenta>非常感谢</c>
