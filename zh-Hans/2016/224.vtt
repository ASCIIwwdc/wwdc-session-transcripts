WEBVTT

00:00:19.853 --> 00:00:24.424
<c.magenta>iMessage应用和贴图 第二部分</c>
<c.magenta>互动信息</c>

00:00:39.673 --> 00:00:40.707
<c.magenta>下午好</c>

00:00:40.774 --> 00:00:43.510
<c.magenta>欢迎来到“iMessage应用</c>
<c.magenta>和贴图 第二部分”</c>

00:00:43.977 --> 00:00:46.713
<c.magenta>我叫Alex</c>
<c.magenta>今天协助我的是Stephen</c>

00:00:46.780 --> 00:00:48.081
<c.magenta>他将负责演示</c>

00:00:49.183 --> 00:00:51.451
<c.magenta>在演讲的第一部分 Bhaskar</c>

00:00:51.518 --> 00:00:54.855
<c.magenta>和Lily介绍了贴图 贴图包</c>

00:00:54.922 --> 00:00:56.823
<c.magenta>和简单的iMessage应用</c>

00:00:56.890 --> 00:00:59.626
<c.magenta>专注于为信息提供贴图数据</c>

00:01:01.929 --> 00:01:05.032
<c.magenta>今天我们将要来讲解互动信息</c>

00:01:05.098 --> 00:01:07.301
<c.magenta>我们将更深入</c>
<c.magenta>分析iMessage应用</c>

00:01:07.367 --> 00:01:08.669
<c.magenta>及Messages框架</c>

00:01:11.071 --> 00:01:12.806
<c.magenta>什么是互动信息？</c>

00:01:13.740 --> 00:01:17.411
<c.magenta>在我背后的信息文本里</c>
<c.magenta>可以看见高亮显示的一条</c>

00:01:19.179 --> 00:01:23.984
<c.magenta>这是Messages扩展提供的</c>
<c.magenta>一种特殊类型的信息泡泡框</c>

00:01:24.484 --> 00:01:27.487
<c.magenta>可以看见它在截屏里被高亮显示</c>

00:01:32.392 --> 00:01:36.997
<c.magenta>Messages扩展可以</c>
<c.magenta>让用户新建互动信息</c>

00:01:37.865 --> 00:01:41.768
<c.magenta>并可以把它们插入输入框</c>
<c.magenta>如这里所示</c>

00:01:44.738 --> 00:01:48.141
<c.magenta>还可以让用户回复一条互动信息</c>

00:01:48.208 --> 00:01:51.245
<c.magenta>只需点击文本里的该互动信息即可</c>

00:01:51.311 --> 00:01:55.082
<c.magenta>此时扩展将会全屏显示 如这里所示</c>

00:01:56.083 --> 00:02:01.221
<c.magenta>用户可以和该扩展进行互动</c>
<c.magenta>编写一个答复</c>

00:01:56.083 --> 00:02:01.221
<c.magenta>用户可以和该扩展进行互动</c>
<c.magenta>编写一个答复</c>

00:02:02.155 --> 00:02:07.427
<c.magenta>然后扩展可以把新内容插入信息中</c>

00:02:07.494 --> 00:02:10.264
<c.magenta>它会显示在输入框 用户可以发送</c>

00:02:11.999 --> 00:02:14.268
<c.magenta>我们现在欢迎Stephen上台</c>

00:02:14.334 --> 00:02:17.271
<c.magenta>他将在模拟器上演示一个应用实例</c>

00:02:26.213 --> 00:02:29.183
<c.magenta>我将演示一个完整的</c>
<c.magenta>iMessage应用</c>

00:02:29.249 --> 00:02:30.651
<c.magenta>是我编写的</c>

00:02:30.717 --> 00:02:33.187
<c.magenta>其中所有的API都会在</c>
<c.magenta>今天的演讲中学到</c>

00:02:33.554 --> 00:02:35.856
<c.magenta>如果看向模拟器这里</c>
<c.magenta>可以看到一个图标</c>

00:02:35.923 --> 00:02:38.125
<c.magenta>来自我的iMessage应用</c>
<c.magenta>叫“冰淇凌”</c>

00:02:38.792 --> 00:02:41.995
<c.magenta>点击它</c>
<c.magenta>iMessage应用将开始运行</c>

00:02:42.062 --> 00:02:43.830
<c.magenta>在Message范围里</c>

00:02:44.431 --> 00:02:47.534
<c.magenta>所有粉色背景的UI</c>

00:02:47.601 --> 00:02:49.670
<c.magenta>都是扩展提供的</c>

00:02:50.637 --> 00:02:54.775
<c.magenta>iMessage应用是一个合作的</c>
<c.magenta>冰淇凌贴纸制作应用</c>

00:02:54.975 --> 00:02:58.412
<c.magenta>可在此看到</c>
<c.magenta>我过去做好的冰淇凌贴纸</c>

00:02:59.246 --> 00:03:01.582
<c.magenta>点击“添加”按钮</c>

00:02:59.246 --> 00:03:01.582
<c.magenta>点击“添加”按钮</c>

00:03:02.282 --> 00:03:05.118
<c.magenta>iMessage应用将会全屏显示</c>

00:03:05.185 --> 00:03:08.822
<c.magenta>这里会提供良好的制作贴纸用户体验</c>

00:03:09.857 --> 00:03:13.460
<c.magenta>选择一个冰淇凌蛋卷</c>
<c.magenta>iMessage应用会退出</c>

00:03:13.527 --> 00:03:16.930
<c.magenta>显示一条互动信息到输入框</c>
<c.magenta>供用户发送</c>

00:03:19.166 --> 00:03:23.403
<c.magenta>在iOS 10 我们添加了支持</c>

00:03:23.504 --> 00:03:25.873
<c.magenta>让用户自己编写和</c>
<c.magenta>测试iMessage应用</c>

00:03:25.939 --> 00:03:27.241
<c.magenta>就在模拟器里面</c>

00:03:27.841 --> 00:03:30.210
<c.magenta>回到对话列表</c>

00:03:30.577 --> 00:03:33.814
<c.magenta>可以看到模拟对话的两个终端</c>

00:03:35.115 --> 00:03:38.752
<c.magenta>点击第二个 显示接受信息的模拟器</c>

00:03:40.220 --> 00:03:43.924
<c.magenta>点击 iMessage应用运行进入</c>

00:03:43.991 --> 00:03:45.692
<c.magenta>冰淇淋制作过程的下一步</c>

00:03:46.093 --> 00:03:48.328
<c.magenta>我选择自己最爱的口味 薄荷脆皮</c>

00:03:49.530 --> 00:03:52.332
<c.magenta>显示该信息 发送</c>

00:03:53.934 --> 00:03:56.436
<c.magenta>现在 如果回到第一个对话</c>

00:03:56.503 --> 00:03:58.205
<c.magenta>或者第一个对话的最后</c>

00:03:58.639 --> 00:04:00.140
<c.magenta>点击该信息</c>

00:03:58.639 --> 00:04:00.140
<c.magenta>点击该信息</c>

00:04:00.941 --> 00:04:03.577
<c.magenta>选择冰淇淋的最后一个部分 撒料</c>

00:04:05.412 --> 00:04:06.346
<c.magenta>发送</c>

00:04:07.247 --> 00:04:10.150
<c.magenta>现在我有了一个制作完整的冰淇凌</c>

00:04:10.484 --> 00:04:13.754
<c.magenta>事实上 若回到iMessage应用</c>

00:04:14.621 --> 00:04:17.658
<c.magenta>可以在冰淇淋历史清单中看到</c>

00:04:17.724 --> 00:04:21.261
<c.magenta>作为一个贴图 可以应用到任何地方</c>

00:04:22.196 --> 00:04:25.098
<c.magenta>这就是互动信息的一个简单例子</c>

00:04:25.165 --> 00:04:26.466
<c.magenta>请Alex回来继续讲</c>

00:04:29.870 --> 00:04:30.904
<c.magenta>谢谢你 Stephen</c>

00:04:32.472 --> 00:04:36.243
<c.magenta>这是关于iMessage应用</c>
<c.magenta>部分功能的一个很棒的快速演示</c>

00:04:37.277 --> 00:04:41.215
<c.magenta>我们来讲讲如何用API实现</c>

00:04:41.915 --> 00:04:43.584
<c.magenta>我将讲解四点</c>

00:04:44.384 --> 00:04:47.821
<c.magenta>首先 我将会概括浏览API</c>

00:04:48.222 --> 00:04:51.959
<c.magenta>然后第二点</c>
<c.magenta>稍微讲解一下扩展生命周期</c>

00:04:52.626 --> 00:04:55.762
<c.magenta>第三点 我们将会讲解</c>

00:04:56.330 --> 00:04:58.966
<c.magenta>如何用API编写信息</c>

00:04:59.199 --> 00:05:00.400
<c.magenta>第四点</c>

00:04:59.199 --> 00:05:00.400
<c.magenta>第四点</c>

00:05:00.467 --> 00:05:03.203
<c.magenta>稍微讲讲信息是如何被发送的</c>

00:05:05.072 --> 00:05:06.840
<c.magenta>首先概括浏览API</c>

00:05:08.742 --> 00:05:10.711
<c.magenta>iMessage应用正在运行</c>

00:05:10.777 --> 00:05:15.415
<c.magenta>以简洁显示模式 这是一个扩展</c>

00:05:15.649 --> 00:05:17.351
<c.magenta>扩展有一个主类</c>

00:05:17.417 --> 00:05:19.786
<c.magenta>对于iMessage应用来说</c>
<c.magenta>这将是</c>

00:05:19.853 --> 00:05:22.890
<c.magenta>MSMessagesAppViewController的一个子类</c>

00:05:22.956 --> 00:05:24.091
<c.magenta>总而言之</c>

00:05:24.157 --> 00:05:26.360
<c.magenta>MSMessagesAppViewController是</c>

00:05:26.426 --> 00:05:29.863
<c.magenta>UIViewController</c>
<c.magenta>的一个子类 为扩展提供UI</c>

00:05:31.331 --> 00:05:34.701
<c.magenta>在扩展上面 有一个对话</c>

00:05:35.002 --> 00:05:37.638
<c.magenta>更确切地说 是对话文本</c>

00:05:38.405 --> 00:05:42.409
<c.magenta>它通过MSConversation</c>
<c.magenta>对象表示在API中</c>

00:05:43.644 --> 00:05:45.779
<c.magenta>最后是信息本身</c>

00:05:45.846 --> 00:05:47.948
<c.magenta>在文本里有这个泡泡框</c>

00:05:48.048 --> 00:05:51.485
<c.magenta>通过MSMessage类表示</c>

00:05:52.052 --> 00:05:55.489
<c.magenta>可以看到在本幻灯片中 还有两个类</c>

00:05:55.556 --> 00:05:58.725
<c.magenta>MSSession类</c>
<c.magenta>和MSMessageTemplateLayout类</c>

00:05:58.792 --> 00:06:01.595
<c.magenta>它们为如何发送信息提供相关控制</c>

00:05:58.792 --> 00:06:01.595
<c.magenta>它们为如何发送信息提供相关控制</c>

00:06:01.662 --> 00:06:03.997
<c.magenta>以及信息该如何在文本里显示</c>

00:06:05.966 --> 00:06:10.737
<c.magenta>继续讲解iMessage</c>
<c.magenta>扩展生命周期</c>

00:06:12.139 --> 00:06:17.344
<c.magenta>在这里有一个时间线</c>
<c.magenta>如果一个扩展启动</c>

00:06:18.078 --> 00:06:22.816
<c.magenta>可能从应用抽屉里 将会启动一个进程</c>

00:06:25.285 --> 00:06:29.289
<c.magenta>此后不久 调用</c>
<c.magenta>didBecomeActive(with conversation)</c>

00:06:29.356 --> 00:06:31.158
<c.magenta>传入一个对话对象</c>

00:06:31.225 --> 00:06:34.127
<c.magenta>代表应用运行时的对话</c>

00:06:35.128 --> 00:06:37.431
<c.magenta>因为这是UIViewController的子类</c>

00:06:37.497 --> 00:06:41.068
<c.magenta>我们也调用了</c>
<c.magenta>viewWillAppear和viewDidAppear</c>

00:06:41.835 --> 00:06:44.037
<c.magenta>当扩展出现在屏幕上时</c>

00:06:45.706 --> 00:06:48.976
<c.magenta>如果应用从屏幕消失 会发生什么呢？</c>

00:06:49.209 --> 00:06:51.378
<c.magenta>我们把它称为“退出活跃”</c>

00:06:51.578 --> 00:06:55.015
<c.magenta>将会发生的事是 首先会收到</c>
<c.magenta>viewWillDisappear</c>

00:06:55.215 --> 00:06:57.885
<c.magenta>和在主类的</c>
<c.magenta>viewDidDisappear调用</c>

00:06:58.785 --> 00:07:01.188
<c.magenta>然后将会 抱歉</c>

00:06:58.785 --> 00:07:01.188
<c.magenta>然后将会 抱歉</c>

00:07:01.255 --> 00:07:05.058
<c.magenta>然后将会调用</c>
<c.magenta>willResignActive(with conversation)</c>

00:07:05.125 --> 00:07:07.928
<c.magenta>此时 我们马上就要切断</c>

00:07:07.995 --> 00:07:10.464
<c.magenta>Messages和扩展的连接</c>

00:07:11.265 --> 00:07:14.201
<c.magenta>此时是可以进行对话操作的最后时间</c>

00:07:15.035 --> 00:07:17.704
<c.magenta>之后某个时间点 进程会被终止</c>

00:07:17.771 --> 00:07:20.707
<c.magenta>强调一下 这是因为进程</c>

00:07:20.774 --> 00:07:23.477
<c.magenta>建立在扩展上 而扩展是短暂的进程</c>

00:07:23.544 --> 00:07:25.512
<c.magenta>它们会迅速终止</c>

00:07:27.281 --> 00:07:28.248
<c.magenta>来看一下</c>

00:07:28.315 --> 00:07:33.820
<c.magenta>现在有一个进程在运行</c>
<c.magenta>在信息中显示UI</c>

00:07:34.321 --> 00:07:36.723
<c.magenta>用户将会和该UI进行互动</c>

00:07:36.790 --> 00:07:40.694
<c.magenta>编写一个信息 看看API如何处理</c>

00:07:40.994 --> 00:07:44.331
<c.magenta>首先创建一个MSMessage对象</c>

00:07:44.531 --> 00:07:46.867
<c.magenta>为该对象设置一些属性</c>

00:07:48.135 --> 00:07:50.737
<c.magenta>在本例中</c>
<c.magenta>设置一个Https URL</c>

00:07:50.804 --> 00:07:52.873
<c.magenta>所以信息有一个URL属性</c>

00:07:53.106 --> 00:07:56.109
<c.magenta>然后编写一些关于冰淇淋的细节</c>

00:07:56.176 --> 00:07:58.078
<c.magenta>在该URL的查询字符串中</c>

00:07:58.245 --> 00:08:00.814
<c.magenta>唯一可以产生</c>

00:07:58.245 --> 00:08:00.814
<c.magenta>唯一可以产生</c>

00:08:00.881 --> 00:08:02.716
<c.magenta>这些信息的平台是iOS</c>

00:08:02.783 --> 00:08:06.620
<c.magenta>但这些信息将要发送给</c>
<c.magenta>macOS和watchOS</c>

00:08:07.955 --> 00:08:09.189
<c.magenta>当信息发送给macOS时</c>

00:08:09.256 --> 00:08:12.259
<c.magenta>它们会在对话文本里全保真显示</c>

00:08:12.326 --> 00:08:15.996
<c.magenta>点击文本中的一个信息</c>

00:08:16.063 --> 00:08:18.565
<c.magenta>将会试图在浏览器中打开该URL</c>

00:08:18.665 --> 00:08:21.435
<c.magenta>所以如果在这里提供了一个</c>
<c.magenta>https URL</c>

00:08:22.336 --> 00:08:24.304
<c.magenta>浏览器将会为用户</c>

00:08:24.371 --> 00:08:29.476
<c.magenta>在macOS上显示该信息</c>

00:08:30.644 --> 00:08:33.746
<c.magenta>继续 这里还有一个accessibilityLabel属性</c>

00:08:33.914 --> 00:08:36.950
<c.magenta>屏幕阅读器读取文本时将会使用</c>

00:08:37.317 --> 00:08:40.153
<c.magenta>所以 为它设置一个信息泡泡框的描述</c>

00:08:40.220 --> 00:08:43.724
<c.magenta>用屏幕阅读器的用户会看到</c>

00:08:43.789 --> 00:08:47.094
<c.magenta>关于泡泡框丰富的描述 显示在文本中</c>

00:08:48.462 --> 00:08:51.098
<c.magenta>最后我们来讲布局</c>

00:08:51.331 --> 00:08:54.201
<c.magenta>后面会多讲一些相关细节</c>

00:08:55.869 --> 00:08:59.873
<c.magenta>我们用布局对象指定</c>

00:09:00.073 --> 00:09:01.708
<c.magenta>文本中一条信息的外观</c>

00:09:01.909 --> 00:09:05.913
<c.magenta>现在只有一个布局</c>
<c.magenta>MSMessageTemplateLayout</c>

00:09:06.747 --> 00:09:10.517
<c.magenta>可以为它设置一些属性</c>
<c.magenta>将会影响制作泡泡框</c>

00:09:11.718 --> 00:09:15.122
<c.magenta>这里有一个图形属性 取一幅UI图片</c>

00:09:15.489 --> 00:09:18.292
<c.magenta>为屏幕上高亮显示区提供内容</c>

00:09:19.560 --> 00:09:21.995
<c.magenta>还有一个</c>
<c.magenta>mediaFileURL属性</c>

00:09:22.296 --> 00:09:27.301
<c.magenta>mediaFileURL</c>
<c.magenta>和image一样的区域提供内容</c>

00:09:27.401 --> 00:09:30.938
<c.magenta>但在这里</c>
<c.magenta>可以提供UI图片不支持的内容</c>

00:09:31.004 --> 00:09:34.074
<c.magenta>比如</c>
<c.magenta>可提供一个指向本地视频文件的URL</c>

00:09:34.141 --> 00:09:36.276
<c.magenta>一个短视频就会循环播放</c>

00:09:36.343 --> 00:09:38.378
<c.magenta>在文本里信息泡泡框的背景中</c>

00:09:39.146 --> 00:09:42.316
<c.magenta>让我们再多关注一下这两个属性</c>

00:09:44.117 --> 00:09:48.222
<c.magenta>首先注意到</c>
<c.magenta>如果图片和URL都被提供</c>

00:09:48.288 --> 00:09:51.525
<c.magenta>图片的优先级将会高于URL</c>

00:09:53.660 --> 00:09:56.196
<c.magenta>我们对尺寸有一些建议</c>

00:09:56.263 --> 00:09:58.732
<c.magenta>这些属性提供的资产的尺寸</c>

00:09:59.099 --> 00:10:01.134
<c.magenta>我们建议为资产提供的尺寸</c>

00:09:59.099 --> 00:10:01.134
<c.magenta>我们建议为资产提供的尺寸</c>

00:10:01.201 --> 00:10:03.937
<c.magenta>大约是300x300pt</c>

00:10:04.037 --> 00:10:07.441
<c.magenta>可以提供稍大或稍小的资产</c>

00:10:07.508 --> 00:10:11.144
<c.magenta>我强烈建议在这里多多测试资产大小</c>

00:10:11.578 --> 00:10:15.249
<c.magenta>为了找到最适合应用的尺寸</c>

00:10:15.983 --> 00:10:19.753
<c.magenta>所有这些资产和贴图一样</c>
<c.magenta>都三倍显示</c>

00:10:19.820 --> 00:10:23.257
<c.magenta>iMessages将会对</c>
<c.magenta>这些图片进行缩放</c>

00:10:23.323 --> 00:10:25.492
<c.magenta>当别的设备接收时显示合适大小</c>

00:10:25.559 --> 00:10:28.695
<c.magenta>根据接收设备屏幕分辨率</c>

00:10:31.598 --> 00:10:35.702
<c.magenta>mediaFileURL支持格式有</c>
<c.magenta>PNG JPEG GIF和视频文件</c>

00:10:35.769 --> 00:10:39.106
<c.magenta>视频文件是指 支持任何</c>

00:10:39.173 --> 00:10:41.341
<c.magenta>可在Media Player</c>
<c.magenta>框架里播放的视频</c>

00:10:41.408 --> 00:10:44.244
<c.magenta>建议参考</c>
<c.magenta>Media Player框架文档</c>

00:10:44.311 --> 00:10:45.846
<c.magenta>获取更详细信息</c>

00:10:48.148 --> 00:10:50.350
<c.magenta>关于该媒体文件还要做一点</c>

00:10:50.417 --> 00:10:52.819
<c.magenta>当发送时 我们会对资产进行转码</c>

00:10:52.886 --> 00:10:56.089
<c.magenta>这是为了对其在网络中传送进行优化</c>

00:10:58.358 --> 00:11:03.230
<c.magenta>最后我建议在该图片中不要加入文字</c>

00:10:58.358 --> 00:11:03.230
<c.magenta>最后我建议在该图片中不要加入文字</c>

00:11:04.298 --> 00:11:06.533
<c.magenta>我说过 这些图片都会按比例缩小</c>

00:11:06.600 --> 00:11:09.703
<c.magenta>显示在屏幕为1倍或2倍的设备上</c>

00:11:09.770 --> 00:11:12.406
<c.magenta>但我们要求按照3倍提供</c>

00:11:12.506 --> 00:11:16.043
<c.magenta>如果在该图片上添加文字</c>
<c.magenta>尤其是字体小的文字</c>

00:11:16.143 --> 00:11:19.713
<c.magenta>当这些图片缩小时 文字将看不清楚</c>

00:11:20.848 --> 00:11:23.550
<c.magenta>但是注意到我们在例子里确实这样做了</c>

00:11:23.617 --> 00:11:25.519
<c.magenta>图片上方有一些文字</c>

00:11:26.186 --> 00:11:29.756
<c.magenta>我们来讲解</c>
<c.magenta>如何在不降低质量的条件下实现这点</c>

00:11:32.125 --> 00:11:34.528
<c.magenta>布局对图片有一些额外的属性</c>

00:11:34.595 --> 00:11:37.831
<c.magenta>都是文本属性</c>

00:11:38.732 --> 00:11:41.535
<c.magenta>它们在信息里被转换</c>

00:11:41.802 --> 00:11:44.137
<c.magenta>然后在接收设备上绘制</c>

00:11:44.204 --> 00:11:47.474
<c.magenta>这样就可以把文本在接收设备上</c>

00:11:47.541 --> 00:11:50.043
<c.magenta>尽可能显示得非常清晰</c>

00:11:51.178 --> 00:11:53.247
<c.magenta>这里显示了图片标题</c>

00:11:53.714 --> 00:11:56.016
<c.magenta>这是画在图片上方的文字</c>

00:11:56.316 --> 00:11:57.851
<c.magenta>在左下角</c>

00:11:58.952 --> 00:12:02.456
<c.magenta>我们还有副标题 也是画在图片上的</c>

00:11:58.952 --> 00:12:02.456
<c.magenta>我们还有副标题 也是画在图片上的</c>

00:12:02.523 --> 00:12:04.825
<c.magenta>就在图片标题下面</c>

00:12:05.092 --> 00:12:06.460
<c.magenta>还有这些字幕属性</c>

00:12:06.527 --> 00:12:09.363
<c.magenta>都是在图片标题下方的标题栏绘制</c>

00:12:09.429 --> 00:12:11.131
<c.magenta>就是屏幕上的灰色区域</c>

00:12:11.365 --> 00:12:14.601
<c.magenta>所以 有了字幕 跟踪字幕</c>

00:12:16.170 --> 00:12:20.474
<c.magenta>第二字幕 跟踪第二字幕</c>

00:12:25.212 --> 00:12:28.815
<c.magenta>如果来看字幕属性</c>

00:12:28.882 --> 00:12:31.251
<c.magenta>有可能忽略所有</c>

00:12:32.553 --> 00:12:33.854
<c.magenta>或都设置为空</c>

00:12:34.388 --> 00:12:35.455
<c.magenta>如果这么做了</c>

00:12:35.756 --> 00:12:38.992
<c.magenta>就会有一个底部没有字幕栏的泡泡框</c>

00:12:39.059 --> 00:12:40.861
<c.magenta>就会看上去这个样子</c>

00:12:42.162 --> 00:12:44.164
<c.magenta>最后要说明的一点</c>

00:12:44.665 --> 00:12:47.568
<c.magenta>泡泡框左上角有一个图标</c>

00:12:47.935 --> 00:12:51.872
<c.magenta>该图表是Messages</c>
<c.magenta>在内容上方提供和绘制的</c>

00:12:52.005 --> 00:12:55.576
<c.magenta>通常都会是iMessage应用图标</c>

00:12:56.310 --> 00:12:58.212
<c.magenta>就是发送信息的应用的图标</c>

00:13:00.447 --> 00:13:01.982
<c.magenta>我们继续讲解</c>

00:13:02.049 --> 00:13:04.318
<c.magenta>如何发送编写的信息</c>

00:13:07.221 --> 00:13:10.624
<c.magenta>为了实现这点 需要一个</c>
<c.magenta>MSConversation的实例</c>

00:13:10.791 --> 00:13:14.294
<c.magenta>可以通过主类的activeConversation</c>

00:13:15.229 --> 00:13:18.932
<c.magenta>有了一个对话后</c>
<c.magenta>调用insert(message)</c>

00:13:18.999 --> 00:13:20.801
<c.magenta>传入编写完成的信息</c>

00:13:21.401 --> 00:13:23.770
<c.magenta>确保处理好任何返回错误</c>

00:13:24.705 --> 00:13:27.774
<c.magenta>这样做可以让信息显示在输入框</c>

00:13:31.311 --> 00:13:32.880
<c.magenta>当然 如演讲第一部分所提到的</c>

00:13:32.946 --> 00:13:34.915
<c.magenta>也可以发送其它类型的数据</c>

00:13:34.982 --> 00:13:39.319
<c.magenta>我们支持发送文本 附件</c>

00:13:42.022 --> 00:13:43.457
<c.magenta>当然还有贴图</c>

00:13:45.993 --> 00:13:48.896
<c.magenta>当输入框的内容完成</c>

00:13:48.962 --> 00:13:52.332
<c.magenta>用户可以通过点击</c>
<c.magenta>蓝色的“发送”按钮发送</c>

00:13:52.399 --> 00:13:54.535
<c.magenta>这里我要说明 扩展没有办法</c>

00:13:54.601 --> 00:13:56.703
<c.magenta>真正自动发送一条信息</c>

00:13:56.770 --> 00:13:59.473
<c.magenta>我们总是想让用户来决定</c>

00:13:59.673 --> 00:14:01.775
<c.magenta>把什么样的信息发送给朋友</c>

00:13:59.673 --> 00:14:01.775
<c.magenta>把什么样的信息发送给朋友</c>

00:14:04.111 --> 00:14:06.079
<c.magenta>现在我把讲台交还给Stephen</c>

00:14:06.146 --> 00:14:09.683
<c.magenta>他将讲解该如何在示例项目中实现</c>

00:14:17.558 --> 00:14:18.458
<c.magenta>再次感谢 Alex</c>

00:14:19.459 --> 00:14:23.463
<c.magenta>我把之前用的示例</c>
<c.magenta>iMessage应用拿出来</c>

00:14:23.530 --> 00:14:26.867
<c.magenta>然后把它剥离到最基本的结构开始</c>

00:14:27.367 --> 00:14:29.269
<c.magenta>冰淇淋贴图之前制作的</c>

00:14:29.336 --> 00:14:30.437
<c.magenta>历史列表都还在</c>

00:14:30.504 --> 00:14:33.841
<c.magenta>但你会发现点击“添加”按钮时</c>
<c.magenta>没有反应</c>

00:14:35.609 --> 00:14:36.710
<c.magenta>在Xcode里</c>

00:14:36.777 --> 00:14:40.280
<c.magenta>显示了MSMessagesAppViewController子类</c>

00:14:40.514 --> 00:14:43.884
<c.magenta>我覆盖了周期方法</c>
<c.magenta>didBecomeActive(with conversation)</c>

00:14:43.951 --> 00:14:46.887
<c.magenta>调用super 然后调用</c>
<c.magenta>presentChildViewController</c>

00:14:46.954 --> 00:14:48.589
<c.magenta>它是我写的一个帮助方法</c>

00:14:49.022 --> 00:14:52.559
<c.magenta>将会初始化一个</c>
<c.magenta>IceCreamHistoryController</c>

00:14:52.793 --> 00:14:55.229
<c.magenta>并加入ChildViewController</c>

00:14:55.429 --> 00:14:56.830
<c.magenta>这就是目前的代码</c>

00:14:58.298 --> 00:14:59.533
<c.magenta>我现在想要做的是</c>

00:14:59.600 --> 00:15:01.735
<c.magenta>当点击“添加”按钮时</c>

00:14:59.600 --> 00:15:01.735
<c.magenta>当点击“添加”按钮时</c>

00:15:01.802 --> 00:15:04.338
<c.magenta>就会开始制作贴图的进程</c>

00:15:04.938 --> 00:15:08.408
<c.magenta>该IceCreamHistoryViewController</c>
<c.magenta>有一个委托协议</c>

00:15:08.475 --> 00:15:11.111
<c.magenta>我有一个MessagesViewController扩展</c>

00:15:11.178 --> 00:15:12.279
<c.magenta>将符合该委托协议</c>

00:15:12.346 --> 00:15:14.414
<c.magenta>通过调用historyViewController</c>

00:15:14.481 --> 00:15:16.116
<c.magenta>AddButtonTapped</c>

00:15:17.351 --> 00:15:20.420
<c.magenta>在这里我将要触发功能</c>

00:15:21.488 --> 00:15:25.092
<c.magenta>还要添加一个帮助方法</c>

00:15:25.158 --> 00:15:29.129
<c.magenta>叫作composeMessage(for iceCream)</c>
<c.magenta>将会接受一个IceCream对象参数</c>

00:15:29.196 --> 00:15:33.033
<c.magenta>然后返回到一个MSMessage</c>
<c.magenta>可以用于对话中</c>

00:15:34.101 --> 00:15:38.005
<c.magenta>要实现这一点 新建一个</c>
<c.magenta>URLComponents实例</c>

00:15:38.105 --> 00:15:40.407
<c.magenta>再把该URLComponents的</c>
<c.magenta>QueryItems属性设置为</c>

00:15:40.474 --> 00:15:42.709
<c.magenta>模块的queryItems属性</c>

00:15:44.178 --> 00:15:45.612
<c.magenta>下一步是</c>

00:15:45.712 --> 00:15:48.749
<c.magenta>新建一个MSMessageTemplateLayout实例</c>

00:15:48.815 --> 00:15:52.052
<c.magenta>并把该布局的image属性设置为</c>
<c.magenta>模块的渲染模式</c>

00:15:53.253 --> 00:15:55.589
<c.magenta>我还想为信息设置字幕</c>

00:15:55.989 --> 00:15:57.724
<c.magenta>我会在上面这里声明</c>

00:16:02.396 --> 00:16:04.765
<c.magenta>现在我准备好</c>
<c.magenta>新建MSMessage对象</c>

00:16:07.334 --> 00:16:10.037
<c.magenta>声明一个MSMessage实例</c>

00:16:10.137 --> 00:16:13.974
<c.magenta>把URL属性设置为我的</c>
<c.magenta>components的URL属性</c>

00:16:14.474 --> 00:16:17.144
<c.magenta>然后设置布局</c>
<c.magenta>和accessibilityLabel属性</c>

00:16:17.211 --> 00:16:19.479
<c.magenta>为了演示简单 我重新使用了messageCaption</c>

00:16:19.546 --> 00:16:22.082
<c.magenta>作为accessibilityLabel属性</c>

00:16:23.884 --> 00:16:26.453
<c.magenta>现在信息已经建立完成</c>
<c.magenta>要发送到对话中</c>

00:16:27.120 --> 00:16:29.323
<c.magenta>我要引用activeConversation</c>

00:16:30.524 --> 00:16:33.227
<c.magenta>然后调用conversation.insert</c>

00:16:34.494 --> 00:16:37.097
<c.magenta>把信息插入 写好了</c>

00:16:38.232 --> 00:16:40.367
<c.magenta>已写好</c>
<c.magenta>composeMessage函数</c>

00:16:41.001 --> 00:16:41.969
<c.magenta>这里我要调用它</c>

00:16:42.035 --> 00:16:44.538
<c.magenta>通过HistoryViewController</c>
<c.magenta>AddButtonTapped方法</c>

00:16:47.474 --> 00:16:52.579
<c.magenta>我总会从添加或传递一个</c>
<c.magenta>新的IceCream实例开始</c>

00:16:54.815 --> 00:16:56.850
<c.magenta>现在在iOS模拟器中运行</c>

00:16:57.851 --> 00:16:59.753
<c.magenta>启动iMessage应用</c>

00:17:01.755 --> 00:17:05.692
<c.magenta>等待调试器载入 点击加号按钮</c>

00:17:06.193 --> 00:17:08.127
<c.magenta>信息显示给用户可以发送</c>

00:17:08.729 --> 00:17:10.763
<c.magenta>因为我并没有真正选择冰淇凌的部分</c>

00:17:10.830 --> 00:17:13.767
<c.magenta>我只是有一个冰淇淋的图片框</c>

00:17:13.934 --> 00:17:15.969
<c.magenta>可以看到信息下面的字幕</c>

00:17:17.037 --> 00:17:18.539
<c.magenta>开头开得不错</c>

00:17:18.805 --> 00:17:22.041
<c.magenta>但是我想离开始时的那个演示更近一步</c>

00:17:22.809 --> 00:17:24.243
<c.magenta>当我点击加号按钮时</c>

00:17:24.310 --> 00:17:27.047
<c.magenta>我想马上进入贴图制作UI体验</c>

00:17:28.015 --> 00:17:30.851
<c.magenta>为了实现 需要介绍一个新概念</c>

00:17:31.685 --> 00:17:35.255
<c.magenta>在这里iMessage应用</c>
<c.magenta>正显示为简洁显示风格</c>

00:17:36.089 --> 00:17:38.091
<c.magenta>我可以选择让iMessage应用</c>

00:17:38.158 --> 00:17:40.994
<c.magenta>显示为展开显示风格 通过添加代码</c>

00:17:42.663 --> 00:17:45.199
<c.magenta>在这里不再调用</c>
<c.magenta>composeMessage(for:iceCream())</c>

00:17:45.599 --> 00:17:47.634
<c.magenta>而是在父类上调用</c>

00:17:47.968 --> 00:17:51.271
<c.magenta>requestPresentationStyle方法</c>
<c.magenta>参数为枚举expanded</c>

00:17:52.339 --> 00:17:55.576
<c.magenta>这将触发一个生命周期回调方法 叫作</c>

00:17:55.642 --> 00:17:58.512
<c.magenta>willTransition(to presentationStyle)</c>

00:17:59.780 --> 00:18:01.949
<c.magenta>调入super实现</c>

00:17:59.780 --> 00:18:01.949
<c.magenta>调入super实现</c>

00:18:05.619 --> 00:18:07.120
<c.magenta>然后调用帮助方法</c>

00:18:07.187 --> 00:18:10.524
<c.magenta>为该显示风格显示其</c>
<c.magenta>正确的子视图控制器</c>

00:18:12.359 --> 00:18:13.727
<c.magenta>现在我的presentChildViewController</c>

00:18:13.794 --> 00:18:16.730
<c.magenta>总是显示当前的</c>
<c.magenta>IceCreamHistoryViewController</c>

00:18:16.897 --> 00:18:20.133
<c.magenta>所以我需要改变显示风格改变的逻辑</c>

00:18:20.200 --> 00:18:22.169
<c.magenta>这样才可以显示正确的视图控制器</c>

00:18:23.070 --> 00:18:25.239
<c.magenta>首先要添加一个参数 这样我才知道</c>

00:18:25.305 --> 00:18:27.174
<c.magenta>正在处理哪个显示风格</c>

00:18:28.208 --> 00:18:29.676
<c.magenta>然后我要把这段代码改为</c>

00:18:31.478 --> 00:18:33.514
<c.magenta>只显示historyViewController</c>

00:18:33.580 --> 00:18:35.315
<c.magenta>当处于简洁显示风格时</c>

00:18:36.517 --> 00:18:39.319
<c.magenta>如果正处于展开显示风格</c>

00:18:39.386 --> 00:18:42.155
<c.magenta>将声明一个新的IceCream实例</c>

00:18:42.789 --> 00:18:48.762
<c.magenta>让我的controller成为</c>
<c.magenta>IceCreamBuilderController的一个实例</c>

00:18:49.129 --> 00:18:50.898
<c.magenta>传入刚刚声明的iceCream</c>

00:18:52.666 --> 00:18:56.170
<c.magenta>最后 在我把它添加为</c>
<c.magenta>子视图控制器以前</c>

00:18:56.236 --> 00:19:00.007
<c.magenta>需要移除所有之前的子视图控制器</c>

00:18:56.236 --> 00:19:00.007
<c.magenta>需要移除所有之前的子视图控制器</c>

00:19:00.073 --> 00:19:01.508
<c.magenta>清理视图层次结构</c>

00:19:04.077 --> 00:19:06.880
<c.magenta>现在我需要更新帮助方法的调用地点</c>

00:19:08.749 --> 00:19:14.121
<c.magenta>这里我将把正在等待的</c>
<c.magenta>显示风格传递给方法</c>

00:19:15.122 --> 00:19:17.624
<c.magenta>在didBecomeActive(with conversation)方法中</c>

00:19:17.891 --> 00:19:20.627
<c.magenta>为它传递当前的显示风格</c>

00:19:20.694 --> 00:19:24.331
<c.magenta>可以把它作为父视图控制器的一个属性</c>

00:19:28.902 --> 00:19:29.770
<c.magenta>应该没错</c>

00:19:31.038 --> 00:19:34.274
<c.magenta>最后——事实上让我们</c>

00:19:34.341 --> 00:19:37.678
<c.magenta>先看看这样能不能实现</c>

00:19:46.653 --> 00:19:48.188
<c.magenta>点击加号按钮</c>

00:19:48.755 --> 00:19:51.325
<c.magenta>我的iMessage应用</c>
<c.magenta>进入展开状态</c>

00:19:51.391 --> 00:19:54.361
<c.magenta>正在显示冰淇淋制作体验</c>

00:19:55.162 --> 00:19:57.865
<c.magenta>然而 你会发现点击“选择”</c>
<c.magenta>什么都没发生</c>

00:19:58.232 --> 00:20:00.567
<c.magenta>这是因为我的iceCreambuilderviewcontroller</c>

00:19:58.232 --> 00:20:00.567
<c.magenta>这是因为我的iceCreambuilderviewcontroller</c>

00:20:00.634 --> 00:20:03.937
<c.magenta>也有一个委托协议 也有一个扩展</c>

00:20:04.238 --> 00:20:08.275
<c.magenta>在这里的视图控制器上</c>
<c.magenta>抱歉有点太快了</c>

00:20:10.177 --> 00:20:12.312
<c.magenta>该委托协议</c>

00:20:12.379 --> 00:20:14.615
<c.magenta>通过</c>
<c.magenta>iceCreamBuilderViewController方法实现</c>

00:20:14.681 --> 00:20:16.550
<c.magenta>didSelect iceCreamPart,for iceCream</c>

00:20:17.618 --> 00:20:20.254
<c.magenta>只要点击选择按钮 该方法就会被调用</c>

00:20:21.421 --> 00:20:24.525
<c.magenta>这里正好可以调用我写的帮助方法</c>

00:20:24.591 --> 00:20:26.627
<c.magenta>composeMessage</c>
<c.magenta>我将传递</c>

00:20:26.693 --> 00:20:28.729
<c.magenta>更新过的iceCream给它</c>

00:20:29.730 --> 00:20:32.499
<c.magenta>我还要做的一件事是</c>
<c.magenta>调用dismiss方法</c>

00:20:32.933 --> 00:20:36.803
<c.magenta>因为iMessage应用</c>
<c.magenta>已经完成内容准备</c>

00:20:36.904 --> 00:20:38.605
<c.magenta>我想要iMessage应用退出</c>

00:20:38.672 --> 00:20:40.841
<c.magenta>为用户显示完成消息</c>

00:20:50.784 --> 00:20:54.521
<c.magenta>启动应用 点击加号按钮</c>

00:20:55.155 --> 00:20:56.423
<c.magenta>选中一个冰淇凌蛋卷</c>

00:20:57.591 --> 00:20:59.626
<c.magenta>退出iMessage应用</c>

00:20:59.693 --> 00:21:03.363
<c.magenta>互动消息准确地显示 用户可以发送</c>

00:20:59.693 --> 00:21:03.363
<c.magenta>互动消息准确地显示 用户可以发送</c>

00:21:03.630 --> 00:21:05.566
<c.magenta>这就是如何发送互动信息</c>

00:21:05.632 --> 00:21:07.201
<c.magenta>的一个快速演示</c>

00:21:07.267 --> 00:21:08.302
<c.magenta>交回给Alex</c>

00:21:15.676 --> 00:21:17.311
<c.magenta>谢谢你 Alex 非常棒</c>

00:21:19.613 --> 00:21:20.447
<c.magenta>所以</c>

00:21:22.883 --> 00:21:26.787
<c.magenta>Stephen为大家介绍</c>
<c.magenta>和演示了如何使用API</c>

00:21:27.254 --> 00:21:30.257
<c.magenta>添加内容到一个对话并发送</c>

00:21:30.958 --> 00:21:33.560
<c.magenta>Stephen还介绍了显示风格</c>

00:21:33.827 --> 00:21:36.563
<c.magenta>我们将进一步讲解其更多细节</c>

00:21:37.898 --> 00:21:41.401
<c.magenta>我们有两种显示风格 简洁和展开</c>

00:21:42.336 --> 00:21:46.373
<c.magenta>左边是简洁风格 右边是展开风格</c>

00:21:48.675 --> 00:21:52.346
<c.magenta>这两种风格之间有一些不同</c>

00:21:52.913 --> 00:21:55.649
<c.magenta>在简洁模式 无法访问键盘</c>

00:21:56.416 --> 00:21:57.684
<c.magenta>而且也</c>

00:21:57.885 --> 00:22:02.122
<c.magenta>无法横向滚动 以及无法辨识滑动手势</c>

00:21:57.885 --> 00:22:02.122
<c.magenta>无法横向滚动 以及无法辨识滑动手势</c>

00:22:02.656 --> 00:22:06.426
<c.magenta>这是因为在简洁模式</c>
<c.magenta>用户可以向左或向右滑动</c>

00:22:07.294 --> 00:22:09.596
<c.magenta>在iMessage应用之间快速切换</c>

00:22:11.498 --> 00:22:14.434
<c.magenta>然而 还是可以访问输入框</c>

00:22:14.501 --> 00:22:18.639
<c.magenta>不论何时</c>
<c.magenta>在简洁显示风格里调用插入信息</c>

00:22:18.972 --> 00:22:21.942
<c.magenta>信息都会马上插入到输入框里</c>

00:22:22.342 --> 00:22:24.311
<c.magenta>用户可以立即看到</c>

00:22:24.811 --> 00:22:27.047
<c.magenta>后续调用插入信息</c>

00:22:27.114 --> 00:22:30.050
<c.magenta>将会用新的信息取代当前信息</c>

00:22:30.117 --> 00:22:34.555
<c.magenta>这里你可以允许用户反复编写信息</c>

00:22:34.621 --> 00:22:36.890
<c.magenta>看到它在输入框里的进展</c>

00:22:36.957 --> 00:22:39.059
<c.magenta>直到满意后 就可以发送</c>

00:22:41.562 --> 00:22:44.498
<c.magenta>与此相对的 在展开显示风格里</c>

00:22:44.565 --> 00:22:47.167
<c.magenta>显然无法访问输入框</c>

00:22:47.334 --> 00:22:51.839
<c.magenta>但却可以访问横向滑动手势辨识和滚动</c>

00:22:52.206 --> 00:22:53.974
<c.magenta>也可以使用键盘</c>

00:22:58.612 --> 00:23:01.582
<c.magenta>用户随时可以在扩展中进行转换</c>

00:22:58.612 --> 00:23:01.582
<c.magenta>用户随时可以在扩展中进行转换</c>

00:23:01.648 --> 00:23:06.119
<c.magenta>在两种风格间转换 只需点击上方的图标</c>
<c.magenta>从展开转换到折叠</c>

00:23:06.320 --> 00:23:08.589
<c.magenta>从而转换到简洁风格</c>

00:23:08.722 --> 00:23:12.526
<c.magenta>在简洁风格下</c>
<c.magenta>可以点击屏幕下方的图标</c>

00:23:12.593 --> 00:23:15.596
<c.magenta>把应用展开成展开显示风格</c>

00:23:15.762 --> 00:23:19.499
<c.magenta>当在使用iMessage应用时</c>
<c.magenta>响应需要非常及时</c>

00:23:19.600 --> 00:23:24.004
<c.magenta>在应用显示的的区域</c>

00:23:26.673 --> 00:23:28.475
<c.magenta>任何时候转换发生时</c>

00:23:28.542 --> 00:23:31.478
<c.magenta>都会出现主类的回调</c>

00:23:32.279 --> 00:23:36.850
<c.magenta>转换开始后 将会调用</c>
<c.magenta>willTransition(to:presentationStyle)</c>

00:23:37.718 --> 00:23:40.654
<c.magenta>最后 当转换结束时</c>

00:23:40.721 --> 00:23:43.290
<c.magenta>将会调用</c>
<c.magenta>didTransition(to:presentationStyle)</c>

00:23:45.192 --> 00:23:49.029
<c.magenta>如Stephen所演示的</c>
<c.magenta>你可以要求显示风格为展开</c>

00:23:49.463 --> 00:23:53.267
<c.magenta>或简洁 只需调用</c>
<c.magenta>requestPresentationStyle方法</c>

00:23:53.333 --> 00:23:54.868
<c.magenta>在主类中</c>

00:23:55.435 --> 00:23:57.838
<c.magenta>如演示里所提到的</c>
<c.magenta>可以调用dismiss</c>

00:23:57.905 --> 00:24:00.874
<c.magenta>iMessage应用将退出</c>
<c.magenta>并显示键盘</c>

00:23:57.905 --> 00:24:00.874
<c.magenta>iMessage应用将退出</c>
<c.magenta>并显示键盘</c>

00:24:03.443 --> 00:24:06.413
<c.magenta>我们继续讨论如何回复信息</c>

00:24:08.482 --> 00:24:10.484
<c.magenta>这里介绍两种情况</c>

00:24:11.318 --> 00:24:12.986
<c.magenta>一种情况是扩展处于非活动状态</c>

00:24:13.053 --> 00:24:15.956
<c.magenta>文本里有一个用户点击的泡泡框</c>

00:24:16.023 --> 00:24:17.758
<c.magenta>我们首先来看这种情况</c>

00:24:18.559 --> 00:24:20.260
<c.magenta>之后回来看第二种</c>

00:24:22.729 --> 00:24:26.166
<c.magenta>再看看时间线 应该看上去很熟悉</c>

00:24:27.801 --> 00:24:29.903
<c.magenta>用户点击泡泡框</c>

00:24:30.671 --> 00:24:32.606
<c.magenta>进程启动</c>

00:24:33.907 --> 00:24:36.076
<c.magenta>经过完全相同的步骤</c>

00:24:36.143 --> 00:24:38.879
<c.magenta>和应用从应用抽屉启动的过程一样</c>

00:24:39.613 --> 00:24:42.249
<c.magenta>将会调用</c>
<c.magenta>didBecomeActive(with conversation)</c>

00:24:42.449 --> 00:24:45.886
<c.magenta>然后是viewWillAppear</c>
<c.magenta>和viewDidAppear</c>

00:24:45.986 --> 00:24:47.588
<c.magenta>这些步骤完成后</c>

00:24:47.654 --> 00:24:50.924
<c.magenta>应用将会显示成展开显示风格</c>

00:24:52.392 --> 00:24:56.396
<c.magenta>我们总以展开显示风格展示应用</c>

00:24:56.463 --> 00:24:58.799
<c.magenta>当用户点击一个按钮启动 抱歉</c>

00:24:58.866 --> 00:25:01.235
<c.magenta>是点击文本里的泡泡框来启动</c>

00:24:58.866 --> 00:25:01.235
<c.magenta>是点击文本里的泡泡框来启动</c>

00:25:02.870 --> 00:25:07.541
<c.magenta>现在来看第二种情况</c>
<c.magenta>扩展已经处于活跃</c>

00:25:07.608 --> 00:25:11.578
<c.magenta>本例中 正处于简洁显示风格</c>

00:25:13.814 --> 00:25:15.582
<c.magenta>再看一次时间线</c>

00:25:15.649 --> 00:25:19.086
<c.magenta>这次 点击泡泡框 应用处于活跃</c>

00:25:19.419 --> 00:25:23.590
<c.magenta>所以 不会调用willBecomeActive</c>
<c.magenta>或者didBecomeActive</c>

00:25:23.657 --> 00:25:26.326
<c.magenta>将会调用willTransition</c>

00:25:26.393 --> 00:25:28.929
<c.magenta>(to presentationStyle)方法</c>

00:25:29.263 --> 00:25:32.866
<c.magenta>然后调用didSelect方法</c>
<c.magenta>带有message和conversation参数</c>

00:25:33.834 --> 00:25:35.536
<c.magenta>在主类上进行调用</c>

00:25:35.602 --> 00:25:38.172
<c.magenta>让你知道用户点击了文本里的泡泡框</c>

00:25:38.238 --> 00:25:40.174
<c.magenta>并选中一条信息</c>

00:25:41.041 --> 00:25:44.645
<c.magenta>最后当展开显示风格转换完成</c>

00:25:44.711 --> 00:25:47.447
<c.magenta>将会调用didTransition(to presentationStyle)</c>

00:25:50.050 --> 00:25:52.719
<c.magenta>在两个时间线的最后</c>

00:25:53.020 --> 00:25:56.757
<c.magenta>应用的UI显示展开显示风格</c>

00:25:56.823 --> 00:25:59.626
<c.magenta>而你想访问被点击的信息</c>

00:26:00.127 --> 00:26:04.765
<c.magenta>实现方法是用MSConversation的</c>
<c.magenta>selectedMessage属性</c>

00:26:04.831 --> 00:26:07.201
<c.magenta>可以从当前活跃的对话中获得</c>

00:26:07.267 --> 00:26:08.769
<c.magenta>在主类上</c>

00:26:10.537 --> 00:26:14.074
<c.magenta>你会想要把选中的信息显示在UI上</c>

00:26:14.274 --> 00:26:16.610
<c.magenta>并允许用户编写回复</c>

00:26:18.312 --> 00:26:20.047
<c.magenta>再次请Stephen上台</c>

00:26:20.113 --> 00:26:24.084
<c.magenta>他将做最后一个演示</c>
<c.magenta>如何在示例应用中实现回复</c>

00:26:31.024 --> 00:26:34.628
<c.magenta>好的 刚才离开时</c>
<c.magenta>正有一个准备发的信息</c>

00:26:34.695 --> 00:26:36.063
<c.magenta>我会把它发出去</c>

00:26:37.331 --> 00:26:39.399
<c.magenta>回到对话表</c>

00:26:39.933 --> 00:26:41.935
<c.magenta>打开对话的另一端</c>

00:26:42.402 --> 00:26:44.004
<c.magenta>可以看到收到的信息</c>

00:26:44.838 --> 00:26:48.375
<c.magenta>点击该信息</c>
<c.magenta>iMessage应用正常启动</c>

00:26:48.475 --> 00:26:50.611
<c.magenta>然而 冰淇凌制作体验</c>

00:26:50.677 --> 00:26:52.880
<c.magenta>并没有显示冰淇凌制作过程的下一步骤</c>

00:26:52.946 --> 00:26:54.915
<c.magenta>我还没办法选择冰淇凌球</c>

00:26:55.716 --> 00:26:59.152
<c.magenta>这是因为每次显示当前的视图控制器</c>

00:26:59.219 --> 00:27:01.522
<c.magenta>总是传入一个新的冰淇凌模块对象</c>

00:26:59.219 --> 00:27:01.522
<c.magenta>总是传入一个新的冰淇凌模块对象</c>

00:27:02.122 --> 00:27:05.292
<c.magenta>我需要做的是 找到对话中的选中信息</c>

00:27:05.359 --> 00:27:08.795
<c.magenta>如果信息中存在冰淇凌模块对象</c>
<c.magenta>就要使用</c>

00:27:10.063 --> 00:27:11.798
<c.magenta>回到上面这里</c>

00:27:13.467 --> 00:27:16.170
<c.magenta>到新建IceCreamBuilderController实例的地方</c>

00:27:17.070 --> 00:27:19.873
<c.magenta>引用activeConversation</c>

00:27:22.876 --> 00:27:25.312
<c.magenta>使用一个可失败构造器</c>

00:27:26.079 --> 00:27:28.982
<c.magenta>查看对话中的信息</c>

00:27:29.850 --> 00:27:33.353
<c.magenta>如果构造失败 就意味着没有进展</c>

00:27:33.420 --> 00:27:35.556
<c.magenta>我就会新建一个冰淇凌模块</c>

00:27:35.622 --> 00:27:38.959
<c.magenta>如果存在 则传入进展中的冰淇凌</c>

00:27:40.327 --> 00:27:44.531
<c.magenta>还要确认的一件事是</c>
<c.magenta>要传入正确的字幕文本</c>

00:27:44.631 --> 00:27:48.168
<c.magenta>根据选中的冰淇凌零件</c>

00:27:49.970 --> 00:27:55.242
<c.magenta>为了实现 需要传入一个新参数给方法</c>

00:27:55.309 --> 00:27:56.977
<c.magenta>就是selectedIceCreamPart</c>

00:28:00.013 --> 00:28:02.850
<c.magenta>这个messageCaption</c>
<c.magenta>我要变成一个声明</c>

00:28:03.183 --> 00:28:07.487
<c.magenta>为字符串类型</c>
<c.magenta>然后使用switch方法</c>

00:28:08.555 --> 00:28:11.959
<c.magenta>在selectedIceCreamPart上</c>
<c.magenta>来选择合适的messageCaption</c>

00:28:16.630 --> 00:28:19.399
<c.magenta>我还要需要更新调用该方法的地址</c>

00:28:19.733 --> 00:28:21.802
<c.magenta>这里 传入新的参数</c>

00:28:34.481 --> 00:28:36.216
<c.magenta>当启动iMessage应用时</c>

00:28:37.351 --> 00:28:40.654
<c.magenta>点击加号按钮 发出第一条信息</c>

00:28:42.189 --> 00:28:46.026
<c.magenta>回到对话表 进入对话另一端</c>

00:28:47.294 --> 00:28:48.929
<c.magenta>点击接收到的信息</c>

00:28:48.996 --> 00:28:52.566
<c.magenta>现在冰淇凌制作视图控制器显示正常</c>

00:28:52.633 --> 00:28:53.934
<c.magenta>可以选择冰淇凌球</c>

00:28:55.903 --> 00:28:57.404
<c.magenta>我可以选择薄荷脆皮</c>

00:28:59.206 --> 00:29:00.073
<c.magenta>发送</c>

00:28:59.206 --> 00:29:00.073
<c.magenta>发送</c>

00:29:01.708 --> 00:29:03.710
<c.magenta>再回到对话的另一端</c>

00:29:05.145 --> 00:29:06.446
<c.magenta>选择撒料</c>

00:29:09.416 --> 00:29:13.020
<c.magenta>这就是发送和接收互动信息的情况</c>

00:29:13.086 --> 00:29:15.255
<c.magenta>以及如何合作完成一个任务</c>

00:29:16.723 --> 00:29:18.892
<c.magenta>然而 可以看到在对话界面里</c>

00:29:18.959 --> 00:29:22.129
<c.magenta>那些未完成的冰淇凌</c>
<c.magenta>让对话看起来有点乱</c>

00:29:23.230 --> 00:29:25.199
<c.magenta>我并不想看未完成冰淇凌</c>

00:29:25.265 --> 00:29:27.467
<c.magenta>我只想看冰淇凌成品</c>

00:29:28.802 --> 00:29:31.839
<c.magenta>我想折叠所有之前的信息</c>

00:29:31.905 --> 00:29:35.442
<c.magenta>也许可以留下那些信息的简明总结</c>

00:29:35.943 --> 00:29:38.846
<c.magenta>为了实现 我将使用一个</c>
<c.magenta>新的对象MSSession</c>

00:29:39.012 --> 00:29:40.380
<c.magenta>把信息合到一组</c>

00:29:43.350 --> 00:29:45.319
<c.magenta>这里当编写信息时</c>

00:29:47.054 --> 00:29:50.123
<c.magenta>移动activeConversation引用</c>

00:29:52.059 --> 00:29:54.194
<c.magenta>当声明session对象时</c>

00:29:56.363 --> 00:30:00.901
<c.magenta>查看selectedMessage</c>
<c.magenta>是否存在于会话中</c>

00:29:56.363 --> 00:30:00.901
<c.magenta>查看selectedMessage</c>
<c.magenta>是否存在于会话中</c>

00:30:01.235 --> 00:30:04.404
<c.magenta>如果是 则选择该信息</c>
<c.magenta>将会在同个分组中继续</c>

00:30:05.138 --> 00:30:07.474
<c.magenta>否则 新建一个</c>
<c.magenta>MSSession对象</c>

00:30:09.343 --> 00:30:11.044
<c.magenta>然后把该session传入这里</c>

00:30:12.346 --> 00:30:14.715
<c.magenta>到MSMessage构造器</c>

00:30:17.484 --> 00:30:18.585
<c.magenta>另一件事是</c>

00:30:18.652 --> 00:30:21.555
<c.magenta>当信息折叠时提供一个很好的信息总结</c>

00:30:23.891 --> 00:30:28.095
<c.magenta>这里声明一个变量</c>
<c.magenta>叫summaryText</c>

00:30:29.863 --> 00:30:32.799
<c.magenta>这里我会选择显示不同的</c>
<c.magenta>summaryText</c>

00:30:32.866 --> 00:30:36.603
<c.magenta>根据不同的selectedIceCreamPart</c>

00:30:39.706 --> 00:30:44.211
<c.magenta>我可以把summaryText变量</c>
<c.magenta>传给MSMessage对象</c>

00:30:47.281 --> 00:30:48.582
<c.magenta>好了</c>

00:30:50.250 --> 00:30:51.652
<c.magenta>哦 可能需要指定</c>

00:30:54.588 --> 00:30:55.489
<c.magenta>这下完成了</c>

00:31:01.628 --> 00:31:03.363
<c.magenta>现在启动iMessage应用</c>

00:31:05.299 --> 00:31:08.135
<c.magenta>进行制作冰淇淋的过程</c>

00:31:12.339 --> 00:31:13.941
<c.magenta>冰淇凌看上去不错吧</c>

00:31:16.510 --> 00:31:19.279
<c.magenta>选择冰淇凌口味</c>

00:31:20.080 --> 00:31:23.650
<c.magenta>可以看到折叠起来的摘要文本</c>

00:31:23.917 --> 00:31:26.820
<c.magenta>当发送信息时可以看到</c>

00:31:28.889 --> 00:31:33.393
<c.magenta>如果我回到对话的第一部分</c>

00:31:34.661 --> 00:31:36.129
<c.magenta>再次点击信息</c>

00:31:36.897 --> 00:31:39.032
<c.magenta>现在我觉得巧克力撒料不错</c>

00:31:42.102 --> 00:31:44.605
<c.magenta>发送后 冰淇凌信息完整了</c>

00:31:44.705 --> 00:31:49.209
<c.magenta>但是只显示了一张图片</c>

00:31:49.276 --> 00:31:52.179
<c.magenta>整个文本中都有很好的摘要说明</c>

00:31:53.747 --> 00:31:57.217
<c.magenta>并且 当进入冰淇凌应用之后</c>

00:31:57.851 --> 00:32:00.120
<c.magenta>可以看到全新完成的冰淇凌贴图</c>

00:31:57.851 --> 00:32:00.120
<c.magenta>可以看到全新完成的冰淇凌贴图</c>

00:32:00.187 --> 00:32:02.189
<c.magenta>可以任我所用</c>

00:32:03.123 --> 00:32:05.459
<c.magenta>完成了 这就是完整的示例应用</c>

00:32:06.093 --> 00:32:08.328
<c.magenta>这个例子展示了如何编写</c>

00:32:08.862 --> 00:32:11.298
<c.magenta>一个互动贴图制作应用</c>

00:32:11.365 --> 00:32:13.166
<c.magenta>但是可以用这种方法做任何事</c>

00:32:13.233 --> 00:32:16.036
<c.magenta>可以集合各种优质服务</c>

00:32:16.503 --> 00:32:19.673
<c.magenta>编写优秀的合作游戏</c>
<c.magenta>我迫不及待想看看你们的成果</c>

00:32:19.973 --> 00:32:21.074
<c.magenta>交回给Alex</c>

00:32:24.411 --> 00:32:26.346
<c.magenta>谢谢你 Stephen</c>
<c.magenta>另一个非常棒的演示</c>

00:32:26.413 --> 00:32:28.982
<c.magenta>Stephen实现了回复</c>

00:32:29.216 --> 00:32:32.719
<c.magenta>并引入了新的对象MSSession</c>

00:32:33.020 --> 00:32:35.255
<c.magenta>来看一下MSSession</c>

00:32:38.759 --> 00:32:39.760
<c.magenta>之前在演示里看到的</c>

00:32:39.826 --> 00:32:43.697
<c.magenta>是含有很多未完成冰淇凌的</c>
<c.magenta>乱糟糟的文本</c>

00:32:44.064 --> 00:32:45.866
<c.magenta>我们看到如何用MSSession</c>

00:32:45.966 --> 00:32:49.002
<c.magenta>把它进程处理 变成</c>

00:32:49.069 --> 00:32:53.173
<c.magenta>像这样的 更为干净整洁 非常好</c>

00:32:55.209 --> 00:32:58.445
<c.magenta>实现它我们用了</c>
<c.magenta>MSSession对象</c>

00:32:58.512 --> 00:33:00.414
<c.magenta>新建一个MSSession</c>

00:32:58.512 --> 00:33:00.414
<c.magenta>新建一个MSSession</c>

00:33:01.582 --> 00:33:02.916
<c.magenta>对第一条信息</c>

00:33:02.983 --> 00:33:05.719
<c.magenta>是对话的一部分 我们传入新建的会话</c>

00:33:05.786 --> 00:33:08.889
<c.magenta>进入该构造器 有了这个会话信息</c>

00:33:10.123 --> 00:33:12.593
<c.magenta>还可以设置摘要文本</c>

00:33:14.595 --> 00:33:17.297
<c.magenta>我们利用对话的</c>
<c.magenta>insert(message)发送</c>

00:33:17.364 --> 00:33:18.665
<c.magenta>如之前所见</c>

00:33:21.869 --> 00:33:23.871
<c.magenta>当回复一条会话信息时</c>

00:33:23.937 --> 00:33:27.674
<c.magenta>我们不想新建一个会话</c>
<c.magenta>而是再次使用已有的会话</c>

00:33:27.941 --> 00:33:30.010
<c.magenta>我们可以获取当前会话</c>

00:33:30.310 --> 00:33:31.712
<c.magenta>从当前对话中</c>

00:33:31.778 --> 00:33:34.181
<c.magenta>activeConversation.selectedMessage</c>

00:33:34.248 --> 00:33:36.984
<c.magenta>selectedMessage</c>
<c.magenta>将有一个session属性</c>

00:33:37.050 --> 00:33:38.619
<c.magenta>如果它是一个会话信息</c>

00:33:41.889 --> 00:33:44.791
<c.magenta>然后我们取出该session属性</c>

00:33:44.858 --> 00:33:47.494
<c.magenta>传入信息构造器 如之前所见</c>

00:33:50.230 --> 00:33:52.999
<c.magenta>在这里summaryText</c>
<c.magenta>提供了文本</c>

00:33:53.066 --> 00:33:55.903
<c.magenta>在对话文本中对信息进行总结</c>

00:33:56.770 --> 00:34:00.374
<c.magenta>现在也可以忽略该属性 把它设为空</c>

00:33:56.770 --> 00:34:00.374
<c.magenta>现在也可以忽略该属性 把它设为空</c>

00:34:00.807 --> 00:34:02.109
<c.magenta>如果这么做的话</c>

00:34:02.276 --> 00:34:05.913
<c.magenta>在文本中就没有</c>
<c.magenta>summaryText的入口</c>

00:34:05.979 --> 00:34:09.516
<c.magenta>但是信息还是会参与到会话行为</c>

00:34:09.583 --> 00:34:11.518
<c.magenta>我们讲解了API的基本要点</c>

00:34:11.585 --> 00:34:14.388
<c.magenta>也看到该如何编写一个</c>
<c.magenta>非常简单的iMessage应用</c>

00:34:14.755 --> 00:34:18.824
<c.magenta>可以在朋友间发送互动信息</c>

00:34:20.527 --> 00:34:24.797
<c.magenta>我们将继续讨论API的一些高级特性</c>

00:34:28.835 --> 00:34:32.906
<c.magenta>我们将从主类上更多覆盖方法开始</c>

00:34:34.041 --> 00:34:36.877
<c.magenta>然后继续讨论分组对话</c>

00:34:38.178 --> 00:34:42.014
<c.magenta>最后讨论如何辨别</c>
<c.magenta>某一特定信息的发送者</c>

00:34:45.485 --> 00:34:48.288
<c.magenta>首先 当用户发送一条信息时</c>

00:34:48.355 --> 00:34:51.859
<c.magenta>我们意识到</c>
<c.magenta>也许应用想知道发生了什么</c>

00:34:52.693 --> 00:34:55.529
<c.magenta>比如 若你是一个游戏 用户做出移动</c>

00:34:55.896 --> 00:34:58.565
<c.magenta>我们需要知道什么时候更新模块</c>
<c.magenta>记录这次移动</c>

00:34:58.632 --> 00:35:02.035
<c.magenta>这需要在信息缺失发送出去之后发生</c>

00:34:58.632 --> 00:35:02.035
<c.magenta>这需要在信息缺失发送出去之后发生</c>

00:35:03.837 --> 00:35:09.743
<c.magenta>所以 我们有一个didStartSending(_message)方法</c>

00:35:09.810 --> 00:35:14.214
<c.magenta>在主类上</c>
<c.magenta>当用户点击发送按钮时会被调用</c>

00:35:14.481 --> 00:35:15.616
<c.magenta>这点很重要</c>

00:35:15.682 --> 00:35:16.917
<c.magenta>并不意味着</c>

00:35:16.984 --> 00:35:20.254
<c.magenta>信息已经真正被发送</c>

00:35:20.320 --> 00:35:22.923
<c.magenta>只是意味着用户点击了发送按钮</c>

00:35:22.990 --> 00:35:26.860
<c.magenta>然后它传递了发送消息的企图</c>

00:35:29.029 --> 00:35:32.199
<c.magenta>同样我们还有一个方法叫做</c>
<c.magenta>didCancelSending</c>

00:35:32.833 --> 00:35:37.004
<c.magenta>发生在当用户点击十字</c>

00:35:37.070 --> 00:35:38.906
<c.magenta>在信息泡泡框的右上角</c>

00:35:39.473 --> 00:35:41.675
<c.magenta>didCancelSending</c>
<c.magenta>可以清除</c>

00:35:41.742 --> 00:35:45.612
<c.magenta>任何编写该信息时 累积的的资源</c>

00:35:47.748 --> 00:35:50.851
<c.magenta>最后 我们还有</c>
<c.magenta>didReceive(_message)方法</c>

00:35:52.252 --> 00:35:54.354
<c.magenta>didReceive(_message)方法发生在</c>

00:35:54.421 --> 00:35:57.925
<c.magenta>被调用 当应用正在运行或处于活跃</c>

00:35:57.991 --> 00:36:01.428
<c.magenta>一条信息来自一个接收者</c>

00:35:57.991 --> 00:36:01.428
<c.magenta>一条信息来自一个接收者</c>

00:36:01.495 --> 00:36:03.597
<c.magenta>对话的某一个参与者</c>

00:36:04.198 --> 00:36:06.567
<c.magenta>这非常有用 比如</c>

00:36:06.633 --> 00:36:08.235
<c.magenta>如果应用有</c>

00:36:08.302 --> 00:36:10.871
<c.magenta>如果用户正在编辑一条会话信息</c>

00:36:10.938 --> 00:36:13.307
<c.magenta>在同一个会话中另一条信息进来</c>

00:36:13.373 --> 00:36:18.579
<c.magenta>这是状态更新 你需要更新</c>
<c.magenta>显示该状态的UI</c>

00:36:20.013 --> 00:36:22.482
<c.magenta>让我们继续讲解分组对话</c>

00:36:22.616 --> 00:36:25.452
<c.magenta>iMessage应用</c>
<c.magenta>可应用到分组对话中</c>

00:36:25.519 --> 00:36:28.155
<c.magenta>当建立分组对话时需要考虑这些问题</c>

00:36:29.790 --> 00:36:31.124
<c.magenta>我们在这里</c>

00:36:31.191 --> 00:36:35.696
<c.magenta>有一个示例对话 来自三个朋友</c>
<c.magenta>Amber Ben和Chris</c>

00:36:37.831 --> 00:36:39.666
<c.magenta>Ben给每个人发送了冰淇凌</c>

00:36:40.868 --> 00:36:43.637
<c.magenta>然后他发送了一个问题</c>
<c.magenta>给Amber和Chris</c>

00:36:43.704 --> 00:36:45.973
<c.magenta>你们想要在冰淇凌上面加什么撒料</c>

00:36:46.039 --> 00:36:48.041
<c.magenta>巧克力酱还是彩粉？</c>

00:36:51.512 --> 00:36:54.014
<c.magenta>Amber将要回复巧克力酱</c>

00:36:54.648 --> 00:36:57.684
<c.magenta>Chris将要回复彩粉</c>

00:36:58.986 --> 00:37:02.222
<c.magenta>这两个用户将在完全相同的时间回复</c>

00:36:58.986 --> 00:37:02.222
<c.magenta>这两个用户将在完全相同的时间回复</c>

00:37:04.591 --> 00:37:07.127
<c.magenta>现在关注一下Ben</c>

00:37:08.362 --> 00:37:11.265
<c.magenta>看看他的设备</c>
<c.magenta>对收到的信息会做何种处理</c>

00:37:12.466 --> 00:37:17.404
<c.magenta>首先 Amber的回复</c>
<c.magenta>先到达Ben的设备</c>

00:37:17.471 --> 00:37:20.841
<c.magenta>不久以后 就是来自Chris的回复</c>

00:37:21.375 --> 00:37:26.747
<c.magenta>你可以发现</c>
<c.magenta>Amber的回复变成了摘要信息</c>

00:37:26.813 --> 00:37:30.417
<c.magenta>Chris的回复显示在对话</c>
<c.magenta>最后的泡泡框里</c>

00:37:32.619 --> 00:37:35.322
<c.magenta>另一种情况也是如此</c>

00:37:37.357 --> 00:37:38.525
<c.magenta>需要注意的是</c>

00:37:38.592 --> 00:37:42.062
<c.magenta>只有点击的信息</c>
<c.magenta>在iMessage应用里可用</c>

00:37:43.063 --> 00:37:47.734
<c.magenta>所以例子里</c>
<c.magenta>我们无法访问Amber的回复</c>

00:37:48.135 --> 00:37:49.203
<c.magenta>这该如何处理？</c>

00:37:49.803 --> 00:37:53.273
<c.magenta>现在 我们建议把状态储存在云端</c>

00:37:54.041 --> 00:37:57.077
<c.magenta>也就是说MSMessage的</c>

00:37:57.144 --> 00:38:01.982
<c.magenta>来自和发给对话参与者的URL属性</c>

00:37:57.144 --> 00:38:01.982
<c.magenta>来自和发给对话参与者的URL属性</c>

00:38:02.049 --> 00:38:06.119
<c.magenta>只需要作出表示会话的标记</c>

00:38:07.888 --> 00:38:10.490
<c.magenta>然后你会接收到会话当前状态</c>

00:38:10.724 --> 00:38:13.327
<c.magenta>当用户点击一条信息</c>

00:38:13.660 --> 00:38:15.028
<c.magenta>以及当用户发送一条信息时</c>

00:38:15.095 --> 00:38:18.165
<c.magenta>你应该把当前会话状态存入云端</c>

00:38:20.667 --> 00:38:23.203
<c.magenta>继续 我们讨论发送者标识符</c>

00:38:27.741 --> 00:38:31.411
<c.magenta>回到Amber Ben</c>
<c.magenta>和Chris的对话</c>

00:38:32.946 --> 00:38:38.619
<c.magenta>在这个情境</c>
<c.magenta>Amber回复了想要巧克力酱</c>

00:38:38.785 --> 00:38:40.320
<c.magenta>Chris还没有回复</c>

00:38:42.389 --> 00:38:44.558
<c.magenta>再次关注Ben的设备</c>

00:38:45.692 --> 00:38:48.762
<c.magenta>这里有一条信息 但不知道是谁发的</c>

00:38:51.365 --> 00:38:54.168
<c.magenta>但是我们可以找出相关信息</c>

00:38:54.668 --> 00:38:59.873
<c.magenta>这里有发送者参与者标识符</c>

00:38:59.940 --> 00:39:02.109
<c.magenta>抱歉 重说一遍</c>

00:38:59.940 --> 00:39:02.109
<c.magenta>抱歉 重说一遍</c>

00:39:02.476 --> 00:39:05.045
<c.magenta>这里有参与者标识符</c>

00:39:05.579 --> 00:39:08.782
<c.magenta>Apple对用户隐私非常非常重视</c>

00:39:08.916 --> 00:39:12.352
<c.magenta>我们非常尊重客户的隐私</c>

00:39:12.419 --> 00:39:16.690
<c.magenta>我们完全不对iMessage应用</c>
<c.magenta>显示任何联系人信息</c>

00:39:18.258 --> 00:39:21.195
<c.magenta>取而代之</c>
<c.magenta>我们提供了这些参与者标识符</c>

00:39:22.429 --> 00:39:25.766
<c.magenta>在Ben的设备上</c>
<c.magenta>他有一个本地参与者标识符</c>

00:39:25.832 --> 00:39:30.170
<c.magenta>这是一个UUID</c>
<c.magenta>在该设备上代表Ben</c>

00:39:31.038 --> 00:39:35.042
<c.magenta>他还有两个远程参与者标识符</c>

00:39:35.709 --> 00:39:40.214
<c.magenta>代表了对话中的其余参与者</c>

00:39:40.280 --> 00:39:43.217
<c.magenta>本例中 有两个</c>
<c.magenta>Amber和Chris</c>

00:39:45.085 --> 00:39:46.587
<c.magenta>看一下进来的信息</c>

00:39:46.653 --> 00:39:49.256
<c.magenta>我们看见该信息有一个发送者标识符</c>

00:39:49.756 --> 00:39:54.728
<c.magenta>它将映射一个Ben的列表中的</c>
<c.magenta>本地参与者标识符</c>

00:39:55.963 --> 00:40:00.734
<c.magenta>回到大图</c>
<c.magenta>来看Amber和Chris的设备</c>

00:39:55.963 --> 00:40:00.734
<c.magenta>回到大图</c>
<c.magenta>来看Amber和Chris的设备</c>

00:40:00.801 --> 00:40:06.540
<c.magenta>正在发送的信息有发送者标识符</c>

00:40:07.741 --> 00:40:14.515
<c.magenta>它们映射到每一个发送信息的</c>
<c.magenta>设备本地标识符</c>

00:40:18.752 --> 00:40:20.954
<c.magenta>可以利用这些标识符</c>

00:40:21.021 --> 00:40:23.924
<c.magenta>获取对话中参与者的数量</c>

00:40:24.992 --> 00:40:28.495
<c.magenta>可以把信息归属于一个发送者</c>
<c.magenta>所以一旦接收了某条信息</c>

00:40:28.562 --> 00:40:30.297
<c.magenta>带有特定的发送者标识符</c>

00:40:30.364 --> 00:40:32.866
<c.magenta>然后接收了第二条</c>
<c.magenta>有着相同标识符的信息</c>

00:40:32.933 --> 00:40:34.801
<c.magenta>你知道它们都来自同一个用户</c>

00:40:35.936 --> 00:40:40.874
<c.magenta>还可以和网络服务相结合</c>

00:40:41.074 --> 00:40:44.545
<c.magenta>可以用于帮助确定身份</c>

00:40:45.546 --> 00:40:46.847
<c.magenta>还有一点</c>

00:40:48.415 --> 00:40:51.084
<c.magenta>可以在这些标识符或标识符字符串</c>

00:40:51.151 --> 00:40:56.390
<c.magenta>前面加上一个$符号 写在任何传递给</c>

00:40:56.456 --> 00:40:59.326
<c.magenta>MessageTemplateLayout</c>
<c.magenta>文本属性的文本中</c>

00:40:59.393 --> 00:41:02.663
<c.magenta>同样 你还可以把这些标识符写入</c>

00:40:59.393 --> 00:41:02.663
<c.magenta>同样 你还可以把这些标识符写入</c>

00:41:02.729 --> 00:41:06.567
<c.magenta>要传递给summaryText</c>
<c.magenta>属性的文本中</c>

00:41:07.601 --> 00:41:09.469
<c.magenta>当信息显示UI</c>

00:41:09.536 --> 00:41:12.606
<c.magenta>在泡泡框里的文本带有这种类型格式时</c>

00:41:12.906 --> 00:41:16.143
<c.magenta>它将会把标识符替换为</c>

00:41:16.643 --> 00:41:19.379
<c.magenta>其标识符映射的联系人姓名</c>

00:41:27.521 --> 00:41:31.158
<c.magenta>每一个设备的标识符都是唯一的</c>

00:41:31.225 --> 00:41:32.492
<c.magenta>若你留意之前的幻灯片里</c>

00:41:32.559 --> 00:41:35.696
<c.magenta>每台设备的每个人的标识符都是不同的</c>

00:41:37.297 --> 00:41:40.968
<c.magenta>它们的范围局限在iMessage</c>
<c.magenta>应用的安装里</c>

00:41:41.134 --> 00:41:42.469
<c.magenta>这指的是</c>

00:41:42.536 --> 00:41:46.240
<c.magenta>这些标识符本身将在</c>
<c.magenta>一定时间内保持恒定</c>

00:41:47.508 --> 00:41:52.479
<c.magenta>但若用户删除了iMessage应用</c>
<c.magenta>之后重装</c>

00:41:52.846 --> 00:41:54.381
<c.magenta>就会有一个完全不同的</c>

00:41:54.548 --> 00:41:57.985
<c.magenta>标识符集合 在同样的对话里</c>

00:42:00.654 --> 00:42:02.723
<c.magenta>你可以取得发送者参与者标识符</c>

00:42:02.789 --> 00:42:07.094
<c.magenta>在MSMessage使用</c>
<c.magenta>senderParticipantIdentifier属性</c>

00:42:07.594 --> 00:42:11.832
<c.magenta>还可以通过对话取得本地参与者标识符</c>

00:42:12.299 --> 00:42:15.302
<c.magenta>利用</c>
<c.magenta>localParticipantIdentifier属性</c>

00:42:16.336 --> 00:42:19.973
<c.magenta>还可以取得远程参与者标识符列表</c>

00:42:20.040 --> 00:42:23.343
<c.magenta>从remoteParticipantIdentifier属性</c>

00:42:29.850 --> 00:42:34.855
<c.magenta>这就是我们要讲的API的高级主题</c>

00:42:35.055 --> 00:42:38.158
<c.magenta>再讲一下支持平台</c>

00:42:39.293 --> 00:42:43.897
<c.magenta>互动型信息将会在这些平台上提供</c>

00:42:43.964 --> 00:42:47.401
<c.magenta>watchOS 3、 macOS</c>
<c.magenta>Sierra和iOS 10</c>

00:42:47.901 --> 00:42:51.939
<c.magenta>在这些平台中 只有iOS 10</c>
<c.magenta>会真正产生信息</c>

00:42:52.973 --> 00:42:57.544
<c.magenta>在macOS Sierra</c>
<c.magenta>用户可以点击对话文本中的泡泡框</c>

00:42:57.945 --> 00:43:01.982
<c.magenta>传递给信息URL属性的URL</c>

00:42:57.945 --> 00:43:01.982
<c.magenta>传递给信息URL属性的URL</c>

00:43:02.850 --> 00:43:04.585
<c.magenta>将会在Safari里打开</c>

00:43:04.651 --> 00:43:08.922
<c.magenta>只有https或</c>
<c.magenta>http URL才行</c>

00:43:09.890 --> 00:43:12.693
<c.magenta>在watch上 可以把互动信息传给</c>

00:43:12.759 --> 00:43:16.063
<c.magenta>可以写回复的设备</c>

00:43:24.671 --> 00:43:28.575
<c.magenta>我们也支持旧平台备用</c>

00:43:28.742 --> 00:43:32.679
<c.magenta>这些消息也可以在</c>
<c.magenta>watchOS 2、 iOS 10</c>

00:43:32.746 --> 00:43:35.449
<c.magenta>iOS 9和OS 10.11上发送</c>

00:43:35.649 --> 00:43:37.518
<c.magenta>但是会以备用格式发送</c>

00:43:37.584 --> 00:43:39.353
<c.magenta>有两条分开的信息</c>

00:43:39.920 --> 00:43:43.624
<c.magenta>第一条是模版布局提供的图片</c>

00:43:44.558 --> 00:43:49.263
<c.magenta>第二条是信息提供的URL</c>

00:43:49.796 --> 00:43:53.467
<c.magenta>再次强调 如果是https URL</c>
<c.magenta>将会发送</c>

00:43:53.534 --> 00:43:55.469
<c.magenta>如果是数据URL 则不会发送</c>

00:43:55.969 --> 00:44:01.542
<c.magenta>我们在备用消息中只发送</c>
<c.magenta>https或http URL</c>

00:43:55.969 --> 00:44:01.542
<c.magenta>我们在备用消息中只发送</c>
<c.magenta>https或http URL</c>

00:44:04.511 --> 00:44:05.979
<c.magenta>这就是本次演讲的全部内容</c>

00:44:06.547 --> 00:44:08.348
<c.magenta>总结一下</c>

00:44:08.415 --> 00:44:12.419
<c.magenta>本周我们介绍了Messages框架</c>
<c.magenta>iMessage应用</c>

00:44:14.655 --> 00:44:18.125
<c.magenta>在本演讲的第一部分Bhaskar</c>
<c.magenta>和Lily为我们介绍了</c>

00:44:18.192 --> 00:44:20.060
<c.magenta>贴图集 并演示了</c>

00:44:20.127 --> 00:44:23.730
<c.magenta>如何编写可以建立</c>
<c.magenta>贴图内容的iMessage应用</c>

00:44:24.831 --> 00:44:28.836
<c.magenta>今天 我们一起编写了</c>
<c.magenta>发送互动内容的iMessage应用</c>

00:44:30.270 --> 00:44:33.607
<c.magenta>还讲了如何在分组对话中实现等</c>

00:44:35.943 --> 00:44:38.745
<c.magenta>我十分期待看到你们大家</c>

00:44:38.812 --> 00:44:40.414
<c.magenta>走出去利用该API所做的成绩</c>

00:44:41.081 --> 00:44:45.552
<c.magenta>迫不及待想看到大家的产品 就这样</c>

00:44:53.493 --> 00:44:56.296
<c.magenta>其它详细信息</c>
<c.magenta>可以浏览本次演讲的网页</c>

00:44:56.363 --> 00:44:58.565
<c.magenta>在developer.apple.com</c>

00:44:59.333 --> 00:45:00.467
<c.magenta>我们还有一个相关演讲</c>

00:44:59.333 --> 00:45:00.467
<c.magenta>我们还有一个相关演讲</c>

00:45:00.534 --> 00:45:04.571
<c.magenta>如果你还没有看过“iMessage</c>
<c.magenta>应用和贴图 第一部分”</c>

00:45:04.638 --> 00:45:06.440
<c.magenta>请到网站上观看</c>

00:45:07.441 --> 00:45:09.309
<c.magenta>演讲到此结束</c>

00:45:09.376 --> 00:45:11.678
<c.magenta>感谢Stephen的演示</c>

00:45:11.745 --> 00:45:13.213
<c.magenta>谢谢你们大家的到来</c>
